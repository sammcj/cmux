{"number":1194,"title":"Invert saved-notice to display on unsaved changes","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1194","headRef":"cmux/invert-saved-notice-to-display-on-unsaved-changes-e4ezs","headSha":"10f735090befec202176ca41c016efb6b26c7e35","baseRef":"main","baseSha":"1e61f57f833bd52d4707544fda2b352a8d3194fe","createdAt":"2025-12-05T11:38:40Z","updatedAt":"2025-12-05T12:01:25Z","diff":"diff --git a/apps/client/src/components/WorkspaceSetupPanel.tsx b/apps/client/src/components/WorkspaceSetupPanel.tsx\nindex 873c45642..de53499ea 100644\n--- a/apps/client/src/components/WorkspaceSetupPanel.tsx\n+++ b/apps/client/src/components/WorkspaceSetupPanel.tsx\n@@ -481,9 +481,9 @@ export function WorkspaceSetupPanel({\n                     Add variable\n                   </button>\n                   <div className=\"flex items-center gap-2\">\n-                    {!hasChanges && !saveMutation.isPending ? (\n-                      <span className=\"text-[11px] text-neutral-500 dark:text-neutral-400\">\n-                        All changes saved\n+                    {hasChanges && !saveMutation.isPending ? (\n+                      <span className=\"text-[11px] text-amber-600 dark:text-amber-400\">\n+                        Unsaved changes\n                       </span>\n                     ) : null}\n                     <Button\n","comments":[{"type":"issue_comment","id":3616551517,"prNumber":1194,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7e6bte9g75rq272m61804v2h7wq8m1?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7e6bte9g75rq272m61804v2h7wq8m1/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1194?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 3 screenshots for commit `10f7350` (2025-12-05 11:43:20.590 UTC).\n\n**Full-page screenshot of the homepage/dashboard showing the WorkspaceSetupPanel expanded with 'Unsaved changes' notice visible after editing the setup script**\n\n![homepage-workspace-setup-unsaved-changes-fullpage.png](https://famous-camel-162.convex.cloud/api/storage/a1e1efe7-b92a-4324-8160-f624270d1bfe)\n\n**Detailed screenshot focused on the 'Unsaved changes' text \\(in amber color\\) displayed next to the enabled 'Save setup' button at the bottom of the workspace configuration panel**\n\n![unsaved-changes-notice-detail.png](https://famous-camel-162.convex.cloud/api/storage/cd6b75af-47a0-4b4d-a80f-7000e951e264)\n\n**Close-up screenshot of the Configure workspace panel header showing the workspace setup incomplete warning**\n\n![workspace-setup-panel-unsaved-changes.png](https://famous-camel-162.convex.cloud/api/storage/f55f730a-5cb5-4c82-b2c9-a080065e7492)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"10f735090befec202176ca41c016efb6b26c7e35","createdAt":"2025-12-05T11:43:21Z","updatedAt":"2025-12-05T11:43:21Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1194#issuecomment-3616551517"},{"type":"issue_comment","id":3616555656,"prNumber":1194,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn71d7p37sxwq38ap1zchgc2497wqwj1?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn71d7p37sxwq38ap1zchgc2497wqwj1/run/kd76ja38vc79pqf3atj4pmxaq57wqew2/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1194?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 4 screenshots for commit `10f7350` (2025-12-05 11:44:43.713 UTC).\n\n**AFTER: Shows no status text when there are no changes - clean and uncluttered interface**\n\n![after-no-changes-clean-state.png](https://adorable-wombat-701.convex.cloud/api/storage/5122d0da-d25f-48c8-b4ce-54d8eeaa3351)\n\n**AFTER: Shows 'Unsaved changes' in amber when there ARE changes - clear warning to save work**\n\n![after-unsaved-changes-warning.png](https://adorable-wombat-701.convex.cloud/api/storage/bc1eafda-53a6-4d4f-86ef-aaac79519587)\n\n**BEFORE: Shows 'All changes saved' in neutral gray when there are no changes - confusing UX**\n\n![before-all-changes-saved.png](https://adorable-wombat-701.convex.cloud/api/storage/4d991eba-0931-4021-befa-1f421a83a179)\n\n**Full comparison showing before \\(main branch\\) vs after \\(this PR\\) states of the WorkspaceSetupPanel save status message**\n\n![workspace-setup-panel-comparison.png](https://adorable-wombat-701.convex.cloud/api/storage/8f1ddb32-1286-4d5a-954c-80217c4f2faa)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"10f735090befec202176ca41c016efb6b26c7e35","createdAt":"2025-12-05T11:44:44Z","updatedAt":"2025-12-05T11:44:44Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1194#issuecomment-3616555656"}]}
{"number":1193,"title":"perf(sandbox): optimize sandbox creation with parallel uploads","state":"open","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1193","headRef":"optimize-sandbox-spawn-rust-0","headSha":"a2c108799f87f37390d00e76cd135d6d6d98d1d4","baseRef":"main","baseSha":"1e61f57f833bd52d4707544fda2b352a8d3194fe","createdAt":"2025-12-05T11:37:06Z","updatedAt":"2025-12-05T22:11:42Z","diff":"diff --git a/.beads/issues.jsonl b/.beads/issues.jsonl\nnew file mode 100644\nindex 000000000..1d2e539bf\n--- /dev/null\n+++ b/.beads/issues.jsonl\n@@ -0,0 +1,4 @@\n+{\"id\":\"cmux2-73d\",\"title\":\"Add fake CLIs for editors (zed, cursor, code, windsurf) that trigger open editor via unix socket, alias to cmux-bridge\",\"description\":\"\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"feature\",\"created_at\":\"2025-12-05T01:27:23.238274-08:00\",\"updated_at\":\"2025-12-05T01:51:16.344611-08:00\",\"closed_at\":\"2025-12-05T01:51:16.344611-08:00\"}\n+{\"id\":\"cmux2-qa1\",\"title\":\"Preinstall mise in sandbox\",\"description\":\"\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-05T01:50:49.793224-08:00\",\"updated_at\":\"2025-12-05T01:51:16.467898-08:00\",\"closed_at\":\"2025-12-05T01:51:16.467898-08:00\"}\n+{\"id\":\"cmux2-s0f\",\"title\":\"Add cmux prune command to cleanup sandboxes from N days ago (default 2 days, configurable)\",\"description\":\"\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"feature\",\"created_at\":\"2025-12-05T01:27:23.748533-08:00\",\"updated_at\":\"2025-12-05T01:51:16.424645-08:00\",\"closed_at\":\"2025-12-05T01:51:16.424645-08:00\"}\n+{\"id\":\"cmux2-som\",\"title\":\"Upgrade node to 25.2.1\",\"description\":\"\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-05T01:27:23.490942-08:00\",\"updated_at\":\"2025-12-05T01:51:16.384145-08:00\",\"closed_at\":\"2025-12-05T01:51:16.384145-08:00\"}\ndiff --git a/packages/sandbox/src/bin/cli.rs b/packages/sandbox/src/bin/cli.rs\nindex 787cd8ec7..95c029517 100644\n--- a/packages/sandbox/src/bin/cli.rs\n+++ b/packages/sandbox/src/bin/cli.rs\n@@ -5,7 +5,9 @@ use cmux_sandbox::models::{\n };\n use cmux_sandbox::{\n     build_default_env_vars, extract_api_key_from_output, store_claude_token,\n-    sync_files::{upload_sync_files, SYNC_FILES},\n+    sync_files::{\n+        prebuild_sync_files_tar, upload_prebuilt_sync_files, upload_sync_files, SYNC_FILES,\n+    },\n     AcpProvider, DEFAULT_HTTP_PORT, DEFAULT_IMAGE, DMUX_DEFAULT_CONTAINER, DMUX_DEFAULT_HTTP_PORT,\n     DMUX_DEFAULT_IMAGE,\n };\n@@ -406,6 +408,15 @@ async fn run() -> anyhow::Result<()> {\n         }\n         Command::New(args) => {\n             check_server_reachable(&client, &cli.base_url).await?;\n+\n+            // OPTIMIZATION: Pre-build the sync files tar while waiting for sandbox creation\n+            // This overlaps CPU work (tar creation) with network I/O (sandbox creation)\n+            let sync_tar_handle = tokio::task::spawn_blocking(prebuild_sync_files_tar);\n+\n+            // OPTIMIZATION: Start building the workspace tar archive BEFORE sandbox creation\n+            // The stream_directory function spawns a blocking task that starts immediately\n+            let workspace_body = stream_directory(args.path.clone());\n+\n             let body = CreateSandboxRequest {\n                 name: Some(\"interactive\".into()),\n                 workspace: None,\n@@ -419,27 +430,64 @@ async fn run() -> anyhow::Result<()> {\n             let summary: SandboxSummary = parse_response(response).await?;\n             eprintln!(\"Created sandbox {}\", summary.id);\n \n-            // Upload directory\n-            eprintln!(\"Uploading directory: {}\", args.path.display());\n-            let body = stream_directory(args.path.clone());\n-            let url = format!(\n+            // OPTIMIZATION: Start uploads in background, attach to shell IMMEDIATELY\n+            // User gets a shell while files are still uploading in the background\n+            let sandbox_id_for_upload = summary.id.to_string();\n+            let base_url_for_upload = cli.base_url.clone();\n+            let client_for_upload = client.clone();\n+            let path_display = args.path.display().to_string();\n+\n+            eprintln!(\"Uploading {} in background...\", path_display);\n+\n+            // Spawn workspace upload task - starts immediately to drain the stream\n+            let upload_url = format!(\n                 \"{}/sandboxes/{}/files\",\n-                cli.base_url.trim_end_matches('/'),\n-                summary.id\n+                base_url_for_upload.trim_end_matches('/'),\n+                sandbox_id_for_upload\n             );\n-            let response = client.post(url).body(body).send().await?;\n-            if !response.status().is_success() {\n-                eprintln!(\"Failed to upload files: {}\", response.status());\n-            } else {\n-                eprintln!(\"Files uploaded.\");\n-            }\n-\n-            // Upload auth files\n-            if let Err(e) =\n-                upload_sync_files(&client, &cli.base_url, &summary.id.to_string(), true).await\n-            {\n-                eprintln!(\"Warning: Failed to upload auth files: {}\", e);\n-            }\n+            let client_for_workspace = client_for_upload.clone();\n+            tokio::spawn(async move {\n+                let response = client_for_workspace\n+                    .post(&upload_url)\n+                    .body(workspace_body)\n+                    .send()\n+                    .await;\n+                match response {\n+                    Ok(resp) if resp.status().is_success() => {\n+                        eprintln!(\"\\r\\x1b[K\\x1b[32m✓\\x1b[0m Files uploaded.\");\n+                    }\n+                    Ok(resp) => {\n+                        eprintln!(\n+                            \"\\r\\x1b[K\\x1b[31m✗\\x1b[0m Failed to upload files: {}\",\n+                            resp.status()\n+                        );\n+                    }\n+                    Err(e) => {\n+                        eprintln!(\"\\r\\x1b[K\\x1b[31m✗\\x1b[0m Failed to upload files: {}\", e);\n+                    }\n+                }\n+            });\n+\n+            // Spawn auth upload task - waits for tar to be ready first\n+            tokio::spawn(async move {\n+                let sync_tar = sync_tar_handle.await.ok().flatten();\n+                if let Some(tar_data) = sync_tar {\n+                    if let Err(e) = upload_prebuilt_sync_files(\n+                        &client_for_upload,\n+                        &base_url_for_upload,\n+                        &sandbox_id_for_upload,\n+                        tar_data,\n+                        false,\n+                    )\n+                    .await\n+                    {\n+                        eprintln!(\n+                            \"\\r\\x1b[K\\x1b[33m!\\x1b[0m Warning: Failed to upload auth files: {}\",\n+                            e\n+                        );\n+                    }\n+                }\n+            });\n \n             save_last_sandbox(&summary.id.to_string());\n             if should_attach() {\n@@ -668,6 +716,12 @@ async fn run() -> anyhow::Result<()> {\n                     }\n                 }\n                 SandboxCommand::New(args) => {\n+                    // OPTIMIZATION: Pre-build the sync files tar while waiting for sandbox creation\n+                    let sync_tar_handle = tokio::task::spawn_blocking(prebuild_sync_files_tar);\n+\n+                    // OPTIMIZATION: Start building the workspace tar archive BEFORE sandbox creation\n+                    let workspace_body = stream_directory(args.path.clone());\n+\n                     let body = CreateSandboxRequest {\n                         name: Some(\"interactive\".into()),\n                         workspace: None,\n@@ -681,34 +735,71 @@ async fn run() -> anyhow::Result<()> {\n                     let summary: SandboxSummary = parse_response(response).await?;\n                     eprintln!(\"Created sandbox {}\", summary.id);\n \n-                    // Upload directory\n-                    eprintln!(\"Uploading directory: {}\", args.path.display());\n-                    let body = stream_directory(args.path.clone());\n-                    let url = format!(\n+                    // OPTIMIZATION: Start uploads in background, attach to shell IMMEDIATELY\n+                    let sandbox_id_for_upload = summary.id.to_string();\n+                    let base_url_for_upload = cli.base_url.clone();\n+                    let client_for_upload = client.clone();\n+                    let path_display = args.path.display().to_string();\n+\n+                    eprintln!(\"Uploading {} in background...\", path_display);\n+\n+                    // Spawn workspace upload task - starts immediately to drain the stream\n+                    let upload_url = format!(\n                         \"{}/sandboxes/{}/files\",\n-                        cli.base_url.trim_end_matches('/'),\n-                        summary.id\n+                        base_url_for_upload.trim_end_matches('/'),\n+                        sandbox_id_for_upload\n                     );\n-                    let response = client.post(url).body(body).send().await?;\n-                    if !response.status().is_success() {\n-                        eprintln!(\"Failed to upload files: {}\", response.status());\n-                    } else {\n-                        eprintln!(\"Files uploaded.\");\n-                    }\n-\n-                    // Upload auth files\n-                    if let Err(e) =\n-                        upload_sync_files(&client, &cli.base_url, &summary.id.to_string(), true)\n+                    let client_for_workspace = client_for_upload.clone();\n+                    tokio::spawn(async move {\n+                        let response = client_for_workspace\n+                            .post(&upload_url)\n+                            .body(workspace_body)\n+                            .send()\n+                            .await;\n+                        match response {\n+                            Ok(resp) if resp.status().is_success() => {\n+                                eprintln!(\"\\r\\x1b[K\\x1b[32m✓\\x1b[0m Files uploaded.\");\n+                            }\n+                            Ok(resp) => {\n+                                eprintln!(\n+                                    \"\\r\\x1b[K\\x1b[31m✗\\x1b[0m Failed to upload files: {}\",\n+                                    resp.status()\n+                                );\n+                            }\n+                            Err(e) => {\n+                                eprintln!(\"\\r\\x1b[K\\x1b[31m✗\\x1b[0m Failed to upload files: {}\", e);\n+                            }\n+                        }\n+                    });\n+\n+                    // Spawn auth upload task - waits for tar to be ready first\n+                    tokio::spawn(async move {\n+                        let sync_tar = sync_tar_handle.await.ok().flatten();\n+                        if let Some(tar_data) = sync_tar {\n+                            if let Err(e) = upload_prebuilt_sync_files(\n+                                &client_for_upload,\n+                                &base_url_for_upload,\n+                                &sandbox_id_for_upload,\n+                                tar_data,\n+                                false,\n+                            )\n                             .await\n-                    {\n-                        eprintln!(\"Warning: Failed to upload auth files: {}\", e);\n-                    }\n+                            {\n+                                eprintln!(\n+                                    \"\\r\\x1b[K\\x1b[33m!\\x1b[0m Warning: Failed to upload auth files: {}\",\n+                                    e\n+                                );\n+                            }\n+                        }\n+                    });\n \n                     save_last_sandbox(&summary.id.to_string());\n                     if should_attach() {\n                         handle_ssh(&cli.base_url, &summary.id.to_string()).await?;\n                     } else {\n-                        eprintln!(\"Skipping interactive shell attach (non-interactive environment detected).\");\n+                        eprintln!(\n+                            \"Skipping interactive shell attach (non-interactive environment detected).\"\n+                        );\n                     }\n                 }\n                 SandboxCommand::Show { id } => {\ndiff --git a/packages/sandbox/src/bin/server.rs b/packages/sandbox/src/bin/server.rs\nindex f44bd9dea..169303baa 100644\n--- a/packages/sandbox/src/bin/server.rs\n+++ b/packages/sandbox/src/bin/server.rs\n@@ -41,6 +41,9 @@ struct Options {\n         env = \"CMUX_BRIDGE_SOCKET\"\n     )]\n     bridge_socket: PathBuf,\n+    /// Enable timing instrumentation (logs to timing.log)\n+    #[arg(long, env = \"CMUX_TIMING\")]\n+    timing: bool,\n }\n \n #[tokio::main]\n@@ -48,6 +51,16 @@ async fn main() -> anyhow::Result<()> {\n     let options = Options::parse();\n     let _guard = init_tracing(&options.log_dir);\n \n+    // Enable timing if requested\n+    if options.timing {\n+        cmux_sandbox::timing::enable_timing();\n+        let timing_log = options.log_dir.join(\"timing.log\");\n+        if let Some(path) = timing_log.to_str() {\n+            cmux_sandbox::timing::set_log_path(path);\n+        }\n+        tracing::info!(\"timing instrumentation enabled\");\n+    }\n+\n     run_server(options).await;\n \n     Ok(())\ndiff --git a/packages/sandbox/src/bubblewrap.rs b/packages/sandbox/src/bubblewrap.rs\nindex 55693823c..1000e251c 100644\n--- a/packages/sandbox/src/bubblewrap.rs\n+++ b/packages/sandbox/src/bubblewrap.rs\n@@ -6,6 +6,7 @@ use crate::models::{\n };\n use crate::mux::terminal::VirtualTerminal;\n use crate::service::SandboxService;\n+use crate::timing::TimingReport;\n use async_trait::async_trait;\n use axum::body::Body;\n use axum::extract::ws::{Message, WebSocket};\n@@ -687,6 +688,7 @@ fi\n         command.args([\"--\", \"/bin/sh\", \"-c\", \"ip link set lo up && sleep infinity\"]);\n \n         let mut child = command.spawn()?;\n+\n         let stdout = child\n             .stdout\n             .take()\n@@ -703,32 +705,52 @@ fi\n         Ok((child, status.child_pid))\n     }\n \n-    async fn configure_network(\n+    /// Prepare the host side of the network (veth creation + host config).\n+    /// This can run in parallel with bubblewrap spawn since it doesn't need the child PID.\n+    async fn prepare_network_host_side(\n+        &self,\n+        host_if: &str,\n+        ns_if: &str,\n+        host_cidr: &str,\n+    ) -> SandboxResult<()> {\n+        // Create veth pair and configure host side in one shell command\n+        let script = format!(\n+            \"{ip} link add {host} type veth peer name {ns} && \\\n+             {ip} addr add {cidr} dev {host} && \\\n+             {ip} link set {host} up\",\n+            ip = self.ip_path,\n+            host = host_if,\n+            ns = ns_if,\n+            cidr = host_cidr\n+        );\n+        run_command(\"/bin/sh\", &[\"-c\", &script]).await\n+    }\n+\n+    /// Finish network configuration by moving interface to namespace and configuring sandbox side.\n+    /// This must run after bubblewrap spawn since it needs the child PID.\n+    async fn finish_network_sandbox_side(\n         &self,\n         pid: u32,\n         lease: &IpLease,\n-        id: &Uuid,\n+        host_if: &str,\n+        ns_if: &str,\n+        sandbox_cidr: &str,\n     ) -> SandboxResult<SandboxNetwork> {\n         let formatted_pid = pid.to_string();\n-        let (host_if, ns_if) = make_interface_names(id);\n-        let host_cidr = format!(\"{}/{}\", lease.host, lease.cidr);\n-        let sandbox_cidr = format!(\"{}/{}\", lease.sandbox, lease.cidr);\n \n+        // Move interface to sandbox namespace\n         run_command(\n             &self.ip_path,\n-            &[\n-                \"link\", \"add\", &host_if, \"type\", \"veth\", \"peer\", \"name\", &ns_if,\n-            ],\n-        )\n-        .await?;\n-        run_command(&self.ip_path, &[\"addr\", \"add\", &host_cidr, \"dev\", &host_if]).await?;\n-        run_command(&self.ip_path, &[\"link\", \"set\", &host_if, \"up\"]).await?;\n-        run_command(\n-            &self.ip_path,\n-            &[\"link\", \"set\", &ns_if, \"netns\", &formatted_pid],\n+            &[\"link\", \"set\", ns_if, \"netns\", &formatted_pid],\n         )\n         .await?;\n \n+        // Configure sandbox side - all in one nsenter call\n+        let host_ip = lease.host.to_string();\n+        let script = format!(\n+            \"ip addr add {} dev {} && ip link set {} up && ip link set lo up && ip route replace default via {}\",\n+            sandbox_cidr, ns_if, ns_if, host_ip\n+        );\n         run_command(\n             &self.nsenter_path,\n             &[\n@@ -736,66 +758,16 @@ fi\n                 &formatted_pid,\n                 \"--net\",\n                 \"--\",\n-                \"ip\",\n-                \"addr\",\n-                \"add\",\n-                &sandbox_cidr,\n-                \"dev\",\n-                &ns_if,\n-            ],\n-        )\n-        .await?;\n-\n-        run_command(\n-            &self.nsenter_path,\n-            &[\n-                \"--target\",\n-                &formatted_pid,\n-                \"--net\",\n-                \"--\",\n-                \"ip\",\n-                \"link\",\n-                \"set\",\n-                &ns_if,\n-                \"up\",\n-            ],\n-        )\n-        .await?;\n-        run_command(\n-            &self.nsenter_path,\n-            &[\n-                \"--target\",\n-                &formatted_pid,\n-                \"--net\",\n-                \"--\",\n-                \"ip\",\n-                \"link\",\n-                \"set\",\n-                \"lo\",\n-                \"up\",\n-            ],\n-        )\n-        .await?;\n-        run_command(\n-            &self.nsenter_path,\n-            &[\n-                \"--target\",\n-                &formatted_pid,\n-                \"--net\",\n-                \"--\",\n-                \"ip\",\n-                \"route\",\n-                \"replace\",\n-                \"default\",\n-                \"via\",\n-                &lease.host.to_string(),\n+                \"/bin/sh\",\n+                \"-c\",\n+                &script,\n             ],\n         )\n         .await?;\n \n         Ok(SandboxNetwork {\n-            host_interface: host_if,\n-            sandbox_interface: ns_if,\n+            host_interface: host_if.to_string(),\n+            sandbox_interface: ns_if.to_string(),\n             host_ip: lease.host.to_string(),\n             sandbox_ip: lease.sandbox.to_string(),\n             cidr: lease.cidr,\n@@ -1056,20 +1028,29 @@ fn session_env_with_overrides(\n impl SandboxService for BubblewrapService {\n     async fn create(&self, request: CreateSandboxRequest) -> SandboxResult<SandboxSummary> {\n         let id = Uuid::new_v4();\n+        let mut timing = TimingReport::new(\"sandbox_create\", &id.to_string());\n+\n         let index = self.next_index.fetch_add(1, Ordering::Relaxed);\n         let name = request\n             .name\n             .clone()\n             .unwrap_or_else(|| Self::default_name(&id));\n+\n+        // Phase: workspace setup\n         let workspace = self.resolve_workspace(&request, &id);\n+        let workspace_timer = crate::timing::Timer::new(\"workspace_setup\");\n         fs::create_dir_all(&workspace).await?;\n+        timing.record_timer(\"workspace_setup\", workspace_timer);\n \n         let system_dir = self.workspace_root.join(id.to_string()).join(\"system\");\n \n+        // Phase: IP allocation\n+        let ip_timer = crate::timing::Timer::new(\"ip_allocation\");\n         let lease = {\n             let mut pool = self.ip_pool.lock().await;\n             pool.allocate()?\n         };\n+        timing.record_timer(\"ip_allocation\", ip_timer);\n \n         let effective_env = build_effective_env(\n             &request.env,\n@@ -1080,20 +1061,32 @@ impl SandboxService for BubblewrapService {\n             self.docker.docker_host_env(),\n         );\n \n-        let (mut child, inner_pid) = match self\n-            .spawn_bubblewrap(\n-                &request,\n-                &effective_env,\n-                &workspace,\n-                &system_dir,\n-                &id,\n-                &lease,\n-                index,\n-            )\n-            .await\n-        {\n+        // Phase: spawn bubblewrap AND prepare network in parallel\n+        // Veth creation + host setup don't need the child PID, so run them concurrently\n+        let spawn_timer = crate::timing::Timer::new(\"spawn_and_net_prepare\");\n+        let (host_if, ns_if) = make_interface_names(&id);\n+        let host_cidr = format!(\"{}/{}\", lease.host, lease.cidr);\n+\n+        let spawn_fut = self.spawn_bubblewrap(\n+            &request,\n+            &effective_env,\n+            &workspace,\n+            &system_dir,\n+            &id,\n+            &lease,\n+            index,\n+        );\n+\n+        let net_prepare_fut = self.prepare_network_host_side(&host_if, &ns_if, &host_cidr);\n+\n+        let (spawn_result, net_prepare_result) = tokio::join!(spawn_fut, net_prepare_fut);\n+\n+        // Handle spawn result\n+        let (mut child, inner_pid) = match spawn_result {\n             Ok(res) => res,\n             Err(error) => {\n+                // Clean up network if it was created\n+                let _ = run_command(&self.ip_path, &[\"link\", \"del\", &host_if]).await;\n                 cleanup_overlays(&system_dir).await;\n                 let mut pool = self.ip_pool.lock().await;\n                 pool.release(&lease);\n@@ -1101,10 +1094,27 @@ impl SandboxService for BubblewrapService {\n             }\n         };\n \n-        let network = match self.configure_network(inner_pid, &lease, &id).await {\n+        // Handle network prepare result\n+        if let Err(error) = net_prepare_result {\n+            let _ = child.kill().await;\n+            cleanup_overlays(&system_dir).await;\n+            let mut pool = self.ip_pool.lock().await;\n+            pool.release(&lease);\n+            return Err(error);\n+        }\n+        timing.record_timer(\"spawn_and_net_prepare\", spawn_timer);\n+\n+        // Phase: finish network configuration (needs PID, must be sequential)\n+        let net_finish_timer = crate::timing::Timer::new(\"net_finish\");\n+        let sandbox_cidr = format!(\"{}/{}\", lease.sandbox, lease.cidr);\n+        let network = match self\n+            .finish_network_sandbox_side(inner_pid, &lease, &host_if, &ns_if, &sandbox_cidr)\n+            .await\n+        {\n             Ok(net) => net,\n             Err(error) => {\n                 let _ = child.kill().await;\n+                let _ = run_command(&self.ip_path, &[\"link\", \"del\", &host_if]).await;\n                 cleanup_overlays(&system_dir).await;\n                 {\n                     let mut pool = self.ip_pool.lock().await;\n@@ -1113,6 +1123,7 @@ impl SandboxService for BubblewrapService {\n                 return Err(error);\n             }\n         };\n+        timing.record_timer(\"net_finish\", net_finish_timer);\n \n         let handle = SandboxHandle {\n             id,\n@@ -1132,6 +1143,8 @@ impl SandboxService for BubblewrapService {\n             env: effective_env,\n         };\n \n+        // Phase: finalize\n+        let finalize_timer = crate::timing::Timer::new(\"finalize\");\n         let summary = {\n             let mut child = entry.child.lock().await;\n             Self::workspace_summary(&entry, &mut child).await?\n@@ -1139,7 +1152,10 @@ impl SandboxService for BubblewrapService {\n \n         let mut sandboxes = self.sandboxes.lock().await;\n         sandboxes.insert(id, entry);\n+        timing.record_timer(\"finalize\", finalize_timer);\n+\n         info!(\"created sandbox {id}\");\n+        timing.finish();\n         Ok(summary)\n     }\n \ndiff --git a/packages/sandbox/src/lib.rs b/packages/sandbox/src/lib.rs\nindex efc4f2469..b9aa6d981 100644\n--- a/packages/sandbox/src/lib.rs\n+++ b/packages/sandbox/src/lib.rs\n@@ -11,6 +11,7 @@ pub mod palette;\n pub mod service;\n pub mod settings;\n pub mod sync_files;\n+pub mod timing;\n \n pub use acp_client::{\n     load_last_provider, run_chat_tui, run_chat_tui_with_workspace_status, run_demo_tui,\ndiff --git a/packages/sandbox/src/mux/runner.rs b/packages/sandbox/src/mux/runner.rs\nindex e4e9fe78b..253b6b5cd 100644\n--- a/packages/sandbox/src/mux/runner.rs\n+++ b/packages/sandbox/src/mux/runner.rs\n@@ -92,6 +92,16 @@ async fn run_main_loop<B: ratatui::backend::Backend + std::io::Write>(\n     let terminal_manager = create_terminal_manager(base_url.clone(), event_tx.clone());\n     app.set_terminal_manager(terminal_manager.clone());\n \n+    // Pre-establish WebSocket connection in background - don't wait for first terminal\n+    // This runs in parallel with sandbox creation, so WebSocket is ready when we need it\n+    let ws_manager = terminal_manager.clone();\n+    tokio::spawn(async move {\n+        if let Err(e) = crate::mux::terminal::establish_mux_connection(ws_manager).await {\n+            // Non-fatal - will retry when first terminal connects\n+            tracing::debug!(\"Pre-establish WebSocket failed (will retry): {}\", e);\n+        }\n+    });\n+\n     // Start background task to periodically refresh sandboxes\n     let refresh_tx = event_tx.clone();\n     let refresh_url = base_url.clone();\n@@ -1255,32 +1265,7 @@ async fn create_sandbox_with_workspace(\n     let summary: crate::models::SandboxSummary = response.json().await?;\n     let sandbox_id = summary.id.to_string();\n \n-    let _ = event_tx.send(MuxEvent::StatusMessage {\n-        message: format!(\"Uploading {}...\", dir_name),\n-    });\n-\n-    if let Err(error) = upload_workspace(&client, &trimmed_base, &sandbox_id, &workspace_path).await\n-    {\n-        let _ = event_tx.send(MuxEvent::Error(format!(\n-            \"Failed to upload workspace: {}\",\n-            error\n-        )));\n-    }\n-\n-    let sync_files = detect_sync_files();\n-    if !sync_files.is_empty() {\n-        let _ = event_tx.send(MuxEvent::StatusMessage {\n-            message: format!(\"Syncing {} file(s)...\", sync_files.len()),\n-        });\n-\n-        if let Err(error) =\n-            upload_sync_files_with_list(&client, &trimmed_base, &sandbox_id, sync_files, false)\n-                .await\n-        {\n-            let _ = event_tx.send(MuxEvent::Error(format!(\"Failed to sync files: {}\", error)));\n-        }\n-    }\n-\n+    // Send creation events and connect IMMEDIATELY - don't wait for uploads\n     let _ = event_tx.send(MuxEvent::SandboxCreated {\n         sandbox: summary.clone(),\n         tab_id: Some(tab_id.clone()),\n@@ -1288,12 +1273,64 @@ async fn create_sandbox_with_workspace(\n     let _ = event_tx.send(MuxEvent::StatusMessage {\n         message: format!(\"Created sandbox: {}\", sandbox_id),\n     });\n-    let _ = event_tx.send(MuxEvent::ConnectToSandbox { sandbox_id });\n+    let _ = event_tx.send(MuxEvent::ConnectToSandbox {\n+        sandbox_id: sandbox_id.clone(),\n+    });\n \n+    // Refresh sandbox list immediately so it appears in sidebar\n     if let Err(error) = refresh_sandboxes(&trimmed_base, &event_tx).await {\n         let _ = event_tx.send(MuxEvent::SandboxRefreshFailed(error.to_string()));\n     }\n \n+    // Run uploads in background - don't block the shell connection\n+    let _ = event_tx.send(MuxEvent::StatusMessage {\n+        message: format!(\"Uploading {}...\", dir_name),\n+    });\n+\n+    // Spawn workspace upload task - starts immediately to drain the stream\n+    let workspace_client = client.clone();\n+    let workspace_base = trimmed_base.clone();\n+    let workspace_id = sandbox_id.clone();\n+    let workspace_event_tx = event_tx.clone();\n+    let workspace_dir_name = dir_name.clone();\n+    tokio::spawn(async move {\n+        if let Err(error) = upload_workspace(\n+            &workspace_client,\n+            &workspace_base,\n+            &workspace_id,\n+            &workspace_path,\n+        )\n+        .await\n+        {\n+            let _ = workspace_event_tx.send(MuxEvent::Error(format!(\n+                \"Failed to upload workspace: {}\",\n+                error\n+            )));\n+        } else {\n+            let _ = workspace_event_tx.send(MuxEvent::StatusMessage {\n+                message: format!(\"✓ {} uploaded\", workspace_dir_name),\n+            });\n+        }\n+    });\n+\n+    // Spawn sync files upload task separately\n+    let sync_client = client.clone();\n+    let sync_base = trimmed_base.clone();\n+    let sync_id = sandbox_id.clone();\n+    let sync_event_tx = event_tx.clone();\n+    tokio::spawn(async move {\n+        let sync_files = detect_sync_files();\n+        if !sync_files.is_empty() {\n+            if let Err(error) =\n+                upload_sync_files_with_list(&sync_client, &sync_base, &sync_id, sync_files, false)\n+                    .await\n+            {\n+                let _ =\n+                    sync_event_tx.send(MuxEvent::Error(format!(\"Failed to sync files: {}\", error)));\n+            }\n+        }\n+    });\n+\n     Ok(())\n }\n \ndiff --git a/packages/sandbox/src/sync_files.rs b/packages/sandbox/src/sync_files.rs\nindex f0bd7566f..e09fd4f67 100644\n--- a/packages/sandbox/src/sync_files.rs\n+++ b/packages/sandbox/src/sync_files.rs\n@@ -400,3 +400,155 @@ impl std::io::Write for ChunkedWriter {\n         Ok(())\n     }\n }\n+\n+/// Pre-build the sync files tar archive into a buffer.\n+/// This can be called before sandbox creation to overlap CPU work with network I/O.\n+pub fn prebuild_sync_files_tar() -> Option<Vec<u8>> {\n+    let files_to_upload = detect_sync_files();\n+    if files_to_upload.is_empty() {\n+        return None;\n+    }\n+\n+    let mut buffer = Vec::new();\n+    {\n+        let mut tar = Builder::new(&mut buffer);\n+        let temp_dir_name = \"__cmux_sync_temp\";\n+\n+        fn ensure_codex_notify(content: &str) -> String {\n+            let has_notify = content\n+                .lines()\n+                .any(|line| line.trim_start().starts_with(\"notify\"));\n+            if has_notify {\n+                return content.to_string();\n+            }\n+\n+            let notify_block = r#\"notify = [\n+  \"sh\",\n+  \"-c\",\n+  \"echo \\\"$1\\\" | jq -r '.[\\\"last-assistant-message\\\"] // \\\"Awaiting input\\\"' | xargs -I{} cmux-bridge notify \\\"Codex: {}\\\"\",\n+  \"--\",\n+]\n+\n+\"#;\n+            format!(\"{notify_block}{content}\")\n+        }\n+\n+        for SyncFileToUpload {\n+            host_path,\n+            sandbox_path: sandbox_path_str,\n+            is_dir,\n+        } in files_to_upload\n+        {\n+            let sandbox_path = Path::new(sandbox_path_str);\n+            let rel_sandbox_path = sandbox_path.strip_prefix(\"/\").unwrap_or(sandbox_path);\n+            let tar_path = Path::new(temp_dir_name).join(rel_sandbox_path);\n+\n+            let result: io::Result<()> = if is_dir {\n+                tar.append_dir_all(&tar_path, &host_path)\n+            } else if sandbox_path_str == \"/root/.codex/config.toml\" {\n+                match fs::read_to_string(&host_path) {\n+                    Ok(raw) => {\n+                        let merged = ensure_codex_notify(&raw);\n+                        let bytes = merged.as_bytes();\n+                        let mut header = Header::new_gnu();\n+                        if header.set_path(&tar_path).is_err() {\n+                            return None;\n+                        }\n+                        header.set_size(bytes.len() as u64);\n+                        header.set_mode(0o644);\n+                        let mtime = SystemTime::now()\n+                            .duration_since(UNIX_EPOCH)\n+                            .unwrap_or_default()\n+                            .as_secs();\n+                        header.set_mtime(mtime);\n+                        header.set_cksum();\n+                        tar.append_data(&mut header, &tar_path, bytes)\n+                    }\n+                    Err(e) => Err(e),\n+                }\n+            } else {\n+                tar.append_path_with_name(&host_path, &tar_path)\n+            };\n+\n+            if result.is_err() {\n+                return None;\n+            }\n+        }\n+\n+        if tar.finish().is_err() {\n+            return None;\n+        }\n+    }\n+\n+    Some(buffer)\n+}\n+\n+/// Upload pre-built sync files tar and execute the move script.\n+pub async fn upload_prebuilt_sync_files(\n+    client: &Client,\n+    base_url: &str,\n+    id: &str,\n+    tar_data: Vec<u8>,\n+    log_progress: bool,\n+) -> anyhow::Result<()> {\n+    if log_progress {\n+        eprintln!(\"Syncing auth files...\");\n+    }\n+\n+    let url = format!(\"{}/sandboxes/{}/files\", base_url.trim_end_matches('/'), id);\n+    let response = client.post(url).body(tar_data).send().await?;\n+    if !response.status().is_success() {\n+        return Err(anyhow!(\n+            \"Failed to upload sync files: {}\",\n+            response.status()\n+        ));\n+    }\n+\n+    let move_script = r#\"\n+        if [ -d /workspace/__cmux_sync_temp ]; then\n+            cp -r /workspace/__cmux_sync_temp/root/. /root/ 2>/dev/null || true\n+            git config --global --add safe.directory /workspace || true\n+            rm -rf /workspace/__cmux_sync_temp\n+            # Fix SSH permissions (SSH is picky about this)\n+            if [ -d /root/.ssh ]; then\n+                chmod 700 /root/.ssh\n+                chmod 600 /root/.ssh/* 2>/dev/null || true\n+                chmod 644 /root/.ssh/*.pub 2>/dev/null || true\n+                chmod 644 /root/.ssh/known_hosts 2>/dev/null || true\n+                chmod 644 /root/.ssh/config 2>/dev/null || true\n+                # Create authorized_keys from user's public keys for SSH access\n+                cat /root/.ssh/*.pub > /root/.ssh/authorized_keys 2>/dev/null || true\n+                chmod 600 /root/.ssh/authorized_keys 2>/dev/null || true\n+            fi\n+        fi\n+        # Add container's SSH key to authorized_keys for dmux ssh command\n+        # This key is generated in the Docker image and allows the container to SSH into sandboxes\n+        CONTAINER_KEY_FILE=\"/usr/share/cmux/container-ssh.pub\"\n+        if [ -f \"$CONTAINER_KEY_FILE\" ]; then\n+            mkdir -p /root/.ssh\n+            cat \"$CONTAINER_KEY_FILE\" >> /root/.ssh/authorized_keys 2>/dev/null || true\n+            chmod 600 /root/.ssh/authorized_keys 2>/dev/null || true\n+        fi\n+        # Start sshd for SSH access to sandbox\n+        mkdir -p /run/sshd\n+        /usr/sbin/sshd 2>/dev/null || true\n+    \"#;\n+\n+    let exec_body = ExecRequest {\n+        command: vec![\"/bin/sh\".into(), \"-c\".into(), move_script.into()],\n+        workdir: None,\n+        env: Vec::new(),\n+    };\n+\n+    let exec_url = format!(\"{}/sandboxes/{}/exec\", base_url.trim_end_matches('/'), id);\n+    let exec_response = client.post(exec_url).json(&exec_body).send().await?;\n+\n+    if !exec_response.status().is_success() {\n+        return Err(anyhow!(\n+            \"Failed to execute move script: {}\",\n+            exec_response.status()\n+        ));\n+    }\n+\n+    Ok(())\n+}\ndiff --git a/packages/sandbox/src/timing.rs b/packages/sandbox/src/timing.rs\nnew file mode 100644\nindex 000000000..15f76b307\n--- /dev/null\n+++ b/packages/sandbox/src/timing.rs\n@@ -0,0 +1,240 @@\n+//! Timing instrumentation for sandbox creation performance analysis.\n+//!\n+//! Enable timing with the `CMUX_TIMING=1` environment variable or `--timing` flag.\n+//! Timing results are logged to `/var/log/cmux/timing.log`.\n+\n+use std::collections::BTreeMap;\n+use std::fs::OpenOptions;\n+use std::io::Write;\n+use std::path::Path;\n+use std::sync::atomic::{AtomicBool, Ordering};\n+use std::sync::OnceLock;\n+use std::time::{Duration, Instant};\n+\n+use chrono::Utc;\n+\n+/// Global flag for whether timing is enabled.\n+static TIMING_ENABLED: AtomicBool = AtomicBool::new(false);\n+\n+/// Log file path.\n+static LOG_PATH: OnceLock<String> = OnceLock::new();\n+\n+/// Enable timing instrumentation.\n+pub fn enable_timing() {\n+    TIMING_ENABLED.store(true, Ordering::SeqCst);\n+}\n+\n+/// Check if timing is enabled.\n+pub fn is_timing_enabled() -> bool {\n+    TIMING_ENABLED.load(Ordering::SeqCst)\n+}\n+\n+/// Set the timing log file path.\n+pub fn set_log_path(path: &str) {\n+    let _ = LOG_PATH.set(path.to_string());\n+}\n+\n+/// Get the timing log file path.\n+fn get_log_path() -> &'static str {\n+    LOG_PATH.get_or_init(|| \"/var/log/cmux/timing.log\".to_string())\n+}\n+\n+/// A scope-based timer that measures elapsed time.\n+pub struct Timer {\n+    #[allow(dead_code)]\n+    name: &'static str,\n+    start: Instant,\n+    enabled: bool,\n+}\n+\n+impl Timer {\n+    /// Create a new timer with the given name.\n+    /// Does nothing if timing is disabled.\n+    pub fn new(name: &'static str) -> Self {\n+        Self {\n+            name,\n+            start: Instant::now(),\n+            enabled: is_timing_enabled(),\n+        }\n+    }\n+\n+    /// Get the elapsed time since the timer was created.\n+    pub fn elapsed(&self) -> Duration {\n+        self.start.elapsed()\n+    }\n+\n+    /// Get the elapsed time in milliseconds.\n+    pub fn elapsed_ms(&self) -> f64 {\n+        self.elapsed().as_secs_f64() * 1000.0\n+    }\n+\n+    /// Finish the timer and return the elapsed duration.\n+    pub fn finish(self) -> Duration {\n+        self.elapsed()\n+    }\n+\n+    /// Check if timing is enabled for this timer.\n+    pub fn is_enabled(&self) -> bool {\n+        self.enabled\n+    }\n+}\n+\n+/// A report collecting multiple timing measurements.\n+pub struct TimingReport {\n+    operation: String,\n+    sandbox_id: String,\n+    start: Instant,\n+    phases: BTreeMap<String, Duration>,\n+    enabled: bool,\n+}\n+\n+impl TimingReport {\n+    /// Create a new timing report for an operation.\n+    pub fn new(operation: &str, sandbox_id: &str) -> Self {\n+        Self {\n+            operation: operation.to_string(),\n+            sandbox_id: sandbox_id.to_string(),\n+            start: Instant::now(),\n+            phases: BTreeMap::new(),\n+            enabled: is_timing_enabled(),\n+        }\n+    }\n+\n+    /// Record a phase timing.\n+    pub fn record(&mut self, phase: &str, duration: Duration) {\n+        if self.enabled {\n+            self.phases.insert(phase.to_string(), duration);\n+        }\n+    }\n+\n+    /// Record a phase from a Timer.\n+    pub fn record_timer(&mut self, phase: &str, timer: Timer) {\n+        self.record(phase, timer.finish());\n+    }\n+\n+    /// Get total elapsed time.\n+    pub fn total_elapsed(&self) -> Duration {\n+        self.start.elapsed()\n+    }\n+\n+    /// Finish and write the report to the log file.\n+    pub fn finish(mut self) {\n+        if !self.enabled {\n+            return;\n+        }\n+\n+        let total = self.start.elapsed();\n+        self.phases.insert(\"total\".to_string(), total);\n+\n+        // Format the report\n+        let timestamp = Utc::now().format(\"%Y-%m-%d %H:%M:%S%.3f\");\n+        let mut output = format!(\n+            \"[{}] {} sandbox={} total={:.2}ms\\n\",\n+            timestamp,\n+            self.operation,\n+            self.sandbox_id,\n+            total.as_secs_f64() * 1000.0\n+        );\n+\n+        // Sort phases by duration (descending) for easy identification of slow phases\n+        let mut phases: Vec<_> = self.phases.iter().collect();\n+        phases.sort_by(|a, b| b.1.cmp(a.1));\n+\n+        for (phase, duration) in phases {\n+            if phase != \"total\" {\n+                let pct = if total.as_nanos() > 0 {\n+                    (duration.as_nanos() as f64 / total.as_nanos() as f64) * 100.0\n+                } else {\n+                    0.0\n+                };\n+                output.push_str(&format!(\n+                    \"  {:40} {:>8.2}ms ({:>5.1}%)\\n\",\n+                    phase,\n+                    duration.as_secs_f64() * 1000.0,\n+                    pct\n+                ));\n+            }\n+        }\n+        output.push('\\n');\n+\n+        // Write to log file\n+        if let Err(e) = write_to_log(&output) {\n+            eprintln!(\"Failed to write timing log: {e}\");\n+        }\n+\n+        // Also log to tracing at debug level\n+        tracing::debug!(\"{}\", output.trim());\n+    }\n+}\n+\n+/// Write content to the timing log file.\n+fn write_to_log(content: &str) -> std::io::Result<()> {\n+    let log_path = get_log_path();\n+\n+    // Ensure parent directory exists\n+    if let Some(parent) = Path::new(log_path).parent() {\n+        std::fs::create_dir_all(parent)?;\n+    }\n+\n+    let mut file = OpenOptions::new()\n+        .create(true)\n+        .append(true)\n+        .open(log_path)?;\n+\n+    file.write_all(content.as_bytes())?;\n+    Ok(())\n+}\n+\n+/// Macro to time a block of code and record it in a timing report.\n+#[macro_export]\n+macro_rules! time_phase {\n+    ($report:expr, $name:expr, $block:expr) => {{\n+        let timer = $crate::timing::Timer::new($name);\n+        let result = $block;\n+        $report.record_timer($name, timer);\n+        result\n+    }};\n+}\n+\n+/// Macro to time an async block of code and record it in a timing report.\n+#[macro_export]\n+macro_rules! time_phase_async {\n+    ($report:expr, $name:expr, $block:expr) => {{\n+        let timer = $crate::timing::Timer::new($name);\n+        let result = $block.await;\n+        $report.record_timer($name, timer);\n+        result\n+    }};\n+}\n+\n+#[cfg(test)]\n+mod tests {\n+    use super::*;\n+    use std::thread::sleep;\n+\n+    #[test]\n+    fn timer_measures_elapsed_time() {\n+        let timer = Timer::new(\"test\");\n+        sleep(Duration::from_millis(10));\n+        let elapsed = timer.finish();\n+        assert!(elapsed >= Duration::from_millis(10));\n+    }\n+\n+    #[test]\n+    fn timing_report_collects_phases() {\n+        enable_timing();\n+        let mut report = TimingReport::new(\"test_op\", \"test-id\");\n+\n+        let timer1 = Timer::new(\"phase1\");\n+        sleep(Duration::from_millis(5));\n+        report.record_timer(\"phase1\", timer1);\n+\n+        let timer2 = Timer::new(\"phase2\");\n+        sleep(Duration::from_millis(5));\n+        report.record_timer(\"phase2\", timer2);\n+\n+        assert_eq!(report.phases.len(), 2);\n+        assert!(report.phases.contains_key(\"phase1\"));\n+        assert!(report.phases.contains_key(\"phase2\"));\n+    }\n+}\n","comments":[{"type":"issue_comment","id":3616549461,"prNumber":1193,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn74vath1e6ftxdbmwfhts11tx7wpg9k?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn74vath1e6ftxdbmwfhts11tx7wpg9k/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1193?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"a2c108799f87f37390d00e76cd135d6d6d98d1d4","createdAt":"2025-12-05T11:42:38Z","updatedAt":"2025-12-05T11:42:38Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1193#issuecomment-3616549461"},{"type":"issue_comment","id":3616559483,"prNumber":1193,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7ddr66zbj2ytr31qvxmjp2557wp3yz?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7ddr66zbj2ytr31qvxmjp2557wp3yz/run/kd75vp9sxyjcadk0h0dp06wyx17wp16w/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1193?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 7 screenshots for commit `a712430` (2025-12-05 11:45:54.530 UTC).\n\n**Full dashboard view showing task list, sidebar with pull requests and preview items**\n\n![dashboard-full-view-optimize-sandbox-spawn-rust-0.png](https://adorable-wombat-701.convex.cloud/api/storage/7961cf59-ca0d-4940-9f01-5f401bdc9732)\n\n**Diff content view showing code changes with expandable regions and file tree**\n\n![diff-content-optimize-sandbox-spawn-rust-0.png](https://adorable-wombat-701.convex.cloud/api/storage/18381924-1d3e-49e9-9fc3-34e9baba0d05)\n\n**PR detail page showing CI check statuses \\(2 failed, multiple passed\\) and beginning of diff view**\n\n![pr-checks-and-diff-view-optimize-sandbox-spawn-rust-0.png](https://adorable-wombat-701.convex.cloud/api/storage/5db8bfdb-04f1-4ea2-9e3c-def025a947d7)\n\n**Task detail view for the optimize-sandbox-spawn-rust-0 PR showing header and loading state**\n\n![task-detail-view-optimize-sandbox-spawn-rust-0.png](https://adorable-wombat-701.convex.cloud/api/storage/6ecf9694-f4cb-4181-a85e-32dedaae2a44)\n\n**Task input textbox area at the top of the dashboard**\n\n![task-input-area-optimize-sandbox-spawn-rust-0.png](https://adorable-wombat-701.convex.cloud/api/storage/c6face0e-67fc-4c1c-9040-d7fd799fec8d)\n\n**Task tree sidebar navigation showing PR items and workspace organization**\n\n![task-tree-sidebar-optimize-sandbox-spawn-rust-0.png](https://adorable-wombat-701.convex.cloud/api/storage/d3fef5d7-1ea1-4509-bc47-577165ab7a2a)\n\n**Task tree sidebar with optimize-sandbox-spawn-rust-0 PR selected, showing GitHub link**\n\n![task-tree-with-selected-item-optimize-sandbox-spawn-rust-0.png](https://adorable-wombat-701.convex.cloud/api/storage/c1397ec5-faf4-4188-9120-8d3ecfc957b2)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"a2c108799f87f37390d00e76cd135d6d6d98d1d4","createdAt":"2025-12-05T11:45:55Z","updatedAt":"2025-12-05T11:45:55Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1193#issuecomment-3616559483"}]}
{"number":1192,"title":"sentry hono config","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1192","headRef":"sentry-hono-config-0","headSha":"5f9f8ef609cca4a260f396cb1f48f6e6fbf7d06e","baseRef":"main","baseSha":"1e61f57f833bd52d4707544fda2b352a8d3194fe","createdAt":"2025-12-05T11:34:27Z","updatedAt":"2025-12-05T11:47:09Z","diff":"diff --git a/apps/www/sentry.server.config.ts b/apps/www/sentry.server.config.ts\nindex b6f3b2b0a..c7586107e 100644\n--- a/apps/www/sentry.server.config.ts\n+++ b/apps/www/sentry.server.config.ts\n@@ -21,4 +21,29 @@ Sentry.init({\n   // Enable sending user PII (Personally Identifiable Information)\n   // https://docs.sentry.io/platforms/javascript/guides/nextjs/configuration/options/#sendDefaultPii\n   sendDefaultPii: true,\n+\n+  beforeSendTransaction(event) {\n+    const name = event.transaction;\n+    if (!name) {\n+      return event;\n+    }\n+    const isCatchAllApi =\n+      name.includes(\"/api/[[...route]]\") || name.endsWith(\" /api/[[...route]]\");\n+    if (!isCatchAllApi) {\n+      return event;\n+    }\n+    const url = event.request?.url;\n+    if (!url) {\n+      return event;\n+    }\n+    try {\n+      const { pathname } = new URL(url);\n+      const methodFromName = name.split(\" \")[0] || \"UNKNOWN\";\n+      const method = methodFromName.toUpperCase();\n+      event.transaction = `${method} ${pathname}`;\n+    } catch {\n+      // If URL parsing fails for some reason, keep the original transaction name.\n+    }\n+    return event;\n+  },\n });\n","comments":[{"type":"issue_comment","id":3616533127,"prNumber":1192,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7ebwq7q65qyab4q83ejszkmx7wqfbh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7ebwq7q65qyab4q83ejszkmx7wqfbh/run/kd70fve37v0tmp66w0d2raa2f57wq2ty/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1192?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"5f9f8ef609cca4a260f396cb1f48f6e6fbf7d06e","createdAt":"2025-12-05T11:37:02Z","updatedAt":"2025-12-05T11:38:08Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1192#issuecomment-3616533127"},{"type":"issue_comment","id":3616536363,"prNumber":1192,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn7c4ftzrp92k84xkfp4q68qgs7wpaqy?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn7c4ftzrp92k84xkfp4q68qgs7wpaqy/run/kd74jzdxywjax50gzzz05dzzh17wpc70/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1192?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 6 screenshots for commit `ef217ac` (2025-12-05 11:38:06.808 UTC).\n\n**Full-page screenshot of the dashboard view showing the task list sidebar with pull requests, workspaces, and preview items**\n\n![dashboard-full-page-sentry-hono-config-0.png](https://famous-camel-162.convex.cloud/api/storage/ca9558d1-accf-474a-be76-fc645473292a)\n\n**Screenshot of the diff file item button showing 'apps/www/sentry.server.config.ts +25 −0' with change indicators**\n\n![diff-file-item-sentry-hono-config-0.png](https://famous-camel-162.convex.cloud/api/storage/51a209b3-63f7-4d0a-97f6-49522313e90b)\n\n**Screenshot of the sidebar navigation showing the list of pull request tasks and GitHub integration**\n\n![sidebar-navigation-sentry-hono-config-0.png](https://famous-camel-162.convex.cloud/api/storage/4fdf4d74-c2b8-4640-a3bc-e8be2eea6636)\n\n**Full-page screenshot of the task detail page for PR \\#1192 \\(sentry hono config\\) showing the diff viewer with the sentry.server.config.ts file changes**\n\n![task-detail-full-page-sentry-hono-config-0.png](https://famous-camel-162.convex.cloud/api/storage/5c844976-2cf9-421d-b562-01bf3959576f)\n\n**Viewport screenshot of the task detail page showing the PR header, merge status, and diff content area**\n\n![task-detail-viewport-sentry-hono-config-0.png](https://famous-camel-162.convex.cloud/api/storage/e6b71178-d9af-45f5-9b85-54203cea986d)\n\n**Screenshot of a hovered task item in the sidebar showing the task title and GitHub PR information**\n\n![task-item-hover-sentry-hono-config-0.png](https://famous-camel-162.convex.cloud/api/storage/bbf60552-902f-48f1-b097-7f38a95b8263)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"5f9f8ef609cca4a260f396cb1f48f6e6fbf7d06e","createdAt":"2025-12-05T11:38:07Z","updatedAt":"2025-12-05T11:38:07Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1192#issuecomment-3616536363"}]}
{"number":1190,"title":"fix: prevent duplicate task run creation by reusing existing pending runs","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1190","headRef":"optimize-task-run-creation-bug-0","headSha":"f600498db8c9262e9c93e15a54c09d8d14cd1547","baseRef":"main","baseSha":"3cf7bbb56bb3d6a9caa2280831c8d066c7d007b3","createdAt":"2025-12-05T10:01:20Z","updatedAt":"2025-12-05T10:41:55Z","diff":"diff --git a/apps/client/src/components/TaskTree.tsx b/apps/client/src/components/TaskTree.tsx\nindex 8f7864eec..5ebac63b7 100644\n--- a/apps/client/src/components/TaskTree.tsx\n+++ b/apps/client/src/components/TaskTree.tsx\n@@ -115,14 +115,15 @@ function sanitizeBranchName(input?: string | null): string | null {\n   const trimmed = input.trim();\n   if (!trimmed) return null;\n   let normalized = trimmed;\n+  // Strip \"cmux/\" prefix for display\n   if (normalized.startsWith(\"cmux/\")) {\n     normalized = normalized.slice(\"cmux/\".length).trim();\n     if (!normalized) return null;\n   }\n-  const idx = normalized.lastIndexOf(\"-\");\n-  if (idx <= 0) return normalized;\n-  const candidate = normalized.slice(0, idx);\n-  return candidate || normalized;\n+  // Note: Don't strip the suffix here - generatedBranchName already has it stripped by the backend\n+  // (deriveGeneratedBranchName in taskRuns.ts). Only strip for raw branch names that still have\n+  // the random suffix (e.g., baseBranch which may be \"cmux/fix-bug-abc12\").\n+  return normalized;\n }\n \n function getTaskBranch(task: TaskWithGeneratedBranch): string | null {\n@@ -805,10 +806,6 @@ function TaskTreeInner({\n       }\n     }\n \n-    if (isLocalWorkspace || isCloudWorkspace) {\n-      return null;\n-    }\n-\n     return task.isCompleted ? (\n       <CheckCircle className=\"w-3 h-3 text-green-500\" />\n     ) : (\ndiff --git a/apps/client/src/routes/_layout.$teamSlugOrId.dashboard.tsx b/apps/client/src/routes/_layout.$teamSlugOrId.dashboard.tsx\nindex 62e84c53f..966ac244d 100644\n--- a/apps/client/src/routes/_layout.$teamSlugOrId.dashboard.tsx\n+++ b/apps/client/src/routes/_layout.$teamSlugOrId.dashboard.tsx\n@@ -549,6 +549,8 @@ function DashboardComponent() {\n         selectedAgents.length > 0 ? selectedAgents : DEFAULT_AGENTS;\n \n       // Create task in Convex with storage IDs and task runs atomically\n+      // Note: isCloudWorkspace is NOT set here - that's only for standalone workspaces without agents.\n+      // isCloudMode (passed to socket) determines whether agents run in cloud vs local Docker.\n       const { taskId, taskRunIds } = await createTask({\n         teamSlugOrId,\n         text: content?.text || taskDescription, // Use content.text which includes image references\n@@ -556,7 +558,6 @@ function DashboardComponent() {\n         baseBranch: envSelected ? undefined : branch,\n         images: uploadedImages.length > 0 ? uploadedImages : undefined,\n         environmentId,\n-        isCloudWorkspace: envSelected ? true : isCloudMode,\n         selectedAgents: agentsToSpawn,\n       });\n \n","comments":[{"type":"issue_comment","id":3616164499,"prNumber":1190,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn70dstfhrrkbecmm5a411msjn7wptx8?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn70dstfhrrkbecmm5a411msjn7wptx8/run/kd734k2q5pc3k8c6ymedxe7c0s7wq5n9/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1190?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"f600498db8c9262e9c93e15a54c09d8d14cd1547","createdAt":"2025-12-05T10:06:53Z","updatedAt":"2025-12-05T10:07:28Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1190#issuecomment-3616164499"},{"type":"issue_comment","id":3616166751,"prNumber":1190,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn75xy6rj9j9jarvxck0mejvqh7wpx47?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn75xy6rj9j9jarvxck0mejvqh7wpx47/run/kd71bb5kmv4ee215a3ejv251dh7wqt0c/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1190?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"f600498db8c9262e9c93e15a54c09d8d14cd1547","createdAt":"2025-12-05T10:07:27Z","updatedAt":"2025-12-05T10:18:53Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1190#issuecomment-3616166751"},{"type":"issue_comment","id":3616211645,"prNumber":1190,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn700cspj1y8gy7877jvnadwj57wpc5s?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn700cspj1y8gy7877jvnadwj57wpc5s/run/kd72hbsrppenj6kftqj23v7qqs7wqgfn/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1190?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 5 screenshots for commit `9224016` (2025-12-05 10:18:51.284 UTC).\n\n**Close-up of sidebar navigation showing cloud workspace task run with status icon**\n\n![sidebar-closeup-cloud-workspace-run-optimize-task-run-creation-bug-0.png](https://adorable-wombat-701.convex.cloud/api/storage/781cf229-8fce-413f-b108-971456794a63)\n\n**Sidebar showing local workspace task expanded with task runs**\n\n![sidebar-local-workspace-expanded-optimize-task-run-creation-bug-0.png](https://adorable-wombat-701.convex.cloud/api/storage/61edc86e-d746-44e2-8336-aab5df223718)\n\n**Full page view showing local workspace expanded with VS Code link**\n\n![sidebar-local-workspace-with-vscode-optimize-task-run-creation-bug-0.png](https://adorable-wombat-701.convex.cloud/api/storage/b05ad21c-f475-49b1-8651-75d7bc81b9a4)\n\n**Full page view showing PR task expanded in sidebar**\n\n![sidebar-pr-task-expanded-optimize-task-run-creation-bug-0.png](https://adorable-wombat-701.convex.cloud/api/storage/317aa6b3-9f8a-4dc1-8899-5ceccd00da84)\n\n**Full page view showing preview screenshot task with cloud workspace run expanded**\n\n![sidebar-preview-task-expanded-with-cloud-run-optimize-task-run-creation-bug-0.png](https://adorable-wombat-701.convex.cloud/api/storage/0b20d84d-fab4-480c-8626-4f02bc63f651)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"f600498db8c9262e9c93e15a54c09d8d14cd1547","createdAt":"2025-12-05T10:18:52Z","updatedAt":"2025-12-05T10:23:24Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1190#issuecomment-3616211645"},{"type":"issue_comment","id":3616229075,"prNumber":1190,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn73a8h2r6wd3s53rwstbh2gr97wqh5b?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn73a8h2r6wd3s53rwstbh2gr97wqh5b/run/kd7etky33b72pcx89d252584s97wqct2/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1190?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 6 screenshots for commit `6d071de` (2025-12-05 10:23:20.940 UTC).\n\n**Full dashboard page showing task input area and workspace sections**\n\n![dashboard-full-page.png](https://famous-camel-162.convex.cloud/api/storage/01e3b790-a759-4283-9992-29639cb40d30)\n\n**Dashboard view showing local workspace in the sidebar**\n\n![dashboard-with-local-workspace.png](https://famous-camel-162.convex.cloud/api/storage/955534c9-dace-4613-88f8-9d924ddcdff0)\n\n**Pull requests listing page showing all open PRs**\n\n![pull-requests-page.png](https://famous-camel-162.convex.cloud/api/storage/03b18b27-0639-4753-9094-a92306a4116a)\n\n**Sidebar showing expanded local workspace with VS Code link**\n\n![sidebar-local-workspace-expanded.png](https://famous-camel-162.convex.cloud/api/storage/c6555665-2f16-4793-8ca2-99046f0f5f10)\n\n**Sidebar with PR task expanded showing GitHub link**\n\n![sidebar-pr-task-with-github-link.png](https://famous-camel-162.convex.cloud/api/storage/b9db04d6-7c4c-4284-b4f1-8823c34385a5)\n\n**Close-up of workspace section showing local workspace task entry**\n\n![workspace-section-closeup.png](https://famous-camel-162.convex.cloud/api/storage/6650c4b4-0214-4a0c-a849-257421024dc8)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"f600498db8c9262e9c93e15a54c09d8d14cd1547","createdAt":"2025-12-05T10:23:23Z","updatedAt":"2025-12-05T10:24:08Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1190#issuecomment-3616229075"},{"type":"issue_comment","id":3616231728,"prNumber":1190,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn778tv6v2yknvsw7r6zef5nn97wp8ch?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn778tv6v2yknvsw7r6zef5nn97wp8ch/run/kd73nk79dp9e8zm4xxnfb812cd7wpjks/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1190?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"f600498db8c9262e9c93e15a54c09d8d14cd1547","createdAt":"2025-12-05T10:24:07Z","updatedAt":"2025-12-05T10:37:36Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1190#issuecomment-3616231728"},{"type":"issue_comment","id":3616288204,"prNumber":1190,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7a72secb8cd6hhby7470nev97wpqnf?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7a72secb8cd6hhby7470nev97wpqnf/run/kd783hmryzw81t3p2d7kv931es7wqjd1/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1190?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"f600498db8c9262e9c93e15a54c09d8d14cd1547","createdAt":"2025-12-05T10:37:35Z","updatedAt":"2025-12-05T10:37:36Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1190#issuecomment-3616288204"},{"type":"issue_comment","id":3616288250,"prNumber":1190,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn76w7m59wcfd8hwqbjswvx8017wq9a0?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn76w7m59wcfd8hwqbjswvx8017wq9a0/run/kd76nn62t52p0q4b0nfd6ddtys7wpyrr/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1190?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"f600498db8c9262e9c93e15a54c09d8d14cd1547","createdAt":"2025-12-05T10:37:35Z","updatedAt":"2025-12-05T10:37:35Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1190#issuecomment-3616288250"}]}
{"number":1189,"title":"Optimize task run creation","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1189","headRef":"optimize-task-run-creation","headSha":"63d954d191c23c9e509ecc3b2db62d3abf905cce","baseRef":"main","baseSha":"e24fa562696173581533d463caf06a1f161b1d3f","createdAt":"2025-12-05T08:20:25Z","updatedAt":"2025-12-05T09:40:42Z","diff":"diff --git a/apps/client/src/components/CommandBar.tsx b/apps/client/src/components/CommandBar.tsx\nindex aac0bc232..8162f2f23 100644\n--- a/apps/client/src/components/CommandBar.tsx\n+++ b/apps/client/src/components/CommandBar.tsx\n@@ -877,7 +877,7 @@ export function CommandBar({\n         const environmentName = environment?.name ?? \"Unknown Environment\";\n \n         // Create task in Convex without task description (it's just a workspace)\n-        const taskId = await createTask({\n+        const { taskId } = await createTask({\n           teamSlugOrId,\n           text: `Cloud Workspace: ${environmentName}`,\n           projectFullName: undefined, // No repo for cloud environment workspaces\n@@ -957,7 +957,7 @@ export function CommandBar({\n         const repoUrl = `https://github.com/${projectFullName}.git`;\n \n         // Create task in Convex for repo-based cloud workspace\n-        const taskId = await createTask({\n+        const { taskId } = await createTask({\n           teamSlugOrId,\n           text: `Cloud Workspace: ${projectFullName}`,\n           projectFullName,\ndiff --git a/apps/client/src/components/TaskRunTerminalPane.tsx b/apps/client/src/components/TaskRunTerminalPane.tsx\nindex 3a4130407..8e9d5b963 100644\n--- a/apps/client/src/components/TaskRunTerminalPane.tsx\n+++ b/apps/client/src/components/TaskRunTerminalPane.tsx\n@@ -1,7 +1,7 @@\n import { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\n-import { MonitorUp } from \"lucide-react\";\n import { useQuery, useQueryClient } from \"@tanstack/react-query\";\n import { TaskRunTerminalSession } from \"./task-run-terminal-session\";\n+import { WorkspaceLoadingIndicator } from \"./workspace-loading-indicator\";\n import { toMorphXtermBaseUrl } from \"@/lib/toProxyWorkspaceUrl\";\n import {\n   createTerminalTab,\n@@ -202,58 +202,66 @@ export function TaskRunTerminalPane({ workspaceUrl }: TaskRunTerminalPaneProps)\n \n   if (!workspaceUrl || !baseUrl) {\n     return (\n-      <div className=\"flex h-full flex-col items-center justify-center gap-2 text-sm text-neutral-500 dark:text-neutral-400\">\n-        <MonitorUp className=\"size-4 animate-pulse\" aria-hidden />\n-        <span>Terminal is starting...</span>\n+      <div className=\"flex h-full items-center justify-center\">\n+        <WorkspaceLoadingIndicator variant=\"terminal\" status=\"loading\" />\n       </div>\n     );\n   }\n \n   if (isTabsLoading) {\n     return (\n-      <div className=\"flex h-full flex-col items-center justify-center gap-2 text-sm text-neutral-500 dark:text-neutral-400\">\n-        <MonitorUp className=\"size-4 animate-pulse\" aria-hidden />\n-        <span>Loading terminal...</span>\n+      <div className=\"flex h-full items-center justify-center\">\n+        <WorkspaceLoadingIndicator\n+          variant=\"terminal\"\n+          status=\"loading\"\n+          loadingTitle=\"Loading terminal\"\n+          loadingDescription=\"Fetching terminal sessions...\"\n+        />\n       </div>\n     );\n   }\n \n   if (isTabsError) {\n     return (\n-      <div className=\"flex h-full flex-col items-center justify-center gap-2 text-sm text-neutral-500 dark:text-neutral-400\">\n-        <MonitorUp className=\"size-4 text-red-500\" aria-hidden />\n-        <span className=\"text-red-500 dark:text-red-400\">\n-          {tabsError instanceof Error ? tabsError.message : \"Failed to load terminal\"}\n-        </span>\n+      <div className=\"flex h-full items-center justify-center\">\n+        <WorkspaceLoadingIndicator\n+          variant=\"terminal\"\n+          status=\"error\"\n+          errorDescription={\n+            tabsError instanceof Error ? tabsError.message : undefined\n+          }\n+        />\n       </div>\n     );\n   }\n \n   if (terminalIds.length === 0) {\n+    const retryButton = autoCreateError ? (\n+      <button\n+        type=\"button\"\n+        onClick={handleManualRetry}\n+        className=\"inline-flex items-center justify-center rounded border border-neutral-300 px-3 py-1 text-xs font-medium text-neutral-600 transition hover:border-neutral-400 hover:text-neutral-800 dark:border-neutral-700 dark:text-neutral-300 dark:hover:border-neutral-500 dark:hover:text-neutral-100\"\n+      >\n+        Retry terminal\n+      </button>\n+    ) : null;\n+\n+    const attemptInfo =\n+      !autoCreateError && autoCreateAttemptCount > 0\n+        ? `Attempt ${Math.min(autoCreateAttemptCount, MAX_AUTO_CREATE_ATTEMPTS)} of ${MAX_AUTO_CREATE_ATTEMPTS}`\n+        : undefined;\n+\n     return (\n-      <div className=\"flex h-full flex-col items-center justify-center gap-3 text-center text-sm text-neutral-500 dark:text-neutral-400\">\n-        <MonitorUp className=\"size-4 animate-pulse\" aria-hidden />\n-        <div className=\"flex flex-col gap-1\">\n-          <span>\n-            {autoCreateError\n-              ? autoCreateError\n-              : \"Waiting for a terminal session...\"}\n-          </span>\n-          {!autoCreateError && autoCreateAttemptCount > 0 ? (\n-            <span className=\"text-xs text-neutral-400 dark:text-neutral-500\">\n-              {`Attempt ${Math.min(autoCreateAttemptCount, MAX_AUTO_CREATE_ATTEMPTS)} of ${MAX_AUTO_CREATE_ATTEMPTS}`}\n-            </span>\n-          ) : null}\n-        </div>\n-        {autoCreateError ? (\n-          <button\n-            type=\"button\"\n-            onClick={handleManualRetry}\n-            className=\"inline-flex items-center justify-center rounded border border-neutral-300 px-3 py-1 text-xs font-medium text-neutral-600 transition hover:border-neutral-400 hover:text-neutral-800 dark:border-neutral-700 dark:text-neutral-300 dark:hover:border-neutral-500 dark:hover:text-neutral-100\"\n-          >\n-            Retry terminal\n-          </button>\n-        ) : null}\n+      <div className=\"flex h-full items-center justify-center\">\n+        <WorkspaceLoadingIndicator\n+          variant=\"terminal\"\n+          status={autoCreateError ? \"error\" : \"loading\"}\n+          loadingTitle=\"Connecting to terminal\"\n+          loadingDescription={attemptInfo ?? \"Waiting for a terminal session...\"}\n+          errorTitle=\"Terminal connection failed\"\n+          errorDescription={autoCreateError ?? undefined}\n+          action={retryButton}\n+        />\n       </div>\n     );\n   }\ndiff --git a/apps/client/src/components/TaskTree.tsx b/apps/client/src/components/TaskTree.tsx\nindex 6e1b1360f..8f7864eec 100644\n--- a/apps/client/src/components/TaskTree.tsx\n+++ b/apps/client/src/components/TaskTree.tsx\n@@ -145,21 +145,31 @@ interface SidebarArchiveOverlayProps {\n   icon: ReactNode;\n   label: string;\n   onArchive: () => void;\n+  groupName: \"task\" | \"run\";\n }\n \n function SidebarArchiveOverlay({\n   icon,\n   label,\n   onArchive,\n+  groupName,\n }: SidebarArchiveOverlayProps) {\n+  const hoverShow =\n+    groupName === \"task\"\n+      ? \"group-hover/task:opacity-100 group-hover/task:pointer-events-auto group-data-[focus-visible=true]/task:opacity-100 group-data-[focus-visible=true]/task:pointer-events-auto\"\n+      : \"group-hover/run:opacity-100 group-hover/run:pointer-events-auto group-data-[focus-visible=true]/run:opacity-100 group-data-[focus-visible=true]/run:pointer-events-auto\";\n+\n   return (\n-    <div className=\"relative flex h-4 w-4 items-center justify-center\">\n+    <div className=\"flex items-center gap-1\">\n       <Tooltip delayDuration={0}>\n         <TooltipTrigger asChild>\n           <button\n             type=\"button\"\n             aria-label={label}\n-            className=\"peer absolute inset-0 flex items-center justify-center rounded-sm text-neutral-500 hover:text-neutral-900 dark:text-neutral-400 dark:hover:text-neutral-50 opacity-0 pointer-events-none focus-visible:pointer-events-auto focus-visible:opacity-100 group-hover:opacity-100 group-hover:pointer-events-auto group-data-[focus-visible=true]:opacity-100 group-data-[focus-visible=true]:pointer-events-auto focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-neutral-400 dark:focus-visible:outline-neutral-500\"\n+            className={clsx(\n+              \"flex h-4 w-4 -mr-0.5 items-center justify-center rounded-sm text-neutral-500 hover:text-neutral-900 dark:text-neutral-400 dark:hover:text-neutral-50 opacity-0 pointer-events-none focus-visible:pointer-events-auto focus-visible:opacity-100 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-neutral-400 dark:focus-visible:outline-neutral-500\",\n+              hoverShow\n+            )}\n             onClick={(event) => {\n               event.preventDefault();\n               event.stopPropagation();\n@@ -171,9 +181,9 @@ function SidebarArchiveOverlay({\n         </TooltipTrigger>\n         <TooltipContent side=\"right\">{label}</TooltipContent>\n       </Tooltip>\n-      <div className=\"flex items-center justify-center group-hover:pointer-events-none group-hover:opacity-0 group-data-[focus-visible=true]:pointer-events-none group-data-[focus-visible=true]:opacity-0 peer-focus-visible:pointer-events-none peer-focus-visible:opacity-0\">\n-        {icon}\n-      </div>\n+      {icon ? (\n+        <div className=\"flex items-center justify-center\">{icon}</div>\n+      ) : null}\n     </div>\n   );\n }\n@@ -399,9 +409,11 @@ function TaskTreeInner({\n       return null;\n     }\n     // Find the first active run with a running VSCode instance\n-    return activeRunsFlat.find(\n-      (run) => run.vscode?.status === \"running\" && run.vscode?.url\n-    ) ?? null;\n+    return (\n+      activeRunsFlat.find(\n+        (run) => run.vscode?.status === \"running\" && run.vscode?.url\n+      ) ?? null\n+    );\n   }, [task.isLocalWorkspace, activeRunsFlat]);\n \n   const runMenuEntries = useMemo(\n@@ -813,6 +825,7 @@ function TaskTreeInner({\n       icon={taskLeadingIcon}\n       label=\"Archive\"\n       onArchive={handleArchive}\n+      groupName=\"task\"\n     />\n   ) : (\n     taskLeadingIcon\n@@ -830,7 +843,7 @@ function TaskTreeInner({\n               search={{ runId: undefined }}\n               activeOptions={{ exact: true }}\n               className={clsx(\n-                \"group block\",\n+                \"group/task block\",\n                 // For local workspaces, manually add active class since we navigate to VSCode sub-route\n                 localWorkspaceRunWithVscode && isTaskSelected && \"active\"\n               )}\n@@ -1394,16 +1407,6 @@ function TaskRunTreeInner({\n       isLocalWorkspaceRunEntry ||\n       isCloudWorkspaceRunEntry);\n \n-  const runMetaIcon = shouldShowRunArchiveOverlay ? (\n-    <SidebarArchiveOverlay\n-      icon={runLeadingIcon}\n-      label=\"Archive\"\n-      onArchive={handleArchiveRun}\n-    />\n-  ) : (\n-    runLeadingIcon\n-  );\n-\n   const crownIcon = run.isCrowned ? (\n     <Tooltip delayDuration={0}>\n       <TooltipTrigger asChild>\n@@ -1426,16 +1429,28 @@ function TaskRunTreeInner({\n     </Tooltip>\n   ) : null;\n \n-  const leadingContent = crownIcon ? (\n+  // Combine crown + status icon, with archive overlay on the left of everything\n+  const iconsContent = crownIcon ? (\n     <div className=\"flex items-center gap-1\">\n       {crownIcon}\n-      {runMetaIcon}\n+      {runLeadingIcon}\n     </div>\n   ) : (\n-    runMetaIcon\n+    runLeadingIcon\n   );\n \n-  // Generate VSCode URL if available\n+  const leadingContent = shouldShowRunArchiveOverlay ? (\n+    <SidebarArchiveOverlay\n+      icon={iconsContent}\n+      label=\"Archive\"\n+      onArchive={handleArchiveRun}\n+      groupName=\"run\"\n+    />\n+  ) : (\n+    iconsContent\n+  );\n+\n+  // Generate VSCode URL if available - used for \"Open with\" actions\n   const hasActiveVSCode = run.vscode?.status === \"running\";\n   const vscodeUrl = useMemo(\n     () => (hasActiveVSCode && run.vscode?.url) || null,\n@@ -1493,25 +1508,14 @@ function TaskRunTreeInner({\n     });\n   }, [refreshGitHubAuth, run._id, teamSlugOrId]);\n \n-  const shouldRenderDiffLink = true;\n-  const shouldRenderBrowserLink = run.vscode?.provider === \"morph\";\n-  const shouldRenderTerminalLink = shouldRenderBrowserLink;\n   const shouldRenderPullRequestLink = Boolean(\n     (run.pullRequestUrl && run.pullRequestUrl !== \"pending\") ||\n       run.pullRequests?.some((pr) => pr.url)\n   );\n-  const shouldRenderPreviewLink = previewServices.length > 0;\n   const hasOpenWithActions = openWithActions.length > 0;\n   const hasPortActions = portActions.length > 0;\n   const canCopyBranch = Boolean(copyRunBranch);\n-  const hasCollapsibleContent =\n-    hasChildren ||\n-    hasActiveVSCode ||\n-    shouldRenderDiffLink ||\n-    shouldRenderBrowserLink ||\n-    shouldRenderTerminalLink ||\n-    shouldRenderPullRequestLink ||\n-    shouldRenderPreviewLink;\n+  const hasCollapsibleContent = true;\n   const [isRunLinkFocusVisible, setIsRunLinkFocusVisible] = useState(false);\n   const handleRunLinkFocus = useCallback(\n     (event: FocusEvent<HTMLAnchorElement>) => {\n@@ -1537,7 +1541,7 @@ function TaskRunTreeInner({\n               ...(prev ?? {}),\n               runId: run._id,\n             })}\n-            className=\"group block\"\n+            className=\"group/run block\"\n             data-focus-visible={isRunLinkFocusVisible ? \"true\" : undefined}\n             activeOptions={{ exact: false }}\n             onFocus={handleRunLinkFocus}\n@@ -1677,16 +1681,14 @@ function TaskRunTreeInner({\n         taskId={taskId}\n         teamSlugOrId={teamSlugOrId}\n         isExpanded={isExpanded}\n-        hasActiveVSCode={hasActiveVSCode}\n         hasChildren={hasChildren}\n-        shouldRenderBrowserLink={shouldRenderBrowserLink}\n-        shouldRenderTerminalLink={shouldRenderTerminalLink}\n         shouldRenderPullRequestLink={shouldRenderPullRequestLink}\n         previewServices={previewServices}\n         customPreviews={run.customPreviews || []}\n         environmentError={run.environmentError}\n         onArchiveToggle={onArchiveToggle}\n         showRunNumbers={showRunNumbers}\n+        isLocalWorkspace={Boolean(isLocalWorkspaceRunEntry)}\n       />\n     </div>\n   );\n@@ -1734,7 +1736,7 @@ function TaskRunDetailLink({\n         <span className=\"text-neutral-600 dark:text-neutral-400\">{label}</span>\n       </span>\n       {trailing ? (\n-        <span className=\"ml-2 flex shrink-0 items-center\">{trailing}</span>\n+        <span className=\"flex shrink-0 items-center\">{trailing}</span>\n       ) : null}\n     </Link>\n   );\n@@ -1816,10 +1818,7 @@ interface TaskRunDetailsProps {\n   taskId: Id<\"tasks\">;\n   teamSlugOrId: string;\n   isExpanded: boolean;\n-  hasActiveVSCode: boolean;\n   hasChildren: boolean;\n-  shouldRenderBrowserLink: boolean;\n-  shouldRenderTerminalLink: boolean;\n   shouldRenderPullRequestLink: boolean;\n   previewServices: PreviewService[];\n   customPreviews: Array<{\n@@ -1832,6 +1831,7 @@ interface TaskRunDetailsProps {\n   };\n   onArchiveToggle: (runId: Id<\"taskRuns\">, archive: boolean) => void;\n   showRunNumbers: boolean;\n+  isLocalWorkspace: boolean;\n }\n \n function TaskRunDetails({\n@@ -1840,16 +1840,14 @@ function TaskRunDetails({\n   taskId,\n   teamSlugOrId,\n   isExpanded,\n-  hasActiveVSCode,\n   hasChildren,\n-  shouldRenderBrowserLink,\n-  shouldRenderTerminalLink,\n   shouldRenderPullRequestLink,\n   previewServices,\n   customPreviews,\n   environmentError,\n   onArchiveToggle,\n   showRunNumbers,\n+  isLocalWorkspace,\n }: TaskRunDetailsProps) {\n   const location = useLocation();\n   const navigate = useNavigate();\n@@ -2043,25 +2041,49 @@ function TaskRunDetails({\n     </Tooltip>\n   ) : null;\n \n+  // Determine loading/error state for the detail links\n+  const isVSCodeReady = run.vscode?.status === \"running\";\n+  const isRunFailed = run.status === \"failed\";\n+\n+  // Show error icon with tooltip if run failed, otherwise show loading spinner\n+  const statusIndicator = isRunFailed ? (\n+    <Tooltip delayDuration={0}>\n+      <TooltipTrigger asChild>\n+        <XCircle className=\"w-3 h-3 text-red-500\" />\n+      </TooltipTrigger>\n+      {run.errorMessage ? (\n+        <TooltipContent\n+          side=\"right\"\n+          className=\"max-w-xs whitespace-pre-wrap break-words\"\n+        >\n+          {run.errorMessage}\n+        </TooltipContent>\n+      ) : null}\n+    </Tooltip>\n+  ) : !isVSCodeReady ? (\n+    <Loader2 className=\"w-3 h-3 animate-spin text-neutral-400\" />\n+  ) : null;\n+\n+  // For VSCode, combine environment error with status indicator\n+  const vscodeTrailing = environmentErrorIndicator || statusIndicator;\n+\n   return (\n     <Fragment>\n-      {hasActiveVSCode ? (\n-        <TaskRunDetailLink\n-          to=\"/$teamSlugOrId/task/$taskId/run/$runId/vscode\"\n-          params={{\n-            teamSlugOrId,\n-            taskId,\n-            runId: run._id,\n-          }}\n-          icon={\n-            <VSCodeIcon className=\"w-3 h-3 mr-2 text-neutral-400 grayscale opacity-60\" />\n-          }\n-          label=\"VS Code\"\n-          indentLevel={indentLevel}\n-          trailing={environmentErrorIndicator}\n-          onReload={handleReloadVSCode}\n-        />\n-      ) : null}\n+      <TaskRunDetailLink\n+        to=\"/$teamSlugOrId/task/$taskId/run/$runId/vscode\"\n+        params={{\n+          teamSlugOrId,\n+          taskId,\n+          runId: run._id,\n+        }}\n+        icon={\n+          <VSCodeIcon className=\"w-3 h-3 mr-2 text-neutral-400 grayscale opacity-60\" />\n+        }\n+        label=\"VS Code\"\n+        indentLevel={indentLevel}\n+        trailing={vscodeTrailing}\n+        onReload={handleReloadVSCode}\n+      />\n \n       <TaskRunDetailLink\n         to=\"/$teamSlugOrId/task/$taskId/run/$runId/diff\"\n@@ -2071,24 +2093,26 @@ function TaskRunDetails({\n         indentLevel={indentLevel}\n       />\n \n-      {shouldRenderBrowserLink ? (\n+      {!isLocalWorkspace ? (\n         <TaskRunDetailLink\n           to=\"/$teamSlugOrId/task/$taskId/run/$runId/browser\"\n           params={{ teamSlugOrId, taskId, runId: run._id }}\n           icon={<Monitor className=\"w-3 h-3 mr-2 text-neutral-400\" />}\n           label=\"Browser\"\n           indentLevel={indentLevel}\n+          trailing={statusIndicator}\n           onReload={handleReloadBrowser}\n         />\n       ) : null}\n \n-      {shouldRenderTerminalLink ? (\n+      {!isLocalWorkspace ? (\n         <TaskRunDetailLink\n           to=\"/$teamSlugOrId/task/$taskId/run/$runId/terminals\"\n           params={{ teamSlugOrId, taskId, runId: run._id }}\n           icon={<TerminalSquare className=\"w-3 h-3 mr-2 text-neutral-400\" />}\n           label=\"Terminals\"\n           indentLevel={indentLevel}\n+          trailing={statusIndicator}\n           onReload={handleReloadTerminals}\n         />\n       ) : null}\n@@ -2116,7 +2140,9 @@ function TaskRunDetails({\n                   runId: run._id,\n                   previewId: `${service.port}`,\n                 }}\n-                icon={<ExternalLink className=\"w-3 h-3 mr-2 text-neutral-400\" />}\n+                icon={\n+                  <ExternalLink className=\"w-3 h-3 mr-2 text-neutral-400\" />\n+                }\n                 label={`Preview (port ${service.port})`}\n                 indentLevel={indentLevel}\n                 className=\"pr-10\"\n@@ -2150,7 +2176,11 @@ function TaskRunDetails({\n                       <Dropdown.Arrow />\n                       <Dropdown.Item\n                         onClick={() => {\n-                          window.open(service.url, \"_blank\", \"noopener,noreferrer\");\n+                          window.open(\n+                            service.url,\n+                            \"_blank\",\n+                            \"noopener,noreferrer\"\n+                          );\n                         }}\n                         className=\"flex items-center gap-2\"\n                       >\n@@ -2174,7 +2204,9 @@ function TaskRunDetails({\n                   runId: run._id,\n                   previewId: String(index),\n                 }}\n-                icon={<ExternalLink className=\"w-3 h-3 mr-2 text-neutral-400\" />}\n+                icon={\n+                  <ExternalLink className=\"w-3 h-3 mr-2 text-neutral-400\" />\n+                }\n                 label={preview.url}\n                 indentLevel={indentLevel}\n                 className=\"pr-10\"\n@@ -2208,7 +2240,11 @@ function TaskRunDetails({\n                       <Dropdown.Arrow />\n                       <Dropdown.Item\n                         onClick={() => {\n-                          window.open(preview.url, \"_blank\", \"noopener,noreferrer\");\n+                          window.open(\n+                            preview.url,\n+                            \"_blank\",\n+                            \"noopener,noreferrer\"\n+                          );\n                         }}\n                         className=\"flex items-center gap-2\"\n                       >\n@@ -2216,7 +2252,9 @@ function TaskRunDetails({\n                         Open in new tab\n                       </Dropdown.Item>\n                       <Dropdown.Item\n-                        onClick={() => handleRemovePreview(index, currentPreviewId)}\n+                        onClick={() =>\n+                          handleRemovePreview(index, currentPreviewId)\n+                        }\n                         className=\"flex items-center gap-2 text-red-600 dark:text-red-400\"\n                       >\n                         <Trash2 className=\"w-3.5 h-3.5\" />\ndiff --git a/apps/client/src/components/dashboard/WorkspaceCreationButtons.tsx b/apps/client/src/components/dashboard/WorkspaceCreationButtons.tsx\nindex 29cb2ddc1..7a3537748 100644\n--- a/apps/client/src/components/dashboard/WorkspaceCreationButtons.tsx\n+++ b/apps/client/src/components/dashboard/WorkspaceCreationButtons.tsx\n@@ -141,7 +141,7 @@ export function WorkspaceCreationButtons({\n \n     try {\n       // Create task in Convex with environment name\n-      const taskId = await createTask({\n+      const { taskId } = await createTask({\n         teamSlugOrId,\n         text: `Cloud Workspace: ${environmentName}`,\n         projectFullName: undefined, // No repo for cloud environment workspaces\ndiff --git a/apps/client/src/components/workspace-loading-indicator.tsx b/apps/client/src/components/workspace-loading-indicator.tsx\nindex 93000f2cc..c2ac1cff0 100644\n--- a/apps/client/src/components/workspace-loading-indicator.tsx\n+++ b/apps/client/src/components/workspace-loading-indicator.tsx\n@@ -4,7 +4,7 @@ import { cn } from \"@/lib/utils\";\n \n export type WorkspaceLoadingStatus = \"loading\" | \"error\";\n \n-type WorkspaceLoadingVariant = \"vscode\" | \"browser\";\n+type WorkspaceLoadingVariant = \"vscode\" | \"browser\" | \"terminal\";\n \n export interface WorkspaceLoadingIndicatorProps {\n   status: WorkspaceLoadingStatus;\n@@ -14,6 +14,7 @@ export interface WorkspaceLoadingIndicatorProps {\n   loadingDescription?: string;\n   errorTitle?: string;\n   errorDescription?: string;\n+  action?: React.ReactNode;\n }\n \n const VARIANT_COPY: Record<\n@@ -39,6 +40,12 @@ const VARIANT_COPY: Record<\n     errorTitle: \"We couldn't launch the browser preview\",\n     errorDescription: \"Refresh the page or switch to cloud mode, then try again.\",\n   },\n+  terminal: {\n+    loadingTitle: \"Starting terminal\",\n+    loadingDescription: \"Connecting to the workspace terminal session.\",\n+    errorTitle: \"We couldn't connect to the terminal\",\n+    errorDescription: \"Refresh the page or try again.\",\n+  },\n };\n \n export const WorkspaceLoadingIndicator = memo(function WorkspaceLoadingIndicator({\n@@ -49,6 +56,7 @@ export const WorkspaceLoadingIndicator = memo(function WorkspaceLoadingIndicator\n   loadingDescription,\n   errorTitle,\n   errorDescription,\n+  action,\n }: WorkspaceLoadingIndicatorProps) {\n   const copy = VARIANT_COPY[variant];\n   const isError = status === \"error\";\n@@ -82,6 +90,7 @@ export const WorkspaceLoadingIndicator = memo(function WorkspaceLoadingIndicator\n           {resolvedDescription}\n         </p>\n       </div>\n+      {action}\n     </div>\n   );\n });\ndiff --git a/apps/client/src/routes/_layout.$teamSlugOrId.dashboard.tsx b/apps/client/src/routes/_layout.$teamSlugOrId.dashboard.tsx\nindex eb6125de5..62e84c53f 100644\n--- a/apps/client/src/routes/_layout.$teamSlugOrId.dashboard.tsx\n+++ b/apps/client/src/routes/_layout.$teamSlugOrId.dashboard.tsx\n@@ -358,8 +358,9 @@ function DashboardComponent() {\n \n       if (currentTasks !== undefined) {\n         const now = Date.now();\n+        const fakeTaskId = createFakeConvexId() as Doc<\"tasks\">[\"_id\"];\n         const optimisticTask = {\n-          _id: createFakeConvexId() as Doc<\"tasks\">[\"_id\"],\n+          _id: fakeTaskId,\n           _creationTime: now,\n           text: args.text,\n           description: args.description,\n@@ -388,8 +389,35 @@ function DashboardComponent() {\n           optimisticTask,\n           ...currentTasks,\n         ]);\n+\n+        // Create optimistic task runs if selectedAgents provided\n+        if (args.selectedAgents && args.selectedAgents.length > 0) {\n+          const optimisticRuns = args.selectedAgents.map((agentName) => ({\n+            _id: createFakeConvexId() as Doc<\"taskRuns\">[\"_id\"],\n+            _creationTime: now,\n+            taskId: fakeTaskId,\n+            prompt: args.text,\n+            agentName,\n+            status: \"pending\" as const,\n+            createdAt: now,\n+            updatedAt: now,\n+            userId: \"optimistic\",\n+            teamId: teamSlugOrId,\n+            environmentId: args.environmentId,\n+            isCloudWorkspace: args.isCloudWorkspace,\n+            children: [],\n+            environment: null,\n+          }));\n+\n+          // Set the task runs query for this fake task\n+          localStore.setQuery(\n+            api.taskRuns.getByTask,\n+            { teamSlugOrId, taskId: fakeTaskId },\n+            optimisticRuns,\n+          );\n+        }\n       }\n-    }\n+    },\n   );\n   const generateUploadUrl = useMutation(api.storage.generateUploadUrl);\n   const addManualRepo = useAction(api.github_http.addManualRepo);\n@@ -516,14 +544,20 @@ function DashboardComponent() {\n         editorApiRef.current.clear();\n       }\n \n-      // Create task in Convex with storage IDs\n-      const taskId = await createTask({\n+      // Determine which agents to spawn\n+      const agentsToSpawn =\n+        selectedAgents.length > 0 ? selectedAgents : DEFAULT_AGENTS;\n+\n+      // Create task in Convex with storage IDs and task runs atomically\n+      const { taskId, taskRunIds } = await createTask({\n         teamSlugOrId,\n         text: content?.text || taskDescription, // Use content.text which includes image references\n         projectFullName: envSelected ? undefined : projectFullName,\n         baseBranch: envSelected ? undefined : branch,\n         images: uploadedImages.length > 0 ? uploadedImages : undefined,\n         environmentId,\n+        isCloudWorkspace: envSelected ? true : isCloudMode,\n+        selectedAgents: agentsToSpawn,\n       });\n \n       // Hint the sidebar to auto-expand this task once it appears\n@@ -535,7 +569,7 @@ function DashboardComponent() {\n \n       // For socket.io, we need to send the content text (which includes image references) and the images\n       const handleStartTaskAck = (\n-        response: TaskAcknowledged | TaskStarted | TaskError\n+        response: TaskAcknowledged | TaskStarted | TaskError,\n       ) => {\n         if (\"error\" in response) {\n           console.error(\"Task start error:\", response.error);\n@@ -562,8 +596,9 @@ function DashboardComponent() {\n           taskDescription: content?.text || taskDescription, // Use content.text which includes image references\n           projectFullName,\n           taskId,\n-          selectedAgents:\n-            selectedAgents.length > 0 ? selectedAgents : undefined,\n+          // Pass pre-created task run IDs so server doesn't need to create them\n+          taskRunIds,\n+          selectedAgents: agentsToSpawn,\n           isCloudMode: envSelected ? true : isCloudMode,\n           ...(environmentId ? { environmentId } : {}),\n           images: images.length > 0 ? images : undefined,\ndiff --git a/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.index.tsx b/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.index.tsx\nindex 2f050b3f7..4f8d84be4 100644\n--- a/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.index.tsx\n+++ b/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.index.tsx\n@@ -128,8 +128,19 @@ export const Route = createFileRoute(\"/_layout/$teamSlugOrId/task/$taskId/\")({\n         ? (taskRunIndex.get(parsedRunId.data) ?? taskRuns[0])\n         : taskRuns[0];\n \n+      const rawWorkspaceUrl = selectedRun?.vscode?.workspaceUrl ?? null;\n       const rawBrowserUrl =\n-        selectedRun?.vscode?.url ?? selectedRun?.vscode?.workspaceUrl ?? null;\n+        selectedRun?.vscode?.url ?? rawWorkspaceUrl ?? null;\n+\n+      // Preload both VSCode and browser iframes in parallel\n+      if (selectedRun && rawWorkspaceUrl) {\n+        const workspaceUrl = toProxyWorkspaceUrl(rawWorkspaceUrl, undefined);\n+        void preloadTaskRunIframes([\n+          { url: workspaceUrl, taskRunId: selectedRun._id },\n+        ]).catch((error) => {\n+          console.error(\"Failed to preload VSCode iframe\", error);\n+        });\n+      }\n       if (selectedRun && rawBrowserUrl) {\n         const vncUrl = toMorphVncUrl(rawBrowserUrl);\n         if (vncUrl) {\n@@ -140,8 +151,6 @@ export const Route = createFileRoute(\"/_layout/$teamSlugOrId/task/$taskId/\")({\n           );\n         }\n       }\n-\n-      const rawWorkspaceUrl = selectedRun?.vscode?.workspaceUrl ?? null;\n       if (!rawWorkspaceUrl) {\n         return;\n       }\ndiff --git a/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.diff.tsx b/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.diff.tsx\nindex 1c8cb519f..fb82751be 100644\n--- a/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.diff.tsx\n+++ b/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.diff.tsx\n@@ -178,13 +178,14 @@ const RestartTaskForm = memo(function RestartTaskForm({\n           ? [...existingImages, ...newImages]\n           : undefined;\n \n-      const newTaskId = await createTask({\n+      const { taskId: newTaskId, taskRunIds } = await createTask({\n         teamSlugOrId,\n         text: combinedPrompt,\n         projectFullName: task.projectFullName ?? undefined,\n         baseBranch: task.baseBranch ?? undefined,\n         images: imagesPayload,\n         environmentId: task.environmentId ?? undefined,\n+        selectedAgents: [...restartAgents],\n       });\n \n       addTaskToExpand(newTaskId);\n@@ -218,6 +219,7 @@ const RestartTaskForm = memo(function RestartTaskForm({\n           taskDescription: combinedPrompt,\n           projectFullName: projectFullNameForSocket,\n           taskId: newTaskId,\n+          taskRunIds,\n           selectedAgents: [...restartAgents],\n           isCloudMode: restartIsCloudMode,\n           ...(task.environmentId ? { environmentId: task.environmentId } : {}),\ndiff --git a/apps/server/src/agentSpawner.ts b/apps/server/src/agentSpawner.ts\nindex 47ce30d92..4edaa2882 100644\n--- a/apps/server/src/agentSpawner.ts\n+++ b/apps/server/src/agentSpawner.ts\n@@ -65,9 +65,13 @@ export async function spawnAgent(\n     }>;\n     theme?: \"dark\" | \"light\" | \"system\";\n     newBranch?: string; // Optional pre-generated branch name\n+    taskRunId?: Id<\"taskRuns\">; // Optional pre-created task run ID\n   },\n   teamSlugOrId: string\n ): Promise<AgentSpawnResult> {\n+  // Declare taskRunId outside try block so it's accessible in catch for error reporting\n+  let taskRunId: Id<\"taskRuns\"> | null = options.taskRunId ?? null;\n+\n   try {\n     // Capture the current auth token and header JSON from AsyncLocalStorage so we can\n     // re-enter the auth context inside async event handlers later.\n@@ -83,18 +87,43 @@ export async function spawnAgent(\n       }`\n     );\n \n-    // Create a task run for this specific agent\n-    const { taskRunId, jwt: taskRunJwt } = await getConvex().mutation(\n-      api.taskRuns.create,\n-      {\n-        teamSlugOrId,\n-        taskId: taskId,\n-        prompt: options.taskDescription,\n-        agentName: agent.name,\n-        newBranch,\n-        environmentId: options.environmentId,\n-      }\n-    );\n+    let taskRunJwt: string;\n+\n+    if (options.taskRunId) {\n+      // Task run was pre-created - get JWT and update branch\n+      const [jwtResult] = await Promise.all([\n+        getConvex().mutation(api.taskRuns.getJwt, {\n+          teamSlugOrId,\n+          taskRunId: options.taskRunId,\n+        }),\n+        getConvex().mutation(api.taskRuns.updateBranch, {\n+          teamSlugOrId,\n+          id: options.taskRunId,\n+          newBranch,\n+        }),\n+      ]);\n+      taskRunJwt = jwtResult.jwt;\n+      taskRunId = options.taskRunId;\n+      serverLogger.info(\n+        `[AgentSpawner] Using pre-created task run ${taskRunId}, updated branch to ${newBranch}`\n+      );\n+    } else {\n+      // Create a task run for this specific agent (legacy path)\n+      const { taskRunId: createdTaskRunId, jwt } =\n+        await getConvex().mutation(api.taskRuns.create, {\n+          teamSlugOrId,\n+          taskId: taskId,\n+          prompt: options.taskDescription,\n+          agentName: agent.name,\n+          newBranch,\n+          environmentId: options.environmentId,\n+        });\n+      taskRunId = createdTaskRunId;\n+      taskRunJwt = jwt;\n+    }\n+\n+    // After this point, taskRunId is guaranteed to be non-null\n+    const runId = taskRunId;\n \n     // Fetch the task to get image storage IDs\n     const task = await getConvex().query(api.tasks.getById, {\n@@ -425,7 +454,7 @@ export async function spawnAgent(\n     await retryOnOptimisticConcurrency(() =>\n       getConvex().mutation(api.taskRuns.updateWorktreePath, {\n         teamSlugOrId,\n-        id: taskRunId,\n+        id: runId,\n         worktreePath: worktreePath,\n       })\n     );\n@@ -488,7 +517,7 @@ export async function spawnAgent(\n           retryOnOptimisticConcurrency(() =>\n             getConvex().mutation(api.taskRuns.fail, {\n               teamSlugOrId,\n-              id: taskRunId,\n+              id: runId,\n               errorMessage: data.errorMessage || \"Terminal failed\",\n               // WorkerTerminalFailed does not include exitCode in schema; default to 1\n               exitCode: 1,\n@@ -497,7 +526,7 @@ export async function spawnAgent(\n         );\n \n         serverLogger.info(\n-          `[AgentSpawner] Marked taskRun ${taskRunId} as failed`\n+          `[AgentSpawner] Marked taskRun ${runId} as failed`\n         );\n       } catch (error) {\n         serverLogger.error(\n@@ -533,24 +562,31 @@ export async function spawnAgent(\n     }\n \n     // Update VSCode instance information in Convex (retry on OCC)\n-    await retryOnOptimisticConcurrency(() =>\n-      getConvex().mutation(api.taskRuns.updateVSCodeInstance, {\n-        teamSlugOrId,\n-        id: taskRunId,\n-        vscode: {\n-          provider: vscodeInfo.provider,\n-          containerName: vscodeInstance.getName(),\n-          status: \"running\",\n-          url: vscodeInfo.url,\n-          workspaceUrl: vscodeInfo.workspaceUrl,\n-          startedAt: Date.now(),\n-          ...(ports ? { ports } : {}),\n-        },\n-      })\n-    );\n+    // Skip if www already persisted the VSCode info (cloud mode optimization)\n+    if (!vscodeInfo.vscodePersisted) {\n+      await retryOnOptimisticConcurrency(() =>\n+        getConvex().mutation(api.taskRuns.updateVSCodeInstance, {\n+          teamSlugOrId,\n+          id: runId,\n+          vscode: {\n+            provider: vscodeInfo.provider,\n+            containerName: vscodeInstance.getName(),\n+            status: \"running\",\n+            url: vscodeInfo.url,\n+            workspaceUrl: vscodeInfo.workspaceUrl,\n+            startedAt: Date.now(),\n+            ...(ports ? { ports } : {}),\n+          },\n+        })\n+      );\n+    } else {\n+      serverLogger.info(\n+        `[AgentSpawner] Skipping updateVSCodeInstance - already persisted by www`\n+      );\n+    }\n \n-    // Use taskRunId as terminal ID for compatibility\n-    const terminalId = taskRunId;\n+    // Use runId as terminal ID for compatibility\n+    const terminalId = runId;\n \n     // Log auth files if any\n     if (authFiles.length > 0) {\n@@ -926,13 +962,39 @@ exit $EXIT_CODE\n     };\n   } catch (error) {\n     serverLogger.error(\"Error spawning agent\", error);\n+    const errorMessage =\n+      error instanceof Error ? error.message : \"Unknown error\";\n+\n+    // Mark the task run as failed in Convex so the UI shows the failure\n+    if (taskRunId) {\n+      const failedRunId = taskRunId; // Capture for TypeScript narrowing\n+      try {\n+        await retryOnOptimisticConcurrency(() =>\n+          getConvex().mutation(api.taskRuns.fail, {\n+            teamSlugOrId,\n+            id: failedRunId,\n+            errorMessage: `Agent spawn failed: ${errorMessage}`,\n+            exitCode: 1,\n+          })\n+        );\n+        serverLogger.info(\n+          `[AgentSpawner] Marked taskRun ${failedRunId} as failed due to spawn error`\n+        );\n+      } catch (failError) {\n+        serverLogger.error(\n+          `[AgentSpawner] Failed to mark taskRun as failed`,\n+          failError\n+        );\n+      }\n+    }\n+\n     return {\n       agentName: agent.name,\n       terminalId: \"\",\n-      taskRunId: \"\",\n+      taskRunId: taskRunId ?? \"\",\n       worktreePath: \"\",\n       success: false,\n-      error: error instanceof Error ? error.message : \"Unknown error\",\n+      error: errorMessage,\n     };\n   }\n }\n@@ -944,7 +1006,9 @@ export async function spawnAllAgents(\n     branch?: string;\n     taskDescription: string;\n     prTitle?: string;\n+    branchNames?: string[]; // Pre-generated branch names (one per agent)\n     selectedAgents?: string[];\n+    taskRunIds?: Id<\"taskRuns\">[]; // Pre-created task run IDs (one per agent)\n     isCloudMode?: boolean;\n     environmentId?: Id<\"environments\">;\n     images?: Array<{\n@@ -963,22 +1027,37 @@ export async function spawnAllAgents(\n         .filter((a): a is AgentConfig => Boolean(a))\n     : AGENT_CONFIGS;\n \n-  // Generate unique branch names for all agents at once to ensure no collisions\n-  const branchNames = options.prTitle\n-    ? await generateUniqueBranchNamesFromTitle(\n-        options.prTitle!,\n-        agentsToSpawn.length,\n-        teamSlugOrId\n-      )\n-    : await generateUniqueBranchNames(\n-        options.taskDescription,\n-        agentsToSpawn.length,\n-        teamSlugOrId\n-      );\n+  // Validate taskRunIds count matches agents count if provided\n+  if (options.taskRunIds && options.taskRunIds.length !== agentsToSpawn.length) {\n+    serverLogger.warn(\n+      `[AgentSpawner] taskRunIds count (${options.taskRunIds.length}) doesn't match agents count (${agentsToSpawn.length})`\n+    );\n+  }\n \n-  serverLogger.info(\n-    `[AgentSpawner] Generated ${branchNames.length} unique branch names for agents`\n-  );\n+  // Use pre-generated branch names if provided, otherwise generate them\n+  let branchNames: string[];\n+  if (options.branchNames && options.branchNames.length >= agentsToSpawn.length) {\n+    branchNames = options.branchNames;\n+    serverLogger.info(\n+      `[AgentSpawner] Using ${branchNames.length} pre-generated branch names`\n+    );\n+  } else {\n+    // Generate unique branch names for all agents at once to ensure no collisions\n+    branchNames = options.prTitle\n+      ? await generateUniqueBranchNamesFromTitle(\n+          options.prTitle,\n+          agentsToSpawn.length,\n+          teamSlugOrId\n+        )\n+      : await generateUniqueBranchNames(\n+          options.taskDescription,\n+          agentsToSpawn.length,\n+          teamSlugOrId\n+        );\n+    serverLogger.info(\n+      `[AgentSpawner] Generated ${branchNames.length} unique branch names for agents`\n+    );\n+  }\n \n   // Spawn all agents in parallel with their pre-generated branch names\n   const results = await Promise.all(\n@@ -989,6 +1068,7 @@ export async function spawnAllAgents(\n         {\n           ...options,\n           newBranch: branchNames[index],\n+          taskRunId: options.taskRunIds?.[index],\n         },\n         teamSlugOrId\n       )\ndiff --git a/apps/server/src/scripts/test-agent-spawner-cloud.ts b/apps/server/src/scripts/test-agent-spawner-cloud.ts\nindex e80346054..99540ee53 100644\n--- a/apps/server/src/scripts/test-agent-spawner-cloud.ts\n+++ b/apps/server/src/scripts/test-agent-spawner-cloud.ts\n@@ -13,7 +13,7 @@ if (!agentConfig) {\n \n console.log(\"Running with agent config:\", agentConfig);\n \n-const taskId = await getConvex().mutation(api.tasks.create, {\n+const { taskId } = await getConvex().mutation(api.tasks.create, {\n   teamSlugOrId: \"default\",\n   projectFullName: \"manaflow-ai/cmux\",\n   text: \"whats the time rn?\",\ndiff --git a/apps/server/src/scripts/test-agent-spawner.ts b/apps/server/src/scripts/test-agent-spawner.ts\nindex f3ee7daf3..edbbc4883 100755\n--- a/apps/server/src/scripts/test-agent-spawner.ts\n+++ b/apps/server/src/scripts/test-agent-spawner.ts\n@@ -42,7 +42,7 @@ async function main() {\n \n   // Create a task in Convex first\n   console.log(\"\\nCreating task in Convex...\");\n-  const taskId = await getConvex().mutation(api.tasks.create, {\n+  const { taskId } = await getConvex().mutation(api.tasks.create, {\n     teamSlugOrId: \"default\",\n     projectFullName: \"lawrencecchen/cmux\",\n     text: testOptions.taskDescription,\ndiff --git a/apps/server/src/socket-handlers.ts b/apps/server/src/socket-handlers.ts\nindex 72ebf6f4a..738cc3714 100644\n--- a/apps/server/src/socket-handlers.ts\n+++ b/apps/server/src/socket-handlers.ts\n@@ -46,7 +46,7 @@ import { getRustTime } from \"./native/core\";\n import type { RealtimeServer } from \"./realtime\";\n import { RepositoryManager } from \"./repositoryManager\";\n import type { GitRepoInfo } from \"./server\";\n-import { getPRTitleFromTaskDescription } from \"./utils/branchNameGenerator\";\n+import { generatePRInfoAndBranchNames } from \"./utils/branchNameGenerator\";\n import { getConvex } from \"./utils/convexClient\";\n import { ensureRunWorktreeAndBranch } from \"./utils/ensureRunWorktree\";\n import { serverLogger } from \"./utils/fileLogger\";\n@@ -591,30 +591,40 @@ export function setupSocketHandlers(\n \n         (async () => {\n           try {\n-            // Generate PR title early from the task description\n+            // Determine number of agents to spawn\n+            const agentCount = taskData.selectedAgents?.length || 1;\n+\n+            // Generate PR title and branch names in a single API call\n             let generatedTitle: string | null = null;\n+            let branchNames: string[] | undefined;\n             try {\n-              generatedTitle = await getPRTitleFromTaskDescription(\n+              const prInfo = await generatePRInfoAndBranchNames(\n                 taskData.taskDescription,\n+                agentCount,\n                 safeTeam\n               );\n-              // Persist to Convex immediately\n+              generatedTitle = prInfo.prTitle;\n+              branchNames = prInfo.branchNames;\n+\n+              // Persist PR title to Convex\n               await getConvex().mutation(api.tasks.setPullRequestTitle, {\n                 teamSlugOrId: safeTeam,\n                 id: taskId,\n                 pullRequestTitle: generatedTitle,\n               });\n               serverLogger.info(\n-                `[Server] Saved early PR title: ${generatedTitle}`\n+                `[Server] Generated PR title and ${branchNames.length} branch names in single call`\n               );\n             } catch (e) {\n               serverLogger.error(\n-                `[Server] Failed generating/saving early PR title:`,\n+                `[Server] Failed generating PR info:`,\n                 e\n               );\n             }\n \n-            // Spawn all agents in parallel (each will create its own taskRun)\n+            // Spawn all agents in parallel\n+            // - If taskRunIds provided, uses pre-created runs (fast path)\n+            // - If branchNames generated above, passes them to avoid re-generating\n             const agentResults = await spawnAllAgents(\n               taskId,\n               {\n@@ -622,7 +632,9 @@ export function setupSocketHandlers(\n                 branch: taskData.branch,\n                 taskDescription: taskData.taskDescription,\n                 prTitle: generatedTitle ?? undefined,\n+                branchNames, // Pass pre-generated branch names to avoid second API call\n                 selectedAgents: taskData.selectedAgents,\n+                taskRunIds: taskData.taskRunIds,\n                 isCloudMode: taskData.isCloudMode,\n                 images: taskData.images,\n                 theme: taskData.theme,\n@@ -2140,7 +2152,7 @@ Context:\n Please address the issue mentioned in the comment above.`;\n \n         // Create a new task in Convex\n-        const taskId = await getConvex().mutation(api.tasks.create, {\n+        const { taskId } = await getConvex().mutation(api.tasks.create, {\n           teamSlugOrId: safeTeam,\n           text: formattedPrompt,\n           projectFullName: \"manaflow-ai/cmux\",\ndiff --git a/apps/server/src/utils/branchNameGenerator.ts b/apps/server/src/utils/branchNameGenerator.ts\nindex 5412c49bd..40504b457 100644\n--- a/apps/server/src/utils/branchNameGenerator.ts\n+++ b/apps/server/src/utils/branchNameGenerator.ts\n@@ -128,6 +128,34 @@ export async function generateUniqueBranchNamesFromTitle(\n   return data.branchNames;\n }\n \n+// Generate PR title and branch names in a single API call\n+export async function generatePRInfoAndBranchNames(\n+  taskDescription: string,\n+  count: number,\n+  teamSlugOrId: string\n+): Promise<{ prTitle: string; branchNames: string[] }> {\n+  const data = await requestBranchGeneration({\n+    teamSlugOrId,\n+    taskDescription,\n+    count,\n+  });\n+\n+  if (!data.branchNames || data.branchNames.length === 0) {\n+    throw new Error(\"Failed to generate branch names\");\n+  }\n+\n+  if (data.branchNames.length < count) {\n+    serverLogger.warn(\n+      `[BranchNameGenerator] Expected ${count} names, received ${data.branchNames.length}`\n+    );\n+  }\n+\n+  return {\n+    prTitle: data.prTitle || fallbackPrTitle(taskDescription),\n+    branchNames: data.branchNames,\n+  };\n+}\n+\n export async function getPRTitleFromTaskDescription(\n   taskDescription: string,\n   teamSlugOrId: string\ndiff --git a/apps/server/src/vscode/CmuxVSCodeInstance.ts b/apps/server/src/vscode/CmuxVSCodeInstance.ts\nindex 6422b3d23..b309d0089 100644\n--- a/apps/server/src/vscode/CmuxVSCodeInstance.ts\n+++ b/apps/server/src/vscode/CmuxVSCodeInstance.ts\n@@ -77,10 +77,14 @@ export class CmuxVSCodeInstance extends VSCodeInstance {\n     this.vscodeBaseUrl = data.vscodeUrl;\n     this.workerUrl = data.workerUrl;\n     this.provider = data.provider || \"morph\";\n+    const vscodePersisted = data.vscodePersisted ?? false;\n \n     const workspaceUrl = this.getWorkspaceUrl(this.vscodeBaseUrl);\n     dockerLogger.info(`[CmuxVSCodeInstance] VS Code URL: ${workspaceUrl}`);\n     dockerLogger.info(`[CmuxVSCodeInstance] Worker URL: ${this.workerUrl}`);\n+    dockerLogger.info(\n+      `[CmuxVSCodeInstance] VSCode persisted by www: ${vscodePersisted}`\n+    );\n \n     // Connect to the worker if available\n     if (this.workerUrl) {\n@@ -103,6 +107,7 @@ export class CmuxVSCodeInstance extends VSCodeInstance {\n       instanceId: this.instanceId,\n       taskRunId: this.taskRunId,\n       provider: this.provider,\n+      vscodePersisted,\n     };\n   }\n \ndiff --git a/apps/server/src/vscode/VSCodeInstance.ts b/apps/server/src/vscode/VSCodeInstance.ts\nindex e1d3c7408..1c81a8732 100644\n--- a/apps/server/src/vscode/VSCodeInstance.ts\n+++ b/apps/server/src/vscode/VSCodeInstance.ts\n@@ -27,6 +27,8 @@ export interface VSCodeInstanceInfo {\n   instanceId: string;\n   taskRunId: Id<\"taskRuns\">;\n   provider: \"docker\" | \"morph\" | \"daytona\";\n+  /** If true, VSCode URLs were already persisted to Convex by www */\n+  vscodePersisted?: boolean;\n }\n \n export abstract class VSCodeInstance extends EventEmitter {\ndiff --git a/apps/www/lib/hono-app.ts b/apps/www/lib/hono-app.ts\nindex b0a29bfbe..723116ee2 100644\n--- a/apps/www/lib/hono-app.ts\n+++ b/apps/www/lib/hono-app.ts\n@@ -35,6 +35,7 @@ import { cors } from \"hono/cors\";\n import { logger } from \"hono/logger\";\n import { prettyJSON } from \"hono/pretty-json\";\n import { decodeJwt } from \"jose\";\n+import { setupHonoErrorHandler } from \"@sentry/node\";\n \n // Get client preview URL from related projects for CORS\n const clientPreviewOriginRaw = relatedProjects({ noThrow: true }).find(\n@@ -161,6 +162,9 @@ app.notFound((c) => {\n   );\n });\n \n+// Sentry error handler - must be before custom error handler\n+setupHonoErrorHandler(app);\n+\n // Error handler\n app.onError((err, c) => {\n   console.error(`${err}`);\ndiff --git a/apps/www/lib/routes/morph.route.ts b/apps/www/lib/routes/morph.route.ts\nindex c0e7466d8..3e45fd7ca 100644\n--- a/apps/www/lib/routes/morph.route.ts\n+++ b/apps/www/lib/routes/morph.route.ts\n@@ -7,7 +7,8 @@ import { getAccessTokenFromRequest } from \"@/lib/utils/auth\";\n import { verifyTeamAccess } from \"@/lib/utils/team-verification\";\n import { env } from \"@/lib/utils/www-env\";\n import { createRoute, OpenAPIHono, z } from \"@hono/zod-openapi\";\n-import { MorphCloudClient } from \"morphcloud\";\n+import { HTTPException } from \"hono/http-exception\";\n+import { type Instance, MorphCloudClient } from \"morphcloud\";\n import { getConvex } from \"../utils/get-convex\";\n import { selectGitIdentity } from \"../utils/gitIdentity\";\n import { stackServerAppJs } from \"../utils/stack\";\n@@ -19,6 +20,7 @@ import {\n   fetchGitIdentityInputs,\n } from \"./sandboxes/git\";\n import { typedZid } from \"@cmux/shared/utils/typed-zid\";\n+import * as Sentry from \"@sentry/nextjs\";\n \n export const morphRouter = new OpenAPIHono();\n \n@@ -445,11 +447,17 @@ morphRouter.openapi(\n     },\n   }),\n   async (c) => {\n-    const user = await stackServerAppJs.getUser({ tokenStore: c.req.raw });\n+    const user = await Sentry.startSpan(\n+      { name: \"stackServerAppJs.getUser\", op: \"auth\" },\n+      () => stackServerAppJs.getUser({ tokenStore: c.req.raw })\n+    );\n     if (!user) {\n       return c.text(\"Unauthorized\", 401);\n     }\n-    const { accessToken } = await user.getAuthJson();\n+    const { accessToken } = await Sentry.startSpan(\n+      { name: \"user.getAuthJson\", op: \"auth\" },\n+      () => user.getAuthJson()\n+    );\n     if (!accessToken) return c.text(\"Unauthorized\", 401);\n     const {\n       teamSlugOrId,\n@@ -461,33 +469,43 @@ morphRouter.openapi(\n \n     const convex = getConvex({ accessToken });\n \n-    // Verify team access and get the team\n-    const team = await verifyTeamAccess({ req: c.req.raw, teamSlugOrId });\n-    const githubAccessTokenPromise = (async () => {\n-      const githubAccount = await user.getConnectedAccount(\"github\");\n-      if (!githubAccount) {\n-        return {\n-          githubAccessTokenError: \"GitHub account not found\",\n-          githubAccessToken: null,\n-        } as const;\n-      }\n-      const { accessToken: githubAccessToken } =\n-        await githubAccount.getAccessToken();\n-      if (!githubAccessToken) {\n-        return {\n-          githubAccessTokenError: \"GitHub access token not found\",\n-          githubAccessToken: null,\n-        } as const;\n+    const verifyTeamPromise = Sentry.startSpan(\n+      { name: \"verifyTeamAccess\", op: \"auth\" },\n+      () => verifyTeamAccess({ req: c.req.raw, teamSlugOrId })\n+    );\n+\n+    const githubAccessTokenPromise = Sentry.startSpan(\n+      { name: \"getGithubAccessToken\", op: \"auth\" },\n+      async () => {\n+        const githubAccount = await user.getConnectedAccount(\"github\");\n+        if (!githubAccount) {\n+          return {\n+            githubAccessTokenError: \"GitHub account not found\",\n+            githubAccessToken: null,\n+          } as const;\n+        }\n+        const { accessToken: githubAccessToken } =\n+          await githubAccount.getAccessToken();\n+        if (!githubAccessToken) {\n+          return {\n+            githubAccessTokenError: \"GitHub access token not found\",\n+            githubAccessToken: null,\n+          } as const;\n+        }\n+\n+        return { githubAccessTokenError: null, githubAccessToken } as const;\n       }\n+    );\n \n-      return { githubAccessTokenError: null, githubAccessToken } as const;\n-    })();\n     const gitIdentityPromise = githubAccessTokenPromise.then(\n       ({ githubAccessToken }) => {\n         if (!githubAccessToken) {\n           throw new Error(\"GitHub access token not found\");\n         }\n-        return fetchGitIdentityInputs(convex, githubAccessToken);\n+        return Sentry.startSpan(\n+          { name: \"fetchGitIdentityInputs\", op: \"db\" },\n+          () => fetchGitIdentityInputs(convex, githubAccessToken)\n+        );\n       }\n     );\n \n@@ -496,35 +514,47 @@ morphRouter.openapi(\n         apiKey: env.MORPH_API_KEY,\n       });\n \n-      let instance;\n+      let instance: Instance;\n       let instanceId = existingInstanceId;\n       const selectedSnapshotId = snapshotId ?? DEFAULT_MORPH_SNAPSHOT_ID;\n \n-      // If no instanceId provided, create a new instance\n       if (!instanceId) {\n+        const team = await verifyTeamPromise;\n+\n         console.log(\n           `Creating new Morph instance (snapshot: ${selectedSnapshotId})`\n         );\n-        instance = await client.instances.start({\n-          snapshotId: selectedSnapshotId,\n-          ttlSeconds,\n-          ttlAction: \"pause\",\n-          metadata: {\n-            app: \"cmux-dev\",\n-            userId: user.id,\n-            teamId: team.uuid,\n-          },\n-        });\n+        instance = await Sentry.startSpan(\n+          { name: \"client.instances.start\", op: \"morph\" },\n+          () =>\n+            client.instances.start({\n+              snapshotId: selectedSnapshotId,\n+              ttlSeconds,\n+              ttlAction: \"pause\",\n+              metadata: {\n+                app: \"cmux-dev\",\n+                userId: user.id,\n+                teamId: team.uuid,\n+              },\n+            })\n+        );\n         instanceId = instance.id;\n-        void (async () => {\n-          await instance.setWakeOn(true, true);\n-        })();\n+        void Sentry.startSpan(\n+          { name: \"instance.setWakeOn\", op: \"morph\" },\n+          () => instance.setWakeOn(true, true)\n+        );\n       } else {\n-        // Get existing instance\n         console.log(`Using existing Morph instance: ${instanceId}`);\n-        instance = await client.instances.get({ instanceId });\n \n-        // Security: ensure the instance belongs to the requested team\n+        const [team, inst] = await Promise.all([\n+          verifyTeamPromise,\n+          Sentry.startSpan({ name: \"client.instances.get\", op: \"morph\" }, () =>\n+            client.instances.get({ instanceId: instanceId! })\n+          ),\n+        ]);\n+\n+        instance = inst;\n+\n         const meta = instance.metadata;\n         const instanceTeamId = meta?.teamId;\n         if (!instanceTeamId || instanceTeamId !== team.uuid) {\n@@ -535,19 +565,6 @@ morphRouter.openapi(\n         }\n       }\n \n-      void gitIdentityPromise\n-        .then(([who, gh]) => {\n-          const { name, email } = selectGitIdentity(who, gh);\n-          return configureGitIdentity(instance, { name, email });\n-        })\n-        .catch((error) => {\n-          console.log(\n-            `[sandboxes.start] Failed to configure git identity; continuing...`,\n-            error\n-          );\n-        });\n-\n-      // Get VSCode URL\n       const vscodeUrl = instance.networking.httpServices.find(\n         (service) => service.port === 39378\n       )?.url;\n@@ -564,22 +581,40 @@ morphRouter.openapi(\n         );\n         return c.text(\"Failed to resolve GitHub credentials\", 401);\n       }\n-      await configureGithubAccess(instance, githubAccessToken);\n+\n+      const configureGithubPromise = Sentry.startSpan(\n+        { name: \"configureGithubAccess\", op: \"morph.exec\" },\n+        () => configureGithubAccess(instance, githubAccessToken)\n+      );\n+\n+      void gitIdentityPromise\n+        .then(([who, gh]) => {\n+          const { name, email } = selectGitIdentity(who, gh);\n+          return Sentry.startSpan(\n+            { name: \"configureGitIdentity\", op: \"morph.exec\" },\n+            () => configureGitIdentity(instance, { name, email })\n+          );\n+        })\n+        .catch((error) => {\n+          console.log(\n+            `[sandboxes.start] Failed to configure git identity; continuing...`,\n+            error\n+          );\n+        });\n+\n+      await configureGithubPromise;\n \n       const url = `${vscodeUrl}/?folder=/root/workspace`;\n \n-      // Handle repository management if repos are specified\n       const removedRepos: string[] = [];\n       const clonedRepos: string[] = [];\n       const failedClones: { repo: string; error: string; isAuth: boolean }[] =\n         [];\n \n       if (selectedRepos && selectedRepos.length > 0) {\n-        // Validate repo format and check for duplicates\n-        const repoNames = new Map<string, string>(); // Map of repo name to full path\n-        const reposByOwner = new Map<string, string[]>(); // Map of owner -> list of full repo names\n+        const repoNames = new Map<string, string>();\n+        const reposByOwner = new Map<string, string[]>();\n         for (const repo of selectedRepos) {\n-          // Validate format: should be owner/repo\n           if (!repo.includes(\"/\") || repo.split(\"/\").length !== 2) {\n             return c.text(\n               `Invalid repository format: ${repo}. Expected format: owner/repo`,\n@@ -592,7 +627,6 @@ morphRouter.openapi(\n             return c.text(`Invalid repository: ${repo}`, 400);\n           }\n \n-          // Check for duplicate repo names\n           if (repoNames.has(repoName)) {\n             return c.text(\n               `Duplicate repository name detected: '${repoName}' from both '${repoNames.get(repoName)}' and '${repo}'. ` +\n@@ -602,24 +636,26 @@ morphRouter.openapi(\n           }\n           repoNames.set(repoName, repo);\n \n-          // Group by owner for GitHub App installations\n           if (!reposByOwner.has(owner)) {\n             reposByOwner.set(owner, []);\n           }\n           reposByOwner.get(owner)!.push(repo);\n         }\n \n-        // First, get list of existing repos with their remote URLs\n-        const listReposCmd = await instance.exec(\n-          \"for dir in /root/workspace/*/; do \" +\n-            'if [ -d \"$dir/.git\" ]; then ' +\n-            'basename \"$dir\"; ' +\n-            \"cd \\\"$dir\\\" && git remote get-url origin 2>/dev/null || echo 'no-remote'; \" +\n-            \"fi; done\"\n+        const listReposCmd = await Sentry.startSpan(\n+          { name: \"instance.exec (list repos)\", op: \"morph.exec\" },\n+          () =>\n+            instance.exec(\n+              \"for dir in /root/workspace/*/; do \" +\n+                'if [ -d \"$dir/.git\" ]; then ' +\n+                'basename \"$dir\"; ' +\n+                \"cd \\\"$dir\\\" && git remote get-url origin 2>/dev/null || echo 'no-remote'; \" +\n+                \"fi; done\"\n+            )\n         );\n \n         const lines = listReposCmd.stdout.split(\"\\n\").filter(Boolean);\n-        const existingRepos = new Map<string, string>(); // Map of repo name to remote URL\n+        const existingRepos = new Map<string, string>();\n \n         for (let i = 0; i < lines.length; i += 2) {\n           const repoName = lines[i]?.trim();\n@@ -631,29 +667,30 @@ morphRouter.openapi(\n           }\n         }\n \n-        // Determine which repos to remove\n         for (const [existingName, existingUrl] of existingRepos) {\n           const selectedRepo = repoNames.get(existingName);\n \n           if (!selectedRepo) {\n-            // Repo not in selected list, remove it\n             console.log(`Removing repository: ${existingName}`);\n-            await instance.exec(`rm -rf /root/workspace/${existingName}`);\n+            await Sentry.startSpan(\n+              { name: `instance.exec (rm ${existingName})`, op: \"morph.exec\" },\n+              () => instance.exec(`rm -rf /root/workspace/${existingName}`)\n+            );\n             removedRepos.push(existingName);\n           } else if (existingUrl && !existingUrl.includes(selectedRepo)) {\n-            // Repo exists but points to different remote, remove and re-clone\n             console.log(\n               `Repository ${existingName} points to different remote, removing for re-clone`\n             );\n-            await instance.exec(`rm -rf /root/workspace/${existingName}`);\n+            await Sentry.startSpan(\n+              { name: `instance.exec (rm ${existingName})`, op: \"morph.exec\" },\n+              () => instance.exec(`rm -rf /root/workspace/${existingName}`)\n+            );\n             removedRepos.push(existingName);\n-            existingRepos.delete(existingName); // Mark for re-cloning\n+            existingRepos.delete(existingName);\n           }\n         }\n \n-        // For each owner group, mint a token and clone that owner's repos\n         for (const [, repos] of reposByOwner) {\n-          // Clone new repos for this owner in parallel with retries\n           const clonePromises = repos.map(async (repo) => {\n             const repoName = repo.split(\"/\").pop()!;\n             if (!existingRepos.has(repoName)) {\n@@ -664,8 +701,16 @@ morphRouter.openapi(\n               let isAuthError = false;\n \n               for (let attempt = 1; attempt <= maxRetries; attempt++) {\n-                const cloneCmd = await instance.exec(\n-                  `mkdir -p /root/workspace && cd /root/workspace && git clone https://github.com/${repo}.git ${repoName} 2>&1`\n+                const cloneCmd = await Sentry.startSpan(\n+                  {\n+                    name: `instance.exec (clone ${repoName})`,\n+                    op: \"morph.exec\",\n+                    attributes: { attempt },\n+                  },\n+                  () =>\n+                    instance.exec(\n+                      `mkdir -p /root/workspace && cd /root/workspace && git clone https://github.com/${repo}.git ${repoName} 2>&1`\n+                    )\n                 );\n \n                 if (cloneCmd.exit_code === 0) {\n@@ -673,7 +718,6 @@ morphRouter.openapi(\n                 } else {\n                   lastError = cloneCmd.stderr || cloneCmd.stdout;\n \n-                  // Check for authentication errors\n                   isAuthError =\n                     lastError.includes(\"Authentication failed\") ||\n                     lastError.includes(\"could not read Username\") ||\n@@ -683,7 +727,6 @@ morphRouter.openapi(\n                     lastError.includes(\"Repository not found\") ||\n                     lastError.includes(\"403\");\n \n-                  // Don't retry authentication errors\n                   if (isAuthError) {\n                     console.error(\n                       `Authentication failed for ${repo}: ${lastError}`\n@@ -695,9 +738,7 @@ morphRouter.openapi(\n                     console.log(\n                       `Clone attempt ${attempt} failed for ${repo}, retrying...`\n                     );\n-                    // Clean up partial clone if it exists\n                     await instance.exec(`rm -rf /root/workspace/${repoName}`);\n-                    // Wait before retry with exponential backoff\n                     await new Promise((resolve) =>\n                       setTimeout(resolve, attempt * 1000)\n                     );\n@@ -754,6 +795,9 @@ morphRouter.openapi(\n         failedClones,\n       });\n     } catch (error) {\n+      if (error instanceof HTTPException) {\n+        throw error;\n+      }\n       console.error(\"Failed to setup Morph instance:\", error);\n       return c.text(\"Failed to setup instance\", 500);\n     }\ndiff --git a/apps/www/lib/routes/sandboxes.route.ts b/apps/www/lib/routes/sandboxes.route.ts\nindex 4a1bd26e6..28217486b 100644\n--- a/apps/www/lib/routes/sandboxes.route.ts\n+++ b/apps/www/lib/routes/sandboxes.route.ts\n@@ -5,6 +5,7 @@ import { stackServerAppJs } from \"@/lib/utils/stack\";\n import { verifyTeamAccess } from \"@/lib/utils/team-verification\";\n import { env } from \"@/lib/utils/www-env\";\n import { api } from \"@cmux/convex/api\";\n+import type { Id } from \"@cmux/convex/dataModel\";\n import { RESERVED_CMUX_PORT_SET } from \"@cmux/shared/utils/reserved-cmux-ports\";\n import { parseGithubRepoUrl } from \"@cmux/shared/utils/parse-github-repo-url\";\n import { createRoute, OpenAPIHono, z } from \"@hono/zod-openapi\";\n@@ -58,6 +59,7 @@ const StartSandboxResponse = z\n     vscodeUrl: z.string(),\n     workerUrl: z.string(),\n     provider: z.enum([\"morph\"]).default(\"morph\"),\n+    vscodePersisted: z.boolean().optional(),\n   })\n   .openapi(\"StartSandboxResponse\");\n \n@@ -243,6 +245,35 @@ sandboxesRouter.openapi(\n         return c.text(\"VSCode or worker service not found\", 500);\n       }\n \n+      // OPTIMIZATION: Immediately persist VSCode URLs to Convex (status=\"starting\")\n+      // This allows frontend to show VSCode iframe while hydration continues\n+      let vscodePersisted = false;\n+      if (body.taskRunId) {\n+        try {\n+          await convex.mutation(api.taskRuns.updateVSCodeInstance, {\n+            teamSlugOrId: body.teamSlugOrId,\n+            id: body.taskRunId as Id<\"taskRuns\">,\n+            vscode: {\n+              provider: \"morph\",\n+              containerName: instance.id,\n+              status: \"starting\",\n+              url: vscodeService.url,\n+              workspaceUrl: `${vscodeService.url}/?folder=/root/workspace`,\n+              startedAt: Date.now(),\n+            },\n+          });\n+          vscodePersisted = true;\n+          console.log(\n+            `[sandboxes.start] Persisted initial VSCode info for ${body.taskRunId}`,\n+          );\n+        } catch (error) {\n+          console.error(\n+            \"[sandboxes.start] Failed to persist initial VSCode info (non-fatal):\",\n+            error,\n+          );\n+        }\n+      }\n+\n       // Get environment variables from the environment if configured\n       const environmentEnvVarsContent = await environmentEnvVarsPromise;\n \n@@ -341,6 +372,22 @@ sandboxesRouter.openapi(\n         return c.text(\"Failed to hydrate sandbox\", 500);\n       }\n \n+      // Update status to \"running\" after hydration completes\n+      if (body.taskRunId && vscodePersisted) {\n+        void convex\n+          .mutation(api.taskRuns.updateVSCodeStatus, {\n+            teamSlugOrId: body.teamSlugOrId,\n+            id: body.taskRunId as Id<\"taskRuns\">,\n+            status: \"running\",\n+          })\n+          .catch((error) => {\n+            console.error(\n+              \"[sandboxes.start] Failed to update VSCode status to running:\",\n+              error,\n+            );\n+          });\n+      }\n+\n       if (maintenanceScript || devScript) {\n         (async () => {\n           await runMaintenanceAndDevScripts({\n@@ -367,6 +414,7 @@ sandboxesRouter.openapi(\n         vscodeUrl: vscodeService.url,\n         workerUrl: workerService.url,\n         provider: \"morph\",\n+        vscodePersisted,\n       });\n     } catch (error) {\n       if (error instanceof HTTPException) {\ndiff --git a/apps/www/package.json b/apps/www/package.json\nindex 61b2354fb..c0ddd3842 100644\n--- a/apps/www/package.json\n+++ b/apps/www/package.json\n@@ -14,7 +14,8 @@\n     \"generate-openapi-client\": \"bun run --env-file ../../.env scripts/watch-openapi.ts\",\n     \"generate-openapi-client:watch\": \"bun run --watch --env-file ../../.env scripts/watch-openapi.ts\",\n     \"backfill-pr\": \"bun run --env-file ../../.env scripts/backfill-pr.ts\",\n-    \"backfill-repo\": \"bun run --env-file ../../.env scripts/backfill-repo.ts\"\n+    \"backfill-repo\": \"bun run --env-file ../../.env scripts/backfill-repo.ts\",\n+    \"bench-morph\": \"bun run --env-file ../../.env scripts/bench-morph-setup.ts\"\n   },\n   \"dependencies\": {\n     \"@ai-sdk/anthropic\": \"^2.0.39\",\ndiff --git a/apps/www/sentry.server.config.ts b/apps/www/sentry.server.config.ts\nindex dcffc9648..b6f3b2b0a 100644\n--- a/apps/www/sentry.server.config.ts\n+++ b/apps/www/sentry.server.config.ts\n@@ -3,12 +3,15 @@\n // https://docs.sentry.io/platforms/javascript/guides/nextjs/\n \n import * as Sentry from \"@sentry/nextjs\";\n+import { honoIntegration } from \"@sentry/node\";\n import { SENTRY_RELEASE } from \"@/lib/sentry-release\";\n \n Sentry.init({\n   dsn: \"https://96214f39aa409867381a22a79ff3e6a4@o4507547940749312.ingest.us.sentry.io/4510308518854656\",\n   release: SENTRY_RELEASE,\n \n+  integrations: [honoIntegration()],\n+\n   // Define how likely traces are sampled. Adjust this value in production, or use tracesSampler for greater control.\n   tracesSampleRate: 1,\n \ndiff --git a/packages/convex/convex/taskRuns.ts b/packages/convex/convex/taskRuns.ts\nindex 8891b8a7d..1e38977b4 100644\n--- a/packages/convex/convex/taskRuns.ts\n+++ b/packages/convex/convex/taskRuns.ts\n@@ -203,6 +203,93 @@ async function collectRunSubtreeIds(\n   return Array.from(visited);\n }\n \n+/**\n+ * After a task run status changes, check if all runs are terminal and update the task accordingly.\n+ *\n+ * Logic:\n+ * - If some runs are still pending/running, do nothing (wait for them)\n+ * - If all runs are terminal (completed/failed/skipped):\n+ *   - If ALL failed/skipped (none completed): mark task as failed\n+ *   - If at least one completed: mark task as completed (crown evaluation handles picking winner)\n+ */\n+async function updateTaskStatusFromRuns(\n+  ctx: MutationCtx,\n+  taskId: Id<\"tasks\">,\n+  teamId: string,\n+  userId: string,\n+): Promise<void> {\n+  // Query all runs for this task (only root-level runs, not children)\n+  const allRuns = await ctx.db\n+    .query(\"taskRuns\")\n+    .withIndex(\"by_task\", (q) => q.eq(\"taskId\", taskId))\n+    .filter((q) =>\n+      q.and(\n+        q.eq(q.field(\"teamId\"), teamId),\n+        q.eq(q.field(\"userId\"), userId),\n+        // Only consider root runs (no parent) for task status\n+        q.eq(q.field(\"parentRunId\"), undefined),\n+      ),\n+    )\n+    .collect();\n+\n+  if (allRuns.length === 0) {\n+    return;\n+  }\n+\n+  // Check if all runs are in a terminal state\n+  const terminalStatuses = [\"completed\", \"failed\", \"skipped\"];\n+  const allTerminal = allRuns.every((run) =>\n+    terminalStatuses.includes(run.status),\n+  );\n+\n+  if (!allTerminal) {\n+    // Some runs are still pending/running, don't update task yet\n+    return;\n+  }\n+\n+  // All runs are terminal, aggregate the status\n+  const completedRuns = allRuns.filter((run) => run.status === \"completed\");\n+  const failedRuns = allRuns.filter((run) => run.status === \"failed\");\n+\n+  const task = await ctx.db.get(taskId);\n+  if (!task || task.teamId !== teamId) {\n+    return;\n+  }\n+\n+  // Don't update if task is already completed\n+  if (task.isCompleted) {\n+    return;\n+  }\n+\n+  const now = Date.now();\n+\n+  if (completedRuns.length === 0) {\n+    // ALL runs failed or skipped - no successful runs to crown\n+    const errorMessages = failedRuns\n+      .map((run) => run.errorMessage)\n+      .filter(Boolean);\n+    const aggregatedError =\n+      failedRuns.length === 1\n+        ? errorMessages[0] || \"Task run failed\"\n+        : `All ${failedRuns.length} task run(s) failed`;\n+\n+    await ctx.db.patch(taskId, {\n+      isCompleted: true,\n+      crownEvaluationStatus: \"error\",\n+      crownEvaluationError: aggregatedError,\n+      updatedAt: now,\n+    });\n+  } else {\n+    // At least one run completed successfully\n+    // For single run: just mark completed\n+    // For multiple runs: mark completed, crown evaluation will pick winner\n+    await ctx.db.patch(taskId, {\n+      isCompleted: true,\n+      updatedAt: now,\n+    });\n+  }\n+}\n+\n async function fetchTaskRunsForTask(\n   ctx: QueryCtx,\n   teamId: string,\n@@ -438,6 +525,11 @@ export const updateStatus = internalMutation({\n     exitCode: v.optional(v.number()),\n   },\n   handler: async (ctx, args) => {\n+    const run = await ctx.db.get(args.id);\n+    if (!run) {\n+      throw new Error(\"Task run not found\");\n+    }\n+\n     const now = Date.now();\n     const updates: {\n       status: typeof args.status;\n@@ -457,6 +549,11 @@ export const updateStatus = internalMutation({\n     }\n \n     await ctx.db.patch(args.id, updates);\n+\n+    // After updating to a terminal status, check if we should update the task status\n+    if (args.status === \"completed\" || args.status === \"failed\") {\n+      await updateTaskStatusFromRuns(ctx, run.taskId, run.teamId, run.userId);\n+    }\n   },\n });\n \n@@ -716,6 +813,116 @@ export const updateWorktreePath = authMutation({\n   },\n });\n \n+// Update branch name for a task run (called after branch generation completes)\n+export const updateBranch = authMutation({\n+  args: {\n+    teamSlugOrId: v.string(),\n+    id: v.id(\"taskRuns\"),\n+    newBranch: v.string(),\n+  },\n+  handler: async (ctx, args) => {\n+    const userId = ctx.identity.subject;\n+    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const doc = await ctx.db.get(args.id);\n+    if (!doc || doc.teamId !== teamId || doc.userId !== userId) {\n+      throw new Error(\"Task run not found or unauthorized\");\n+    }\n+    await ctx.db.patch(args.id, {\n+      newBranch: args.newBranch,\n+      updatedAt: Date.now(),\n+    });\n+\n+    // Also update the task's generatedBranchName if this is the first branch\n+    const task = await ctx.db.get(doc.taskId);\n+    if (task) {\n+      const generatedBranchName = deriveGeneratedBranchName(args.newBranch);\n+      if (\n+        generatedBranchName &&\n+        task.generatedBranchName !== generatedBranchName\n+      ) {\n+        await ctx.db.patch(doc.taskId, {\n+          generatedBranchName,\n+        });\n+      }\n+    }\n+  },\n+});\n+\n+// Batch update branch names for multiple task runs\n+export const updateBranchBatch = authMutation({\n+  args: {\n+    teamSlugOrId: v.string(),\n+    updates: v.array(\n+      v.object({\n+        id: v.id(\"taskRuns\"),\n+        newBranch: v.string(),\n+      }),\n+    ),\n+  },\n+  handler: async (ctx, args) => {\n+    const userId = ctx.identity.subject;\n+    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const now = Date.now();\n+\n+    let firstGeneratedBranchName: string | undefined;\n+\n+    for (const update of args.updates) {\n+      const doc = await ctx.db.get(update.id);\n+      if (!doc || doc.teamId !== teamId || doc.userId !== userId) {\n+        throw new Error(`Task run ${update.id} not found or unauthorized`);\n+      }\n+      await ctx.db.patch(update.id, {\n+        newBranch: update.newBranch,\n+        updatedAt: now,\n+      });\n+\n+      // Track the first generated branch name to update the task\n+      if (!firstGeneratedBranchName) {\n+        firstGeneratedBranchName = deriveGeneratedBranchName(update.newBranch);\n+        if (firstGeneratedBranchName) {\n+          const task = await ctx.db.get(doc.taskId);\n+          if (\n+            task &&\n+            task.generatedBranchName !== firstGeneratedBranchName\n+          ) {\n+            await ctx.db.patch(doc.taskId, {\n+              generatedBranchName: firstGeneratedBranchName,\n+            });\n+          }\n+        }\n+      }\n+    }\n+  },\n+});\n+\n+// Get JWT for an existing task run (used when task runs are pre-created)\n+export const getJwt = authMutation({\n+  args: {\n+    teamSlugOrId: v.string(),\n+    taskRunId: v.id(\"taskRuns\"),\n+  },\n+  handler: async (ctx, args) => {\n+    const userId = ctx.identity.subject;\n+    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const doc = await ctx.db.get(args.taskRunId);\n+    if (!doc || doc.teamId !== teamId || doc.userId !== userId) {\n+      throw new Error(\"Task run not found or unauthorized\");\n+    }\n+\n+    const jwt = await new SignJWT({\n+      taskRunId: args.taskRunId,\n+      teamId,\n+      userId,\n+    })\n+      .setProtectedHeader({ alg: \"HS256\" })\n+      .setIssuedAt()\n+      .setExpirationTime(\"12h\")\n+      .sign(new TextEncoder().encode(env.CMUX_TASK_RUN_JWT_SECRET));\n+\n+    return { jwt };\n+  },\n+});\n+\n // Internal query to get a task run by ID\n export const getById = internalQuery({\n   args: { id: v.id(\"taskRuns\") },\n@@ -762,6 +969,11 @@ export const updateStatusPublic = authMutation({\n     }\n \n     await ctx.db.patch(args.id, updates);\n+\n+    // After updating to a terminal status, check if we should update the task status\n+    if (args.status === \"completed\" || args.status === \"failed\") {\n+      await updateTaskStatusFromRuns(ctx, doc.taskId, teamId, userId);\n+    }\n   },\n });\n \n@@ -943,6 +1155,9 @@ export const complete = authMutation({\n       completedAt: now,\n       updatedAt: now,\n     });\n+\n+    // After marking this run as completed, check if we should update the task status\n+    await updateTaskStatusFromRuns(ctx, doc.taskId, teamId, userId);\n   },\n });\n \n@@ -969,6 +1184,9 @@ export const fail = authMutation({\n       completedAt: now,\n       updatedAt: now,\n     });\n+\n+    // After marking this run as failed, check if we should update the task status\n+    await updateTaskStatusFromRuns(ctx, doc.taskId, teamId, userId);\n   },\n });\n \n@@ -1107,6 +1325,9 @@ export const workerComplete = internalMutation({\n       updatedAt: now,\n     });\n \n+    // After marking this run as completed, check if we should update the task status\n+    await updateTaskStatusFromRuns(ctx, run.taskId, run.teamId, run.userId);\n+\n     return run;\n   },\n });\ndiff --git a/packages/convex/convex/tasks.ts b/packages/convex/convex/tasks.ts\nindex 8fb4be292..c351a857f 100644\n--- a/packages/convex/convex/tasks.ts\n+++ b/packages/convex/convex/tasks.ts\n@@ -182,6 +182,8 @@ export const create = authMutation({\n     ),\n     environmentId: v.optional(v.id(\"environments\")),\n     isCloudWorkspace: v.optional(v.boolean()),\n+    // Optional: create task runs atomically with the task\n+    selectedAgents: v.optional(v.array(v.string())),\n   },\n   handler: async (ctx, args) => {\n     const userId = ctx.identity.subject;\n@@ -209,7 +211,28 @@ export const create = authMutation({\n       isCloudWorkspace: args.isCloudWorkspace,\n     });\n \n-    return taskId;\n+    // If selectedAgents provided, create task runs atomically\n+    let taskRunIds: Id<\"taskRuns\">[] | undefined;\n+    if (args.selectedAgents && args.selectedAgents.length > 0) {\n+      taskRunIds = await Promise.all(\n+        args.selectedAgents.map(async (agentName) => {\n+          return ctx.db.insert(\"taskRuns\", {\n+            taskId,\n+            prompt: args.text,\n+            agentName,\n+            status: \"pending\",\n+            createdAt: now,\n+            updatedAt: now,\n+            userId,\n+            teamId,\n+            environmentId: args.environmentId,\n+            isCloudWorkspace: args.isCloudWorkspace,\n+          });\n+        }),\n+      );\n+    }\n+\n+    return { taskId, taskRunIds };\n   },\n });\n \ndiff --git a/packages/shared/src/socket-schemas.ts b/packages/shared/src/socket-schemas.ts\nindex 44bb7ffe3..ab15b6eea 100644\n--- a/packages/shared/src/socket-schemas.ts\n+++ b/packages/shared/src/socket-schemas.ts\n@@ -35,6 +35,8 @@ export const StartTaskSchema = z.object({\n   taskDescription: z.string(),\n   projectFullName: z.string(),\n   taskId: typedZid(\"tasks\"),\n+  // Pre-created task run IDs (one per agent) - if provided, server skips creating runs\n+  taskRunIds: z.array(typedZid(\"taskRuns\")).optional(),\n   selectedAgents: z.array(z.string()).optional(),\n   isCloudMode: z.boolean().optional().default(false),\n   images: z\ndiff --git a/packages/www-openapi-client/src/client/types.gen.ts b/packages/www-openapi-client/src/client/types.gen.ts\nindex 9e50be3a7..9d02858bd 100644\n--- a/packages/www-openapi-client/src/client/types.gen.ts\n+++ b/packages/www-openapi-client/src/client/types.gen.ts\n@@ -392,7 +392,7 @@ export type SetupInstanceBody = {\n     instanceId?: string;\n     selectedRepos?: Array<string>;\n     ttlSeconds?: number;\n-    snapshotId?: string | ('snapshot_mpzw0j37' | 'snapshot_u6orf3jx' | 'snapshot_pcmfvjra');\n+    snapshotId?: string | ('snapshot_st54kpzd' | 'snapshot_6isj88bc' | 'snapshot_pcmfvjra');\n };\n \n export type CreateEnvironmentResponse = {\n@@ -499,6 +499,7 @@ export type StartSandboxResponse = {\n     vscodeUrl: string;\n     workerUrl: string;\n     provider?: 'morph';\n+    vscodePersisted?: boolean;\n };\n \n export type StartSandboxBody = {\n","comments":[{"type":"issue_comment","id":3615782267,"prNumber":1189,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn76p182erw3rjr8frrydzbnxs7wqaat?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn76p182erw3rjr8frrydzbnxs7wqaat/run/kd71vjc4bnw4vtdjbpq33dphz17wqset/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1189?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 7 screenshots for commit `6490736` (2025-12-05 08:24:50.170 UTC).\n\n**Command bar modal \\(Cmd+K\\) overlaying the task detail page, showing the command palette interface**\n\n![command-bar-modal.png](https://adorable-wombat-701.convex.cloud/api/storage/0d55cfdb-21db-4979-95d1-e64dc8339006)\n\n**Full page view of the dashboard showing the task list in the sidebar and the main content area with the task input form**\n\n![dashboard-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/df90e79d-c67e-4287-8b2f-342bdc87e2ae)\n\n**Viewport screenshot of the dashboard showing the task creation interface and sidebar navigation**\n\n![dashboard-viewport.png](https://adorable-wombat-701.convex.cloud/api/storage/74fdc957-c86f-4f54-8876-9263c678d401)\n\n**Error state showing a React error that occurred during initial page load \\(prevDeps.join is not a function\\)**\n\n![error-state.png](https://adorable-wombat-701.convex.cloud/api/storage/93570320-6ebc-47a6-9b7a-bd8d9fa43a0b)\n\n**Full page view of the PR detail page for 'Optimize task run creation' showing the GitHub PR integration with file diffs**\n\n![task-detail-page-full.png](https://adorable-wombat-701.convex.cloud/api/storage/a3ba6a55-a778-4b11-af87-67af0edd7e62)\n\n**Viewport screenshot of the task detail page showing PR metadata, merge button, and code diff viewer**\n\n![task-detail-page-viewport.png](https://adorable-wombat-701.convex.cloud/api/storage/c1bf6915-ee51-4ece-8468-21f3d5f44e2f)\n\n**Task detail page with sidebar visible showing the task tree navigation and GitHub link**\n\n![task-detail-with-sidebar.png](https://adorable-wombat-701.convex.cloud/api/storage/75f206b6-8a8f-4253-b3f4-3db1d017aa10)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"63d954d191c23c9e509ecc3b2db62d3abf905cce","createdAt":"2025-12-05T08:24:51Z","updatedAt":"2025-12-05T08:25:24Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1189#issuecomment-3615782267"},{"type":"issue_comment","id":3615784054,"prNumber":1189,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn7fth1hc9z4qjte7zfxpyv7fs7wp54j?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn7fth1hc9z4qjte7zfxpyv7fs7wp54j/run/kd7eg2hse1e7m3s0srav1e0yfd7wq1t9/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1189?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"63d954d191c23c9e509ecc3b2db62d3abf905cce","createdAt":"2025-12-05T08:25:23Z","updatedAt":"2025-12-05T08:52:35Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1189#issuecomment-3615784054"},{"type":"issue_comment","id":3615873827,"prNumber":1189,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7627gzd0rgjtxtxv55yztsg17wqpb3?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7627gzd0rgjtxtxv55yztsg17wqpb3/run/kd77420p28gtjwnw1jvhfavqx17wq0f8/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1189?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 7 screenshots for commit `5ebea76` (2025-12-05 08:52:32.937 UTC).\n\n**Full dashboard view showing the task list, sidebar navigation with tasks and workspaces**\n\n![dashboard-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/877a5211-fa12-4223-a472-5c1e812e27e0)\n\n**Dashboard home view with task input area, showing the main interface for creating tasks**\n\n![dashboard-home-view.png](https://adorable-wombat-701.convex.cloud/api/storage/59191368-99f8-47c7-a060-71be0e37a22b)\n\n**Sidebar navigation panel showing active tasks, workspaces, and preview items**\n\n![sidebar-navigation.png](https://adorable-wombat-701.convex.cloud/api/storage/d0e03972-93be-47b7-9cb1-88486b39a84f)\n\n**Task detail page showing CI checks running status \\(2 passed, 7 running\\)**\n\n![task-detail-checks-running.png](https://adorable-wombat-701.convex.cloud/api/storage/94657e8d-7b82-4a33-a960-70686a75aa95)\n\n**Task detail page in loading state for 'Optimize task run creation' task**\n\n![task-detail-loading.png](https://adorable-wombat-701.convex.cloud/api/storage/62103d3d-28b6-42cd-9356-4401a3eec646)\n\n**Task detail page showing PR information and merge button for the optimization task**\n\n![task-detail-page.png](https://adorable-wombat-701.convex.cloud/api/storage/43c20107-b69f-4138-ba54-29b778d58369)\n\n**Task description input area with project selector and agent configuration**\n\n![task-input-area.png](https://adorable-wombat-701.convex.cloud/api/storage/21819739-3853-43af-b956-c7766336e06d)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"63d954d191c23c9e509ecc3b2db62d3abf905cce","createdAt":"2025-12-05T08:52:33Z","updatedAt":"2025-12-05T08:54:01Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1189#issuecomment-3615873827"},{"type":"issue_comment","id":3615877606,"prNumber":1189,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn70zht6n59r7jfh1g0bh6z2cd7wqzq3?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn70zht6n59r7jfh1g0bh6z2cd7wqzq3/run/kd7ex8ggvnmysr82qp7fkh5zkx7wp7hd/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1189?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 7 screenshots for commit `5ebea76` (2025-12-05 08:53:57.794 UTC).\n\n**Cloud workspace view showing 'Preview screenshots for PR \\#1189' with the 'screenshot-collector' task run expanded. The sidebar displays VS Code, Git diff, Browser, and Terminals links - demonstrating the UI difference where cloud workspaces show all workspace tools unlike local workspaces.**\n\n![cloud-workspace-sidebar-browser-terminals.png](https://famous-camel-162.convex.cloud/api/storage/1d381e71-4401-4fdb-91ab-1455c646ad78)\n\n**Full-page dashboard view showing the main navigation, task list with 'Optimize task run creation' task, GitHub tasks, and workspaces section. This view shows the overall layout of the application.**\n\n![dashboard-overview-optimize-task-run-creation.png](https://famous-camel-162.convex.cloud/api/storage/4c984b68-115c-4663-ae2b-2d4e7882f0c9)\n\n**Local workspace view showing 'Local workspace landing-ac' expanded with only the 'VS Code' link visible in the sidebar. This demonstrates the UI change where local workspaces display only VS Code \\(not Browser/Terminals\\).**\n\n![local-workspace-vscode-view-optimize-task-run-creation.png](https://famous-camel-162.convex.cloud/api/storage/76668ad7-35c8-4d36-88c6-b80db8f2af32)\n\n**Full-page PR diff view showing all 23 changed files with their diff statistics. Files include TaskTree.tsx \\(+114 -70\\), TaskRunTerminalPane.tsx \\(+43 -35\\), workspace-loading-indicator.tsx \\(+11 -1\\), and other modified components.**\n\n![pr-diff-view-optimize-task-run-creation.png](https://famous-camel-162.convex.cloud/api/storage/ef03e0f4-3d66-4907-97f7-eb88dd94e751)\n\n**PR overview page for 'Optimize task run creation' showing PR \\#1189 summary with +1046/-243 lines changed, 'Passed' status, branch information \\(optimize-task-run-creation → main\\), and action buttons \\(Squash and merge, Close PR, Open on GitHub\\).**\n\n![pr-overview-optimize-task-run-creation.png](https://famous-camel-162.convex.cloud/api/storage/eb0e8f93-7c00-4869-9326-730fb9dd185d)\n\n**Task view with sidebar showing the 'Optimize task run creation' task selected. The sidebar displays the task hierarchy and workspace organization.**\n\n![task-view-sidebar-optimize-task-run-creation.png](https://famous-camel-162.convex.cloud/api/storage/738bf730-6a38-4112-912c-0d57034abf59)\n\n**Terminals view in loading state showing 'Loading terminals…' text with 'New Terminal' button. This captures the WorkspaceLoadingIndicator component with the terminal variant that was added in this PR for improved terminal connection handling with auto-retry logic.**\n\n![terminals-loading-state.png](https://famous-camel-162.convex.cloud/api/storage/2b652e62-c975-4cc3-8894-20449a9ec637)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"63d954d191c23c9e509ecc3b2db62d3abf905cce","createdAt":"2025-12-05T08:54:00Z","updatedAt":"2025-12-05T09:03:11Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1189#issuecomment-3615877606"},{"type":"issue_comment","id":3615901284,"prNumber":1189,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn74qtr0q77qn75sdzs85dta717wqbmb?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn74qtr0q77qn75sdzs85dta717wqbmb/run/kd7f38bneh8hh0t6rnyk17vkcx7wq6vx/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1189?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 11 screenshots for commit `545e207` (2025-12-05 09:03:09.226 UTC).\n\n**Main dashboard view with task creation interface and sidebar navigation**\n\n![dashboard-main-view-optimize-task-run-creation.png](https://adorable-wombat-701.convex.cloud/api/storage/ddc006c4-79f6-462c-b017-1a8872e98048)\n\n**Error state showing 'prevDeps.join is not a function' error message**\n\n![error-page.png](https://adorable-wombat-701.convex.cloud/api/storage/5ae07da3-10d8-4ffa-ac69-1dce8bcdb30a)\n\n**Home page dashboard view showing task input area and workspaces sidebar**\n\n![home-page-optimize-task-run-creation.png](https://adorable-wombat-701.convex.cloud/api/storage/a6ca9260-9e4d-45b8-a4e9-122b8099967e)\n\n**Detailed PR checks section showing all CI/CD check results**\n\n![pr-checks-section-optimize-task-run-creation.png](https://adorable-wombat-701.convex.cloud/api/storage/a09cf886-e75e-4b2e-bb38-2b83f02e8a08)\n\n**PR header showing check status with 2 checks failed**\n\n![pr-header-checks-optimize-task-run-creation.png](https://adorable-wombat-701.convex.cloud/api/storage/b557b86c-8a43-4ddd-93fe-28aeb6352d41)\n\n**Sidebar showing TaskTree component with navigation links for tasks, workspaces, and previews**\n\n![sidebar-tasktree-optimize-task-run-creation.png](https://adorable-wombat-701.convex.cloud/api/storage/397a2120-e5c9-4397-8fb7-2d535092e21d)\n\n**Task detail page for PR \\#1189 showing loading state**\n\n![task-detail-page-optimize-task-run-creation.png](https://adorable-wombat-701.convex.cloud/api/storage/d8069b4c-f0c3-4fc0-b8c1-d8895ae89c85)\n\n**Task input command bar with text area and action buttons**\n\n![task-input-commandbar-optimize-task-run-creation.png](https://adorable-wombat-701.convex.cloud/api/storage/309b4bba-921f-449a-80b2-2fdb9aa3167f)\n\n**Full PR view showing file diffs, check status, and merge controls for optimize-task-run-creation PR**\n\n![task-pr-view-full-optimize-task-run-creation.png](https://adorable-wombat-701.convex.cloud/api/storage/9f38dd48-9445-4040-9638-9e758f7a6f8a)\n\n**VS Code interface within workspace showing file explorer and editor area**\n\n![vscode-iframe-optimize-task-run-creation.png](https://adorable-wombat-701.convex.cloud/api/storage/4c2209b1-f6bb-4261-b640-dba82de2ba69)\n\n**Workspace view with VS Code embedded in an iframe showing landing-ac workspace**\n\n![workspace-vscode-view-optimize-task-run-creation.png](https://adorable-wombat-701.convex.cloud/api/storage/5cdd708e-1205-4689-a736-bb7f54334afe)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"63d954d191c23c9e509ecc3b2db62d3abf905cce","createdAt":"2025-12-05T09:03:10Z","updatedAt":"2025-12-05T09:32:35Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1189#issuecomment-3615901284"},{"type":"issue_comment","id":3616009762,"prNumber":1189,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7fethb8y98zmfk1g5x98fg2x7wpm5x?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7fethb8y98zmfk1g5x98fg2x7wpm5x/run/kd72rkxnsfzsa56r20e2ce6kg97wpqf0/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1189?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 5 screenshots for commit `63d954d` (2025-12-05 09:32:33.753 UTC).\n\n**Full page view of the dashboard showing the task creation interface, sidebar with task list, workspaces, and previews sections**\n\n![dashboard-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/08e37c9f-21c6-4f8d-be93-8071fa6382a5)\n\n**Dashboard view focusing on the sidebar with pull requests, workspaces, and previews list - shows the task tree UI with archive buttons**\n\n![dashboard-sidebar-view.png](https://adorable-wombat-701.convex.cloud/api/storage/fb49b1f7-206c-4714-981a-a229b5424975)\n\n**Task detail view for 'Optimize task run creation' task showing the main content area with sidebar navigation**\n\n![task-detail-view.png](https://adorable-wombat-701.convex.cloud/api/storage/9e787e5a-5442-4654-8e33-e12c03ee100a)\n\n**Top portion of the task run detail page showing the PR header with merge status, checks passed indicator, and action buttons**\n\n![task-run-detail-top.png](https://adorable-wombat-701.convex.cloud/api/storage/75a6a13b-d8c2-46aa-8f40-2126abad4904)\n\n**GitHub diff view showing code changes in the PR including CommandBar.tsx, TaskRunTerminalPane.tsx, and other modified files with side-by-side comparison**\n\n![task-run-github-diff.png](https://adorable-wombat-701.convex.cloud/api/storage/80fb8040-35bd-4611-880d-6b04edd8eb0e)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"63d954d191c23c9e509ecc3b2db62d3abf905cce","createdAt":"2025-12-05T09:32:34Z","updatedAt":"2025-12-05T09:34:30Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1189#issuecomment-3616009762"},{"type":"issue_comment","id":3616020283,"prNumber":1189,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn70cqhr9wwjc335v7thcfks7h7wq5xp?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn70cqhr9wwjc335v7thcfks7h7wq5xp/run/kd767bjpd9gxjyqbs6fy1b1egx7wp735/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1189?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 10 screenshots for commit `ecb1f2d` (2025-12-05 09:34:28.359 UTC).\n\n**Command bar input field where users describe tasks**\n\n![command-bar-input.png](https://famous-camel-162.convex.cloud/api/storage/15c6fd4c-104d-4349-869b-bbbd0dc41f32)\n\n**Full dashboard view showing the main interface with command bar, task tree, and workspace sections**\n\n![dashboard-full-page.png](https://famous-camel-162.convex.cloud/api/storage/7b8d7b11-cbe1-4e7d-bb5d-e1fe7687495c)\n\n**Main content area with command input and task controls**\n\n![main-content-area.png](https://famous-camel-162.convex.cloud/api/storage/dbb3801e-823b-45e3-b23f-317c1f556b68)\n\n**Full PR detail page showing the optimize-task-run-creation pull request with file diffs and changes**\n\n![pr-detail-page-full.png](https://famous-camel-162.convex.cloud/api/storage/0295b613-3eb1-4840-b997-7d508a2bc66f)\n\n**PR header showing title, merge controls, and PR metadata**\n\n![pr-header-section.png](https://famous-camel-162.convex.cloud/api/storage/d31cb07c-2236-42fd-8b84-e37fe7bb06d6)\n\n**Start task button and workspace creation controls**\n\n![start-task-button.png](https://famous-camel-162.convex.cloud/api/storage/cbfc7913-f86a-43ba-900e-b272de4e8b99)\n\n**Task page in loading state showing the loading indicator for workspace creation**\n\n![task-page-loading-state.png](https://famous-camel-162.convex.cloud/api/storage/5c0ba91c-7aa2-40ba-bc30-707d875ada9e)\n\n**Task sections showing Ready to review, In progress, and Merged categories**\n\n![task-sections.png](https://famous-camel-162.convex.cloud/api/storage/2c35dcc3-4230-4f4a-ba72-fc0de704f54b)\n\n**Task tree sidebar navigation showing tasks, pull requests, workspaces, and previews**\n\n![task-tree-sidebar.png](https://famous-camel-162.convex.cloud/api/storage/1a1e748a-5b8f-4f82-8774-81823c8871b2)\n\n**Workspaces section showing workspace count**\n\n![workspaces-section.png](https://famous-camel-162.convex.cloud/api/storage/7375942e-fc02-42f0-ab00-d27d681ce063)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"63d954d191c23c9e509ecc3b2db62d3abf905cce","createdAt":"2025-12-05T09:34:29Z","updatedAt":"2025-12-05T09:34:29Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1189#issuecomment-3616020283"}]}
{"number":1188,"title":"Add right-click Reload for terminal iframe","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1188","headRef":"cmux/add-right-click-reload-for-terminal-iframe-toqec","headSha":"5ae19041ee7f19747d2b4adc3a3b7a3b53b340e9","baseRef":"main","baseSha":"2cd09dcc0cdea7176910d5c5b16293ba91c71c19","createdAt":"2025-12-05T05:58:50Z","updatedAt":"2025-12-05T08:29:13Z","diff":"diff --git a/apps/client/src/components/TaskTree.tsx b/apps/client/src/components/TaskTree.tsx\nindex c63dc81e1..6e1b1360f 100644\n--- a/apps/client/src/components/TaskTree.tsx\n+++ b/apps/client/src/components/TaskTree.tsx\n@@ -14,6 +14,11 @@ import { useOpenWithActions } from \"@/hooks/useOpenWithActions\";\n import { useTaskRename } from \"@/hooks/useTaskRename\";\n import { isElectron } from \"@/lib/electron\";\n import { isFakeConvexId } from \"@/lib/fakeConvexId\";\n+import {\n+  getTaskRunPersistKey,\n+  getTaskRunBrowserPersistKey,\n+} from \"@/lib/persistent-webview-keys\";\n+import { persistentIframeManager } from \"@/lib/persistentIframeManager\";\n import type { AnnotatedTaskRun, TaskRunWithChildren } from \"@/types/task\";\n import { ContextMenu } from \"@base-ui-components/react/context-menu\";\n import { api } from \"@cmux/convex/api\";\n@@ -1696,6 +1701,7 @@ interface TaskRunDetailLinkProps {\n   className?: string;\n   onClick?: (event: MouseEvent<HTMLAnchorElement>) => void;\n   trailing?: ReactNode;\n+  onReload?: () => void;\n }\n \n function TaskRunDetailLink({\n@@ -1707,8 +1713,9 @@ function TaskRunDetailLink({\n   className,\n   onClick,\n   trailing,\n+  onReload,\n }: TaskRunDetailLinkProps) {\n-  return (\n+  const linkElement = (\n     <Link\n       to={to}\n       params={params}\n@@ -1731,6 +1738,29 @@ function TaskRunDetailLink({\n       ) : null}\n     </Link>\n   );\n+\n+  if (!onReload) {\n+    return linkElement;\n+  }\n+\n+  return (\n+    <ContextMenu.Root>\n+      <ContextMenu.Trigger>{linkElement}</ContextMenu.Trigger>\n+      <ContextMenu.Portal>\n+        <ContextMenu.Positioner className=\"outline-none z-[var(--z-context-menu)]\">\n+          <ContextMenu.Popup className=\"origin-[var(--transform-origin)] rounded-md bg-white dark:bg-neutral-800 py-1 text-neutral-900 dark:text-neutral-100 shadow-lg shadow-gray-200 outline-1 outline-neutral-200 transition-[opacity] data-[ending-style]:opacity-0 dark:shadow-none dark:-outline-offset-1 dark:outline-neutral-700\">\n+            <ContextMenu.Item\n+              className=\"flex items-center gap-2 cursor-default py-1.5 pr-8 pl-3 text-[13px] leading-5 outline-none select-none data-[highlighted]:relative data-[highlighted]:z-0 data-[highlighted]:text-white data-[highlighted]:before:absolute data-[highlighted]:before:inset-x-1 data-[highlighted]:before:inset-y-0 data-[highlighted]:before:z-[-1] data-[highlighted]:before:rounded-sm data-[highlighted]:before:bg-neutral-900 dark:data-[highlighted]:before:bg-neutral-700\"\n+              onClick={onReload}\n+            >\n+              <RefreshCw className=\"w-3.5 h-3.5 text-neutral-600 dark:text-neutral-300\" />\n+              <span>Reload</span>\n+            </ContextMenu.Item>\n+          </ContextMenu.Popup>\n+        </ContextMenu.Positioner>\n+      </ContextMenu.Portal>\n+    </ContextMenu.Root>\n+  );\n }\n \n interface AddPreviewInputProps {\n@@ -1965,6 +1995,18 @@ function TaskRunDetails({\n     ]\n   );\n \n+  const handleReloadVSCode = useCallback(() => {\n+    persistentIframeManager.reloadIframe(getTaskRunPersistKey(run._id));\n+  }, [run._id]);\n+\n+  const handleReloadBrowser = useCallback(() => {\n+    persistentIframeManager.reloadIframe(getTaskRunBrowserPersistKey(run._id));\n+  }, [run._id]);\n+\n+  const handleReloadTerminals = useCallback(() => {\n+    window.location.reload();\n+  }, []);\n+\n   if (!isExpanded) {\n     return null;\n   }\n@@ -2017,6 +2059,7 @@ function TaskRunDetails({\n           label=\"VS Code\"\n           indentLevel={indentLevel}\n           trailing={environmentErrorIndicator}\n+          onReload={handleReloadVSCode}\n         />\n       ) : null}\n \n@@ -2035,6 +2078,7 @@ function TaskRunDetails({\n           icon={<Monitor className=\"w-3 h-3 mr-2 text-neutral-400\" />}\n           label=\"Browser\"\n           indentLevel={indentLevel}\n+          onReload={handleReloadBrowser}\n         />\n       ) : null}\n \n@@ -2045,6 +2089,7 @@ function TaskRunDetails({\n           icon={<TerminalSquare className=\"w-3 h-3 mr-2 text-neutral-400\" />}\n           label=\"Terminals\"\n           indentLevel={indentLevel}\n+          onReload={handleReloadTerminals}\n         />\n       ) : null}\n \ndiff --git a/apps/client/src/lib/persistentIframeManager.ts b/apps/client/src/lib/persistentIframeManager.ts\nindex 4bf7400fa..fd772afbf 100644\n--- a/apps/client/src/lib/persistentIframeManager.ts\n+++ b/apps/client/src/lib/persistentIframeManager.ts\n@@ -600,6 +600,19 @@ class PersistentIframeManager {\n       return false;\n     }\n   }\n+\n+  reloadIframe(key: string): boolean {\n+    const entry = this.iframes.get(key);\n+    if (!entry) return false;\n+\n+    try {\n+      entry.iframe.src = entry.url;\n+      return true;\n+    } catch (error) {\n+      console.error(`Failed to reload iframe \"${key}\"`, error);\n+      return false;\n+    }\n+  }\n }\n \n // Export singleton instance\n","comments":[{"type":"issue_comment","id":3615437053,"prNumber":1188,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7b2297d4syq7ngtez590hmax7wqbd9?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7b2297d4syq7ngtez590hmax7wqbd9/run/kd7baysnwkzq31kgt5mqb30yh57wq53b/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1188?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"5ae19041ee7f19747d2b4adc3a3b7a3b53b340e9","createdAt":"2025-12-05T06:01:58Z","updatedAt":"2025-12-05T06:01:58Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1188#issuecomment-3615437053"}]}
{"number":1187,"title":"Extract reusable loading component for browser and terminals","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1187","headRef":"cmux/extract-reusable-loading-component-for-browser-and-1hk0s","headSha":"226a3af61f5c20e7c497c3448357d1711e42bf46","baseRef":"main","baseSha":"2cd09dcc0cdea7176910d5c5b16293ba91c71c19","createdAt":"2025-12-05T05:51:36Z","updatedAt":"2025-12-05T08:10:03Z","diff":"diff --git a/apps/client/src/components/TaskRunTerminalPane.tsx b/apps/client/src/components/TaskRunTerminalPane.tsx\nindex 3a4130407..8e9d5b963 100644\n--- a/apps/client/src/components/TaskRunTerminalPane.tsx\n+++ b/apps/client/src/components/TaskRunTerminalPane.tsx\n@@ -1,7 +1,7 @@\n import { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\n-import { MonitorUp } from \"lucide-react\";\n import { useQuery, useQueryClient } from \"@tanstack/react-query\";\n import { TaskRunTerminalSession } from \"./task-run-terminal-session\";\n+import { WorkspaceLoadingIndicator } from \"./workspace-loading-indicator\";\n import { toMorphXtermBaseUrl } from \"@/lib/toProxyWorkspaceUrl\";\n import {\n   createTerminalTab,\n@@ -202,58 +202,66 @@ export function TaskRunTerminalPane({ workspaceUrl }: TaskRunTerminalPaneProps)\n \n   if (!workspaceUrl || !baseUrl) {\n     return (\n-      <div className=\"flex h-full flex-col items-center justify-center gap-2 text-sm text-neutral-500 dark:text-neutral-400\">\n-        <MonitorUp className=\"size-4 animate-pulse\" aria-hidden />\n-        <span>Terminal is starting...</span>\n+      <div className=\"flex h-full items-center justify-center\">\n+        <WorkspaceLoadingIndicator variant=\"terminal\" status=\"loading\" />\n       </div>\n     );\n   }\n \n   if (isTabsLoading) {\n     return (\n-      <div className=\"flex h-full flex-col items-center justify-center gap-2 text-sm text-neutral-500 dark:text-neutral-400\">\n-        <MonitorUp className=\"size-4 animate-pulse\" aria-hidden />\n-        <span>Loading terminal...</span>\n+      <div className=\"flex h-full items-center justify-center\">\n+        <WorkspaceLoadingIndicator\n+          variant=\"terminal\"\n+          status=\"loading\"\n+          loadingTitle=\"Loading terminal\"\n+          loadingDescription=\"Fetching terminal sessions...\"\n+        />\n       </div>\n     );\n   }\n \n   if (isTabsError) {\n     return (\n-      <div className=\"flex h-full flex-col items-center justify-center gap-2 text-sm text-neutral-500 dark:text-neutral-400\">\n-        <MonitorUp className=\"size-4 text-red-500\" aria-hidden />\n-        <span className=\"text-red-500 dark:text-red-400\">\n-          {tabsError instanceof Error ? tabsError.message : \"Failed to load terminal\"}\n-        </span>\n+      <div className=\"flex h-full items-center justify-center\">\n+        <WorkspaceLoadingIndicator\n+          variant=\"terminal\"\n+          status=\"error\"\n+          errorDescription={\n+            tabsError instanceof Error ? tabsError.message : undefined\n+          }\n+        />\n       </div>\n     );\n   }\n \n   if (terminalIds.length === 0) {\n+    const retryButton = autoCreateError ? (\n+      <button\n+        type=\"button\"\n+        onClick={handleManualRetry}\n+        className=\"inline-flex items-center justify-center rounded border border-neutral-300 px-3 py-1 text-xs font-medium text-neutral-600 transition hover:border-neutral-400 hover:text-neutral-800 dark:border-neutral-700 dark:text-neutral-300 dark:hover:border-neutral-500 dark:hover:text-neutral-100\"\n+      >\n+        Retry terminal\n+      </button>\n+    ) : null;\n+\n+    const attemptInfo =\n+      !autoCreateError && autoCreateAttemptCount > 0\n+        ? `Attempt ${Math.min(autoCreateAttemptCount, MAX_AUTO_CREATE_ATTEMPTS)} of ${MAX_AUTO_CREATE_ATTEMPTS}`\n+        : undefined;\n+\n     return (\n-      <div className=\"flex h-full flex-col items-center justify-center gap-3 text-center text-sm text-neutral-500 dark:text-neutral-400\">\n-        <MonitorUp className=\"size-4 animate-pulse\" aria-hidden />\n-        <div className=\"flex flex-col gap-1\">\n-          <span>\n-            {autoCreateError\n-              ? autoCreateError\n-              : \"Waiting for a terminal session...\"}\n-          </span>\n-          {!autoCreateError && autoCreateAttemptCount > 0 ? (\n-            <span className=\"text-xs text-neutral-400 dark:text-neutral-500\">\n-              {`Attempt ${Math.min(autoCreateAttemptCount, MAX_AUTO_CREATE_ATTEMPTS)} of ${MAX_AUTO_CREATE_ATTEMPTS}`}\n-            </span>\n-          ) : null}\n-        </div>\n-        {autoCreateError ? (\n-          <button\n-            type=\"button\"\n-            onClick={handleManualRetry}\n-            className=\"inline-flex items-center justify-center rounded border border-neutral-300 px-3 py-1 text-xs font-medium text-neutral-600 transition hover:border-neutral-400 hover:text-neutral-800 dark:border-neutral-700 dark:text-neutral-300 dark:hover:border-neutral-500 dark:hover:text-neutral-100\"\n-          >\n-            Retry terminal\n-          </button>\n-        ) : null}\n+      <div className=\"flex h-full items-center justify-center\">\n+        <WorkspaceLoadingIndicator\n+          variant=\"terminal\"\n+          status={autoCreateError ? \"error\" : \"loading\"}\n+          loadingTitle=\"Connecting to terminal\"\n+          loadingDescription={attemptInfo ?? \"Waiting for a terminal session...\"}\n+          errorTitle=\"Terminal connection failed\"\n+          errorDescription={autoCreateError ?? undefined}\n+          action={retryButton}\n+        />\n       </div>\n     );\n   }\ndiff --git a/apps/client/src/components/workspace-loading-indicator.tsx b/apps/client/src/components/workspace-loading-indicator.tsx\nindex 93000f2cc..ddd330300 100644\n--- a/apps/client/src/components/workspace-loading-indicator.tsx\n+++ b/apps/client/src/components/workspace-loading-indicator.tsx\n@@ -4,7 +4,7 @@ import { cn } from \"@/lib/utils\";\n \n export type WorkspaceLoadingStatus = \"loading\" | \"error\";\n \n-type WorkspaceLoadingVariant = \"vscode\" | \"browser\";\n+type WorkspaceLoadingVariant = \"vscode\" | \"browser\" | \"terminal\";\n \n export interface WorkspaceLoadingIndicatorProps {\n   status: WorkspaceLoadingStatus;\n@@ -14,6 +14,8 @@ export interface WorkspaceLoadingIndicatorProps {\n   loadingDescription?: string;\n   errorTitle?: string;\n   errorDescription?: string;\n+  /** Optional action button for error states */\n+  action?: React.ReactNode;\n }\n \n const VARIANT_COPY: Record<\n@@ -39,6 +41,12 @@ const VARIANT_COPY: Record<\n     errorTitle: \"We couldn't launch the browser preview\",\n     errorDescription: \"Refresh the page or switch to cloud mode, then try again.\",\n   },\n+  terminal: {\n+    loadingTitle: \"Starting terminal\",\n+    loadingDescription: \"Connecting to the workspace terminal session.\",\n+    errorTitle: \"We couldn't connect to the terminal\",\n+    errorDescription: \"Refresh the page or try again.\",\n+  },\n };\n \n export const WorkspaceLoadingIndicator = memo(function WorkspaceLoadingIndicator({\n@@ -49,6 +57,7 @@ export const WorkspaceLoadingIndicator = memo(function WorkspaceLoadingIndicator\n   loadingDescription,\n   errorTitle,\n   errorDescription,\n+  action,\n }: WorkspaceLoadingIndicatorProps) {\n   const copy = VARIANT_COPY[variant];\n   const isError = status === \"error\";\n@@ -82,6 +91,7 @@ export const WorkspaceLoadingIndicator = memo(function WorkspaceLoadingIndicator\n           {resolvedDescription}\n         </p>\n       </div>\n+      {action}\n     </div>\n   );\n });\n","comments":[{"type":"issue_comment","id":3615437669,"prNumber":1187,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn78wq72t71s4cee5fa6axkfqn7wqz1k?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn78wq72t71s4cee5fa6axkfqn7wqz1k/run/kd7278zv56tz9wzka2jkw47rns7wpsdv/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1187?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 5 screenshots for commit `226a3af` (2025-12-05 06:02:13.148 UTC).\n\n**Error state comparison - new version adds support for optional action buttons \\(retry terminal button\\) and better error messaging**\n\n![error-state-with-retry-button.png](https://famous-camel-162.convex.cloud/api/storage/480aabe5-3f80-4e0c-b2dc-93d152963920)\n\n**Summary of key changes including new terminal variant, action prop support, and consistent styling improvements**\n\n![key-changes-summary.png](https://famous-camel-162.convex.cloud/api/storage/7fa30b0d-6170-4f52-a741-101d45eb6578)\n\n**Loading state comparison - BEFORE shows simple icon+text, AFTER shows structured component with circular badge, title, and description**\n\n![loading-state-before-after.png](https://famous-camel-162.convex.cloud/api/storage/84039e0c-4b78-4976-90ac-eccbfedc8f19)\n\n**Loading with progress indicator - shows how attempt count is now cleanly integrated into the description field with improved structure**\n\n![loading-with-progress-comparison.png](https://famous-camel-162.convex.cloud/api/storage/73b599c2-59fe-40a3-9bbc-1ef2e9f6d2c5)\n\n**Full comparison view showing before/after of terminal loading states - demonstrates the extraction of WorkspaceLoadingIndicator component with improved visual hierarchy**\n\n![terminal-loading-component-comparison.png](https://famous-camel-162.convex.cloud/api/storage/25f0dfd8-9b88-4259-bafe-f488d70be95a)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"226a3af61f5c20e7c497c3448357d1711e42bf46","createdAt":"2025-12-05T06:02:15Z","updatedAt":"2025-12-05T06:02:15Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1187#issuecomment-3615437669"}]}
{"number":1186,"title":"remove cmux.dev from sidebar; display cmux","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1186","headRef":"cmux/remove-cmux-dev-from-sidebar-display-cmux-i8cwd","headSha":"fce3a5934a4b220de2e8c3346a6e70eab63014ed","baseRef":"main","baseSha":"9fbe0b79c2bfa90dcc4325335d381b8d19255731","createdAt":"2025-12-05T02:37:01Z","updatedAt":"2025-12-05T05:08:37Z","diff":"diff --git a/apps/client/src/components/logo/cmux-logo.tsx b/apps/client/src/components/logo/cmux-logo.tsx\nindex 99f9987af..264956c0b 100644\n--- a/apps/client/src/components/logo/cmux-logo.tsx\n+++ b/apps/client/src/components/logo/cmux-logo.tsx\n@@ -159,8 +159,7 @@ export default function CmuxLogo({\n           y={162}\n           fontSize={108}\n         >\n-          cmux.dev\n-          {/* cmux */}\n+          cmux\n         </text>\n       )}\n \n","comments":[{"type":"issue_comment","id":3615088944,"prNumber":1186,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.dev/austin-dev/task/kn7bc91q032asz0mnezjec75ms7wqrhg?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.dev/austin-dev/task/kn7bc91q032asz0mnezjec75ms7wqrhg/run/kd7cctmxp96mqk4xxn76c5khhh7wpdy9/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1186?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 5 screenshots for commit `fce3a59` (2025-12-05 02:45:48.157 UTC).\n\n**Full page screenshot of the dashboard showing the sidebar with the updated 'cmux' logo \\(changed from 'cmux.dev'\\)**\n\n![dashboard-full-page.png](https://famous-camel-162.convex.cloud/api/storage/dc541e0d-c3b4-4d21-87e3-3cb1e6d5ff6a)\n\n**Environments page showing the updated 'cmux' logo in the sidebar**\n\n![environments-page.png](https://famous-camel-162.convex.cloud/api/storage/3944c47a-cc0e-48e6-92fc-37625f7ee96a)\n\n**Home/dashboard page with the sidebar showing the updated 'cmux' logo**\n\n![home-dashboard-page.png](https://famous-camel-162.convex.cloud/api/storage/55b8de4a-b553-4bcf-af61-859e7bdf7bf2)\n\n**Settings page displaying the sidebar with the updated 'cmux' logo**\n\n![settings-page.png](https://famous-camel-162.convex.cloud/api/storage/595cd53e-27df-4208-807c-924d82cfb966)\n\n**Viewport screenshot of the dashboard with clear view of the sidebar displaying 'cmux' logo**\n\n![sidebar-with-logo.png](https://famous-camel-162.convex.cloud/api/storage/a56144f6-79ed-4c53-8211-3ddbc7cba7c8)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"fce3a5934a4b220de2e8c3346a6e70eab63014ed","createdAt":"2025-12-05T02:45:50Z","updatedAt":"2025-12-05T02:53:50Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1186#issuecomment-3615088944"},{"type":"issue_comment","id":3615102785,"prNumber":1186,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7cwnwawa22x6y9q34y3hdz317wqamb?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7cwnwawa22x6y9q34y3hdz317wqamb/run/kd771zpf4mktvqer0380yj2s957wqdy0/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1186?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 6 screenshots for commit `fce3a59` (2025-12-05 02:53:48.581 UTC).\n\n**Full page screenshot at 2560x1440 resolution \\(wide view\\)**\n\n![full-page-wide-view.png](https://adorable-wombat-701.convex.cloud/api/storage/8e041c03-eb2c-44dd-83c7-789c0ef0ecc6)\n\n**Full page screenshot at 1920x1080 resolution**\n\n![full-page-with-sidebar-logo.png](https://adorable-wombat-701.convex.cloud/api/storage/ecba9c1a-e65d-4c92-b8b7-c575b1f7e407)\n\n**Logo comparison in light mode showing sidebar context with the updated 'cmux' wordmark and before/after comparison \\(cmux.dev → cmux\\)**\n\n![logo-comparison-before-after.png](https://adorable-wombat-701.convex.cloud/api/storage/7bed358a-784d-4fb8-a038-b32f52479c1c)\n\n**Logo comparison in dark mode showing sidebar context with the updated 'cmux' wordmark and before/after comparison \\(cmux.dev → cmux\\)**\n\n![logo-comparison-dark-mode.png](https://adorable-wombat-701.convex.cloud/api/storage/12edbd1a-8c1f-4a4f-9a82-9c91728072f4)\n\n**Clean side-by-side comparison of the logo change: BEFORE \\(cmux.dev\\) vs AFTER \\(cmux\\)**\n\n![logo-side-by-side-comparison.png](https://adorable-wombat-701.convex.cloud/api/storage/8d8d760e-88a6-420a-bbe4-5896567b5871)\n\n**Screenshot with smaller viewport \\(1280x800\\) focusing on sidebar area**\n\n![sidebar-focused-view.png](https://adorable-wombat-701.convex.cloud/api/storage/1e92c6c0-507c-4e4f-9cab-04c48fbd733a)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"fce3a5934a4b220de2e8c3346a6e70eab63014ed","createdAt":"2025-12-05T02:53:49Z","updatedAt":"2025-12-05T02:53:49Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1186#issuecomment-3615102785"}]}
{"number":1184,"title":"Show only VSCode link for local workspaces","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1184","headRef":"cmux/show-only-vs-code-link-for-local-workspaces-aizse","headSha":"657838aadd2708ce6f7390a33a3a730d9561e69f","baseRef":"main","baseSha":"e51d256c5d2b6dc26cca3698433106c9931f6578","createdAt":"2025-12-05T02:20:58Z","updatedAt":"2025-12-05T02:28:47Z","diff":"diff --git a/apps/client/src/components/TaskTree.tsx b/apps/client/src/components/TaskTree.tsx\nindex 5b6e15934..083657c7f 100644\n--- a/apps/client/src/components/TaskTree.tsx\n+++ b/apps/client/src/components/TaskTree.tsx\n@@ -335,6 +335,8 @@ function TaskTreeInner({\n   defaultExpanded = false,\n   teamSlugOrId,\n }: TaskTreeProps) {\n+  const navigate = useNavigate();\n+\n   // Get the current route to determine if this task is selected\n   const location = useLocation();\n   const isTaskSelected = useMemo(\n@@ -381,6 +383,18 @@ function TaskTreeInner({\n   );\n   const hasVisibleRuns = activeRunsFlat.length > 0;\n   const showRunNumbers = flattenedRuns.length > 1;\n+\n+  // For local workspaces, find the run with VSCode to navigate to VSCode view directly\n+  const localWorkspaceRunWithVscode = useMemo(() => {\n+    if (!task.isLocalWorkspace) {\n+      return null;\n+    }\n+    // Find the first active run with a running VSCode instance\n+    return activeRunsFlat.find(\n+      (run) => run.vscode?.status === \"running\" && run.vscode?.url\n+    ) ?? null;\n+  }, [task.isLocalWorkspace, activeRunsFlat]);\n+\n   const runMenuEntries = useMemo(\n     () =>\n       annotateAgentOrdinals(flattenedRuns).map((run) => ({\n@@ -680,10 +694,10 @@ function TaskTreeInner({\n     />\n   );\n   const taskTitleContent = isRenaming ? renameInputElement : taskTitleValue;\n-  const canExpand = true;\n   const isCrownEvaluating = task.crownEvaluationStatus === \"in_progress\";\n   const isLocalWorkspace = task.isLocalWorkspace;\n   const isCloudWorkspace = task.isCloudWorkspace;\n+  const canExpand = true;\n \n   const taskLeadingIcon = (() => {\n     if (isCrownEvaluating) {\n@@ -806,7 +820,11 @@ function TaskTreeInner({\n               params={{ teamSlugOrId, taskId: task._id }}\n               search={{ runId: undefined }}\n               activeOptions={{ exact: true }}\n-              className=\"group block\"\n+              className={clsx(\n+                \"group block\",\n+                // For local workspaces, manually add active class since we navigate to VSCode sub-route\n+                localWorkspaceRunWithVscode && isTaskSelected && \"active\"\n+              )}\n               data-focus-visible={isTaskLinkFocusVisible ? \"true\" : undefined}\n               onMouseEnter={handlePrefetch}\n               onFocus={handleTaskLinkFocus}\n@@ -825,6 +843,20 @@ function TaskTreeInner({\n                   event.preventDefault();\n                   return;\n                 }\n+                // For local workspaces with active VSCode, expand and navigate to VSCode view\n+                if (localWorkspaceRunWithVscode) {\n+                  event.preventDefault();\n+                  setIsExpanded(true);\n+                  void navigate({\n+                    to: \"/$teamSlugOrId/task/$taskId/run/$runId/vscode\",\n+                    params: {\n+                      teamSlugOrId,\n+                      taskId: task._id,\n+                      runId: localWorkspaceRunWithVscode._id,\n+                    },\n+                  });\n+                  return;\n+                }\n                 handleToggle(event);\n               }}\n             >\n@@ -966,7 +998,25 @@ function TaskTreeInner({\n           </ContextMenu.Portal>\n         </ContextMenu.Root>\n \n-        {isExpanded ? (\n+        {/* For local workspaces, only show VSCode link when expanded */}\n+        {isExpanded && localWorkspaceRunWithVscode ? (\n+          <TaskRunDetailLink\n+            to=\"/$teamSlugOrId/task/$taskId/run/$runId/vscode\"\n+            params={{\n+              teamSlugOrId,\n+              taskId: task._id,\n+              runId: localWorkspaceRunWithVscode._id,\n+            }}\n+            icon={\n+              <VSCodeIcon className=\"w-3 h-3 mr-2 text-neutral-400 grayscale opacity-60\" />\n+            }\n+            label=\"VS Code\"\n+            indentLevel={level + 1}\n+          />\n+        ) : null}\n+\n+        {/* For non-local workspaces, show normal task runs content */}\n+        {isExpanded && !localWorkspaceRunWithVscode ? (\n           <TaskRunsContent\n             taskId={task._id}\n             teamSlugOrId={teamSlugOrId}\ndiff --git a/apps/client/src/components/dashboard/TaskItem.tsx b/apps/client/src/components/dashboard/TaskItem.tsx\nindex b7dba12f9..9102cd578 100644\n--- a/apps/client/src/components/dashboard/TaskItem.tsx\n+++ b/apps/client/src/components/dashboard/TaskItem.tsx\n@@ -12,7 +12,7 @@ import { api } from \"@cmux/convex/api\";\n import type { Doc } from \"@cmux/convex/dataModel\";\n import type { RunEnvironmentSummary } from \"@/types/task\";\n import { useClipboard } from \"@mantine/hooks\";\n-import { Link } from \"@tanstack/react-router\";\n+import { Link, useNavigate } from \"@tanstack/react-router\";\n import clsx from \"clsx\";\n import { useQuery as useConvexQuery, useMutation } from \"convex/react\";\n // Read team slug from path to avoid route type coupling\n@@ -41,6 +41,7 @@ export const TaskItem = memo(function TaskItem({\n }: TaskItemProps) {\n   const clipboard = useClipboard({ timeout: 2000 });\n   const { archiveWithUndo, unarchive } = useArchiveTask(teamSlugOrId);\n+  const navigate = useNavigate();\n   const isOptimisticUpdate = task._id.includes(\"-\") && task._id.length === 36;\n   const canRename = !isOptimisticUpdate;\n \n@@ -169,6 +170,17 @@ export const TaskItem = memo(function TaskItem({\n     return null;\n   }, [hasActiveVSCode, runWithVSCode]);\n \n+  // For local workspaces, find the run with VSCode to navigate to VSCode view directly\n+  const localWorkspaceRunWithVscode = useMemo(() => {\n+    if (!task.isLocalWorkspace) {\n+      return null;\n+    }\n+    if (!hasActiveVSCode || !runWithVSCode) {\n+      return null;\n+    }\n+    return runWithVSCode;\n+  }, [task.isLocalWorkspace, hasActiveVSCode, runWithVSCode]);\n+\n   const handleLinkClick = useCallback(\n     (event: React.MouseEvent<HTMLAnchorElement>) => {\n       // Don't navigate if we're renaming or if modifier keys are pressed\n@@ -183,8 +195,21 @@ export const TaskItem = memo(function TaskItem({\n         event.preventDefault();\n         return;\n       }\n+      // For local workspaces with active VSCode, navigate to VSCode view directly\n+      if (localWorkspaceRunWithVscode) {\n+        event.preventDefault();\n+        void navigate({\n+          to: \"/$teamSlugOrId/task/$taskId/run/$runId/vscode\",\n+          params: {\n+            teamSlugOrId,\n+            taskId: task._id,\n+            runId: localWorkspaceRunWithVscode._id,\n+          },\n+        });\n+        return;\n+      }\n     },\n-    [isRenaming]\n+    [isRenaming, localWorkspaceRunWithVscode, navigate, teamSlugOrId, task._id]\n   );\n \n   const handleCopy = useCallback(\n","comments":[{"type":"issue_comment","id":3615052745,"prNumber":1184,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn75renh7ecp4ecn1q0jdtpmjd7wq5bv?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn75renh7ecp4ecn1q0jdtpmjd7wq5bv/run/kd71mta9wwbz4h31f3yr5ns8e97wqk38/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1184?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 6 screenshots for commit `657838a` (2025-12-05 02:24:55.385 UTC).\n\n**Final dashboard view with the local workspace in collapsed state, showing the overall UI after the changes**\n\n![dashboard-final-view-with-local-workspace-collapsed.png](https://adorable-wombat-701.convex.cloud/api/storage/6f52cdc1-e48f-48a9-b0c2-54202278e5ea)\n\n**Dashboard view showing the local workspace 'Local workspace landing-ac' in collapsed state before any interaction**\n\n![dashboard-view-before-clicking-workspace.png](https://adorable-wombat-701.convex.cloud/api/storage/efc65dc1-90f5-4a79-af6a-58d2af5fc672)\n\n**Regular \\(non-local\\) task view showing the 'Show only VSCode link for local workspaces' task with GitHub link visible, demonstrating the contrast with local workspaces**\n\n![regular-task-view-with-github-link.png](https://adorable-wombat-701.convex.cloud/api/storage/f91b7e07-7fe6-4d52-ac64-dc90c86b0f24)\n\n**Sidebar showing the local workspace expanded with the simplified view - displays only the VS Code link directly without showing all task run details**\n\n![sidebar-local-workspace-expanded-showing-vscode-link.png](https://adorable-wombat-701.convex.cloud/api/storage/b2375d67-bc0a-4da0-a5e3-2420bd58fd00)\n\n**Full page view of the sidebar with local workspace expanded, highlighting the key UI change where only the VS Code link is shown for local workspaces**\n\n![sidebar-local-workspace-expanded-with-vscode-link-only.png](https://adorable-wombat-701.convex.cloud/api/storage/0412e084-a645-446c-9368-85514bd59749)\n\n**VS Code interface view that loads when clicking the VS Code link from the local workspace, showing the landing-ac workspace in OpenVSCode Server**\n\n![vscode-view-after-clicking-link.png](https://adorable-wombat-701.convex.cloud/api/storage/acc27249-36c6-4df7-b9a2-7c0406b1d4f1)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"657838aadd2708ce6f7390a33a3a730d9561e69f","createdAt":"2025-12-05T02:24:56Z","updatedAt":"2025-12-05T02:24:56Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1184#issuecomment-3615052745"},{"type":"issue_comment","id":3615053693,"prNumber":1184,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7cxzpjcw1jfxbvtkx4dzgq1d7wqp2x?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7cxzpjcw1jfxbvtkx4dzgq1d7wqp2x/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1184?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 7 screenshots for commit `657838a` (2025-12-05 02:25:26.495 UTC).\n\n**Full-page screenshot of sidebar showing local workspace expanded with only VS Code link visible**\n\n![1-sidebar-local-workspace-vscode-only-full.png](https://famous-camel-162.convex.cloud/api/storage/fb0c5ef7-50fe-44d4-92c6-a978629c7bf3)\n\n**Sidebar navigation section showing local workspace expanded with VS Code link**\n\n![2-sidebar-navigation-local-workspace-expanded.png](https://famous-camel-162.convex.cloud/api/storage/5b2f373d-2545-4d39-91cc-4aa109474cc7)\n\n**Local workspace item in collapsed state in the sidebar**\n\n![3-local-workspace-item-collapsed.png](https://famous-camel-162.convex.cloud/api/storage/9a499394-72aa-4b18-a671-02f6616e4da4)\n\n**Close-up of the VS Code link that appears when local workspace is expanded**\n\n![4-vscode-link-only.png](https://famous-camel-162.convex.cloud/api/storage/07a177d0-7164-48ca-903d-002667a0abd9)\n\n**Local workspace item displayed in the dashboard view \\(TaskItem component\\)**\n\n![5-dashboard-local-workspace-item.png](https://famous-camel-162.convex.cloud/api/storage/444aa516-7b2b-4790-a474-7f166f5901a1)\n\n**Full dashboard view showing local workspace in the Workspaces section**\n\n![6-dashboard-full-view-with-local-workspace.png](https://famous-camel-162.convex.cloud/api/storage/9186ee28-2821-47f8-8771-f4a44c65ec6b)\n\n**Regular task expanded in sidebar for comparison \\(shows GitHub link instead of just VS Code, demonstrating the difference in behavior\\)**\n\n![7-sidebar-regular-task-expanded-for-comparison.png](https://famous-camel-162.convex.cloud/api/storage/cd102ed0-f7c8-45d5-8202-4418059943de)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"657838aadd2708ce6f7390a33a3a730d9561e69f","createdAt":"2025-12-05T02:25:29Z","updatedAt":"2025-12-05T02:25:29Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1184#issuecomment-3615053693"}]}
{"number":1183,"title":"instrument morph setup instance 0","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1183","headRef":"instrument-morph-setup-instance-0","headSha":"e7fb524c31bd73cb8008d2ec70f85e06063e8624","baseRef":"main","baseSha":"2cd09dcc0cdea7176910d5c5b16293ba91c71c19","createdAt":"2025-12-05T02:03:49Z","updatedAt":"2025-12-05T08:34:56Z","diff":"diff --git a/apps/client/src/components/TaskRunTerminalPane.tsx b/apps/client/src/components/TaskRunTerminalPane.tsx\nindex 3a4130407..8e9d5b963 100644\n--- a/apps/client/src/components/TaskRunTerminalPane.tsx\n+++ b/apps/client/src/components/TaskRunTerminalPane.tsx\n@@ -1,7 +1,7 @@\n import { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\n-import { MonitorUp } from \"lucide-react\";\n import { useQuery, useQueryClient } from \"@tanstack/react-query\";\n import { TaskRunTerminalSession } from \"./task-run-terminal-session\";\n+import { WorkspaceLoadingIndicator } from \"./workspace-loading-indicator\";\n import { toMorphXtermBaseUrl } from \"@/lib/toProxyWorkspaceUrl\";\n import {\n   createTerminalTab,\n@@ -202,58 +202,66 @@ export function TaskRunTerminalPane({ workspaceUrl }: TaskRunTerminalPaneProps)\n \n   if (!workspaceUrl || !baseUrl) {\n     return (\n-      <div className=\"flex h-full flex-col items-center justify-center gap-2 text-sm text-neutral-500 dark:text-neutral-400\">\n-        <MonitorUp className=\"size-4 animate-pulse\" aria-hidden />\n-        <span>Terminal is starting...</span>\n+      <div className=\"flex h-full items-center justify-center\">\n+        <WorkspaceLoadingIndicator variant=\"terminal\" status=\"loading\" />\n       </div>\n     );\n   }\n \n   if (isTabsLoading) {\n     return (\n-      <div className=\"flex h-full flex-col items-center justify-center gap-2 text-sm text-neutral-500 dark:text-neutral-400\">\n-        <MonitorUp className=\"size-4 animate-pulse\" aria-hidden />\n-        <span>Loading terminal...</span>\n+      <div className=\"flex h-full items-center justify-center\">\n+        <WorkspaceLoadingIndicator\n+          variant=\"terminal\"\n+          status=\"loading\"\n+          loadingTitle=\"Loading terminal\"\n+          loadingDescription=\"Fetching terminal sessions...\"\n+        />\n       </div>\n     );\n   }\n \n   if (isTabsError) {\n     return (\n-      <div className=\"flex h-full flex-col items-center justify-center gap-2 text-sm text-neutral-500 dark:text-neutral-400\">\n-        <MonitorUp className=\"size-4 text-red-500\" aria-hidden />\n-        <span className=\"text-red-500 dark:text-red-400\">\n-          {tabsError instanceof Error ? tabsError.message : \"Failed to load terminal\"}\n-        </span>\n+      <div className=\"flex h-full items-center justify-center\">\n+        <WorkspaceLoadingIndicator\n+          variant=\"terminal\"\n+          status=\"error\"\n+          errorDescription={\n+            tabsError instanceof Error ? tabsError.message : undefined\n+          }\n+        />\n       </div>\n     );\n   }\n \n   if (terminalIds.length === 0) {\n+    const retryButton = autoCreateError ? (\n+      <button\n+        type=\"button\"\n+        onClick={handleManualRetry}\n+        className=\"inline-flex items-center justify-center rounded border border-neutral-300 px-3 py-1 text-xs font-medium text-neutral-600 transition hover:border-neutral-400 hover:text-neutral-800 dark:border-neutral-700 dark:text-neutral-300 dark:hover:border-neutral-500 dark:hover:text-neutral-100\"\n+      >\n+        Retry terminal\n+      </button>\n+    ) : null;\n+\n+    const attemptInfo =\n+      !autoCreateError && autoCreateAttemptCount > 0\n+        ? `Attempt ${Math.min(autoCreateAttemptCount, MAX_AUTO_CREATE_ATTEMPTS)} of ${MAX_AUTO_CREATE_ATTEMPTS}`\n+        : undefined;\n+\n     return (\n-      <div className=\"flex h-full flex-col items-center justify-center gap-3 text-center text-sm text-neutral-500 dark:text-neutral-400\">\n-        <MonitorUp className=\"size-4 animate-pulse\" aria-hidden />\n-        <div className=\"flex flex-col gap-1\">\n-          <span>\n-            {autoCreateError\n-              ? autoCreateError\n-              : \"Waiting for a terminal session...\"}\n-          </span>\n-          {!autoCreateError && autoCreateAttemptCount > 0 ? (\n-            <span className=\"text-xs text-neutral-400 dark:text-neutral-500\">\n-              {`Attempt ${Math.min(autoCreateAttemptCount, MAX_AUTO_CREATE_ATTEMPTS)} of ${MAX_AUTO_CREATE_ATTEMPTS}`}\n-            </span>\n-          ) : null}\n-        </div>\n-        {autoCreateError ? (\n-          <button\n-            type=\"button\"\n-            onClick={handleManualRetry}\n-            className=\"inline-flex items-center justify-center rounded border border-neutral-300 px-3 py-1 text-xs font-medium text-neutral-600 transition hover:border-neutral-400 hover:text-neutral-800 dark:border-neutral-700 dark:text-neutral-300 dark:hover:border-neutral-500 dark:hover:text-neutral-100\"\n-          >\n-            Retry terminal\n-          </button>\n-        ) : null}\n+      <div className=\"flex h-full items-center justify-center\">\n+        <WorkspaceLoadingIndicator\n+          variant=\"terminal\"\n+          status={autoCreateError ? \"error\" : \"loading\"}\n+          loadingTitle=\"Connecting to terminal\"\n+          loadingDescription={attemptInfo ?? \"Waiting for a terminal session...\"}\n+          errorTitle=\"Terminal connection failed\"\n+          errorDescription={autoCreateError ?? undefined}\n+          action={retryButton}\n+        />\n       </div>\n     );\n   }\ndiff --git a/apps/client/src/components/TaskTree.tsx b/apps/client/src/components/TaskTree.tsx\nindex c63dc81e1..1996394d3 100644\n--- a/apps/client/src/components/TaskTree.tsx\n+++ b/apps/client/src/components/TaskTree.tsx\n@@ -140,21 +140,33 @@ interface SidebarArchiveOverlayProps {\n   icon: ReactNode;\n   label: string;\n   onArchive: () => void;\n+  /** Named group for scoped hover (e.g., \"task\" or \"run\") */\n+  groupName: \"task\" | \"run\";\n }\n \n function SidebarArchiveOverlay({\n   icon,\n   label,\n   onArchive,\n+  groupName,\n }: SidebarArchiveOverlayProps) {\n+  // Use named groups to prevent parent hover from triggering child archive buttons\n+  const hoverShow =\n+    groupName === \"task\"\n+      ? \"group-hover/task:opacity-100 group-hover/task:pointer-events-auto group-data-[focus-visible=true]/task:opacity-100 group-data-[focus-visible=true]/task:pointer-events-auto\"\n+      : \"group-hover/run:opacity-100 group-hover/run:pointer-events-auto group-data-[focus-visible=true]/run:opacity-100 group-data-[focus-visible=true]/run:pointer-events-auto\";\n+\n   return (\n-    <div className=\"relative flex h-4 w-4 items-center justify-center\">\n+    <div className=\"flex items-center gap-1\">\n       <Tooltip delayDuration={0}>\n         <TooltipTrigger asChild>\n           <button\n             type=\"button\"\n             aria-label={label}\n-            className=\"peer absolute inset-0 flex items-center justify-center rounded-sm text-neutral-500 hover:text-neutral-900 dark:text-neutral-400 dark:hover:text-neutral-50 opacity-0 pointer-events-none focus-visible:pointer-events-auto focus-visible:opacity-100 group-hover:opacity-100 group-hover:pointer-events-auto group-data-[focus-visible=true]:opacity-100 group-data-[focus-visible=true]:pointer-events-auto focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-neutral-400 dark:focus-visible:outline-neutral-500\"\n+            className={clsx(\n+              \"flex h-4 w-4 -mr-0.5 items-center justify-center rounded-sm text-neutral-500 hover:text-neutral-900 dark:text-neutral-400 dark:hover:text-neutral-50 opacity-0 pointer-events-none focus-visible:pointer-events-auto focus-visible:opacity-100 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-neutral-400 dark:focus-visible:outline-neutral-500\",\n+              hoverShow\n+            )}\n             onClick={(event) => {\n               event.preventDefault();\n               event.stopPropagation();\n@@ -166,9 +178,7 @@ function SidebarArchiveOverlay({\n         </TooltipTrigger>\n         <TooltipContent side=\"right\">{label}</TooltipContent>\n       </Tooltip>\n-      <div className=\"flex items-center justify-center group-hover:pointer-events-none group-hover:opacity-0 group-data-[focus-visible=true]:pointer-events-none group-data-[focus-visible=true]:opacity-0 peer-focus-visible:pointer-events-none peer-focus-visible:opacity-0\">\n-        {icon}\n-      </div>\n+      {icon ? <div className=\"flex items-center justify-center\">{icon}</div> : null}\n     </div>\n   );\n }\n@@ -808,6 +818,7 @@ function TaskTreeInner({\n       icon={taskLeadingIcon}\n       label=\"Archive\"\n       onArchive={handleArchive}\n+      groupName=\"task\"\n     />\n   ) : (\n     taskLeadingIcon\n@@ -825,7 +836,7 @@ function TaskTreeInner({\n               search={{ runId: undefined }}\n               activeOptions={{ exact: true }}\n               className={clsx(\n-                \"group block\",\n+                \"group/task block\",\n                 // For local workspaces, manually add active class since we navigate to VSCode sub-route\n                 localWorkspaceRunWithVscode && isTaskSelected && \"active\"\n               )}\n@@ -1389,16 +1400,6 @@ function TaskRunTreeInner({\n       isLocalWorkspaceRunEntry ||\n       isCloudWorkspaceRunEntry);\n \n-  const runMetaIcon = shouldShowRunArchiveOverlay ? (\n-    <SidebarArchiveOverlay\n-      icon={runLeadingIcon}\n-      label=\"Archive\"\n-      onArchive={handleArchiveRun}\n-    />\n-  ) : (\n-    runLeadingIcon\n-  );\n-\n   const crownIcon = run.isCrowned ? (\n     <Tooltip delayDuration={0}>\n       <TooltipTrigger asChild>\n@@ -1421,16 +1422,28 @@ function TaskRunTreeInner({\n     </Tooltip>\n   ) : null;\n \n-  const leadingContent = crownIcon ? (\n+  // Combine crown + status icon, with archive overlay on the left of everything\n+  const iconsContent = crownIcon ? (\n     <div className=\"flex items-center gap-1\">\n       {crownIcon}\n-      {runMetaIcon}\n+      {runLeadingIcon}\n     </div>\n   ) : (\n-    runMetaIcon\n+    runLeadingIcon\n   );\n \n-  // Generate VSCode URL if available\n+  const leadingContent = shouldShowRunArchiveOverlay ? (\n+    <SidebarArchiveOverlay\n+      icon={iconsContent}\n+      label=\"Archive\"\n+      onArchive={handleArchiveRun}\n+      groupName=\"run\"\n+    />\n+  ) : (\n+    iconsContent\n+  );\n+\n+  // Generate VSCode URL if available - used for \"Open with\" actions\n   const hasActiveVSCode = run.vscode?.status === \"running\";\n   const vscodeUrl = useMemo(\n     () => (hasActiveVSCode && run.vscode?.url) || null,\n@@ -1488,25 +1501,14 @@ function TaskRunTreeInner({\n     });\n   }, [refreshGitHubAuth, run._id, teamSlugOrId]);\n \n-  const shouldRenderDiffLink = true;\n-  const shouldRenderBrowserLink = run.vscode?.provider === \"morph\";\n-  const shouldRenderTerminalLink = shouldRenderBrowserLink;\n   const shouldRenderPullRequestLink = Boolean(\n     (run.pullRequestUrl && run.pullRequestUrl !== \"pending\") ||\n       run.pullRequests?.some((pr) => pr.url)\n   );\n-  const shouldRenderPreviewLink = previewServices.length > 0;\n   const hasOpenWithActions = openWithActions.length > 0;\n   const hasPortActions = portActions.length > 0;\n   const canCopyBranch = Boolean(copyRunBranch);\n-  const hasCollapsibleContent =\n-    hasChildren ||\n-    hasActiveVSCode ||\n-    shouldRenderDiffLink ||\n-    shouldRenderBrowserLink ||\n-    shouldRenderTerminalLink ||\n-    shouldRenderPullRequestLink ||\n-    shouldRenderPreviewLink;\n+  const hasCollapsibleContent = true;\n   const [isRunLinkFocusVisible, setIsRunLinkFocusVisible] = useState(false);\n   const handleRunLinkFocus = useCallback(\n     (event: FocusEvent<HTMLAnchorElement>) => {\n@@ -1532,7 +1534,7 @@ function TaskRunTreeInner({\n               ...(prev ?? {}),\n               runId: run._id,\n             })}\n-            className=\"group block\"\n+            className=\"group/run block\"\n             data-focus-visible={isRunLinkFocusVisible ? \"true\" : undefined}\n             activeOptions={{ exact: false }}\n             onFocus={handleRunLinkFocus}\n@@ -1672,16 +1674,14 @@ function TaskRunTreeInner({\n         taskId={taskId}\n         teamSlugOrId={teamSlugOrId}\n         isExpanded={isExpanded}\n-        hasActiveVSCode={hasActiveVSCode}\n         hasChildren={hasChildren}\n-        shouldRenderBrowserLink={shouldRenderBrowserLink}\n-        shouldRenderTerminalLink={shouldRenderTerminalLink}\n         shouldRenderPullRequestLink={shouldRenderPullRequestLink}\n         previewServices={previewServices}\n         customPreviews={run.customPreviews || []}\n         environmentError={run.environmentError}\n         onArchiveToggle={onArchiveToggle}\n         showRunNumbers={showRunNumbers}\n+        isLocalWorkspace={Boolean(isLocalWorkspaceRunEntry)}\n       />\n     </div>\n   );\n@@ -1727,7 +1727,7 @@ function TaskRunDetailLink({\n         <span className=\"text-neutral-600 dark:text-neutral-400\">{label}</span>\n       </span>\n       {trailing ? (\n-        <span className=\"ml-2 flex shrink-0 items-center\">{trailing}</span>\n+        <span className=\"flex shrink-0 items-center\">{trailing}</span>\n       ) : null}\n     </Link>\n   );\n@@ -1786,10 +1786,7 @@ interface TaskRunDetailsProps {\n   taskId: Id<\"tasks\">;\n   teamSlugOrId: string;\n   isExpanded: boolean;\n-  hasActiveVSCode: boolean;\n   hasChildren: boolean;\n-  shouldRenderBrowserLink: boolean;\n-  shouldRenderTerminalLink: boolean;\n   shouldRenderPullRequestLink: boolean;\n   previewServices: PreviewService[];\n   customPreviews: Array<{\n@@ -1802,6 +1799,7 @@ interface TaskRunDetailsProps {\n   };\n   onArchiveToggle: (runId: Id<\"taskRuns\">, archive: boolean) => void;\n   showRunNumbers: boolean;\n+  isLocalWorkspace: boolean;\n }\n \n function TaskRunDetails({\n@@ -1810,16 +1808,14 @@ function TaskRunDetails({\n   taskId,\n   teamSlugOrId,\n   isExpanded,\n-  hasActiveVSCode,\n   hasChildren,\n-  shouldRenderBrowserLink,\n-  shouldRenderTerminalLink,\n   shouldRenderPullRequestLink,\n   previewServices,\n   customPreviews,\n   environmentError,\n   onArchiveToggle,\n   showRunNumbers,\n+  isLocalWorkspace,\n }: TaskRunDetailsProps) {\n   const location = useLocation();\n   const navigate = useNavigate();\n@@ -2001,25 +1997,51 @@ function TaskRunDetails({\n     </Tooltip>\n   ) : null;\n \n+  // Determine loading/error state for the detail links\n+  const isVSCodeReady = run.vscode?.status === \"running\";\n+  const isRunFailed = run.status === \"failed\";\n+\n+  // Show error icon with tooltip if run failed, otherwise show loading spinner\n+  const statusIndicator = isRunFailed ? (\n+    <Tooltip delayDuration={0}>\n+      <TooltipTrigger asChild>\n+        <XCircle className=\"w-3 h-3 text-red-500\" />\n+      </TooltipTrigger>\n+      {run.errorMessage ? (\n+        <TooltipContent\n+          side=\"right\"\n+          className=\"max-w-xs whitespace-pre-wrap break-words\"\n+        >\n+          {run.errorMessage}\n+        </TooltipContent>\n+      ) : null}\n+    </Tooltip>\n+  ) : !isVSCodeReady ? (\n+    <Loader2 className=\"w-3 h-3 animate-spin text-neutral-400\" />\n+  ) : null;\n+\n+  // For VSCode, combine environment error with status indicator\n+  const vscodeTrailing = environmentErrorIndicator || statusIndicator;\n+\n   return (\n     <Fragment>\n-      {hasActiveVSCode ? (\n-        <TaskRunDetailLink\n-          to=\"/$teamSlugOrId/task/$taskId/run/$runId/vscode\"\n-          params={{\n-            teamSlugOrId,\n-            taskId,\n-            runId: run._id,\n-          }}\n-          icon={\n-            <VSCodeIcon className=\"w-3 h-3 mr-2 text-neutral-400 grayscale opacity-60\" />\n-          }\n-          label=\"VS Code\"\n-          indentLevel={indentLevel}\n-          trailing={environmentErrorIndicator}\n-        />\n-      ) : null}\n+      {/* VSCode - always show for all workspaces */}\n+      <TaskRunDetailLink\n+        to=\"/$teamSlugOrId/task/$taskId/run/$runId/vscode\"\n+        params={{\n+          teamSlugOrId,\n+          taskId,\n+          runId: run._id,\n+        }}\n+        icon={\n+          <VSCodeIcon className=\"w-3 h-3 mr-2 text-neutral-400 grayscale opacity-60\" />\n+        }\n+        label=\"VS Code\"\n+        indentLevel={indentLevel}\n+        trailing={vscodeTrailing}\n+      />\n \n+      {/* Git diff - always show for all workspaces */}\n       <TaskRunDetailLink\n         to=\"/$teamSlugOrId/task/$taskId/run/$runId/diff\"\n         params={{ teamSlugOrId, taskId, runId: run._id }}\n@@ -2028,23 +2050,27 @@ function TaskRunDetails({\n         indentLevel={indentLevel}\n       />\n \n-      {shouldRenderBrowserLink ? (\n+      {/* Browser - only for cloud workspaces (not local) */}\n+      {!isLocalWorkspace ? (\n         <TaskRunDetailLink\n           to=\"/$teamSlugOrId/task/$taskId/run/$runId/browser\"\n           params={{ teamSlugOrId, taskId, runId: run._id }}\n           icon={<Monitor className=\"w-3 h-3 mr-2 text-neutral-400\" />}\n           label=\"Browser\"\n           indentLevel={indentLevel}\n+          trailing={statusIndicator}\n         />\n       ) : null}\n \n-      {shouldRenderTerminalLink ? (\n+      {/* Terminals - only for cloud workspaces (not local) */}\n+      {!isLocalWorkspace ? (\n         <TaskRunDetailLink\n           to=\"/$teamSlugOrId/task/$taskId/run/$runId/terminals\"\n           params={{ teamSlugOrId, taskId, runId: run._id }}\n           icon={<TerminalSquare className=\"w-3 h-3 mr-2 text-neutral-400\" />}\n           label=\"Terminals\"\n           indentLevel={indentLevel}\n+          trailing={statusIndicator}\n         />\n       ) : null}\n \n@@ -2071,7 +2097,9 @@ function TaskRunDetails({\n                   runId: run._id,\n                   previewId: `${service.port}`,\n                 }}\n-                icon={<ExternalLink className=\"w-3 h-3 mr-2 text-neutral-400\" />}\n+                icon={\n+                  <ExternalLink className=\"w-3 h-3 mr-2 text-neutral-400\" />\n+                }\n                 label={`Preview (port ${service.port})`}\n                 indentLevel={indentLevel}\n                 className=\"pr-10\"\n@@ -2105,7 +2133,11 @@ function TaskRunDetails({\n                       <Dropdown.Arrow />\n                       <Dropdown.Item\n                         onClick={() => {\n-                          window.open(service.url, \"_blank\", \"noopener,noreferrer\");\n+                          window.open(\n+                            service.url,\n+                            \"_blank\",\n+                            \"noopener,noreferrer\"\n+                          );\n                         }}\n                         className=\"flex items-center gap-2\"\n                       >\n@@ -2129,7 +2161,9 @@ function TaskRunDetails({\n                   runId: run._id,\n                   previewId: String(index),\n                 }}\n-                icon={<ExternalLink className=\"w-3 h-3 mr-2 text-neutral-400\" />}\n+                icon={\n+                  <ExternalLink className=\"w-3 h-3 mr-2 text-neutral-400\" />\n+                }\n                 label={preview.url}\n                 indentLevel={indentLevel}\n                 className=\"pr-10\"\n@@ -2163,7 +2197,11 @@ function TaskRunDetails({\n                       <Dropdown.Arrow />\n                       <Dropdown.Item\n                         onClick={() => {\n-                          window.open(preview.url, \"_blank\", \"noopener,noreferrer\");\n+                          window.open(\n+                            preview.url,\n+                            \"_blank\",\n+                            \"noopener,noreferrer\"\n+                          );\n                         }}\n                         className=\"flex items-center gap-2\"\n                       >\n@@ -2171,7 +2209,9 @@ function TaskRunDetails({\n                         Open in new tab\n                       </Dropdown.Item>\n                       <Dropdown.Item\n-                        onClick={() => handleRemovePreview(index, currentPreviewId)}\n+                        onClick={() =>\n+                          handleRemovePreview(index, currentPreviewId)\n+                        }\n                         className=\"flex items-center gap-2 text-red-600 dark:text-red-400\"\n                       >\n                         <Trash2 className=\"w-3.5 h-3.5\" />\ndiff --git a/apps/client/src/components/workspace-loading-indicator.tsx b/apps/client/src/components/workspace-loading-indicator.tsx\nindex 93000f2cc..ddd330300 100644\n--- a/apps/client/src/components/workspace-loading-indicator.tsx\n+++ b/apps/client/src/components/workspace-loading-indicator.tsx\n@@ -4,7 +4,7 @@ import { cn } from \"@/lib/utils\";\n \n export type WorkspaceLoadingStatus = \"loading\" | \"error\";\n \n-type WorkspaceLoadingVariant = \"vscode\" | \"browser\";\n+type WorkspaceLoadingVariant = \"vscode\" | \"browser\" | \"terminal\";\n \n export interface WorkspaceLoadingIndicatorProps {\n   status: WorkspaceLoadingStatus;\n@@ -14,6 +14,8 @@ export interface WorkspaceLoadingIndicatorProps {\n   loadingDescription?: string;\n   errorTitle?: string;\n   errorDescription?: string;\n+  /** Optional action button for error states */\n+  action?: React.ReactNode;\n }\n \n const VARIANT_COPY: Record<\n@@ -39,6 +41,12 @@ const VARIANT_COPY: Record<\n     errorTitle: \"We couldn't launch the browser preview\",\n     errorDescription: \"Refresh the page or switch to cloud mode, then try again.\",\n   },\n+  terminal: {\n+    loadingTitle: \"Starting terminal\",\n+    loadingDescription: \"Connecting to the workspace terminal session.\",\n+    errorTitle: \"We couldn't connect to the terminal\",\n+    errorDescription: \"Refresh the page or try again.\",\n+  },\n };\n \n export const WorkspaceLoadingIndicator = memo(function WorkspaceLoadingIndicator({\n@@ -49,6 +57,7 @@ export const WorkspaceLoadingIndicator = memo(function WorkspaceLoadingIndicator\n   loadingDescription,\n   errorTitle,\n   errorDescription,\n+  action,\n }: WorkspaceLoadingIndicatorProps) {\n   const copy = VARIANT_COPY[variant];\n   const isError = status === \"error\";\n@@ -82,6 +91,7 @@ export const WorkspaceLoadingIndicator = memo(function WorkspaceLoadingIndicator\n           {resolvedDescription}\n         </p>\n       </div>\n+      {action}\n     </div>\n   );\n });\ndiff --git a/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.index.tsx b/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.index.tsx\nindex 2f050b3f7..4f8d84be4 100644\n--- a/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.index.tsx\n+++ b/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.index.tsx\n@@ -128,8 +128,19 @@ export const Route = createFileRoute(\"/_layout/$teamSlugOrId/task/$taskId/\")({\n         ? (taskRunIndex.get(parsedRunId.data) ?? taskRuns[0])\n         : taskRuns[0];\n \n+      const rawWorkspaceUrl = selectedRun?.vscode?.workspaceUrl ?? null;\n       const rawBrowserUrl =\n-        selectedRun?.vscode?.url ?? selectedRun?.vscode?.workspaceUrl ?? null;\n+        selectedRun?.vscode?.url ?? rawWorkspaceUrl ?? null;\n+\n+      // Preload both VSCode and browser iframes in parallel\n+      if (selectedRun && rawWorkspaceUrl) {\n+        const workspaceUrl = toProxyWorkspaceUrl(rawWorkspaceUrl, undefined);\n+        void preloadTaskRunIframes([\n+          { url: workspaceUrl, taskRunId: selectedRun._id },\n+        ]).catch((error) => {\n+          console.error(\"Failed to preload VSCode iframe\", error);\n+        });\n+      }\n       if (selectedRun && rawBrowserUrl) {\n         const vncUrl = toMorphVncUrl(rawBrowserUrl);\n         if (vncUrl) {\n@@ -140,8 +151,6 @@ export const Route = createFileRoute(\"/_layout/$teamSlugOrId/task/$taskId/\")({\n           );\n         }\n       }\n-\n-      const rawWorkspaceUrl = selectedRun?.vscode?.workspaceUrl ?? null;\n       if (!rawWorkspaceUrl) {\n         return;\n       }\ndiff --git a/apps/server/src/agentSpawner.ts b/apps/server/src/agentSpawner.ts\nindex 47ce30d92..b2a525f62 100644\n--- a/apps/server/src/agentSpawner.ts\n+++ b/apps/server/src/agentSpawner.ts\n@@ -68,6 +68,8 @@ export async function spawnAgent(\n   },\n   teamSlugOrId: string\n ): Promise<AgentSpawnResult> {\n+  let taskRunId: Id<\"taskRuns\"> | null = null;\n+\n   try {\n     // Capture the current auth token and header JSON from AsyncLocalStorage so we can\n     // re-enter the auth context inside async event handlers later.\n@@ -84,17 +86,17 @@ export async function spawnAgent(\n     );\n \n     // Create a task run for this specific agent\n-    const { taskRunId, jwt: taskRunJwt } = await getConvex().mutation(\n-      api.taskRuns.create,\n-      {\n+    const { taskRunId: createdTaskRunId, jwt: taskRunJwt } =\n+      await getConvex().mutation(api.taskRuns.create, {\n         teamSlugOrId,\n         taskId: taskId,\n         prompt: options.taskDescription,\n         agentName: agent.name,\n         newBranch,\n         environmentId: options.environmentId,\n-      }\n-    );\n+      });\n+    taskRunId = createdTaskRunId;\n+    const runId = taskRunId;\n \n     // Fetch the task to get image storage IDs\n     const task = await getConvex().query(api.tasks.getById, {\n@@ -425,7 +427,7 @@ export async function spawnAgent(\n     await retryOnOptimisticConcurrency(() =>\n       getConvex().mutation(api.taskRuns.updateWorktreePath, {\n         teamSlugOrId,\n-        id: taskRunId,\n+        id: runId,\n         worktreePath: worktreePath,\n       })\n     );\n@@ -488,7 +490,7 @@ export async function spawnAgent(\n           retryOnOptimisticConcurrency(() =>\n             getConvex().mutation(api.taskRuns.fail, {\n               teamSlugOrId,\n-              id: taskRunId,\n+              id: runId,\n               errorMessage: data.errorMessage || \"Terminal failed\",\n               // WorkerTerminalFailed does not include exitCode in schema; default to 1\n               exitCode: 1,\n@@ -497,7 +499,7 @@ export async function spawnAgent(\n         );\n \n         serverLogger.info(\n-          `[AgentSpawner] Marked taskRun ${taskRunId} as failed`\n+          `[AgentSpawner] Marked taskRun ${runId} as failed`\n         );\n       } catch (error) {\n         serverLogger.error(\n@@ -533,24 +535,31 @@ export async function spawnAgent(\n     }\n \n     // Update VSCode instance information in Convex (retry on OCC)\n-    await retryOnOptimisticConcurrency(() =>\n-      getConvex().mutation(api.taskRuns.updateVSCodeInstance, {\n-        teamSlugOrId,\n-        id: taskRunId,\n-        vscode: {\n-          provider: vscodeInfo.provider,\n-          containerName: vscodeInstance.getName(),\n-          status: \"running\",\n-          url: vscodeInfo.url,\n-          workspaceUrl: vscodeInfo.workspaceUrl,\n-          startedAt: Date.now(),\n-          ...(ports ? { ports } : {}),\n-        },\n-      })\n-    );\n+    // Skip if www already persisted the VSCode info (cloud mode optimization)\n+    if (!vscodeInfo.vscodePersisted) {\n+      await retryOnOptimisticConcurrency(() =>\n+        getConvex().mutation(api.taskRuns.updateVSCodeInstance, {\n+          teamSlugOrId,\n+          id: runId,\n+          vscode: {\n+            provider: vscodeInfo.provider,\n+            containerName: vscodeInstance.getName(),\n+            status: \"running\",\n+            url: vscodeInfo.url,\n+            workspaceUrl: vscodeInfo.workspaceUrl,\n+            startedAt: Date.now(),\n+            ...(ports ? { ports } : {}),\n+          },\n+        })\n+      );\n+    } else {\n+      serverLogger.info(\n+        `[AgentSpawner] Skipping updateVSCodeInstance - already persisted by www`\n+      );\n+    }\n \n-    // Use taskRunId as terminal ID for compatibility\n-    const terminalId = taskRunId;\n+    // Use runId as terminal ID for compatibility\n+    const terminalId = runId;\n \n     // Log auth files if any\n     if (authFiles.length > 0) {\n@@ -926,13 +935,39 @@ exit $EXIT_CODE\n     };\n   } catch (error) {\n     serverLogger.error(\"Error spawning agent\", error);\n+    const errorMessage =\n+      error instanceof Error ? error.message : \"Unknown error\";\n+\n+    // Mark the task run as failed in Convex so the UI shows the failure\n+    if (taskRunId) {\n+      const failedRunId = taskRunId; // Capture for TypeScript narrowing\n+      try {\n+        await retryOnOptimisticConcurrency(() =>\n+          getConvex().mutation(api.taskRuns.fail, {\n+            teamSlugOrId,\n+            id: failedRunId,\n+            errorMessage: `Agent spawn failed: ${errorMessage}`,\n+            exitCode: 1,\n+          })\n+        );\n+        serverLogger.info(\n+          `[AgentSpawner] Marked taskRun ${failedRunId} as failed due to spawn error`\n+        );\n+      } catch (failError) {\n+        serverLogger.error(\n+          `[AgentSpawner] Failed to mark taskRun as failed`,\n+          failError\n+        );\n+      }\n+    }\n+\n     return {\n       agentName: agent.name,\n       terminalId: \"\",\n-      taskRunId: \"\",\n+      taskRunId: taskRunId ?? \"\",\n       worktreePath: \"\",\n       success: false,\n-      error: error instanceof Error ? error.message : \"Unknown error\",\n+      error: errorMessage,\n     };\n   }\n }\ndiff --git a/apps/server/src/vscode/CmuxVSCodeInstance.ts b/apps/server/src/vscode/CmuxVSCodeInstance.ts\nindex 6422b3d23..b309d0089 100644\n--- a/apps/server/src/vscode/CmuxVSCodeInstance.ts\n+++ b/apps/server/src/vscode/CmuxVSCodeInstance.ts\n@@ -77,10 +77,14 @@ export class CmuxVSCodeInstance extends VSCodeInstance {\n     this.vscodeBaseUrl = data.vscodeUrl;\n     this.workerUrl = data.workerUrl;\n     this.provider = data.provider || \"morph\";\n+    const vscodePersisted = data.vscodePersisted ?? false;\n \n     const workspaceUrl = this.getWorkspaceUrl(this.vscodeBaseUrl);\n     dockerLogger.info(`[CmuxVSCodeInstance] VS Code URL: ${workspaceUrl}`);\n     dockerLogger.info(`[CmuxVSCodeInstance] Worker URL: ${this.workerUrl}`);\n+    dockerLogger.info(\n+      `[CmuxVSCodeInstance] VSCode persisted by www: ${vscodePersisted}`\n+    );\n \n     // Connect to the worker if available\n     if (this.workerUrl) {\n@@ -103,6 +107,7 @@ export class CmuxVSCodeInstance extends VSCodeInstance {\n       instanceId: this.instanceId,\n       taskRunId: this.taskRunId,\n       provider: this.provider,\n+      vscodePersisted,\n     };\n   }\n \ndiff --git a/apps/server/src/vscode/VSCodeInstance.ts b/apps/server/src/vscode/VSCodeInstance.ts\nindex e1d3c7408..1c81a8732 100644\n--- a/apps/server/src/vscode/VSCodeInstance.ts\n+++ b/apps/server/src/vscode/VSCodeInstance.ts\n@@ -27,6 +27,8 @@ export interface VSCodeInstanceInfo {\n   instanceId: string;\n   taskRunId: Id<\"taskRuns\">;\n   provider: \"docker\" | \"morph\" | \"daytona\";\n+  /** If true, VSCode URLs were already persisted to Convex by www */\n+  vscodePersisted?: boolean;\n }\n \n export abstract class VSCodeInstance extends EventEmitter {\ndiff --git a/apps/www/lib/routes/morph.route.ts b/apps/www/lib/routes/morph.route.ts\nindex c0e7466d8..f35a7b184 100644\n--- a/apps/www/lib/routes/morph.route.ts\n+++ b/apps/www/lib/routes/morph.route.ts\n@@ -7,7 +7,8 @@ import { getAccessTokenFromRequest } from \"@/lib/utils/auth\";\n import { verifyTeamAccess } from \"@/lib/utils/team-verification\";\n import { env } from \"@/lib/utils/www-env\";\n import { createRoute, OpenAPIHono, z } from \"@hono/zod-openapi\";\n-import { MorphCloudClient } from \"morphcloud\";\n+import { HTTPException } from \"hono/http-exception\";\n+import { type Instance, MorphCloudClient } from \"morphcloud\";\n import { getConvex } from \"../utils/get-convex\";\n import { selectGitIdentity } from \"../utils/gitIdentity\";\n import { stackServerAppJs } from \"../utils/stack\";\n@@ -20,6 +21,29 @@ import {\n } from \"./sandboxes/git\";\n import { typedZid } from \"@cmux/shared/utils/typed-zid\";\n \n+// Instrumentation helper for benchmarking\n+const isBenchMode = () => process.env.MORPH_BENCH === \"1\";\n+\n+function formatMs(ms: number): string {\n+  if (ms >= 1000) {\n+    return `${(ms / 1000).toFixed(2)}s`;\n+  }\n+  return `${ms.toFixed(0)}ms`;\n+}\n+\n+async function bench<T>(label: string, fn: () => Promise<T>): Promise<T> {\n+  if (!isBenchMode()) {\n+    return fn();\n+  }\n+  const start = performance.now();\n+  try {\n+    return await fn();\n+  } finally {\n+    const duration = performance.now() - start;\n+    console.log(`[MORPH_BENCH] ${formatMs(duration).padStart(8)} | ${label}`);\n+  }\n+}\n+\n export const morphRouter = new OpenAPIHono();\n \n const morphSnapshotIds = MORPH_SNAPSHOT_PRESETS.map(\n@@ -445,11 +469,21 @@ morphRouter.openapi(\n     },\n   }),\n   async (c) => {\n-    const user = await stackServerAppJs.getUser({ tokenStore: c.req.raw });\n+    const requestStart = performance.now();\n+    if (isBenchMode()) {\n+      console.log(`[MORPH_BENCH] -------- setup-instance START --------`);\n+    }\n+\n+    // Phase 1: Auth (must be sequential)\n+    const user = await bench(\"stackServerAppJs.getUser\", () =>\n+      stackServerAppJs.getUser({ tokenStore: c.req.raw })\n+    );\n     if (!user) {\n       return c.text(\"Unauthorized\", 401);\n     }\n-    const { accessToken } = await user.getAuthJson();\n+    const { accessToken } = await bench(\"user.getAuthJson\", () =>\n+      user.getAuthJson()\n+    );\n     if (!accessToken) return c.text(\"Unauthorized\", 401);\n     const {\n       teamSlugOrId,\n@@ -461,33 +495,44 @@ morphRouter.openapi(\n \n     const convex = getConvex({ accessToken });\n \n-    // Verify team access and get the team\n-    const team = await verifyTeamAccess({ req: c.req.raw, teamSlugOrId });\n-    const githubAccessTokenPromise = (async () => {\n-      const githubAccount = await user.getConnectedAccount(\"github\");\n-      if (!githubAccount) {\n-        return {\n-          githubAccessTokenError: \"GitHub account not found\",\n-          githubAccessToken: null,\n-        } as const;\n-      }\n-      const { accessToken: githubAccessToken } =\n-        await githubAccount.getAccessToken();\n-      if (!githubAccessToken) {\n-        return {\n-          githubAccessTokenError: \"GitHub access token not found\",\n-          githubAccessToken: null,\n-        } as const;\n+    // Phase 2: Start parallel operations that only depend on `user`\n+    // Both verifyTeamAccess and githubAccessToken only need user - run in parallel!\n+    const verifyTeamPromise = bench(\"verifyTeamAccess\", () =>\n+      verifyTeamAccess({ req: c.req.raw, teamSlugOrId })\n+    );\n+\n+    const githubAccessTokenPromise = bench(\n+      \"getGithubAccessToken\",\n+      async () => {\n+        const githubAccount = await user.getConnectedAccount(\"github\");\n+        if (!githubAccount) {\n+          return {\n+            githubAccessTokenError: \"GitHub account not found\",\n+            githubAccessToken: null,\n+          } as const;\n+        }\n+        const { accessToken: githubAccessToken } =\n+          await githubAccount.getAccessToken();\n+        if (!githubAccessToken) {\n+          return {\n+            githubAccessTokenError: \"GitHub access token not found\",\n+            githubAccessToken: null,\n+          } as const;\n+        }\n+\n+        return { githubAccessTokenError: null, githubAccessToken } as const;\n       }\n+    );\n \n-      return { githubAccessTokenError: null, githubAccessToken } as const;\n-    })();\n+    // Chain fetchGitIdentityInputs off githubAccessToken (starts ASAP once token ready)\n     const gitIdentityPromise = githubAccessTokenPromise.then(\n       ({ githubAccessToken }) => {\n         if (!githubAccessToken) {\n           throw new Error(\"GitHub access token not found\");\n         }\n-        return fetchGitIdentityInputs(convex, githubAccessToken);\n+        return bench(\"fetchGitIdentityInputs\", () =>\n+          fetchGitIdentityInputs(convex, githubAccessToken)\n+        );\n       }\n     );\n \n@@ -496,33 +541,48 @@ morphRouter.openapi(\n         apiKey: env.MORPH_API_KEY,\n       });\n \n-      let instance;\n+      let instance: Instance;\n       let instanceId = existingInstanceId;\n       const selectedSnapshotId = snapshotId ?? DEFAULT_MORPH_SNAPSHOT_ID;\n \n-      // If no instanceId provided, create a new instance\n+      // Phase 3: Get or create instance\n       if (!instanceId) {\n+        // NEW INSTANCE: Need team.uuid for metadata, so await verifyTeamAccess first\n+        const team = await verifyTeamPromise;\n+\n         console.log(\n           `Creating new Morph instance (snapshot: ${selectedSnapshotId})`\n         );\n-        instance = await client.instances.start({\n-          snapshotId: selectedSnapshotId,\n-          ttlSeconds,\n-          ttlAction: \"pause\",\n-          metadata: {\n-            app: \"cmux-dev\",\n-            userId: user.id,\n-            teamId: team.uuid,\n-          },\n-        });\n+        instance = await bench(\"client.instances.start\", () =>\n+          client.instances.start({\n+            snapshotId: selectedSnapshotId,\n+            ttlSeconds,\n+            ttlAction: \"pause\",\n+            metadata: {\n+              app: \"cmux-dev\",\n+              userId: user.id,\n+              teamId: team.uuid,\n+            },\n+          })\n+        );\n         instanceId = instance.id;\n         void (async () => {\n-          await instance.setWakeOn(true, true);\n+          await bench(\"instance.setWakeOn\", () =>\n+            instance.setWakeOn(true, true)\n+          );\n         })();\n       } else {\n-        // Get existing instance\n+        // REUSE INSTANCE: Can parallelize verifyTeamAccess with instances.get!\n         console.log(`Using existing Morph instance: ${instanceId}`);\n-        instance = await client.instances.get({ instanceId });\n+\n+        const [team, inst] = await Promise.all([\n+          verifyTeamPromise,\n+          bench(\"client.instances.get\", () =>\n+            client.instances.get({ instanceId: instanceId! })\n+          ),\n+        ]);\n+\n+        instance = inst;\n \n         // Security: ensure the instance belongs to the requested team\n         const meta = instance.metadata;\n@@ -535,18 +595,6 @@ morphRouter.openapi(\n         }\n       }\n \n-      void gitIdentityPromise\n-        .then(([who, gh]) => {\n-          const { name, email } = selectGitIdentity(who, gh);\n-          return configureGitIdentity(instance, { name, email });\n-        })\n-        .catch((error) => {\n-          console.log(\n-            `[sandboxes.start] Failed to configure git identity; continuing...`,\n-            error\n-          );\n-        });\n-\n       // Get VSCode URL\n       const vscodeUrl = instance.networking.httpServices.find(\n         (service) => service.port === 39378\n@@ -556,6 +604,8 @@ morphRouter.openapi(\n         throw new Error(\"VSCode URL not found\");\n       }\n \n+      // Phase 4: Configure git access\n+      // Wait for github token (should already be done or nearly done due to parallel start)\n       const { githubAccessToken, githubAccessTokenError } =\n         await githubAccessTokenPromise;\n       if (githubAccessTokenError) {\n@@ -564,7 +614,29 @@ morphRouter.openapi(\n         );\n         return c.text(\"Failed to resolve GitHub credentials\", 401);\n       }\n-      await configureGithubAccess(instance, githubAccessToken);\n+\n+      // Start configureGithubAccess immediately\n+      const configureGithubPromise = bench(\"configureGithubAccess\", () =>\n+        configureGithubAccess(instance, githubAccessToken)\n+      );\n+\n+      // Start configureGitIdentity in parallel (fire-and-forget, but now truly parallel)\n+      void gitIdentityPromise\n+        .then(([who, gh]) => {\n+          const { name, email } = selectGitIdentity(who, gh);\n+          return bench(\"configureGitIdentity\", () =>\n+            configureGitIdentity(instance, { name, email })\n+          );\n+        })\n+        .catch((error) => {\n+          console.log(\n+            `[sandboxes.start] Failed to configure git identity; continuing...`,\n+            error\n+          );\n+        });\n+\n+      // Wait for configureGithubAccess (required for repo cloning)\n+      await configureGithubPromise;\n \n       const url = `${vscodeUrl}/?folder=/root/workspace`;\n \n@@ -610,12 +682,14 @@ morphRouter.openapi(\n         }\n \n         // First, get list of existing repos with their remote URLs\n-        const listReposCmd = await instance.exec(\n-          \"for dir in /root/workspace/*/; do \" +\n-            'if [ -d \"$dir/.git\" ]; then ' +\n-            'basename \"$dir\"; ' +\n-            \"cd \\\"$dir\\\" && git remote get-url origin 2>/dev/null || echo 'no-remote'; \" +\n-            \"fi; done\"\n+        const listReposCmd = await bench(\"instance.exec (list repos)\", () =>\n+          instance.exec(\n+            \"for dir in /root/workspace/*/; do \" +\n+              'if [ -d \"$dir/.git\" ]; then ' +\n+              'basename \"$dir\"; ' +\n+              \"cd \\\"$dir\\\" && git remote get-url origin 2>/dev/null || echo 'no-remote'; \" +\n+              \"fi; done\"\n+          )\n         );\n \n         const lines = listReposCmd.stdout.split(\"\\n\").filter(Boolean);\n@@ -638,14 +712,18 @@ morphRouter.openapi(\n           if (!selectedRepo) {\n             // Repo not in selected list, remove it\n             console.log(`Removing repository: ${existingName}`);\n-            await instance.exec(`rm -rf /root/workspace/${existingName}`);\n+            await bench(`instance.exec (rm ${existingName})`, () =>\n+              instance.exec(`rm -rf /root/workspace/${existingName}`)\n+            );\n             removedRepos.push(existingName);\n           } else if (existingUrl && !existingUrl.includes(selectedRepo)) {\n             // Repo exists but points to different remote, remove and re-clone\n             console.log(\n               `Repository ${existingName} points to different remote, removing for re-clone`\n             );\n-            await instance.exec(`rm -rf /root/workspace/${existingName}`);\n+            await bench(`instance.exec (rm ${existingName})`, () =>\n+              instance.exec(`rm -rf /root/workspace/${existingName}`)\n+            );\n             removedRepos.push(existingName);\n             existingRepos.delete(existingName); // Mark for re-cloning\n           }\n@@ -664,8 +742,12 @@ morphRouter.openapi(\n               let isAuthError = false;\n \n               for (let attempt = 1; attempt <= maxRetries; attempt++) {\n-                const cloneCmd = await instance.exec(\n-                  `mkdir -p /root/workspace && cd /root/workspace && git clone https://github.com/${repo}.git ${repoName} 2>&1`\n+                const cloneCmd = await bench(\n+                  `instance.exec (clone ${repoName} attempt ${attempt})`,\n+                  () =>\n+                    instance.exec(\n+                      `mkdir -p /root/workspace && cd /root/workspace && git clone https://github.com/${repo}.git ${repoName} 2>&1`\n+                    )\n                 );\n \n                 if (cloneCmd.exit_code === 0) {\n@@ -746,6 +828,14 @@ morphRouter.openapi(\n \n       console.log(`VSCode Workspace URL: ${url}`);\n \n+      if (isBenchMode()) {\n+        const totalMs = performance.now() - requestStart;\n+        console.log(\n+          `[MORPH_BENCH] ${formatMs(totalMs).padStart(8)} | TOTAL REQUEST TIME`\n+        );\n+        console.log(`[MORPH_BENCH] -------- setup-instance END --------`);\n+      }\n+\n       return c.json({\n         instanceId,\n         vscodeUrl: url,\n@@ -754,6 +844,10 @@ morphRouter.openapi(\n         failedClones,\n       });\n     } catch (error) {\n+      // Re-throw HTTPException to preserve auth error status codes (401, 403, 404)\n+      if (error instanceof HTTPException) {\n+        throw error;\n+      }\n       console.error(\"Failed to setup Morph instance:\", error);\n       return c.text(\"Failed to setup instance\", 500);\n     }\ndiff --git a/apps/www/lib/routes/sandboxes.route.ts b/apps/www/lib/routes/sandboxes.route.ts\nindex 4a1bd26e6..28217486b 100644\n--- a/apps/www/lib/routes/sandboxes.route.ts\n+++ b/apps/www/lib/routes/sandboxes.route.ts\n@@ -5,6 +5,7 @@ import { stackServerAppJs } from \"@/lib/utils/stack\";\n import { verifyTeamAccess } from \"@/lib/utils/team-verification\";\n import { env } from \"@/lib/utils/www-env\";\n import { api } from \"@cmux/convex/api\";\n+import type { Id } from \"@cmux/convex/dataModel\";\n import { RESERVED_CMUX_PORT_SET } from \"@cmux/shared/utils/reserved-cmux-ports\";\n import { parseGithubRepoUrl } from \"@cmux/shared/utils/parse-github-repo-url\";\n import { createRoute, OpenAPIHono, z } from \"@hono/zod-openapi\";\n@@ -58,6 +59,7 @@ const StartSandboxResponse = z\n     vscodeUrl: z.string(),\n     workerUrl: z.string(),\n     provider: z.enum([\"morph\"]).default(\"morph\"),\n+    vscodePersisted: z.boolean().optional(),\n   })\n   .openapi(\"StartSandboxResponse\");\n \n@@ -243,6 +245,35 @@ sandboxesRouter.openapi(\n         return c.text(\"VSCode or worker service not found\", 500);\n       }\n \n+      // OPTIMIZATION: Immediately persist VSCode URLs to Convex (status=\"starting\")\n+      // This allows frontend to show VSCode iframe while hydration continues\n+      let vscodePersisted = false;\n+      if (body.taskRunId) {\n+        try {\n+          await convex.mutation(api.taskRuns.updateVSCodeInstance, {\n+            teamSlugOrId: body.teamSlugOrId,\n+            id: body.taskRunId as Id<\"taskRuns\">,\n+            vscode: {\n+              provider: \"morph\",\n+              containerName: instance.id,\n+              status: \"starting\",\n+              url: vscodeService.url,\n+              workspaceUrl: `${vscodeService.url}/?folder=/root/workspace`,\n+              startedAt: Date.now(),\n+            },\n+          });\n+          vscodePersisted = true;\n+          console.log(\n+            `[sandboxes.start] Persisted initial VSCode info for ${body.taskRunId}`,\n+          );\n+        } catch (error) {\n+          console.error(\n+            \"[sandboxes.start] Failed to persist initial VSCode info (non-fatal):\",\n+            error,\n+          );\n+        }\n+      }\n+\n       // Get environment variables from the environment if configured\n       const environmentEnvVarsContent = await environmentEnvVarsPromise;\n \n@@ -341,6 +372,22 @@ sandboxesRouter.openapi(\n         return c.text(\"Failed to hydrate sandbox\", 500);\n       }\n \n+      // Update status to \"running\" after hydration completes\n+      if (body.taskRunId && vscodePersisted) {\n+        void convex\n+          .mutation(api.taskRuns.updateVSCodeStatus, {\n+            teamSlugOrId: body.teamSlugOrId,\n+            id: body.taskRunId as Id<\"taskRuns\">,\n+            status: \"running\",\n+          })\n+          .catch((error) => {\n+            console.error(\n+              \"[sandboxes.start] Failed to update VSCode status to running:\",\n+              error,\n+            );\n+          });\n+      }\n+\n       if (maintenanceScript || devScript) {\n         (async () => {\n           await runMaintenanceAndDevScripts({\n@@ -367,6 +414,7 @@ sandboxesRouter.openapi(\n         vscodeUrl: vscodeService.url,\n         workerUrl: workerService.url,\n         provider: \"morph\",\n+        vscodePersisted,\n       });\n     } catch (error) {\n       if (error instanceof HTTPException) {\ndiff --git a/apps/www/package.json b/apps/www/package.json\nindex 61b2354fb..c0ddd3842 100644\n--- a/apps/www/package.json\n+++ b/apps/www/package.json\n@@ -14,7 +14,8 @@\n     \"generate-openapi-client\": \"bun run --env-file ../../.env scripts/watch-openapi.ts\",\n     \"generate-openapi-client:watch\": \"bun run --watch --env-file ../../.env scripts/watch-openapi.ts\",\n     \"backfill-pr\": \"bun run --env-file ../../.env scripts/backfill-pr.ts\",\n-    \"backfill-repo\": \"bun run --env-file ../../.env scripts/backfill-repo.ts\"\n+    \"backfill-repo\": \"bun run --env-file ../../.env scripts/backfill-repo.ts\",\n+    \"bench-morph\": \"bun run --env-file ../../.env scripts/bench-morph-setup.ts\"\n   },\n   \"dependencies\": {\n     \"@ai-sdk/anthropic\": \"^2.0.39\",\ndiff --git a/apps/www/scripts/bench-morph-setup.ts b/apps/www/scripts/bench-morph-setup.ts\nnew file mode 100644\nindex 000000000..d93ea47e3\n--- /dev/null\n+++ b/apps/www/scripts/bench-morph-setup.ts\n@@ -0,0 +1,177 @@\n+/**\n+ * Benchmark script for /morph/setup-instance endpoint\n+ *\n+ * This script calls the endpoint with instrumentation to identify performance bottlenecks.\n+ * Run with: bun apps/www/scripts/bench-morph-setup.ts\n+ *\n+ * To enable server-side timing logs, set MORPH_BENCH=1 before running.\n+ */\n+\n+import { __TEST_INTERNAL_ONLY_GET_STACK_TOKENS } from \"@/lib/test-utils/__TEST_INTERNAL_ONLY_GET_STACK_TOKENS\";\n+import { __TEST_INTERNAL_ONLY_MORPH_CLIENT } from \"@/lib/test-utils/__TEST_INTERNAL_ONLY_MORPH_CLIENT\";\n+import { testApiClient } from \"@/lib/test-utils/openapi-client\";\n+import { postApiMorphSetupInstance } from \"@cmux/www-openapi-client\";\n+\n+// Enable server-side instrumentation\n+process.env.MORPH_BENCH = \"1\";\n+\n+interface TimingResult {\n+  label: string;\n+  durationMs: number;\n+}\n+\n+const timings: TimingResult[] = [];\n+\n+function formatMs(ms: number): string {\n+  if (ms >= 1000) {\n+    return `${(ms / 1000).toFixed(2)}s`;\n+  }\n+  return `${ms.toFixed(0)}ms`;\n+}\n+\n+async function time<T>(label: string, fn: () => Promise<T>): Promise<T> {\n+  const start = performance.now();\n+  try {\n+    return await fn();\n+  } finally {\n+    const duration = performance.now() - start;\n+    timings.push({ label, durationMs: duration });\n+    console.log(`  [${formatMs(duration)}] ${label}`);\n+  }\n+}\n+\n+function printSummary() {\n+  console.log(\"\\n\" + \"=\".repeat(60));\n+  console.log(\"TIMING SUMMARY\");\n+  console.log(\"=\".repeat(60));\n+\n+  const sorted = [...timings].sort((a, b) => b.durationMs - a.durationMs);\n+  const total = timings\n+    .filter((t) => t.label.startsWith(\"Total:\"))\n+    .reduce((sum, t) => sum + t.durationMs, 0);\n+\n+  for (const { label, durationMs } of sorted) {\n+    const pct = total > 0 ? ((durationMs / total) * 100).toFixed(1) : \"-\";\n+    console.log(`${formatMs(durationMs).padStart(8)}  ${pct.padStart(5)}%  ${label}`);\n+  }\n+\n+  console.log(\"=\".repeat(60));\n+}\n+\n+async function main() {\n+  let createdInstanceId: string | null = null;\n+\n+  try {\n+    console.log(\"Benchmarking /morph/setup-instance endpoint\\n\");\n+\n+    // Step 1: Get auth tokens\n+    const tokens = await time(\"Get Stack auth tokens\", async () => {\n+      return __TEST_INTERNAL_ONLY_GET_STACK_TOKENS();\n+    });\n+\n+    // Step 2: Create a new instance (no repos)\n+    console.log(\"\\n--- Creating new instance (no repos) ---\");\n+    const createResult = await time(\"Total: Create new instance\", async () => {\n+      return postApiMorphSetupInstance({\n+        client: testApiClient,\n+        headers: { \"x-stack-auth\": JSON.stringify(tokens) },\n+        body: {\n+          teamSlugOrId: \"manaflow\",\n+          ttlSeconds: 300,\n+        },\n+      });\n+    });\n+\n+    if (createResult.response.status !== 200) {\n+      console.error(\"Failed to create instance:\", createResult.response.status);\n+      console.error(\"Error:\", createResult.error);\n+      process.exit(1);\n+    }\n+\n+    const instanceId = createResult.data?.instanceId;\n+    if (!instanceId) {\n+      console.error(\"No instanceId in response\");\n+      process.exit(1);\n+    }\n+    createdInstanceId = instanceId;\n+    console.log(`  Created instance: ${instanceId}`);\n+\n+    // Step 3: Reuse instance (no repos)\n+    console.log(\"\\n--- Reusing existing instance (no repos) ---\");\n+    await time(\"Total: Reuse instance (no repos)\", async () => {\n+      return postApiMorphSetupInstance({\n+        client: testApiClient,\n+        headers: { \"x-stack-auth\": JSON.stringify(tokens) },\n+        body: {\n+          teamSlugOrId: \"manaflow\",\n+          instanceId,\n+          ttlSeconds: 300,\n+        },\n+      });\n+    });\n+\n+    // Step 4: Clone a single repo\n+    console.log(\"\\n--- Cloning 1 repo ---\");\n+    const cloneResult = await time(\"Total: Clone 1 repo\", async () => {\n+      return postApiMorphSetupInstance({\n+        client: testApiClient,\n+        headers: { \"x-stack-auth\": JSON.stringify(tokens) },\n+        body: {\n+          teamSlugOrId: \"manaflow\",\n+          instanceId,\n+          selectedRepos: [\"manaflow-ai/manaflow-ai-cmux-testing-repo-1\"],\n+          ttlSeconds: 300,\n+        },\n+      });\n+    });\n+\n+    if (cloneResult.response.status === 200) {\n+      console.log(`  Cloned: ${cloneResult.data?.clonedRepos?.join(\", \") || \"none\"}`);\n+    }\n+\n+    // Step 5: Clone multiple repos\n+    console.log(\"\\n--- Cloning 3 repos ---\");\n+    const clone3Result = await time(\"Total: Clone 3 repos\", async () => {\n+      return postApiMorphSetupInstance({\n+        client: testApiClient,\n+        headers: { \"x-stack-auth\": JSON.stringify(tokens) },\n+        body: {\n+          teamSlugOrId: \"manaflow\",\n+          instanceId,\n+          selectedRepos: [\n+            \"manaflow-ai/manaflow-ai-cmux-testing-repo-1\",\n+            \"manaflow-ai/manaflow-ai-cmux-testing-repo-2\",\n+            \"manaflow-ai/manaflow-ai-cmux-testing-repo-3\",\n+          ],\n+          ttlSeconds: 300,\n+        },\n+      });\n+    });\n+\n+    if (clone3Result.response.status === 200) {\n+      console.log(`  Cloned: ${clone3Result.data?.clonedRepos?.join(\", \") || \"none\"}`);\n+    }\n+\n+    // Print summary\n+    printSummary();\n+  } finally {\n+    // Cleanup: stop the instance\n+    if (createdInstanceId) {\n+      console.log(`\\nCleaning up: stopping instance ${createdInstanceId}`);\n+      try {\n+        const inst = await __TEST_INTERNAL_ONLY_MORPH_CLIENT.instances.get({\n+          instanceId: createdInstanceId,\n+        });\n+        await inst.stop();\n+        console.log(\"Instance stopped.\");\n+      } catch (e) {\n+        console.warn(\"Cleanup failed:\", e);\n+      }\n+    }\n+  }\n+}\n+\n+main().catch((err) => {\n+  console.error(\"Script failed:\", err);\n+  process.exit(1);\n+});\ndiff --git a/packages/convex/convex/taskRuns.ts b/packages/convex/convex/taskRuns.ts\nindex 8891b8a7d..bff22c7ed 100644\n--- a/packages/convex/convex/taskRuns.ts\n+++ b/packages/convex/convex/taskRuns.ts\n@@ -203,6 +203,74 @@ async function collectRunSubtreeIds(\n   return Array.from(visited);\n }\n \n+async function updateTaskStatusFromRuns(\n+  ctx: MutationCtx,\n+  taskId: Id<\"tasks\">,\n+  teamId: string,\n+  userId: string,\n+): Promise<void> {\n+  const allRuns = await ctx.db\n+    .query(\"taskRuns\")\n+    .withIndex(\"by_task\", (q) => q.eq(\"taskId\", taskId))\n+    .filter((q) =>\n+      q.and(\n+        q.eq(q.field(\"teamId\"), teamId),\n+        q.eq(q.field(\"userId\"), userId),\n+        q.eq(q.field(\"parentRunId\"), undefined),\n+      ),\n+    )\n+    .collect();\n+\n+  if (allRuns.length === 0) {\n+    return;\n+  }\n+\n+  const terminalStatuses = [\"completed\", \"failed\", \"skipped\"];\n+  const allTerminal = allRuns.every((run) =>\n+    terminalStatuses.includes(run.status),\n+  );\n+\n+  if (!allTerminal) {\n+    return;\n+  }\n+\n+  const completedRuns = allRuns.filter((run) => run.status === \"completed\");\n+  const failedRuns = allRuns.filter((run) => run.status === \"failed\");\n+\n+  const task = await ctx.db.get(taskId);\n+  if (!task || task.teamId !== teamId) {\n+    return;\n+  }\n+\n+  if (task.isCompleted) {\n+    return;\n+  }\n+\n+  const now = Date.now();\n+\n+  if (completedRuns.length === 0) {\n+    const errorMessages = failedRuns\n+      .map((run) => run.errorMessage)\n+      .filter(Boolean);\n+    const aggregatedError =\n+      failedRuns.length === 1\n+        ? errorMessages[0] || \"Task run failed\"\n+        : `All ${failedRuns.length} task run(s) failed`;\n+\n+    await ctx.db.patch(taskId, {\n+      isCompleted: true,\n+      crownEvaluationStatus: \"error\",\n+      crownEvaluationError: aggregatedError,\n+      updatedAt: now,\n+    });\n+  } else {\n+    await ctx.db.patch(taskId, {\n+      isCompleted: true,\n+      updatedAt: now,\n+    });\n+  }\n+}\n+\n async function fetchTaskRunsForTask(\n   ctx: QueryCtx,\n   teamId: string,\n@@ -438,6 +506,11 @@ export const updateStatus = internalMutation({\n     exitCode: v.optional(v.number()),\n   },\n   handler: async (ctx, args) => {\n+    const run = await ctx.db.get(args.id);\n+    if (!run) {\n+      throw new Error(\"Task run not found\");\n+    }\n+\n     const now = Date.now();\n     const updates: {\n       status: typeof args.status;\n@@ -457,6 +530,10 @@ export const updateStatus = internalMutation({\n     }\n \n     await ctx.db.patch(args.id, updates);\n+\n+    if (args.status === \"completed\" || args.status === \"failed\") {\n+      await updateTaskStatusFromRuns(ctx, run.taskId, run.teamId, run.userId);\n+    }\n   },\n });\n \n@@ -762,6 +839,10 @@ export const updateStatusPublic = authMutation({\n     }\n \n     await ctx.db.patch(args.id, updates);\n+\n+    if (args.status === \"completed\" || args.status === \"failed\") {\n+      await updateTaskStatusFromRuns(ctx, doc.taskId, teamId, userId);\n+    }\n   },\n });\n \n@@ -943,10 +1024,11 @@ export const complete = authMutation({\n       completedAt: now,\n       updatedAt: now,\n     });\n+\n+    await updateTaskStatusFromRuns(ctx, doc.taskId, teamId, userId);\n   },\n });\n \n-// Mark a task run as failed with an error message\n export const fail = authMutation({\n   args: {\n     teamSlugOrId: v.string(),\n@@ -969,6 +1051,8 @@ export const fail = authMutation({\n       completedAt: now,\n       updatedAt: now,\n     });\n+\n+    await updateTaskStatusFromRuns(ctx, doc.taskId, teamId, userId);\n   },\n });\n \n@@ -1107,11 +1191,12 @@ export const workerComplete = internalMutation({\n       updatedAt: now,\n     });\n \n+    await updateTaskStatusFromRuns(ctx, run.taskId, run.teamId, run.userId);\n+\n     return run;\n   },\n });\n \n-// Get all active VSCode instances\n export const getActiveVSCodeInstances = authQuery({\n   args: { teamSlugOrId: v.string() },\n   handler: async (ctx, args) => {\ndiff --git a/packages/www-openapi-client/src/client/types.gen.ts b/packages/www-openapi-client/src/client/types.gen.ts\nindex 9e50be3a7..9d02858bd 100644\n--- a/packages/www-openapi-client/src/client/types.gen.ts\n+++ b/packages/www-openapi-client/src/client/types.gen.ts\n@@ -392,7 +392,7 @@ export type SetupInstanceBody = {\n     instanceId?: string;\n     selectedRepos?: Array<string>;\n     ttlSeconds?: number;\n-    snapshotId?: string | ('snapshot_mpzw0j37' | 'snapshot_u6orf3jx' | 'snapshot_pcmfvjra');\n+    snapshotId?: string | ('snapshot_st54kpzd' | 'snapshot_6isj88bc' | 'snapshot_pcmfvjra');\n };\n \n export type CreateEnvironmentResponse = {\n@@ -499,6 +499,7 @@ export type StartSandboxResponse = {\n     vscodeUrl: string;\n     workerUrl: string;\n     provider?: 'morph';\n+    vscodePersisted?: boolean;\n };\n \n export type StartSandboxBody = {\n","comments":[{"type":"issue_comment","id":3615021676,"prNumber":1183,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn72kjz601sqxhf1xpdejafe8n7wpgkv?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn72kjz601sqxhf1xpdejafe8n7wpgkv/run/kd7c162anxk3q5drpv7j4b7nxd7wqxc5/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1183?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"e7fb524c31bd73cb8008d2ec70f85e06063e8624","createdAt":"2025-12-05T02:08:59Z","updatedAt":"2025-12-05T07:00:36Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1183#issuecomment-3615021676"},{"type":"issue_comment","id":3615557199,"prNumber":1183,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn70bt1906h1bj9jf608wr1teh7wprxf?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn70bt1906h1bj9jf608wr1teh7wprxf/run/kd7a9h2mcp5wn51417ayyddhvs7wqgjc/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1183?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"e7fb524c31bd73cb8008d2ec70f85e06063e8624","createdAt":"2025-12-05T07:00:35Z","updatedAt":"2025-12-05T07:02:01Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1183#issuecomment-3615557199"},{"type":"issue_comment","id":3615560330,"prNumber":1183,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7eghxzn16636rjjav1dgvwvx7wpw8s?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7eghxzn16636rjjav1dgvwvx7wpw8s/run/kd7bn1sf7zf1d0yt3yw72aa3997wp0aa/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1183?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"e7fb524c31bd73cb8008d2ec70f85e06063e8624","createdAt":"2025-12-05T07:02:00Z","updatedAt":"2025-12-05T07:32:38Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1183#issuecomment-3615560330"},{"type":"issue_comment","id":3615636967,"prNumber":1183,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn79vbh1ksdyhewn9aggj0mtdd7wq7ey?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn79vbh1ksdyhewn9aggj0mtdd7wq7ey/run/kd736sb4qncyctfh17f3ac43jn7wqecx/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1183?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"e7fb524c31bd73cb8008d2ec70f85e06063e8624","createdAt":"2025-12-05T07:32:37Z","updatedAt":"2025-12-05T07:33:44Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1183#issuecomment-3615636967"},{"type":"issue_comment","id":3615639987,"prNumber":1183,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn7d4w9mm061rsy8350ktv8sr57wpmff?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn7d4w9mm061rsy8350ktv8sr57wpmff/run/kd7aehrmfj4737v523qc6gpwg57wqqj9/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1183?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"e7fb524c31bd73cb8008d2ec70f85e06063e8624","createdAt":"2025-12-05T07:33:43Z","updatedAt":"2025-12-05T08:33:42Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1183#issuecomment-3615639987"},{"type":"issue_comment","id":3615813687,"prNumber":1183,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn77rbpx4a5p3v38hgksevrefh7wpca4?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn77rbpx4a5p3v38hgksevrefh7wpca4/run/kd72qmd34kyrxs88ye89km7mzn7wp6tf/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1183?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"e7fb524c31bd73cb8008d2ec70f85e06063e8624","createdAt":"2025-12-05T08:33:41Z","updatedAt":"2025-12-05T08:33:41Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1183#issuecomment-3615813687"}]}
{"number":1181,"title":"Add reusable GitHub auth refresh for VM","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1181","headRef":"cmux/add-reusable-git-hub-auth-refresh-for-vm-rj94t","headSha":"41b730b2c19e113a3384edf5519c81fb21fa2840","baseRef":"main","baseSha":"60ea8bb027c54b38a9031ff338b6dd6e4c36ed8c","createdAt":"2025-12-05T01:24:03Z","updatedAt":"2025-12-05T05:44:00Z","diff":"diff --git a/apps/client/src/components/TaskTree.tsx b/apps/client/src/components/TaskTree.tsx\nindex 5b6e15934..9cf42fa2e 100644\n--- a/apps/client/src/components/TaskTree.tsx\n+++ b/apps/client/src/components/TaskTree.tsx\n@@ -6,7 +6,10 @@ import {\n } from \"@/components/ui/tooltip\";\n import { convexQueryClient } from \"@/contexts/convex/convex-query-client\";\n import { useArchiveTask } from \"@/hooks/useArchiveTask\";\n-import { useResumeMorphWorkspace } from \"@/hooks/useMorphWorkspace\";\n+import {\n+  useResumeMorphWorkspace,\n+  useRefreshMorphGitHubAuth,\n+} from \"@/hooks/useMorphWorkspace\";\n import { useOpenWithActions } from \"@/hooks/useOpenWithActions\";\n import { useTaskRename } from \"@/hooks/useTaskRename\";\n import { isElectron } from \"@/lib/electron\";\n@@ -55,6 +58,7 @@ import {\n   PinOff,\n   Play,\n   Plus,\n+  RefreshCw,\n   TerminalSquare,\n   Loader2,\n   Trash2,\n@@ -1418,6 +1422,22 @@ function TaskRunTreeInner({\n     });\n   }, [resumeWorkspace, run._id, teamSlugOrId]);\n \n+  const refreshGitHubAuth = useRefreshMorphGitHubAuth({\n+    taskRunId: run._id,\n+    teamSlugOrId,\n+  });\n+\n+  const handleRefreshGitHubAuth = useCallback(() => {\n+    if (refreshGitHubAuth.isPending) {\n+      return;\n+    }\n+\n+    void refreshGitHubAuth.mutateAsync({\n+      path: { taskRunId: run._id },\n+      body: { teamSlugOrId },\n+    });\n+  }, [refreshGitHubAuth, run._id, teamSlugOrId]);\n+\n   const shouldRenderDiffLink = true;\n   const shouldRenderBrowserLink = run.vscode?.provider === \"morph\";\n   const shouldRenderTerminalLink = shouldRenderBrowserLink;\n@@ -1519,6 +1539,18 @@ function TaskRunTreeInner({\n                   {resumeWorkspace.isPending ? \"Resuming…\" : \"Resume VM\"}\n                 </ContextMenu.Item>\n               ) : null}\n+              {run.vscode?.provider === \"morph\" ? (\n+                <ContextMenu.Item\n+                  className=\"flex items-center gap-2 cursor-default py-1.5 pr-8 pl-3 text-[13px] leading-5 outline-none select-none data-[highlighted]:relative data-[highlighted]:z-0 data-[highlighted]:text-white data-[highlighted]:before:absolute data-[highlighted]:before:inset-x-1 data-[highlighted]:before:inset-y-0 data-[highlighted]:before:z-[-1] data-[highlighted]:before:rounded-sm data-[highlighted]:before:bg-neutral-900 dark:data-[highlighted]:before:bg-neutral-700\"\n+                  onClick={handleRefreshGitHubAuth}\n+                  disabled={refreshGitHubAuth.isPending}\n+                >\n+                  <RefreshCw className=\"w-3.5 h-3.5\" />\n+                  {refreshGitHubAuth.isPending\n+                    ? \"Refreshing…\"\n+                    : \"Refresh GitHub auth\"}\n+                </ContextMenu.Item>\n+              ) : null}\n               {hasOpenWithActions ? (\n                 <ContextMenu.SubmenuRoot>\n                   <ContextMenu.SubmenuTrigger className=\"flex items-center gap-2 cursor-default py-1.5 pr-4 pl-3 text-[13px] leading-5 outline-none select-none data-[highlighted]:relative data-[highlighted]:z-0 data-[highlighted]:text-white data-[highlighted]:before:absolute data-[highlighted]:before:inset-x-1 data-[highlighted]:before:inset-y-0 data-[highlighted]:before:z-[-1] data-[highlighted]:before:rounded-sm data-[highlighted]:before:bg-neutral-900 dark:data-[highlighted]:before:bg-neutral-700\">\ndiff --git a/apps/client/src/hooks/useMorphWorkspace.ts b/apps/client/src/hooks/useMorphWorkspace.ts\nindex 0e05330c7..c22ab3d2e 100644\n--- a/apps/client/src/hooks/useMorphWorkspace.ts\n+++ b/apps/client/src/hooks/useMorphWorkspace.ts\n@@ -5,8 +5,13 @@ import {\n   type Options,\n   type PostApiMorphTaskRunsByTaskRunIdResumeData,\n   type PostApiMorphTaskRunsByTaskRunIdResumeResponse,\n+  type PostApiMorphTaskRunsByTaskRunIdRefreshGithubAuthData,\n+  type PostApiMorphTaskRunsByTaskRunIdRefreshGithubAuthResponse,\n } from \"@cmux/www-openapi-client\";\n-import { postApiMorphTaskRunsByTaskRunIdResumeMutation } from \"@cmux/www-openapi-client/react-query\";\n+import {\n+  postApiMorphTaskRunsByTaskRunIdResumeMutation,\n+  postApiMorphTaskRunsByTaskRunIdRefreshGithubAuthMutation,\n+} from \"@cmux/www-openapi-client/react-query\";\n import { toast } from \"sonner\";\n import { queryClient } from \"@/query-client\";\n import { api } from \"@cmux/convex/api\";\n@@ -96,3 +101,53 @@ export function useResumeMorphWorkspace({\n     },\n   });\n }\n+\n+interface UseRefreshGitHubAuthArgs {\n+  taskRunId: Id<\"taskRuns\">;\n+  teamSlugOrId: string;\n+  onSuccess?: () => void;\n+  onError?: (error: unknown) => void;\n+}\n+\n+export function useRefreshMorphGitHubAuth({\n+  taskRunId,\n+  teamSlugOrId: _teamSlugOrId,\n+  onSuccess,\n+  onError,\n+}: UseRefreshGitHubAuthArgs) {\n+  return useMutation<\n+    PostApiMorphTaskRunsByTaskRunIdRefreshGithubAuthResponse,\n+    Error,\n+    Options<PostApiMorphTaskRunsByTaskRunIdRefreshGithubAuthData>,\n+    { toastId: string | number }\n+  >({\n+    ...postApiMorphTaskRunsByTaskRunIdRefreshGithubAuthMutation(),\n+    mutationKey: [\"refresh-github-auth\", \"task-run\", taskRunId],\n+    onMutate: async () => {\n+      const toastId = toast.loading(\"Refreshing GitHub authentication…\");\n+      return { toastId };\n+    },\n+    onSuccess: (_data, __, context) => {\n+      toast.success(\"GitHub authentication refreshed\", { id: context?.toastId });\n+      onSuccess?.();\n+    },\n+    onError: (error, _variables, context) => {\n+      let message = \"Failed to refresh GitHub auth.\";\n+      if (error instanceof Error) {\n+        // Handle specific error cases\n+        if (error.message.includes(\"409\") || error.message.includes(\"paused\")) {\n+          message = \"VM is paused. Resume it first.\";\n+        } else if (\n+          error.message.includes(\"401\") ||\n+          error.message.includes(\"GitHub\")\n+        ) {\n+          message = \"GitHub account not connected. Check your settings.\";\n+        } else {\n+          message = error.message;\n+        }\n+      }\n+      toast.error(message, { id: context?.toastId });\n+      onError?.(error);\n+    },\n+  });\n+}\ndiff --git a/apps/www/lib/routes/morph.route.ts b/apps/www/lib/routes/morph.route.ts\nindex 88965d713..c0e7466d8 100644\n--- a/apps/www/lib/routes/morph.route.ts\n+++ b/apps/www/lib/routes/morph.route.ts\n@@ -262,6 +262,159 @@ morphRouter.openapi(\n   }\n );\n \n+const RefreshGitHubAuthBody = z\n+  .object({\n+    teamSlugOrId: z.string(),\n+  })\n+  .openapi(\"RefreshGitHubAuthBody\");\n+\n+const RefreshGitHubAuthResponse = z\n+  .object({\n+    refreshed: z.literal(true),\n+  })\n+  .openapi(\"RefreshGitHubAuthResponse\");\n+\n+/**\n+ * Fetches a fresh GitHub access token for the authenticated user.\n+ * This is a reusable helper to avoid duplicating token retrieval logic.\n+ */\n+async function getFreshGitHubToken(\n+  user: Awaited<ReturnType<typeof stackServerAppJs.getUser>>\n+): Promise<{ token: string } | { error: string; status: 401 }> {\n+  if (!user) {\n+    return { error: \"Unauthorized\", status: 401 };\n+  }\n+  const githubAccount = await user.getConnectedAccount(\"github\");\n+  if (!githubAccount) {\n+    return { error: \"GitHub account not connected\", status: 401 };\n+  }\n+  const { accessToken: githubAccessToken } =\n+    await githubAccount.getAccessToken();\n+  if (!githubAccessToken) {\n+    return { error: \"Failed to get GitHub access token\", status: 401 };\n+  }\n+  return { token: githubAccessToken };\n+}\n+\n+morphRouter.openapi(\n+  createRoute({\n+    method: \"post\" as const,\n+    path: \"/morph/task-runs/{taskRunId}/refresh-github-auth\",\n+    tags: [\"Morph\"],\n+    summary: \"Refresh GitHub authentication on a Morph instance\",\n+    description:\n+      \"Re-authenticates the GitHub CLI inside a running Morph VM with a fresh token. \" +\n+      \"Useful when the token has expired or the user has re-connected their GitHub account.\",\n+    request: {\n+      params: z.object({\n+        taskRunId: typedZid(\"taskRuns\"),\n+      }),\n+      body: {\n+        content: {\n+          \"application/json\": {\n+            schema: RefreshGitHubAuthBody,\n+          },\n+        },\n+        required: true,\n+      },\n+    },\n+    responses: {\n+      200: {\n+        content: {\n+          \"application/json\": {\n+            schema: RefreshGitHubAuthResponse,\n+          },\n+        },\n+        description: \"GitHub authentication refreshed successfully\",\n+      },\n+      400: { description: \"Task run is not backed by a Morph instance\" },\n+      401: { description: \"Unauthorized or GitHub not connected\" },\n+      403: { description: \"Forbidden - instance does not belong to this team\" },\n+      404: { description: \"Task run not found\" },\n+      409: { description: \"Instance is paused - resume it first\" },\n+      500: { description: \"Failed to refresh GitHub authentication\" },\n+    },\n+  }),\n+  async (c) => {\n+    // Authenticate user via Stack Auth (server-side token retrieval)\n+    const user = await stackServerAppJs.getUser({ tokenStore: c.req.raw });\n+    if (!user) {\n+      return c.text(\"Unauthorized\", 401);\n+    }\n+\n+    const { accessToken } = await user.getAuthJson();\n+    if (!accessToken) {\n+      return c.text(\"Unauthorized\", 401);\n+    }\n+\n+    const { taskRunId } = c.req.valid(\"param\");\n+    const { teamSlugOrId } = c.req.valid(\"json\");\n+\n+    // Verify team access\n+    const convex = getConvex({ accessToken });\n+    const team = await verifyTeamAccess({ req: c.req.raw, teamSlugOrId });\n+\n+    // Get task run\n+    const taskRun = await convex.query(api.taskRuns.get, {\n+      teamSlugOrId,\n+      id: taskRunId,\n+    });\n+\n+    if (!taskRun) {\n+      return c.text(\"Task run not found\", 404);\n+    }\n+\n+    const instanceId = taskRun.vscode?.containerName;\n+    const isMorphProvider = taskRun.vscode?.provider === \"morph\";\n+\n+    if (!isMorphProvider || !instanceId) {\n+      return c.text(\"Task run is not backed by a Morph instance\", 400);\n+    }\n+\n+    try {\n+      const client = new MorphCloudClient({ apiKey: env.MORPH_API_KEY });\n+      const instance = await client.instances.get({ instanceId });\n+\n+      // Security: ensure the instance belongs to the requested team\n+      const metadataTeamId = (\n+        instance as unknown as {\n+          metadata?: { teamId?: string };\n+        }\n+      ).metadata?.teamId;\n+\n+      if (metadataTeamId && metadataTeamId !== team.uuid) {\n+        return c.text(\"Forbidden\", 403);\n+      }\n+\n+      // Check if instance is paused - auth refresh requires running instance\n+      if (instance.status === \"paused\") {\n+        return c.text(\"Instance is paused - resume it first\", 409);\n+      }\n+\n+      // Get fresh GitHub token (server-side, never from client)\n+      const tokenResult = await getFreshGitHubToken(user);\n+      if (\"error\" in tokenResult) {\n+        return c.text(tokenResult.error, tokenResult.status);\n+      }\n+\n+      // Use the existing configureGithubAccess function to refresh auth\n+      await configureGithubAccess(instance, tokenResult.token);\n+\n+      console.log(\n+        `[morph.refresh-github-auth] Successfully refreshed GitHub auth for instance ${instanceId}`\n+      );\n+\n+      return c.json({ refreshed: true });\n+    } catch (error) {\n+      console.error(\n+        \"[morph.refresh-github-auth] Failed to refresh GitHub auth:\",\n+        error\n+      );\n+      return c.text(\"Failed to refresh GitHub authentication\", 500);\n+    }\n+  }\n+);\n+\n morphRouter.openapi(\n   createRoute({\n     method: \"post\" as const,\ndiff --git a/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts b/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts\nindex f99506014..af5ad6bcf 100644\n--- a/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts\n+++ b/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts\n@@ -1,8 +1,8 @@\n // This file is auto-generated by @hey-api/openapi-ts\n \n-import { type Options, getApiHealth, postApiAuthAnonymousSignUp, getApiUsers, postApiUsers, deleteApiUsersById, getApiUsersById, patchApiUsersById, getApiBooks, postApiBooks, getApiBooksById, postApiBooksByIdBorrow, postApiBooksByIdReturn, postApiDevServerStart, getApiIntegrationsGithubRepos, getApiIntegrationsGithubPrs, postApiIntegrationsGithubPrsBackfill, postApiIntegrationsGithubPrsBackfillRepo, getApiIntegrationsGithubPrsCode, postApiIntegrationsGithubPrsOpen, postApiIntegrationsGithubPrsMerge, postApiIntegrationsGithubPrsClose, postApiIntegrationsGithubPrsMergeSimple, getApiIntegrationsGithubPrsRaw, getApiIntegrationsGithubPrsFiles, getApiIntegrationsGithubPrsFileContents, postApiIntegrationsGithubPrsFileContentsBatch, postApiIntegrationsGithubInstallState, getApiIntegrationsGithubOauthToken, postApiMorphTaskRunsByTaskRunIdResume, postApiMorphTaskRunsByTaskRunIdIsPaused, postApiMorphSetupInstance, getApiEnvironments, postApiEnvironments, deleteApiEnvironmentsById, getApiEnvironmentsById, patchApiEnvironmentsById, getApiEnvironmentsByIdVars, patchApiEnvironmentsByIdPorts, getApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivate, postApiSandboxesStart, postApiSandboxesByIdEnv, postApiSandboxesByIdStop, getApiSandboxesByIdStatus, postApiSandboxesByIdPublishDevcontainer, postApiTeams, postApiBranchesGenerate, postApiCodeReviewStart, getApiWorkspaceConfigs, postApiWorkspaceConfigs, getApiPreviewConfigs, postApiPreviewConfigs, deleteApiPreviewConfigsByPreviewConfigId, getApiPreviewConfigsByPreviewConfigIdRuns } from '../sdk.gen.js';\n+import { type Options, getApiHealth, postApiAuthAnonymousSignUp, getApiUsers, postApiUsers, deleteApiUsersById, getApiUsersById, patchApiUsersById, getApiBooks, postApiBooks, getApiBooksById, postApiBooksByIdBorrow, postApiBooksByIdReturn, postApiDevServerStart, getApiIntegrationsGithubRepos, getApiIntegrationsGithubPrs, postApiIntegrationsGithubPrsBackfill, postApiIntegrationsGithubPrsBackfillRepo, getApiIntegrationsGithubPrsCode, postApiIntegrationsGithubPrsOpen, postApiIntegrationsGithubPrsMerge, postApiIntegrationsGithubPrsClose, postApiIntegrationsGithubPrsMergeSimple, getApiIntegrationsGithubPrsRaw, getApiIntegrationsGithubPrsFiles, getApiIntegrationsGithubPrsFileContents, postApiIntegrationsGithubPrsFileContentsBatch, postApiIntegrationsGithubInstallState, getApiIntegrationsGithubOauthToken, postApiMorphTaskRunsByTaskRunIdResume, postApiMorphTaskRunsByTaskRunIdIsPaused, postApiMorphTaskRunsByTaskRunIdRefreshGithubAuth, postApiMorphSetupInstance, getApiEnvironments, postApiEnvironments, deleteApiEnvironmentsById, getApiEnvironmentsById, patchApiEnvironmentsById, getApiEnvironmentsByIdVars, patchApiEnvironmentsByIdPorts, getApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivate, postApiSandboxesStart, postApiSandboxesByIdEnv, postApiSandboxesByIdStop, getApiSandboxesByIdStatus, postApiSandboxesByIdPublishDevcontainer, postApiTeams, postApiBranchesGenerate, postApiCodeReviewStart, getApiWorkspaceConfigs, postApiWorkspaceConfigs, getApiPreviewConfigs, postApiPreviewConfigs, deleteApiPreviewConfigsByPreviewConfigId, getApiPreviewConfigsByPreviewConfigIdRuns } from '../sdk.gen.js';\n import { queryOptions, type UseMutationOptions, type DefaultError, infiniteQueryOptions, type InfiniteData } from '@tanstack/react-query';\n-import type { GetApiHealthData, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponse, GetApiUsersData, GetApiUsersResponse, PostApiUsersData, PostApiUsersError, PostApiUsersResponse, DeleteApiUsersByIdData, DeleteApiUsersByIdError, DeleteApiUsersByIdResponse, GetApiUsersByIdData, PatchApiUsersByIdData, PatchApiUsersByIdError, PatchApiUsersByIdResponse, GetApiBooksData, PostApiBooksData, PostApiBooksError, PostApiBooksResponse, GetApiBooksByIdData, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowError, PostApiBooksByIdBorrowResponse, PostApiBooksByIdReturnData, PostApiBooksByIdReturnError, PostApiBooksByIdReturnResponse, PostApiDevServerStartData, PostApiDevServerStartError, PostApiDevServerStartResponse, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponse, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponse, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillRepoData, GetApiIntegrationsGithubPrsCodeData, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponse, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponse, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponse, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponse, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFileContentsData, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponse, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponse, GetApiIntegrationsGithubOauthTokenData, PostApiMorphTaskRunsByTaskRunIdResumeData, PostApiMorphTaskRunsByTaskRunIdResumeResponse, PostApiMorphTaskRunsByTaskRunIdIsPausedData, PostApiMorphTaskRunsByTaskRunIdIsPausedResponse, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponse, GetApiEnvironmentsData, PostApiEnvironmentsData, PostApiEnvironmentsResponse, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdData, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdVarsData, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponse, GetApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponse, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponse, PostApiSandboxesStartData, PostApiSandboxesStartResponse, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponse, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponse, GetApiSandboxesByIdStatusData, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponse, PostApiTeamsData, PostApiTeamsError, PostApiTeamsResponse, PostApiBranchesGenerateData, PostApiBranchesGenerateResponse, PostApiCodeReviewStartData, PostApiCodeReviewStartResponse, GetApiWorkspaceConfigsData, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponse, GetApiPreviewConfigsData, PostApiPreviewConfigsData, PostApiPreviewConfigsResponse, DeleteApiPreviewConfigsByPreviewConfigIdData, DeleteApiPreviewConfigsByPreviewConfigIdResponse, GetApiPreviewConfigsByPreviewConfigIdRunsData } from '../types.gen.js';\n+import type { GetApiHealthData, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponse, GetApiUsersData, GetApiUsersResponse, PostApiUsersData, PostApiUsersError, PostApiUsersResponse, DeleteApiUsersByIdData, DeleteApiUsersByIdError, DeleteApiUsersByIdResponse, GetApiUsersByIdData, PatchApiUsersByIdData, PatchApiUsersByIdError, PatchApiUsersByIdResponse, GetApiBooksData, PostApiBooksData, PostApiBooksError, PostApiBooksResponse, GetApiBooksByIdData, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowError, PostApiBooksByIdBorrowResponse, PostApiBooksByIdReturnData, PostApiBooksByIdReturnError, PostApiBooksByIdReturnResponse, PostApiDevServerStartData, PostApiDevServerStartError, PostApiDevServerStartResponse, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponse, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponse, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillRepoData, GetApiIntegrationsGithubPrsCodeData, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponse, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponse, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponse, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponse, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFileContentsData, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponse, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponse, GetApiIntegrationsGithubOauthTokenData, PostApiMorphTaskRunsByTaskRunIdResumeData, PostApiMorphTaskRunsByTaskRunIdResumeResponse, PostApiMorphTaskRunsByTaskRunIdIsPausedData, PostApiMorphTaskRunsByTaskRunIdIsPausedResponse, PostApiMorphTaskRunsByTaskRunIdRefreshGithubAuthData, PostApiMorphTaskRunsByTaskRunIdRefreshGithubAuthResponse, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponse, GetApiEnvironmentsData, PostApiEnvironmentsData, PostApiEnvironmentsResponse, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdData, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdVarsData, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponse, GetApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponse, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponse, PostApiSandboxesStartData, PostApiSandboxesStartResponse, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponse, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponse, GetApiSandboxesByIdStatusData, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponse, PostApiTeamsData, PostApiTeamsError, PostApiTeamsResponse, PostApiBranchesGenerateData, PostApiBranchesGenerateResponse, PostApiCodeReviewStartData, PostApiCodeReviewStartResponse, GetApiWorkspaceConfigsData, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponse, GetApiPreviewConfigsData, PostApiPreviewConfigsData, PostApiPreviewConfigsResponse, DeleteApiPreviewConfigsByPreviewConfigIdData, DeleteApiPreviewConfigsByPreviewConfigIdResponse, GetApiPreviewConfigsByPreviewConfigIdRunsData } from '../types.gen.js';\n import { client as _heyApiClient } from '../client.gen.js';\n \n export type QueryKey<TOptions extends Options> = [\n@@ -705,6 +705,24 @@ export const postApiMorphTaskRunsByTaskRunIdIsPausedMutation = (options?: Partia\n     return mutationOptions;\n };\n \n+/**\n+ * Refresh GitHub authentication on a Morph instance\n+ * Re-authenticates the GitHub CLI inside a running Morph VM with a fresh token. Useful when the token has expired or the user has re-connected their GitHub account.\n+ */\n+export const postApiMorphTaskRunsByTaskRunIdRefreshGithubAuthMutation = (options?: Partial<Options<PostApiMorphTaskRunsByTaskRunIdRefreshGithubAuthData>>): UseMutationOptions<PostApiMorphTaskRunsByTaskRunIdRefreshGithubAuthResponse, DefaultError, Options<PostApiMorphTaskRunsByTaskRunIdRefreshGithubAuthData>> => {\n+    const mutationOptions: UseMutationOptions<PostApiMorphTaskRunsByTaskRunIdRefreshGithubAuthResponse, DefaultError, Options<PostApiMorphTaskRunsByTaskRunIdRefreshGithubAuthData>> = {\n+        mutationFn: async (fnOptions) => {\n+            const { data } = await postApiMorphTaskRunsByTaskRunIdRefreshGithubAuth({\n+                ...options,\n+                ...fnOptions,\n+                throwOnError: true\n+            });\n+            return data;\n+        }\n+    };\n+    return mutationOptions;\n+};\n+\n /**\n  * Setup a Morph instance with optional repository cloning\n  */\ndiff --git a/packages/www-openapi-client/src/client/sdk.gen.ts b/packages/www-openapi-client/src/client/sdk.gen.ts\nindex 834397a27..ba70a34d8 100644\n--- a/packages/www-openapi-client/src/client/sdk.gen.ts\n+++ b/packages/www-openapi-client/src/client/sdk.gen.ts\n@@ -1,7 +1,7 @@\n // This file is auto-generated by @hey-api/openapi-ts\n \n import type { Options as ClientOptions, TDataShape, Client } from './client/index.js';\n-import type { GetApiHealthData, GetApiHealthResponses, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponses, PostApiAuthAnonymousSignUpErrors, GetApiUsersData, GetApiUsersResponses, PostApiUsersData, PostApiUsersResponses, PostApiUsersErrors, DeleteApiUsersByIdData, DeleteApiUsersByIdResponses, DeleteApiUsersByIdErrors, GetApiUsersByIdData, GetApiUsersByIdResponses, GetApiUsersByIdErrors, PatchApiUsersByIdData, PatchApiUsersByIdResponses, PatchApiUsersByIdErrors, GetApiBooksData, GetApiBooksResponses, PostApiBooksData, PostApiBooksResponses, PostApiBooksErrors, GetApiBooksByIdData, GetApiBooksByIdResponses, GetApiBooksByIdErrors, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowResponses, PostApiBooksByIdBorrowErrors, PostApiBooksByIdReturnData, PostApiBooksByIdReturnResponses, PostApiBooksByIdReturnErrors, PostApiDevServerStartData, PostApiDevServerStartResponses, PostApiDevServerStartErrors, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponses, GetApiIntegrationsGithubReposErrors, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponses, GetApiIntegrationsGithubPrsErrors, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillResponses, PostApiIntegrationsGithubPrsBackfillErrors, PostApiIntegrationsGithubPrsBackfillRepoData, PostApiIntegrationsGithubPrsBackfillRepoResponses, PostApiIntegrationsGithubPrsBackfillRepoErrors, GetApiIntegrationsGithubPrsCodeData, GetApiIntegrationsGithubPrsCodeResponses, GetApiIntegrationsGithubPrsCodeErrors, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponses, PostApiIntegrationsGithubPrsOpenErrors, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponses, PostApiIntegrationsGithubPrsMergeErrors, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponses, PostApiIntegrationsGithubPrsCloseErrors, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponses, PostApiIntegrationsGithubPrsMergeSimpleErrors, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsRawResponses, GetApiIntegrationsGithubPrsRawErrors, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFilesResponses, GetApiIntegrationsGithubPrsFilesErrors, GetApiIntegrationsGithubPrsFileContentsData, GetApiIntegrationsGithubPrsFileContentsResponses, GetApiIntegrationsGithubPrsFileContentsErrors, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponses, PostApiIntegrationsGithubPrsFileContentsBatchErrors, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponses, PostApiIntegrationsGithubInstallStateErrors, GetApiIntegrationsGithubOauthTokenData, GetApiIntegrationsGithubOauthTokenResponses, GetApiIntegrationsGithubOauthTokenErrors, PostApiMorphTaskRunsByTaskRunIdResumeData, PostApiMorphTaskRunsByTaskRunIdResumeResponses, PostApiMorphTaskRunsByTaskRunIdResumeErrors, PostApiMorphTaskRunsByTaskRunIdIsPausedData, PostApiMorphTaskRunsByTaskRunIdIsPausedResponses, PostApiMorphTaskRunsByTaskRunIdIsPausedErrors, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponses, PostApiMorphSetupInstanceErrors, GetApiIframePreflightData, GetApiIframePreflightResponses, GetApiIframePreflightErrors, GetApiEnvironmentsData, GetApiEnvironmentsResponses, GetApiEnvironmentsErrors, PostApiEnvironmentsData, PostApiEnvironmentsResponses, PostApiEnvironmentsErrors, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponses, DeleteApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdData, GetApiEnvironmentsByIdResponses, GetApiEnvironmentsByIdErrors, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponses, PatchApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdVarsData, GetApiEnvironmentsByIdVarsResponses, GetApiEnvironmentsByIdVarsErrors, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponses, PatchApiEnvironmentsByIdPortsErrors, GetApiEnvironmentsByIdSnapshotsData, GetApiEnvironmentsByIdSnapshotsResponses, GetApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponses, PostApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponses, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateErrors, PostApiSandboxesStartData, PostApiSandboxesStartResponses, PostApiSandboxesStartErrors, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponses, PostApiSandboxesByIdEnvErrors, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponses, PostApiSandboxesByIdStopErrors, GetApiSandboxesByIdStatusData, GetApiSandboxesByIdStatusResponses, GetApiSandboxesByIdStatusErrors, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponses, PostApiSandboxesByIdPublishDevcontainerErrors, PostApiTeamsData, PostApiTeamsResponses, PostApiTeamsErrors, PostApiBranchesGenerateData, PostApiBranchesGenerateResponses, PostApiBranchesGenerateErrors, PostApiCodeReviewStartData, PostApiCodeReviewStartResponses, PostApiCodeReviewStartErrors, GetApiWorkspaceConfigsData, GetApiWorkspaceConfigsResponses, GetApiWorkspaceConfigsErrors, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponses, PostApiWorkspaceConfigsErrors, GetApiPreviewConfigsData, GetApiPreviewConfigsResponses, GetApiPreviewConfigsErrors, PostApiPreviewConfigsData, PostApiPreviewConfigsResponses, PostApiPreviewConfigsErrors, DeleteApiPreviewConfigsByPreviewConfigIdData, DeleteApiPreviewConfigsByPreviewConfigIdResponses, DeleteApiPreviewConfigsByPreviewConfigIdErrors, GetApiPreviewConfigsByPreviewConfigIdRunsData, GetApiPreviewConfigsByPreviewConfigIdRunsResponses, GetApiPreviewConfigsByPreviewConfigIdRunsErrors } from './types.gen.js';\n+import type { GetApiHealthData, GetApiHealthResponses, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponses, PostApiAuthAnonymousSignUpErrors, GetApiUsersData, GetApiUsersResponses, PostApiUsersData, PostApiUsersResponses, PostApiUsersErrors, DeleteApiUsersByIdData, DeleteApiUsersByIdResponses, DeleteApiUsersByIdErrors, GetApiUsersByIdData, GetApiUsersByIdResponses, GetApiUsersByIdErrors, PatchApiUsersByIdData, PatchApiUsersByIdResponses, PatchApiUsersByIdErrors, GetApiBooksData, GetApiBooksResponses, PostApiBooksData, PostApiBooksResponses, PostApiBooksErrors, GetApiBooksByIdData, GetApiBooksByIdResponses, GetApiBooksByIdErrors, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowResponses, PostApiBooksByIdBorrowErrors, PostApiBooksByIdReturnData, PostApiBooksByIdReturnResponses, PostApiBooksByIdReturnErrors, PostApiDevServerStartData, PostApiDevServerStartResponses, PostApiDevServerStartErrors, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponses, GetApiIntegrationsGithubReposErrors, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponses, GetApiIntegrationsGithubPrsErrors, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillResponses, PostApiIntegrationsGithubPrsBackfillErrors, PostApiIntegrationsGithubPrsBackfillRepoData, PostApiIntegrationsGithubPrsBackfillRepoResponses, PostApiIntegrationsGithubPrsBackfillRepoErrors, GetApiIntegrationsGithubPrsCodeData, GetApiIntegrationsGithubPrsCodeResponses, GetApiIntegrationsGithubPrsCodeErrors, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponses, PostApiIntegrationsGithubPrsOpenErrors, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponses, PostApiIntegrationsGithubPrsMergeErrors, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponses, PostApiIntegrationsGithubPrsCloseErrors, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponses, PostApiIntegrationsGithubPrsMergeSimpleErrors, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsRawResponses, GetApiIntegrationsGithubPrsRawErrors, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFilesResponses, GetApiIntegrationsGithubPrsFilesErrors, GetApiIntegrationsGithubPrsFileContentsData, GetApiIntegrationsGithubPrsFileContentsResponses, GetApiIntegrationsGithubPrsFileContentsErrors, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponses, PostApiIntegrationsGithubPrsFileContentsBatchErrors, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponses, PostApiIntegrationsGithubInstallStateErrors, GetApiIntegrationsGithubOauthTokenData, GetApiIntegrationsGithubOauthTokenResponses, GetApiIntegrationsGithubOauthTokenErrors, PostApiMorphTaskRunsByTaskRunIdResumeData, PostApiMorphTaskRunsByTaskRunIdResumeResponses, PostApiMorphTaskRunsByTaskRunIdResumeErrors, PostApiMorphTaskRunsByTaskRunIdIsPausedData, PostApiMorphTaskRunsByTaskRunIdIsPausedResponses, PostApiMorphTaskRunsByTaskRunIdIsPausedErrors, PostApiMorphTaskRunsByTaskRunIdRefreshGithubAuthData, PostApiMorphTaskRunsByTaskRunIdRefreshGithubAuthResponses, PostApiMorphTaskRunsByTaskRunIdRefreshGithubAuthErrors, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponses, PostApiMorphSetupInstanceErrors, GetApiIframePreflightData, GetApiIframePreflightResponses, GetApiIframePreflightErrors, GetApiEnvironmentsData, GetApiEnvironmentsResponses, GetApiEnvironmentsErrors, PostApiEnvironmentsData, PostApiEnvironmentsResponses, PostApiEnvironmentsErrors, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponses, DeleteApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdData, GetApiEnvironmentsByIdResponses, GetApiEnvironmentsByIdErrors, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponses, PatchApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdVarsData, GetApiEnvironmentsByIdVarsResponses, GetApiEnvironmentsByIdVarsErrors, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponses, PatchApiEnvironmentsByIdPortsErrors, GetApiEnvironmentsByIdSnapshotsData, GetApiEnvironmentsByIdSnapshotsResponses, GetApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponses, PostApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponses, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateErrors, PostApiSandboxesStartData, PostApiSandboxesStartResponses, PostApiSandboxesStartErrors, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponses, PostApiSandboxesByIdEnvErrors, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponses, PostApiSandboxesByIdStopErrors, GetApiSandboxesByIdStatusData, GetApiSandboxesByIdStatusResponses, GetApiSandboxesByIdStatusErrors, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponses, PostApiSandboxesByIdPublishDevcontainerErrors, PostApiTeamsData, PostApiTeamsResponses, PostApiTeamsErrors, PostApiBranchesGenerateData, PostApiBranchesGenerateResponses, PostApiBranchesGenerateErrors, PostApiCodeReviewStartData, PostApiCodeReviewStartResponses, PostApiCodeReviewStartErrors, GetApiWorkspaceConfigsData, GetApiWorkspaceConfigsResponses, GetApiWorkspaceConfigsErrors, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponses, PostApiWorkspaceConfigsErrors, GetApiPreviewConfigsData, GetApiPreviewConfigsResponses, GetApiPreviewConfigsErrors, PostApiPreviewConfigsData, PostApiPreviewConfigsResponses, PostApiPreviewConfigsErrors, DeleteApiPreviewConfigsByPreviewConfigIdData, DeleteApiPreviewConfigsByPreviewConfigIdResponses, DeleteApiPreviewConfigsByPreviewConfigIdErrors, GetApiPreviewConfigsByPreviewConfigIdRunsData, GetApiPreviewConfigsByPreviewConfigIdRunsResponses, GetApiPreviewConfigsByPreviewConfigIdRunsErrors } from './types.gen.js';\n import { client as _heyApiClient } from './client.gen.js';\n \n export type Options<TData extends TDataShape = TDataShape, ThrowOnError extends boolean = boolean> = ClientOptions<TData, ThrowOnError> & {\n@@ -375,6 +375,21 @@ export const postApiMorphTaskRunsByTaskRunIdIsPaused = <ThrowOnError extends boo\n     });\n };\n \n+/**\n+ * Refresh GitHub authentication on a Morph instance\n+ * Re-authenticates the GitHub CLI inside a running Morph VM with a fresh token. Useful when the token has expired or the user has re-connected their GitHub account.\n+ */\n+export const postApiMorphTaskRunsByTaskRunIdRefreshGithubAuth = <ThrowOnError extends boolean = false>(options: Options<PostApiMorphTaskRunsByTaskRunIdRefreshGithubAuthData, ThrowOnError>) => {\n+    return (options.client ?? _heyApiClient).post<PostApiMorphTaskRunsByTaskRunIdRefreshGithubAuthResponses, PostApiMorphTaskRunsByTaskRunIdRefreshGithubAuthErrors, ThrowOnError>({\n+        url: '/api/morph/task-runs/{taskRunId}/refresh-github-auth',\n+        ...options,\n+        headers: {\n+            'Content-Type': 'application/json',\n+            ...options.headers\n+        }\n+    });\n+};\n+\n /**\n  * Setup a Morph instance with optional repository cloning\n  */\ndiff --git a/packages/www-openapi-client/src/client/types.gen.ts b/packages/www-openapi-client/src/client/types.gen.ts\nindex e9427228f..9e50be3a7 100644\n--- a/packages/www-openapi-client/src/client/types.gen.ts\n+++ b/packages/www-openapi-client/src/client/types.gen.ts\n@@ -372,6 +372,14 @@ export type CheckTaskRunPausedBody = {\n     teamSlugOrId: string;\n };\n \n+export type RefreshGitHubAuthResponse = {\n+    refreshed: true;\n+};\n+\n+export type RefreshGitHubAuthBody = {\n+    teamSlugOrId: string;\n+};\n+\n export type SetupInstanceResponse = {\n     instanceId: string;\n     vscodeUrl: string;\n@@ -1733,6 +1741,51 @@ export type PostApiMorphTaskRunsByTaskRunIdIsPausedResponses = {\n \n export type PostApiMorphTaskRunsByTaskRunIdIsPausedResponse = PostApiMorphTaskRunsByTaskRunIdIsPausedResponses[keyof PostApiMorphTaskRunsByTaskRunIdIsPausedResponses];\n \n+export type PostApiMorphTaskRunsByTaskRunIdRefreshGithubAuthData = {\n+    body: RefreshGitHubAuthBody;\n+    path: {\n+        taskRunId: string;\n+    };\n+    query?: never;\n+    url: '/api/morph/task-runs/{taskRunId}/refresh-github-auth';\n+};\n+\n+export type PostApiMorphTaskRunsByTaskRunIdRefreshGithubAuthErrors = {\n+    /**\n+     * Task run is not backed by a Morph instance\n+     */\n+    400: unknown;\n+    /**\n+     * Unauthorized or GitHub not connected\n+     */\n+    401: unknown;\n+    /**\n+     * Forbidden - instance does not belong to this team\n+     */\n+    403: unknown;\n+    /**\n+     * Task run not found\n+     */\n+    404: unknown;\n+    /**\n+     * Instance is paused - resume it first\n+     */\n+    409: unknown;\n+    /**\n+     * Failed to refresh GitHub authentication\n+     */\n+    500: unknown;\n+};\n+\n+export type PostApiMorphTaskRunsByTaskRunIdRefreshGithubAuthResponses = {\n+    /**\n+     * GitHub authentication refreshed successfully\n+     */\n+    200: RefreshGitHubAuthResponse;\n+};\n+\n+export type PostApiMorphTaskRunsByTaskRunIdRefreshGithubAuthResponse = PostApiMorphTaskRunsByTaskRunIdRefreshGithubAuthResponses[keyof PostApiMorphTaskRunsByTaskRunIdRefreshGithubAuthResponses];\n+\n export type PostApiMorphSetupInstanceData = {\n     body: SetupInstanceBody;\n     path?: never;\n","comments":[{"type":"issue_comment","id":3614953347,"prNumber":1181,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7a6af54q1h28hqahgvgy1qw57wp19f?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7a6af54q1h28hqahgvgy1qw57wp19f/run/kd77rhq6wz619gr4tzje098zwd7wqyz6/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1181?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"41b730b2c19e113a3384edf5519c81fb21fa2840","createdAt":"2025-12-05T01:31:36Z","updatedAt":"2025-12-05T01:41:57Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1181#issuecomment-3614953347"},{"type":"issue_comment","id":3614957007,"prNumber":1181,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7fzx3dftbaqxdj7avym19m2s7wqxf6?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7fzx3dftbaqxdj7avym19m2s7wqxf6/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1181?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 1 screenshot for commit `e2c4d7a` (2025-12-05 01:33:45.849 UTC).\n\n**Dashboard page during loading - frontend server running but requires full backend stack for functionality**\n\n![dashboard-loading.png](https://famous-camel-162.convex.cloud/api/storage/7ead80a0-d048-4b8c-9b7c-e77cb6bfaec1)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"41b730b2c19e113a3384edf5519c81fb21fa2840","createdAt":"2025-12-05T01:33:46Z","updatedAt":"2025-12-05T01:33:46Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1181#issuecomment-3614957007"},{"type":"issue_comment","id":3614970329,"prNumber":1181,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn793xf2bsv9vjwzadaz8pse2n7wq0jv?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn793xf2bsv9vjwzadaz8pse2n7wq0jv/run/kd7fn76e6vyr8c644rr5r5bhk57wqrsf/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1181?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"41b730b2c19e113a3384edf5519c81fb21fa2840","createdAt":"2025-12-05T01:41:56Z","updatedAt":"2025-12-05T01:41:56Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1181#issuecomment-3614970329"}]}
{"number":1180,"title":"replace vnc deslop","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1180","headRef":"replace-vnc-deslop-0","headSha":"36e9c697c1e08649c9fcf2e93543220dfb83475a","baseRef":"main","baseSha":"d65b4f44f1fd7fbf1c4c8a314455113589467fd9","createdAt":"2025-12-05T01:08:31Z","updatedAt":"2025-12-05T01:31:09Z","diff":"diff --git a/apps/client/src/components/lexical/LexicalEditor.tsx b/apps/client/src/components/lexical/LexicalEditor.tsx\nindex 8f4dc958f..aa4dd34d1 100644\n--- a/apps/client/src/components/lexical/LexicalEditor.tsx\n+++ b/apps/client/src/components/lexical/LexicalEditor.tsx\n@@ -1,4 +1,3 @@\n-// IMPORTANT: Import prism-setup BEFORE @lexical/code to ensure Prism is globally available\n import \"./prism-setup\";\n \n import { editorStorage } from \"@/lib/editorStorage\";\n@@ -169,7 +168,10 @@ function KeyboardCommandPlugin({ onSubmit }: { onSubmit?: () => void }) {\n           return false;\n         }\n \n-        if (typeof navigator === \"undefined\" || !navigator.clipboard?.readText) {\n+        if (\n+          typeof navigator === \"undefined\" ||\n+          !navigator.clipboard?.readText\n+        ) {\n           return false;\n         }\n \ndiff --git a/apps/client/src/components/lexical/prism-setup.ts b/apps/client/src/components/lexical/prism-setup.ts\nindex c40c5b54d..037217a21 100644\n--- a/apps/client/src/components/lexical/prism-setup.ts\n+++ b/apps/client/src/components/lexical/prism-setup.ts\n@@ -1,8 +1,5 @@\n-// This file must be imported BEFORE any @lexical/code imports\n-// to ensure Prism is available globally for syntax highlighting\n import Prism from \"prismjs\";\n \n-// @lexical/code expects Prism to be available globally\n if (typeof globalThis !== \"undefined\") {\n   (globalThis as typeof globalThis & { Prism?: typeof Prism }).Prism = Prism;\n }\ndiff --git a/apps/client/src/lib/drag-pointer-events.ts b/apps/client/src/lib/drag-pointer-events.ts\nindex 14c055b5d..ffa855b58 100644\n--- a/apps/client/src/lib/drag-pointer-events.ts\n+++ b/apps/client/src/lib/drag-pointer-events.ts\n@@ -1,15 +1,6 @@\n-/**\n- * Utility for disabling pointer events on marked elements during drag operations.\n- * Elements should be marked with `data-drag-disable-pointer` attribute.\n- * Also targets canvas/iframe children since pointer-events doesn't propagate to children.\n- */\n+const SELECTOR =\n+  \"[data-drag-disable-pointer], [data-drag-disable-pointer] canvas, [data-drag-disable-pointer] iframe\";\n \n-const SELECTOR = \"[data-drag-disable-pointer], [data-drag-disable-pointer] canvas, [data-drag-disable-pointer] iframe\";\n-\n-/**\n- * Disable pointer events on all marked elements.\n- * Call this when starting a drag operation.\n- */\n export function disableDragPointerEvents(): void {\n   const elements = Array.from(document.querySelectorAll(SELECTOR));\n   for (const el of elements) {\n@@ -21,10 +12,6 @@ export function disableDragPointerEvents(): void {\n   }\n }\n \n-/**\n- * Restore pointer events on all marked elements.\n- * Call this when ending a drag operation.\n- */\n export function restoreDragPointerEvents(): void {\n   const elements = Array.from(document.querySelectorAll(SELECTOR));\n   for (const el of elements) {\ndiff --git a/apps/www/components/preview/preview-configure-client.tsx b/apps/www/components/preview/preview-configure-client.tsx\nindex 9813b30b0..431838e04 100644\n--- a/apps/www/components/preview/preview-configure-client.tsx\n+++ b/apps/www/components/preview/preview-configure-client.tsx\n@@ -50,9 +50,9 @@ type EnvVar = { name: string; value: string; isSecret: boolean };\n \n // All configuration steps in order (shown in workspace config sidebar)\n const ALL_CONFIG_STEPS = [\n-  \"scripts\",      // maintenance + dev scripts\n-  \"env-vars\",     // environment variables\n-  \"run-scripts\",  // run scripts in terminal\n+  \"scripts\", // maintenance + dev scripts\n+  \"env-vars\", // environment variables\n+  \"run-scripts\", // run scripts in terminal\n   \"browser-setup\", // browser configuration\n ] as const;\n \n@@ -142,23 +142,15 @@ function deriveVncUrl(\n   return normalizeVncUrl(baseUrl);\n }\n \n-/**\n- * Convert a VNC iframe URL (https://hostname/vnc.html) to websocket URL (wss://hostname/websockify).\n- * This handles the case where the server returns a vnc.html URL that needs to be converted\n- * to a websockify endpoint for direct noVNC/RFB connection.\n- */\n function convertVncUrlToWebsocket(vncUrl: string): string | null {\n   try {\n     const url = new URL(vncUrl);\n-    // Already a websocket URL\n     if (url.protocol === \"ws:\" || url.protocol === \"wss:\") {\n-      // Ensure it points to /websockify\n       if (!url.pathname.includes(\"websockify\")) {\n         url.pathname = \"/websockify\";\n       }\n       return url.toString();\n     }\n-    // Convert http/https to ws/wss\n     const wsProtocol = url.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n     return `${wsProtocol}//${url.host}/websockify`;\n   } catch {\n@@ -166,10 +158,6 @@ function convertVncUrlToWebsocket(vncUrl: string): string | null {\n   }\n }\n \n-/**\n- * Derive the VNC websocket URL for direct noVNC/RFB connection.\n- * Returns a wss:// URL pointing to the /websockify endpoint.\n- */\n function deriveVncWebsocketUrl(\n   instanceId?: string,\n   workspaceUrl?: string\n@@ -429,7 +417,8 @@ export function PreviewConfigureClient({\n   startAtConfigureEnvironment = false,\n }: PreviewConfigureClientProps) {\n   const initialEnvPrefilled = useMemo(\n-    () => Boolean(initialEnvVarsContent && initialEnvVarsContent.trim().length > 0),\n+    () =>\n+      Boolean(initialEnvVarsContent && initialEnvVarsContent.trim().length > 0),\n     [initialEnvVarsContent]\n   );\n   const initialEnvVars = useMemo(() => {\n@@ -445,7 +434,9 @@ export function PreviewConfigureClient({\n   const initialHasEnvValues = useMemo(\n     () =>\n       initialEnvPrefilled ||\n-      initialEnvVars.some((r) => r.name.trim().length > 0 || r.value.trim().length > 0),\n+      initialEnvVars.some(\n+        (r) => r.name.trim().length > 0 || r.value.trim().length > 0\n+      ),\n     [initialEnvPrefilled, initialEnvVars]\n   );\n   const initialFrameworkConfig = getFrameworkPresetConfig(\n@@ -479,7 +470,8 @@ export function PreviewConfigureClient({\n     }\n   }, []);\n   // Current config step (starts at run-scripts when entering workspace config)\n-  const [currentConfigStep, setCurrentConfigStep] = useState<ConfigStep>(\"run-scripts\");\n+  const [currentConfigStep, setCurrentConfigStep] =\n+    useState<ConfigStep>(\"run-scripts\");\n   // Track which steps have been completed (scripts and env-vars are pre-completed from initial setup)\n   const [completedSteps, setCompletedSteps] = useState<Set<ConfigStep>>(\n     () => new Set([\"scripts\", \"env-vars\"] as ConfigStep[])\n@@ -578,7 +570,8 @@ export function PreviewConfigureClient({\n   }, [instance?.vncUrl, instance?.instanceId, instance?.vscodeUrl]);\n \n   // VNC connection status for the browser panel (may be used for UI indicators in the future)\n-  const [_vncStatus, setVncStatus] = useState<VncConnectionStatus>(\"disconnected\");\n+  const [_vncStatus, setVncStatus] =\n+    useState<VncConnectionStatus>(\"disconnected\");\n \n   const workspacePlaceholder = useMemo(\n     () =>\n@@ -588,10 +581,10 @@ export function PreviewConfigureClient({\n             title: instance?.instanceId\n               ? \"Waiting for VS Code\"\n               : \"VS Code workspace not ready\",\n-              description: instance?.instanceId\n-                ? \"The editor opens automatically once the environment finishes booting.\"\n-                : \"Provisioning the workspace. We'll open VS Code as soon as it's ready.\",\n-            },\n+            description: instance?.instanceId\n+              ? \"The editor opens automatically once the environment finishes booting.\"\n+              : \"Provisioning the workspace. We'll open VS Code as soon as it's ready.\",\n+          },\n     [instance?.instanceId, instance?.vscodeUrl]\n   );\n \n@@ -600,7 +593,9 @@ export function PreviewConfigureClient({\n   const hasEnvValues = useMemo(\n     () =>\n       (!hasTouchedEnvVars && initialEnvPrefilled) ||\n-      envVars.some((r) => r.name.trim().length > 0 || r.value.trim().length > 0),\n+      envVars.some(\n+        (r) => r.name.trim().length > 0 || r.value.trim().length > 0\n+      ),\n     [envVars, hasTouchedEnvVars, initialEnvPrefilled]\n   );\n   const envDone = envNone || hasEnvValues;\n@@ -790,7 +785,10 @@ export function PreviewConfigureClient({\n       setFrameworkPreset(preset);\n       // Only auto-fill if user hasn't manually edited the scripts\n       if (!hasUserEditedScripts) {\n-        const presetConfig = getFrameworkPresetConfig(preset, initialPackageManager);\n+        const presetConfig = getFrameworkPresetConfig(\n+          preset,\n+          initialPackageManager\n+        );\n         setMaintenanceScript(presetConfig.maintenanceScript);\n         setDevScript(presetConfig.devScript);\n       }\n@@ -830,7 +828,6 @@ export function PreviewConfigureClient({\n     }\n   }, [devScript, maintenanceScript]);\n \n-\n   const handleSaveConfiguration = async () => {\n     if (!resolvedTeamSlugOrId) {\n       setErrorMessage(\"Select a team before saving.\");\n@@ -957,19 +954,28 @@ export function PreviewConfigureClient({\n   }, [currentConfigStep]);\n \n   // Helper to check if a step is visible (completed or current)\n-  const isStepVisible = useCallback((step: ConfigStep) => {\n-    return completedSteps.has(step) || step === currentConfigStep;\n-  }, [completedSteps, currentConfigStep]);\n+  const isStepVisible = useCallback(\n+    (step: ConfigStep) => {\n+      return completedSteps.has(step) || step === currentConfigStep;\n+    },\n+    [completedSteps, currentConfigStep]\n+  );\n \n   // Helper to check if a step is the current one\n-  const isCurrentStep = useCallback((step: ConfigStep) => {\n-    return step === currentConfigStep;\n-  }, [currentConfigStep]);\n+  const isCurrentStep = useCallback(\n+    (step: ConfigStep) => {\n+      return step === currentConfigStep;\n+    },\n+    [currentConfigStep]\n+  );\n \n   // Helper to check if a step is completed (for collapsing)\n-  const isStepCompleted = useCallback((step: ConfigStep) => {\n-    return completedSteps.has(step);\n-  }, [completedSteps]);\n+  const isStepCompleted = useCallback(\n+    (step: ConfigStep) => {\n+      return completedSteps.has(step);\n+    },\n+    [completedSteps]\n+  );\n \n   // Navigate to a specific step (for going back to completed steps)\n   const handleGoToStep = useCallback((step: ConfigStep) => {\n@@ -997,11 +1003,7 @@ export function PreviewConfigureClient({\n         vscodeUrl.toString()\n       );\n     }\n-  }, [\n-    instance,\n-    persistentIframeManager,\n-    vscodePersistKey,\n-  ]);\n+  }, [instance, persistentIframeManager, vscodePersistKey]);\n \n   // Mount VS Code iframe to its target when visible\n   // Note: Browser VNC is now handled by VncViewer component, not iframe\n@@ -1047,7 +1049,8 @@ export function PreviewConfigureClient({\n     const inWorkspaceConfig = layoutPhase === \"workspace-config\";\n     // Show VSCode for steps before browser-setup\n     const showVscode = currentConfigStep !== \"browser-setup\";\n-    const workspaceVisible = inWorkspaceConfig && showVscode && Boolean(instance?.vscodeUrl);\n+    const workspaceVisible =\n+      inWorkspaceConfig && showVscode && Boolean(instance?.vscodeUrl);\n \n     persistentIframeManager.setVisibility(vscodePersistKey, workspaceVisible);\n   }, [\n@@ -1155,22 +1158,38 @@ export function PreviewConfigureClient({\n   };\n \n   // Shared render function for scripts section\n-  const renderScriptsSection = (options?: { compact?: boolean; defaultOpen?: boolean; showStepBadge?: boolean; stepNumber?: number; isDone?: boolean }) => {\n-    const { compact = false, defaultOpen = true, showStepBadge = false, stepNumber = 1, isDone = false } = options ?? {};\n+  const renderScriptsSection = (options?: {\n+    compact?: boolean;\n+    defaultOpen?: boolean;\n+    showStepBadge?: boolean;\n+    stepNumber?: number;\n+    isDone?: boolean;\n+  }) => {\n+    const {\n+      compact = false,\n+      defaultOpen = true,\n+      showStepBadge = false,\n+      stepNumber = 1,\n+      isDone = false,\n+    } = options ?? {};\n     const iconSize = compact ? \"h-3.5 w-3.5\" : \"h-4 w-4\";\n     const titleSize = compact ? \"text-[13px]\" : \"text-base\";\n     const contentPadding = compact ? \"mt-3 pl-5\" : \"mt-4 pl-6\";\n \n     return (\n-      <details\n-        className=\"group\"\n-        open={defaultOpen}\n-      >\n-        <summary className={clsx(\n-          \"flex items-center gap-2 cursor-pointer font-semibold text-neutral-900 dark:text-neutral-100 list-none\",\n-          titleSize\n-        )}>\n-          <ChevronDown className={clsx(iconSize, \"text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\")} />\n+      <details className=\"group\" open={defaultOpen}>\n+        <summary\n+          className={clsx(\n+            \"flex items-center gap-2 cursor-pointer font-semibold text-neutral-900 dark:text-neutral-100 list-none\",\n+            titleSize\n+          )}\n+        >\n+          <ChevronDown\n+            className={clsx(\n+              iconSize,\n+              \"text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\"\n+            )}\n+          />\n           {showStepBadge && <StepBadge step={stepNumber} done={isDone} />}\n           Maintenance and Dev Scripts\n         </summary>\n@@ -1211,8 +1230,20 @@ export function PreviewConfigureClient({\n   };\n \n   // Shared render function for environment variables section\n-  const renderEnvVarsSection = (options?: { compact?: boolean; defaultOpen?: boolean; showStepBadge?: boolean; stepNumber?: number; isDone?: boolean }) => {\n-    const { compact = false, defaultOpen = true, showStepBadge = false, stepNumber = 2, isDone = false } = options ?? {};\n+  const renderEnvVarsSection = (options?: {\n+    compact?: boolean;\n+    defaultOpen?: boolean;\n+    showStepBadge?: boolean;\n+    stepNumber?: number;\n+    isDone?: boolean;\n+  }) => {\n+    const {\n+      compact = false,\n+      defaultOpen = true,\n+      showStepBadge = false,\n+      stepNumber = 2,\n+      isDone = false,\n+    } = options ?? {};\n     const iconSize = compact ? \"h-3.5 w-3.5\" : \"h-4 w-4\";\n     const titleSize = compact ? \"text-[13px]\" : \"text-base\";\n     const contentPadding = compact ? \"mt-3 pl-5\" : \"mt-4 pl-6\";\n@@ -1223,11 +1254,18 @@ export function PreviewConfigureClient({\n         open={defaultOpen}\n         onToggle={(e) => setIsEnvSectionOpen(e.currentTarget.open)}\n       >\n-        <summary className={clsx(\n-          \"flex items-center gap-2 cursor-pointer font-semibold text-neutral-900 dark:text-neutral-100 list-none\",\n-          titleSize\n-        )}>\n-          <ChevronDown className={clsx(iconSize, \"text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\")} />\n+        <summary\n+          className={clsx(\n+            \"flex items-center gap-2 cursor-pointer font-semibold text-neutral-900 dark:text-neutral-100 list-none\",\n+            titleSize\n+          )}\n+        >\n+          <ChevronDown\n+            className={clsx(\n+              iconSize,\n+              \"text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\"\n+            )}\n+          />\n           {showStepBadge && <StepBadge step={stepNumber} done={isDone} />}\n           <span>Environment Variables</span>\n           <div className=\"ml-auto flex items-center gap-2\">\n@@ -1241,7 +1279,11 @@ export function PreviewConfigureClient({\n               className=\"text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-300 transition p-0.5\"\n               aria-label={areEnvValuesHidden ? \"Reveal values\" : \"Hide values\"}\n             >\n-              {areEnvValuesHidden ? <EyeOff className={iconSize} /> : <Eye className={iconSize} />}\n+              {areEnvValuesHidden ? (\n+                <EyeOff className={iconSize} />\n+              ) : (\n+                <Eye className={iconSize} />\n+              )}\n             </button>\n           </div>\n         </summary>\n@@ -1257,14 +1299,23 @@ export function PreviewConfigureClient({\n                 updateEnvVars((prev) => {\n                   const map = new Map(\n                     prev\n-                      .filter((r) => r.name.trim().length > 0 || r.value.trim().length > 0)\n+                      .filter(\n+                        (r) =>\n+                          r.name.trim().length > 0 || r.value.trim().length > 0\n+                      )\n                       .map((r) => [r.name, r] as const)\n                   );\n                   for (const it of items) {\n                     if (!it.name) continue;\n                     const existing = map.get(it.name);\n-                    if (existing) map.set(it.name, { ...existing, value: it.value });\n-                    else map.set(it.name, { name: it.name, value: it.value, isSecret: true });\n+                    if (existing)\n+                      map.set(it.name, { ...existing, value: it.value });\n+                    else\n+                      map.set(it.name, {\n+                        name: it.name,\n+                        value: it.value,\n+                        isSecret: true,\n+                      });\n                   }\n                   const next = Array.from(map.values());\n                   next.push({ name: \"\", value: \"\", isSecret: true });\n@@ -1277,7 +1328,9 @@ export function PreviewConfigureClient({\n         >\n           <div\n             className=\"grid gap-2 text-xs text-neutral-500 items-center mb-1\"\n-            style={{ gridTemplateColumns: \"minmax(0, 1fr) minmax(0, 1.5fr) 40px\" }}\n+            style={{\n+              gridTemplateColumns: \"minmax(0, 1fr) minmax(0, 1.5fr) 40px\",\n+            }}\n           >\n             <span>Name</span>\n             <span>Value</span>\n@@ -1285,23 +1338,31 @@ export function PreviewConfigureClient({\n           </div>\n           {envVars.map((row, idx) => {\n             const isEditingValue = activeEnvValueIndex === idx;\n-            const shouldMaskValue = areEnvValuesHidden && row.value.trim().length > 0 && !isEditingValue;\n+            const shouldMaskValue =\n+              areEnvValuesHidden &&\n+              row.value.trim().length > 0 &&\n+              !isEditingValue;\n             return (\n               <div\n                 key={idx}\n                 className=\"grid gap-2 items-center min-h-9\"\n-                style={{ gridTemplateColumns: \"minmax(0, 1fr) minmax(0, 1.5fr) 40px\" }}\n+                style={{\n+                  gridTemplateColumns: \"minmax(0, 1fr) minmax(0, 1.5fr) 40px\",\n+                }}\n               >\n                 <input\n                   type=\"text\"\n                   value={row.name}\n                   disabled={envNone}\n-                  ref={(el) => { keyInputRefs.current[idx] = el; }}\n+                  ref={(el) => {\n+                    keyInputRefs.current[idx] = el;\n+                  }}\n                   onChange={(e) => {\n                     setEnvNone(false);\n                     updateEnvVars((prev) => {\n                       const next = [...prev];\n-                      if (next[idx]) next[idx] = { ...next[idx], name: e.target.value };\n+                      if (next[idx])\n+                        next[idx] = { ...next[idx], name: e.target.value };\n                       return next;\n                     });\n                   }}\n@@ -1312,16 +1373,28 @@ export function PreviewConfigureClient({\n                   type={shouldMaskValue ? \"password\" : \"text\"}\n                   value={shouldMaskValue ? MASKED_ENV_VALUE : row.value}\n                   disabled={envNone}\n-                  onChange={shouldMaskValue ? undefined : (e) => {\n-                    setEnvNone(false);\n-                    updateEnvVars((prev) => {\n-                      const next = [...prev];\n-                      if (next[idx]) next[idx] = { ...next[idx], value: e.target.value };\n-                      return next;\n-                    });\n-                  }}\n+                  onChange={\n+                    shouldMaskValue\n+                      ? undefined\n+                      : (e) => {\n+                          setEnvNone(false);\n+                          updateEnvVars((prev) => {\n+                            const next = [...prev];\n+                            if (next[idx])\n+                              next[idx] = {\n+                                ...next[idx],\n+                                value: e.target.value,\n+                              };\n+                            return next;\n+                          });\n+                        }\n+                  }\n                   onFocus={() => setActiveEnvValueIndex(idx)}\n-                  onBlur={() => setActiveEnvValueIndex((current) => current === idx ? null : current)}\n+                  onBlur={() =>\n+                    setActiveEnvValueIndex((current) =>\n+                      current === idx ? null : current\n+                    )\n+                  }\n                   readOnly={shouldMaskValue}\n                   placeholder=\"I9JU23NF394R6HH\"\n                   className=\"w-full min-w-0 h-9 rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-3 text-sm font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 disabled:opacity-60 disabled:cursor-not-allowed\"\n@@ -1329,10 +1402,14 @@ export function PreviewConfigureClient({\n                 <button\n                   type=\"button\"\n                   disabled={envNone || envVars.length <= 1}\n-                  onClick={() => updateEnvVars((prev) => {\n-                    const next = prev.filter((_, i) => i !== idx);\n-                    return next.length > 0 ? next : [{ name: \"\", value: \"\", isSecret: true }];\n-                  })}\n+                  onClick={() =>\n+                    updateEnvVars((prev) => {\n+                      const next = prev.filter((_, i) => i !== idx);\n+                      return next.length > 0\n+                        ? next\n+                        : [{ name: \"\", value: \"\", isSecret: true }];\n+                    })\n+                  }\n                   className={clsx(\n                     \"h-9 w-9 rounded-md border border-neutral-200 dark:border-neutral-800 text-neutral-500 dark:text-neutral-400 grid place-items-center\",\n                     envNone || envVars.length <= 1\n@@ -1349,7 +1426,12 @@ export function PreviewConfigureClient({\n           <div className=\"mt-1\">\n             <button\n               type=\"button\"\n-              onClick={() => updateEnvVars((prev) => [...prev, { name: \"\", value: \"\", isSecret: true }])}\n+              onClick={() =>\n+                updateEnvVars((prev) => [\n+                  ...prev,\n+                  { name: \"\", value: \"\", isSecret: true },\n+                ])\n+              }\n               disabled={envNone}\n               className=\"inline-flex items-center gap-2 h-9 rounded-md border border-neutral-200 dark:border-neutral-800 px-3 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-neutral-50 dark:hover:bg-neutral-900 transition disabled:opacity-60 disabled:cursor-not-allowed\"\n             >\n@@ -1357,7 +1439,12 @@ export function PreviewConfigureClient({\n             </button>\n           </div>\n         </div>\n-        <p className={clsx(\"text-xs text-neutral-400 mt-4\", compact ? \"pl-5\" : \"pl-6\")}>\n+        <p\n+          className={clsx(\n+            \"text-xs text-neutral-400 mt-4\",\n+            compact ? \"pl-5\" : \"pl-6\"\n+          )}\n+        >\n           Tip: Paste a .env file to auto-fill\n         </p>\n       </details>\n@@ -1390,24 +1477,33 @@ export function PreviewConfigureClient({\n         {/* Step 1: Scripts (completed from initial setup - collapsed) */}\n         {isStepVisible(\"scripts\") && (\n           <div>\n-            {renderScriptsSection({ compact: true, defaultOpen: !isStepCompleted(\"scripts\"), showStepBadge: true, stepNumber: 1, isDone: isStepCompleted(\"scripts\") })}\n+            {renderScriptsSection({\n+              compact: true,\n+              defaultOpen: !isStepCompleted(\"scripts\"),\n+              showStepBadge: true,\n+              stepNumber: 1,\n+              isDone: isStepCompleted(\"scripts\"),\n+            })}\n           </div>\n         )}\n \n         {/* Step 2: Environment Variables (completed from initial setup - collapsed) */}\n         {isStepVisible(\"env-vars\") && (\n           <div>\n-            {renderEnvVarsSection({ compact: true, defaultOpen: !isStepCompleted(\"env-vars\"), showStepBadge: true, stepNumber: 2, isDone: isStepCompleted(\"env-vars\") })}\n+            {renderEnvVarsSection({\n+              compact: true,\n+              defaultOpen: !isStepCompleted(\"env-vars\"),\n+              showStepBadge: true,\n+              stepNumber: 2,\n+              isDone: isStepCompleted(\"env-vars\"),\n+            })}\n           </div>\n         )}\n \n         {/* Step 3: Run Scripts */}\n         {isStepVisible(\"run-scripts\") && (\n           <div>\n-            <details\n-              className=\"group\"\n-              open={isCurrentStep(\"run-scripts\")}\n-            >\n+            <details className=\"group\" open={isCurrentStep(\"run-scripts\")}>\n               <summary\n                 className={clsx(\n                   \"flex items-center gap-2 list-none\",\n@@ -1415,14 +1511,23 @@ export function PreviewConfigureClient({\n                 )}\n                 onClick={(e) => {\n                   if (isSaving) return;\n-                  if (isStepCompleted(\"run-scripts\") && !isCurrentStep(\"run-scripts\")) {\n+                  if (\n+                    isStepCompleted(\"run-scripts\") &&\n+                    !isCurrentStep(\"run-scripts\")\n+                  ) {\n                     e.preventDefault();\n                     handleGoToStep(\"run-scripts\");\n                   }\n                 }}\n               >\n                 <ChevronDown className=\"h-3.5 w-3.5 text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\" />\n-                <StepBadge step={3} done={isStepCompleted(\"run-scripts\") && !isCurrentStep(\"run-scripts\")} />\n+                <StepBadge\n+                  step={3}\n+                  done={\n+                    isStepCompleted(\"run-scripts\") &&\n+                    !isCurrentStep(\"run-scripts\")\n+                  }\n+                />\n                 <span className=\"text-[13px] font-medium text-neutral-900 dark:text-neutral-100\">\n                   Run scripts in VS Code terminal\n                 </span>\n@@ -1455,15 +1560,23 @@ export function PreviewConfigureClient({\n                             : \"text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-300\"\n                         )}\n                       >\n-                        {commandsCopied ? <Check className=\"h-3 w-3\" /> : <Copy className=\"h-3 w-3\" />}\n+                        {commandsCopied ? (\n+                          <Check className=\"h-3 w-3\" />\n+                        ) : (\n+                          <Copy className=\"h-3 w-3\" />\n+                        )}\n                       </button>\n                     )}\n                   </div>\n                   <pre className=\"px-3 py-2 text-[11px] font-mono text-neutral-900 dark:text-neutral-100 overflow-x-auto whitespace-pre-wrap break-all select-all\">\n                     {maintenanceScript.trim() || devScript.trim() ? (\n-                      [maintenanceScript.trim(), devScript.trim()].filter(Boolean).join(\" && \")\n+                      [maintenanceScript.trim(), devScript.trim()]\n+                        .filter(Boolean)\n+                        .join(\" && \")\n                     ) : (\n-                      <span className=\"text-neutral-400 italic\">No scripts configured</span>\n+                      <span className=\"text-neutral-400 italic\">\n+                        No scripts configured\n+                      </span>\n                     )}\n                   </pre>\n                 </div>\n@@ -1489,10 +1602,7 @@ export function PreviewConfigureClient({\n         {/* Step 4: Browser Setup */}\n         {isStepVisible(\"browser-setup\") && (\n           <div>\n-            <details\n-              className=\"group\"\n-              open={isCurrentStep(\"browser-setup\")}\n-            >\n+            <details className=\"group\" open={isCurrentStep(\"browser-setup\")}>\n               <summary\n                 className={clsx(\n                   \"flex items-center gap-2 list-none\",\n@@ -1500,14 +1610,23 @@ export function PreviewConfigureClient({\n                 )}\n                 onClick={(e) => {\n                   if (isSaving) return;\n-                  if (isStepCompleted(\"browser-setup\") && !isCurrentStep(\"browser-setup\")) {\n+                  if (\n+                    isStepCompleted(\"browser-setup\") &&\n+                    !isCurrentStep(\"browser-setup\")\n+                  ) {\n                     e.preventDefault();\n                     handleGoToStep(\"browser-setup\");\n                   }\n                 }}\n               >\n                 <ChevronDown className=\"h-3.5 w-3.5 text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\" />\n-                <StepBadge step={4} done={isStepCompleted(\"browser-setup\") && !isCurrentStep(\"browser-setup\")} />\n+                <StepBadge\n+                  step={4}\n+                  done={\n+                    isStepCompleted(\"browser-setup\") &&\n+                    !isCurrentStep(\"browser-setup\")\n+                  }\n+                />\n                 <span className=\"text-[13px] font-medium text-neutral-900 dark:text-neutral-100\">\n                   Configure browser\n                 </span>\n@@ -1518,16 +1637,24 @@ export function PreviewConfigureClient({\n                 </p>\n                 <ul className=\"space-y-2 text-[11px] text-neutral-600 dark:text-neutral-400\">\n                   <li className=\"flex items-start gap-2\">\n-                    <span className=\"flex h-4 w-4 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-500 dark:text-neutral-400 flex-shrink-0 mt-0.5\">1</span>\n+                    <span className=\"flex h-4 w-4 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-500 dark:text-neutral-400 flex-shrink-0 mt-0.5\">\n+                      1\n+                    </span>\n                     <span>Sign in to any dashboards or SaaS tools</span>\n                   </li>\n                   <li className=\"flex items-start gap-2\">\n-                    <span className=\"flex h-4 w-4 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-500 dark:text-neutral-400 flex-shrink-0 mt-0.5\">2</span>\n+                    <span className=\"flex h-4 w-4 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-500 dark:text-neutral-400 flex-shrink-0 mt-0.5\">\n+                      2\n+                    </span>\n                     <span>Dismiss cookie banners, popups, or MFA prompts</span>\n                   </li>\n                   <li className=\"flex items-start gap-2\">\n-                    <span className=\"flex h-4 w-4 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-500 dark:text-neutral-400 flex-shrink-0 mt-0.5\">3</span>\n-                    <span>Navigate to your dev server URL (e.g., localhost:3000)</span>\n+                    <span className=\"flex h-4 w-4 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-500 dark:text-neutral-400 flex-shrink-0 mt-0.5\">\n+                      3\n+                    </span>\n+                    <span>\n+                      Navigate to your dev server URL (e.g., localhost:3000)\n+                    </span>\n                   </li>\n                 </ul>\n                 <p className=\"text-[11px] text-neutral-500 dark:text-neutral-400\">\n@@ -1580,7 +1707,11 @@ export function PreviewConfigureClient({\n             Configure workspace\n           </h1>\n           <div className=\"flex items-center gap-2 text-sm text-neutral-600 dark:text-neutral-400 pt-2\">\n-            <svg className=\"h-4 w-4 shrink-0\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n+            <svg\n+              className=\"h-4 w-4 shrink-0\"\n+              viewBox=\"0 0 24 24\"\n+              fill=\"currentColor\"\n+            >\n               <path d=\"M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z\" />\n             </svg>\n             <span className=\"font-sans\">{repo}</span>\n@@ -1593,7 +1724,9 @@ export function PreviewConfigureClient({\n         {/* Error Message */}\n         {errorMessage && (\n           <div className=\"rounded-md bg-red-50 dark:bg-red-950/20 border border-red-200 dark:border-red-900/50 p-3 mt-6\">\n-            <p className=\"text-sm text-red-600 dark:text-red-400\">{errorMessage}</p>\n+            <p className=\"text-sm text-red-600 dark:text-red-400\">\n+              {errorMessage}\n+            </p>\n           </div>\n         )}\n \n@@ -1638,7 +1771,11 @@ export function PreviewConfigureClient({\n           Configure workspace\n         </h1>\n         <div className=\"flex items-center gap-2 text-sm text-neutral-600 dark:text-neutral-400 pt-1\">\n-          <svg className=\"h-4 w-4 shrink-0\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n+          <svg\n+            className=\"h-4 w-4 shrink-0\"\n+            viewBox=\"0 0 24 24\"\n+            fill=\"currentColor\"\n+          >\n             <path d=\"M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z\" />\n           </svg>\n           <span className=\"font-sans text-xs\">{repo}</span>\n@@ -1657,7 +1794,9 @@ export function PreviewConfigureClient({\n \n         {errorMessage && (\n           <div className=\"rounded-md bg-red-50 dark:bg-red-950/20 border border-red-200 dark:border-red-900/50 p-3 mt-4\">\n-            <p className=\"text-sm text-red-600 dark:text-red-400\">{errorMessage}</p>\n+            <p className=\"text-sm text-red-600 dark:text-red-400\">\n+              {errorMessage}\n+            </p>\n           </div>\n         )}\n       </div>\n@@ -1711,7 +1850,11 @@ export function PreviewConfigureClient({\n               Configure workspace\n             </h1>\n             <div className=\"flex items-center gap-2 text-sm text-neutral-600 dark:text-neutral-400 pt-1\">\n-              <svg className=\"h-4 w-4 shrink-0\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n+              <svg\n+                className=\"h-4 w-4 shrink-0\"\n+                viewBox=\"0 0 24 24\"\n+                fill=\"currentColor\"\n+              >\n                 <path d=\"M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z\" />\n               </svg>\n               <span className=\"font-sans text-xs\">{repo}</span>\ndiff --git a/packages/shared/src/components/vnc-viewer.tsx b/packages/shared/src/components/vnc-viewer.tsx\nindex 974d2af8b..0e9b09ea1 100644\n--- a/packages/shared/src/components/vnc-viewer.tsx\n+++ b/packages/shared/src/components/vnc-viewer.tsx\n@@ -35,7 +35,11 @@ interface RFBInstance {\n   compressionLevel: number;\n   readonly capabilities: { power?: boolean };\n   disconnect(): void;\n-  sendCredentials(credentials: { username?: string; password?: string; target?: string }): void;\n+  sendCredentials(credentials: {\n+    username?: string;\n+    password?: string;\n+    target?: string;\n+  }): void;\n   sendKey(keysym: number, code: string | null, down?: boolean): void;\n   sendCtrlAltDel(): void;\n   focus(options?: FocusOptions): void;\n@@ -45,20 +49,24 @@ interface RFBInstance {\n   machineReboot(): void;\n   machineReset(): void;\n   addEventListener(type: string, listener: (event: CustomEvent) => void): void;\n-  removeEventListener(type: string, listener: (event: CustomEvent) => void): void;\n+  removeEventListener(\n+    type: string,\n+    listener: (event: CustomEvent) => void\n+  ): void;\n }\n \n interface RFBConstructor {\n-  new (target: HTMLElement, urlOrChannel: string | WebSocket, options?: RFBOptions): RFBInstance;\n+  new (\n+    target: HTMLElement,\n+    urlOrChannel: string | WebSocket,\n+    options?: RFBOptions\n+  ): RFBInstance;\n }\n \n-// Dynamically import RFB to avoid top-level await issues with noVNC\n let RFBClass: RFBConstructor | null = null;\n const loadRFB = async (): Promise<RFBConstructor> => {\n   if (RFBClass) return RFBClass;\n-  // noVNC 1.7.0-beta exports from core/rfb.js via package.json \"exports\"\n-  // Type assertion since we have inline type definitions and don't need external @types/novnc__novnc\n-  const module = await import(\"@novnc/novnc\") as { default: RFBConstructor };\n+  const module = (await import(\"@novnc/novnc\")) as { default: RFBConstructor };\n   RFBClass = module.default;\n   return RFBClass;\n };\n@@ -128,7 +136,10 @@ export interface VncViewerProps {\n   /** Called when desktop name is received */\n   onDesktopName?: (rfb: RFBInstance, name: string) => void;\n   /** Called when capabilities are received */\n-  onCapabilities?: (rfb: RFBInstance, capabilities: Record<string, boolean>) => void;\n+  onCapabilities?: (\n+    rfb: RFBInstance,\n+    capabilities: Record<string, boolean>\n+  ) => void;\n }\n \n export interface VncViewerHandle {\n@@ -201,8 +212,6 @@ export const VncViewer = forwardRef<VncViewerHandle, VncViewerProps>(\n     },\n     ref\n   ) {\n-    console.log(\"[VncViewer] Component rendering, url:\", url);\n-\n     const containerRef = useRef<HTMLDivElement>(null);\n     const rfbRef = useRef<RFBInstance | null>(null);\n     const reconnectTimerRef = useRef<ReturnType<typeof setTimeout> | null>(\n@@ -221,17 +230,14 @@ export const VncViewer = forwardRef<VncViewerHandle, VncViewerProps>(\n     const network = useNetwork();\n     const isOffline = !network.online;\n \n-    // Keep urlRef updated\n     useEffect(() => {\n       urlRef.current = url;\n     }, [url]);\n \n-    // Keep shouldReconnectRef updated\n     useEffect(() => {\n       shouldReconnectRef.current = autoReconnect;\n     }, [autoReconnect]);\n \n-    // Update status and notify\n     const updateStatus = useCallback(\n       (newStatus: VncConnectionStatus, error?: string) => {\n         setStatus(newStatus);\n@@ -240,15 +246,12 @@ export const VncViewer = forwardRef<VncViewerHandle, VncViewerProps>(\n         } else if (newStatus === \"connected\") {\n           setErrorMessage(null);\n           setReconnectAttempt(0);\n-        } else if (newStatus === \"connecting\") {\n-          // Keep error message during reconnect attempts for context\n         }\n         onStatusChange?.(newStatus);\n       },\n       [onStatusChange]\n     );\n \n-    // Clear reconnect timer\n     const clearReconnectTimer = useCallback(() => {\n       if (reconnectTimerRef.current) {\n         clearTimeout(reconnectTimerRef.current);\n@@ -256,59 +259,47 @@ export const VncViewer = forwardRef<VncViewerHandle, VncViewerProps>(\n       }\n     }, []);\n \n-    // Schedule reconnect with exponential backoff\n-    const scheduleReconnect = useCallback((error?: string) => {\n-      if (isUnmountedRef.current || !shouldReconnectRef.current) {\n-        return;\n-      }\n-\n-      // Check max attempts\n-      if (\n-        maxReconnectAttempts > 0 &&\n-        reconnectAttemptsRef.current >= maxReconnectAttempts\n-      ) {\n-        console.log(\n-          `[VncViewer] Max reconnect attempts (${maxReconnectAttempts}) reached`\n-        );\n-        updateStatus(\"error\", error ?? \"Max reconnect attempts reached\");\n-        return;\n-      }\n+    const scheduleReconnect = useCallback(\n+      (error?: string) => {\n+        if (isUnmountedRef.current || !shouldReconnectRef.current) {\n+          return;\n+        }\n \n-      clearReconnectTimer();\n+        if (\n+          maxReconnectAttempts > 0 &&\n+          reconnectAttemptsRef.current >= maxReconnectAttempts\n+        ) {\n+          updateStatus(\"error\", error ?? \"Max reconnect attempts reached\");\n+          return;\n+        }\n \n-      const delay = currentReconnectDelayRef.current;\n-      const nextAttempt = reconnectAttemptsRef.current + 1;\n-      console.log(\n-        `[VncViewer] Scheduling reconnect in ${delay}ms (attempt ${nextAttempt})`\n-      );\n+        clearReconnectTimer();\n \n-      reconnectTimerRef.current = setTimeout(() => {\n-        if (isUnmountedRef.current) return;\n-        reconnectAttemptsRef.current++;\n-        setReconnectAttempt(reconnectAttemptsRef.current);\n-        // Exponential backoff\n-        currentReconnectDelayRef.current = Math.min(\n-          currentReconnectDelayRef.current * 2,\n-          maxReconnectDelay\n-        );\n-        connectInternalRef.current?.();\n-      }, delay);\n-    }, [\n-      clearReconnectTimer,\n-      maxReconnectAttempts,\n-      maxReconnectDelay,\n-      updateStatus,\n-    ]);\n+        const delay = currentReconnectDelayRef.current;\n+        reconnectTimerRef.current = setTimeout(() => {\n+          if (isUnmountedRef.current) return;\n+          reconnectAttemptsRef.current++;\n+          setReconnectAttempt(reconnectAttemptsRef.current);\n+          currentReconnectDelayRef.current = Math.min(\n+            currentReconnectDelayRef.current * 2,\n+            maxReconnectDelay\n+          );\n+          connectInternalRef.current?.();\n+        }, delay);\n+      },\n+      [\n+        clearReconnectTimer,\n+        maxReconnectAttempts,\n+        maxReconnectDelay,\n+        updateStatus,\n+      ]\n+    );\n \n-    // Internal connect function\n     const connectInternal = useCallback(async () => {\n-      if (isUnmountedRef.current) return;\n-      if (!containerRef.current) {\n-        console.warn(\"[VncViewer] Container not available for connection\");\n+      if (isUnmountedRef.current || !containerRef.current) {\n         return;\n       }\n \n-      // Clean up existing connection\n       if (rfbRef.current) {\n         try {\n           rfbRef.current.disconnect();\n@@ -321,19 +312,15 @@ export const VncViewer = forwardRef<VncViewerHandle, VncViewerProps>(\n       updateStatus(\"connecting\");\n \n       try {\n-        // Dynamically load RFB class\n         const RFB = await loadRFB();\n         if (isUnmountedRef.current) return;\n \n         const wsUrl = urlRef.current;\n-        console.log(`[VncViewer] Connecting to ${wsUrl}`);\n-\n         const rfb = new RFB(containerRef.current, wsUrl, {\n           credentials: undefined,\n           wsProtocols: [\"binary\"],\n         });\n \n-        // Configure RFB options\n         rfb.scaleViewport = scaleViewport;\n         rfb.clipViewport = clipViewport;\n         rfb.dragViewport = dragViewport;\n@@ -343,11 +330,8 @@ export const VncViewer = forwardRef<VncViewerHandle, VncViewerProps>(\n         rfb.qualityLevel = qualityLevel;\n         rfb.compressionLevel = compressionLevel;\n \n-        // Event handlers\n         rfb.addEventListener(\"connect\", () => {\n           if (isUnmountedRef.current) return;\n-          console.log(\"[VncViewer] Connected\");\n-          // Reset reconnect state on successful connection\n           reconnectAttemptsRef.current = 0;\n           currentReconnectDelayRef.current = reconnectDelay;\n           updateStatus(\"connected\");\n@@ -358,14 +342,10 @@ export const VncViewer = forwardRef<VncViewerHandle, VncViewerProps>(\n           if (isUnmountedRef.current) return;\n           const detail = (e as CustomEvent<{ clean: boolean }>).detail;\n           const isClean = detail?.clean ?? false;\n-          console.log(\n-            `[VncViewer] Disconnected (clean: ${isClean})`\n-          );\n           rfbRef.current = null;\n           updateStatus(\"disconnected\");\n           onDisconnect?.(rfb, detail ?? { clean: false });\n \n-          // Auto-reconnect on non-clean disconnect\n           if (!isClean && shouldReconnectRef.current) {\n             scheduleReconnect(\"Connection lost unexpectedly\");\n           }\n@@ -373,7 +353,6 @@ export const VncViewer = forwardRef<VncViewerHandle, VncViewerProps>(\n \n         rfb.addEventListener(\"credentialsrequired\", () => {\n           if (isUnmountedRef.current) return;\n-          console.log(\"[VncViewer] Credentials required\");\n           onCredentialsRequired?.(rfb);\n         });\n \n@@ -409,7 +388,8 @@ export const VncViewer = forwardRef<VncViewerHandle, VncViewerProps>(\n         rfbRef.current = rfb;\n       } catch (error) {\n         console.error(\"[VncViewer] Failed to create RFB connection:\", error);\n-        const errorMsg = error instanceof Error ? error.message : \"Failed to connect\";\n+        const errorMsg =\n+          error instanceof Error ? error.message : \"Failed to connect\";\n         updateStatus(\"error\", errorMsg);\n         if (shouldReconnectRef.current) {\n           scheduleReconnect(errorMsg);\n@@ -436,12 +416,10 @@ export const VncViewer = forwardRef<VncViewerHandle, VncViewerProps>(\n       onCapabilities,\n     ]);\n \n-    // Keep connectInternalRef updated\n     useEffect(() => {\n       connectInternalRef.current = connectInternal;\n     }, [connectInternal]);\n \n-    // Public connect method\n     const connect = useCallback(() => {\n       clearReconnectTimer();\n       reconnectAttemptsRef.current = 0;\n@@ -449,11 +427,9 @@ export const VncViewer = forwardRef<VncViewerHandle, VncViewerProps>(\n       connectInternal();\n     }, [clearReconnectTimer, reconnectDelay, connectInternal]);\n \n-    // Auto-reconnect when network comes back online\n     const prevOnlineRef = useRef(network.online);\n     useEffect(() => {\n       if (network.online && !prevOnlineRef.current) {\n-        console.log(\"[VncViewer] Network back online, reconnecting...\");\n         if (status === \"error\" || status === \"disconnected\") {\n           connect();\n         }\n@@ -461,10 +437,9 @@ export const VncViewer = forwardRef<VncViewerHandle, VncViewerProps>(\n       prevOnlineRef.current = network.online;\n     }, [network.online, status, connect]);\n \n-    // Public disconnect method\n     const disconnect = useCallback(() => {\n       clearReconnectTimer();\n-      shouldReconnectRef.current = false; // Prevent auto-reconnect on explicit disconnect\n+      shouldReconnectRef.current = false;\n       if (rfbRef.current) {\n         try {\n           rfbRef.current.disconnect();\n@@ -476,18 +451,13 @@ export const VncViewer = forwardRef<VncViewerHandle, VncViewerProps>(\n       updateStatus(\"disconnected\");\n     }, [clearReconnectTimer, updateStatus]);\n \n-    // Clipboard paste handler - syncs clipboard then sends Ctrl+V\n-    // Uses proper DOM key codes for QEMU extended key events\n     const clipboardPaste = useCallback((text: string) => {\n       const rfb = rfbRef.current;\n       if (!rfb) return;\n \n       try {\n-        // Sync clipboard to VNC server\n         rfb.clipboardPasteFrom(text);\n-        console.log(\"[VncViewer] Clipboard synced, sending Ctrl+V...\");\n \n-        // X11 keysyms (same as noVNC's KeyTable)\n         const XK_Meta_L = 0xffe7;\n         const XK_Meta_R = 0xffe8;\n         const XK_Super_L = 0xffeb;\n@@ -495,56 +465,49 @@ export const VncViewer = forwardRef<VncViewerHandle, VncViewerProps>(\n         const XK_Control_L = 0xffe3;\n         const XK_v = 0x0076;\n \n-        // Small delay to ensure clipboard is processed by VNC server\n         setTimeout(() => {\n-          // Release Meta/Super keys that might be held from user's Cmd\n-          // (noVNC sent Meta down before we intercepted the V keydown)\n           rfb.sendKey(XK_Meta_L, \"MetaLeft\", false);\n           rfb.sendKey(XK_Meta_R, \"MetaRight\", false);\n           rfb.sendKey(XK_Super_L, \"OSLeft\", false);\n           rfb.sendKey(XK_Super_R, \"OSRight\", false);\n \n-          // Send Ctrl+V with proper DOM codes (like noVNC's sendCtrlAltDel)\n           rfb.sendKey(XK_Control_L, \"ControlLeft\", true);\n           rfb.sendKey(XK_v, \"KeyV\", true);\n           rfb.sendKey(XK_v, \"KeyV\", false);\n           rfb.sendKey(XK_Control_L, \"ControlLeft\", false);\n-          console.log(\"[VncViewer] Ctrl+V sent\");\n         }, 50);\n       } catch (e) {\n         console.error(\"[VncViewer] Error pasting to clipboard:\", e);\n       }\n     }, []);\n \n-    // Send a key combo to VNC, releasing Meta/Super first (for Mac Cmd → Linux Ctrl translation)\n-    const sendKeyCombo = useCallback((keysym: number, code: string, withShift = false) => {\n-      const rfb = rfbRef.current;\n-      if (!rfb) return;\n+    const sendKeyCombo = useCallback(\n+      (keysym: number, code: string, withShift = false) => {\n+        const rfb = rfbRef.current;\n+        if (!rfb) return;\n \n-      // X11 keysyms for modifiers\n-      const XK_Shift_L = 0xffe1;\n-      const XK_Meta_L = 0xffe7;\n-      const XK_Meta_R = 0xffe8;\n-      const XK_Super_L = 0xffeb;\n-      const XK_Super_R = 0xffec;\n-      const XK_Control_L = 0xffe3;\n-\n-      // Release Meta/Super keys that might be held from user's Cmd\n-      rfb.sendKey(XK_Meta_L, \"MetaLeft\", false);\n-      rfb.sendKey(XK_Meta_R, \"MetaRight\", false);\n-      rfb.sendKey(XK_Super_L, \"OSLeft\", false);\n-      rfb.sendKey(XK_Super_R, \"OSRight\", false);\n-\n-      // Send Ctrl+<key> (with optional Shift)\n-      rfb.sendKey(XK_Control_L, \"ControlLeft\", true);\n-      if (withShift) rfb.sendKey(XK_Shift_L, \"ShiftLeft\", true);\n-      rfb.sendKey(keysym, code, true);\n-      rfb.sendKey(keysym, code, false);\n-      if (withShift) rfb.sendKey(XK_Shift_L, \"ShiftLeft\", false);\n-      rfb.sendKey(XK_Control_L, \"ControlLeft\", false);\n-    }, []);\n+        const XK_Shift_L = 0xffe1;\n+        const XK_Meta_L = 0xffe7;\n+        const XK_Meta_R = 0xffe8;\n+        const XK_Super_L = 0xffeb;\n+        const XK_Super_R = 0xffec;\n+        const XK_Control_L = 0xffe3;\n+\n+        rfb.sendKey(XK_Meta_L, \"MetaLeft\", false);\n+        rfb.sendKey(XK_Meta_R, \"MetaRight\", false);\n+        rfb.sendKey(XK_Super_L, \"OSLeft\", false);\n+        rfb.sendKey(XK_Super_R, \"OSRight\", false);\n+\n+        rfb.sendKey(XK_Control_L, \"ControlLeft\", true);\n+        if (withShift) rfb.sendKey(XK_Shift_L, \"ShiftLeft\", true);\n+        rfb.sendKey(keysym, code, true);\n+        rfb.sendKey(keysym, code, false);\n+        if (withShift) rfb.sendKey(XK_Shift_L, \"ShiftLeft\", false);\n+        rfb.sendKey(XK_Control_L, \"ControlLeft\", false);\n+      },\n+      []\n+    );\n \n-    // Check if VNC viewer is focused (container or any child including canvas)\n     const isVncFocused = useCallback(() => {\n       const container = containerRef.current;\n       if (!container) return false;\n@@ -552,90 +515,74 @@ export const VncViewer = forwardRef<VncViewerHandle, VncViewerProps>(\n       return container === active || container.contains(active);\n     }, []);\n \n-    // Send Ctrl+key combo (releasing Meta first for Mac)\n-    const sendCtrlKey = useCallback((keysym: number, code: string, releaseMeta = false) => {\n-      const rfb = rfbRef.current;\n-      if (!rfb) return;\n+    const sendCtrlKey = useCallback(\n+      (keysym: number, code: string, releaseMeta = false) => {\n+        const rfb = rfbRef.current;\n+        if (!rfb) return;\n \n-      const XK_Control_L = 0xffe3;\n-\n-      if (releaseMeta) {\n-        // Release Meta/Super keys that might be held from user's Option key\n-        rfb.sendKey(0xffe7, \"MetaLeft\", false);\n-        rfb.sendKey(0xffe8, \"MetaRight\", false);\n-        rfb.sendKey(0xffeb, \"OSLeft\", false);\n-        rfb.sendKey(0xffec, \"OSRight\", false);\n-        // Also release Alt since Option maps to Alt\n-        rfb.sendKey(0xffe9, \"AltLeft\", false);\n-        rfb.sendKey(0xffea, \"AltRight\", false);\n-      }\n+        const XK_Control_L = 0xffe3;\n \n-      rfb.sendKey(XK_Control_L, \"ControlLeft\", true);\n-      rfb.sendKey(keysym, code, true);\n-      rfb.sendKey(keysym, code, false);\n-      rfb.sendKey(XK_Control_L, \"ControlLeft\", false);\n-    }, []);\n+        if (releaseMeta) {\n+          rfb.sendKey(0xffe7, \"MetaLeft\", false);\n+          rfb.sendKey(0xffe8, \"MetaRight\", false);\n+          rfb.sendKey(0xffeb, \"OSLeft\", false);\n+          rfb.sendKey(0xffec, \"OSRight\", false);\n+          rfb.sendKey(0xffe9, \"AltLeft\", false);\n+          rfb.sendKey(0xffea, \"AltRight\", false);\n+        }\n+\n+        rfb.sendKey(XK_Control_L, \"ControlLeft\", true);\n+        rfb.sendKey(keysym, code, true);\n+        rfb.sendKey(keysym, code, false);\n+        rfb.sendKey(XK_Control_L, \"ControlLeft\", false);\n+      },\n+      []\n+    );\n \n-    // Intercept Mac shortcuts and translate to Linux equivalents\n-    // Listen at document level to intercept before browser handles them\n     useEffect(() => {\n-      const isMac = /Mac|iPhone|iPad|iPod/i.test(navigator.platform || navigator.userAgent);\n-      if (!isMac) return; // Only needed on Mac\n+      const isMac = /Mac|iPhone|iPad|iPod/i.test(\n+        navigator.platform || navigator.userAgent\n+      );\n+      if (!isMac) return;\n \n       const handleKeyDown = async (e: KeyboardEvent) => {\n-        // Only handle if VNC is focused\n         if (!isVncFocused()) return;\n-\n-        // Don't send keyboard events in view-only mode\n         if (viewOnly) return;\n \n         const rfb = rfbRef.current;\n-        const code = e.code; // Use e.code for reliable key identification\n+        const code = e.code;\n \n-        // Helper to handle a shortcut: preventDefault first, then send to VNC\n-        const handleShortcut = (\n-          logMsg: string,\n-          action: () => void\n-        ) => {\n+        const handleShortcut = (_logMsg: string, action: () => void) => {\n           e.preventDefault();\n           e.stopPropagation();\n-          if (!rfb) {\n-            console.log(`[VncViewer] ${logMsg} - but VNC not connected`);\n-            return;\n-          }\n-          console.log(`[VncViewer] ${logMsg}`);\n+          if (!rfb) return;\n           action();\n         };\n \n-        // === Cmd+Shift+<key> combinations ===\n         if (e.metaKey && e.shiftKey && !e.altKey && !e.ctrlKey) {\n-          // Cmd+Shift+[ → Ctrl+PageUp (previous tab in Linux)\n           if (code === \"BracketLeft\") {\n-            handleShortcut(\"Cmd+Shift+[ → Ctrl+PageUp (prev tab)\", () => {\n-              sendKeyCombo(0xff55, \"PageUp\"); // XK_Page_Up, no shift needed\n+            handleShortcut(\"Cmd+Shift+[ → Ctrl+PageUp\", () => {\n+              sendKeyCombo(0xff55, \"PageUp\");\n             });\n             return;\n           }\n-          // Cmd+Shift+] → Ctrl+PageDown (next tab in Linux)\n           if (code === \"BracketRight\") {\n-            handleShortcut(\"Cmd+Shift+] → Ctrl+PageDown (next tab)\", () => {\n-              sendKeyCombo(0xff56, \"PageDown\"); // XK_Page_Down, no shift needed\n+            handleShortcut(\"Cmd+Shift+] → Ctrl+PageDown\", () => {\n+              sendKeyCombo(0xff56, \"PageDown\");\n             });\n             return;\n           }\n-          // Cmd+Shift+Z → Ctrl+Shift+Z (redo)\n           if (code === \"KeyZ\") {\n             handleShortcut(\"Cmd+Shift+Z → Ctrl+Shift+Z\", () => {\n               sendKeyCombo(0x007a, \"KeyZ\", true);\n             });\n             return;\n           }\n-          // Other Cmd+Shift combinations\n           const cmdShiftMap: Record<string, [number, string]> = {\n-            KeyF: [0x0066, \"KeyF\"], // Find in files\n-            KeyS: [0x0073, \"KeyS\"], // Save as\n-            KeyP: [0x0070, \"KeyP\"], // Command palette\n-            KeyG: [0x0067, \"KeyG\"], // Find previous\n+            KeyF: [0x0066, \"KeyF\"],\n+            KeyS: [0x0073, \"KeyS\"],\n+            KeyP: [0x0070, \"KeyP\"],\n+            KeyG: [0x0067, \"KeyG\"],\n           };\n           if (cmdShiftMap[code]) {\n             const [keysym, keyCode] = cmdShiftMap[code];\n@@ -646,29 +593,32 @@ export const VncViewer = forwardRef<VncViewerHandle, VncViewerProps>(\n           }\n         }\n \n-        // === Cmd+<key> (no shift) ===\n         if (e.metaKey && !e.shiftKey && !e.altKey && !e.ctrlKey) {\n-          // Arrow keys: Cmd+Arrow → Home/End\n           if (code === \"ArrowLeft\") {\n-            handleShortcut(\"Cmd+Left → Home\", () => sendKeyCombo(0xff50, \"Home\"));\n+            handleShortcut(\"Cmd+Left → Home\", () =>\n+              sendKeyCombo(0xff50, \"Home\")\n+            );\n             return;\n           }\n           if (code === \"ArrowRight\") {\n-            handleShortcut(\"Cmd+Right → End\", () => sendKeyCombo(0xff57, \"End\"));\n+            handleShortcut(\"Cmd+Right → End\", () =>\n+              sendKeyCombo(0xff57, \"End\")\n+            );\n             return;\n           }\n           if (code === \"ArrowUp\") {\n-            handleShortcut(\"Cmd+Up → Ctrl+Home\", () => sendKeyCombo(0xff50, \"Home\"));\n+            handleShortcut(\"Cmd+Up → Ctrl+Home\", () =>\n+              sendKeyCombo(0xff50, \"Home\")\n+            );\n             return;\n           }\n           if (code === \"ArrowDown\") {\n-            handleShortcut(\"Cmd+Down → Ctrl+End\", () => sendKeyCombo(0xff57, \"End\"));\n+            handleShortcut(\"Cmd+Down → Ctrl+End\", () =>\n+              sendKeyCombo(0xff57, \"End\")\n+            );\n             return;\n           }\n \n-          // Cmd+Backspace → delete to beginning of line\n-          // Use Shift+Home (select to start) + Backspace (delete) instead of Ctrl+U\n-          // because Ctrl+U opens View Source in browsers\n           if (code === \"Backspace\") {\n             handleShortcut(\"Cmd+Backspace → Shift+Home, Backspace\", () => {\n               const rfb = rfbRef.current;\n@@ -682,33 +632,28 @@ export const VncViewer = forwardRef<VncViewerHandle, VncViewerProps>(\n               const XK_Super_L = 0xffeb;\n               const XK_Super_R = 0xffec;\n \n-              // Release Meta/Super keys first\n               rfb.sendKey(XK_Meta_L, \"MetaLeft\", false);\n               rfb.sendKey(XK_Meta_R, \"MetaRight\", false);\n               rfb.sendKey(XK_Super_L, \"OSLeft\", false);\n               rfb.sendKey(XK_Super_R, \"OSRight\", false);\n \n-              // Shift+Home to select from cursor to beginning of line\n               rfb.sendKey(XK_Shift_L, \"ShiftLeft\", true);\n               rfb.sendKey(XK_Home, \"Home\", true);\n               rfb.sendKey(XK_Home, \"Home\", false);\n               rfb.sendKey(XK_Shift_L, \"ShiftLeft\", false);\n \n-              // Backspace to delete the selection\n               rfb.sendKey(XK_BackSpace, \"Backspace\", true);\n               rfb.sendKey(XK_BackSpace, \"Backspace\", false);\n             });\n             return;\n           }\n \n-          // Cmd+V → Paste (special handling for clipboard)\n           if (code === \"KeyV\") {\n             e.preventDefault();\n             e.stopPropagation();\n             try {\n               const text = await navigator.clipboard.readText();\n               if (text && rfb) {\n-                console.log(\"[VncViewer] Cmd+V → paste\");\n                 clipboardPaste(text);\n               }\n             } catch (err) {\n@@ -717,129 +662,145 @@ export const VncViewer = forwardRef<VncViewerHandle, VncViewerProps>(\n             return;\n           }\n \n-          // Standard Cmd+<key> → Ctrl+<key> mappings\n           const cmdMap: Record<string, [number, string]> = {\n-            KeyA: [0x0061, \"KeyA\"], KeyB: [0x0062, \"KeyB\"], KeyC: [0x0063, \"KeyC\"],\n-            KeyD: [0x0064, \"KeyD\"], KeyF: [0x0066, \"KeyF\"], KeyG: [0x0067, \"KeyG\"],\n-            KeyH: [0x0068, \"KeyH\"], KeyI: [0x0069, \"KeyI\"], KeyK: [0x006b, \"KeyK\"],\n-            KeyL: [0x006c, \"KeyL\"], KeyN: [0x006e, \"KeyN\"], KeyO: [0x006f, \"KeyO\"],\n-            KeyP: [0x0070, \"KeyP\"], KeyR: [0x0072, \"KeyR\"], KeyS: [0x0073, \"KeyS\"],\n-            KeyT: [0x0074, \"KeyT\"], KeyU: [0x0075, \"KeyU\"], KeyW: [0x0077, \"KeyW\"],\n-            KeyX: [0x0078, \"KeyX\"], KeyY: [0x0079, \"KeyY\"], KeyZ: [0x007a, \"KeyZ\"],\n+            KeyA: [0x0061, \"KeyA\"],\n+            KeyB: [0x0062, \"KeyB\"],\n+            KeyC: [0x0063, \"KeyC\"],\n+            KeyD: [0x0064, \"KeyD\"],\n+            KeyF: [0x0066, \"KeyF\"],\n+            KeyG: [0x0067, \"KeyG\"],\n+            KeyH: [0x0068, \"KeyH\"],\n+            KeyI: [0x0069, \"KeyI\"],\n+            KeyK: [0x006b, \"KeyK\"],\n+            KeyL: [0x006c, \"KeyL\"],\n+            KeyN: [0x006e, \"KeyN\"],\n+            KeyO: [0x006f, \"KeyO\"],\n+            KeyP: [0x0070, \"KeyP\"],\n+            KeyR: [0x0072, \"KeyR\"],\n+            KeyS: [0x0073, \"KeyS\"],\n+            KeyT: [0x0074, \"KeyT\"],\n+            KeyU: [0x0075, \"KeyU\"],\n+            KeyW: [0x0077, \"KeyW\"],\n+            KeyX: [0x0078, \"KeyX\"],\n+            KeyY: [0x0079, \"KeyY\"],\n+            KeyZ: [0x007a, \"KeyZ\"],\n             Slash: [0x002f, \"Slash\"],\n             BracketLeft: [0x005b, \"BracketLeft\"],\n             BracketRight: [0x005d, \"BracketRight\"],\n-            Minus: [0x002d, \"Minus\"],         // Zoom out (Ctrl+-)\n-            Equal: [0x003d, \"Equal\"],         // Zoom in (Ctrl+=)\n-            Digit0: [0x0030, \"Digit0\"],       // Reset zoom / Tab 10 (Ctrl+0)\n-            Digit1: [0x0031, \"Digit1\"],       // Tab 1 (Ctrl+1)\n-            Digit2: [0x0032, \"Digit2\"],       // Tab 2 (Ctrl+2)\n-            Digit3: [0x0033, \"Digit3\"],       // Tab 3 (Ctrl+3)\n-            Digit4: [0x0034, \"Digit4\"],       // Tab 4 (Ctrl+4)\n-            Digit5: [0x0035, \"Digit5\"],       // Tab 5 (Ctrl+5)\n-            Digit6: [0x0036, \"Digit6\"],       // Tab 6 (Ctrl+6)\n-            Digit7: [0x0037, \"Digit7\"],       // Tab 7 (Ctrl+7)\n-            Digit8: [0x0038, \"Digit8\"],       // Tab 8 (Ctrl+8)\n-            Digit9: [0x0039, \"Digit9\"],       // Tab 9 / Last tab (Ctrl+9)\n+            Minus: [0x002d, \"Minus\"],\n+            Equal: [0x003d, \"Equal\"],\n+            Digit0: [0x0030, \"Digit0\"],\n+            Digit1: [0x0031, \"Digit1\"],\n+            Digit2: [0x0032, \"Digit2\"],\n+            Digit3: [0x0033, \"Digit3\"],\n+            Digit4: [0x0034, \"Digit4\"],\n+            Digit5: [0x0035, \"Digit5\"],\n+            Digit6: [0x0036, \"Digit6\"],\n+            Digit7: [0x0037, \"Digit7\"],\n+            Digit8: [0x0038, \"Digit8\"],\n+            Digit9: [0x0039, \"Digit9\"],\n           };\n           if (cmdMap[code]) {\n             const [keysym, keyCode] = cmdMap[code];\n-            handleShortcut(`Cmd+${code} → Ctrl+${code}`, () => sendKeyCombo(keysym, keyCode));\n+            handleShortcut(`Cmd+${code} → Ctrl+${code}`, () =>\n+              sendKeyCombo(keysym, keyCode)\n+            );\n             return;\n           }\n         }\n \n-        // === Option+<key> (word navigation) ===\n         if (e.altKey && !e.metaKey && !e.ctrlKey && !e.shiftKey) {\n           if (code === \"ArrowLeft\") {\n-            handleShortcut(\"Option+Left → Ctrl+Left\", () => sendCtrlKey(0xff51, \"ArrowLeft\", true));\n+            handleShortcut(\"Option+Left → Ctrl+Left\", () =>\n+              sendCtrlKey(0xff51, \"ArrowLeft\", true)\n+            );\n             return;\n           }\n           if (code === \"ArrowRight\") {\n-            handleShortcut(\"Option+Right → Ctrl+Right\", () => sendCtrlKey(0xff53, \"ArrowRight\", true));\n+            handleShortcut(\"Option+Right → Ctrl+Right\", () =>\n+              sendCtrlKey(0xff53, \"ArrowRight\", true)\n+            );\n             return;\n           }\n           if (code === \"Backspace\") {\n-            // Ctrl+Backspace = delete word backwards (works in terminals, VS Code, browsers)\n-            // Note: Ctrl+W is the readline binding but it also closes tabs in GUIs\n-            handleShortcut(\"Option+Backspace → Ctrl+Backspace\", () => sendCtrlKey(0xff08, \"Backspace\", true));\n+            handleShortcut(\"Option+Backspace → Ctrl+Backspace\", () =>\n+              sendCtrlKey(0xff08, \"Backspace\", true)\n+            );\n             return;\n           }\n           if (code === \"Delete\") {\n-            // Option+Delete (Fn+Option+Backspace) → Ctrl+Delete = delete word forwards\n-            handleShortcut(\"Option+Delete → Ctrl+Delete\", () => sendCtrlKey(0xffff, \"Delete\", true));\n+            handleShortcut(\"Option+Delete → Ctrl+Delete\", () =>\n+              sendCtrlKey(0xffff, \"Delete\", true)\n+            );\n             return;\n           }\n         }\n \n-        // === Ctrl+<key> (GNU readline) ===\n         if (e.ctrlKey && !e.metaKey && !e.altKey && !e.shiftKey) {\n           const readlineMap: Record<string, [number, string]> = {\n-            KeyA: [0x0061, \"KeyA\"], // Beginning of line\n-            KeyE: [0x0065, \"KeyE\"], // End of line\n-            KeyK: [0x006b, \"KeyK\"], // Kill to end\n-            KeyU: [0x0075, \"KeyU\"], // Kill to beginning\n-            KeyW: [0x0077, \"KeyW\"], // Delete word\n-            KeyY: [0x0079, \"KeyY\"], // Yank\n-            KeyL: [0x006c, \"KeyL\"], // Clear screen\n-            KeyC: [0x0063, \"KeyC\"], // Interrupt\n-            KeyD: [0x0064, \"KeyD\"], // EOF\n+            KeyA: [0x0061, \"KeyA\"],\n+            KeyE: [0x0065, \"KeyE\"],\n+            KeyK: [0x006b, \"KeyK\"],\n+            KeyU: [0x0075, \"KeyU\"],\n+            KeyW: [0x0077, \"KeyW\"],\n+            KeyY: [0x0079, \"KeyY\"],\n+            KeyL: [0x006c, \"KeyL\"],\n+            KeyC: [0x0063, \"KeyC\"],\n+            KeyD: [0x0064, \"KeyD\"],\n           };\n           if (readlineMap[code]) {\n             const [keysym, keyCode] = readlineMap[code];\n-            handleShortcut(`Ctrl+${code} → Ctrl+${code}`, () => sendCtrlKey(keysym, keyCode, false));\n+            handleShortcut(`Ctrl+${code} → Ctrl+${code}`, () =>\n+              sendCtrlKey(keysym, keyCode, false)\n+            );\n             return;\n           }\n         }\n       };\n \n-      // Listen at document level with capture to intercept before browser default handlers\n       document.addEventListener(\"keydown\", handleKeyDown, { capture: true });\n       return () => {\n-        document.removeEventListener(\"keydown\", handleKeyDown, { capture: true });\n+        document.removeEventListener(\"keydown\", handleKeyDown, {\n+          capture: true,\n+        });\n       };\n     }, [clipboardPaste, sendKeyCombo, sendCtrlKey, isVncFocused, viewOnly]);\n \n-    // Fallback: Document-level paste event listener\n-    // Handles cases where keydown might not fire (e.g., Electron menu triggers paste)\n     useEffect(() => {\n       const container = containerRef.current;\n       if (!container) return;\n \n       const handleDocumentPaste = (e: ClipboardEvent) => {\n-        // Only handle if VNC container has focus\n         if (!container.contains(document.activeElement)) return;\n         if (!rfbRef.current) return;\n-        // Don't paste in view-only mode\n         if (viewOnly) return;\n \n         const text =\n           e.clipboardData?.getData(\"text/plain\") ||\n           e.clipboardData?.getData(\"text\");\n         if (text) {\n-          console.log(\"[VncViewer] Document paste event intercepted\");\n           e.preventDefault();\n           e.stopPropagation();\n           clipboardPaste(text);\n         }\n       };\n \n-      // Capture phase to intercept before other handlers\n-      document.addEventListener(\"paste\", handleDocumentPaste, { capture: true });\n-      return () => document.removeEventListener(\"paste\", handleDocumentPaste, { capture: true });\n+      document.addEventListener(\"paste\", handleDocumentPaste, {\n+        capture: true,\n+      });\n+      return () =>\n+        document.removeEventListener(\"paste\", handleDocumentPaste, {\n+          capture: true,\n+        });\n     }, [clipboardPaste, viewOnly]);\n \n-    // Focus the canvas\n     const focus = useCallback(() => {\n       rfbRef.current?.focus();\n     }, []);\n \n-    // Blur the canvas\n     const blur = useCallback(() => {\n       rfbRef.current?.blur();\n     }, []);\n-\n-    // Expose imperative handle\n     useImperativeHandle(\n       ref,\n       () => ({\n@@ -861,12 +822,10 @@ export const VncViewer = forwardRef<VncViewerHandle, VncViewerProps>(\n       [connect, disconnect, status, clipboardPaste, focus, blur]\n     );\n \n-    // Auto-connect on mount\n     useEffect(() => {\n       isUnmountedRef.current = false;\n \n       if (autoConnect) {\n-        // Small delay to ensure DOM is ready\n         const timer = setTimeout(() => {\n           if (!isUnmountedRef.current) {\n             connect();\n@@ -877,7 +836,6 @@ export const VncViewer = forwardRef<VncViewerHandle, VncViewerProps>(\n       return undefined;\n     }, [autoConnect, connect]);\n \n-    // Cleanup on unmount\n     useEffect(() => {\n       return () => {\n         isUnmountedRef.current = true;\n@@ -893,29 +851,23 @@ export const VncViewer = forwardRef<VncViewerHandle, VncViewerProps>(\n       };\n     }, [clearReconnectTimer]);\n \n-    // Reconnect when URL changes\n     useEffect(() => {\n       if (status === \"connected\" || status === \"connecting\") {\n-        // URL changed, reconnect\n-        console.log(\"[VncViewer] URL changed, reconnecting...\");\n         connect();\n       }\n       // eslint-disable-next-line react-hooks/exhaustive-deps\n     }, [url]);\n \n-\n-    // Handle container click for focus\n     const handleContainerClick = useCallback(() => {\n       if (focusOnClick && rfbRef.current) {\n         focus();\n       }\n     }, [focusOnClick, focus]);\n \n-    // Compute what to render\n-    const showLoading = (status === \"connecting\" || status === \"disconnected\") && !isOffline;\n+    const showLoading =\n+      (status === \"connecting\" || status === \"disconnected\") && !isOffline;\n     const showError = status === \"error\" || isOffline;\n \n-    // Default loading fallback\n     const defaultLoadingFallback = useMemo(\n       () => (\n         <div className=\"absolute inset-0 flex items-center justify-center\">\n@@ -939,13 +891,11 @@ export const VncViewer = forwardRef<VncViewerHandle, VncViewerProps>(\n       [status, reconnectAttempt, errorMessage]\n     );\n \n-    // Default error fallback\n     const defaultErrorFallback = useMemo(\n       () => (\n         <div className=\"absolute inset-0 flex items-center justify-center\">\n           <div className=\"flex flex-col items-center gap-3 text-center px-4\">\n             {isOffline ? (\n-              // Network offline state\n               <>\n                 <div className=\"flex h-10 w-10 items-center justify-center rounded-full bg-amber-500/10\">\n                   <svg\n@@ -967,12 +917,12 @@ export const VncViewer = forwardRef<VncViewerHandle, VncViewerProps>(\n                     Network offline\n                   </span>\n                   <span className=\"text-xs text-neutral-400 max-w-[280px]\">\n-                    Check your internet connection. Will reconnect automatically when online.\n+                    Check your internet connection. Will reconnect automatically\n+                    when online.\n                   </span>\n                 </div>\n               </>\n             ) : (\n-              // Server/connection error state\n               <>\n                 <div className=\"flex h-10 w-10 items-center justify-center rounded-full bg-red-500/10\">\n                   <svg\n@@ -1014,7 +964,6 @@ export const VncViewer = forwardRef<VncViewerHandle, VncViewerProps>(\n       [connect, errorMessage, isOffline]\n     );\n \n-    // Prevent Electron's context menu so noVNC can handle right-clicks\n     const handleContextMenu = useCallback((e: React.MouseEvent) => {\n       e.preventDefault();\n     }, []);\n@@ -1027,7 +976,6 @@ export const VncViewer = forwardRef<VncViewerHandle, VncViewerProps>(\n         onContextMenu={handleContextMenu}\n         data-drag-disable-pointer\n       >\n-        {/* VNC Canvas Container - noVNC creates canvas inside this */}\n         <div\n           ref={containerRef}\n           className=\"absolute inset-0\"\n@@ -1036,10 +984,8 @@ export const VncViewer = forwardRef<VncViewerHandle, VncViewerProps>(\n           data-drag-disable-pointer\n         />\n \n-        {/* Loading Overlay */}\n         {showLoading && (loadingFallback ?? defaultLoadingFallback)}\n \n-        {/* Error Overlay */}\n         {showError && (errorFallback ?? defaultErrorFallback)}\n       </div>\n     );\ndiff --git a/packages/shared/src/hooks/use-network.ts b/packages/shared/src/hooks/use-network.ts\nindex 0de3d8649..7ecb73d9c 100644\n--- a/packages/shared/src/hooks/use-network.ts\n+++ b/packages/shared/src/hooks/use-network.ts\n@@ -44,11 +44,9 @@ export function useNetwork(): NetworkStatus {\n       setStatus(getNetworkStatus());\n     };\n \n-    // Listen for online/offline events\n     window.addEventListener(\"online\", handleChange);\n     window.addEventListener(\"offline\", handleChange);\n \n-    // Listen for connection changes if available\n     const connection =\n       (navigator as Navigator & { connection?: NetworkInformation }).connection;\n     connection?.addEventListener?.(\"change\", handleChange);\n","comments":[{"type":"issue_comment","id":3614920707,"prNumber":1180,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn70hgsy989gny54mezvs6zph17wpj5a?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn70hgsy989gny54mezvs6zph17wpj5a/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1180?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"36e9c697c1e08649c9fcf2e93543220dfb83475a","createdAt":"2025-12-05T01:12:04Z","updatedAt":"2025-12-05T01:12:04Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1180#issuecomment-3614920707"},{"type":"issue_comment","id":3614921315,"prNumber":1180,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7drgfww3hwsnw52gesj5efdn7wp960?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7drgfww3hwsnw52gesj5efdn7wp960/run/kd77pt9hvkh2pb14nxg8fr1gt97wqjbk/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1180?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"36e9c697c1e08649c9fcf2e93543220dfb83475a","createdAt":"2025-12-05T01:12:24Z","updatedAt":"2025-12-05T01:31:09Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1180#issuecomment-3614921315"},{"type":"issue_comment","id":3614952558,"prNumber":1180,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn753v0v8vf5vfzk3qpq071ptx7wpcz1?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn753v0v8vf5vfzk3qpq071ptx7wpcz1/run/kd71axgxqnbx0qsxsf40en15j17wqkn7/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1180?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"36e9c697c1e08649c9fcf2e93543220dfb83475a","createdAt":"2025-12-05T01:31:08Z","updatedAt":"2025-12-05T01:31:08Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1180#issuecomment-3614952558"}]}
{"number":1179,"title":"Add SETUP_MODE env var for local vs cloud","state":"open","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1179","headRef":"cmux/add-setup-mode-env-var-for-local-vs-cloud-m3tq2","headSha":"a8a1101e23b22f6cfa20717f3bdf1849128ed5a1","baseRef":"main","baseSha":"f86f3065070fa5ba749e423f0a2392fd0df7334d","createdAt":"2025-12-05T00:31:05Z","updatedAt":"2025-12-05T01:26:14Z","diff":"diff --git a/apps/client/src/components/WorkspaceSetupPanel.tsx b/apps/client/src/components/WorkspaceSetupPanel.tsx\nindex 873c45642..268b97a5e 100644\n--- a/apps/client/src/components/WorkspaceSetupPanel.tsx\n+++ b/apps/client/src/components/WorkspaceSetupPanel.tsx\n@@ -315,6 +315,8 @@ export function WorkspaceSetupPanel({\n                     <p className=\"text-[11px] text-neutral-500 dark:text-neutral-400\">\n                       Runs after cloning your repository so dependencies and\n                       services are ready. Executed from your repository root directory.\n+                      The <code className=\"px-1 py-0.5 rounded bg-neutral-100 dark:bg-neutral-800 font-mono\">CMUX_SETUP_MODE</code> environment\n+                      variable is set to <code className=\"px-1 py-0.5 rounded bg-neutral-100 dark:bg-neutral-800 font-mono\">local</code> or <code className=\"px-1 py-0.5 rounded bg-neutral-100 dark:bg-neutral-800 font-mono\">cloud</code>.\n                     </p>\n                   </div>\n \ndiff --git a/apps/server/src/socket-handlers.ts b/apps/server/src/socket-handlers.ts\nindex 72ebf6f4a..8673eabc4 100644\n--- a/apps/server/src/socket-handlers.ts\n+++ b/apps/server/src/socket-handlers.ts\n@@ -990,6 +990,8 @@ export function setupSocketHandlers(\n                   env: {\n                     ...process.env,\n                     ...parsedEnvVars,\n+                    // CMUX_SETUP_MODE indicates whether the workspace is running in \"local\" or \"cloud\" mode\n+                    CMUX_SETUP_MODE: \"local\",\n                   },\n                   maxBuffer: 10 * 1024 * 1024,\n                 });\ndiff --git a/apps/www/lib/routes/sandboxes/startDevAndMaintenanceScript.ts b/apps/www/lib/routes/sandboxes/startDevAndMaintenanceScript.ts\nindex 998013775..91d3f4f94 100644\n--- a/apps/www/lib/routes/sandboxes/startDevAndMaintenanceScript.ts\n+++ b/apps/www/lib/routes/sandboxes/startDevAndMaintenanceScript.ts\n@@ -83,12 +83,18 @@ export async function runMaintenanceAndDevScripts({\n   const devExitCodePath = `${CMUX_RUNTIME_DIR}/dev_${runId}.exit-code`;\n   const devErrorLogPath = `${CMUX_RUNTIME_DIR}/dev_${runId}.log`;\n \n+  // Determine setup mode based on whether this is a cloud workspace\n+  const setupMode = isCloudWorkspace ? \"cloud\" : \"local\";\n+\n   // Create maintenance script if provided\n   const maintenanceScriptContent = hasMaintenanceScript\n     ? `#!/bin/zsh\n set -eux\n cd ${WORKSPACE_ROOT}\n \n+# CMUX_SETUP_MODE indicates whether the workspace is running in \"local\" or \"cloud\" mode\n+export CMUX_SETUP_MODE=\"${setupMode}\"\n+\n echo \"=== Maintenance Script Started at \\\\$(date) ===\"\n ${maintenanceScript}\n echo \"=== Maintenance Script Completed at \\\\$(date) ===\"\n","comments":[{"type":"issue_comment","id":3614863930,"prNumber":1179,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7ap218yene4mpr89jvsg0dyx7wqc6y?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7ap218yene4mpr89jvsg0dyx7wqc6y/run/kd7caj0mcj2rw5n1pmjqrj8ee17wpvwm/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1179?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 4 screenshots for commit `d84f4ea` (2025-12-05 00:38:22.942 UTC).\n\n**Before/After comparison showing the added documentation text for CMUX\\_SETUP\\_MODE environment variable in the Workspace Setup Panel. The new text explains that the environment variable is set to either 'local' or 'cloud'.**\n\n![before-after-comparison.png](https://adorable-wombat-701.convex.cloud/api/storage/ca0971f4-3781-48ab-9ff2-fa11b84bbbb6)\n\n**Dashboard view showing the initial state before a project is selected. The Workspace Setup Panel appears once a project is selected from the 'Select project' button.**\n\n![dashboard-without-project-selected.png](https://adorable-wombat-701.convex.cloud/api/storage/04a08b1a-c7a4-4e37-9f4c-35534e175e1e)\n\n**Project selector dialog that opens when clicking the 'Select project' button. After selecting a project, the Workspace Setup Panel becomes visible with the new documentation.**\n\n![project-selector-dialog.png](https://adorable-wombat-701.convex.cloud/api/storage/4af3f7d6-a6cd-4a4a-94bf-a1c16f4ba661)\n\n**Demo of the Workspace Setup Panel showing the new documentation text highlighted in yellow. The text appears in the Setup script section explaining the CMUX\\_SETUP\\_MODE environment variable.**\n\n![workspace-setup-panel-ui-change-demo.png](https://adorable-wombat-701.convex.cloud/api/storage/e908d254-02d5-4ea0-a969-3b6ab302ab1a)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"a8a1101e23b22f6cfa20717f3bdf1849128ed5a1","createdAt":"2025-12-05T00:38:25Z","updatedAt":"2025-12-05T00:38:25Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1179#issuecomment-3614863930"},{"type":"issue_comment","id":3614865489,"prNumber":1179,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn76tn4tjqck8mscqf6j2qkp9x7wpkb0?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn76tn4tjqck8mscqf6j2qkp9x7wpkb0/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1179?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"a8a1101e23b22f6cfa20717f3bdf1849128ed5a1","createdAt":"2025-12-05T00:39:22Z","updatedAt":"2025-12-05T01:26:14Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1179#issuecomment-3614865489"},{"type":"issue_comment","id":3614944701,"prNumber":1179,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn74y408bds4k474y9vnhvayc17wprp9?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn74y408bds4k474y9vnhvayc17wprp9/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1179?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 4 screenshots for commit `a8a1101` (2025-12-05 01:26:12.783 UTC).\n\n**Code diff view showing the exact changes made to WorkspaceSetupPanel.tsx - added documentation about CMUX\\_SETUP\\_MODE environment variable**\n\n![code-diff-view.png](https://famous-camel-162.convex.cloud/api/storage/07f71279-7d75-409d-acf2-ea2362df9ae3)\n\n**Full dashboard view showing the cmux interface**\n\n![dashboard-full-page.png](https://famous-camel-162.convex.cloud/api/storage/2cff57af-4a31-4269-adfd-e445eb098f26)\n\n**Project selector dialog where workspace setup configuration appears**\n\n![project-selector-dialog.png](https://famous-camel-162.convex.cloud/api/storage/f94da208-a9b1-46a9-acdb-7d6693cdc5bd)\n\n**Mockup showing the WorkspaceSetupPanel with the new CMUX\\_SETUP\\_MODE documentation text added in this PR**\n\n![workspace-setup-panel-ui-change.png](https://famous-camel-162.convex.cloud/api/storage/4d0346e0-fff1-4f83-947d-3ecc68244c49)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"a8a1101e23b22f6cfa20717f3bdf1849128ed5a1","createdAt":"2025-12-05T01:26:14Z","updatedAt":"2025-12-05T01:26:14Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1179#issuecomment-3614944701"}]}
{"number":1174,"title":"Make import non-blocking and load framework in background","state":"open","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1174","headRef":"cmux/make-import-non-blocking-and-load-framework-in-bac-l6kkt","headSha":"4d0be11219cab6ccf5e967c5b4b4b896ba24f02d","baseRef":"main","baseSha":"f86f3065070fa5ba749e423f0a2392fd0df7334d","createdAt":"2025-12-05T00:00:20Z","updatedAt":"2025-12-05T00:35:31Z","diff":"diff --git a/apps/www/app/(preview)/preview/configure/page.tsx b/apps/www/app/(preview)/preview/configure/page.tsx\nindex 6f2e934e7..7fd2b78f3 100644\n--- a/apps/www/app/(preview)/preview/configure/page.tsx\n+++ b/apps/www/app/(preview)/preview/configure/page.tsx\n@@ -11,7 +11,6 @@ import {\n   getTeamSlugOrId,\n   type StackTeam,\n } from \"@/lib/team-utils\";\n-import { detectFrameworkAndPackageManager } from \"@/lib/github/framework-detection\";\n import { env } from \"@/lib/utils/www-env\";\n import { typedZid } from \"@cmux/shared/utils/typed-zid\";\n \n@@ -137,26 +136,10 @@ export default async function PreviewConfigurePage({ searchParams }: PageProps)\n     name: team.name ?? getTeamDisplayName(team),\n   }));\n \n-  let githubAccessToken: string | undefined;\n-  try {\n-    const githubAccount = await user.getConnectedAccount(\"github\");\n-    if (githubAccount) {\n-      const tokenResult = await githubAccount.getAccessToken();\n-      if (tokenResult.accessToken) {\n-        githubAccessToken = tokenResult.accessToken;\n-      }\n-    }\n-  } catch (error) {\n-    console.error(\"Failed to fetch GitHub access token\", error);\n-  }\n-\n-  const detectionResult = await detectFrameworkAndPackageManager(repo, githubAccessToken);\n-\n   let initialEnvVarsContent: string | null = null;\n-  // Use detected scripts from package.json, can be overridden by environment\n-  // Keep empty string if no dev script found (don't convert to null which would trigger preset fallback)\n-  let initialMaintenanceScript: string | null = detectionResult.maintenanceScript;\n-  let initialDevScript: string | null = detectionResult.devScript;\n+  // Scripts are loaded from existing environment if available, otherwise loaded via client-side API call\n+  let initialMaintenanceScript: string | null = null;\n+  let initialDevScript: string | null = null;\n \n   if (environmentId) {\n     try {\n@@ -197,8 +180,6 @@ export default async function PreviewConfigurePage({ searchParams }: PageProps)\n       teams={clientTeams}\n       repo={repo}\n       installationId={installationId}\n-      initialFrameworkPreset={detectionResult.framework}\n-      initialPackageManager={detectionResult.packageManager}\n       initialEnvVarsContent={initialEnvVarsContent}\n       initialMaintenanceScript={initialMaintenanceScript}\n       initialDevScript={initialDevScript}\ndiff --git a/apps/www/components/preview/framework-preset-select.tsx b/apps/www/components/preview/framework-preset-select.tsx\nindex cfa3d2b3a..7567e0c4a 100644\n--- a/apps/www/components/preview/framework-preset-select.tsx\n+++ b/apps/www/components/preview/framework-preset-select.tsx\n@@ -1,7 +1,7 @@\n \"use client\";\n \n import * as SelectPrimitive from \"@radix-ui/react-select\";\n-import { ChevronDown, Check, Sparkles } from \"lucide-react\";\n+import { ChevronDown, Check, Sparkles, Loader2 } from \"lucide-react\";\n import { forwardRef, type ReactNode } from \"react\";\n import clsx from \"clsx\";\n import {\n@@ -204,20 +204,23 @@ function FrameworkIconBubble({ preset }: { preset: FrameworkPreset }) {\n type FrameworkPresetSelectProps = {\n   value: FrameworkPreset;\n   onValueChange: (value: FrameworkPreset) => void;\n+  loading?: boolean;\n };\n \n const SelectTrigger = forwardRef<\n   HTMLButtonElement,\n-  SelectPrimitive.SelectTriggerProps & { preset: FrameworkPreset }\n->(({ className, preset, ...props }, ref) => {\n+  SelectPrimitive.SelectTriggerProps & { preset: FrameworkPreset; disabled?: boolean }\n+>(({ className, preset, disabled, ...props }, ref) => {\n   const config = FRAMEWORK_PRESETS[preset];\n   return (\n     <SelectPrimitive.Trigger\n       ref={ref}\n+      disabled={disabled}\n       className={clsx(\n         \"flex w-full items-center justify-between rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-3 py-2.5 text-sm text-neutral-900 dark:text-neutral-100 font-sans\",\n         \"focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700\",\n         \"data-[placeholder]:text-neutral-400\",\n+        \"disabled:opacity-60 disabled:cursor-not-allowed\",\n         className\n       )}\n       {...props}\n@@ -299,6 +302,7 @@ SelectItem.displayName = \"SelectItem\";\n export function FrameworkPresetSelect({\n   value,\n   onValueChange,\n+  loading = false,\n }: FrameworkPresetSelectProps) {\n   const frameworkOptions = Object.keys(FRAMEWORK_PRESETS) as FrameworkPreset[];\n \n@@ -309,14 +313,22 @@ export function FrameworkPresetSelect({\n         className=\"block text-sm font-medium text-neutral-900 dark:text-neutral-100 mb-2\"\n       >\n         Framework Preset\n+        {loading && (\n+          <span className=\"ml-2 inline-flex items-center gap-1 text-xs font-normal text-neutral-500 dark:text-neutral-400\">\n+            <Loader2 className=\"h-3 w-3 animate-spin\" />\n+            Detecting...\n+          </span>\n+        )}\n       </label>\n       <SelectPrimitive.Root\n         value={value}\n         onValueChange={(val) => onValueChange(val as FrameworkPreset)}\n+        disabled={loading}\n       >\n         <SelectTrigger\n           preset={value}\n           aria-labelledby=\"framework-preset-label\"\n+          disabled={loading}\n         />\n         <SelectContent>\n           {frameworkOptions.map((preset) => (\ndiff --git a/apps/www/components/preview/preview-configure-client.tsx b/apps/www/components/preview/preview-configure-client.tsx\nindex d432e52c8..e05c8e7b2 100644\n--- a/apps/www/components/preview/preview-configure-client.tsx\n+++ b/apps/www/components/preview/preview-configure-client.tsx\n@@ -65,13 +65,18 @@ type PreviewTeamOption = {\n   name: string | null;\n };\n \n+type FrameworkDetectionResult = {\n+  framework: FrameworkPreset;\n+  packageManager: PackageManager;\n+  maintenanceScript: string;\n+  devScript: string;\n+};\n+\n type PreviewConfigureClientProps = {\n   initialTeamSlugOrId: string;\n   teams: PreviewTeamOption[];\n   repo: string;\n   installationId: string | null;\n-  initialFrameworkPreset?: FrameworkPreset;\n-  initialPackageManager?: PackageManager;\n   initialEnvVarsContent?: string | null;\n   initialMaintenanceScript?: string | null;\n   initialDevScript?: string | null;\n@@ -376,8 +381,6 @@ export function PreviewConfigureClient({\n   teams,\n   repo,\n   installationId: _installationId,\n-  initialFrameworkPreset = \"other\",\n-  initialPackageManager = \"npm\",\n   initialEnvVarsContent,\n   initialMaintenanceScript,\n   initialDevScript,\n@@ -403,20 +406,20 @@ export function PreviewConfigureClient({\n       initialEnvVars.some((r) => r.name.trim().length > 0 || r.value.trim().length > 0),\n     [initialEnvPrefilled, initialEnvVars]\n   );\n-  const initialFrameworkConfig = getFrameworkPresetConfig(\n-    initialFrameworkPreset,\n-    initialPackageManager\n-  );\n-  const initialMaintenanceScriptValue =\n-    initialMaintenanceScript ?? initialFrameworkConfig.maintenanceScript;\n-  const initialDevScriptValue =\n-    initialDevScript ?? initialFrameworkConfig.devScript;\n+  // Scripts may be provided from existing environment; otherwise we'll load them from framework detection\n+  const hasInitialScripts = initialMaintenanceScript !== null || initialDevScript !== null;\n+  const initialMaintenanceScriptValue = initialMaintenanceScript ?? \"\";\n+  const initialDevScriptValue = initialDevScript ?? \"\";\n   const initialEnvComplete = initialHasEnvValues;\n \n   const [instance, setInstance] = useState<SandboxInstance | null>(null);\n   const [isProvisioning, setIsProvisioning] = useState(false);\n   const [errorMessage, setErrorMessage] = useState<string | null>(null);\n \n+  // Framework detection state (loaded in background)\n+  const [isLoadingFramework, setIsLoadingFramework] = useState(!hasInitialScripts);\n+  const [detectedPackageManager, setDetectedPackageManager] = useState<PackageManager>(\"npm\");\n+\n   const selectedTeamSlugOrId = useMemo(\n     () => initialTeamSlugOrId || teams[0]?.slugOrId || \"\",\n     [initialTeamSlugOrId, teams]\n@@ -442,9 +445,7 @@ export function PreviewConfigureClient({\n \n   const [envVars, setEnvVars] = useState<EnvVar[]>(initialEnvVars);\n   const [hasTouchedEnvVars, setHasTouchedEnvVars] = useState(false);\n-  const [frameworkPreset, setFrameworkPreset] = useState<FrameworkPreset>(\n-    initialFrameworkPreset\n-  );\n+  const [frameworkPreset, setFrameworkPreset] = useState<FrameworkPreset>(\"other\");\n   const [maintenanceScript, setMaintenanceScript] = useState(\n     initialMaintenanceScriptValue\n   );\n@@ -471,6 +472,52 @@ export function PreviewConfigureClient({\n     }\n   }, [initialHasEnvValues]);\n \n+  // Load framework detection in background if we don't have initial scripts from environment\n+  useEffect(() => {\n+    if (hasInitialScripts) {\n+      setIsLoadingFramework(false);\n+      return;\n+    }\n+\n+    let cancelled = false;\n+\n+    async function loadFrameworkDetection() {\n+      try {\n+        const params = new URLSearchParams({ repo });\n+        const response = await fetch(`/api/integrations/github/framework-detection?${params.toString()}`);\n+        if (!response.ok) {\n+          console.error(\"Framework detection failed:\", await response.text());\n+          return;\n+        }\n+\n+        const result = (await response.json()) as FrameworkDetectionResult;\n+        if (cancelled) return;\n+\n+        setFrameworkPreset(result.framework);\n+        setDetectedPackageManager(result.packageManager);\n+        // Only set scripts if user hasn't already filled them in\n+        setMaintenanceScript((current) =>\n+          current.trim().length === 0 ? result.maintenanceScript : current\n+        );\n+        setDevScript((current) =>\n+          current.trim().length === 0 ? result.devScript : current\n+        );\n+      } catch (error) {\n+        console.error(\"Failed to detect framework:\", error);\n+      } finally {\n+        if (!cancelled) {\n+          setIsLoadingFramework(false);\n+        }\n+      }\n+    }\n+\n+    void loadFrameworkDetection();\n+\n+    return () => {\n+      cancelled = true;\n+    };\n+  }, [repo, hasInitialScripts]);\n+\n   const persistentIframeManager = iframeManager;\n \n   const keyInputRefs = useRef<Array<HTMLInputElement | null>>([]);\n@@ -742,12 +789,12 @@ export function PreviewConfigureClient({\n       setFrameworkPreset(preset);\n       // Only auto-fill if user hasn't manually edited the scripts\n       if (!hasUserEditedScripts) {\n-        const presetConfig = getFrameworkPresetConfig(preset, initialPackageManager);\n+        const presetConfig = getFrameworkPresetConfig(preset, detectedPackageManager);\n         setMaintenanceScript(presetConfig.maintenanceScript);\n         setDevScript(presetConfig.devScript);\n       }\n     },\n-    [hasUserEditedScripts, initialPackageManager]\n+    [hasUserEditedScripts, detectedPackageManager]\n   );\n \n   const handleMaintenanceScriptChange = useCallback((value: string) => {\n@@ -1308,6 +1355,7 @@ export function PreviewConfigureClient({\n         <FrameworkPresetSelect\n           value={frameworkPreset}\n           onValueChange={handleFrameworkPresetChange}\n+          loading={isLoadingFramework}\n         />\n \n         {/* Maintenance and Dev Scripts - Always expanded on initial setup */}\ndiff --git a/apps/www/lib/hono-app.ts b/apps/www/lib/hono-app.ts\nindex b0a29bfbe..1c088978f 100644\n--- a/apps/www/lib/hono-app.ts\n+++ b/apps/www/lib/hono-app.ts\n@@ -15,6 +15,7 @@ import {\n   codeReviewRouter,\n   devServerRouter,\n   environmentsRouter,\n+  githubFrameworkDetectionRouter,\n   githubInstallStateRouter,\n   githubOAuthTokenRouter,\n   healthRouter,\n@@ -126,6 +127,7 @@ app.route(\"/\", githubPrsPatchRouter);\n app.route(\"/\", githubPrsFilesRouter);\n app.route(\"/\", githubPrsFileContentsRouter);\n app.route(\"/\", githubPrsFileContentsBatchRouter);\n+app.route(\"/\", githubFrameworkDetectionRouter);\n app.route(\"/\", githubInstallStateRouter);\n app.route(\"/\", githubOAuthTokenRouter);\n app.route(\"/\", morphRouter);\ndiff --git a/apps/www/lib/routes/github.framework-detection.route.ts b/apps/www/lib/routes/github.framework-detection.route.ts\nnew file mode 100644\nindex 000000000..21f120116\n--- /dev/null\n+++ b/apps/www/lib/routes/github.framework-detection.route.ts\n@@ -0,0 +1,70 @@\n+import { getAccessTokenFromRequest } from \"@/lib/utils/auth\";\n+import { OpenAPIHono, createRoute, z } from \"@hono/zod-openapi\";\n+import { detectFrameworkAndPackageManager } from \"@/lib/github/framework-detection\";\n+import { stackServerApp } from \"@/lib/utils/stack\";\n+\n+export const githubFrameworkDetectionRouter = new OpenAPIHono();\n+\n+const Query = z\n+  .object({\n+    repo: z.string().min(1).openapi({ description: \"Repository full name (owner/repo)\" }),\n+  })\n+  .openapi(\"GithubFrameworkDetectionQuery\");\n+\n+const FrameworkDetectionResponse = z\n+  .object({\n+    framework: z.enum([\"other\", \"next\", \"vite\", \"remix\", \"nuxt\", \"sveltekit\", \"angular\", \"cra\", \"vue\"]),\n+    packageManager: z.enum([\"npm\", \"yarn\", \"pnpm\", \"bun\"]),\n+    maintenanceScript: z.string(),\n+    devScript: z.string(),\n+  })\n+  .openapi(\"FrameworkDetectionResponse\");\n+\n+githubFrameworkDetectionRouter.openapi(\n+  createRoute({\n+    method: \"get\" as const,\n+    path: \"/integrations/github/framework-detection\",\n+    tags: [\"Integrations\"],\n+    summary: \"Detect framework and package manager for a GitHub repository\",\n+    request: { query: Query },\n+    responses: {\n+      200: {\n+        description: \"OK\",\n+        content: {\n+          \"application/json\": {\n+            schema: FrameworkDetectionResponse,\n+          },\n+        },\n+      },\n+      401: { description: \"Unauthorized\" },\n+      400: { description: \"Bad request\" },\n+    },\n+  }),\n+  async (c) => {\n+    const accessToken = await getAccessTokenFromRequest(c.req.raw);\n+    if (!accessToken) return c.text(\"Unauthorized\", 401);\n+\n+    const { repo } = c.req.valid(\"query\");\n+\n+    // Get the user's GitHub access token for better rate limits\n+    let githubAccessToken: string | undefined;\n+    try {\n+      const user = await stackServerApp.getUser({ tokenStore: c.req.raw });\n+      if (user) {\n+        const githubAccount = await user.getConnectedAccount(\"github\");\n+        if (githubAccount) {\n+          const tokenResult = await githubAccount.getAccessToken();\n+          if (tokenResult.accessToken) {\n+            githubAccessToken = tokenResult.accessToken;\n+          }\n+        }\n+      }\n+    } catch (error) {\n+      console.error(\"Failed to fetch GitHub access token for framework detection\", error);\n+    }\n+\n+    const result = await detectFrameworkAndPackageManager(repo, githubAccessToken);\n+\n+    return c.json(result);\n+  }\n+);\ndiff --git a/apps/www/lib/routes/index.ts b/apps/www/lib/routes/index.ts\nindex 97b3d0fa4..279951bcc 100644\n--- a/apps/www/lib/routes/index.ts\n+++ b/apps/www/lib/routes/index.ts\n@@ -1,6 +1,7 @@\n export { booksRouter } from \"./books.route\";\n export { devServerRouter } from \"./dev-server.route\";\n export { environmentsRouter } from \"./environments.route\";\n+export { githubFrameworkDetectionRouter } from \"./github.framework-detection.route\";\n export { githubOAuthTokenRouter } from \"./github.oauth-token.route\";\n export { githubPrsBackfillRepoRouter } from \"./github.prs.backfill-repo.route\";\n export { githubPrsBackfillRouter } from \"./github.prs.backfill.route\";\ndiff --git a/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts b/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts\nindex f99506014..b40ee8f88 100644\n--- a/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts\n+++ b/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts\n@@ -1,8 +1,8 @@\n // This file is auto-generated by @hey-api/openapi-ts\n \n-import { type Options, getApiHealth, postApiAuthAnonymousSignUp, getApiUsers, postApiUsers, deleteApiUsersById, getApiUsersById, patchApiUsersById, getApiBooks, postApiBooks, getApiBooksById, postApiBooksByIdBorrow, postApiBooksByIdReturn, postApiDevServerStart, getApiIntegrationsGithubRepos, getApiIntegrationsGithubPrs, postApiIntegrationsGithubPrsBackfill, postApiIntegrationsGithubPrsBackfillRepo, getApiIntegrationsGithubPrsCode, postApiIntegrationsGithubPrsOpen, postApiIntegrationsGithubPrsMerge, postApiIntegrationsGithubPrsClose, postApiIntegrationsGithubPrsMergeSimple, getApiIntegrationsGithubPrsRaw, getApiIntegrationsGithubPrsFiles, getApiIntegrationsGithubPrsFileContents, postApiIntegrationsGithubPrsFileContentsBatch, postApiIntegrationsGithubInstallState, getApiIntegrationsGithubOauthToken, postApiMorphTaskRunsByTaskRunIdResume, postApiMorphTaskRunsByTaskRunIdIsPaused, postApiMorphSetupInstance, getApiEnvironments, postApiEnvironments, deleteApiEnvironmentsById, getApiEnvironmentsById, patchApiEnvironmentsById, getApiEnvironmentsByIdVars, patchApiEnvironmentsByIdPorts, getApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivate, postApiSandboxesStart, postApiSandboxesByIdEnv, postApiSandboxesByIdStop, getApiSandboxesByIdStatus, postApiSandboxesByIdPublishDevcontainer, postApiTeams, postApiBranchesGenerate, postApiCodeReviewStart, getApiWorkspaceConfigs, postApiWorkspaceConfigs, getApiPreviewConfigs, postApiPreviewConfigs, deleteApiPreviewConfigsByPreviewConfigId, getApiPreviewConfigsByPreviewConfigIdRuns } from '../sdk.gen.js';\n+import { type Options, getApiHealth, postApiAuthAnonymousSignUp, getApiUsers, postApiUsers, deleteApiUsersById, getApiUsersById, patchApiUsersById, getApiBooks, postApiBooks, getApiBooksById, postApiBooksByIdBorrow, postApiBooksByIdReturn, postApiDevServerStart, getApiIntegrationsGithubRepos, getApiIntegrationsGithubPrs, postApiIntegrationsGithubPrsBackfill, postApiIntegrationsGithubPrsBackfillRepo, getApiIntegrationsGithubPrsCode, postApiIntegrationsGithubPrsOpen, postApiIntegrationsGithubPrsMerge, postApiIntegrationsGithubPrsClose, postApiIntegrationsGithubPrsMergeSimple, getApiIntegrationsGithubPrsRaw, getApiIntegrationsGithubPrsFiles, getApiIntegrationsGithubPrsFileContents, postApiIntegrationsGithubPrsFileContentsBatch, getApiIntegrationsGithubFrameworkDetection, postApiIntegrationsGithubInstallState, getApiIntegrationsGithubOauthToken, postApiMorphTaskRunsByTaskRunIdResume, postApiMorphTaskRunsByTaskRunIdIsPaused, postApiMorphSetupInstance, getApiEnvironments, postApiEnvironments, deleteApiEnvironmentsById, getApiEnvironmentsById, patchApiEnvironmentsById, getApiEnvironmentsByIdVars, patchApiEnvironmentsByIdPorts, getApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivate, postApiSandboxesStart, postApiSandboxesByIdEnv, postApiSandboxesByIdStop, getApiSandboxesByIdStatus, postApiSandboxesByIdPublishDevcontainer, postApiTeams, postApiBranchesGenerate, postApiCodeReviewStart, getApiWorkspaceConfigs, postApiWorkspaceConfigs, getApiPreviewConfigs, postApiPreviewConfigs, deleteApiPreviewConfigsByPreviewConfigId, getApiPreviewConfigsByPreviewConfigIdRuns } from '../sdk.gen.js';\n import { queryOptions, type UseMutationOptions, type DefaultError, infiniteQueryOptions, type InfiniteData } from '@tanstack/react-query';\n-import type { GetApiHealthData, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponse, GetApiUsersData, GetApiUsersResponse, PostApiUsersData, PostApiUsersError, PostApiUsersResponse, DeleteApiUsersByIdData, DeleteApiUsersByIdError, DeleteApiUsersByIdResponse, GetApiUsersByIdData, PatchApiUsersByIdData, PatchApiUsersByIdError, PatchApiUsersByIdResponse, GetApiBooksData, PostApiBooksData, PostApiBooksError, PostApiBooksResponse, GetApiBooksByIdData, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowError, PostApiBooksByIdBorrowResponse, PostApiBooksByIdReturnData, PostApiBooksByIdReturnError, PostApiBooksByIdReturnResponse, PostApiDevServerStartData, PostApiDevServerStartError, PostApiDevServerStartResponse, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponse, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponse, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillRepoData, GetApiIntegrationsGithubPrsCodeData, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponse, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponse, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponse, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponse, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFileContentsData, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponse, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponse, GetApiIntegrationsGithubOauthTokenData, PostApiMorphTaskRunsByTaskRunIdResumeData, PostApiMorphTaskRunsByTaskRunIdResumeResponse, PostApiMorphTaskRunsByTaskRunIdIsPausedData, PostApiMorphTaskRunsByTaskRunIdIsPausedResponse, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponse, GetApiEnvironmentsData, PostApiEnvironmentsData, PostApiEnvironmentsResponse, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdData, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdVarsData, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponse, GetApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponse, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponse, PostApiSandboxesStartData, PostApiSandboxesStartResponse, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponse, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponse, GetApiSandboxesByIdStatusData, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponse, PostApiTeamsData, PostApiTeamsError, PostApiTeamsResponse, PostApiBranchesGenerateData, PostApiBranchesGenerateResponse, PostApiCodeReviewStartData, PostApiCodeReviewStartResponse, GetApiWorkspaceConfigsData, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponse, GetApiPreviewConfigsData, PostApiPreviewConfigsData, PostApiPreviewConfigsResponse, DeleteApiPreviewConfigsByPreviewConfigIdData, DeleteApiPreviewConfigsByPreviewConfigIdResponse, GetApiPreviewConfigsByPreviewConfigIdRunsData } from '../types.gen.js';\n+import type { GetApiHealthData, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponse, GetApiUsersData, GetApiUsersResponse, PostApiUsersData, PostApiUsersError, PostApiUsersResponse, DeleteApiUsersByIdData, DeleteApiUsersByIdError, DeleteApiUsersByIdResponse, GetApiUsersByIdData, PatchApiUsersByIdData, PatchApiUsersByIdError, PatchApiUsersByIdResponse, GetApiBooksData, PostApiBooksData, PostApiBooksError, PostApiBooksResponse, GetApiBooksByIdData, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowError, PostApiBooksByIdBorrowResponse, PostApiBooksByIdReturnData, PostApiBooksByIdReturnError, PostApiBooksByIdReturnResponse, PostApiDevServerStartData, PostApiDevServerStartError, PostApiDevServerStartResponse, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponse, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponse, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillRepoData, GetApiIntegrationsGithubPrsCodeData, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponse, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponse, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponse, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponse, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFileContentsData, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponse, GetApiIntegrationsGithubFrameworkDetectionData, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponse, GetApiIntegrationsGithubOauthTokenData, PostApiMorphTaskRunsByTaskRunIdResumeData, PostApiMorphTaskRunsByTaskRunIdResumeResponse, PostApiMorphTaskRunsByTaskRunIdIsPausedData, PostApiMorphTaskRunsByTaskRunIdIsPausedResponse, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponse, GetApiEnvironmentsData, PostApiEnvironmentsData, PostApiEnvironmentsResponse, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdData, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdVarsData, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponse, GetApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponse, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponse, PostApiSandboxesStartData, PostApiSandboxesStartResponse, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponse, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponse, GetApiSandboxesByIdStatusData, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponse, PostApiTeamsData, PostApiTeamsError, PostApiTeamsResponse, PostApiBranchesGenerateData, PostApiBranchesGenerateResponse, PostApiCodeReviewStartData, PostApiCodeReviewStartResponse, GetApiWorkspaceConfigsData, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponse, GetApiPreviewConfigsData, PostApiPreviewConfigsData, PostApiPreviewConfigsResponse, DeleteApiPreviewConfigsByPreviewConfigIdData, DeleteApiPreviewConfigsByPreviewConfigIdResponse, GetApiPreviewConfigsByPreviewConfigIdRunsData } from '../types.gen.js';\n import { client as _heyApiClient } from '../client.gen.js';\n \n export type QueryKey<TOptions extends Options> = [\n@@ -634,6 +634,26 @@ export const postApiIntegrationsGithubPrsFileContentsBatchMutation = (options?:\n     return mutationOptions;\n };\n \n+export const getApiIntegrationsGithubFrameworkDetectionQueryKey = (options: Options<GetApiIntegrationsGithubFrameworkDetectionData>) => createQueryKey('getApiIntegrationsGithubFrameworkDetection', options);\n+\n+/**\n+ * Detect framework and package manager for a GitHub repository\n+ */\n+export const getApiIntegrationsGithubFrameworkDetectionOptions = (options: Options<GetApiIntegrationsGithubFrameworkDetectionData>) => {\n+    return queryOptions({\n+        queryFn: async ({ queryKey, signal }) => {\n+            const { data } = await getApiIntegrationsGithubFrameworkDetection({\n+                ...options,\n+                ...queryKey[0],\n+                signal,\n+                throwOnError: true\n+            });\n+            return data;\n+        },\n+        queryKey: getApiIntegrationsGithubFrameworkDetectionQueryKey(options)\n+    });\n+};\n+\n /**\n  * Generate a signed install state token for GitHub App installation\n  */\ndiff --git a/packages/www-openapi-client/src/client/sdk.gen.ts b/packages/www-openapi-client/src/client/sdk.gen.ts\nindex 834397a27..cf8d1fb29 100644\n--- a/packages/www-openapi-client/src/client/sdk.gen.ts\n+++ b/packages/www-openapi-client/src/client/sdk.gen.ts\n@@ -1,7 +1,7 @@\n // This file is auto-generated by @hey-api/openapi-ts\n \n import type { Options as ClientOptions, TDataShape, Client } from './client/index.js';\n-import type { GetApiHealthData, GetApiHealthResponses, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponses, PostApiAuthAnonymousSignUpErrors, GetApiUsersData, GetApiUsersResponses, PostApiUsersData, PostApiUsersResponses, PostApiUsersErrors, DeleteApiUsersByIdData, DeleteApiUsersByIdResponses, DeleteApiUsersByIdErrors, GetApiUsersByIdData, GetApiUsersByIdResponses, GetApiUsersByIdErrors, PatchApiUsersByIdData, PatchApiUsersByIdResponses, PatchApiUsersByIdErrors, GetApiBooksData, GetApiBooksResponses, PostApiBooksData, PostApiBooksResponses, PostApiBooksErrors, GetApiBooksByIdData, GetApiBooksByIdResponses, GetApiBooksByIdErrors, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowResponses, PostApiBooksByIdBorrowErrors, PostApiBooksByIdReturnData, PostApiBooksByIdReturnResponses, PostApiBooksByIdReturnErrors, PostApiDevServerStartData, PostApiDevServerStartResponses, PostApiDevServerStartErrors, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponses, GetApiIntegrationsGithubReposErrors, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponses, GetApiIntegrationsGithubPrsErrors, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillResponses, PostApiIntegrationsGithubPrsBackfillErrors, PostApiIntegrationsGithubPrsBackfillRepoData, PostApiIntegrationsGithubPrsBackfillRepoResponses, PostApiIntegrationsGithubPrsBackfillRepoErrors, GetApiIntegrationsGithubPrsCodeData, GetApiIntegrationsGithubPrsCodeResponses, GetApiIntegrationsGithubPrsCodeErrors, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponses, PostApiIntegrationsGithubPrsOpenErrors, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponses, PostApiIntegrationsGithubPrsMergeErrors, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponses, PostApiIntegrationsGithubPrsCloseErrors, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponses, PostApiIntegrationsGithubPrsMergeSimpleErrors, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsRawResponses, GetApiIntegrationsGithubPrsRawErrors, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFilesResponses, GetApiIntegrationsGithubPrsFilesErrors, GetApiIntegrationsGithubPrsFileContentsData, GetApiIntegrationsGithubPrsFileContentsResponses, GetApiIntegrationsGithubPrsFileContentsErrors, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponses, PostApiIntegrationsGithubPrsFileContentsBatchErrors, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponses, PostApiIntegrationsGithubInstallStateErrors, GetApiIntegrationsGithubOauthTokenData, GetApiIntegrationsGithubOauthTokenResponses, GetApiIntegrationsGithubOauthTokenErrors, PostApiMorphTaskRunsByTaskRunIdResumeData, PostApiMorphTaskRunsByTaskRunIdResumeResponses, PostApiMorphTaskRunsByTaskRunIdResumeErrors, PostApiMorphTaskRunsByTaskRunIdIsPausedData, PostApiMorphTaskRunsByTaskRunIdIsPausedResponses, PostApiMorphTaskRunsByTaskRunIdIsPausedErrors, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponses, PostApiMorphSetupInstanceErrors, GetApiIframePreflightData, GetApiIframePreflightResponses, GetApiIframePreflightErrors, GetApiEnvironmentsData, GetApiEnvironmentsResponses, GetApiEnvironmentsErrors, PostApiEnvironmentsData, PostApiEnvironmentsResponses, PostApiEnvironmentsErrors, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponses, DeleteApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdData, GetApiEnvironmentsByIdResponses, GetApiEnvironmentsByIdErrors, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponses, PatchApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdVarsData, GetApiEnvironmentsByIdVarsResponses, GetApiEnvironmentsByIdVarsErrors, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponses, PatchApiEnvironmentsByIdPortsErrors, GetApiEnvironmentsByIdSnapshotsData, GetApiEnvironmentsByIdSnapshotsResponses, GetApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponses, PostApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponses, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateErrors, PostApiSandboxesStartData, PostApiSandboxesStartResponses, PostApiSandboxesStartErrors, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponses, PostApiSandboxesByIdEnvErrors, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponses, PostApiSandboxesByIdStopErrors, GetApiSandboxesByIdStatusData, GetApiSandboxesByIdStatusResponses, GetApiSandboxesByIdStatusErrors, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponses, PostApiSandboxesByIdPublishDevcontainerErrors, PostApiTeamsData, PostApiTeamsResponses, PostApiTeamsErrors, PostApiBranchesGenerateData, PostApiBranchesGenerateResponses, PostApiBranchesGenerateErrors, PostApiCodeReviewStartData, PostApiCodeReviewStartResponses, PostApiCodeReviewStartErrors, GetApiWorkspaceConfigsData, GetApiWorkspaceConfigsResponses, GetApiWorkspaceConfigsErrors, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponses, PostApiWorkspaceConfigsErrors, GetApiPreviewConfigsData, GetApiPreviewConfigsResponses, GetApiPreviewConfigsErrors, PostApiPreviewConfigsData, PostApiPreviewConfigsResponses, PostApiPreviewConfigsErrors, DeleteApiPreviewConfigsByPreviewConfigIdData, DeleteApiPreviewConfigsByPreviewConfigIdResponses, DeleteApiPreviewConfigsByPreviewConfigIdErrors, GetApiPreviewConfigsByPreviewConfigIdRunsData, GetApiPreviewConfigsByPreviewConfigIdRunsResponses, GetApiPreviewConfigsByPreviewConfigIdRunsErrors } from './types.gen.js';\n+import type { GetApiHealthData, GetApiHealthResponses, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponses, PostApiAuthAnonymousSignUpErrors, GetApiUsersData, GetApiUsersResponses, PostApiUsersData, PostApiUsersResponses, PostApiUsersErrors, DeleteApiUsersByIdData, DeleteApiUsersByIdResponses, DeleteApiUsersByIdErrors, GetApiUsersByIdData, GetApiUsersByIdResponses, GetApiUsersByIdErrors, PatchApiUsersByIdData, PatchApiUsersByIdResponses, PatchApiUsersByIdErrors, GetApiBooksData, GetApiBooksResponses, PostApiBooksData, PostApiBooksResponses, PostApiBooksErrors, GetApiBooksByIdData, GetApiBooksByIdResponses, GetApiBooksByIdErrors, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowResponses, PostApiBooksByIdBorrowErrors, PostApiBooksByIdReturnData, PostApiBooksByIdReturnResponses, PostApiBooksByIdReturnErrors, PostApiDevServerStartData, PostApiDevServerStartResponses, PostApiDevServerStartErrors, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponses, GetApiIntegrationsGithubReposErrors, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponses, GetApiIntegrationsGithubPrsErrors, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillResponses, PostApiIntegrationsGithubPrsBackfillErrors, PostApiIntegrationsGithubPrsBackfillRepoData, PostApiIntegrationsGithubPrsBackfillRepoResponses, PostApiIntegrationsGithubPrsBackfillRepoErrors, GetApiIntegrationsGithubPrsCodeData, GetApiIntegrationsGithubPrsCodeResponses, GetApiIntegrationsGithubPrsCodeErrors, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponses, PostApiIntegrationsGithubPrsOpenErrors, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponses, PostApiIntegrationsGithubPrsMergeErrors, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponses, PostApiIntegrationsGithubPrsCloseErrors, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponses, PostApiIntegrationsGithubPrsMergeSimpleErrors, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsRawResponses, GetApiIntegrationsGithubPrsRawErrors, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFilesResponses, GetApiIntegrationsGithubPrsFilesErrors, GetApiIntegrationsGithubPrsFileContentsData, GetApiIntegrationsGithubPrsFileContentsResponses, GetApiIntegrationsGithubPrsFileContentsErrors, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponses, PostApiIntegrationsGithubPrsFileContentsBatchErrors, GetApiIntegrationsGithubFrameworkDetectionData, GetApiIntegrationsGithubFrameworkDetectionResponses, GetApiIntegrationsGithubFrameworkDetectionErrors, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponses, PostApiIntegrationsGithubInstallStateErrors, GetApiIntegrationsGithubOauthTokenData, GetApiIntegrationsGithubOauthTokenResponses, GetApiIntegrationsGithubOauthTokenErrors, PostApiMorphTaskRunsByTaskRunIdResumeData, PostApiMorphTaskRunsByTaskRunIdResumeResponses, PostApiMorphTaskRunsByTaskRunIdResumeErrors, PostApiMorphTaskRunsByTaskRunIdIsPausedData, PostApiMorphTaskRunsByTaskRunIdIsPausedResponses, PostApiMorphTaskRunsByTaskRunIdIsPausedErrors, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponses, PostApiMorphSetupInstanceErrors, GetApiIframePreflightData, GetApiIframePreflightResponses, GetApiIframePreflightErrors, GetApiEnvironmentsData, GetApiEnvironmentsResponses, GetApiEnvironmentsErrors, PostApiEnvironmentsData, PostApiEnvironmentsResponses, PostApiEnvironmentsErrors, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponses, DeleteApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdData, GetApiEnvironmentsByIdResponses, GetApiEnvironmentsByIdErrors, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponses, PatchApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdVarsData, GetApiEnvironmentsByIdVarsResponses, GetApiEnvironmentsByIdVarsErrors, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponses, PatchApiEnvironmentsByIdPortsErrors, GetApiEnvironmentsByIdSnapshotsData, GetApiEnvironmentsByIdSnapshotsResponses, GetApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponses, PostApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponses, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateErrors, PostApiSandboxesStartData, PostApiSandboxesStartResponses, PostApiSandboxesStartErrors, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponses, PostApiSandboxesByIdEnvErrors, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponses, PostApiSandboxesByIdStopErrors, GetApiSandboxesByIdStatusData, GetApiSandboxesByIdStatusResponses, GetApiSandboxesByIdStatusErrors, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponses, PostApiSandboxesByIdPublishDevcontainerErrors, PostApiTeamsData, PostApiTeamsResponses, PostApiTeamsErrors, PostApiBranchesGenerateData, PostApiBranchesGenerateResponses, PostApiBranchesGenerateErrors, PostApiCodeReviewStartData, PostApiCodeReviewStartResponses, PostApiCodeReviewStartErrors, GetApiWorkspaceConfigsData, GetApiWorkspaceConfigsResponses, GetApiWorkspaceConfigsErrors, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponses, PostApiWorkspaceConfigsErrors, GetApiPreviewConfigsData, GetApiPreviewConfigsResponses, GetApiPreviewConfigsErrors, PostApiPreviewConfigsData, PostApiPreviewConfigsResponses, PostApiPreviewConfigsErrors, DeleteApiPreviewConfigsByPreviewConfigIdData, DeleteApiPreviewConfigsByPreviewConfigIdResponses, DeleteApiPreviewConfigsByPreviewConfigIdErrors, GetApiPreviewConfigsByPreviewConfigIdRunsData, GetApiPreviewConfigsByPreviewConfigIdRunsResponses, GetApiPreviewConfigsByPreviewConfigIdRunsErrors } from './types.gen.js';\n import { client as _heyApiClient } from './client.gen.js';\n \n export type Options<TData extends TDataShape = TDataShape, ThrowOnError extends boolean = boolean> = ClientOptions<TData, ThrowOnError> & {\n@@ -323,6 +323,16 @@ export const postApiIntegrationsGithubPrsFileContentsBatch = <ThrowOnError exten\n     });\n };\n \n+/**\n+ * Detect framework and package manager for a GitHub repository\n+ */\n+export const getApiIntegrationsGithubFrameworkDetection = <ThrowOnError extends boolean = false>(options: Options<GetApiIntegrationsGithubFrameworkDetectionData, ThrowOnError>) => {\n+    return (options.client ?? _heyApiClient).get<GetApiIntegrationsGithubFrameworkDetectionResponses, GetApiIntegrationsGithubFrameworkDetectionErrors, ThrowOnError>({\n+        url: '/api/integrations/github/framework-detection',\n+        ...options\n+    });\n+};\n+\n /**\n  * Generate a signed install state token for GitHub App installation\n  */\ndiff --git a/packages/www-openapi-client/src/client/types.gen.ts b/packages/www-openapi-client/src/client/types.gen.ts\nindex e9427228f..51371ad41 100644\n--- a/packages/www-openapi-client/src/client/types.gen.ts\n+++ b/packages/www-openapi-client/src/client/types.gen.ts\n@@ -335,6 +335,13 @@ export type GithubPrsFileContentsBatchBody = {\n     maxFileBytes?: number;\n };\n \n+export type FrameworkDetectionResponse = {\n+    framework: 'other' | 'next' | 'vite' | 'remix' | 'nuxt' | 'sveltekit' | 'angular' | 'cra' | 'vue';\n+    packageManager: 'npm' | 'yarn' | 'pnpm' | 'bun';\n+    maintenanceScript: string;\n+    devScript: string;\n+};\n+\n export type GithubInstallStateResponse = {\n     state: string;\n     installUrl: string;\n@@ -1597,6 +1604,38 @@ export type PostApiIntegrationsGithubPrsFileContentsBatchResponses = {\n \n export type PostApiIntegrationsGithubPrsFileContentsBatchResponse = PostApiIntegrationsGithubPrsFileContentsBatchResponses[keyof PostApiIntegrationsGithubPrsFileContentsBatchResponses];\n \n+export type GetApiIntegrationsGithubFrameworkDetectionData = {\n+    body?: never;\n+    path?: never;\n+    query: {\n+        /**\n+         * Repository full name (owner/repo)\n+         */\n+        repo: string;\n+    };\n+    url: '/api/integrations/github/framework-detection';\n+};\n+\n+export type GetApiIntegrationsGithubFrameworkDetectionErrors = {\n+    /**\n+     * Bad request\n+     */\n+    400: unknown;\n+    /**\n+     * Unauthorized\n+     */\n+    401: unknown;\n+};\n+\n+export type GetApiIntegrationsGithubFrameworkDetectionResponses = {\n+    /**\n+     * OK\n+     */\n+    200: FrameworkDetectionResponse;\n+};\n+\n+export type GetApiIntegrationsGithubFrameworkDetectionResponse = GetApiIntegrationsGithubFrameworkDetectionResponses[keyof GetApiIntegrationsGithubFrameworkDetectionResponses];\n+\n export type PostApiIntegrationsGithubInstallStateData = {\n     body: GithubInstallStateRequest;\n     path?: never;\n","comments":[{"type":"issue_comment","id":3614806348,"prNumber":1174,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.dev/manaflow/task/kn7cvpsre308xhazp8t7ctjjfs7wpqdx?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.dev/manaflow/task/kn7cvpsre308xhazp8t7ctjjfs7wpqdx/run/kd79p70dgx7hsz673he8j8391h7wp4h3/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1174?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 7 screenshots for commit `1f9ae33` (2025-12-05 00:10:53.490 UTC).\n\n**Framework Preset dropdown menu expanded showing all available framework options \\(Other, Next.js, Vite, Remix, Nuxt, SvelteKit, Angular, Create React App, Vue\\) with their respective icons**\n\n![framework-preset-dropdown-open.png](https://adorable-wombat-701.convex.cloud/api/storage/d8eddcc2-4290-4a64-8138-8abc47f914a2)\n\n**Framework Preset dropdown open with Next.js option selected and highlighted, showing the Next.js icon and all other framework options**\n\n![nextjs-framework-dropdown-open.png](https://adorable-wombat-701.convex.cloud/api/storage/a35a4377-56e7-4906-afc8-6a4c8eb0aed2)\n\n**Framework detection completed for vercel/next.js, showing Next.js framework preset selected with 'pnpm install' and 'pnpm run dev' scripts auto-filled**\n\n![nextjs-repo-framework-detection-completed.png](https://adorable-wombat-701.convex.cloud/api/storage/72d055b7-72db-4ee9-b469-a5c45d75f797)\n\n**Preview configure page showing the 'Detecting...' loading state for vercel/next.js repository during background framework detection**\n\n![nextjs-repo-framework-detection-loading.png](https://adorable-wombat-701.convex.cloud/api/storage/0928035d-b8a6-4f98-a794-b3576a35bbe7)\n\n**Preview configure page after framework detection completed, showing 'Other' framework preset with 'yarn install' auto-filled as maintenance script for facebook/react**\n\n![preview-configure-page-framework-detection-completed.png](https://adorable-wombat-701.convex.cloud/api/storage/0e6acd9c-30e0-4cc7-bc2b-b573e8560206)\n\n**Initial preview configure page showing the 'Detecting...' loading indicator next to Framework Preset for facebook/react repository**\n\n![preview-configure-page-with-framework-detection-loading.png](https://adorable-wombat-701.convex.cloud/api/storage/e7678cc9-e2ee-462f-abce-dd884c7ea74b)\n\n**Framework detection for vuejs/core repository showing Vite framework preset detected with 'pnpm install' and 'pnpm run dev' scripts auto-filled**\n\n![vuejs-repo-vite-framework-detected.png](https://adorable-wombat-701.convex.cloud/api/storage/b4788300-df3b-401d-a743-80027e8f671f)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"4d0be11219cab6ccf5e967c5b4b4b896ba24f02d","createdAt":"2025-12-05T00:10:54Z","updatedAt":"2025-12-05T00:31:25Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1174#issuecomment-3614806348"},{"type":"issue_comment","id":3614836528,"prNumber":1174,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7dcv40eh2wkjr4ma771prsr17wpv57?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7dcv40eh2wkjr4ma771prsr17wpv57/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1174?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n### Capturing screenshots for `91402bf`...\n\n> Screenshot capture is in progress. This comment will be updated with screenshots once complete.\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"4d0be11219cab6ccf5e967c5b4b4b896ba24f02d","createdAt":"2025-12-05T00:23:58Z","updatedAt":"2025-12-05T00:28:55Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1174#issuecomment-3614836528"},{"type":"issue_comment","id":3614845986,"prNumber":1174,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7dcv40eh2wkjr4ma771prsr17wpv57?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7dcv40eh2wkjr4ma771prsr17wpv57/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1174?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 3 screenshots for commit `91402bf` (2025-12-05 00:28:51.988 UTC).\n\n**Full page view showing both loading and loaded states of the Framework Preset selector**\n\n![framework-preset-selector-loading-states.png](https://famous-camel-162.convex.cloud/api/storage/ce6f76b8-2ef5-4b9d-89f3-1b4f0e70a270)\n\n**Framework Preset selector in loaded state - showing detected Next.js framework after loading completes**\n\n![framework-selector-loaded-state.png](https://famous-camel-162.convex.cloud/api/storage/2534dc13-61ab-409d-862e-c078b7f585e7)\n\n**Framework Preset selector in loading state - showing spinner icon and 'Detecting...' text, with disabled/grayed out appearance**\n\n![framework-selector-loading-state.png](https://famous-camel-162.convex.cloud/api/storage/bbbc829b-9463-4774-9f38-59768a0271b3)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"4d0be11219cab6ccf5e967c5b4b4b896ba24f02d","createdAt":"2025-12-05T00:28:54Z","updatedAt":"2025-12-05T00:28:54Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1174#issuecomment-3614845986"},{"type":"issue_comment","id":3614851061,"prNumber":1174,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7654khk6n8wk097njrsyr1297wqk5h?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7654khk6n8wk097njrsyr1297wqk5h/run/kd7djzbrtqsgedgwxaefg5xq9h7wq2h1/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1174?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 4 screenshots for commit `91402bf` (2025-12-05 00:31:24.004 UTC).\n\n**Initial setup page showing 'Detecting...' loading state next to Framework Preset dropdown while framework detection API loads in background**\n\n![01-configure-initial-setup-with-framework-detection-loading.png](https://adorable-wombat-701.convex.cloud/api/storage/95f56056-afec-41d2-8fdb-a92ba47e1d75)\n\n**Framework detection completed - dropdown is now enabled and 'Detecting...' text has been removed**\n\n![02-configure-initial-setup-framework-detection-complete.png](https://adorable-wombat-701.convex.cloud/api/storage/355ef2f9-9150-4fd5-864d-637b9042ca9b)\n\n**Another example showing the 'Detecting...' loading state with different repository \\(cmux/cmux\\)**\n\n![03-configure-cmux-repo-framework-detecting.png](https://adorable-wombat-701.convex.cloud/api/storage/7e189b22-2638-4e37-8227-f8ac32b6fe1a)\n\n**Error state when sandbox provisioning fails \\(not related to framework detection feature\\)**\n\n![05-error-state-failed-to-hydrate-sandbox.png](https://adorable-wombat-701.convex.cloud/api/storage/4ba509da-0bc2-4775-900e-5389dbb60efc)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"4d0be11219cab6ccf5e967c5b4b4b896ba24f02d","createdAt":"2025-12-05T00:31:24Z","updatedAt":"2025-12-05T00:31:24Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1174#issuecomment-3614851061"}]}
{"number":1173,"title":"Add mock example to preview front page","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1173","headRef":"cmux/add-mock-example-to-preview-front-page-643wi","headSha":"d8e6ee9102682aa38e4432c257239368c48157ea","baseRef":"main","baseSha":"30d123ad4cb635b7ec22a00e63a84bf3c33b1ece","createdAt":"2025-12-04T22:11:43Z","updatedAt":"2025-12-05T11:12:59Z","diff":"diff --git a/apps/www/components/preview/preview-dashboard.tsx b/apps/www/components/preview/preview-dashboard.tsx\nindex 70db13932..6bbc0477d 100644\n--- a/apps/www/components/preview/preview-dashboard.tsx\n+++ b/apps/www/components/preview/preview-dashboard.tsx\n@@ -1,20 +1,35 @@\n \"use client\";\n \n-import { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\n+import { useCallback, useEffect, useMemo, useRef, useState, useId } from \"react\";\n import {\n   ArrowLeft,\n   Camera,\n   CheckCircle2,\n+  ChevronDown,\n+  ChevronRight,\n+  Code,\n+  Download,\n   ExternalLink,\n+  FileText,\n+  Folder,\n+  GitBranch,\n+  GitCompare as GitCompareIcon,\n   Github,\n+  Home,\n   Link2,\n   Loader2,\n+  Monitor,\n   Pencil,\n+  Plus,\n   Search,\n   Server,\n+  Settings,\n   Star,\n+  TerminalSquare,\n   Trash2,\n+  X,\n } from \"lucide-react\";\n+import Image from \"next/image\";\n import Link from \"next/link\";\n import clsx from \"clsx\";\n import { QueryClient, QueryClientProvider, useQuery } from \"@tanstack/react-query\";\n@@ -105,6 +120,77 @@ function GrainOverlay({ opacity = 0.08 }: { opacity?: number }) {\n   );\n }\n \n+function CmuxMarkIcon({ size = 16, className }: { size?: number; className?: string }) {\n+  const id = useId();\n+  const gradId = `cmuxMarkGradient-${id}`;\n+  const glowId = `cmuxMarkGlow-${id}`;\n+\n+  return (\n+    <svg\n+      width={size}\n+      height={size}\n+      viewBox=\"0 0 517 667\"\n+      className={className}\n+      role=\"img\"\n+      aria-hidden\n+    >\n+      <defs>\n+        <linearGradient id={gradId} x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\">\n+          <stop offset=\"0%\" stopColor=\"#00D4FF\" />\n+          <stop offset=\"100%\" stopColor=\"#7C3AED\" />\n+        </linearGradient>\n+        <filter\n+          id={glowId}\n+          x=\"0\"\n+          y=\"0\"\n+          width=\"517\"\n+          height=\"667\"\n+          filterUnits=\"userSpaceOnUse\"\n+          colorInterpolationFilters=\"sRGB\"\n+        >\n+          <feFlood floodOpacity=\"0\" result=\"BackgroundImageFix\" />\n+          <feColorMatrix\n+            in=\"SourceAlpha\"\n+            type=\"matrix\"\n+            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n+            result=\"hardAlpha\"\n+          />\n+          <feOffset />\n+          <feGaussianBlur stdDeviation=\"32\" />\n+          <feComposite in2=\"hardAlpha\" operator=\"out\" />\n+          <feColorMatrix\n+            type=\"matrix\"\n+            values=\"0 0 0 0 0.14902 0 0 0 0 0.65098 0 0 0 0 0.980392 0 0 0 0.3 0\"\n+          />\n+          <feBlend mode=\"normal\" in2=\"BackgroundImageFix\" result=\"effect1_dropShadow\" />\n+          <feColorMatrix\n+            in=\"SourceAlpha\"\n+            type=\"matrix\"\n+            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n+            result=\"hardAlpha2\"\n+          />\n+          <feOffset dy=\"4\" />\n+          <feGaussianBlur stdDeviation=\"8\" />\n+          <feComposite in2=\"hardAlpha2\" operator=\"out\" />\n+          <feColorMatrix\n+            type=\"matrix\"\n+            values=\"0 0 0 0 0.14902 0 0 0 0 0.65098 0 0 0 0 0.980392 0 0 0 0.4 0\"\n+          />\n+          <feBlend mode=\"normal\" in2=\"effect1_dropShadow\" result=\"effect2_dropShadow\" />\n+          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"effect2_dropShadow\" result=\"shape\" />\n+        </filter>\n+      </defs>\n+\n+      <g filter={`url(#${glowId})`}>\n+        <path\n+          d=\"M64 64L453 333.5L64 603V483.222L273.462 333.5L64 183.778V64Z\"\n+          fill={`url(#${gradId})`}\n+        />\n+      </g>\n+    </svg>\n+  );\n+}\n+\n function FeatureCard({\n   icon: _Icon,\n   iconBgColor: _iconBgColor,\n@@ -133,6 +219,19 @@ type SectionProps = {\n   inlineHeader?: boolean;\n };\n \n+function TabFavicon({ className }: { className?: string }) {\n+  return (\n+    <span\n+      className={clsx(\n+        \"flex items-center justify-center leading-none shrink-0\",\n+        className,\n+      )}\n+    >\n+      <CmuxMarkIcon size={16} />\n+    </span>\n+  );\n+}\n+\n function Section({\n   title,\n   headerContent,\n@@ -153,6 +252,2015 @@ function Section({\n   );\n }\n \n+type MockScreenshot = {\n+  id: string;\n+  caption: string;\n+  imageUrl: string;\n+};\n+\n+const MOCK_SCREENSHOTS: MockScreenshot[] = [\n+  {\n+    id: \"1\",\n+    caption: \"Full page view of the initial setup screen showing framework preset selector, maintenance/dev scripts, and environment variables sections all expanded\",\n+    imageUrl: \"https://famous-camel-162.convex.cloud/api/storage/330d59e9-de98-463e-a6d4-a1d571497b4e\",\n+  },\n+  {\n+    id: \"2\",\n+    caption: \"Header section showing 'Configure workspace' title\",\n+    imageUrl: \"https://famous-camel-162.convex.cloud/api/storage/8733e153-847b-4700-9c85-859a09bfcf76\",\n+  },\n+  {\n+    id: \"3\",\n+    caption: \"Framework preset selector showing 'Vite' selected with autofill hint\",\n+    imageUrl: \"https://famous-camel-162.convex.cloud/api/storage/2c878414-07a2-46ad-816a-ba3eeb61d48a\",\n+  },\n+  {\n+    id: \"4\",\n+    caption: \"Maintenance and Dev Scripts section expanded showing script input fields\",\n+    imageUrl: \"https://famous-camel-162.convex.cloud/api/storage/4c392058-9bd7-4be9-8cfc-46cdf18633af\",\n+  },\n+  {\n+    id: \"5\",\n+    caption: \"Environment Variables section expanded with name/value input fields and reveal/hide toggle\",\n+    imageUrl: \"https://famous-camel-162.convex.cloud/api/storage/017f34cf-6f10-46a0-af77-06d9fef44a84\",\n+  },\n+  {\n+    id: \"6\",\n+    caption: \"Full page view of workspace configuration showing sidebar with step-by-step wizard (step 3 active) and VS Code iframe embedded on the right\",\n+    imageUrl: \"https://famous-camel-162.convex.cloud/api/storage/e6517fb1-194c-4128-9dc8-b0a7ed1ca67d\",\n+  },\n+  {\n+    id: \"7\",\n+    caption: \"Back to project setup button in the sidebar\",\n+    imageUrl: \"https://famous-camel-162.convex.cloud/api/storage/767aa6b4-b584-4f44-9bb8-508f4edb8439\",\n+  },\n+  {\n+    id: \"8\",\n+    caption: \"Sidebar header showing Configure workspace title and repository name\",\n+    imageUrl: \"https://famous-camel-162.convex.cloud/api/storage/494c475c-6fae-424b-acd5-be81cceb56a1\",\n+  },\n+  {\n+    id: \"9\",\n+    caption: \"Step 1 (Maintenance and Dev Scripts) in collapsed state with checkmark badge\",\n+    imageUrl: \"https://famous-camel-162.convex.cloud/api/storage/bccc7af4-180e-45bc-94bf-77a3def45816\",\n+  },\n+  {\n+    id: \"10\",\n+    caption: \"Step 2 (Environment Variables) in collapsed state with checkmark badge\",\n+    imageUrl: \"https://famous-camel-162.convex.cloud/api/storage/90e57824-11b9-4d79-919b-a43dfcdf16c1\",\n+  },\n+  {\n+    id: \"11\",\n+    caption: \"Step 3 (Run scripts in VS Code terminal) expanded showing instructions and command block\",\n+    imageUrl: \"https://famous-camel-162.convex.cloud/api/storage/9bc44cf5-bd16-4f37-9312-62963d10311d\",\n+  },\n+  {\n+    id: \"12\",\n+    caption: \"Command block in step 3 showing combined maintenance and dev scripts with copy button\",\n+    imageUrl: \"https://famous-camel-162.convex.cloud/api/storage/9c88db8b-9dee-4f33-8fc1-e695d3f225f1\",\n+  },\n+  {\n+    id: \"13\",\n+    caption: \"Full page view of workspace configuration at step 4 showing sidebar and browser VNC iframe on the right\",\n+    imageUrl: \"https://famous-camel-162.convex.cloud/api/storage/61dfb080-6b98-4c28-82eb-70d675daf1ef\",\n+  },\n+  {\n+    id: \"14\",\n+    caption: \"Step 4 (Configure browser) expanded showing browser setup instructions\",\n+    imageUrl: \"https://famous-camel-162.convex.cloud/api/storage/191dc959-3d69-4c53-8350-e7a986631f2b\",\n+  },\n+  {\n+    id: \"15\",\n+    caption: \"Step 3 (Run scripts) in collapsed state after moving to step 4\",\n+    imageUrl: \"https://famous-camel-162.convex.cloud/api/storage/f4efebf5-a4ce-4297-9193-7a5b86166ef6\",\n+  },\n+  {\n+    id: \"16\",\n+    caption: \"Save configuration button shown at the end of step 4\",\n+    imageUrl: \"https://famous-camel-162.convex.cloud/api/storage/cdb540a9-5e16-4d3c-bd82-96b551fc7a78\",\n+  },\n+  {\n+    id: \"17\",\n+    caption: \"Step 1 scripts section re-expanded in sidebar showing compact form with script input fields\",\n+    imageUrl: \"https://famous-camel-162.convex.cloud/api/storage/aa3f1ee7-6849-4fc0-be2e-76ecf56e2a96\",\n+  },\n+  {\n+    id: \"18\",\n+    caption: \"Step 2 environment variables section re-expanded in sidebar showing compact form with env var inputs\",\n+    imageUrl: \"https://famous-camel-162.convex.cloud/api/storage/80c2281a-e9ba-4007-9f0f-f6d44469c786\",\n+  },\n+  {\n+    id: \"19\",\n+    caption: \"Full page view showing multiple steps expanded simultaneously in the sidebar demonstrating component reuse\",\n+    imageUrl: \"https://famous-camel-162.convex.cloud/api/storage/6853f198-8c7e-4383-9f27-05856250d888\",\n+  },\n+  {\n+    id: \"20\",\n+    caption: \"Full page view after clicking back button, returning to the initial setup layout\",\n+    imageUrl: \"https://famous-camel-162.convex.cloud/api/storage/a6c469ed-ad11-4329-8d4f-88976a037a54\",\n+  },\n+  {\n+    id: \"21\",\n+    caption: \"Framework preset dropdown menu open showing all available options (Other, Next.js, Vite, Remix, Nuxt, SvelteKit, Angular, Create React App, Vue)\",\n+    imageUrl: \"https://famous-camel-162.convex.cloud/api/storage/a6c04dc1-7867-46e6-b359-e401c4acb224\",\n+  },\n+];\n+\n+// Height for both tab contents (consistent across tabs)\n+const MOCK_BROWSER_CONTENT_HEIGHT = 705; // Reduced by 15%\n+\n+function MockGitHubPRBrowser() {\n+  const [expandedImage, setExpandedImage] = useState<string | null>(null);\n+  const [activeTab, setActiveTab] = useState<\"github\" | \"workspace\">(\"github\");\n+  const [activePRTab, setActivePRTab] = useState<\"conversation\" | \"commits\" | \"checks\" | \"files\">(\"conversation\");\n+\n+  // State for collapsed git diff files (empty = all expanded by default)\n+  const [collapsedFiles, setCollapsedFiles] = useState<Set<string>>(new Set());\n+\n+  // State for resizable panels (percentages)\n+  const [leftPanelWidth, setLeftPanelWidth] = useState(55); // Workspace panel width %\n+  const [topPanelHeight, setTopPanelHeight] = useState(50); // Browser panel height %\n+\n+  // State for view mode: \"all\" shows three-panel layout, others show single panel\n+  type ViewMode = \"all\" | \"workspace\" | \"browser\" | \"gitDiff\" | \"terminals\";\n+  const [viewMode, setViewMode] = useState<ViewMode>(\"all\");\n+\n+  // State for expanded tasks in sidebar (Set allows multiple tasks to be expanded independently)\n+  const [expandedTasks, setExpandedTasks] = useState<Set<string>>(new Set([\"task-1\"]));\n+\n+  // State for which task is currently selected/active\n+  const [selectedTaskId, setSelectedTaskId] = useState<string>(\"task-1\");\n+\n+  // State for active tmux session\n+  const [activeTmuxSession, setActiveTmuxSession] = useState<number>(0);\n+\n+  // State for terminal input\n+  const [terminalInput, setTerminalInput] = useState<string>(\"\");\n+\n+  // State for reactions\n+  const [thumbsUpActive, setThumbsUpActive] = useState(false);\n+  const [rocketActive, setRocketActive] = useState(false);\n+\n+  // State for PR merged status\n+  const [isPRMerged, setIsPRMerged] = useState(false);\n+\n+  // Toggle expand/collapse for a task (only collapses, doesn't select)\n+  const toggleTaskExpanded = useCallback((taskId: string) => {\n+    setExpandedTasks(prev => {\n+      const next = new Set(prev);\n+      if (next.has(taskId)) {\n+        next.delete(taskId);\n+      } else {\n+        next.add(taskId);\n+      }\n+      return next;\n+    });\n+  }, []);\n+\n+  // Select a task: expands it, sets it as selected, and shows 3-panel view\n+  const selectTask = useCallback((taskId: string) => {\n+    setExpandedTasks(prev => {\n+      const next = new Set(prev);\n+      next.add(taskId); // Always expand, never collapse when selecting\n+      return next;\n+    });\n+    setSelectedTaskId(taskId);\n+    setViewMode(\"all\");\n+  }, []);\n+\n+  // Refs for resize handling\n+  const containerRef = useRef<HTMLDivElement>(null);\n+  const isResizingHorizontal = useRef(false);\n+  const isResizingVertical = useRef(false);\n+\n+  const toggleFileCollapse = useCallback((fileId: string) => {\n+    setCollapsedFiles(prev => {\n+      const next = new Set(prev);\n+      if (next.has(fileId)) {\n+        next.delete(fileId);\n+      } else {\n+        next.add(fileId);\n+      }\n+      return next;\n+    });\n+  }, []);\n+\n+  const handleHorizontalResize = useCallback((e: MouseEvent) => {\n+    if (!isResizingHorizontal.current || !containerRef.current) return;\n+    const rect = containerRef.current.getBoundingClientRect();\n+    // Account for sidebar width (280px)\n+    const sidebarWidth = 280;\n+    const availableWidth = rect.width - sidebarWidth;\n+    const relativeX = e.clientX - rect.left - sidebarWidth;\n+    const newWidth = Math.min(Math.max((relativeX / availableWidth) * 100, 30), 70);\n+    setLeftPanelWidth(newWidth);\n+  }, []);\n+\n+  const handleVerticalResize = useCallback((e: MouseEvent) => {\n+    if (!isResizingVertical.current || !containerRef.current) return;\n+    const rect = containerRef.current.getBoundingClientRect();\n+    const relativeY = e.clientY - rect.top;\n+    const newHeight = Math.min(Math.max((relativeY / rect.height) * 100, 25), 75);\n+    setTopPanelHeight(newHeight);\n+  }, []);\n+\n+  const stopResizing = useCallback(() => {\n+    isResizingHorizontal.current = false;\n+    isResizingVertical.current = false;\n+    document.body.style.cursor = \"\";\n+    document.body.classList.remove(\"select-none\");\n+  }, []);\n+\n+  useEffect(() => {\n+    const handleMouseMove = (e: MouseEvent) => {\n+      if (isResizingHorizontal.current) {\n+        handleHorizontalResize(e);\n+      } else if (isResizingVertical.current) {\n+        handleVerticalResize(e);\n+      }\n+    };\n+\n+    const handleMouseUp = () => {\n+      stopResizing();\n+    };\n+\n+    window.addEventListener(\"mousemove\", handleMouseMove);\n+    window.addEventListener(\"mouseup\", handleMouseUp);\n+\n+    return () => {\n+      window.removeEventListener(\"mousemove\", handleMouseMove);\n+      window.removeEventListener(\"mouseup\", handleMouseUp);\n+    };\n+  }, [handleHorizontalResize, handleVerticalResize, stopResizing]);\n+\n+  const startHorizontalResize = useCallback((e: React.MouseEvent) => {\n+    e.preventDefault();\n+    isResizingHorizontal.current = true;\n+    document.body.style.cursor = \"col-resize\";\n+    document.body.classList.add(\"select-none\");\n+  }, []);\n+\n+  const startVerticalResize = useCallback((e: React.MouseEvent) => {\n+    e.preventDefault();\n+    isResizingVertical.current = true;\n+    document.body.style.cursor = \"row-resize\";\n+    document.body.classList.add(\"select-none\");\n+  }, []);\n+\n+  return (\n+    <div className=\"pt-12 w-screen relative left-1/2 -translate-x-1/2 px-4\">\n+      {/* Browser window frame - wider than container */}\n+      <div className=\"rounded-xl border border-neutral-700 bg-[#202124] overflow-hidden shadow-2xl max-w-[1190px] mx-auto\">\n+        {/* Chrome-style tab bar */}\n+        <div className=\"flex items-end h-10 bg-[#202124] pt-2 px-2\">\n+          {/* Traffic lights */}\n+          <div className=\"flex items-center gap-2 px-2 pb-2\">\n+            <div className=\"w-3 h-3 rounded-full bg-[#ff5f57]\" />\n+            <div className=\"w-3 h-3 rounded-full bg-[#febc2e]\" />\n+            <div className=\"w-3 h-3 rounded-full bg-[#28c840]\" />\n+          </div>\n+\n+          {/* Chrome-style tabs */}\n+          <div className=\"flex items-end ml-2 -mb-px\">\n+            {/* GitHub tab */}\n+            <button\n+              onClick={() => setActiveTab(\"github\")}\n+              className={clsx(\n+                \"relative flex items-center gap-2 px-4 py-2 text-xs font-medium rounded-t-lg transition-colors min-w-[160px]\",\n+                activeTab === \"github\"\n+                  ? \"bg-[#292a2d] text-white\"\n+                  : \"bg-[#1a1a1d] text-neutral-400 hover:bg-[#242528] hover:text-neutral-300\"\n+              )}\n+            >\n+              <svg className=\"h-4 w-4 shrink-0\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+                <path d=\"M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z\"/>\n+              </svg>\n+              <span className=\"truncate\">GitHub</span>\n+              <svg className=\"h-3.5 w-3.5 ml-auto shrink-0 text-neutral-500 hover:text-white\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+                <path d=\"M3.72 3.72a.75.75 0 0 1 1.06 0L8 6.94l3.22-3.22a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l3.22 3.22a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-3.22 3.22a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L6.94 8 3.72 4.78a.75.75 0 0 1 0-1.06Z\"/>\n+              </svg>\n+              {activeTab === \"github\" && (\n+                <div className=\"absolute bottom-0 left-0 right-0 h-px bg-[#292a2d]\" />\n+              )}\n+            </button>\n+\n+            {/* Workspace tab */}\n+            <button\n+              onClick={() => setActiveTab(\"workspace\")}\n+              className={clsx(\n+                \"relative flex items-center gap-1 px-4 py-2 text-xs font-medium rounded-t-lg transition-colors min-w-[160px] ml-1\",\n+                activeTab === \"workspace\"\n+                  ? \"bg-[#292a2d] text-white\"\n+                  : \"bg-[#1a1a1d] text-neutral-400 hover:bg-[#242528] hover:text-neutral-300\"\n+              )}\n+            >\n+              <TabFavicon className=\"shrink-0\" />\n+              <span className=\"truncate\">cmux</span>\n+              <svg className=\"h-3.5 w-3.5 ml-auto shrink-0 text-neutral-500 hover:text-white\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+                <path d=\"M3.72 3.72a.75.75 0 0 1 1.06 0L8 6.94l3.22-3.22a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l3.22 3.22a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-3.22 3.22a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L6.94 8 3.72 4.78a.75.75 0 0 1 0-1.06Z\"/>\n+              </svg>\n+              {activeTab === \"workspace\" && (\n+                <div className=\"absolute bottom-0 left-0 right-0 h-px bg-[#292a2d]\" />\n+              )}\n+            </button>\n+\n+            {/* New tab button */}\n+            {/* <button className=\"flex items-center justify-center w-8 h-8 text-neutral-500 hover:text-neutral-300 hover:bg-[#242528] rounded-lg ml-1 mb-0.5\">\n+              <svg className=\"h-4 w-4\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+                <path d=\"M8 1a.75.75 0 0 1 .75.75v5.5h5.5a.75.75 0 0 1 0 1.5h-5.5v5.5a.75.75 0 0 1-1.5 0v-5.5h-5.5a.75.75 0 0 1 0-1.5h5.5v-5.5A.75.75 0 0 1 8 1z\"/>\n+              </svg>\n+            </button> */}\n+          </div>\n+        </div>\n+\n+        {/* URL bar */}\n+        <div className=\"flex items-center gap-2 h-10 px-3 bg-[#292a2d] border-b border-neutral-700\">\n+          <button className=\"p-1.5 text-neutral-400 hover:text-white hover:bg-neutral-600 rounded\">\n+            <svg className=\"h-4 w-4\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+              <path d=\"M7.78 12.53a.75.75 0 0 1-1.06 0L2.47 8.28a.75.75 0 0 1 0-1.06l4.25-4.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042L4.81 7h7.44a.75.75 0 0 1 0 1.5H4.81l2.97 2.97a.75.75 0 0 1 0 1.06Z\"/>\n+            </svg>\n+          </button>\n+          <button className=\"p-1.5 text-neutral-500 hover:text-white hover:bg-neutral-600 rounded\">\n+            <svg className=\"h-4 w-4\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+              <path d=\"M8.22 2.97a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l2.97-2.97H3.75a.75.75 0 0 1 0-1.5h7.44L8.22 4.03a.75.75 0 0 1 0-1.06Z\"/>\n+            </svg>\n+          </button>\n+          <button className=\"p-1.5 text-neutral-400 hover:text-white hover:bg-neutral-600 rounded\">\n+            <svg className=\"h-4 w-4\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+              <path d=\"M1.705 8.005a.75.75 0 0 1 .834.656 5.5 5.5 0 0 0 9.592 2.97l-1.204-1.204a.25.25 0 0 1 .177-.427h3.646a.25.25 0 0 1 .25.25v3.646a.25.25 0 0 1-.427.177l-1.38-1.38A7.002 7.002 0 0 1 1.05 8.84a.75.75 0 0 1 .656-.834ZM8 2.5a5.487 5.487 0 0 0-4.131 1.869l1.204 1.204A.25.25 0 0 1 4.896 6H1.25A.25.25 0 0 1 1 5.75V2.104a.25.25 0 0 1 .427-.177l1.38 1.38A7.002 7.002 0 0 1 14.95 7.16a.75.75 0 0 1-1.49.178A5.5 5.5 0 0 0 8 2.5Z\"/>\n+            </svg>\n+          </button>\n+          <div className=\"flex-1 flex items-center gap-2 px-3 py-1.5 bg-[#202124] rounded-full text-sm\">\n+            <svg className=\"h-3.5 w-3.5 text-neutral-500 shrink-0\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n+              <rect x=\"3\" y=\"11\" width=\"18\" height=\"11\" rx=\"2\" ry=\"2\" />\n+              <path d=\"M7 11V7a5 5 0 0 1 10 0v4\" />\n+            </svg>\n+            <span className=\"text-neutral-300 truncate\">\n+              {activeTab === \"github\" ? \"github.com/manaflow-ai/cmux/pull/1124\" : \"cmux.sh/workspace/reuse-preview-config\"}\n+            </span>\n+          </div>\n+        </div>\n+\n+        {/* Content area - conditionally render based on active tab */}\n+        {activeTab === \"github\" ? (\n+          <div className=\"bg-[#0d1117] flex flex-col\" style={{ height: MOCK_BROWSER_CONTENT_HEIGHT }}>\n+\n+          {/* GitHub header */}\n+          <div className=\"bg-[#010409] border-b border-[#30363d] px-4 py-3 shrink-0\">\n+            <div className=\"flex items-center gap-2 text-sm\">\n+              <svg className=\"h-4 w-4 text-[#7d8590]\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+                <path d=\"M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z\" />\n+              </svg>\n+              <a href=\"https://www.ycombinator.com/companies/manaflow\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-[#e6edf3] font-semibold hover:underline cursor-pointer\">manaflow-ai</a>\n+              <span className=\"text-[#7d8590]\">/</span>\n+              <a href=\"https://github.com/manaflow-ai/cmux\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-[#2f81f7] font-semibold hover:underline cursor-pointer\">cmux</a>\n+            </div>\n+          </div>\n+\n+          {/* PR header */}\n+          <div className=\"bg-[#0d1117] border-b border-[#30363d] px-6 py-4 shrink-0\">\n+            <div className=\"flex items-start gap-2\">\n+              <h1 className=\"text-xl font-semibold text-[#e6edf3]\">\n+                reuse preview config component for step by step re 6k4tq\n+                <span className=\"text-[#7d8590] font-normal ml-2\">#1124</span>\n+              </h1>\n+            </div>\n+            <div className=\"flex items-center gap-2 mt-2\">\n+              <span className={`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium ${isPRMerged ? \"bg-[#8957e5]\" : \"bg-[#238636]\"} text-white`}>\n+                <svg className=\"h-3 w-3\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+                  {isPRMerged ? (\n+                    <path d=\"M5.45 5.154A4.25 4.25 0 0 0 9.25 7.5h1.378a2.251 2.251 0 1 1 0 1.5H9.25A5.734 5.734 0 0 1 5 7.123v3.505a2.25 2.25 0 1 1-1.5 0V5.372a2.25 2.25 0 1 1 1.95-.218ZM4.25 13.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm8.5-4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM5 3.25a.75.75 0 1 0 0 .005V3.25Z\" />\n+                  ) : (\n+                    <path d=\"M1.5 3.25a2.25 2.25 0 1 1 3 2.122v5.256a2.251 2.251 0 1 1-1.5 0V5.372A2.25 2.25 0 0 1 1.5 3.25Zm5.677-.177L9.573.677A.25.25 0 0 1 10 .854V2.5h1A2.5 2.5 0 0 1 13.5 5v5.628a2.251 2.251 0 1 1-1.5 0V5a1 1 0 0 0-1-1h-1v1.646a.25.25 0 0 1-.427.177L7.177 3.427a.25.25 0 0 1 0-.354ZM3.75 2.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm0 9.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm8.25.75a.75.75 0 1 0 1.5 0 .75.75 0 0 0-1.5 0Z\" />\n+                  )}\n+                </svg>\n+                {isPRMerged ? \"Merged\" : \"Open\"}\n+              </span>\n+              <span className=\"text-sm text-[#7d8590]\">\n+                <a href=\"https://x.com/austinywang\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-[#e6edf3] font-medium hover:text-[#2f81f7] cursor-pointer\">austinywang</a>\n+                {isPRMerged ? \" merged 14 commits into \" : \" wants to merge 14 commits into \"}\n+                <span className=\"px-1.5 py-0.5 rounded-md bg-[#388bfd26] text-[#2f81f7] text-xs font-mono\">main</span>\n+                {\" from \"}\n+                <span className=\"px-1.5 py-0.5 rounded-md bg-[#388bfd26] text-[#2f81f7] text-xs font-mono\">cmux/reuse-preview...</span>\n+              </span>\n+            </div>\n+          </div>\n+\n+          {/* PR tabs */}\n+          <div className=\"bg-[#0d1117] border-b border-[#30363d] px-6 shrink-0\">\n+            <nav className=\"flex gap-4\">\n+              <button\n+                onClick={() => setActivePRTab(\"conversation\")}\n+                className={clsx(\n+                  \"flex items-center gap-2 px-2 py-3 text-sm -mb-px\",\n+                  activePRTab === \"conversation\"\n+                    ? \"font-medium text-[#e6edf3] border-b-2 border-[#f78166]\"\n+                    : \"text-[#7d8590] hover:text-[#e6edf3]\"\n+                )}\n+              >\n+                <svg className=\"h-4 w-4\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+                  <path d=\"M1.5 2.75a.25.25 0 0 1 .25-.25h8.5a.25.25 0 0 1 .25.25v5.5a.25.25 0 0 1-.25.25h-3.5a.75.75 0 0 0-.53.22L3.5 11.44V9.25a.75.75 0 0 0-.75-.75h-1a.25.25 0 0 1-.25-.25Zm-1.5 0a1.75 1.75 0 0 1 1.75-1.75h8.5A1.75 1.75 0 0 1 12 2.75v5.5A1.75 1.75 0 0 1 10.25 10H7.061l-2.574 2.573A1.458 1.458 0 0 1 2 11.543V10h-.25A1.75 1.75 0 0 1 0 8.25Zm14.5 2a.25.25 0 0 0-.25-.25h-.5a.75.75 0 0 1 0-1.5h.5A1.75 1.75 0 0 1 16 4.75v5.5A1.75 1.75 0 0 1 14.25 12H14v1.543a1.458 1.458 0 0 1-2.487 1.03L9.22 12.28a.749.749 0 0 1 .326-1.275.749.749 0 0 1 .734.215l2.22 2.22v-2.19a.75.75 0 0 1 .75-.75h1a.25.25 0 0 0 .25-.25Z\" />\n+                </svg>\n+                Conversation\n+                <span className=\"px-1.5 py-0.5 rounded-full bg-[#30363d] text-xs text-[#e6edf3]\">2</span>\n+              </button>\n+              <button\n+                onClick={() => setActivePRTab(\"commits\")}\n+                className={clsx(\n+                  \"flex items-center gap-2 px-2 py-3 text-sm -mb-px\",\n+                  activePRTab === \"commits\"\n+                    ? \"font-medium text-[#e6edf3] border-b-2 border-[#f78166]\"\n+                    : \"text-[#7d8590] hover:text-[#e6edf3]\"\n+                )}\n+              >\n+                <svg className=\"h-4 w-4\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+                  <path d=\"M11.93 8.5a4.002 4.002 0 0 1-7.86 0H.75a.75.75 0 0 1 0-1.5h3.32a4.002 4.002 0 0 1 7.86 0h3.32a.75.75 0 0 1 0 1.5Zm-1.43-.75a2.5 2.5 0 1 0-5 0 2.5 2.5 0 0 0 5 0Z\" />\n+                </svg>\n+                Commits\n+                <span className=\"px-1.5 py-0.5 rounded-full bg-[#30363d] text-xs text-[#e6edf3]\">14</span>\n+              </button>\n+              <button\n+                onClick={() => setActivePRTab(\"checks\")}\n+                className={clsx(\n+                  \"flex items-center gap-2 px-2 py-3 text-sm -mb-px\",\n+                  activePRTab === \"checks\"\n+                    ? \"font-medium text-[#e6edf3] border-b-2 border-[#f78166]\"\n+                    : \"text-[#7d8590] hover:text-[#e6edf3]\"\n+                )}\n+              >\n+                <svg className=\"h-4 w-4\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+                  <path d=\"M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.752 1.752 0 0 1 1 7.775Zm1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z\" />\n+                </svg>\n+                Checks\n+                <span className=\"px-1.5 py-0.5 rounded-full bg-[#30363d] text-xs text-[#e6edf3]\">4</span>\n+              </button>\n+              <button\n+                onClick={() => setActivePRTab(\"files\")}\n+                className={clsx(\n+                  \"flex items-center gap-2 px-2 py-3 text-sm -mb-px\",\n+                  activePRTab === \"files\"\n+                    ? \"font-medium text-[#e6edf3] border-b-2 border-[#f78166]\"\n+                    : \"text-[#7d8590] hover:text-[#e6edf3]\"\n+                )}\n+              >\n+                <svg className=\"h-4 w-4\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+                  <path d=\"M2 1.75C2 .784 2.784 0 3.75 0h6.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v9.586A1.75 1.75 0 0 1 13.25 16h-9.5A1.75 1.75 0 0 1 2 14.25Zm1.75-.25a.25.25 0 0 0-.25.25v12.5c0 .138.112.25.25.25h9.5a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 9 4.25V1.5Zm6.75.062V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914-.013-.011Z\" />\n+                </svg>\n+                Files changed\n+                <span className=\"px-1.5 py-0.5 rounded-full bg-[#30363d] text-xs text-[#e6edf3]\">2</span>\n+              </button>\n+            </nav>\n+          </div>\n+\n+          {/* GitHub PR content - scrollable */}\n+          <div className=\"bg-[#0d1117] overflow-y-auto flex-1 min-h-0\" style={{ scrollbarWidth: \"thin\", scrollbarColor: \"#30363d #0d1117\" }}>\n+            {activePRTab === \"conversation\" && (\n+              <div className=\"px-6 py-4 space-y-4\">\n+                {/* User's PR description comment */}\n+                <div className=\"flex gap-3\">\n+                  <div className=\"shrink-0 relative\">\n+                    <Image\n+                      src=\"https://avatars.githubusercontent.com/u/38676809?v=4\"\n+                      alt=\"austinywang\"\n+                      width={40}\n+                      height={40}\n+                      className=\"rounded-full\"\n+                      unoptimized\n+                    />\n+                    {/* Timeline connector line */}\n+                    <div className=\"absolute top-10 left-1/2 -translate-x-1/2 w-0.5 h-[calc(100%+16px)] bg-[#30363d]\" />\n+                  </div>\n+                  <div className=\"flex-1 min-w-0\">\n+                    <div className=\"rounded-md border border-[#30363d] overflow-hidden\">\n+                      <div className=\"flex items-center gap-2 px-4 py-2 bg-[#161b22] border-b border-[#30363d]\">\n+                        <a href=\"https://x.com/austinywang\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"font-semibold text-sm text-[#e6edf3] hover:text-[#2f81f7] cursor-pointer\">austinywang</a>\n+                        <span className=\"text-sm text-[#7d8590]\">opened this pull request yesterday</span>\n+                        <span className=\"ml-auto px-1.5 py-0.5 rounded-md text-xs font-medium bg-[#388bfd26] text-[#2f81f7] border border-[#388bfd66]\">\n+                          Author\n+                        </span>\n+                      </div>\n+                      <div className=\"p-4 bg-[#0d1117]\">\n+                        <h3 className=\"text-base font-semibold text-[#e6edf3] mb-2\">Summary</h3>\n+                        <p className=\"text-sm text-[#e6edf3] mb-3\">\n+                          This PR refactors the preview config component to be reusable in the step-by-step wizard flow. The same form components are now shared between the initial setup page and the sidebar wizard. Feel free to click around and explore. There may be some Easter eggs &#123;-:\n+                        </p>\n+                        <h3 className=\"text-base font-semibold text-[#e6edf3] mb-2\">Changes</h3>\n+                        <ul className=\"text-sm text-[#e6edf3] list-disc list-inside space-y-1\">\n+                          <li>Extract shared form components</li>\n+                          <li>Add collapsible sections for wizard steps</li>\n+                          <li>Sync state between views</li>\n+                        </ul>\n+                      </div>\n+                    </div>\n+                  </div>\n+                </div>\n+\n+                {/* Bot comment */}\n+                <div className=\"flex gap-3\">\n+                  <div className=\"shrink-0 w-10 h-10 rounded-full bg-[#0d1117] border border-[#30363d] flex items-center justify-center relative z-10\">\n+                    <Image\n+                    src=\"https://avatars.githubusercontent.com/in/1690796?s=80&v=4\"\n+                    alt=\"cmux-agent avatar\"\n+                    width={40}\n+                    height={40}\n+                    className=\"rounded-full\"\n+                    unoptimized\n+                  />\n+                  </div>\n+\n+                  <div className=\"flex-1 min-w-0\">\n+                    <div className=\"rounded-md border border-[#30363d] overflow-hidden\">\n+                      <div className=\"flex items-center gap-2 px-4 py-2 bg-[#161b22] border-b border-[#30363d]\">\n+                        <button onClick={() => setActiveTab(\"workspace\")} className=\"font-semibold text-sm text-[#e6edf3] hover:text-[#2f81f7] cursor-pointer\">cmux-agent</button>\n+                        <span className=\"px-1.5 py-0.5 rounded-md text-xs font-medium bg-[#6e40c926] text-[#a371f7] border border-[#6e40c966]\">\n+                          bot\n+                        </span>\n+                        <span className=\"text-sm text-[#7d8590]\">commented yesterday</span>\n+                      </div>\n+\n+                      <div className=\"p-4 bg-[#0d1117]\">\n+                        <h2 className=\"text-xl font-semibold text-[#e6edf3] pb-4 border-b border-[#30363d] mb-4\">\n+                          Preview Screenshots\n+                        </h2>\n+\n+                        <p className=\"text-sm text-[#e6edf3] mb-4\">\n+                          <button onClick={() => { setActiveTab(\"workspace\"); setViewMode(\"all\"); }} className=\"text-[#2f81f7] hover:underline cursor-pointer\">Open Workspace (1 hr expiry)</button>\n+                          <span className=\"text-[#7d8590]\"> · </span>\n+                          <button onClick={() => { setActiveTab(\"workspace\"); setViewMode(\"browser\"); }} className=\"text-[#2f81f7] hover:underline cursor-pointer\">Open Dev Browser (1 hr expiry)</button>\n+                          <span className=\"text-[#7d8590]\"> · </span>\n+                          <a href=\"https://0github.com/\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-[#2f81f7] hover:underline cursor-pointer\">Open Diff Heatmap</a>\n+                        </p>\n+\n+                        <p className=\"text-sm text-[#e6edf3] mb-6\">\n+                          Captured {MOCK_SCREENSHOTS.length} screenshots for commit{\" \"}\n+                          <code className=\"px-1.5 py-0.5 rounded-md bg-[#6e768166] text-[#e6edf3] font-mono text-xs\">\n+                            ee59b00\n+                          </code>{\" \"}\n+                          (2025-12-03 06:56:40.263 UTC).\n+                        </p>\n+\n+                        <div className=\"space-y-6\">\n+                          {MOCK_SCREENSHOTS.map((screenshot) => (\n+                            <div key={screenshot.id}>\n+                              <p className=\"text-sm text-[#e6edf3] mb-2\">\n+                                <strong>{screenshot.caption}</strong>\n+                              </p>\n+                              <button\n+                                onClick={() => setExpandedImage(expandedImage === screenshot.id ? null : screenshot.id)}\n+                                className=\"block rounded-md border border-[#30363d] overflow-hidden hover:border-[#8b949e] transition-colors\"\n+                              >\n+                                <div className={clsx(\n+                                  \"relative overflow-hidden transition-all duration-300\",\n+                                  expandedImage === screenshot.id ? \"max-h-[600px]\" : \"max-h-[300px]\"\n+                                )}>\n+                                  <Image\n+                                    src={screenshot.imageUrl}\n+                                    alt={screenshot.caption}\n+                                    width={800}\n+                                    height={450}\n+                                    unoptimized\n+                                    className=\"w-full h-auto\"\n+                                  />\n+                                </div>\n+                              </button>\n+                            </div>\n+                          ))}\n+                        </div>\n+\n+                        <hr className=\"border-[#30363d] my-6\" />\n+\n+                        <p className=\"text-sm text-[#7d8590] italic\">\n+                          Generated by{\" \"}\n+                          <button onClick={() => { setActiveTab(\"workspace\"); setViewMode(\"all\"); }} className=\"text-[#2f81f7] hover:underline cursor-pointer\">cmux</button>{\" \"}\n+                          preview system\n+                        </p>\n+                      </div>\n+                    </div>\n+\n+                    <div className=\"flex items-center gap-1 mt-2\">\n+                      <button\n+                        onClick={() => setThumbsUpActive(!thumbsUpActive)}\n+                        className={`inline-flex items-center gap-1 px-2 py-0.5 rounded-full border text-xs transition-colors ${\n+                          thumbsUpActive\n+                            ? \"border-[#2f81f7] bg-[#388bfd1a] text-[#2f81f7]\"\n+                            : \"border-[#30363d] bg-[#21262d] hover:bg-[#30363d]\"\n+                        }`}\n+                      >\n+                        <span>👍</span>\n+                        <span className={thumbsUpActive ? \"text-[#2f81f7]\" : \"text-[#7d8590]\"}>{thumbsUpActive ? 3 : 2}</span>\n+                      </button>\n+                      <button\n+                        onClick={() => setRocketActive(!rocketActive)}\n+                        className={`inline-flex items-center gap-1 px-2 py-0.5 rounded-full border text-xs transition-colors ${\n+                          rocketActive\n+                            ? \"border-[#2f81f7] bg-[#388bfd1a] text-[#2f81f7]\"\n+                            : \"border-[#30363d] bg-[#21262d] hover:bg-[#30363d]\"\n+                        }`}\n+                      >\n+                        <span>🚀</span>\n+                        <span className={rocketActive ? \"text-[#2f81f7]\" : \"text-[#7d8590]\"}>{rocketActive ? 2 : 1}</span>\n+                      </button>\n+                    </div>\n+                  </div>\n+                </div>\n+\n+                {/* Merge button section - GitHub style */}\n+                {!isPRMerged && (\n+                  <div className=\"mt-4 flex gap-4\">\n+                    {/* PR merge icon */}\n+                    <div className=\"shrink-0 w-10 h-10 rounded-lg bg-[#238636] flex items-center justify-center\">\n+                      <svg className=\"h-5 w-5 text-white\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+                        <path d=\"M5.45 5.154A4.25 4.25 0 0 0 9.25 7.5h1.378a2.251 2.251 0 1 1 0 1.5H9.25A5.734 5.734 0 0 1 5 7.123v3.505a2.25 2.25 0 1 1-1.5 0V5.372a2.25 2.25 0 1 1 1.95-.218ZM4.25 13.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm8.5-4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM5 3.25a.75.75 0 1 0 0 .005V3.25Z\" />\n+                      </svg>\n+                    </div>\n+                    {/* Merge card */}\n+                    <div className=\"flex-1 rounded-md border border-[#238636] overflow-hidden\">\n+                      {/* All checks passed */}\n+                      <div className=\"px-4 py-3 border-b border-[#30363d] flex items-center justify-between\">\n+                        <div className=\"flex items-center gap-3\">\n+                          <svg className=\"h-5 w-5 text-[#238636]\" viewBox=\"0 0 16 16\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\">\n+                            <circle cx=\"8\" cy=\"8\" r=\"6\" />\n+                            <path d=\"M5 8l2 2 4-4\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\n+                          </svg>\n+                          <div>\n+                            <p className=\"text-sm font-medium text-[#e6edf3]\">All checks have passed</p>\n+                            <p className=\"text-xs text-[#7d8590]\">1 neutral, 5 successful checks</p>\n+                          </div>\n+                        </div>\n+                        <ChevronDown className=\"h-4 w-4 text-[#7d8590]\" />\n+                      </div>\n+                      {/* No conflicts */}\n+                      <div className=\"px-4 py-3 border-b border-[#30363d] flex items-center gap-3\">\n+                        <svg className=\"h-5 w-5 text-[#238636]\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+                          <path d=\"M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z\" />\n+                        </svg>\n+                        <div>\n+                          <p className=\"text-sm font-medium text-[#e6edf3]\">No conflicts with base branch</p>\n+                          <p className=\"text-xs text-[#7d8590]\">Merging can be performed automatically.</p>\n+                        </div>\n+                      </div>\n+                      {/* Merge button row */}\n+                      <div className=\"px-4 py-3 bg-[#161b22] flex items-center gap-3\">\n+                        <div className=\"flex\">\n+                          <button\n+                            onClick={() => setIsPRMerged(true)}\n+                            className=\"px-4 py-1.5 bg-[#238636] hover:bg-[#2ea043] text-white text-sm font-medium rounded-l-md transition-colors\"\n+                          >\n+                            Merge pull request\n+                          </button>\n+                          <button className=\"px-2 py-1.5 bg-[#238636] hover:bg-[#2ea043] text-white border-l border-[#2ea043] rounded-r-md transition-colors\">\n+                            <ChevronDown className=\"h-4 w-4\" />\n+                          </button>\n+                        </div>\n+                        <span className=\"text-xs text-[#7d8590]\">\n+                          You can also merge this with the command line.{\" \"}\n+                          <span className=\"text-[#2f81f7] hover:underline cursor-pointer\">View command line instructions.</span>\n+                        </span>\n+                      </div>\n+                    </div>\n+                  </div>\n+                )}\n+\n+                {isPRMerged && (\n+                  <div className=\"mt-4 flex gap-4\">\n+                    {/* Purple merge icon */}\n+                    <div className=\"shrink-0 w-10 h-10 rounded-full bg-[#8957e5] flex items-center justify-center\">\n+                      <svg className=\"h-5 w-5 text-white\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+                        <path d=\"M5.45 5.154A4.25 4.25 0 0 0 9.25 7.5h1.378a2.251 2.251 0 1 1 0 1.5H9.25A5.734 5.734 0 0 1 5 7.123v3.505a2.25 2.25 0 1 1-1.5 0V5.372a2.25 2.25 0 1 1 1.95-.218ZM4.25 13.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm8.5-4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM5 3.25a.75.75 0 1 0 0 .005V3.25Z\" />\n+                      </svg>\n+                    </div>\n+                    {/* Merged card */}\n+                    <div className=\"flex-1 rounded-md border border-[#8957e5] bg-[#0d1117] p-4\">\n+                      <p className=\"text-sm font-semibold text-[#e6edf3]\">Pull request successfully merged and closed</p>\n+                      <p className=\"text-sm text-[#7d8590] mt-1\">You&apos;re all set — the branch has been merged.</p>\n+                    </div>\n+                  </div>\n+                )}\n+              </div>\n+            )}\n+\n+            {activePRTab === \"commits\" && (\n+              <div className=\"px-6 py-4\">\n+                <div className=\"space-y-0\">\n+                  {/* Commit group header */}\n+                  <div className=\"flex items-center gap-2 py-2 text-sm text-[#7d8590]\">\n+                    <svg className=\"h-4 w-4\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+                      <path d=\"M11.93 8.5a4.002 4.002 0 0 1-7.86 0H.75a.75.75 0 0 1 0-1.5h3.32a4.002 4.002 0 0 1 7.86 0h3.32a.75.75 0 0 1 0 1.5Zm-1.43-.75a2.5 2.5 0 1 0-5 0 2.5 2.5 0 0 0 5 0Z\" />\n+                    </svg>\n+                    <span>Commits on Dec 2, 2025</span>\n+                  </div>\n+\n+                  {/* Commits list */}\n+                  {[\n+                    { sha: \"ee59b00\", msg: \"fix: reuse preview config component in wizard\", time: \"yesterday\" },\n+                    { sha: \"a1b2c3d\", msg: \"refactor: extract shared form components\", time: \"yesterday\" },\n+                    { sha: \"d4e5f6g\", msg: \"feat: add collapsible sections for wizard steps\", time: \"yesterday\" },\n+                    { sha: \"h7i8j9k\", msg: \"fix: sync state between initial and wizard views\", time: \"yesterday\" },\n+                    { sha: \"l0m1n2o\", msg: \"chore: clean up unused imports\", time: \"yesterday\" },\n+                    { sha: \"p3q4r5s\", msg: \"style: improve spacing in wizard sidebar\", time: \"2 days ago\" },\n+                    { sha: \"t6u7v8w\", msg: \"fix: handle edge case in env var parsing\", time: \"2 days ago\" },\n+                    { sha: \"x9y0z1a\", msg: \"feat: add framework preset autofill\", time: \"2 days ago\" },\n+                    { sha: \"b2c3d4e\", msg: \"refactor: consolidate script input components\", time: \"2 days ago\" },\n+                    { sha: \"f5g6h7i\", msg: \"fix: wizard step navigation\", time: \"2 days ago\" },\n+                    { sha: \"j8k9l0m\", msg: \"chore: update dependencies\", time: \"3 days ago\" },\n+                    { sha: \"n1o2p3q\", msg: \"feat: add save configuration button\", time: \"3 days ago\" },\n+                    { sha: \"r4s5t6u\", msg: \"style: dark mode improvements\", time: \"3 days ago\" },\n+                    { sha: \"v7w8x9y\", msg: \"initial: setup preview config wizard\", time: \"3 days ago\" },\n+                  ].map((commit) => (\n+                    <div key={commit.sha} className=\"flex items-center gap-3 py-2 border-t border-[#21262d] hover:bg-[#161b22] -mx-2 px-2 rounded\">\n+                      <Image\n+                        src=\"https://avatars.githubusercontent.com/u/38676809?v=4\"\n+                        alt=\"austinywang\"\n+                        width={24}\n+                        height={24}\n+                        className=\"rounded-full\"\n+                        unoptimized\n+                      />\n+                      <div className=\"flex-1 min-w-0\">\n+                        <span className=\"text-sm text-[#e6edf3] hover:text-[#2f81f7] cursor-pointer truncate block\">{commit.msg}</span>\n+                      </div>\n+                      <code className=\"text-xs text-[#2f81f7] font-mono hover:underline cursor-pointer\">{commit.sha}</code>\n+                      <span className=\"text-xs text-[#7d8590] shrink-0\">{commit.time}</span>\n+                    </div>\n+                  ))}\n+                </div>\n+              </div>\n+            )}\n+\n+            {activePRTab === \"checks\" && (\n+              <div className=\"px-6 py-4\">\n+                {/* All checks passed banner */}\n+                <div className=\"flex items-center gap-3 p-4 rounded-md border border-[#238636] bg-[#2ea04326] mb-4\">\n+                  <svg className=\"h-6 w-6 text-[#3fb950]\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+                    <path d=\"M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16Zm3.78-9.72a.751.751 0 0 0-.018-1.042.751.751 0 0 0-1.042-.018L6.75 9.19 5.28 7.72a.751.751 0 0 0-1.042.018.751.751 0 0 0-.018 1.042l2 2a.75.75 0 0 0 1.06 0Z\" />\n+                  </svg>\n+                  <div>\n+                    <div className=\"text-sm font-semibold text-[#e6edf3]\">All checks have passed</div>\n+                    <div className=\"text-xs text-[#7d8590]\">4 successful checks</div>\n+                  </div>\n+                </div>\n+\n+                {/* Checks list */}\n+                <div className=\"border border-[#30363d] rounded-md overflow-hidden\">\n+                  {[\n+                    { name: \"build\", desc: \"Build succeeded\", time: \"45s\" },\n+                    { name: \"lint\", desc: \"ESLint passed\", time: \"12s\" },\n+                    { name: \"typecheck\", desc: \"TypeScript compilation succeeded\", time: \"28s\" },\n+                    { name: \"test\", desc: \"All tests passed (142 tests)\", time: \"1m 23s\" },\n+                  ].map((check, i) => (\n+                    <div key={check.name} className={clsx(\"flex items-center gap-3 px-4 py-3\", i > 0 && \"border-t border-[#21262d]\")}>\n+                      <svg className=\"h-4 w-4 text-[#3fb950]\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+                        <path d=\"M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16Zm3.78-9.72a.751.751 0 0 0-.018-1.042.751.751 0 0 0-1.042-.018L6.75 9.19 5.28 7.72a.751.751 0 0 0-1.042.018.751.751 0 0 0-.018 1.042l2 2a.75.75 0 0 0 1.06 0Z\" />\n+                      </svg>\n+                      <div className=\"flex-1\">\n+                        <div className=\"text-sm text-[#e6edf3]\">{check.name}</div>\n+                        <div className=\"text-xs text-[#7d8590]\">{check.desc}</div>\n+                      </div>\n+                      <span className=\"text-xs text-[#7d8590]\">{check.time}</span>\n+                    </div>\n+                  ))}\n+                </div>\n+              </div>\n+            )}\n+\n+            {activePRTab === \"files\" && (\n+              <div className=\"px-6 py-4\">\n+                {/* Files changed header */}\n+                <div className=\"flex items-center gap-4 pb-4 border-b border-[#30363d] mb-4\">\n+                  <span className=\"text-sm text-[#e6edf3]\">\n+                    Showing <strong>2 changed files</strong> with <span className=\"text-[#3fb950]\">73 additions</span> and <span className=\"text-[#f85149]\">16 deletions</span>\n+                  </span>\n+                </div>\n+\n+                {/* File diffs */}\n+                <div className=\"space-y-4\">\n+                  {/* File 1 */}\n+                  <div className=\"border border-[#30363d] rounded-md overflow-hidden\">\n+                    <div className=\"flex items-center gap-2 px-4 py-2 bg-[#161b22] border-b border-[#30363d]\">\n+                      <svg className=\"h-4 w-4 text-[#7d8590]\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+                        <path d=\"M2 1.75C2 .784 2.784 0 3.75 0h6.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v9.586A1.75 1.75 0 0 1 13.25 16h-9.5A1.75 1.75 0 0 1 2 14.25Zm1.75-.25a.25.25 0 0 0-.25.25v12.5c0 .138.112.25.25.25h9.5a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 9 4.25V1.5Zm6.75.062V4.25c0 .138.112.25.25.25h2.688Z\" />\n+                      </svg>\n+                      <span className=\"text-sm text-[#e6edf3]\">apps/client/src/components/TaskItem.tsx</span>\n+                      <span className=\"ml-auto text-xs\">\n+                        <span className=\"text-[#3fb950]\">+28</span>\n+                        <span className=\"text-[#7d8590] mx-1\">−</span>\n+                        <span className=\"text-[#f85149]\">4</span>\n+                      </span>\n+                    </div>\n+                    <div className=\"text-[11px] font-mono overflow-x-auto\">\n+                      <div className=\"px-2 py-0.5 text-[#7d8590] bg-[#161b22]\">@@ -1,12 +1,15 @@</div>\n+                      <div className=\"flex\"><span className=\"w-8 text-[#7d8590] text-right pr-2 select-none bg-[#0d1117]\">1</span><span className=\"w-8 text-[#7d8590] text-right pr-2 select-none bg-[#0d1117]\">1</span><span className=\"flex-1 px-2 text-[#e6edf3]\">import {\"{\"} useState {\"}\"} from &quot;react&quot;;</span></div>\n+                      <div className=\"flex\"><span className=\"w-8 text-[#7d8590] text-right pr-2 select-none bg-[#0d1117]\">2</span><span className=\"w-8 text-[#7d8590] text-right pr-2 select-none bg-[#0d1117]\">2</span><span className=\"flex-1 px-2 text-[#e6edf3]\">import {\"{\"} useQuery {\"}\"} from &quot;convex/react&quot;;</span></div>\n+                      <div className=\"flex bg-[#f851491a]\"><span className=\"w-8 text-[#7d8590] text-right pr-2 select-none bg-[#f851494d]\">3</span><span className=\"w-8 text-right pr-2 select-none bg-[#0d1117]\"></span><span className=\"flex-1 px-2 text-[#f85149]\">-import {\"{\"} api {\"}\"} from &quot;@/convex&quot;;</span></div>\n+                      <div className=\"flex bg-[#2ea04326]\"><span className=\"w-8 text-right pr-2 select-none bg-[#0d1117]\"></span><span className=\"w-8 text-[#7d8590] text-right pr-2 select-none bg-[#2ea0434d]\">3</span><span className=\"flex-1 px-2 text-[#3fb950]\">+import {\"{\"} api {\"}\"} from &quot;@cmux/convex/api&quot;;</span></div>\n+                      <div className=\"flex bg-[#2ea04326]\"><span className=\"w-8 text-right pr-2 select-none bg-[#0d1117]\"></span><span className=\"w-8 text-[#7d8590] text-right pr-2 select-none bg-[#2ea0434d]\">4</span><span className=\"flex-1 px-2 text-[#3fb950]\">+import {\"{\"} isFakeConvexId {\"}\"} from &quot;@/lib/utils&quot;;</span></div>\n+                      <div className=\"flex\"><span className=\"w-8 text-[#7d8590] text-right pr-2 select-none bg-[#0d1117]\">4</span><span className=\"w-8 text-[#7d8590] text-right pr-2 select-none bg-[#0d1117]\">5</span><span className=\"flex-1 px-2 text-[#e6edf3]\">import {\"{\"} TaskTree {\"}\"} from &quot;./TaskTree&quot;;</span></div>\n+                    </div>\n+                  </div>\n+\n+                  {/* File 2 */}\n+                  <div className=\"border border-[#30363d] rounded-md overflow-hidden\">\n+                    <div className=\"flex items-center gap-2 px-4 py-2 bg-[#161b22] border-b border-[#30363d]\">\n+                      <svg className=\"h-4 w-4 text-[#3fb950]\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+                        <path d=\"M2 1.75C2 .784 2.784 0 3.75 0h6.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v9.586A1.75 1.75 0 0 1 13.25 16h-9.5A1.75 1.75 0 0 1 2 14.25Zm1.75-.25a.25.25 0 0 0-.25.25v12.5c0 .138.112.25.25.25h9.5a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 9 4.25V1.5Zm6.75.062V4.25c0 .138.112.25.25.25h2.688Z\" />\n+                      </svg>\n+                      <span className=\"text-sm text-[#e6edf3]\">apps/client/src/lib/utils.ts</span>\n+                      <span className=\"px-1.5 py-0.5 rounded text-[10px] bg-[#2ea04326] text-[#3fb950] border border-[#2ea04366]\">Added</span>\n+                      <span className=\"ml-auto text-xs\">\n+                        <span className=\"text-[#3fb950]\">+45</span>\n+                        <span className=\"text-[#7d8590] mx-1\">−</span>\n+                        <span className=\"text-[#7d8590]\">0</span>\n+                      </span>\n+                    </div>\n+                    <div className=\"text-[11px] font-mono overflow-x-auto\">\n+                      <div className=\"px-2 py-0.5 text-[#7d8590] bg-[#161b22]\">@@ -0,0 +1,45 @@</div>\n+                      <div className=\"flex bg-[#2ea04326]\"><span className=\"w-8 text-right pr-2 select-none bg-[#0d1117]\"></span><span className=\"w-8 text-[#7d8590] text-right pr-2 select-none bg-[#2ea0434d]\">1</span><span className=\"flex-1 px-2 text-[#3fb950]\">+export function isFakeConvexId(id: string): boolean {\"{\"}</span></div>\n+                      <div className=\"flex bg-[#2ea04326]\"><span className=\"w-8 text-right pr-2 select-none bg-[#0d1117]\"></span><span className=\"w-8 text-[#7d8590] text-right pr-2 select-none bg-[#2ea0434d]\">2</span><span className=\"flex-1 px-2 text-[#3fb950]\">+  return id.startsWith(&quot;fake_&quot;);</span></div>\n+                      <div className=\"flex bg-[#2ea04326]\"><span className=\"w-8 text-right pr-2 select-none bg-[#0d1117]\"></span><span className=\"w-8 text-[#7d8590] text-right pr-2 select-none bg-[#2ea0434d]\">3</span><span className=\"flex-1 px-2 text-[#3fb950]\">+{\"}\"}</span></div>\n+                      <div className=\"flex bg-[#2ea04326]\"><span className=\"w-8 text-right pr-2 select-none bg-[#0d1117]\"></span><span className=\"w-8 text-[#7d8590] text-right pr-2 select-none bg-[#2ea0434d]\">4</span><span className=\"flex-1 px-2 text-[#3fb950]\">+</span></div>\n+                      <div className=\"flex bg-[#2ea04326]\"><span className=\"w-8 text-right pr-2 select-none bg-[#0d1117]\"></span><span className=\"w-8 text-[#7d8590] text-right pr-2 select-none bg-[#2ea0434d]\">5</span><span className=\"flex-1 px-2 text-[#3fb950]\">+export function rewriteLocalId(id: string) {\"{\"}</span></div>\n+                      <div className=\"flex bg-[#2ea04326]\"><span className=\"w-8 text-right pr-2 select-none bg-[#0d1117]\"></span><span className=\"w-8 text-[#7d8590] text-right pr-2 select-none bg-[#2ea0434d]\">6</span><span className=\"flex-1 px-2 text-[#3fb950]\">+  return id.replace(&quot;fake_&quot;, &quot;&quot;);</span></div>\n+                      <div className=\"flex bg-[#2ea04326]\"><span className=\"w-8 text-right pr-2 select-none bg-[#0d1117]\"></span><span className=\"w-8 text-[#7d8590] text-right pr-2 select-none bg-[#2ea0434d]\">7</span><span className=\"flex-1 px-2 text-[#3fb950]\">+{\"}\"}</span></div>\n+                    </div>\n+                  </div>\n+                </div>\n+              </div>\n+            )}\n+          </div>\n+        </div>\n+        ) : (\n+          <div ref={containerRef} className=\"bg-neutral-900 flex\" style={{ height: MOCK_BROWSER_CONTENT_HEIGHT }}>\n+            {/* Left Sidebar - cmux style */}\n+            <div className=\"w-[280px] bg-neutral-950 border-r border-neutral-800 flex flex-col shrink-0\">\n+              {/* Header with logo */}\n+              <div className=\"h-[38px] flex items-center px-3 shrink-0\">\n+                <CmuxLogo height={28} wordmarkText=\"cmux\" />\n+                <div className=\"ml-auto\">\n+                  <div className=\"w-[25px] h-[25px] border border-neutral-800 rounded-lg flex items-center justify-center cursor-not-allowed\">\n+                    <Plus className=\"w-4 h-4 text-neutral-400\" />\n+                  </div>\n+                </div>\n+              </div>\n+\n+              {/* Navigation items */}\n+              <nav className=\"flex-1 overflow-y-auto\">\n+                <ul className=\"flex flex-col gap-px\">\n+                  <li>\n+                    <div className=\"mx-1 flex items-center gap-2 rounded-sm pl-2 ml-2 pr-3 py-1 text-[13px] text-neutral-400 cursor-not-allowed\">\n+                      <Home className=\"w-4 h-4 text-neutral-400\" />\n+                      <span>Home</span>\n+                    </div>\n+                  </li>\n+                  <li>\n+                    <div className=\"mx-1 flex items-center gap-2 rounded-sm pl-2 ml-2 pr-3 py-1 text-[13px] text-neutral-400 cursor-not-allowed\">\n+                      <Server className=\"w-4 h-4 text-neutral-400\" />\n+                      <span>Environments</span>\n+                    </div>\n+                  </li>\n+                  <li>\n+                    <div className=\"mx-1 flex items-center gap-2 rounded-sm pl-2 ml-2 pr-3 py-1 text-[13px] text-neutral-400 cursor-not-allowed\">\n+                      <Settings className=\"w-4 h-4 text-neutral-400\" />\n+                      <span>Settings</span>\n+                    </div>\n+                  </li>\n+                </ul>\n+\n+                {/* Previews section */}\n+                <div className=\"mt-4 flex flex-col\">\n+                  <div className=\"pl-2 ml-2 pr-3 py-0.5 text-[12px] font-medium text-neutral-300 cursor-pointer hover:bg-neutral-800/45 rounded-sm mx-1\">\n+                    Previews\n+                  </div>\n+                  <div className=\"pt-px space-y-px\">\n+                    {/* Preview task 1 - PR #1168 */}\n+                    <div className=\"space-y-px\">\n+                      <button\n+                        onClick={() => selectTask(\"task-1\")}\n+                        className={clsx(\n+                          \"w-full flex items-center gap-2 px-2 py-1.5 text-[13px] text-neutral-100 hover:bg-neutral-800/45 cursor-pointer\",\n+                          selectedTaskId === \"task-1\" && \"bg-neutral-800/30\"\n+                        )}\n+                      >\n+                        <span\n+                          onClick={(e) => { e.stopPropagation(); toggleTaskExpanded(\"task-1\"); }}\n+                          className=\"shrink-0\"\n+                        >\n+                          {expandedTasks.has(\"task-1\") ? (\n+                            <ChevronDown className=\"w-3 h-3 text-neutral-500\" />\n+                          ) : (\n+                            <ChevronRight className=\"w-3 h-3 text-neutral-500\" />\n+                          )}\n+                        </span>\n+                        {isPRMerged ? (\n+                          <svg className=\"w-3 h-3 text-[#8957e5] shrink-0\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+                            <path d=\"M5.45 5.154A4.25 4.25 0 0 0 9.25 7.5h1.378a2.251 2.251 0 1 1 0 1.5H9.25A5.734 5.734 0 0 1 5 7.123v3.505a2.25 2.25 0 1 1-1.5 0V5.372a2.25 2.25 0 1 1 1.95-.218ZM4.25 13.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm8.5-4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM5 3.25a.75.75 0 1 0 0 .005V3.25Z\" />\n+                          </svg>\n+                        ) : (\n+                          <CheckCircle2 className=\"w-3 h-3 text-green-500 shrink-0\" />\n+                        )}\n+                        <div className=\"flex flex-col min-w-0 text-left\">\n+                          <span className=\"truncate\">Preview screenshots for PR #1168</span>\n+                          <span className=\"text-[11px] text-neutral-500 truncate\">main &bull; manaflow-ai/cmux</span>\n+                        </div>\n+                      </button>\n+\n+                      {expandedTasks.has(\"task-1\") && (\n+                        <div>\n+                          <button\n+                            onClick={() => selectTask(\"task-1\")}\n+                            className={clsx(\n+                              \"w-full flex items-center gap-2 px-2 pl-7 py-1 text-[13px] text-left hover:bg-neutral-800/45\",\n+                              selectedTaskId === \"task-1\" && viewMode === \"all\" ? \"bg-neutral-800/50 text-neutral-100\" : \"text-neutral-300\"\n+                            )}\n+                          >\n+                            {isPRMerged ? (\n+                              <svg className=\"w-3 h-3 text-[#8957e5] shrink-0\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+                                <path d=\"M5.45 5.154A4.25 4.25 0 0 0 9.25 7.5h1.378a2.251 2.251 0 1 1 0 1.5H9.25A5.734 5.734 0 0 1 5 7.123v3.505a2.25 2.25 0 1 1-1.5 0V5.372a2.25 2.25 0 1 1 1.95-.218ZM4.25 13.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm8.5-4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM5 3.25a.75.75 0 1 0 0 .005V3.25Z\" />\n+                              </svg>\n+                            ) : (\n+                              <CheckCircle2 className=\"w-3 h-3 text-green-500 shrink-0\" />\n+                            )}\n+                            <span className=\"truncate\">screenshot-collector</span>\n+                          </button>\n+                          <button\n+                            onClick={() => { setSelectedTaskId(\"task-1\"); setViewMode(\"workspace\"); }}\n+                            className={clsx(\n+                              \"w-full flex items-center gap-2 px-2 pl-10 py-1 text-xs cursor-pointer text-left hover:bg-neutral-800/45\",\n+                              selectedTaskId === \"task-1\" && viewMode === \"workspace\" ? \"bg-neutral-800 text-white\" : \"text-neutral-400\"\n+                            )}\n+                          >\n+                            <Code className=\"w-3 h-3 shrink-0\" />\n+                            <span>VS Code</span>\n+                          </button>\n+                          <button\n+                            onClick={() => { setSelectedTaskId(\"task-1\"); setViewMode(\"gitDiff\"); }}\n+                            className={clsx(\n+                              \"w-full flex items-center gap-2 px-2 pl-10 py-1 text-xs cursor-pointer text-left hover:bg-neutral-800/45\",\n+                              selectedTaskId === \"task-1\" && viewMode === \"gitDiff\" ? \"bg-neutral-800 text-white\" : \"text-neutral-400\"\n+                            )}\n+                          >\n+                            <GitCompareIcon className=\"w-3 h-3 shrink-0\" />\n+                            <span>Git diff</span>\n+                          </button>\n+                          <button\n+                            onClick={() => { setSelectedTaskId(\"task-1\"); setViewMode(\"browser\"); }}\n+                            className={clsx(\n+                              \"w-full flex items-center gap-2 px-2 pl-10 py-1 text-xs cursor-pointer text-left hover:bg-neutral-800/45\",\n+                              selectedTaskId === \"task-1\" && viewMode === \"browser\" ? \"bg-neutral-800 text-white\" : \"text-neutral-400\"\n+                            )}\n+                          >\n+                            <Monitor className=\"w-3 h-3 shrink-0\" />\n+                            <span>Browser</span>\n+                          </button>\n+                          <button\n+                            onClick={() => { setSelectedTaskId(\"task-1\"); setViewMode(\"terminals\"); }}\n+                            className={clsx(\n+                              \"w-full flex items-center gap-2 px-2 pl-10 py-1 text-xs cursor-pointer text-left hover:bg-neutral-800/45\",\n+                              selectedTaskId === \"task-1\" && viewMode === \"terminals\" ? \"bg-neutral-800 text-white\" : \"text-neutral-400\"\n+                            )}\n+                          >\n+                            <TerminalSquare className=\"w-3 h-3 shrink-0\" />\n+                            <span>Terminals</span>\n+                          </button>\n+                        </div>\n+                      )}\n+                    </div>\n+\n+                    {/* Preview task 2 - PR #1142 */}\n+                    <div className=\"space-y-px\">\n+                      <button\n+                        onClick={() => selectTask(\"task-2\")}\n+                        className={clsx(\n+                          \"w-full flex items-center gap-2 px-2 py-1.5 text-[13px] text-neutral-100 hover:bg-neutral-800/45 cursor-pointer\",\n+                          selectedTaskId === \"task-2\" && \"bg-neutral-800/30\"\n+                        )}\n+                      >\n+                        <span\n+                          onClick={(e) => { e.stopPropagation(); toggleTaskExpanded(\"task-2\"); }}\n+                          className=\"shrink-0\"\n+                        >\n+                          {expandedTasks.has(\"task-2\") ? (\n+                            <ChevronDown className=\"w-3 h-3 text-neutral-500\" />\n+                          ) : (\n+                            <ChevronRight className=\"w-3 h-3 text-neutral-500\" />\n+                          )}\n+                        </span>\n+                        <CheckCircle2 className=\"w-3 h-3 text-green-500 shrink-0\" />\n+                        <div className=\"flex flex-col min-w-0 text-left\">\n+                          <span className=\"truncate\">Preview screenshots for PR #1142</span>\n+                          <span className=\"text-[11px] text-neutral-500 truncate\">feat/dark-mode &bull; manaflow-ai/cmux</span>\n+                        </div>\n+                      </button>\n+\n+                      {expandedTasks.has(\"task-2\") && (\n+                        <div>\n+                          <button\n+                            onClick={() => selectTask(\"task-2\")}\n+                            className={clsx(\n+                              \"w-full flex items-center gap-2 px-2 pl-7 py-1 text-[13px] text-left hover:bg-neutral-800/45\",\n+                              selectedTaskId === \"task-2\" && viewMode === \"all\" ? \"bg-neutral-800/50 text-neutral-100\" : \"text-neutral-300\"\n+                            )}\n+                          >\n+                            <CheckCircle2 className=\"w-3 h-3 text-green-500 shrink-0\" />\n+                            <span className=\"truncate\">screenshot-collector</span>\n+                          </button>\n+                          <button\n+                            onClick={() => { setSelectedTaskId(\"task-2\"); setViewMode(\"workspace\"); }}\n+                            className={clsx(\n+                              \"w-full flex items-center gap-2 px-2 pl-10 py-1 text-xs cursor-pointer text-left hover:bg-neutral-800/45\",\n+                              selectedTaskId === \"task-2\" && viewMode === \"workspace\" ? \"bg-neutral-800 text-white\" : \"text-neutral-400\"\n+                            )}\n+                          >\n+                            <Code className=\"w-3 h-3 shrink-0\" />\n+                            <span>VS Code</span>\n+                          </button>\n+                          <button\n+                            onClick={() => { setSelectedTaskId(\"task-2\"); setViewMode(\"gitDiff\"); }}\n+                            className={clsx(\n+                              \"w-full flex items-center gap-2 px-2 pl-10 py-1 text-xs cursor-pointer text-left hover:bg-neutral-800/45\",\n+                              selectedTaskId === \"task-2\" && viewMode === \"gitDiff\" ? \"bg-neutral-800 text-white\" : \"text-neutral-400\"\n+                            )}\n+                          >\n+                            <GitCompareIcon className=\"w-3 h-3 shrink-0\" />\n+                            <span>Git diff</span>\n+                          </button>\n+                          <button\n+                            onClick={() => { setSelectedTaskId(\"task-2\"); setViewMode(\"browser\"); }}\n+                            className={clsx(\n+                              \"w-full flex items-center gap-2 px-2 pl-10 py-1 text-xs cursor-pointer text-left hover:bg-neutral-800/45\",\n+                              selectedTaskId === \"task-2\" && viewMode === \"browser\" ? \"bg-neutral-800 text-white\" : \"text-neutral-400\"\n+                            )}\n+                          >\n+                            <Monitor className=\"w-3 h-3 shrink-0\" />\n+                            <span>Browser</span>\n+                          </button>\n+                          <button\n+                            onClick={() => { setSelectedTaskId(\"task-2\"); setViewMode(\"terminals\"); }}\n+                            className={clsx(\n+                              \"w-full flex items-center gap-2 px-2 pl-10 py-1 text-xs cursor-pointer text-left hover:bg-neutral-800/45\",\n+                              selectedTaskId === \"task-2\" && viewMode === \"terminals\" ? \"bg-neutral-800 text-white\" : \"text-neutral-400\"\n+                            )}\n+                          >\n+                            <TerminalSquare className=\"w-3 h-3 shrink-0\" />\n+                            <span>Terminals</span>\n+                          </button>\n+                        </div>\n+                      )}\n+                    </div>\n+\n+                    {/* Preview task 3 - PR #1098 */}\n+                    <div className=\"space-y-px\">\n+                      <button\n+                        onClick={() => selectTask(\"task-3\")}\n+                        className={clsx(\n+                          \"w-full flex items-center gap-2 px-2 py-1.5 text-[13px] text-neutral-100 hover:bg-neutral-800/45 cursor-pointer\",\n+                          selectedTaskId === \"task-3\" && \"bg-neutral-800/30\"\n+                        )}\n+                      >\n+                        <span\n+                          onClick={(e) => { e.stopPropagation(); toggleTaskExpanded(\"task-3\"); }}\n+                          className=\"shrink-0\"\n+                        >\n+                          {expandedTasks.has(\"task-3\") ? (\n+                            <ChevronDown className=\"w-3 h-3 text-neutral-500\" />\n+                          ) : (\n+                            <ChevronRight className=\"w-3 h-3 text-neutral-500\" />\n+                          )}\n+                        </span>\n+                        <CheckCircle2 className=\"w-3 h-3 text-green-500 shrink-0\" />\n+                        <div className=\"flex flex-col min-w-0 text-left\">\n+                          <span className=\"truncate\">Preview screenshots for PR #1098</span>\n+                          <span className=\"text-[11px] text-neutral-500 truncate\">fix/auth-redirect &bull; manaflow-ai/cmux</span>\n+                        </div>\n+                      </button>\n+\n+                      {expandedTasks.has(\"task-3\") && (\n+                        <div>\n+                          <button\n+                            onClick={() => selectTask(\"task-3\")}\n+                            className={clsx(\n+                              \"w-full flex items-center gap-2 px-2 pl-7 py-1 text-[13px] text-left hover:bg-neutral-800/45\",\n+                              selectedTaskId === \"task-3\" && viewMode === \"all\" ? \"bg-neutral-800/50 text-neutral-100\" : \"text-neutral-300\"\n+                            )}\n+                          >\n+                            <CheckCircle2 className=\"w-3 h-3 text-green-500 shrink-0\" />\n+                            <span className=\"truncate\">screenshot-collector</span>\n+                          </button>\n+                          <button\n+                            onClick={() => { setSelectedTaskId(\"task-3\"); setViewMode(\"workspace\"); }}\n+                            className={clsx(\n+                              \"w-full flex items-center gap-2 px-2 pl-10 py-1 text-xs cursor-pointer text-left hover:bg-neutral-800/45\",\n+                              selectedTaskId === \"task-3\" && viewMode === \"workspace\" ? \"bg-neutral-800 text-white\" : \"text-neutral-400\"\n+                            )}\n+                          >\n+                            <Code className=\"w-3 h-3 shrink-0\" />\n+                            <span>VS Code</span>\n+                          </button>\n+                          <button\n+                            onClick={() => { setSelectedTaskId(\"task-3\"); setViewMode(\"gitDiff\"); }}\n+                            className={clsx(\n+                              \"w-full flex items-center gap-2 px-2 pl-10 py-1 text-xs cursor-pointer text-left hover:bg-neutral-800/45\",\n+                              selectedTaskId === \"task-3\" && viewMode === \"gitDiff\" ? \"bg-neutral-800 text-white\" : \"text-neutral-400\"\n+                            )}\n+                          >\n+                            <GitCompareIcon className=\"w-3 h-3 shrink-0\" />\n+                            <span>Git diff</span>\n+                          </button>\n+                          <button\n+                            onClick={() => { setSelectedTaskId(\"task-3\"); setViewMode(\"browser\"); }}\n+                            className={clsx(\n+                              \"w-full flex items-center gap-2 px-2 pl-10 py-1 text-xs cursor-pointer text-left hover:bg-neutral-800/45\",\n+                              selectedTaskId === \"task-3\" && viewMode === \"browser\" ? \"bg-neutral-800 text-white\" : \"text-neutral-400\"\n+                            )}\n+                          >\n+                            <Monitor className=\"w-3 h-3 shrink-0\" />\n+                            <span>Browser</span>\n+                          </button>\n+                          <button\n+                            onClick={() => { setSelectedTaskId(\"task-3\"); setViewMode(\"terminals\"); }}\n+                            className={clsx(\n+                              \"w-full flex items-center gap-2 px-2 pl-10 py-1 text-xs cursor-pointer text-left hover:bg-neutral-800/45\",\n+                              selectedTaskId === \"task-3\" && viewMode === \"terminals\" ? \"bg-neutral-800 text-white\" : \"text-neutral-400\"\n+                            )}\n+                          >\n+                            <TerminalSquare className=\"w-3 h-3 shrink-0\" />\n+                            <span>Terminals</span>\n+                          </button>\n+                        </div>\n+                      )}\n+                    </div>\n+\n+                  </div>\n+                </div>\n+              </nav>\n+            </div>\n+\n+            {/* Main Content Area */}\n+            <div className=\"flex-1 flex min-w-0 relative\">\n+              {/* Three-panel layout when viewMode is \"all\" */}\n+              {viewMode === \"all\" && (\n+                <>\n+                  {/* Left: Workspace (VS Code) - resizable width */}\n+                  <div\n+                    className=\"bg-[#1e1e1e] border-r border-[#2d2d2d] flex flex-col min-w-0\"\n+                    style={{ width: `${leftPanelWidth}%` }}\n+                  >\n+                {/* Panel header */}\n+                <div className=\"flex items-center gap-2 px-3 py-1.5 bg-[#252526] border-b border-[#2d2d2d]\">\n+                  <Code className=\"h-4 w-4 text-[#007acc]\" />\n+                  <span className=\"text-xs text-[#cccccc]\">Workspace</span>\n+                </div>\n+                {/* VS Code content */}\n+                <div className=\"flex-1 flex min-h-0\">\n+                  {/* File explorer sidebar */}\n+                  <div className=\"w-[160px] bg-[#252526] border-r border-[#2d2d2d] flex flex-col shrink-0\">\n+                    <div className=\"px-2 py-1 text-[10px] font-semibold text-[#858585] uppercase tracking-wide\">\n+                      Explorer\n+                    </div>\n+                    <div className=\"flex items-center gap-1 px-2 py-0.5 text-[11px] text-[#cccccc]\">\n+                      <ChevronDown className=\"h-3 w-3\" />\n+                      <span className=\"text-[10px]\">cmux</span>\n+                    </div>\n+                    <div className=\"flex-1 overflow-y-auto text-[11px]\">\n+                      {/* Root folders */}\n+                      {[\".devcontainer\", \".github\", \"apps\", \"configs\", \"packages\", \"scripts\"].map((folder) => (\n+                        <div key={folder} className=\"flex items-center gap-1 px-4 py-0.5 text-[#cccccc] hover:bg-[#2a2d2e] cursor-pointer\">\n+                          <ChevronRight className=\"h-3 w-3 text-[#858585]\" />\n+                          <Folder className=\"h-3 w-3 text-[#dcb67a]\" />\n+                          <span>{folder}</span>\n+                        </div>\n+                      ))}\n+                      {/* Root files */}\n+                      {[\n+                        { name: \".gitignore\", color: \"#858585\" },\n+                        { name: \"package.json\", color: \"#cbcb41\" },\n+                        { name: \"README.md\", color: \"#519aba\" },\n+                        { name: \"tsconfig.json\", color: \"#519aba\" },\n+                      ].map((file) => (\n+                        <div key={file.name} className=\"flex items-center gap-1 px-4 pl-[22px] py-0.5 text-[#cccccc] hover:bg-[#2a2d2e] cursor-pointer\">\n+                          <FileText className=\"h-3 w-3\" style={{ color: file.color }} />\n+                          <span>{file.name}</span>\n+                        </div>\n+                      ))}\n+                    </div>\n+                  </div>\n+                  {/* Editor area */}\n+                  <div className=\"flex-1 flex flex-col min-w-0\">\n+                    {/* Tabs */}\n+                    <div className=\"flex items-center bg-[#252526] border-b border-[#2d2d2d]\">\n+                      <div className=\"flex items-center gap-1 px-3 py-1 bg-[#1e1e1e] border-r border-[#2d2d2d] text-[11px] text-[#cccccc]\">\n+                        <FileText className=\"h-3 w-3 text-[#858585]\" />\n+                        <span>LAUNCH.md</span>\n+                        <X className=\"h-3 w-3 ml-1 text-[#858585] hover:text-white\" />\n+                      </div>\n+                    </div>\n+                    {/* File content */}\n+                    <div className=\"flex-1 p-3 font-mono text-[11px] text-[#cccccc] overflow-auto\">\n+                      <div className=\"flex\"><div className=\"pr-3 text-[#858585] select-none text-right w-8\">1</div><div className=\"text-[#6a9955]\"># LAUNCH.md</div></div>\n+                      <div className=\"flex\"><div className=\"pr-3 text-[#858585] select-none text-right w-8\">2</div><div></div></div>\n+                      <div className=\"flex\"><div className=\"pr-3 text-[#858585] select-none text-right w-8\">3</div><div>Welcome to cmux!</div></div>\n+                      <div className=\"flex\"><div className=\"pr-3 text-[#858585] select-none text-right w-8\">4</div><div></div></div>\n+                      <div className=\"flex\"><div className=\"pr-3 text-[#858585] select-none text-right w-8\">5</div><div>Feel free to click around and explore!</div></div>\n+                      <div className=\"flex\"><div className=\"pr-3 text-[#858585] select-none text-right w-8\">6</div><div>- Explore preview tasks in the sidebar</div></div>\n+                      <div className=\"flex\"><div className=\"pr-3 text-[#858585] select-none text-right w-8\">7</div><div>- Check out the git diff view</div></div>\n+                      <div className=\"flex\"><div className=\"pr-3 text-[#858585] select-none text-right w-8\">8</div><div>- View the browser preview</div></div>\n+                      <div className=\"flex\"><div className=\"pr-3 text-[#858585] select-none text-right w-8\">9</div><div>- Switch between tmux sessions in terminal</div></div>\n+                      <div className=\"flex\"><div className=\"pr-3 text-[#858585] select-none text-right w-8\">10</div><div></div></div>\n+                      <div className=\"flex\"><div className=\"pr-3 text-[#858585] select-none text-right w-8\">11</div><div className=\"text-[#6a9955]\">## What is cmux?</div></div>\n+                      <div className=\"flex\"><div className=\"pr-3 text-[#858585] select-none text-right w-8\">12</div><div></div></div>\n+                      <div className=\"flex\"><div className=\"pr-3 text-[#858585] select-none text-right w-8\">13</div><div>It&apos;s basically Linear for Claude Code</div></div>\n+                      <div className=\"flex\"><div className=\"pr-3 text-[#858585] select-none text-right w-8\">14</div><div></div></div>\n+                      <div className=\"flex\"><div className=\"pr-3 text-[#858585] select-none text-right w-8\">15</div><div>also supports Codex, Gemini, & more...</div></div>\n+                      <div className=\"flex\"><div className=\"pr-3 text-[#858585] select-none text-right w-8\">16</div><div></div></div>\n+                      <div className=\"flex\"><div className=\"pr-3 text-[#858585] select-none text-right w-8\">17</div><div>it's a universal AI coding agent manager</div></div>\n+                      <div className=\"flex\"><div className=\"pr-3 text-[#858585] select-none text-right w-8\">18</div><div></div></div>\n+                      <div className=\"flex\"><div className=\"pr-3 text-[#858585] select-none text-right w-8\">19</div><div>today, preview.new screenshot agent runs on cmux</div></div>\n+                      <div className=\"flex\"><div className=\"pr-3 text-[#858585] select-none text-right w-8\">0</div><div></div></div>\n+                      <div className=\"flex\"><div className=\"pr-3 text-[#858585] select-none text-right w-8\">19</div><div className=\"text-[#6a9955]\">## About Manaflow</div></div>\n+                      <div className=\"flex\"><div className=\"pr-3 text-[#858585] select-none text-right w-8\">20</div><div></div></div>\n+                      <div className=\"flex\"><div className=\"pr-3 text-[#858585] select-none text-right w-8\">21</div><div>We build interfaces to manage AI agents.</div></div>\n+                    </div>\n+                  </div>\n+                </div>\n+              </div>\n+\n+              {/* Horizontal resize handle */}\n+              <div\n+                onMouseDown={startHorizontalResize}\n+                className=\"w-1 cursor-col-resize bg-[#2d2d2d] hover:bg-[#007acc] active:bg-[#007acc] transition-colors shrink-0\"\n+                title=\"Drag to resize panels\"\n+              />\n+\n+              {/* Right: Browser + Git Diff stacked vertically */}\n+              <div className=\"flex flex-col min-w-0 relative\" style={{ width: `${100 - leftPanelWidth}%` }}>\n+                {/* Browser Panel */}\n+                <div\n+                  className=\"bg-[#1e1e1e] flex flex-col\"\n+                  style={{ height: `${topPanelHeight}%` }}\n+                >\n+                  {/* Panel header */}\n+                  <div className=\"flex items-center gap-2 px-3 py-1.5 bg-[#252526] border-b border-[#2d2d2d]\">\n+                    <Monitor className=\"h-4 w-4 text-[#858585]\" />\n+                    <span className=\"text-xs text-[#cccccc]\">Browser</span>\n+                  </div>\n+                  {/* Chrome browser inside */}\n+                  <div className=\"flex-1 flex flex-col bg-[#202124] overflow-hidden\" style={{ fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif' }}>\n+                    {/* Chrome tab bar */}\n+                    <div className=\"flex items-end bg-[#35363a] h-[28px] px-2 shrink-0\">\n+                      <div className=\"flex items-center gap-1 bg-[#202124] rounded-t-lg px-2 py-1 max-w-[160px] mt-auto\">\n+                        <TabFavicon />\n+                        <span className=\"text-[10px] text-[#e8eaed] truncate\">cmux.dev</span>\n+                        <button className=\"p-0.5 hover:bg-[#35363a] rounded\">\n+                          <X className=\"h-2.5 w-2.5 text-[#9aa0a6]\" />\n+                        </button>\n+                      </div>\n+                    </div>\n+                    {/* Chrome toolbar */}\n+                    <div className=\"flex items-center gap-2 px-2 py-1 bg-[#202124] shrink-0\">\n+                      <div className=\"flex-1 flex items-center gap-2 px-2 py-0.5 bg-[#35363a] rounded-full text-[10px]\">\n+                        <svg className=\"h-2.5 w-2.5 text-[#9aa0a6]\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n+                          <rect x=\"3\" y=\"11\" width=\"18\" height=\"11\" rx=\"2\" ry=\"2\" />\n+                          <path d=\"M7 11V7a5 5 0 0 1 10 0v4\" />\n+                        </svg>\n+                        <span className=\"text-[#e8eaed]\">localhost:5173</span>\n+                      </div>\n+                    </div>\n+                    {/* Browser content - cmux.dev landing page */}\n+                    <div className=\"flex-1 bg-[#030712] overflow-y-auto\">\n+                      {/* Gradient background */}\n+                      <div className=\"relative\">\n+                        <div className=\"absolute inset-0 overflow-hidden\">\n+                          <div className=\"absolute inset-x-[-20%] top-[-30%] h-[200px] rounded-full bg-gradient-to-br from-blue-600/30 via-sky-500/20 to-purple-600/10 blur-3xl\" />\n+                        </div>\n+                        {/* Header */}\n+                        <div className=\"relative flex items-center justify-between px-4 py-3\">\n+                          <a href=\"https://github.com/manaflow-ai/cmux\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"hover:opacity-80\">\n+                            <CmuxLogo height={20} />\n+                          </a>\n+                          <div className=\"flex items-center gap-3 text-[9px] text-neutral-300\">\n+                            <a href=\"https://www.cmux.dev/\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"hover:text-white\">About</a>\n+                            <a href=\"https://www.cmux.dev/\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"hover:text-white\">Workflow</a>\n+                            <a href=\"https://github.com/manaflow-ai/cmux\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"hover:text-white\">GitHub</a>\n+                          </div>\n+                          <div className=\"flex items-center gap-2\">\n+                            <a href=\"https://github.com/manaflow-ai/cmux\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"flex items-center gap-1 text-[9px] text-neutral-300 hover:text-white\">\n+                              <Github className=\"h-3 w-3\" />\n+                              <span>649</span>\n+                            </a>\n+                            <button className=\"px-2 py-0.5 bg-white text-black text-[8px] rounded-full flex items-center gap-1\">\n+                              <Download className=\"w-2.5 h-2.5\" />\n+                              <span>Download</span>\n+                            </button>\n+                          </div>\n+                        </div>\n+                        {/* Hero section */}\n+                        <div className=\"relative px-4 py-4\">\n+                          <div className=\"grid grid-cols-2 gap-4\">\n+                            <div className=\"space-y-3\">\n+                              <h1 className=\"text-white text-base font-semibold leading-tight\">\n+                                Universal AI coding agent manager for 10x engineers\n+                              </h1>\n+                              <p className=\"text-[9px] text-neutral-300 leading-relaxed\">\n+                                cmux is a universal AI coding agent manager that supports Claude Code, Codex, Gemini CLI, Amp, Opencode, and other coding CLIs.\n+                              </p>\n+                              <p className=\"text-[9px] text-neutral-300 leading-relaxed\">\n+                                Every run spins up an isolated VS Code workspace either in the cloud or in a local Docker container with the git diff view, terminal, and dev server preview ready.\n+                              </p>\n+                              <div className=\"flex items-center gap-2 pt-2\">\n+                                <a href=\"https://www.cmux.dev/\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"px-2 py-1 bg-white text-black text-[8px] rounded-lg flex items-center gap-1 font-medium hover:bg-neutral-200\">\n+                                  <svg className=\"h-2.5 w-2.5\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+                                    <path d=\"M12.665 15.358c-.905.844-1.893.711-2.843.311-1.006-.409-1.93-.427-2.991 0-1.33.551-2.03.391-2.825-.31C-.498 10.886.166 4.078 5.28 3.83c1.246.062 2.114.657 2.843.71 1.09-.213 2.133-.826 3.296-.746 1.393.107 2.446.64 3.138 1.6-2.88 1.662-2.197 5.315.443 6.337-.526 1.333-1.21 2.657-2.345 3.635zM8.03 3.778C7.892 1.794 9.563.16 11.483 0c.268 2.293-2.16 4-3.452 3.777\" />\n+                                  </svg>\n+                                  Download for macOS\n+                                </a>\n+                                <a href=\"https://github.com/manaflow-ai/cmux\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"px-2 py-1 border border-white/10 bg-white/5 text-white text-[8px] rounded-lg flex items-center gap-1 hover:bg-white/10\">\n+                                  GitHub repo\n+                                  <Github className=\"w-2.5 h-2.5\" />\n+                                </a>\n+                              </div>\n+                            </div>\n+                            {/* Right side - video + features */}\n+                            <div className=\"space-y-2\">\n+                              <div className=\"rounded-xl border border-white/10 bg-white/5 p-2\">\n+                                {/* Mini browser with YouTube video */}\n+                                <div className=\"rounded-lg overflow-hidden border border-neutral-700 mb-2\">\n+                                  {/* Mini browser tab bar */}\n+                                  <div className=\"flex items-center bg-[#35363a] h-[16px] px-1\">\n+                                    <div className=\"flex items-center gap-0.5 bg-[#202124] rounded-t px-1 py-0.5\">\n+                                      <div className=\"w-1.5 h-1.5 rounded-full bg-red-500\" />\n+                                      <span className=\"text-[6px] text-[#e8eaed] truncate\">YouTube</span>\n+                                    </div>\n+                                  </div>\n+                                  {/* Mini browser toolbar */}\n+                                  <div className=\"flex items-center px-1 py-0.5 bg-[#202124]\">\n+                                    <div className=\"flex-1 px-1 py-0.5 bg-[#35363a] rounded text-[5px] text-[#9aa0a6] truncate\">\n+                                      youtube.com/watch?v=YtQTKSM_wsA\n+                                    </div>\n+                                  </div>\n+                                  {/* Video content */}\n+                                  <a href=\"https://www.youtube.com/watch?v=YtQTKSM_wsA\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"bg-neutral-900 aspect-video flex items-center justify-center cursor-pointer hover:bg-neutral-800 transition-colors block relative\">\n+                                    <img src=\"https://img.youtube.com/vi/YtQTKSM_wsA/hqdefault.jpg\" alt=\"cmux demo video\" className=\"absolute inset-0 w-full h-full object-cover opacity-60\" />\n+                                    <div className=\"relative w-8 h-8 rounded-full bg-red-600 flex items-center justify-center hover:bg-red-500 transition-colors\">\n+                                      <div className=\"w-0 h-0 border-t-[5px] border-t-transparent border-l-[8px] border-l-white border-b-[5px] border-b-transparent ml-0.5\" />\n+                                    </div>\n+                                  </a>\n+                                </div>\n+                                {/* Feature bullets */}\n+                                <div className=\"space-y-1.5\">\n+                                  <div className=\"flex gap-2\">\n+                                    <div className=\"mt-0.5 h-4 w-4 flex-none rounded-full bg-gradient-to-br from-sky-500/80 to-indigo-500/80 text-center text-[8px] font-semibold leading-4 text-white\">\n+                                      &bull;\n+                                    </div>\n+                                    <div>\n+                                      <p className=\"text-[8px] text-white font-medium\">Run multiple agent CLIs side-by-side</p>\n+                                      <p className=\"text-[7px] text-neutral-400\">Claude Code, Codex, Gemini CLI, Amp, and more.</p>\n+                                    </div>\n+                                  </div>\n+                                  <div className=\"flex gap-2\">\n+                                    <div className=\"mt-0.5 h-4 w-4 flex-none rounded-full bg-gradient-to-br from-sky-500/80 to-indigo-500/80 text-center text-[8px] font-semibold leading-4 text-white\">\n+                                      &bull;\n+                                    </div>\n+                                    <div>\n+                                      <p className=\"text-[8px] text-white font-medium\">Dedicated VS Code instance per agent</p>\n+                                      <p className=\"text-[7px] text-neutral-400\">Isolated VS Code, terminal, and git diff view.</p>\n+                                    </div>\n+                                  </div>\n+                                  <div className=\"flex gap-2\">\n+                                    <div className=\"mt-0.5 h-4 w-4 flex-none rounded-full bg-gradient-to-br from-sky-500/80 to-indigo-500/80 text-center text-[8px] font-semibold leading-4 text-white\">\n+                                      &bull;\n+                                    </div>\n+                                    <div>\n+                                      <p className=\"text-[8px] text-white font-medium\">Preview environments for verification</p>\n+                                      <p className=\"text-[7px] text-neutral-400\">Browser previews to verify dev server output.</p>\n+                                    </div>\n+                                  </div>\n+                                </div>\n+                              </div>\n+                            </div>\n+                          </div>\n+                          {/* App screenshot preview */}\n+                          <div className=\"mt-4 rounded-lg overflow-hidden border border-white/10 bg-neutral-900 h-[100px]\">\n+                            <div className=\"flex h-full\">\n+                              <div className=\"w-[70px] bg-neutral-950 border-r border-white/10 p-1.5\">\n+                                <div className=\"text-[7px] text-neutral-400 space-y-0.5\">\n+                                  <div className=\"flex items-center gap-1\"><Home className=\"w-2.5 h-2.5\" /><span>Home</span></div>\n+                                  <div className=\"flex items-center gap-1\"><Server className=\"w-2.5 h-2.5\" /><span>Environments</span></div>\n+                                  <div className=\"flex items-center gap-1\"><Settings className=\"w-2.5 h-2.5\" /><span>Settings</span></div>\n+                                </div>\n+                              </div>\n+                              <div className=\"flex-1 bg-neutral-900 p-2\">\n+                                <div className=\"text-[6px] text-neutral-500 text-center\">cmux dashboard preview</div>\n+                              </div>\n+                            </div>\n+                          </div>\n+                        </div>\n+                      </div>\n+                    </div>\n+                  </div>\n+                </div>\n+\n+                {/* Vertical resize handle */}\n+                <div\n+                  onMouseDown={startVerticalResize}\n+                  className=\"h-1 cursor-row-resize bg-[#2d2d2d] hover:bg-[#007acc] active:bg-[#007acc] transition-colors shrink-0\"\n+                  title=\"Drag to resize panels\"\n+                />\n+\n+                {/* Git Diff Panel */}\n+                <div\n+                  className=\"bg-[#1e1e1e] flex flex-col\"\n+                  style={{ height: `${100 - topPanelHeight}%` }}\n+                >\n+                  <div className=\"flex items-center justify-between px-3 py-1.5 bg-[#252526] border-b border-[#2d2d2d] shrink-0\">\n+                    <div className=\"flex items-center gap-2\">\n+                      <GitBranch className=\"h-4 w-4 text-[#f97316]\" />\n+                      <span className=\"text-xs text-[#cccccc]\">Git Diff</span>\n+                      <span className=\"text-[10px] text-[#858585]\">3 files</span>\n+                    </div>\n+                  </div>\n+                  <div className=\"flex-1 flex flex-col min-h-0 overflow-y-auto\" style={{ scrollbarWidth: \"thin\", scrollbarColor: \"#30363d #1e1e1e\" }}>\n+                    {/* File 1 - Modified */}\n+                    <div className=\"border-b border-[#2d2d2d]\">\n+                      <button\n+                        onClick={() => toggleFileCollapse(\"file1\")}\n+                        className=\"flex items-center gap-2 px-3 py-1.5 bg-[#252526] sticky top-0 w-full text-left hover:bg-[#2a2d2e] transition-colors\"\n+                      >\n+                        {collapsedFiles.has(\"file1\") ? (\n+                          <ChevronRight className=\"h-3 w-3 text-[#858585]\" />\n+                        ) : (\n+                          <ChevronDown className=\"h-3 w-3 text-[#858585]\" />\n+                        )}\n+                        <div className=\"w-2 h-2 rounded-full bg-yellow-500\" />\n+                        <span className=\"text-[10px] text-[#cccccc] truncate flex-1\">apps/client/src/components/TaskItem.tsx</span>\n+                        <span className=\"text-[9px] text-[#3fb950]\">+28</span>\n+                        <span className=\"text-[9px] text-[#f85149]\">-4</span>\n+                      </button>\n+                      {!collapsedFiles.has(\"file1\") && (\n+                        <div className=\"text-[9px] font-mono\">\n+                          <div className=\"px-2 py-0.5 text-[#858585] bg-[#1f2733] text-[8px]\">@@ -1,12 +1,15 @@</div>\n+                          <div className=\"flex\"><span className=\"w-6 text-[#858585] text-right pr-2 select-none bg-[#1e1e1e]\">1</span><span className=\"w-6 text-[#858585] text-right pr-2 select-none bg-[#1e1e1e]\">1</span><span className=\"flex-1 px-2 text-[#cccccc]\">import {\"{\"} useState {\"}\"} from &quot;react&quot;;</span></div>\n+                          <div className=\"flex bg-[#f851491a]\"><span className=\"w-6 text-[#ff7b72] text-right pr-2 select-none bg-[#f851494d]\">3</span><span className=\"w-6 text-right pr-2 select-none bg-[#1e1e1e]\"></span><span className=\"flex-1 px-2 text-[#f85149]\">-import {\"{\"} api {\"}\"} from &quot;@/convex&quot;;</span></div>\n+                          <div className=\"flex bg-[#2ea04326]\"><span className=\"w-6 text-right pr-2 select-none bg-[#1e1e1e]\"></span><span className=\"w-6 text-[#7ee787] text-right pr-2 select-none bg-[#3fb9504d]\">3</span><span className=\"flex-1 px-2 text-[#3fb950]\">+import {\"{\"} api {\"}\"} from &quot;@cmux/convex/api&quot;;</span></div>\n+                          <div className=\"px-2 py-0.5 text-[#858585] bg-[#1f2733] text-[8px]\">... 18 unchanged lines ...</div>\n+                        </div>\n+                      )}\n+                    </div>\n+\n+                    {/* File 2 - Added */}\n+                    <div className=\"border-b border-[#2d2d2d]\">\n+                      <button\n+                        onClick={() => toggleFileCollapse(\"file2\")}\n+                        className=\"flex items-center gap-2 px-3 py-1.5 bg-[#252526] sticky top-0 w-full text-left hover:bg-[#2a2d2e] transition-colors\"\n+                      >\n+                        {collapsedFiles.has(\"file2\") ? (\n+                          <ChevronRight className=\"h-3 w-3 text-[#858585]\" />\n+                        ) : (\n+                          <ChevronDown className=\"h-3 w-3 text-[#858585]\" />\n+                        )}\n+                        <div className=\"w-2 h-2 rounded-full bg-green-500\" />\n+                        <span className=\"text-[10px] text-[#cccccc] truncate flex-1\">apps/client/src/lib/utils.ts</span>\n+                        <span className=\"text-[9px] text-[#3fb950]\">+45</span>\n+                        <span className=\"text-[9px] text-[#858585]\">-0</span>\n+                      </button>\n+                      {!collapsedFiles.has(\"file2\") && (\n+                        <div className=\"text-[9px] font-mono\">\n+                          <div className=\"px-2 py-0.5 text-[#858585] bg-[#1f2733] text-[8px]\">@@ -0,0 +1,45 @@</div>\n+                          <div className=\"flex bg-[#2ea04326]\"><span className=\"w-6 text-right pr-2 select-none bg-[#1e1e1e]\"></span><span className=\"w-6 text-[#7ee787] text-right pr-2 select-none bg-[#3fb9504d]\">1</span><span className=\"flex-1 px-2 text-[#3fb950]\">+export function isFakeConvexId(id: string): boolean {\"{\"}</span></div>\n+                          <div className=\"flex bg-[#2ea04326]\"><span className=\"w-6 text-right pr-2 select-none bg-[#1e1e1e]\"></span><span className=\"w-6 text-[#7ee787] text-right pr-2 select-none bg-[#3fb9504d]\">2</span><span className=\"flex-1 px-2 text-[#3fb950]\">+  return id.startsWith(&quot;fake_&quot;);</span></div>\n+                          <div className=\"flex bg-[#2ea04326]\"><span className=\"w-6 text-right pr-2 select-none bg-[#1e1e1e]\"></span><span className=\"w-6 text-[#7ee787] text-right pr-2 select-none bg-[#3fb9504d]\">3</span><span className=\"flex-1 px-2 text-[#3fb950]\">+{\"}\"}</span></div>\n+                          <div className=\"px-2 py-0.5 text-[#858585] bg-[#1f2733] text-[8px]\">... 42 more lines ...</div>\n+                        </div>\n+                      )}\n+                    </div>\n+\n+                    {/* File 3 - Deleted (starts collapsed) */}\n+                    <div className=\"border-b border-[#2d2d2d]\">\n+                      <button\n+                        onClick={() => toggleFileCollapse(\"file3\")}\n+                        className=\"flex items-center gap-2 px-3 py-1.5 bg-[#252526] sticky top-0 w-full text-left hover:bg-[#2a2d2e] transition-colors\"\n+                      >\n+                        {collapsedFiles.has(\"file3\") ? (\n+                          <ChevronRight className=\"h-3 w-3 text-[#858585]\" />\n+                        ) : (\n+                          <ChevronDown className=\"h-3 w-3 text-[#858585]\" />\n+                        )}\n+                        <div className=\"w-2 h-2 rounded-full bg-red-500\" />\n+                        <span className=\"text-[10px] text-[#cccccc] truncate flex-1\">apps/client/src/legacy/helpers.ts</span>\n+                        <span className=\"text-[9px] text-[#858585]\">+0</span>\n+                        <span className=\"text-[9px] text-[#f85149]\">-12</span>\n+                      </button>\n+                      {!collapsedFiles.has(\"file3\") && (\n+                        <div className=\"text-[9px] font-mono\">\n+                          <div className=\"px-2 py-0.5 text-[#858585] bg-[#1f2733] text-[8px]\">@@ -1,12 +0,0 @@</div>\n+                          <div className=\"flex bg-[#f851491a]\"><span className=\"w-6 text-[#ff7b72] text-right pr-2 select-none bg-[#f851494d]\">1</span><span className=\"w-6 text-right pr-2 select-none bg-[#1e1e1e]\"></span><span className=\"flex-1 px-2 text-[#f85149]\">-// Legacy helper functions</span></div>\n+                          <div className=\"flex bg-[#f851491a]\"><span className=\"w-6 text-[#ff7b72] text-right pr-2 select-none bg-[#f851494d]\">2</span><span className=\"w-6 text-right pr-2 select-none bg-[#1e1e1e]\"></span><span className=\"flex-1 px-2 text-[#f85149]\">-export function oldHelper() {\"{\"}</span></div>\n+                          <div className=\"px-2 py-0.5 text-[#858585] bg-[#1f2733] text-[8px]\">... 10 more lines ...</div>\n+                        </div>\n+                      )}\n+                    </div>\n+                  </div>\n+                </div>\n+              </div>\n+            </>\n+          )}\n+\n+              {/* Single panel: Workspace (VS Code) */}\n+              {viewMode === \"workspace\" && (\n+                <div className=\"flex-1 bg-[#1e1e1e] flex flex-col\">\n+                  {/* Panel header */}\n+                  <div className=\"flex items-center gap-2 px-3 py-1.5 bg-[#252526] border-b border-[#2d2d2d]\">\n+                    <Code className=\"h-4 w-4 text-[#007acc]\" />\n+                    <span className=\"text-xs text-[#cccccc]\">Workspace</span>\n+                    <div className=\"ml-auto flex items-center gap-1\">\n+                      <button onClick={() => setViewMode(\"all\")} className=\"p-0.5 text-[#858585] hover:text-white hover:bg-[#3c3c3c] rounded text-[10px]\">\n+                        Back to all\n+                      </button>\n+                    </div>\n+                  </div>\n+                  {/* VS Code content */}\n+                  <div className=\"flex-1 flex min-h-0\">\n+                    {/* File explorer sidebar */}\n+                    <div className=\"w-[200px] bg-[#252526] border-r border-[#2d2d2d] flex flex-col shrink-0\">\n+                      <div className=\"px-2 py-1 text-[10px] font-semibold text-[#858585] uppercase tracking-wide\">\n+                        Explorer\n+                      </div>\n+                      <div className=\"flex items-center gap-1 px-2 py-0.5 text-[11px] text-[#cccccc] bg-[#37373d]\">\n+                        <ChevronDown className=\"h-3 w-3\" />\n+                        <span className=\"text-[10px]\">cmux</span>\n+                      </div>\n+                      <div className=\"flex-1 overflow-y-auto text-[11px]\">\n+                        {/* Root folders */}\n+                        {[\".devcontainer\", \".github\", \"apps\", \"configs\", \"packages\", \"scripts\", \"tests\"].map((folder) => (\n+                          <div key={folder} className=\"flex items-center gap-1 px-4 py-0.5 text-[#cccccc] hover:bg-[#2a2d2e] cursor-pointer\">\n+                            <ChevronRight className=\"h-3 w-3 text-[#858585]\" />\n+                            <Folder className=\"h-3 w-3 text-[#dcb67a]\" />\n+                            <span>{folder}</span>\n+                          </div>\n+                        ))}\n+                        {/* Root files */}\n+                        {[\n+                          { name: \".gitignore\", color: \"#858585\" },\n+                          { name: \"package.json\", color: \"#cbcb41\" },\n+                          { name: \"README.md\", color: \"#519aba\" },\n+                          { name: \"tsconfig.json\", color: \"#519aba\" },\n+                        ].map((file) => (\n+                          <div key={file.name} className=\"flex items-center gap-1 px-4 pl-[22px] py-0.5 text-[#cccccc] hover:bg-[#2a2d2e] cursor-pointer\">\n+                            <FileText className=\"h-3 w-3\" style={{ color: file.color }} />\n+                            <span>{file.name}</span>\n+                          </div>\n+                        ))}\n+                      </div>\n+                    </div>\n+                    {/* Editor area */}\n+                    <div className=\"flex-1 flex flex-col min-w-0\">\n+                      {/* Tabs */}\n+                      <div className=\"flex items-center bg-[#252526] border-b border-[#2d2d2d]\">\n+                        <div className=\"flex items-center gap-1 px-3 py-1 bg-[#1e1e1e] border-r border-[#2d2d2d] text-[11px] text-[#cccccc]\">\n+                          <FileText className=\"h-3 w-3 text-[#858585]\" />\n+                          <span>LAUNCH.md</span>\n+                          <X className=\"h-3 w-3 ml-1 text-[#858585] hover:text-white\" />\n+                        </div>\n+                      </div>\n+                      {/* File content */}\n+                      <div className=\"flex-1 p-4 font-mono text-[12px] text-[#cccccc] overflow-auto\">\n+                        <div className=\"flex\"><div className=\"pr-4 text-[#858585] select-none text-right w-10\">1</div><div className=\"text-[#6a9955]\"># LAUNCH.md</div></div>\n+                        <div className=\"flex\"><div className=\"pr-4 text-[#858585] select-none text-right w-10\">2</div><div></div></div>\n+                        <div className=\"flex\"><div className=\"pr-4 text-[#858585] select-none text-right w-10\">3</div><div>Welcome to cmux!</div></div>\n+                        <div className=\"flex\"><div className=\"pr-4 text-[#858585] select-none text-right w-10\">4</div><div></div></div>\n+                        <div className=\"flex\"><div className=\"pr-4 text-[#858585] select-none text-right w-10\">5</div><div>Feel free to click around and explore!</div></div>\n+                        <div className=\"flex\"><div className=\"pr-4 text-[#858585] select-none text-right w-10\">6</div><div>- Explore preview tasks in the sidebar</div></div>\n+                        <div className=\"flex\"><div className=\"pr-4 text-[#858585] select-none text-right w-10\">7</div><div>- Check out the git diff view</div></div>\n+                        <div className=\"flex\"><div className=\"pr-4 text-[#858585] select-none text-right w-10\">8</div><div>- View the browser preview</div></div>\n+                        <div className=\"flex\"><div className=\"pr-4 text-[#858585] select-none text-right w-10\">9</div><div>- There may be some Easter eggs</div></div>\n+                        <div className=\"flex\"><div className=\"pr-4 text-[#858585] select-none text-right w-10\">10</div><div></div></div>\n+                        <div className=\"flex\"><div className=\"pr-4 text-[#858585] select-none text-right w-10\">11</div><div className=\"text-[#6a9955]\">## What is cmux?</div></div>\n+                        <div className=\"flex\"><div className=\"pr-4 text-[#858585] select-none text-right w-10\">12</div><div></div></div>\n+                        <div className=\"flex\"><div className=\"pr-4 text-[#858585] select-none text-right w-10\">13</div><div>It&apos;s basically Linear for Claude Code.</div></div>\n+                        <div className=\"flex\"><div className=\"pr-4 text-[#858585] select-none text-right w-10\">14</div><div></div></div>\n+                        <div className=\"flex\"><div className=\"pr-4 text-[#858585] select-none text-right w-10\">15</div><div>A universal AI coding agent manager.</div></div>\n+                        <div className=\"flex\"><div className=\"pr-4 text-[#858585] select-none text-right w-10\">16</div><div></div></div>\n+                        <div className=\"flex\"><div className=\"pr-4 text-[#858585] select-none text-right w-10\">17</div><div className=\"text-[#6a9955]\">## About Manaflow</div></div>\n+                        <div className=\"flex\"><div className=\"pr-4 text-[#858585] select-none text-right w-10\">18</div><div></div></div>\n+                        <div className=\"flex\"><div className=\"pr-4 text-[#858585] select-none text-right w-10\">19</div><div>We build interfaces to manage AI agents.</div></div>\n+                      </div>\n+                    </div>\n+                  </div>\n+                </div>\n+              )}\n+\n+              {/* Single panel: Browser */}\n+              {viewMode === \"browser\" && (\n+                <div className=\"flex-1 bg-[#1e1e1e] flex flex-col\">\n+                  {/* Panel header */}\n+                  <div className=\"flex items-center gap-2 px-3 py-1.5 bg-[#252526] border-b border-[#2d2d2d]\">\n+                    <Monitor className=\"h-4 w-4 text-[#858585]\" />\n+                    <span className=\"text-xs text-[#cccccc]\">Browser</span>\n+                    <div className=\"ml-auto flex items-center gap-1\">\n+                      <button onClick={() => setViewMode(\"all\")} className=\"p-0.5 text-[#858585] hover:text-white hover:bg-[#3c3c3c] rounded text-[10px]\">\n+                        Back to all\n+                      </button>\n+                    </div>\n+                  </div>\n+                  {/* Chrome browser inside */}\n+                  <div className=\"flex-1 flex flex-col bg-[#202124] overflow-hidden\" style={{ fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif' }}>\n+                    {/* Chrome tab bar */}\n+                    <div className=\"flex items-end bg-[#35363a] h-[32px] px-2 shrink-0\">\n+                      <div className=\"flex items-center gap-1 bg-[#202124] rounded-t-lg px-3 py-1.5 max-w-[200px] mt-auto\">\n+                        <TabFavicon />\n+                        <span className=\"text-[11px] text-[#e8eaed] truncate\">cmux.dev</span>\n+                        <button className=\"p-0.5 hover:bg-[#35363a] rounded\">\n+                          <X className=\"h-3 w-3 text-[#9aa0a6]\" />\n+                        </button>\n+                      </div>\n+                    </div>\n+                    {/* Chrome toolbar */}\n+                    <div className=\"flex items-center gap-2 px-2 py-1.5 bg-[#202124] shrink-0\">\n+                      <div className=\"flex-1 flex items-center gap-2 px-3 py-1 bg-[#35363a] rounded-full text-[11px]\">\n+                        <svg className=\"h-3 w-3 text-[#9aa0a6]\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n+                          <rect x=\"3\" y=\"11\" width=\"18\" height=\"11\" rx=\"2\" ry=\"2\" />\n+                          <path d=\"M7 11V7a5 5 0 0 1 10 0v4\" />\n+                        </svg>\n+                        <span className=\"text-[#e8eaed]\">localhost:5173</span>\n+                      </div>\n+                    </div>\n+                    {/* Browser content - cmux.dev landing page */}\n+                    <div className=\"flex-1 bg-[#030712] overflow-y-auto\">\n+                      {/* Gradient background */}\n+                      <div className=\"relative\">\n+                        <div className=\"absolute inset-0 overflow-hidden\">\n+                          <div className=\"absolute inset-x-[-20%] top-[-20%] h-[300px] rounded-full bg-gradient-to-br from-blue-600/30 via-sky-500/20 to-purple-600/10 blur-3xl\" />\n+                        </div>\n+                        {/* Header */}\n+                        <div className=\"relative flex items-center justify-between px-6 py-4\">\n+                          <CmuxLogo height={28} />\n+                          <div className=\"flex items-center gap-4 text-sm text-neutral-300\">\n+                            <a href=\"https://www.cmux.dev/\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"hover:text-white\">About</a>\n+                            <a href=\"https://www.cmux.dev/\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"hover:text-white\">Workflow</a>\n+                            <a href=\"https://github.com/manaflow-ai/cmux\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"hover:text-white\">GitHub</a>\n+                          </div>\n+                          <div className=\"flex items-center gap-3\">\n+                            <div className=\"flex items-center gap-1 text-sm text-neutral-300\">\n+                              <Github className=\"h-4 w-4\" />\n+                              <span>649</span>\n+                            </div>\n+                            <button className=\"px-3 py-1 bg-white text-black text-sm rounded-full flex items-center gap-1.5\">\n+                              <Download className=\"w-3 h-3\" />\n+                              <span>Download</span>\n+                            </button>\n+                          </div>\n+                        </div>\n+                        {/* Hero section */}\n+                        <div className=\"relative px-6 py-6\">\n+                          <div className=\"grid grid-cols-2 gap-6\">\n+                            <div className=\"space-y-4\">\n+                              <h1 className=\"text-white text-2xl font-semibold leading-tight\">\n+                                Universal AI coding agent manager for 10x engineers\n+                              </h1>\n+                              <p className=\"text-sm text-neutral-300 leading-relaxed\">\n+                                cmux is a universal AI coding agent manager that supports Claude Code, Codex, Gemini CLI, Amp, Opencode, and other coding CLIs.\n+                              </p>\n+                              <p className=\"text-sm text-neutral-300 leading-relaxed\">\n+                                Every run spins up an isolated VS Code workspace either in the cloud or in a local Docker container with the git diff view, terminal, and dev server preview ready.\n+                              </p>\n+                              <div className=\"flex items-center gap-3 pt-2\">\n+                                <a href=\"https://www.cmux.dev/\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"px-4 py-2 bg-white text-black text-sm rounded-lg flex items-center gap-2 font-medium hover:bg-neutral-200\">\n+                                  <svg className=\"h-4 w-4\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+                                    <path d=\"M12.665 15.358c-.905.844-1.893.711-2.843.311-1.006-.409-1.93-.427-2.991 0-1.33.551-2.03.391-2.825-.31C-.498 10.886.166 4.078 5.28 3.83c1.246.062 2.114.657 2.843.71 1.09-.213 2.133-.826 3.296-.746 1.393.107 2.446.64 3.138 1.6-2.88 1.662-2.197 5.315.443 6.337-.526 1.333-1.21 2.657-2.345 3.635zM8.03 3.778C7.892 1.794 9.563.16 11.483 0c.268 2.293-2.16 4-3.452 3.777\" />\n+                                  </svg>\n+                                  Download for macOS\n+                                </a>\n+                                <a href=\"https://github.com/manaflow-ai/cmux\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"px-4 py-2 border border-white/10 bg-white/5 text-white text-sm rounded-lg flex items-center gap-2 hover:bg-white/10\">\n+                                  GitHub repo\n+                                  <Github className=\"w-4 h-4\" />\n+                                </a>\n+                              </div>\n+                            </div>\n+                            {/* Right side - video + features */}\n+                            <div className=\"space-y-3\">\n+                              <div className=\"rounded-xl border border-white/10 bg-white/5 p-3\">\n+                                {/* Mini browser with YouTube video */}\n+                                <div className=\"rounded-lg overflow-hidden border border-neutral-700 mb-3\">\n+                                  {/* Mini browser tab bar */}\n+                                  <div className=\"flex items-center bg-[#35363a] h-[20px] px-1.5\">\n+                                    <div className=\"flex items-center gap-1 bg-[#202124] rounded-t px-2 py-0.5\">\n+                                      <div className=\"w-2 h-2 rounded-full bg-red-500\" />\n+                                      <span className=\"text-[8px] text-[#e8eaed] truncate\">YouTube</span>\n+                                    </div>\n+                                  </div>\n+                                  {/* Mini browser toolbar */}\n+                                  <div className=\"flex items-center px-1.5 py-1 bg-[#202124]\">\n+                                    <div className=\"flex-1 px-2 py-0.5 bg-[#35363a] rounded text-[8px] text-[#9aa0a6] truncate\">\n+                                      youtube.com/watch?v=YtQTKSM_wsA\n+                                    </div>\n+                                  </div>\n+                                  {/* Video content */}\n+                                  <a href=\"https://www.youtube.com/watch?v=YtQTKSM_wsA\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"bg-neutral-900 aspect-video flex items-center justify-center cursor-pointer hover:bg-neutral-800 transition-colors block relative\">\n+                                    <img src=\"https://img.youtube.com/vi/YtQTKSM_wsA/hqdefault.jpg\" alt=\"cmux demo video\" className=\"absolute inset-0 w-full h-full object-cover opacity-60\" />\n+                                    <div className=\"relative w-12 h-12 rounded-full bg-red-600 flex items-center justify-center hover:bg-red-500 transition-colors\">\n+                                      <div className=\"w-0 h-0 border-t-[8px] border-t-transparent border-l-[12px] border-l-white border-b-[8px] border-b-transparent ml-1\" />\n+                                    </div>\n+                                  </a>\n+                                </div>\n+                                {/* Feature bullets */}\n+                                <div className=\"space-y-2\">\n+                                  <div className=\"flex gap-3\">\n+                                    <div className=\"mt-0.5 h-5 w-5 flex-none rounded-full bg-gradient-to-br from-sky-500/80 to-indigo-500/80 text-center text-xs font-semibold leading-5 text-white\">\n+                                      &bull;\n+                                    </div>\n+                                    <div>\n+                                      <p className=\"text-sm text-white font-medium\">Run multiple agent CLIs side-by-side</p>\n+                                      <p className=\"text-xs text-neutral-400\">Claude Code, Codex, Gemini CLI, Amp, and more.</p>\n+                                    </div>\n+                                  </div>\n+                                  <div className=\"flex gap-3\">\n+                                    <div className=\"mt-0.5 h-5 w-5 flex-none rounded-full bg-gradient-to-br from-sky-500/80 to-indigo-500/80 text-center text-xs font-semibold leading-5 text-white\">\n+                                      &bull;\n+                                    </div>\n+                                    <div>\n+                                      <p className=\"text-sm text-white font-medium\">Dedicated VS Code instance per agent</p>\n+                                      <p className=\"text-xs text-neutral-400\">Isolated VS Code, terminal, and git diff view.</p>\n+                                    </div>\n+                                  </div>\n+                                  <div className=\"flex gap-3\">\n+                                    <div className=\"mt-0.5 h-5 w-5 flex-none rounded-full bg-gradient-to-br from-sky-500/80 to-indigo-500/80 text-center text-xs font-semibold leading-5 text-white\">\n+                                      &bull;\n+                                    </div>\n+                                    <div>\n+                                      <p className=\"text-sm text-white font-medium\">Preview environments for verification</p>\n+                                      <p className=\"text-xs text-neutral-400\">Browser previews to verify dev server output.</p>\n+                                    </div>\n+                                  </div>\n+                                </div>\n+                              </div>\n+                            </div>\n+                          </div>\n+                          {/* App screenshot preview */}\n+                          <div className=\"mt-6 rounded-lg overflow-hidden border border-white/10 bg-neutral-900 h-[150px]\">\n+                            <div className=\"flex h-full\">\n+                              <div className=\"w-[100px] bg-neutral-950 border-r border-white/10 p-2\">\n+                                <div className=\"text-xs text-neutral-400 space-y-1\">\n+                                  <div className=\"flex items-center gap-1.5\"><Home className=\"w-3 h-3\" /><span>Home</span></div>\n+                                  <div className=\"flex items-center gap-1.5\"><Server className=\"w-3 h-3\" /><span>Environments</span></div>\n+                                  <div className=\"flex items-center gap-1.5\"><Settings className=\"w-3 h-3\" /><span>Settings</span></div>\n+                                </div>\n+                              </div>\n+                              <div className=\"flex-1 bg-neutral-900 p-3\">\n+                                <div className=\"text-xs text-neutral-500 text-center\">cmux dashboard preview</div>\n+                              </div>\n+                            </div>\n+                          </div>\n+                        </div>\n+                      </div>\n+                    </div>\n+                  </div>\n+                </div>\n+              )}\n+\n+              {/* Single panel: Git Diff */}\n+              {viewMode === \"gitDiff\" && (\n+                <div className=\"flex-1 bg-[#1e1e1e] flex flex-col\">\n+                  <div className=\"flex items-center justify-between px-3 py-1.5 bg-[#252526] border-b border-[#2d2d2d] shrink-0\">\n+                    <div className=\"flex items-center gap-2\">\n+                      <GitBranch className=\"h-4 w-4 text-[#f97316]\" />\n+                      <span className=\"text-xs text-[#cccccc]\">Git Diff</span>\n+                      <span className=\"text-[10px] text-[#858585]\">3 files changed</span>\n+                    </div>\n+                    <div className=\"flex items-center gap-1\">\n+                      <button onClick={() => setViewMode(\"all\")} className=\"p-0.5 text-[#858585] hover:text-white hover:bg-[#3c3c3c] rounded text-[10px]\">\n+                        Back to all\n+                      </button>\n+                    </div>\n+                  </div>\n+                  <div className=\"flex-1 flex flex-col min-h-0 overflow-y-auto\" style={{ scrollbarWidth: \"thin\", scrollbarColor: \"#30363d #1e1e1e\" }}>\n+                    {/* File 1 - Modified */}\n+                    <div className=\"border-b border-[#2d2d2d]\">\n+                      <button\n+                        onClick={() => toggleFileCollapse(\"file1\")}\n+                        className=\"flex items-center gap-2 px-4 py-2 bg-[#252526] sticky top-0 w-full text-left hover:bg-[#2a2d2e] transition-colors\"\n+                      >\n+                        {collapsedFiles.has(\"file1\") ? (\n+                          <ChevronRight className=\"h-4 w-4 text-[#858585]\" />\n+                        ) : (\n+                          <ChevronDown className=\"h-4 w-4 text-[#858585]\" />\n+                        )}\n+                        <div className=\"w-2.5 h-2.5 rounded-full bg-yellow-500\" />\n+                        <span className=\"text-sm text-[#cccccc] truncate flex-1\">apps/client/src/components/TaskItem.tsx</span>\n+                        <span className=\"text-xs text-[#3fb950]\">+28</span>\n+                        <span className=\"text-xs text-[#f85149]\">-4</span>\n+                      </button>\n+                      {!collapsedFiles.has(\"file1\") && (\n+                        <div className=\"text-[11px] font-mono\">\n+                          <div className=\"px-4 py-1 text-[#858585] bg-[#1f2733]\">@@ -1,12 +1,15 @@</div>\n+                          <div className=\"flex\"><span className=\"w-10 text-[#858585] text-right pr-3 select-none bg-[#1e1e1e]\">1</span><span className=\"w-10 text-[#858585] text-right pr-3 select-none bg-[#1e1e1e]\">1</span><span className=\"flex-1 px-4 text-[#cccccc]\">import {\"{\"} useState {\"}\"} from &quot;react&quot;;</span></div>\n+                          <div className=\"flex bg-[#f851491a]\"><span className=\"w-10 text-[#ff7b72] text-right pr-3 select-none bg-[#f851494d]\">3</span><span className=\"w-10 text-right pr-3 select-none bg-[#1e1e1e]\"></span><span className=\"flex-1 px-4 text-[#f85149]\">-import {\"{\"} api {\"}\"} from &quot;@/convex&quot;;</span></div>\n+                          <div className=\"flex bg-[#2ea04326]\"><span className=\"w-10 text-right pr-3 select-none bg-[#1e1e1e]\"></span><span className=\"w-10 text-[#7ee787] text-right pr-3 select-none bg-[#3fb9504d]\">3</span><span className=\"flex-1 px-4 text-[#3fb950]\">+import {\"{\"} api {\"}\"} from &quot;@cmux/convex/api&quot;;</span></div>\n+                          <div className=\"px-4 py-1 text-[#858585] bg-[#1f2733]\">... 18 unchanged lines ...</div>\n+                        </div>\n+                      )}\n+                    </div>\n+\n+                    {/* File 2 - Added */}\n+                    <div className=\"border-b border-[#2d2d2d]\">\n+                      <button\n+                        onClick={() => toggleFileCollapse(\"file2\")}\n+                        className=\"flex items-center gap-2 px-4 py-2 bg-[#252526] sticky top-0 w-full text-left hover:bg-[#2a2d2e] transition-colors\"\n+                      >\n+                        {collapsedFiles.has(\"file2\") ? (\n+                          <ChevronRight className=\"h-4 w-4 text-[#858585]\" />\n+                        ) : (\n+                          <ChevronDown className=\"h-4 w-4 text-[#858585]\" />\n+                        )}\n+                        <div className=\"w-2.5 h-2.5 rounded-full bg-green-500\" />\n+                        <span className=\"text-sm text-[#cccccc] truncate flex-1\">apps/client/src/lib/utils.ts</span>\n+                        <span className=\"text-xs text-[#3fb950]\">+45</span>\n+                        <span className=\"text-xs text-[#858585]\">-0</span>\n+                      </button>\n+                      {!collapsedFiles.has(\"file2\") && (\n+                        <div className=\"text-[11px] font-mono\">\n+                          <div className=\"px-4 py-1 text-[#858585] bg-[#1f2733]\">@@ -0,0 +1,45 @@</div>\n+                          <div className=\"flex bg-[#2ea04326]\"><span className=\"w-10 text-right pr-3 select-none bg-[#1e1e1e]\"></span><span className=\"w-10 text-[#7ee787] text-right pr-3 select-none bg-[#3fb9504d]\">1</span><span className=\"flex-1 px-4 text-[#3fb950]\">+export function isFakeConvexId(id: string): boolean {\"{\"}</span></div>\n+                          <div className=\"flex bg-[#2ea04326]\"><span className=\"w-10 text-right pr-3 select-none bg-[#1e1e1e]\"></span><span className=\"w-10 text-[#7ee787] text-right pr-3 select-none bg-[#3fb9504d]\">2</span><span className=\"flex-1 px-4 text-[#3fb950]\">+  return id.startsWith(&quot;fake_&quot;);</span></div>\n+                          <div className=\"flex bg-[#2ea04326]\"><span className=\"w-10 text-right pr-3 select-none bg-[#1e1e1e]\"></span><span className=\"w-10 text-[#7ee787] text-right pr-3 select-none bg-[#3fb9504d]\">3</span><span className=\"flex-1 px-4 text-[#3fb950]\">+{\"}\"}</span></div>\n+                          <div className=\"px-4 py-1 text-[#858585] bg-[#1f2733]\">... 42 more lines ...</div>\n+                        </div>\n+                      )}\n+                    </div>\n+\n+                    {/* File 3 - Deleted */}\n+                    <div className=\"border-b border-[#2d2d2d]\">\n+                      <button\n+                        onClick={() => toggleFileCollapse(\"file3\")}\n+                        className=\"flex items-center gap-2 px-4 py-2 bg-[#252526] sticky top-0 w-full text-left hover:bg-[#2a2d2e] transition-colors\"\n+                      >\n+                        {collapsedFiles.has(\"file3\") ? (\n+                          <ChevronRight className=\"h-4 w-4 text-[#858585]\" />\n+                        ) : (\n+                          <ChevronDown className=\"h-4 w-4 text-[#858585]\" />\n+                        )}\n+                        <div className=\"w-2.5 h-2.5 rounded-full bg-red-500\" />\n+                        <span className=\"text-sm text-[#cccccc] truncate flex-1\">apps/client/src/legacy/helpers.ts</span>\n+                        <span className=\"text-xs text-[#858585]\">+0</span>\n+                        <span className=\"text-xs text-[#f85149]\">-12</span>\n+                      </button>\n+                      {!collapsedFiles.has(\"file3\") && (\n+                        <div className=\"text-[11px] font-mono\">\n+                          <div className=\"px-4 py-1 text-[#858585] bg-[#1f2733]\">@@ -1,12 +0,0 @@</div>\n+                          <div className=\"flex bg-[#f851491a]\"><span className=\"w-10 text-[#ff7b72] text-right pr-3 select-none bg-[#f851494d]\">1</span><span className=\"w-10 text-right pr-3 select-none bg-[#1e1e1e]\"></span><span className=\"flex-1 px-4 text-[#f85149]\">-// Legacy helper functions</span></div>\n+                          <div className=\"flex bg-[#f851491a]\"><span className=\"w-10 text-[#ff7b72] text-right pr-3 select-none bg-[#f851494d]\">2</span><span className=\"w-10 text-right pr-3 select-none bg-[#1e1e1e]\"></span><span className=\"flex-1 px-4 text-[#f85149]\">-export function oldHelper() {\"{\"}</span></div>\n+                          <div className=\"px-4 py-1 text-[#858585] bg-[#1f2733]\">... 10 more lines ...</div>\n+                        </div>\n+                      )}\n+                    </div>\n+                  </div>\n+                </div>\n+              )}\n+\n+              {/* Single panel: Terminals */}\n+              {viewMode === \"terminals\" && (\n+                <div className=\"flex-1 bg-[#0d1117] flex flex-col\">\n+                  {/* Terminal tab bar */}\n+                  <div className=\"flex items-center bg-[#161b22] border-b border-[#30363d] shrink-0\">\n+                    <div className=\"flex items-center gap-2 px-3 py-1.5 bg-[#0d1117] border-r border-[#30363d] text-[#c9d1d9]\">\n+                      <TerminalSquare className=\"h-3.5 w-3.5\" />\n+                      <span className=\"text-xs\">Terminal 1</span>\n+                    </div>\n+                    <div className=\"ml-auto pr-2\">\n+                      <button onClick={() => setViewMode(\"all\")} className=\"p-1 text-[#8b949e] hover:text-white hover:bg-[#30363d] rounded text-[10px]\">\n+                        Back to all\n+                      </button>\n+                    </div>\n+                  </div>\n+                  {/* Terminal content */}\n+                  <div className=\"flex-1 bg-[#0d1117] px-3 pt-2 pb-2 font-mono text-[11px] overflow-auto flex flex-col\" style={{ fontFamily: \"'Menlo', 'Monaco', 'Courier New', monospace\" }}>\n+                    <div className=\"flex-1 leading-[1.4]\">\n+                      {/* Session 0: bunx - Claude Code output */}\n+                      {activeTmuxSession === 0 && (\n+                        <>\n+                          <div className=\"text-[#8b949e]\">$ claude</div>\n+                          <div className=\"mt-2\" />\n+                          <div className=\"text-[#58a6ff]\">╭─────────────────────────────────────────╮</div>\n+                          <div className=\"text-[#58a6ff]\">│ <span className=\"text-[#f0883e]\">Claude Code</span> v1.0.32                    │</div>\n+                          <div className=\"text-[#58a6ff]\">╰─────────────────────────────────────────╯</div>\n+                          <div className=\"mt-2\" />\n+                          <div className=\"text-[#7ee787]\">? What would you like to do?</div>\n+                          <div className=\"mt-1\" />\n+                          <div className=\"text-[#c9d1d9]\">  Fix the VS Code link visibility issue</div>\n+                          <div className=\"mt-2\" />\n+                          <div className=\"text-[#8b949e]\">Analyzing codebase...</div>\n+                          <div className=\"text-[#8b949e]\">Found 3 relevant files</div>\n+                          <div className=\"mt-2\" />\n+                          <div className=\"text-[#7ee787]\">✓ Updated apps/client/src/components/TaskItem.tsx</div>\n+                          <div className=\"text-[#c9d1d9] pl-2\">Added isLocalWorkspace check to hasActiveVSCode</div>\n+                          <div className=\"mt-2\" />\n+                          <div className=\"flex items-center text-[#c9d1d9]\">\n+                            <span className=\"text-[#f0883e]\">&gt;</span>\n+                            <span className=\"ml-1 animate-pulse\">█</span>\n+                          </div>\n+                        </>\n+                      )}\n+                      {/* Session 1: maintenance - bun install output */}\n+                      {activeTmuxSession === 1 && (\n+                        <>\n+                          <div className=\"text-[#8b949e]\">$ /var/tmp/cmux-scripts/maintenance.sh</div>\n+                          <div className=\"text-[#7ee787]\">=== Maintenance Script Started at 09:41 ===</div>\n+                          <div className=\"mt-1\" />\n+                          <div className=\"text-[#c9d1d9]\">/var/tmp/cmux-scripts/maintenance.sh:10&gt; bun i</div>\n+                          <div className=\"text-[#58a6ff]\">bun install v1.3.3 (274e01c7)</div>\n+                          <div className=\"mt-1\" />\n+                          <div className=\"text-[#c9d1d9]\">Checked 3029 installs across 2077 packages (no changes) [4.96s]</div>\n+                          <div className=\"mt-1\" />\n+                          <div className=\"text-[#8b949e]\">/var/tmp/cmux-scripts/maintenance.sh:11&gt; echo &apos;=== Maintenance Script Completed ===&apos;</div>\n+                          <div className=\"text-[#7ee787]\">=== Maintenance Script Completed at 09:41 ===</div>\n+                          <div className=\"mt-2\" />\n+                          <div className=\"text-[#c9d1d9]\">root 0:b;270;0t</div>\n+                          <div className=\"flex items-center text-[#c9d1d9]\">\n+                            <span className=\"text-[#8b949e]\">$</span>\n+                            <span className=\"ml-1 animate-pulse\">█</span>\n+                          </div>\n+                        </>\n+                      )}\n+                      {/* Session 2: dev - server logs */}\n+                      {activeTmuxSession === 2 && (\n+                        <>\n+                          <div><span className=\"text-[#f0883e]\">[SERVER]</span> <span className=\"text-[#8b949e]\">[native.refs]</span> <span className=\"text-[#c9d1d9]\">start headRefOrigin/cmux/add-mock-example-to-preview-front-page</span></div>\n+                          <div><span className=\"text-[#f0883e]\">[SERVER]</span> <span className=\"text-[#8b949e]\">[native.refs]</span> <span className=\"text-[#c9d1d9]\">adfasdfadfa...asdfasdfasdfadsf</span></div>\n+                          <div><span className=\"text-[#58a6ff]\">[WWW]</span> <span className=\"text-[#c9d1d9]\">Request url: http://localhost:9779/api/iframe/preflight</span></div>\n+                          <div><span className=\"text-[#58a6ff]\">[WWW]</span> <span className=\"text-[#7ee787]\">--&gt;</span> <span className=\"text-[#c9d1d9]\">OPTIONS /api/iframe/preflight</span> <span className=\"text-[#7ee787]\">204</span> <span className=\"text-[#8b949e]\">0ms</span></div>\n+                          <div><span className=\"text-[#58a6ff]\">[WWW]</span> <span className=\"text-[#7ee787]\">--&gt;</span> <span className=\"text-[#c9d1d9]\">GET /api/iframe/preflight</span> <span className=\"text-[#7ee787]\">200</span> <span className=\"text-[#8b949e]\">in 41ms</span></div>\n+                          <div><span className=\"text-[#58a6ff]\">[WWW]</span> <span className=\"text-[#7ee787]\">--&gt;</span> <span className=\"text-[#c9d1d9]\">GET /api/iframe/preflight?url=...morphvn</span> <span className=\"text-[#7ee787]\">200</span> <span className=\"text-[#8b949e]\">in 720ms</span></div>\n+                          <div className=\"mt-1\" />\n+                          <div><span className=\"text-[#a371f7]\">[CONVEX-DEV]</span> <span className=\"text-[#8b949e]\">12/5/2025, 9:30:48 AM</span> <span className=\"text-[#c9d1d9]\">[LOG] &apos;preview-jobs-http&apos; Completing preview job</span></div>\n+                          <div><span className=\"text-[#a371f7]\">[CONVEX-DEV]</span> <span className=\"text-[#c9d1d9]\">  taskRunId: &apos;adfasdfasdfasdfasdfasdfasdfasdfasdfasdf&apos;,</span></div>\n+                          <div><span className=\"text-[#a371f7]\">[CONVEX-DEV]</span> <span className=\"text-[#c9d1d9]\">  previewRunId: &apos;adsfsadfasdfasdfasdfasdf&apos;,</span></div>\n+                          <div><span className=\"text-[#a371f7]\">[CONVEX-DEV]</span> <span className=\"text-[#c9d1d9]\">  imageCount: 8</span></div>\n+                          <div className=\"mt-1\" />\n+                          <div><span className=\"text-[#a371f7]\">[CONVEX-DEV]</span> <span className=\"text-[#8b949e]\">12/5/2025, 9:30:51 AM</span> <span className=\"text-[#7ee787]\">[LOG] Successfully posted preview comment</span></div>\n+                          <div><span className=\"text-[#a371f7]\">[CONVEX-DEV]</span> <span className=\"text-[#c9d1d9]\">  prNumber: 1173,</span></div>\n+                          <div><span className=\"text-[#a371f7]\">[CONVEX-DEV]</span> <span className=\"text-[#c9d1d9]\">  commentId: 3616083966,</span></div>\n+                          <div className=\"mt-1\" />\n+                          <div><span className=\"text-[#79c0ff]\">[CLIENT]</span> <span className=\"text-[#8b949e]\">9:33:46 AM</span> <span className=\"text-[#c9d1d9]\">[vite] (client) hmr update /src/index.css</span></div>\n+                          <div><span className=\"text-[#79c0ff]\">[CLIENT]</span> <span className=\"text-[#8b949e]\">9:34:28 AM</span> <span className=\"text-[#c9d1d9]\">[vite] (client) hmr update /src/components/TaskTree.tsx</span></div>\n+                          {isPRMerged && (\n+                            <>\n+                              <div className=\"mt-1\" />\n+                              <div><span className=\"text-[#a371f7]\">[CONVEX-DEV]</span> <span className=\"text-[#8b949e]\">12/5/2025, 9:40:44 AM</span> <span className=\"text-[#c9d1d9]\">[LOG] &apos;PR merge handler&apos; Processing PR event</span></div>\n+                              <div><span className=\"text-[#a371f7]\">[CONVEX-DEV]</span> <span className=\"text-[#c9d1d9]\">  prNumber: 1168, isMerged: true, action: &apos;closed&apos;</span></div>\n+                              <div><span className=\"text-[#a371f7]\">[CONVEX-DEV]</span> <span className=\"text-[#c9d1d9]\">  Manaflow is always looking for the very best engineering talent. Please austin[at]manaflow.com to find the perfect fit. </span></div>\n+                            </>\n+                          )}\n+                        </>\n+                      )}\n+                    </div>\n+                    {/* Interactive input area */}\n+                    <div className=\"mt-2 flex items-center text-[#c9d1d9]\">\n+                      <span className=\"text-[#8b949e] mr-1\">$</span>\n+                      <input\n+                        type=\"text\"\n+                        value={terminalInput}\n+                        onChange={(e) => setTerminalInput(e.target.value)}\n+                        className=\"flex-1 bg-transparent outline-none border-none text-[#c9d1d9] caret-white\"\n+                        placeholder=\"\"\n+                        autoFocus\n+                      />\n+                    </div>\n+                  </div>\n+                  {/* tmux status bar */}\n+                  <div className=\"flex items-center justify-between px-1 py-0.5 bg-[#238636] text-white text-[11px] shrink-0\">\n+                    <div className=\"flex items-center\">\n+                      <span className=\"text-[#7ee787] font-medium px-2\">[cmux]</span>\n+                      {[\n+                        { id: 0, name: \"bunx\" },\n+                        { id: 1, name: \"maintenance\" },\n+                        { id: 2, name: \"dev\" },\n+                      ].map((session) => (\n+                        <button\n+                          key={session.id}\n+                          onClick={() => setActiveTmuxSession(session.id)}\n+                          className={clsx(\n+                            \"px-2 py-0.5 transition-colors\",\n+                            activeTmuxSession === session.id\n+                              ? \"bg-[#2ea043] text-white font-medium\"\n+                              : \"hover:bg-[#2ea043]/50 text-white/90\"\n+                          )}\n+                        >\n+                          {session.id}:{session.name}{activeTmuxSession === session.id ? \"*\" : \"\"}\n+                        </button>\n+                      ))}\n+                    </div>\n+                    <div className=\"flex items-center gap-3 px-2\">\n+                      <span className=\"text-white/90\">09:41</span>\n+                      <span className=\"text-white/90\">05-Dec-25</span>\n+                    </div>\n+                  </div>\n+                </div>\n+              )}\n+            </div>\n+          </div>\n+        )}\n+      </div>\n+    </div>\n+  );\n+}\n+\n /**\n  * Shown in popup after GitHub App installation completes.\n  * Sends message to opener and auto-closes after delay.\n@@ -1179,6 +3287,9 @@ function PreviewDashboardInner({\n         </div>\n       </div>\n \n+      {/* Mock GitHub PR browser demo */}\n+      <MockGitHubPRBrowser />\n+\n       <AlertDialog\n         open={configPendingDelete !== null}\n         onOpenChange={(open) => {\n","comments":[{"type":"issue_comment","id":3614540670,"prNumber":1173,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7c6jt8h3qyqvgv0rqbp0w6q17wnxdw?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7c6jt8h3qyqvgv0rqbp0w6q17wnxdw/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1173?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 8 screenshots for commit `79dbd8c` (2025-12-04 22:17:10.102 UTC).\n\n**Full-page screenshot of the entire preview dashboard showing all sections including the new 'See it in action' mockup**\n\n![full-page-preview-dashboard.png](https://famous-camel-162.convex.cloud/api/storage/b93b6a70-33ac-4452-ad70-01deefc58885)\n\n**NEW: Detailed view of the mock GitHub PR browser showing the browser UI, URL bar, and GitHub interface**\n\n![github-pr-mockup-browser.png](https://famous-camel-162.convex.cloud/api/storage/440ab4bb-8fee-4aff-b8da-40a065ff74fb)\n\n**NEW: Mock bot comment showing 'Preview Screenshots' heading with links and screenshot count**\n\n![mock-comment-with-screenshots.png](https://famous-camel-162.convex.cloud/api/storage/13afbef7-6aad-4bbc-bb0d-8e4c34f3176e)\n\n**NEW: Mock PR header showing merged status, commit info, and navigation tabs \\(Conversation, Commits, Checks, Files changed\\)**\n\n![mock-pr-header-and-tabs.png](https://famous-camel-162.convex.cloud/api/storage/7d02bbc4-7cd4-48cd-b72e-8029f7d62344)\n\n**NEW: Example screenshots embedded in the mock PR comment showing workspace configuration screenshots**\n\n![mock-screenshot-examples.png](https://famous-camel-162.convex.cloud/api/storage/a8ccacc1-3292-4f52-9c6e-513b34c7844d)\n\n**Header section with title 'Screenshot previews for GitHub PRs' and repository URL input box**\n\n![preview-dashboard-header.png](https://famous-camel-162.convex.cloud/api/storage/46496409-1170-4dc8-9a6f-3dd1cecc82f9)\n\n**Repository selection area and 'What is preview.new?' information cards showing features**\n\n![repository-selection-and-info.png](https://famous-camel-162.convex.cloud/api/storage/48990949-68c9-4ca0-930e-a10aff646a2a)\n\n**NEW: 'See it in action' section showing the mock GitHub PR browser window with macOS-style chrome**\n\n![see-it-in-action-section.png](https://famous-camel-162.convex.cloud/api/storage/6f6bd658-c693-4888-9f15-9b114eb2499a)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"d8e6ee9102682aa38e4432c257239368c48157ea","createdAt":"2025-12-04T22:17:12Z","updatedAt":"2025-12-04T22:42:47Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1173#issuecomment-3614540670"},{"type":"issue_comment","id":3614542671,"prNumber":1173,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.dev/manaflow/task/kn7epcnrgntks340a3xgcgxqth7wmehz?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.dev/manaflow/task/kn7epcnrgntks340a3xgcgxqth7wmehz/run/kd78ncvwbrfs88j7vbrcv9b5ad7wmady/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1173?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 9 screenshots for commit `79dbd8c` (2025-12-04 22:17:43.532 UTC).\n\n**Close-up of the browser chrome with macOS-style traffic lights, URL bar, and GitHub PR header showing 'reuse preview config component' PR \\#1124**\n\n![browser-chrome-and-header.png](https://adorable-wombat-701.convex.cloud/api/storage/8dcdcaea-e3fe-4ccd-b493-965a4ce10cb6)\n\n**Bottom of the PR comment showing the footer with 'Generated by cmux preview system' text and reaction buttons \\(+1, rocket emojis\\)**\n\n![comment-footer-with-reactions.png](https://adorable-wombat-701.convex.cloud/api/storage/77172824-29ae-4427-a922-2006a3224a7d)\n\n**View of the screenshot gallery showing the embedded preview images from the mock PR comment**\n\n![expanded-screenshot-view.png](https://adorable-wombat-701.convex.cloud/api/storage/b39f1251-4a89-4c68-875d-a441c71b9ca2)\n\n**Detailed view of the mock GitHub PR browser window with authentic GitHub dark theme styling, showing the PR interface**\n\n![mock-github-pr-browser.png](https://adorable-wombat-701.convex.cloud/api/storage/19b5794c-7f61-46a2-a6f1-abb29facc294)\n\n**GitHub PR comment from cmux-agent bot showing the 'Preview Screenshots' heading with links to workspace and dev browser**\n\n![pr-comment-with-screenshots.png](https://adorable-wombat-701.convex.cloud/api/storage/b7fc858a-5368-4999-b732-33f07e45d894)\n\n**Full-page screenshot of the entire preview page showing all sections including the new 'See it in action' mock GitHub PR browser at the bottom**\n\n![preview-page-full.png](https://adorable-wombat-701.convex.cloud/api/storage/6c90f608-341f-40da-9427-48b4caa2645e)\n\n**Top section of the preview page showing the main heading 'Screenshot previews for GitHub PRs' and the repository URL input field**\n\n![preview-page-header.png](https://adorable-wombat-701.convex.cloud/api/storage/d29ff83f-4c30-4992-87f8-1cc5df1a6055)\n\n**Screenshot gallery within the PR comment showing 5 example screenshots with descriptive captions for each image**\n\n![screenshot-gallery-in-comment.png](https://adorable-wombat-701.convex.cloud/api/storage/55b71660-c826-42d1-ab3a-2585e9120fdf)\n\n**The new 'See it in action' section showing the mock GitHub PR browser window in the viewport**\n\n![see-it-in-action-section.png](https://adorable-wombat-701.convex.cloud/api/storage/0f96b44e-f333-4f00-b05c-9ac9ca7c89e1)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"d8e6ee9102682aa38e4432c257239368c48157ea","createdAt":"2025-12-04T22:17:44Z","updatedAt":"2025-12-04T22:42:27Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1173#issuecomment-3614542671"},{"type":"issue_comment","id":3614616822,"prNumber":1173,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.dev/manaflow/task/kn716psd12w9zk5w73pc4v2d797wmqya?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.dev/manaflow/task/kn716psd12w9zk5w73pc4v2d797wmqya/run/kd764aw85s768eh1c66vbmwsbh7wnf80/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1173?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 8 screenshots for commit `7eb8c40` (2025-12-04 22:42:25.498 UTC).\n\n**Bot comment showing screenshot thumbnails with captions and expandable image previews**\n\n![bot-comment-screenshot-thumbnails.png](https://adorable-wombat-701.convex.cloud/api/storage/41fbf5fe-2f84-4ecf-b19a-332e5d5ddc1e)\n\n**cmux-agent bot comment showing Preview Screenshots header with links and screenshot count**\n\n![bot-comment-with-screenshots.png](https://adorable-wombat-701.convex.cloud/api/storage/77b3fd39-a832-4581-9354-2e4349ec0263)\n\n**Full-page screenshot of the preview.new homepage showing the complete UI including the new mock GitHub PR browser section**\n\n![full-preview-page.png](https://adorable-wombat-701.convex.cloud/api/storage/ec60e714-3088-484e-9151-332760d8a659)\n\n**GitHub PR header showing merged status, author info, and navigation tabs \\(Conversation, Commits, Checks, Files changed\\)**\n\n![github-pr-header-and-tabs.png](https://adorable-wombat-701.convex.cloud/api/storage/674388f0-66ce-4669-899e-a25b3cc80553)\n\n**Mock GitHub PR browser window showing macOS-style chrome with URL bar and GitHub branding**\n\n![mock-browser-with-chrome-header.png](https://adorable-wombat-701.convex.cloud/api/storage/8fb4f935-e271-47ca-b09f-20cd89dd9a50)\n\n**Full view of the mock GitHub PR browser showing the entire conversation thread**\n\n![mock-github-pr-browser-full.png](https://adorable-wombat-701.convex.cloud/api/storage/0fb897e2-ac47-4bc6-9cda-ff82cd291f92)\n\n**NEW: PR timeline showing 'austinywang opened this pull request' event - this is the key UI change from this PR**\n\n![pr-timeline-top-opened-pr.png](https://adorable-wombat-701.convex.cloud/api/storage/86b4c44f-c942-4e11-9f2c-e9712520e3e3)\n\n**NEW: Complete timeline view with user avatar, PR description comment with Summary and Changes sections, and commit event**\n\n![pr-timeline-with-conversation.png](https://adorable-wombat-701.convex.cloud/api/storage/bf86a12f-c019-4c1a-a1e0-84ce6a8489da)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"d8e6ee9102682aa38e4432c257239368c48157ea","createdAt":"2025-12-04T22:42:26Z","updatedAt":"2025-12-04T23:02:30Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1173#issuecomment-3614616822"},{"type":"issue_comment","id":3614617510,"prNumber":1173,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7f442ckkmmjj1745jmkk91dn7wneaf?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7f442ckkmmjj1745jmkk91dn7wneaf/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1173?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 9 screenshots for commit `7eb8c40` (2025-12-04 22:42:43.424 UTC).\n\n**The cmux-agent bot comment section showing 'Preview Screenshots' heading with links to workspace, dev browser, and diff heatmap**\n\n![bot-comment-preview-screenshots.png](https://famous-camel-162.convex.cloud/api/storage/f9845ef7-e186-47ba-b3b7-c624c2c4873f)\n\n**First embedded screenshot example showing workspace configuration screens with captions describing the UI changes**\n\n![embedded-screenshot-examples-1.png](https://famous-camel-162.convex.cloud/api/storage/0bd8ba80-d1cd-4584-9d29-f7998617cb1e)\n\n**Second set of embedded screenshot examples showing more workspace configuration views**\n\n![embedded-screenshot-examples-2.png](https://famous-camel-162.convex.cloud/api/storage/fe771926-c55c-413f-b497-d1a6151a5a15)\n\n**Third set of embedded screenshot examples and the footer with emoji reactions and 'Generated by cmux preview system' attribution**\n\n![embedded-screenshot-examples-3.png](https://famous-camel-162.convex.cloud/api/storage/92aca126-52b4-4dc8-8b8d-cc02cf8b13dc)\n\n**GitHub PR conversation view showing the PR tabs \\(Conversation, Commits, Checks, Files changed\\), user comment, and timeline**\n\n![github-pr-conversation-viewport.png](https://famous-camel-162.convex.cloud/api/storage/6d422c5f-f946-4ae4-bf68-1f766d4901db)\n\n**Close-up of the mock browser chrome with traffic lights, URL bar showing 'github.com/manaflow-ai/cmux/pull/1124', and GitHub repository header**\n\n![mock-browser-chrome-and-github-header.png](https://famous-camel-162.convex.cloud/api/storage/bf7559b8-d24e-4940-84b1-10d479d3cead)\n\n**Full-page screenshot showing the entire preview dashboard including the new 'See it in action' mock GitHub PR browser section at the bottom**\n\n![preview-dashboard-full-page.png](https://famous-camel-162.convex.cloud/api/storage/2cd2196b-9392-4ace-9f95-65be08535c54)\n\n**Top section of the preview dashboard showing the header, title, repository setup input, and the grid layout with 'Choose a repository' and 'What is preview.new?' sections**\n\n![preview-dashboard-header-viewport.png](https://famous-camel-162.convex.cloud/api/storage/6b528439-0e4d-4727-a8a9-114e96f26d83)\n\n**The new 'See it in action' section showing the mock GitHub PR browser window with macOS-style chrome \\(traffic lights\\) and GitHub header**\n\n![see-it-in-action-section-viewport.png](https://famous-camel-162.convex.cloud/api/storage/b252d805-517d-46e4-8aa5-fd9c6c168e6b)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"d8e6ee9102682aa38e4432c257239368c48157ea","createdAt":"2025-12-04T22:42:46Z","updatedAt":"2025-12-04T22:54:49Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1173#issuecomment-3614617510"},{"type":"issue_comment","id":3614654524,"prNumber":1173,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn71dx202hb7z5rf5m85e55kmh7wnq5r?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn71dx202hb7z5rf5m85e55kmh7wnq5r/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1173?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 7 screenshots for commit `98d3bb7` (2025-12-04 22:54:45.640 UTC).\n\n**Full-page screenshot of the entire preview dashboard showing all sections including the new 'See it in action' mock GitHub PR browser**\n\n![full-page-preview-dashboard.png](https://famous-camel-162.convex.cloud/api/storage/09cc0724-879c-446a-bbcb-8cc255db4f24)\n\n**Header and hero section showing the title 'Screenshot previews for GitHub PRs' and the repository URL input field**\n\n![header-and-hero-section.png](https://famous-camel-162.convex.cloud/api/storage/11fbb224-15a9-432d-9c8e-1ae60c3251f7)\n\n**Mock GitHub PR showing the cmux-agent bot comment with 'Preview Screenshots' header and links to workspace and dev browser**\n\n![mock-github-pr-bot-comment-preview-screenshots.png](https://famous-camel-162.convex.cloud/api/storage/e6192fa3-0259-4205-94e6-2386f8f13757)\n\n**Detailed view of the mock GitHub PR browser with macOS-style window chrome, URL bar, and GitHub PR details**\n\n![mock-github-pr-browser-chrome.png](https://famous-camel-162.convex.cloud/api/storage/109ff4da-92d7-4de9-9488-a476b6e69eca)\n\n**The new 'See it in action' section with mock GitHub PR browser window showing the browser chrome and PR header**\n\n![mock-github-pr-browser-section.png](https://famous-camel-162.convex.cloud/api/storage/6a812f84-988e-4639-b769-65ef5e4b3f66)\n\n**Bottom section of the mock bot comment showing the actual screenshot images that would be captured and posted to PRs**\n\n![mock-github-pr-screenshot-images.png](https://famous-camel-162.convex.cloud/api/storage/b66cc9d4-eb36-4cb4-90be-cb339fe72837)\n\n**Repository chooser and features section showing team selection, GitHub account selector, and 'What is preview.new?' feature cards**\n\n![repository-chooser-and-features.png](https://famous-camel-162.convex.cloud/api/storage/4e6ea4cc-7a6f-4020-bcf4-ad37659a429c)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"d8e6ee9102682aa38e4432c257239368c48157ea","createdAt":"2025-12-04T22:54:48Z","updatedAt":"2025-12-04T22:54:48Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1173#issuecomment-3614654524"},{"type":"issue_comment","id":3614670678,"prNumber":1173,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.dev/austin-dev/task/kn7ddtqwz04xqm396n235876yn7wnyr3?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.dev/austin-dev/task/kn7ddtqwz04xqm396n235876yn7wnyr3/run/kd7agk2h2pha2db5g45fqhcnds7wn1xr/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1173?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 9 screenshots for commit `1e51755` (2025-12-04 23:02:28.793 UTC).\n\n**Bot comment by 'cmux-agent' showing 'Preview Screenshots' heading with links to Open Workspace, Open Dev Browser, and Open Diff Heatmap, plus screenshot count information**\n\n![bot-comment-preview-screenshots.png](https://famous-camel-162.convex.cloud/api/storage/8a144490-b608-4660-ac71-abd775ad75bd)\n\n**Full page screenshot of the preview dashboard showing all sections including the new 'See it in action' mock GitHub PR browser demo at the bottom**\n\n![full-page-preview-dashboard.png](https://famous-camel-162.convex.cloud/api/storage/dcca793b-987c-4839-9821-00d4bbdc221c)\n\n**GitHub PR header showing PR title 'reuse preview config component for step by step re 6k4tq \\#1124', merged status badge, and navigation tabs \\(Conversation, Commits, Checks, Files changed\\)**\n\n![github-pr-header-and-tabs.png](https://famous-camel-162.convex.cloud/api/storage/c17f5e9b-d861-4ac2-a8ad-d79a78c1383c)\n\n**Mock GitHub PR browser component showing the browser chrome with traffic light controls and URL bar displaying github.com/manaflow-ai/cmux/pull/1124**\n\n![mock-github-pr-browser-component.png](https://famous-camel-162.convex.cloud/api/storage/9c4a33e0-96a7-4e9e-9374-c6f6d01b56d0)\n\n**Additional screenshot examples in the bot comment showing more workspace configuration views and the footer with 'Generated by cmux preview system' attribution**\n\n![more-screenshot-examples.png](https://famous-camel-162.convex.cloud/api/storage/ac140abf-2b1b-43e7-8356-be4b43b3eb3a)\n\n**Page header with title 'Screenshot previews for GitHub PRs' and repository URL input field**\n\n![page-header-and-input.png](https://famous-camel-162.convex.cloud/api/storage/f25339b1-1f0a-484a-9a17-ba43173e1270)\n\n**Repository selection interface and 'What is preview.new?' info cards showing Computer use agent, GitHub comments, and Isolated dev servers features**\n\n![repository-selection-and-info-sections.png](https://famous-camel-162.convex.cloud/api/storage/1521a23c-8def-48cd-8897-1dcc872cbec8)\n\n**First set of screenshot examples embedded in the bot's PR comment, showing captions and preview images of the workspace configuration screens**\n\n![screenshot-examples-in-pr-comment.png](https://famous-camel-162.convex.cloud/api/storage/a059770d-1581-4560-a9db-f62b0a963597)\n\n**The new 'See it in action' section showing the mock GitHub PR browser with macOS-style window chrome and GitHub UI**\n\n![see-it-in-action-section-view.png](https://famous-camel-162.convex.cloud/api/storage/d13e8df1-6514-4774-869f-a1ad67aa503f)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"d8e6ee9102682aa38e4432c257239368c48157ea","createdAt":"2025-12-04T23:02:29Z","updatedAt":"2025-12-04T23:24:29Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1173#issuecomment-3614670678"},{"type":"issue_comment","id":3614717628,"prNumber":1173,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.dev/manaflow/task/kn74d9enk4s70k8y513nenr32d7wn7c1?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.dev/manaflow/task/kn74d9enk4s70k8y513nenr32d7wn7c1/run/kd757xyhmdrqhvjmtnzcjaq0gs7wn5t2/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1173?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 10 screenshots for commit `1e51755` (2025-12-04 23:24:26.669 UTC).\n\n**Middle section showing configured repositories list and 'From the creators of' section**\n\n![configured-repositories-section.png](https://adorable-wombat-701.convex.cloud/api/storage/d586fff7-d045-47a4-98a2-1a0e839fbc71)\n\n**Mock cmux-agent bot comment showing the 'Preview Screenshots' header with links to Open Workspace, Open Dev Browser, and Open Diff Heatmap**\n\n![mock-bot-comment-preview-screenshots-header.png](https://adorable-wombat-701.convex.cloud/api/storage/ffd55f3f-d5e0-4bb2-845c-e35b7aa03afd)\n\n**Mock GitHub PR browser showing the browser chrome, GitHub header with manaflow-ai/cmux repo, and PR title 'reuse preview config component for step by step re 6k4tq \\#1124'**\n\n![mock-github-pr-browser-header.png](https://adorable-wombat-701.convex.cloud/api/storage/e80c8849-ffcf-4cc7-b09c-c60d141ff1d6)\n\n**GitHub PR conversation tab showing the PR description comment by austinywang with Summary and Changes sections**\n\n![mock-github-pr-conversation.png](https://adorable-wombat-701.convex.cloud/api/storage/e344f2df-4f23-482c-b1ec-3f702c3257fb)\n\n**First part of the mock screenshots list showing screenshot thumbnails with captions for the initial setup screen and header section**\n\n![mock-screenshots-list-part1.png](https://adorable-wombat-701.convex.cloud/api/storage/7e3c9f3b-0b66-4e90-9db1-deefefeb4ef5)\n\n**Middle part of the mock screenshots list showing more screenshot thumbnails including framework preset selector and workspace configuration views**\n\n![mock-screenshots-list-part2.png](https://adorable-wombat-701.convex.cloud/api/storage/c4cd84ce-7f1d-428f-9967-29397c9899e9)\n\n**Bottom part of the mock screenshots list showing the final screenshots and the 'Generated by cmux preview system' footer with reaction buttons**\n\n![mock-screenshots-list-part3.png](https://adorable-wombat-701.convex.cloud/api/storage/71a32183-fbc9-454c-bf01-dd430da5ce1f)\n\n**Full page screenshot showing the entire preview page including the new 'See it in action' section with mock GitHub PR browser at the bottom**\n\n![preview-page-full.png](https://adorable-wombat-701.convex.cloud/api/storage/ab43e77b-1960-453a-bbd8-4ade5229546e)\n\n**Header section with title, repository URL input form, and repository selection interface**\n\n![preview-page-header-and-form.png](https://adorable-wombat-701.convex.cloud/api/storage/e3a783af-0620-4ec1-84c5-835f008cc6c0)\n\n**Initial viewport of the new 'See it in action' section showing the beginning of the mock GitHub PR browser**\n\n![see-it-in-action-section-viewport.png](https://adorable-wombat-701.convex.cloud/api/storage/cef0b193-2abc-4bc5-bcd3-cbd03ecf2819)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"d8e6ee9102682aa38e4432c257239368c48157ea","createdAt":"2025-12-04T23:24:28Z","updatedAt":"2025-12-05T00:03:41Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1173#issuecomment-3614717628"},{"type":"issue_comment","id":3614789859,"prNumber":1173,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.dev/austin-dev/task/kn7259dvysjgv95t8z9338bsrx7wmxyt?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.dev/austin-dev/task/kn7259dvysjgv95t8z9338bsrx7wmxyt/run/kd78ayx2t4gh1hygezawjf36217wm101/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1173?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 6 screenshots for commit `dea9492` (2025-12-05 00:03:39.458 UTC).\n\n**The new mock GitHub PR browser component showing a realistic GitHub pull request interface with browser chrome, PR header, and navigation tabs**\n\n![mock-github-pr-browser-section.png](https://famous-camel-162.convex.cloud/api/storage/a62f28bd-0f81-43d4-bfc5-c41195639bd1)\n\n**Additional view of more screenshots in the mock PR browser showing multiple example screenshots with captions**\n\n![mock-pr-more-screenshots.png](https://famous-camel-162.convex.cloud/api/storage/9a2a8122-5677-4da5-a826-dd824f00224e)\n\n**View showing an expanded screenshot in the mock PR browser, demonstrating the click-to-expand functionality**\n\n![mock-pr-screenshot-expanded.png](https://famous-camel-162.convex.cloud/api/storage/d294b7b3-9735-457a-a4a1-c16692aced7e)\n\n**Mock PR comment showing the preview screenshots section with 5 screenshot thumbnails displayed in the GitHub-styled comment from cmux-agent bot**\n\n![mock-pr-screenshots-list.png](https://famous-camel-162.convex.cloud/api/storage/b50cf501-2e12-47cc-b15b-d5ce3d9c8a4d)\n\n**Full-page screenshot showing the complete preview dashboard including header, repository selection, features section, and the new mock GitHub PR browser at the bottom**\n\n![preview-dashboard-full-page.png](https://famous-camel-162.convex.cloud/api/storage/cc1a4aca-e0d9-4055-9679-bb167977392b)\n\n**Header section of the preview dashboard showing the title 'Screenshot previews for GitHub PRs', Git repository URL input field, and the repository selection interface**\n\n![preview-dashboard-header.png](https://famous-camel-162.convex.cloud/api/storage/a8e5c8ce-d42e-4af6-9895-2c05e082c39b)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"d8e6ee9102682aa38e4432c257239368c48157ea","createdAt":"2025-12-05T00:03:40Z","updatedAt":"2025-12-05T00:04:08Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1173#issuecomment-3614789859"},{"type":"issue_comment","id":3614790695,"prNumber":1173,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.dev/manaflow/task/kn73kr9pfert911pkwee0rw0es7wnmj5?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.dev/manaflow/task/kn73kr9pfert911pkwee0rw0es7wnmj5/run/kd79apwshrxn55njb0esw4qb0n7wm0vh/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1173?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 8 screenshots for commit `dea9492` (2025-12-05 00:04:06.178 UTC).\n\n**Bot comment section showing 'Preview Screenshots' heading and links to workspace and diff heatmap**\n\n![bot-comment-preview-screenshots.png](https://adorable-wombat-701.convex.cloud/api/storage/eab39ef4-7e34-402d-9bc9-b3c22faaa838)\n\n**Focused view of the mock GitHub PR browser component**\n\n![mock-github-pr-browser-component.png](https://adorable-wombat-701.convex.cloud/api/storage/f62a34ba-144a-4451-9bc9-08c6a4c1c76d)\n\n**Mock GitHub PR browser component without the Section wrapper \\(removed title\\)**\n\n![mock-github-pr-browser-no-section-title.png](https://adorable-wombat-701.convex.cloud/api/storage/40b91364-6add-489e-83af-e8796749968e)\n\n**Viewport screenshot of the mock GitHub PR browser showing the browser chrome and PR header**\n\n![mock-github-pr-browser-viewport.png](https://adorable-wombat-701.convex.cloud/api/storage/0bdcdaad-fa88-42b5-86e6-456979068ff0)\n\n**GitHub PR header showing merged status, tabs \\(Conversation, Commits, Checks, Files changed\\)**\n\n![mock-pr-header-and-tabs.png](https://adorable-wombat-701.convex.cloud/api/storage/9c26d2d7-7597-455c-ad8b-8e6b9d61c0cb)\n\n**Example screenshots displayed within the mock PR showing workspace configuration views**\n\n![mock-pr-screenshot-examples.png](https://adorable-wombat-701.convex.cloud/api/storage/bf69a1a2-286b-4d43-9e46-b9d47adf3a29)\n\n**Full-page screenshot of the entire preview page showing all sections including the mock GitHub PR browser**\n\n![preview-page-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/f9f5682b-d4f2-4a42-9244-11ca4b103bc2)\n\n**Transition from 'From the creators of' section directly to mock browser without 'See it in action' title \\(main UI change\\)**\n\n![transition-to-mock-browser-no-title.png](https://adorable-wombat-701.convex.cloud/api/storage/1123b7cb-e09a-423f-891b-f5b034376e7c)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"d8e6ee9102682aa38e4432c257239368c48157ea","createdAt":"2025-12-05T00:04:07Z","updatedAt":"2025-12-05T00:45:30Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1173#issuecomment-3614790695"},{"type":"issue_comment","id":3614876304,"prNumber":1173,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn75fr3snn49h6qk91dgys308h7wq2b6?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn75fr3snn49h6qk91dgys308h7wq2b6/run/kd7fvjfnmzph0v00j6k03qzwr17wq8cw/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1173?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 9 screenshots for commit `b79bea7` (2025-12-05 00:45:28.474 UTC).\n\n**Example of an expanded screenshot within the mock PR showing the image at larger size when clicked**\n\n![expanded-screenshot-example.png](https://adorable-wombat-701.convex.cloud/api/storage/f154d45f-b7a5-4d8d-9c3c-55fb7a794e6c)\n\n**Full page screenshot of the preview dashboard showing all sections including the new mock GitHub PR browser at the bottom**\n\n![full-page-preview-dashboard.png](https://adorable-wombat-701.convex.cloud/api/storage/47814334-6665-4333-b03c-30c30e82a9c4)\n\n**Close-up of the Chrome-style browser tabs showing 'Pull Request \\#1124' and 'cmux Workspace' tabs with traffic lights and URL bar**\n\n![mock-browser-tabs-and-chrome.png](https://adorable-wombat-701.convex.cloud/api/storage/21ad7de3-a5f1-4062-b422-577bdaef0c90)\n\n**Full view of the mock GitHub PR browser displaying the PR interface with the GitHub tab active**\n\n![mock-github-browser-full-view.png](https://adorable-wombat-701.convex.cloud/api/storage/bfef4fd7-0e6c-4d96-952b-8397d57f01b7)\n\n**Mock GitHub PR browser section showing the Chrome-style browser window frame with tabs**\n\n![mock-github-pr-browser-section.png](https://adorable-wombat-701.convex.cloud/api/storage/daebdb6b-1aa6-4392-aa67-ec61215f676d)\n\n**Lower section of the GitHub PR showing additional mock screenshots with captions**\n\n![mock-pr-screenshots-bottom.png](https://adorable-wombat-701.convex.cloud/api/storage/060d546e-469e-44be-923a-13361da7a561)\n\n**GitHub PR content showing the bot comment with preview screenshots section and links to workspace/browser**\n\n![mock-pr-screenshots-section.png](https://adorable-wombat-701.convex.cloud/api/storage/34fbfcd1-ff3b-4841-96fa-6f242199cc43)\n\n**Top section of the preview dashboard showing the header, repository selection, and feature cards**\n\n![top-of-page-with-header.png](https://adorable-wombat-701.convex.cloud/api/storage/360c21d0-4aec-491c-8be5-fd6caff781ad)\n\n**Mock browser showing the 'cmux Workspace' tab active with 'Workspace preview coming soon' placeholder message**\n\n![workspace-tab-view.png](https://adorable-wombat-701.convex.cloud/api/storage/51edd5f1-8817-4195-87ad-4b5c5c8acbdc)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"d8e6ee9102682aa38e4432c257239368c48157ea","createdAt":"2025-12-05T00:45:29Z","updatedAt":"2025-12-05T00:46:05Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1173#issuecomment-3614876304"},{"type":"issue_comment","id":3614877304,"prNumber":1173,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.dev/austin-dev/task/kn71enz3sj9zzh60a775rkzzs97wqjv8?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.dev/austin-dev/task/kn71enz3sj9zzh60a775rkzzs97wqjv8/run/kd7036vks4w56zra1gg7xfpxm17wqn70/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1173?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 6 screenshots for commit `b79bea7` (2025-12-05 00:46:02.012 UTC).\n\n**Close-up view of the Chrome-style browser tabs, URL bar, and navigation controls with GitHub tab active**\n\n![browser-chrome-tabs-closeup.png](https://famous-camel-162.convex.cloud/api/storage/1d519b44-aba8-4f93-8c89-421e9818d3b4)\n\n**Close-up view of the browser chrome with cmux Workspace tab active, showing the tab styling and URL change**\n\n![browser-chrome-workspace-tab-closeup.png](https://famous-camel-162.convex.cloud/api/storage/ce70b33e-3867-41f8-a820-0df61b0e0911)\n\n**Full page screenshot of the preview dashboard showing the entire page including the new mock browser component at the bottom**\n\n![full-page-preview-dashboard.png](https://famous-camel-162.convex.cloud/api/storage/80d41432-d241-4570-8409-a9562c819c57)\n\n**Complete view of the mock browser component showing the entire Chrome-style interface with GitHub tab selected**\n\n![mock-browser-complete-view.png](https://famous-camel-162.convex.cloud/api/storage/248e84f4-5133-4119-a819-121f167bad6a)\n\n**Mock browser component with GitHub tab active, showing the Chrome-style tabbed interface and GitHub PR preview content**\n\n![mock-browser-github-tab-active.png](https://famous-camel-162.convex.cloud/api/storage/bf48f401-7b5f-42c7-9b79-23e2decbacc7)\n\n**Mock browser component with cmux Workspace tab active, showing the tab switching functionality and workspace preview placeholder**\n\n![mock-browser-workspace-tab-active.png](https://famous-camel-162.convex.cloud/api/storage/8fbd4cad-314b-4d3d-addd-b07b9ae33cd5)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"d8e6ee9102682aa38e4432c257239368c48157ea","createdAt":"2025-12-05T00:46:04Z","updatedAt":"2025-12-05T02:39:02Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1173#issuecomment-3614877304"},{"type":"issue_comment","id":3615077329,"prNumber":1173,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.dev/austin-dev/task/kn72p0v8xr79rbkgjrrgpdabph7wqnzp?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.dev/austin-dev/task/kn72p0v8xr79rbkgjrrgpdabph7wqnzp/run/kd76c2936bs11y2vqezv16x2ns7wpccd/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1173?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 10 screenshots for commit `22d7315` (2025-12-05 02:38:59.959 UTC).\n\n**Mock browser component showing Chrome-style tabs including 'Pull Request \\#1124' and 'cmux Workspace' tabs with URL bar**\n\n![mock-browser-chrome-tabs.png](https://famous-camel-162.convex.cloud/api/storage/305aca98-ee87-41aa-8756-e1d78c819902)\n\n**Mock GitHub PR browser showing the GitHub tab with PR details, conversation timeline, and bot comment**\n\n![mock-github-pr-browser-github-tab.png](https://famous-camel-162.convex.cloud/api/storage/651571a8-8750-4b87-a45e-0d3f1f09f252)\n\n**Mock browser workspace tab showing cmux interface with sidebar navigation, VS Code editor, browser panel, and git diff panel**\n\n![mock-github-pr-browser-workspace-tab.png](https://famous-camel-162.convex.cloud/api/storage/7acfbd6f-402a-4958-8ae7-fe6d0a5264b9)\n\n**Preview Screenshots section in the mock GitHub PR showing cmux-agent bot comment with 21 screenshots and links**\n\n![mock-github-pr-screenshots-section.png](https://famous-camel-162.convex.cloud/api/storage/fc3b2eb8-5edf-47f1-aba1-397b1c1c9893)\n\n**Screenshot gallery in the mock PR comment showing multiple expandable screenshot thumbnails with captions**\n\n![mock-screenshots-gallery-example.png](https://famous-camel-162.convex.cloud/api/storage/afd1cbac-e671-4a8d-b321-f3f7a1a0b67a)\n\n**Full page screenshot of the preview dashboard showing all sections including the new MockGitHubPRBrowser component at the bottom**\n\n![preview-page-full.png](https://famous-camel-162.convex.cloud/api/storage/27a00ff9-960a-4795-840d-5a4d8010dcd2)\n\n**Preview page header section with title, description, and repository URL input field**\n\n![preview-page-header.png](https://famous-camel-162.convex.cloud/api/storage/71d951ef-2765-4aab-9b49-638db5acb991)\n\n**Repository selection section showing team selector, GitHub account dropdown, and 'What is preview.new?' features**\n\n![repository-selection-section.png](https://famous-camel-162.convex.cloud/api/storage/67698e67-b8be-47e8-a56f-4e9e1b7623f0)\n\n**Detailed view of the git diff panel showing 3 changed files with syntax-highlighted code differences**\n\n![workspace-git-diff-panel.png](https://famous-camel-162.convex.cloud/api/storage/1c76311e-c9dd-4546-bc4f-eca3d91e17d0)\n\n**Full workspace split view showing left sidebar, VS Code workspace with file explorer, browser with cmux.dev landing page, and git diff panel**\n\n![workspace-split-view-full.png](https://famous-camel-162.convex.cloud/api/storage/d665ead5-c983-4bfd-b6a5-9088ed83b8d0)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"d8e6ee9102682aa38e4432c257239368c48157ea","createdAt":"2025-12-05T02:39:01Z","updatedAt":"2025-12-05T02:39:44Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1173#issuecomment-3615077329"},{"type":"issue_comment","id":3615078456,"prNumber":1173,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn76prn1ravrs8pzh9n6nrvx297wqje5?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn76prn1ravrs8pzh9n6nrvx297wqje5/run/kd73wpdxmk3s5q0s6pfntb4kax7wq45d/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1173?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 10 screenshots for commit `22d7315` (2025-12-05 02:39:41.940 UTC).\n\n**Section showing configured repositories list and the 'From the creators of' cmux branding**\n\n![configured-repositories-section.png](https://adorable-wombat-701.convex.cloud/api/storage/e3c21d8d-a67f-4b6a-a48c-1fda67f40b33)\n\n**Close-up of the page header showing 'Screenshot previews for GitHub PRs' title and description**\n\n![header-section.png](https://adorable-wombat-701.convex.cloud/api/storage/9b3cf0ac-b106-4527-91f3-8ee3fa892d20)\n\n**Mock GitHub PR browser view showing the GitHub tab with PR details and bot comment containing screenshot previews**\n\n![mock-github-pr-browser-github-tab.png](https://adorable-wombat-701.convex.cloud/api/storage/488b0d6f-ebc7-40de-affb-fba451d21a27)\n\n**Scrolled view showing more of the 21 mock screenshots listed in the bot's PR comment**\n\n![mock-screenshots-expanded-list.png](https://adorable-wombat-701.convex.cloud/api/storage/3ce647f2-2560-4ccb-981e-7bf6523c3a03)\n\n**View of the mock PR comment showing the beginning of the expanded screenshot list within the GitHub interface**\n\n![mock-screenshots-list-in-pr-comment.png](https://adorable-wombat-701.convex.cloud/api/storage/922d5c4e-622f-40f4-ac54-c8c55595c69a)\n\n**Mock cmux Workspace tab showing the split-panel interface with VS Code, Browser, and Git Diff views demonstrating the cmux platform**\n\n![mock-workspace-tab-view.png](https://adorable-wombat-701.convex.cloud/api/storage/07f2fe98-134c-4810-b57d-c7bed758b21f)\n\n**Full-page screenshot of the preview dashboard showing the entire page with the mock GitHub PR browser demo featuring 21 screenshot examples**\n\n![preview-dashboard-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/d6961f13-c28d-4b6c-a5ef-126daa6d800b)\n\n**Top section of the preview dashboard showing the header, hero text, repository selector, and feature cards**\n\n![preview-dashboard-top-section.png](https://adorable-wombat-701.convex.cloud/api/storage/ca13d5d0-09a7-4bd7-ba33-2fd6bcdac9fb)\n\n**Close-up of the 'Preview Screenshots' heading showing '21 screenshots' text - the key UI change in this PR**\n\n![preview-screenshots-header-21-screenshots.png](https://adorable-wombat-701.convex.cloud/api/storage/9f8552d0-4d33-44b9-b1fb-b163d1584ea4)\n\n**Example of a single screenshot item button showing the caption and thumbnail in the list**\n\n![screenshot-item-example.png](https://adorable-wombat-701.convex.cloud/api/storage/588f22ea-52d3-4e8e-8d27-6a63b2d12ded)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"d8e6ee9102682aa38e4432c257239368c48157ea","createdAt":"2025-12-05T02:39:43Z","updatedAt":"2025-12-05T09:30:32Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1173#issuecomment-3615078456"},{"type":"issue_comment","id":3616002992,"prNumber":1173,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn74a8qkaanybpk9x29r8nk8ks7wqqzr?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn74a8qkaanybpk9x29r8nk8ks7wqqzr/run/kd7fk56mjmh4nx58x4bz44ad2s7wpsvr/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1173?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 11 screenshots for commit `64265ea` (2025-12-05 09:30:30.841 UTC).\n\n**Preview dashboard page - top section showing the main header, repository selector, and feature cards**\n\n![01-preview-page-top.png](https://adorable-wombat-701.convex.cloud/api/storage/d12b58b3-b93d-454a-bb0a-610e8b3f5e75)\n\n**Full page screenshot of the entire preview dashboard including the new mock GitHub PR browser section**\n\n![02-preview-page-full.png](https://adorable-wombat-701.convex.cloud/api/storage/6bd22171-dab9-4d19-86db-9135b4a35e54)\n\n**Mock GitHub PR browser showing a realistic example of screenshot previews in a GitHub PR**\n\n![03-mock-github-pr-browser-section.png](https://adorable-wombat-701.convex.cloud/api/storage/6ecdab5b-e8bb-486a-94c2-e0f7c19bfcfb)\n\n**Mock browser with cmux workspace tab active, showing the three-panel layout**\n\n![04-mock-browser-cmux-workspace-tab.png](https://adorable-wombat-701.convex.cloud/api/storage/bc3bf4ee-dc87-4b35-b5c3-c4a19a758c62)\n\n**Detailed view of the mock cmux workspace with VS Code, browser, and git diff panels**\n\n![05-mock-browser-workspace-view.png](https://adorable-wombat-701.convex.cloud/api/storage/86e5de83-78f4-4ff8-aacb-af5cbd710d1f)\n\n**GitHub tab showing the PR conversation view with bot comment containing screenshot previews**\n\n![06-mock-browser-github-conversation-tab.png](https://adorable-wombat-701.convex.cloud/api/storage/b09c486f-4e2c-4810-a50d-ddbeb8778418)\n\n**GitHub PR view showing the preview screenshots section**\n\n![07-mock-browser-screenshot-expanded.png](https://adorable-wombat-701.convex.cloud/api/storage/7afc239f-8ace-422c-8238-d3f51c9dafa6)\n\n**Scrolled view showing multiple screenshot thumbnails in the PR comment with captions**\n\n![08-mock-browser-pr-screenshots-list.png](https://adorable-wombat-701.convex.cloud/api/storage/85d146b2-7972-49ef-b6df-d3468e444e61)\n\n**Mock GitHub PR Commits tab showing a list of 14 commits**\n\n![09-mock-browser-commits-tab.png](https://adorable-wombat-701.convex.cloud/api/storage/4551885b-a7f0-4904-8e61-d87e6a68ffe0)\n\n**Mock GitHub PR Checks tab showing all checks passed with 4 successful checks**\n\n![10-mock-browser-checks-tab.png](https://adorable-wombat-701.convex.cloud/api/storage/141036d6-9226-4a7b-a6ba-e2f98530b2a4)\n\n**Mock GitHub PR Files changed tab showing git diff for 2 modified files**\n\n![11-mock-browser-files-changed-tab.png](https://adorable-wombat-701.convex.cloud/api/storage/23b38a02-6b8d-40d7-85f9-be6946d7e7a1)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"d8e6ee9102682aa38e4432c257239368c48157ea","createdAt":"2025-12-05T09:30:31Z","updatedAt":"2025-12-05T09:30:51Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1173#issuecomment-3616002992"},{"type":"issue_comment","id":3616003966,"prNumber":1173,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn75hhw0ywraarb8c4vdrq22ws7wpc2e?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn75hhw0ywraarb8c4vdrq22ws7wpc2e/run/kd78pgdxr8fgnq89tvfshytc6h7wp98d/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1173?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 8 screenshots for commit `64265ea` (2025-12-05 09:30:48.276 UTC).\n\n**Mock GitHub PR browser showing the GitHub tab with PR header and conversation view**\n\n![mock-github-pr-browser-github-tab.png](https://famous-camel-162.convex.cloud/api/storage/d878e025-b9ac-406a-93ae-0bb01c381b1e)\n\n**Checks tab showing all 4 checks passed: build, lint, typecheck, and test**\n\n![mock-github-pr-checks-tab.png](https://famous-camel-162.convex.cloud/api/storage/0bfc253e-a900-44b2-8265-faed260c72dc)\n\n**Commits tab showing list of 14 commits with commit messages and timestamps**\n\n![mock-github-pr-commits-tab.png](https://famous-camel-162.convex.cloud/api/storage/ad5ce0c7-2112-4338-a54c-02959ad79f2a)\n\n**Bot comment showing 'Preview Screenshots' heading with list of 21 example screenshots**\n\n![mock-github-pr-conversation-with-screenshots.png](https://famous-camel-162.convex.cloud/api/storage/a1eb292d-f312-4fe9-bdd2-e1ee53a933ef)\n\n**Files changed tab displaying code diff for 2 modified files with additions and deletions**\n\n![mock-github-pr-files-changed-tab.png](https://famous-camel-162.convex.cloud/api/storage/6a417264-6921-4142-a5e7-1f22908767b2)\n\n**Workspace/cmux tab displaying 3-panel layout with VS Code editor, browser preview, and git diff panels**\n\n![mock-workspace-browser-3panel-view.png](https://famous-camel-162.convex.cloud/api/storage/fac0d41f-9dc6-4d22-81ca-e77151e669ae)\n\n**Full-page view of the preview dashboard showing all sections including the new mock PR browser at the bottom**\n\n![preview-dashboard-full-page.png](https://famous-camel-162.convex.cloud/api/storage/8a65bc44-99af-4122-88d0-aaa9c72b720c)\n\n**Top section with header, repository setup form, team selector, and feature descriptions**\n\n![preview-dashboard-header-and-setup-form.png](https://famous-camel-162.convex.cloud/api/storage/329e0203-c17d-4135-9916-59e42865b668)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"d8e6ee9102682aa38e4432c257239368c48157ea","createdAt":"2025-12-05T09:30:50Z","updatedAt":"2025-12-05T09:50:32Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1173#issuecomment-3616003966"},{"type":"issue_comment","id":3616080427,"prNumber":1173,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.dev/austin-dev/task/kn72gsxh8g0gxyx0rnqzr97wd57wqv2r?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.dev/austin-dev/task/kn72gsxh8g0gxyx0rnqzr97wd57wqv2r/run/kd74xygedyyy06yyp6wcc42n4h7wp5g6/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1173?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 10 screenshots for commit `8a26f8c` (2025-12-05 09:50:28.480 UTC).\n\n**NEW: Mock cmux sidebar with multiple preview tasks expanded, showing the collapsible navigation structure**\n\n![mock-cmux-expanded-multiple-tasks.png](https://famous-camel-162.convex.cloud/api/storage/c33795ba-f33f-48c1-a043-0307ed7bf2de)\n\n**NEW: Mock cmux interface with sidebar showing expandable preview tasks and the main three-panel workspace layout**\n\n![mock-cmux-three-panel-layout.png](https://famous-camel-162.convex.cloud/api/storage/f171b658-cee5-4024-8257-fe7c729d5948)\n\n**NEW: Mock cmux workspace tab showing the three-panel layout with VS Code, Browser preview, and Git diff panels**\n\n![mock-cmux-workspace-tab.png](https://famous-camel-162.convex.cloud/api/storage/a2d14f51-29ab-4153-9c4d-bb5d00075bfd)\n\n**NEW: Mock GitHub PR browser showing the PR conversation tab with preview screenshots comment from the cmux-agent bot**\n\n![mock-github-pr-browser-viewport.png](https://famous-camel-162.convex.cloud/api/storage/e7b7a3ff-1102-4178-b196-f1899d51567a)\n\n**NEW: Close-up of the mock GitHub PR showing the automated screenshot comment with 21 captured screenshots**\n\n![mock-github-pr-screenshots-comment.png](https://famous-camel-162.convex.cloud/api/storage/06b679a5-8047-43e8-9aa4-493ad8758e54)\n\n**NEW: Mock terminal view showing the 'dev' tmux session with colorized server logs from WWW, CONVEX-DEV, CLIENT, and SERVER**\n\n![mock-terminals-dev-session.png](https://famous-camel-162.convex.cloud/api/storage/125f2f9e-2780-4b74-ae3d-a976335163b8)\n\n**NEW: Mock terminal view showing Claude Code output with tmux session tabs at the bottom**\n\n![mock-terminals-view.png](https://famous-camel-162.convex.cloud/api/storage/1536d73c-c7f9-4421-993c-da775f69f6da)\n\n**Full-page screenshot of the preview.new landing page showing all sections including the newly added mock GitHub PR browser demo at the bottom**\n\n![preview-page-full.png](https://famous-camel-162.convex.cloud/api/storage/823cc736-4fd1-4b0c-911c-555e4411bb33)\n\n**Middle section showing the 'What is preview.new?' feature cards and configured repositories list**\n\n![preview-page-middle-section.png](https://famous-camel-162.convex.cloud/api/storage/a8253152-797b-45ca-8f8f-4f1a42d21003)\n\n**Top section of the preview page showing the header, Git repository URL input, and repository selection interface**\n\n![preview-page-top-section.png](https://famous-camel-162.convex.cloud/api/storage/ab558268-4a90-4240-b480-fe36abbabbce)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"d8e6ee9102682aa38e4432c257239368c48157ea","createdAt":"2025-12-05T09:50:31Z","updatedAt":"2025-12-05T09:50:58Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1173#issuecomment-3616080427"},{"type":"issue_comment","id":3616082648,"prNumber":1173,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn70vmjxj2jfsggxrj8q2w87q17wphkr?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn70vmjxj2jfsggxrj8q2w87q17wphkr/run/kd79npa9v0bke8secadahn7ye97wp7pz/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1173?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 12 screenshots for commit `8a26f8c` (2025-12-05 09:50:56.523 UTC).\n\n**Top viewport of the preview page showing the setup form and repository selection**\n\n![01-preview-page-top.png](https://adorable-wombat-701.convex.cloud/api/storage/bb89054e-374d-4302-ab96-7db24abb430b)\n\n**Full-page screenshot showing the entire preview dashboard with mock GitHub PR browser at the bottom**\n\n![02-preview-page-full.png](https://adorable-wombat-701.convex.cloud/api/storage/00315c74-97d9-4ac3-beda-6fc29ec250b3)\n\n**Mock GitHub PR browser showing the GitHub tab with PR conversation, bot comment with 21 screenshot previews**\n\n![03-mock-github-pr-browser-github-tab.png](https://adorable-wombat-701.convex.cloud/api/storage/37997827-ecf8-461e-8b3f-b7fa50046535)\n\n**Mock cmux workspace tab showing three-panel layout with VS Code, Browser preview, and Git diff panels**\n\n![04-mock-cmux-workspace-three-panel-view.png](https://adorable-wombat-701.convex.cloud/api/storage/84f6eed4-0fb0-475e-b3a4-805ec8404325)\n\n**Single panel view showing VS Code workspace with file explorer and code editor**\n\n![05-mock-vscode-single-panel-view.png](https://adorable-wombat-701.convex.cloud/api/storage/3e21c52b-8ab9-407a-ab7c-62d3f946499d)\n\n**Single panel view showing browser preview with cmux landing page at localhost:5173**\n\n![06-mock-browser-single-panel-view.png](https://adorable-wombat-701.convex.cloud/api/storage/2be80248-14c8-4ca9-b29b-66f228bc7264)\n\n**Single panel view showing Git diff with 3 changed files and code differences**\n\n![07-mock-git-diff-single-panel-view.png](https://adorable-wombat-701.convex.cloud/api/storage/6237fc63-91e4-48f8-94ea-623d98f052ae)\n\n**Terminal view showing Claude Code CLI session with tmux tabs at the bottom**\n\n![08-mock-terminals-view.png](https://adorable-wombat-701.convex.cloud/api/storage/a11f53d8-5e97-4f32-adf5-0b04b3706e5e)\n\n**GitHub PR Commits tab showing 14 commits with commit messages and timestamps**\n\n![09-mock-github-commits-tab.png](https://adorable-wombat-701.convex.cloud/api/storage/18fca5bf-239f-45c6-8af2-de2a45ea9484)\n\n**GitHub PR Files changed tab showing 2 files with +73 additions and -16 deletions**\n\n![10-mock-github-files-changed-tab.png](https://adorable-wombat-701.convex.cloud/api/storage/071cbc77-2b01-4d3b-a1ef-f9d335baeddc)\n\n**Grid of screenshot thumbnails in the GitHub PR comment showing all 21 captured screenshots with captions**\n\n![11-mock-github-screenshot-thumbnails.png](https://adorable-wombat-701.convex.cloud/api/storage/e857090d-fc98-44c8-aa7a-ff718226ed1d)\n\n**Final view of the preview page after all interactions, showing the complete mock browser implementation**\n\n![12-final-view-after-interactions.png](https://adorable-wombat-701.convex.cloud/api/storage/7c45415b-d0cc-4f3d-99f3-f36102c5e9b1)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"d8e6ee9102682aa38e4432c257239368c48157ea","createdAt":"2025-12-05T09:50:57Z","updatedAt":"2025-12-05T10:14:08Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1173#issuecomment-3616082648"},{"type":"issue_comment","id":3616191212,"prNumber":1173,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.dev/austin-dev/task/kn797q2x46pkvnwax362h3grfs7wpfeq?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.dev/austin-dev/task/kn797q2x46pkvnwax362h3grfs7wpfeq/run/kd743k4fvk9ps5atgqxr06vnz57wpcje/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1173?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 13 screenshots for commit `54829db` (2025-12-05 10:14:04.145 UTC).\n\n**Clickable 'austinywang' username link in the PR merge status line**\n\n![austinywang-clickable-link.png](https://famous-camel-162.convex.cloud/api/storage/3d1eef60-bbeb-45f1-ad78-f56ed2d3f6e8)\n\n**Clickable 'austinywang' author link in the PR description comment header**\n\n![author-comment-clickable-link.png](https://famous-camel-162.convex.cloud/api/storage/688ced00-91a2-4a36-a8eb-35ba59751e99)\n\n**Full bot comment section showing preview screenshots with interactive buttons and emoji reactions at the bottom**\n\n![bot-comment-with-reactions.png](https://famous-camel-162.convex.cloud/api/storage/2a406cba-b824-4975-b9f5-cc9f240db975)\n\n**Interactive 'cmux-agent' button that switches to workspace tab when clicked**\n\n![cmux-agent-button.png](https://famous-camel-162.convex.cloud/api/storage/9691b704-5046-4d8a-9829-8cfdf949f96b)\n\n**Interactive 'cmux' button in the 'Generated by cmux preview system' footer text**\n\n![cmux-preview-system-button.png](https://famous-camel-162.convex.cloud/api/storage/ad1672f9-9092-43f0-b941-c49d5e91a9db)\n\n**Close-up of the 'Open Diff Heatmap' external link to 0github.com**\n\n![diff-heatmap-link.png](https://famous-camel-162.convex.cloud/api/storage/eea1b720-5a1e-4dfa-b4d4-022e016f7825)\n\n**GitHub-style emoji reactions showing 👍 \\(thumbs up\\) with 2 reactions and 🚀 \\(rocket\\) with 1 reaction**\n\n![emoji-reactions.png](https://famous-camel-162.convex.cloud/api/storage/5f596635-0050-423b-901c-32baa67cada4)\n\n**Close-up of the clickable 'manaflow-ai' organization link in the GitHub header**\n\n![github-header-clickable-links.png](https://famous-camel-162.convex.cloud/api/storage/2c216a9c-037a-4e10-9a0e-c1b9197d22fe)\n\n**GitHub PR header section showing clickable organization name \\(manaflow-ai\\) and repository name \\(cmux\\) as interactive links**\n\n![github-pr-header-with-links.png](https://famous-camel-162.convex.cloud/api/storage/cdff1e5d-eed8-410f-a34f-76e23be363dd)\n\n**Overall view of the mock GitHub PR browser showing the conversation tab with all interactive elements**\n\n![mock-github-pr-browser-section.png](https://famous-camel-162.convex.cloud/api/storage/0377760a-79e9-4b78-b9a6-631c7897e9fe)\n\n**Full page screenshot of the preview dashboard showing the entire mock GitHub PR browser component**\n\n![preview-page-full.png](https://famous-camel-162.convex.cloud/api/storage/89712340-6fe7-41f2-9e46-bbd64afd8058)\n\n**Interactive workspace action buttons: 'Open Workspace \\(1 hr expiry\\)', 'Open Dev Browser \\(1 hr expiry\\)', and 'Open Diff Heatmap' link**\n\n![workspace-interactive-buttons.png](https://famous-camel-162.convex.cloud/api/storage/65836ebb-5f7a-40e6-a16e-0c169ea078c1)\n\n**Workspace tab active after clicking 'Open Workspace' button, showing VS Code editor, browser preview, and git diff panels**\n\n![workspace-tab-active.png](https://famous-camel-162.convex.cloud/api/storage/27450e22-245a-4cf8-ad0f-409175287f5b)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"d8e6ee9102682aa38e4432c257239368c48157ea","createdAt":"2025-12-05T10:14:07Z","updatedAt":"2025-12-05T10:15:24Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1173#issuecomment-3616191212"},{"type":"issue_comment","id":3616195829,"prNumber":1173,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7c6a8p0skkbgr87yt65cchd57wpx6z?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7c6a8p0skkbgr87yt65cchd57wpx6z/run/kd7f1yzfbrtpqamckvfd1bg33s7wpb2x/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1173?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 13 screenshots for commit `54829db` (2025-12-05 10:15:22.913 UTC).\n\n**Full page view of preview dashboard showing header, repository setup, features section, configured repositories, and the new mock GitHub PR browser example**\n\n![01-full-page-preview-dashboard.png](https://adorable-wombat-701.convex.cloud/api/storage/733720be-5022-425c-9d9c-44f06b792234)\n\n**Mock browser showing workspace tab with 3-panel layout: VS Code explorer, code editor, and browser preview**\n\n![02-mock-browser-workspace-tab.png](https://adorable-wombat-701.convex.cloud/api/storage/281c9b97-f508-4026-8657-21a000b453a9)\n\n**Mock GitHub PR browser showing conversation tab with PR details, screenshot preview comment from cmux-agent bot, and list of 21 captured screenshots**\n\n![03-mock-github-pr-conversation.png](https://adorable-wombat-701.convex.cloud/api/storage/f51f48f7-6ae7-42a9-aa51-5130979a7e70)\n\n**Close-up viewport screenshot of mock GitHub PR showing the conversation tab with cmux-agent bot comment section**\n\n![04-mock-browser-github-pr-view.png](https://adorable-wombat-701.convex.cloud/api/storage/a51b2d13-ca25-4011-ad92-9c817b076f16)\n\n**Mock GitHub PR commits tab showing 14 commits with commit messages, SHAs, and timestamps**\n\n![05-mock-github-pr-commits-tab.png](https://adorable-wombat-701.convex.cloud/api/storage/16745f8d-40c9-43ef-beae-2a22240cd657)\n\n**Mock GitHub PR checks tab showing all 4 checks passed: build, lint, typecheck, and test**\n\n![06-mock-github-pr-checks-tab.png](https://adorable-wombat-701.convex.cloud/api/storage/287be077-d335-41d8-9c06-265285bfc413)\n\n**Mock GitHub PR files changed tab showing 2 changed files with diff view**\n\n![07-mock-github-pr-files-changed-tab.png](https://adorable-wombat-701.convex.cloud/api/storage/6cb4f241-f553-495b-932a-4fc4512bba93)\n\n**Mock workspace view showing 3-panel layout with VS Code, browser preview of cmux.dev landing page, and git diff panel**\n\n![08-mock-workspace-3-panel-view.png](https://adorable-wombat-701.convex.cloud/api/storage/88ded7f2-9bc6-4fc6-879f-ed9e754f526d)\n\n**Mock workspace view focused on VS Code panel only, showing file explorer and LAUNCH.md editor**\n\n![09-mock-workspace-vscode-only-view.png](https://adorable-wombat-701.convex.cloud/api/storage/d4b7c4e5-4db5-4395-8c6a-4a82057a8042)\n\n**Mock workspace view focused on browser preview only, showing cmux.dev landing page**\n\n![10-mock-workspace-browser-only-view.png](https://adorable-wombat-701.convex.cloud/api/storage/68b7d862-3c73-4857-9d38-bbd4925a7a4b)\n\n**Mock workspace view focused on git diff panel only, showing 3 changed files with code differences**\n\n![11-mock-workspace-git-diff-only-view.png](https://adorable-wombat-701.convex.cloud/api/storage/fb8c228c-95cb-417c-b809-9739f4e7707e)\n\n**Mock workspace view showing terminal panel with Claude Code CLI output and tmux session tabs**\n\n![12-mock-workspace-terminals-view.png](https://adorable-wombat-701.convex.cloud/api/storage/e68fbfab-fb8e-4bd3-bf6d-935d5df44af5)\n\n**Preview dashboard header section showing title, repository URL input, team selector, account selector, and search box**\n\n![13-preview-page-header-and-setup.png](https://adorable-wombat-701.convex.cloud/api/storage/ab73613c-eeb9-4840-b001-07a6041daec6)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"d8e6ee9102682aa38e4432c257239368c48157ea","createdAt":"2025-12-05T10:15:23Z","updatedAt":"2025-12-05T10:38:14Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1173#issuecomment-3616195829"},{"type":"issue_comment","id":3616290834,"prNumber":1173,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn783my9pasry38jj55syaeq0h7wqd27?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn783my9pasry38jj55syaeq0h7wqd27/run/kd7cyy81pg6cbda81wm75zrg4x7wqba3/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1173?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 13 screenshots for commit `e15556e` (2025-12-05 10:38:13.007 UTC).\n\n**Full-page view of the preview page showing the entire layout including the new mock GitHub PR browser component at the bottom**\n\n![01-preview-page-full.png](https://adorable-wombat-701.convex.cloud/api/storage/b400e59c-f666-43d8-835c-3b6eb95039f5)\n\n**Mock GitHub PR browser displaying the Conversation tab with PR description, preview screenshots section, and interactive screenshot thumbnails**\n\n![02-mock-github-pr-browser-github-tab.png](https://adorable-wombat-701.convex.cloud/api/storage/75aeadde-bedc-4dde-b4bb-5bfd6df0a6e5)\n\n**Mock cmux workspace view showing three-panel layout with sidebar navigation, VS Code editor with LAUNCH.md, and browser preview of cmux.dev homepage**\n\n![03-mock-workspace-view-three-panel-layout.png](https://adorable-wombat-701.convex.cloud/api/storage/409fe125-39a9-45fe-8846-5d76b04884b7)\n\n**Mock workspace with browser-only view showing the cmux.dev landing page in full screen mode**\n\n![04-mock-workspace-browser-only-view.png](https://adorable-wombat-701.convex.cloud/api/storage/ab8c096e-c6bc-46f2-ab6e-47f09cd6f82c)\n\n**Mock workspace terminals view showing Claude Code CLI output with task completion messages and tmux session tabs**\n\n![05-mock-workspace-terminals-view.png](https://adorable-wombat-701.convex.cloud/api/storage/3604785b-c32f-4bd9-9022-deaf5bfcec43)\n\n**Mock workspace terminals view showing the maintenance tmux session with bun install output**\n\n![06-mock-workspace-terminals-maintenance-session.png](https://adorable-wombat-701.convex.cloud/api/storage/0e0292b3-ead9-4e54-ac9d-3463dea14808)\n\n**Mock workspace terminals view showing the dev tmux session with server logs, Convex dev logs, and Vite HMR updates**\n\n![07-mock-workspace-terminals-dev-session.png](https://adorable-wombat-701.convex.cloud/api/storage/eef613a0-fe4c-45ba-bd97-236c8e35a2c2)\n\n**Mock GitHub PR browser showing the Commits tab with a list of 14 commits from the past 3 days**\n\n![08-mock-github-pr-commits-tab.png](https://adorable-wombat-701.convex.cloud/api/storage/e7c2f1f3-6ae9-48ba-b1cd-3098d847085a)\n\n**Mock GitHub PR browser showing the Checks tab with all 4 checks passing \\(build, lint, typecheck, test\\)**\n\n![09-mock-github-pr-checks-tab.png](https://adorable-wombat-701.convex.cloud/api/storage/8722755c-849e-4904-82ca-00d6001fa9f7)\n\n**Mock GitHub PR browser showing the Files changed tab with git diff view displaying file changes with syntax highlighting**\n\n![10-mock-github-pr-files-changed-tab.png](https://adorable-wombat-701.convex.cloud/api/storage/92522815-20a6-439d-b452-eb8bb0c41d9c)\n\n**Top section of the preview page showing the header, repository input field, team selector, and 'What is preview.new?' information section**\n\n![11-preview-page-top-section.png](https://adorable-wombat-701.convex.cloud/api/storage/9d539dfe-21e9-4e89-b9a0-51c94ba39213)\n\n**Close-up of the mock browser component header showing the GitHub and cmux tab buttons with address bar and controls**\n\n![12-mock-browser-header-with-tabs.png](https://adorable-wombat-701.convex.cloud/api/storage/7c047a41-f311-495c-b5f4-e70caadf2e73)\n\n**Preview Screenshots section within the mock GitHub PR showing the cmux-agent bot comment with 21 screenshot thumbnails and action buttons**\n\n![13-mock-github-pr-preview-screenshots-section.png](https://adorable-wombat-701.convex.cloud/api/storage/79991d75-f203-4dfe-9f04-a045cddadf5e)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"d8e6ee9102682aa38e4432c257239368c48157ea","createdAt":"2025-12-05T10:38:13Z","updatedAt":"2025-12-05T10:38:22Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1173#issuecomment-3616290834"},{"type":"issue_comment","id":3616291471,"prNumber":1173,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn73jyhvzqy4jmqwrvn7gfsg457wpesh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/austin-dev/task/kn73jyhvzqy4jmqwrvn7gfsg457wpesh/run/kd732ytjdzc3zahb9k4z9q60n17wqadr/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1173?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 13 screenshots for commit `e15556e` (2025-12-05 10:38:20.409 UTC).\n\n**Top section of preview page with title, repository input, and 'What is preview.new?' description**\n\n![01-preview-page-top-section.png](https://famous-camel-162.convex.cloud/api/storage/136594a2-469f-4345-a08d-94b908f356ef)\n\n**Mock GitHub PR browser showing the PR header and navigation tabs**\n\n![02-mock-github-pr-browser-top.png](https://famous-camel-162.convex.cloud/api/storage/1fade9a3-e93a-4d77-82d5-edccba0766ef)\n\n**Preview Screenshots section in the mock PR with workspace and browser buttons**\n\n![03-mock-pr-screenshots-section.png](https://famous-camel-162.convex.cloud/api/storage/e4bf55d1-ff0b-4036-9f13-1cc46d04b216)\n\n**Grid of screenshot thumbnails showing various UI states captured by the preview agent**\n\n![04-screenshot-thumbnails.png](https://famous-camel-162.convex.cloud/api/storage/51100243-43d9-4087-83cd-b04932fc9fb8)\n\n**More screenshot thumbnails and the merge pull request button at the bottom**\n\n![05-more-screenshots-and-merge-button.png](https://famous-camel-162.convex.cloud/api/storage/5163681b-16e0-4357-a303-c2094aebf459)\n\n**Mock cmux workspace view showing VS Code editor with file explorer and code editor**\n\n![06-mock-cmux-workspace-view.png](https://famous-camel-162.convex.cloud/api/storage/1e7fbf0e-4ca5-47ea-979a-3d741dc3dca6)\n\n**Mock browser view showing the cmux landing page preview**\n\n![07-mock-browser-view.png](https://famous-camel-162.convex.cloud/api/storage/f92d0c5e-69bb-43b3-b897-3331c1fa4c93)\n\n**Mock terminal view showing Claude Code CLI interaction with tmux panes**\n\n![08-mock-terminals-view.png](https://famous-camel-162.convex.cloud/api/storage/a3c09d9c-1ed3-42cd-affd-ca269febd486)\n\n**Mock git diff view showing file changes with added and removed lines**\n\n![09-mock-git-diff-view.png](https://famous-camel-162.convex.cloud/api/storage/a0f4b3ff-0861-47be-88ec-bab6ab732750)\n\n**Mock cmux workspace with three-panel layout showing file explorer, code editor, and browser preview**\n\n![10-mock-workspace-three-panel-view.png](https://famous-camel-162.convex.cloud/api/storage/a04d3b65-a112-4c25-bbcf-45413b253e5d)\n\n**Full page view of preview.new with the complete mock GitHub PR browser displaying screenshot previews**\n\n![11-full-page-with-mock-github-pr.png](https://famous-camel-162.convex.cloud/api/storage/ff4804d1-6a5f-41a8-b275-c7268f1956e8)\n\n**View after clicking a screenshot thumbnail \\(demonstrates interactive functionality\\)**\n\n![12-expanded-screenshot-thumbnail.png](https://famous-camel-162.convex.cloud/api/storage/bb70e99a-602e-49da-a421-529aec6767a6)\n\n**Full page screenshot showing the preview.new landing page with mock GitHub PR browser example**\n\n![preview-page-full.png](https://famous-camel-162.convex.cloud/api/storage/0b574fd5-7569-4f4b-a628-19c9e7bf019a)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"d8e6ee9102682aa38e4432c257239368c48157ea","createdAt":"2025-12-05T10:38:21Z","updatedAt":"2025-12-05T10:50:02Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1173#issuecomment-3616291471"},{"type":"issue_comment","id":3616330332,"prNumber":1173,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn79q0fkht544357ra1ap2hm2h7wprq3?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn79q0fkht544357ra1ap2hm2h7wprq3/run/kd7a7pcyk467zzgbwz7yfa1wr17wq2z4/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1173?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 14 screenshots for commit `97c5a93` (2025-12-05 10:50:00.319 UTC).\n\n**Full page screenshot of the preview dashboard showing the entire mock PR example with GitHub browser and cmux workspace tabs**\n\n![full-page-preview-dashboard.png](https://adorable-wombat-701.convex.cloud/api/storage/d9fdc3d7-6c75-4c35-b054-43d4fea4bf5c)\n\n**Mock GitHub PR browser interface showing the PR header with repository and branch information**\n\n![mock-github-pr-browser.png](https://adorable-wombat-701.convex.cloud/api/storage/b3e79013-08a7-408b-8916-5cb30949b703)\n\n**GitHub PR Checks tab showing all 4 checks passed: build, lint, typecheck, and test**\n\n![mock-pr-checks-tab.png](https://adorable-wombat-701.convex.cloud/api/storage/5962d512-6b34-4010-a85c-3e0b2136cb45)\n\n**GitHub PR Commits tab showing list of 14 commits with commit messages, hashes, and timestamps**\n\n![mock-pr-commits-tab.png](https://adorable-wombat-701.convex.cloud/api/storage/8ca70d4b-6ccb-4348-914d-df45ad38d6cb)\n\n**GitHub PR Conversation tab showing the PR description, author info, and summary of changes**\n\n![mock-pr-conversation-tab.png](https://adorable-wombat-701.convex.cloud/api/storage/ac368ece-5e93-4bbd-a158-6c430a234434)\n\n**GitHub PR Files changed tab showing code diff with 2 files changed, 73 additions and 16 deletions**\n\n![mock-pr-files-changed-tab.png](https://adorable-wombat-701.convex.cloud/api/storage/6aaffa72-d573-475c-b03c-f0b989f3e26b)\n\n**Bottom section of the PR showing checks status and merge pull request button**\n\n![mock-pr-merge-section.png](https://adorable-wombat-701.convex.cloud/api/storage/b6f45735-557f-4f40-8fb6-66fb64bbd0fa)\n\n**Additional screenshot thumbnails showing various UI states captured in the mock PR**\n\n![mock-pr-more-screenshots.png](https://adorable-wombat-701.convex.cloud/api/storage/ac844192-9791-48be-80fc-b54409f390a7)\n\n**Screenshot preview section showing the cmux-agent bot comment with workspace and browser links, and 21 captured screenshots**\n\n![mock-pr-screenshot-previews.png](https://adorable-wombat-701.convex.cloud/api/storage/76226636-8b98-4e9a-991a-469432042f10)\n\n**cmux workspace Browser view displaying the cmux.dev landing page with full-page preview**\n\n![mock-workspace-browser-view.png](https://adorable-wombat-701.convex.cloud/api/storage/45e45d92-a404-4d22-96ad-5c9a4bab70e2)\n\n**cmux workspace Git Diff view showing 3 changed files with inline code diffs**\n\n![mock-workspace-git-diff-view.png](https://adorable-wombat-701.convex.cloud/api/storage/12ff7461-70f4-43c4-aeab-de1eed29d4fb)\n\n**cmux workspace view showing VS Code interface with file explorer, code editor \\(LAUNCH.md\\), and browser preview of cmux.dev landing page**\n\n![mock-workspace-tab.png](https://adorable-wombat-701.convex.cloud/api/storage/5684fd60-1071-4998-9bbf-3d664d70df40)\n\n**cmux workspace Terminals view showing a terminal with Claude Code CLI running and tmux session tabs at the bottom**\n\n![mock-workspace-terminals-view.png](https://adorable-wombat-701.convex.cloud/api/storage/45ab2c57-22c1-4a58-acce-9b6ad2fd7efc)\n\n**Top section of the preview page showing the header, repository setup, and 'What is preview.new?' section**\n\n![viewport-top-section.png](https://adorable-wombat-701.convex.cloud/api/storage/8edcc16a-635f-4d5e-aaaa-a7c39ffcab7f)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"d8e6ee9102682aa38e4432c257239368c48157ea","createdAt":"2025-12-05T10:50:01Z","updatedAt":"2025-12-05T10:51:32Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1173#issuecomment-3616330332"},{"type":"issue_comment","id":3616336100,"prNumber":1173,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.dev/austin-dev/task/kn78vmy0b5td1saf5q02zdyq317wqe75?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.dev/austin-dev/task/kn78vmy0b5td1saf5q02zdyq317wqe75/run/kd7ayfrhswas1qazb385qawtmd7wp7fe/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1173?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 2 screenshots for commit `97c5a93` (2025-12-05 10:51:29.349 UTC).\n\n![01-preview-page-top.png](https://famous-camel-162.convex.cloud/api/storage/8a1503f5-a346-4348-beab-28abc1a3ecbc)\n\n![02-preview-page-full.png](https://famous-camel-162.convex.cloud/api/storage/ef37c142-1561-46c7-9f10-e7e10d4822f5)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"d8e6ee9102682aa38e4432c257239368c48157ea","createdAt":"2025-12-05T10:51:32Z","updatedAt":"2025-12-05T11:04:24Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1173#issuecomment-3616336100"},{"type":"issue_comment","id":3616402608,"prNumber":1173,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7dhm8t2gq20gcf26233smqx97wp9yb?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn7dhm8t2gq20gcf26233smqx97wp9yb/run/kd7dz7mnrhnes7fkz82zvpy7k17wqxcy/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1173?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 13 screenshots for commit `d8e6ee9` (2025-12-05 11:04:22.201 UTC).\n\n**Full page view of the preview.new landing page showing all sections including hero, features, configured repositories, and the new mock GitHub PR browser at the bottom**\n\n![01-full-page-preview-dashboard.png](https://adorable-wombat-701.convex.cloud/api/storage/e118d9f6-ff99-4be9-af4f-b69badff86ec)\n\n**Mock GitHub PR browser showing a sample pull request with screenshot gallery from the cmux preview system**\n\n![02-mock-github-pr-browser-full.png](https://adorable-wombat-701.convex.cloud/api/storage/9f09b10c-bdca-42a1-9ce1-2cac4d35d619)\n\n**Mock cmux workspace tab showing VS Code interface with file explorer, code editor displaying LAUNCH.md, browser preview of cmux.dev, and git diff panel**\n\n![03-mock-cmux-workspace-tab.png](https://adorable-wombat-701.convex.cloud/api/storage/299e9cdc-1c71-40cb-a3f1-c231c4c2f251)\n\n**Mock cmux browser view focused on the browser panel showing the cmux.dev landing page**\n\n![04-mock-cmux-browser-view.png](https://adorable-wombat-701.convex.cloud/api/storage/50ad9ccf-422c-49e4-bbfa-6ebacb9ade0b)\n\n**Mock cmux terminals view showing Claude Code CLI running with tmux session tabs at the bottom**\n\n![05-mock-cmux-terminals-view.png](https://adorable-wombat-701.convex.cloud/api/storage/22ba85b3-403b-405c-8173-bd72fc70cfa1)\n\n**Mock cmux three-panel workspace view showing VS Code editor, browser preview, and git diff all simultaneously**\n\n![06-mock-cmux-three-panel-view.png](https://adorable-wombat-701.convex.cloud/api/storage/8c022842-6a95-4b78-b584-55657c4f5d3e)\n\n**Mock GitHub PR conversation tab showing PR description, cmux-agent bot comment with 21 screenshots, and merge controls**\n\n![07-mock-github-pr-view-conversation.png](https://adorable-wombat-701.convex.cloud/api/storage/02236eef-7262-4130-8519-94e9ae50ab6d)\n\n**Hero section of the preview.new landing page with title, description, repository URL input field, and team/account selectors**\n\n![08-top-hero-section.png](https://adorable-wombat-701.convex.cloud/api/storage/7fdf0be5-2548-4c94-b635-db69e03a7ee5)\n\n**Features section showing three feature cards: Computer use agent, GitHub comments, and Isolated dev servers**\n\n![09-features-section.png](https://adorable-wombat-701.convex.cloud/api/storage/f8291d16-f4e5-4987-ba73-1c9bfeed9644)\n\n**Bottom section with cmux branding, description, and call-to-action buttons \\(Star on GitHub, Explore cmux\\)**\n\n![10-from-creators-of-cmux-section.png](https://adorable-wombat-701.convex.cloud/api/storage/bb19a23f-ce20-4da1-97dd-9111fa15b4e9)\n\n**Screenshot gallery section showing thumbnail grid of mock PR screenshots with captions**\n\n![11-screenshot-lightbox-view.png](https://adorable-wombat-701.convex.cloud/api/storage/aad56398-738a-4c90-b702-1412b4eac274)\n\n**Detailed view of the screenshot gallery with 'Preview Screenshots' heading and action buttons \\(Open Workspace, Open Dev Browser, Open Diff Heatmap\\)**\n\n![12-screenshot-gallery-thumbnails.png](https://adorable-wombat-701.convex.cloud/api/storage/e473a1f0-2427-4447-8176-ae4ded6786af)\n\n**Mock browser control panel showing tab switcher \\(GitHub/cmux tabs\\), window controls, and URL bar at the top of the mock browser interface**\n\n![13-mock-browser-controls.png](https://adorable-wombat-701.convex.cloud/api/storage/0358cc82-4153-4468-aa5a-dac6a7236b56)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"d8e6ee9102682aa38e4432c257239368c48157ea","createdAt":"2025-12-05T11:04:23Z","updatedAt":"2025-12-05T11:05:51Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1173#issuecomment-3616402608"},{"type":"issue_comment","id":3616407649,"prNumber":1173,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.dev/austin-dev/task/kn7666jht0aj9ha8rx1hh3bkfh7wq1xn?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.dev/austin-dev/task/kn7666jht0aj9ha8rx1hh3bkfh7wq1xn/run/kd758ad6vqg446ngqss8fc1g4d7wqaec/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1173?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 13 screenshots for commit `d8e6ee9` (2025-12-05 11:05:47.722 UTC).\n\n**Full page view of the preview.new landing page showing all sections including the interactive mock GitHub PR browser**\n\n![01-preview-page-full.png](https://famous-camel-162.convex.cloud/api/storage/b01cf3ce-4302-4224-bb8a-67fd72b0eec9)\n\n**Close-up of the mock browser tabs \\(GitHub and cmux\\) at the top of the embedded browser component**\n\n![02-mock-github-pr-browser-tabs.png](https://famous-camel-162.convex.cloud/api/storage/04c0c745-4b8b-4b48-b2db-4d4676518b8c)\n\n**Mock GitHub PR conversation tab showing PR details, description, and preview screenshots section**\n\n![03-mock-github-pr-conversation-tab.png](https://famous-camel-162.convex.cloud/api/storage/f8977fb3-96ce-4848-bc94-40d62e402a14)\n\n**Mock cmux workspace showing three-panel layout with sidebar navigation, VS Code editor with file tree and LAUNCH.md, and browser preview of cmux.dev**\n\n![04-mock-workspace-three-panel-view.png](https://famous-camel-162.convex.cloud/api/storage/69592cba-4e74-4931-bd26-2d20b37764b0)\n\n**Mock cmux workspace focused on browser panel showing the cmux.dev landing page**\n\n![05-mock-workspace-browser-single-panel.png](https://famous-camel-162.convex.cloud/api/storage/3e878455-626d-4d17-ac45-06f3d0382540)\n\n**Mock cmux workspace terminal view showing Claude Code CLI output with tmux session tabs at bottom**\n\n![06-mock-workspace-terminals-view.png](https://famous-camel-162.convex.cloud/api/storage/d9103ab2-9889-409b-9d97-713b764aa30a)\n\n**Mock cmux workspace terminal showing dev session logs with server output and HMR updates**\n\n![07-mock-workspace-terminals-dev-session.png](https://famous-camel-162.convex.cloud/api/storage/b37b5faa-c4b9-48a4-8a79-dd7e7cb6e18a)\n\n**Mock GitHub PR commits tab showing list of 14 commits with avatars, commit messages, and timestamps**\n\n![08-mock-github-pr-commits-tab.png](https://famous-camel-162.convex.cloud/api/storage/a3873e12-8bb3-4d96-9c80-fc70f710e0fb)\n\n**Mock GitHub PR files changed tab showing code diffs with syntax highlighting and line numbers**\n\n![09-mock-github-pr-files-changed-tab.png](https://famous-camel-162.convex.cloud/api/storage/ff7f4f63-20d4-4aa9-a35f-88fa15b2afff)\n\n**Top section of preview.new page with header, repository URL input, team selector, and repository search**\n\n![10-preview-page-top-header-section.png](https://famous-camel-162.convex.cloud/api/storage/44d988e6-759d-4023-9fea-086a1dc2b78d)\n\n**What is preview.new section showing three feature cards and configured repositories list**\n\n![11-what-is-preview-section.png](https://famous-camel-162.convex.cloud/api/storage/3f4fa2ff-d81e-427b-8bc8-2d9746a8601a)\n\n**From the creators of section with cmux promotional content and the top of the interactive mock browser**\n\n![12-from-creators-of-section-with-mock-browser.png](https://famous-camel-162.convex.cloud/api/storage/1af34f71-8dd0-4160-ae5d-a0b38140b3b6)\n\n**Mock GitHub PR preview screenshots section showing thumbnail grid of UI screenshots with descriptions**\n\n![13-mock-github-pr-screenshots-section.png](https://famous-camel-162.convex.cloud/api/storage/76214461-9b91-4f73-ab28-51f5ed4f5f35)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"d8e6ee9102682aa38e4432c257239368c48157ea","createdAt":"2025-12-05T11:05:50Z","updatedAt":"2025-12-05T11:05:50Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1173#issuecomment-3616407649"}]}
{"number":1172,"title":"Implement image-pillbox previews for pasted images","state":"open","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1172","headRef":"cmux/implement-image-pillbox-previews-for-pasted-images-1yjhz","headSha":"857ac79cef5363cacd99b542a391705b3ac198cc","baseRef":"main","baseSha":"88c97370f046f985c32ea2312f16121583854274","createdAt":"2025-12-04T08:19:33Z","updatedAt":"2025-12-04T08:36:11Z","diff":"diff --git a/apps/client/src/components/lexical/ImageComponent.tsx b/apps/client/src/components/lexical/ImageComponent.tsx\nindex 6fe377143..09ca04b2c 100644\n--- a/apps/client/src/components/lexical/ImageComponent.tsx\n+++ b/apps/client/src/components/lexical/ImageComponent.tsx\n@@ -1,27 +1,25 @@\n-// No React import needed with the automatic JSX runtime\n+import { ImagePillbox } from \"./ImagePillbox\";\n+\n+interface ImageComponentProps {\n+  src: string;\n+  altText: string;\n+  fileName?: string;\n+  nodeKey?: string;\n+  onRemove?: () => void;\n+}\n \n export default function ImageComponent({\n   src,\n   altText,\n   fileName,\n-}: {\n-  src: string;\n-  altText: string;\n-  fileName?: string;\n-}) {\n+  onRemove,\n+}: ImageComponentProps) {\n   return (\n-    <div className=\"relative inline-block my-2\">\n-      <img\n-        src={src}\n-        alt={altText}\n-        className=\"max-w-full h-auto rounded-lg border border-neutral-200 dark:border-neutral-700\"\n-        style={{ maxHeight: \"300px\" }}\n-      />\n-      {fileName && (\n-        <div className=\"absolute bottom-0 left-0 right-0 bg-black/50 text-white text-xs px-2 py-1 rounded-b-lg\">\n-          {fileName}\n-        </div>\n-      )}\n-    </div>\n+    <ImagePillbox\n+      src={src}\n+      altText={altText}\n+      fileName={fileName}\n+      onRemove={onRemove}\n+    />\n   );\n }\ndiff --git a/apps/client/src/components/lexical/ImageNode.tsx b/apps/client/src/components/lexical/ImageNode.tsx\nindex 2999cc847..fa5acbd60 100644\n--- a/apps/client/src/components/lexical/ImageNode.tsx\n+++ b/apps/client/src/components/lexical/ImageNode.tsx\n@@ -11,7 +11,7 @@ import type {\n \n import { $applyNodeReplacement, DecoratorNode, type LexicalEditor } from \"lexical\";\n import * as React from \"react\";\n-import ImageComponent from \"./ImageComponent\";\n+import { ImageNodeComponent } from \"./ImageNodeComponent\";\n \n export interface ImagePayload {\n   altText: string;\n@@ -132,8 +132,16 @@ export class ImageNode extends DecoratorNode<React.JSX.Element> {\n     return this.__fileName;\n   }\n \n-  decorate(_editor: LexicalEditor, _config: EditorConfig): React.JSX.Element {\n-    return <ImageComponent src={this.__src} altText={this.__altText} fileName={this.__fileName} />;\n+  decorate(editor: LexicalEditor, _config: EditorConfig): React.JSX.Element {\n+    return (\n+      <ImageNodeComponent\n+        src={this.__src}\n+        altText={this.__altText}\n+        fileName={this.__fileName}\n+        nodeKey={this.__key}\n+        editor={editor}\n+      />\n+    );\n   }\n }\n \ndiff --git a/apps/client/src/components/lexical/ImageNodeComponent.tsx b/apps/client/src/components/lexical/ImageNodeComponent.tsx\nnew file mode 100644\nindex 000000000..6bc62a2c2\n--- /dev/null\n+++ b/apps/client/src/components/lexical/ImageNodeComponent.tsx\n@@ -0,0 +1,38 @@\n+import { $getNodeByKey, type LexicalEditor } from \"lexical\";\n+import { useCallback } from \"react\";\n+import ImageComponent from \"./ImageComponent\";\n+\n+interface ImageNodeComponentProps {\n+  src: string;\n+  altText: string;\n+  fileName?: string;\n+  nodeKey: string;\n+  editor: LexicalEditor;\n+}\n+\n+export function ImageNodeComponent({\n+  src,\n+  altText,\n+  fileName,\n+  nodeKey,\n+  editor,\n+}: ImageNodeComponentProps) {\n+  const handleRemove = useCallback(() => {\n+    editor.update(() => {\n+      const node = $getNodeByKey(nodeKey);\n+      if (node) {\n+        node.remove();\n+      }\n+    });\n+  }, [editor, nodeKey]);\n+\n+  return (\n+    <ImageComponent\n+      src={src}\n+      altText={altText}\n+      fileName={fileName}\n+      nodeKey={nodeKey}\n+      onRemove={handleRemove}\n+    />\n+  );\n+}\ndiff --git a/apps/client/src/components/lexical/ImagePillbox.tsx b/apps/client/src/components/lexical/ImagePillbox.tsx\nnew file mode 100644\nindex 000000000..15b625d62\n--- /dev/null\n+++ b/apps/client/src/components/lexical/ImagePillbox.tsx\n@@ -0,0 +1,105 @@\n+import { X, Image as ImageIcon } from \"lucide-react\";\n+import { useState, useCallback } from \"react\";\n+import { ImagePreviewDialog } from \"./ImagePreviewDialog\";\n+\n+interface ImagePillboxProps {\n+  src: string;\n+  altText: string;\n+  fileName?: string;\n+  onRemove?: () => void;\n+}\n+\n+export function ImagePillbox({\n+  src,\n+  altText,\n+  fileName,\n+  onRemove,\n+}: ImagePillboxProps) {\n+  const [isPreviewOpen, setIsPreviewOpen] = useState(false);\n+\n+  const displayName = fileName || altText || \"Image\";\n+  // Truncate long filenames\n+  const truncatedName =\n+    displayName.length > 20\n+      ? `${displayName.slice(0, 17)}...`\n+      : displayName;\n+\n+  const handleClick = useCallback(\n+    (e: React.MouseEvent) => {\n+      e.preventDefault();\n+      e.stopPropagation();\n+      setIsPreviewOpen(true);\n+    },\n+    []\n+  );\n+\n+  const handleRemove = useCallback(\n+    (e: React.MouseEvent) => {\n+      e.preventDefault();\n+      e.stopPropagation();\n+      onRemove?.();\n+    },\n+    [onRemove]\n+  );\n+\n+  const handleKeyDown = useCallback(\n+    (e: React.KeyboardEvent) => {\n+      if (e.key === \"Enter\" || e.key === \" \") {\n+        e.preventDefault();\n+        setIsPreviewOpen(true);\n+      }\n+    },\n+    []\n+  );\n+\n+  return (\n+    <>\n+      <span\n+        className=\"inline-flex items-center gap-1.5 px-2 py-1 my-0.5 mx-0.5 rounded-lg bg-neutral-100 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 text-neutral-700 dark:text-neutral-300 text-sm cursor-pointer hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-colors select-none\"\n+        onClick={handleClick}\n+        onKeyDown={handleKeyDown}\n+        role=\"button\"\n+        tabIndex={0}\n+        title={`Click to preview: ${displayName}`}\n+      >\n+        {/* Thumbnail preview */}\n+        <span className=\"relative flex-shrink-0 w-5 h-5 rounded overflow-hidden bg-neutral-200 dark:bg-neutral-700\">\n+          <img\n+            src={src}\n+            alt={altText}\n+            className=\"w-full h-full object-cover\"\n+            draggable={false}\n+          />\n+        </span>\n+\n+        {/* Filename */}\n+        <span className=\"truncate max-w-[120px] text-xs font-medium\">\n+          {truncatedName}\n+        </span>\n+\n+        {/* Image icon indicator */}\n+        <ImageIcon className=\"w-3 h-3 text-neutral-400 dark:text-neutral-500 flex-shrink-0\" />\n+\n+        {/* Remove button */}\n+        {onRemove && (\n+          <button\n+            type=\"button\"\n+            onClick={handleRemove}\n+            className=\"flex-shrink-0 p-0.5 rounded-full hover:bg-neutral-300 dark:hover:bg-neutral-600 transition-colors\"\n+            title=\"Remove image\"\n+          >\n+            <X className=\"w-3 h-3\" />\n+          </button>\n+        )}\n+      </span>\n+\n+      <ImagePreviewDialog\n+        isOpen={isPreviewOpen}\n+        onClose={() => setIsPreviewOpen(false)}\n+        src={src}\n+        altText={altText}\n+        fileName={fileName}\n+      />\n+    </>\n+  );\n+}\ndiff --git a/apps/client/src/components/lexical/ImagePreviewDialog.tsx b/apps/client/src/components/lexical/ImagePreviewDialog.tsx\nnew file mode 100644\nindex 000000000..0dcca8609\n--- /dev/null\n+++ b/apps/client/src/components/lexical/ImagePreviewDialog.tsx\n@@ -0,0 +1,163 @@\n+import { X, Download, ZoomIn, ZoomOut } from \"lucide-react\";\n+import { useCallback, useEffect, useState, useRef } from \"react\";\n+\n+interface ImagePreviewDialogProps {\n+  isOpen: boolean;\n+  onClose: () => void;\n+  src: string;\n+  altText: string;\n+  fileName?: string;\n+}\n+\n+export function ImagePreviewDialog({\n+  isOpen,\n+  onClose,\n+  src,\n+  altText,\n+  fileName,\n+}: ImagePreviewDialogProps) {\n+  const [scale, setScale] = useState(1);\n+  const backdropRef = useRef<HTMLDivElement>(null);\n+\n+  const handleKeyDown = useCallback(\n+    (e: KeyboardEvent) => {\n+      if (e.key === \"Escape\") {\n+        onClose();\n+      }\n+      if (e.key === \"+\" || e.key === \"=\") {\n+        setScale((s) => Math.min(s + 0.25, 3));\n+      }\n+      if (e.key === \"-\") {\n+        setScale((s) => Math.max(s - 0.25, 0.25));\n+      }\n+    },\n+    [onClose]\n+  );\n+\n+  useEffect(() => {\n+    if (isOpen) {\n+      document.addEventListener(\"keydown\", handleKeyDown);\n+      // Prevent scrolling on body when dialog is open\n+      document.body.style.overflow = \"hidden\";\n+      return () => {\n+        document.removeEventListener(\"keydown\", handleKeyDown);\n+        document.body.style.overflow = \"\";\n+      };\n+    }\n+  }, [isOpen, handleKeyDown]);\n+\n+  // Reset scale when dialog opens\n+  useEffect(() => {\n+    if (isOpen) {\n+      setScale(1);\n+    }\n+  }, [isOpen]);\n+\n+  const handleBackdropClick = useCallback(\n+    (e: React.MouseEvent) => {\n+      if (e.target === backdropRef.current) {\n+        onClose();\n+      }\n+    },\n+    [onClose]\n+  );\n+\n+  const handleDownload = useCallback(() => {\n+    const link = document.createElement(\"a\");\n+    link.href = src;\n+    link.download = fileName || \"image.png\";\n+    document.body.appendChild(link);\n+    link.click();\n+    document.body.removeChild(link);\n+  }, [src, fileName]);\n+\n+  const handleZoomIn = useCallback(() => {\n+    setScale((s) => Math.min(s + 0.25, 3));\n+  }, []);\n+\n+  const handleZoomOut = useCallback(() => {\n+    setScale((s) => Math.max(s - 0.25, 0.25));\n+  }, []);\n+\n+  if (!isOpen) return null;\n+\n+  const displayName = fileName || altText || \"Image\";\n+\n+  return (\n+    <div\n+      ref={backdropRef}\n+      onClick={handleBackdropClick}\n+      className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm\"\n+    >\n+      {/* Header with controls */}\n+      <div className=\"absolute top-0 left-0 right-0 flex items-center justify-between px-4 py-3 bg-gradient-to-b from-black/60 to-transparent\">\n+        <div className=\"flex items-center gap-3\">\n+          <span className=\"text-white text-sm font-medium truncate max-w-[300px]\">\n+            {displayName}\n+          </span>\n+        </div>\n+        <div className=\"flex items-center gap-2\">\n+          {/* Zoom controls */}\n+          <button\n+            type=\"button\"\n+            onClick={handleZoomOut}\n+            className=\"p-2 rounded-full bg-white/10 hover:bg-white/20 text-white transition-colors\"\n+            title=\"Zoom out (-)\"\n+          >\n+            <ZoomOut className=\"w-4 h-4\" />\n+          </button>\n+          <span className=\"text-white text-sm min-w-[60px] text-center\">\n+            {Math.round(scale * 100)}%\n+          </span>\n+          <button\n+            type=\"button\"\n+            onClick={handleZoomIn}\n+            className=\"p-2 rounded-full bg-white/10 hover:bg-white/20 text-white transition-colors\"\n+            title=\"Zoom in (+)\"\n+          >\n+            <ZoomIn className=\"w-4 h-4\" />\n+          </button>\n+\n+          {/* Download button */}\n+          <button\n+            type=\"button\"\n+            onClick={handleDownload}\n+            className=\"p-2 rounded-full bg-white/10 hover:bg-white/20 text-white transition-colors ml-2\"\n+            title=\"Download image\"\n+          >\n+            <Download className=\"w-4 h-4\" />\n+          </button>\n+\n+          {/* Close button */}\n+          <button\n+            type=\"button\"\n+            onClick={onClose}\n+            className=\"p-2 rounded-full bg-white/10 hover:bg-white/20 text-white transition-colors ml-2\"\n+            title=\"Close (Esc)\"\n+          >\n+            <X className=\"w-4 h-4\" />\n+          </button>\n+        </div>\n+      </div>\n+\n+      {/* Image container */}\n+      <div className=\"relative max-w-[90vw] max-h-[85vh] overflow-auto\">\n+        <img\n+          src={src}\n+          alt={altText}\n+          className=\"rounded-lg shadow-2xl transition-transform duration-200\"\n+          style={{\n+            transform: `scale(${scale})`,\n+            transformOrigin: \"center center\",\n+          }}\n+          draggable={false}\n+        />\n+      </div>\n+\n+      {/* Hint text */}\n+      <div className=\"absolute bottom-4 left-1/2 -translate-x-1/2 text-white/60 text-xs\">\n+        Press Esc to close, +/- to zoom\n+      </div>\n+    </div>\n+  );\n+}\n","comments":[{"type":"issue_comment","id":3610847259,"prNumber":1172,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.dev/manaflow/task/kn746fjv07vfp4q5q6brx6h5eh7wnpnt?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.dev/manaflow/task/kn746fjv07vfp4q5q6brx6h5eh7wnpnt/run/kd76ecc9d5p9gdjjsww9t37g357wnm99/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1172?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 6 screenshots for commit `857ac79` (2025-12-04 08:26:51.016 UTC).\n\n**Initial dashboard state showing the task input area before any image is uploaded**\n\n![1-dashboard-initial-state.png](https://adorable-wombat-701.convex.cloud/api/storage/9c6e41e2-4346-44bc-b2ed-c5b7e4b16ab9)\n\n**Dashboard showing the new image pillbox component after uploading an image - displays thumbnail, filename, image icon, and remove button**\n\n![2-dashboard-with-image-pillbox.png](https://adorable-wombat-701.convex.cloud/api/storage/611fef7a-76ed-4d04-88cd-27b283fba94e)\n\n**Close-up view of the image pillbox component showing the compact pill-shaped UI with thumbnail preview**\n\n![3-image-pillbox-closeup.png](https://adorable-wombat-701.convex.cloud/api/storage/818c207a-3049-4e71-9f84-92b6ed545c60)\n\n**Image preview dialog opened after clicking the pillbox - shows full-screen preview with zoom controls \\(zoom in/out buttons\\), download button, close button, and zoom percentage indicator at 100%**\n\n![4-image-preview-dialog-open.png](https://adorable-wombat-701.convex.cloud/api/storage/564326bc-109a-44d9-a52a-dfe1f6b2ddad)\n\n**Image preview dialog with zoom functionality demonstrated - image zoomed to 125% after clicking the zoom in button**\n\n![5-image-preview-dialog-zoomed-125.png](https://adorable-wombat-701.convex.cloud/api/storage/da106bc2-2806-4ce4-9837-f2aa71384fec)\n\n**Dashboard after clicking the remove button on the image pillbox - shows the pillbox has been removed and the input area is empty again**\n\n![6-after-image-removed.png](https://adorable-wombat-701.convex.cloud/api/storage/01f01a49-fbe8-4315-b92b-6b16ce2222b1)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"857ac79cef5363cacd99b542a391705b3ac198cc","createdAt":"2025-12-04T08:26:52Z","updatedAt":"2025-12-04T08:26:52Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1172#issuecomment-3610847259"},{"type":"issue_comment","id":3610856316,"prNumber":1172,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7986exhxh2qyzawvwacne51n7wmeq9?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7986exhxh2qyzawvwacne51n7wmeq9/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1172?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 7 screenshots for commit `857ac79` (2025-12-04 08:29:11.641 UTC).\n\n**Initial dashboard view showing the task input editor before any images are added**\n\n![01-dashboard-initial.png](https://famous-camel-162.convex.cloud/api/storage/fa74b673-c9ae-4b84-b479-2a5bb81685c9)\n\n**Dashboard with first image pillbox displayed in the editor after pasting an image**\n\n![02-image-pillbox-in-editor.png](https://famous-camel-162.convex.cloud/api/storage/66116aec-d65f-4d83-956a-adc3e615f884)\n\n**Close-up view of the image pillbox component showing thumbnail, filename, image icon, and remove button**\n\n![03-image-pillbox-closeup.png](https://famous-camel-162.convex.cloud/api/storage/b4d0346a-659c-4d69-bc8a-095b13abd0b8)\n\n**Full-screen image preview dialog opened showing the image with zoom controls \\(100%\\), download button, and close button**\n\n![04-image-preview-dialog-opened.png](https://famous-camel-162.convex.cloud/api/storage/c099024e-4fcc-4119-97ae-0e9c39a1da4e)\n\n**Image preview dialog with zoom increased to 125% demonstrating the zoom in functionality**\n\n![05-image-preview-zoomed-125-percent.png](https://famous-camel-162.convex.cloud/api/storage/7ced6371-cb93-43f0-9db3-898a89ea6e43)\n\n**Editor showing multiple image pillboxes \\(test-image.png and screenshot.png\\) demonstrating support for multiple pasted images**\n\n![06-multiple-image-pillboxes.png](https://famous-camel-162.convex.cloud/api/storage/b0905fd7-81a8-40ab-9b65-641707c0db6d)\n\n**Close-up of multiple image pillboxes showing the hover state and UI elements including thumbnails and remove buttons**\n\n![07-image-pillboxes-with-hover-state.png](https://famous-camel-162.convex.cloud/api/storage/bfa89914-2f32-4c9a-9ea3-c15cf19ada31)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"857ac79cef5363cacd99b542a391705b3ac198cc","createdAt":"2025-12-04T08:29:14Z","updatedAt":"2025-12-04T08:29:14Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1172#issuecomment-3610856316"}]}
{"number":1170,"title":"Ensure electron deeplink when returnUrl is missing","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1170","headRef":"cmux/ensure-electron-deeplink-when-return-url-is-missin-p6r4l","headSha":"a7dd48f76a43300905cf3dd8fdfef597adbe50f8","baseRef":"main","baseSha":"755a167b5171c7af7e1dd67408f15a911864984b","createdAt":"2025-12-04T07:05:35Z","updatedAt":"2025-12-04T07:10:33Z","diff":"diff --git a/apps/www/app/(home)/handler/after-sign-in/CheckSessionStorageRedirect.tsx b/apps/www/app/(home)/handler/after-sign-in/CheckSessionStorageRedirect.tsx\nindex 80467a205..3281970cc 100644\n--- a/apps/www/app/(home)/handler/after-sign-in/CheckSessionStorageRedirect.tsx\n+++ b/apps/www/app/(home)/handler/after-sign-in/CheckSessionStorageRedirect.tsx\n@@ -1,22 +1,26 @@\n \"use client\";\n \n-import { useEffect } from \"react\";\n+import { useEffect, useState } from \"react\";\n import { useRouter } from \"next/navigation\";\n import { Loader2 } from \"lucide-react\";\n+import { OpenCmuxClient } from \"./OpenCmuxClient\";\n \n const OAUTH_CALLBACK_KEY = \"oauth_callback_url\";\n \n type CheckSessionStorageRedirectProps = {\n   fallbackPath: string;\n+  electronFallbackHref?: string | null;\n };\n \n export function CheckSessionStorageRedirect({\n   fallbackPath,\n+  electronFallbackHref,\n }: CheckSessionStorageRedirectProps) {\n   const router = useRouter();\n+  const [useElectronDeeplink, setUseElectronDeeplink] = useState(false);\n \n   useEffect(() => {\n-    let redirectPath = fallbackPath;\n+    let redirectPath: string | null = null;\n \n     try {\n       const storedCallback = sessionStorage.getItem(OAUTH_CALLBACK_KEY);\n@@ -31,9 +35,30 @@ export function CheckSessionStorageRedirect({\n       // sessionStorage not available\n     }\n \n-    console.log(\"[CheckSessionStorageRedirect] Redirecting to:\", redirectPath);\n-    router.replace(redirectPath);\n-  }, [router, fallbackPath]);\n+    // If we have a stored web callback URL, use it\n+    if (redirectPath) {\n+      console.log(\"[CheckSessionStorageRedirect] Redirecting to stored callback:\", redirectPath);\n+      router.replace(redirectPath);\n+      return;\n+    }\n+\n+    // If we have an electron fallback href (with auth tokens), use electron deeplink\n+    // This is the default behavior for users coming from Electron without a web returnUrl\n+    if (electronFallbackHref) {\n+      console.log(\"[CheckSessionStorageRedirect] No stored callback, using electron deeplink\");\n+      setUseElectronDeeplink(true);\n+      return;\n+    }\n+\n+    // Final fallback to web path\n+    console.log(\"[CheckSessionStorageRedirect] Redirecting to fallback:\", fallbackPath);\n+    router.replace(fallbackPath);\n+  }, [router, fallbackPath, electronFallbackHref]);\n+\n+  // If using electron deeplink, render the OpenCmuxClient component\n+  if (useElectronDeeplink && electronFallbackHref) {\n+    return <OpenCmuxClient href={electronFallbackHref} />;\n+  }\n \n   return (\n     <div className=\"min-h-dvh bg-[#05050a] text-white flex items-center justify-center font-sans\">\ndiff --git a/apps/www/app/(home)/handler/after-sign-in/page.tsx b/apps/www/app/(home)/handler/after-sign-in/page.tsx\nindex 224cce1df..30f631c53 100644\n--- a/apps/www/app/(home)/handler/after-sign-in/page.tsx\n+++ b/apps/www/app/(home)/handler/after-sign-in/page.tsx\n@@ -83,11 +83,12 @@ export default async function AfterSignInPage({ searchParams: searchParamsPromis\n     hasAccessToken: !!stackAccessToken,\n   });\n \n-  // If no return URL in query params, this is a client component that will check sessionStorage\n-  // For OAuth popup flow, the callback URL is stored in sessionStorage\n+  // If no return URL in query params, check sessionStorage first (for OAuth popup flow),\n+  // then fall back to Electron deep link (default for desktop users)\n   if (!afterAuthReturnToRaw) {\n-    // Return a client component that checks sessionStorage\n-    return <CheckSessionStorageRedirect fallbackPath=\"/\" />;\n+    // Return a client component that checks sessionStorage, with electron deeplink as fallback\n+    const electronFallbackHref = buildCmuxHref(null, stackRefreshToken, stackAccessToken);\n+    return <CheckSessionStorageRedirect fallbackPath=\"/\" electronFallbackHref={electronFallbackHref} />;\n   }\n \n   // Handle Electron deep link redirects\n","comments":[{"type":"issue_comment","id":3610624793,"prNumber":1170,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.dev/austin-dev/task/kn7c3m5yt5rsnqpzdtdfjegxs57wm3dv?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.dev/austin-dev/task/kn7c3m5yt5rsnqpzdtdfjegxs57wm3dv/run/kd7d2074tdk1a1gd6bke7g4g3n7wn04y/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1170?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 7 screenshots for commit `a7dd48f` (2025-12-04 07:10:31.619 UTC).\n\n**Close-up of the 'Opening cmux...' heading text**\n\n![after-sign-in-heading.png](https://famous-camel-162.convex.cloud/api/storage/94d92836-1643-4dae-9519-f638cdad11d8)\n\n**Loading state with spinner showing 'Completing sign in...' message on dark background**\n\n![after-sign-in-loading-state-fullpage.png](https://famous-camel-162.convex.cloud/api/storage/1c3cbb8f-23a2-4465-90e1-361a61df5ed7)\n\n**Close-up of the 'Completing sign in...' loading text**\n\n![after-sign-in-loading-text.png](https://famous-camel-162.convex.cloud/api/storage/5645aecc-b724-4494-b422-19746e2c544f)\n\n**Close-up of the 'Open cmux' button component**\n\n![after-sign-in-open-button.png](https://famous-camel-162.convex.cloud/api/storage/571a7cf9-bf50-4329-8a98-c1ddb30f4011)\n\n**OpenCmuxClient component in dark mode showing 'Opening cmux...' with manual open button**\n\n![after-sign-in-opening-cmux-darkmode-fullpage.png](https://famous-camel-162.convex.cloud/api/storage/dcc9f35e-f994-48ba-97b9-c1ed0f95d707)\n\n**Initial OpenCmuxClient component view with 'Opening cmux...' heading and open button**\n\n![after-sign-in-opening-cmux-fullpage.png](https://famous-camel-162.convex.cloud/api/storage/c5946b03-bab1-4f2b-87de-a4aa40193274)\n\n**OpenCmuxClient component in light mode showing the same UI with light theme colors**\n\n![after-sign-in-opening-cmux-lightmode-fullpage.png](https://famous-camel-162.convex.cloud/api/storage/b769b3a0-152a-459d-bae9-f0c40d51b558)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"a7dd48f76a43300905cf3dd8fdfef597adbe50f8","createdAt":"2025-12-04T07:10:32Z","updatedAt":"2025-12-04T07:10:32Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1170#issuecomment-3610624793"}]}
{"number":1168,"title":"Replace VNC iframe with React component; auto-reconnect and paste fix","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1168","headRef":"cmux/replace-vnc-iframe-with-react-component-auto-recon-i5t4b","headSha":"91aadb246182a2708e96fb9975e047090cbf8603","baseRef":"main","baseSha":"8f33d1c716eae888486163164e6d076b618bc220","createdAt":"2025-12-04T06:17:19Z","updatedAt":"2025-12-05T01:08:15Z","diff":"diff --git a/apps/client/package.json b/apps/client/package.json\nindex 07049ce73..3b5a0d05f 100644\n--- a/apps/client/package.json\n+++ b/apps/client/package.json\n@@ -71,6 +71,7 @@\n     \"@lezer/highlight\": \"^1.2.1\",\n     \"@mantine/hooks\": \"^8.1.3\",\n     \"@monaco-editor/react\": \"^4.7.0\",\n+    \"@novnc/novnc\": \"1.7.0-beta\",\n     \"@posthog/react\": \"^1.4.0\",\n     \"@radix-ui/react-dialog\": \"^1.1.6\",\n     \"@radix-ui/react-dropdown-menu\": \"^2.1.15\",\ndiff --git a/apps/client/src/components/EnvironmentConfiguration.tsx b/apps/client/src/components/EnvironmentConfiguration.tsx\nindex 6fc76f96f..699d00be8 100644\n--- a/apps/client/src/components/EnvironmentConfiguration.tsx\n+++ b/apps/client/src/components/EnvironmentConfiguration.tsx\n@@ -5,6 +5,7 @@ import { ScriptTextareaField } from \"@/components/ScriptTextareaField\";\n import { SCRIPT_COPY } from \"@/components/scriptCopy\";\n import { ResizableColumns } from \"@/components/ResizableColumns\";\n import { RenderPanel } from \"@/components/TaskPanelFactory\";\n+import { disableDragPointerEvents, restoreDragPointerEvents } from \"@/lib/drag-pointer-events\";\n import { parseEnvBlock } from \"@/lib/parseEnvBlock\";\n import type { PanelPosition, PanelType } from \"@/lib/panel-config\";\n import {\n@@ -313,43 +314,6 @@ export function EnvironmentConfiguration({\n     []\n   );\n \n-  const disableIframePointerEvents = useCallback(() => {\n-    if (typeof document === \"undefined\") {\n-      return;\n-    }\n-    const iframes = document.querySelectorAll(\"iframe\");\n-    for (const node of Array.from(iframes)) {\n-      if (!(node instanceof HTMLIFrameElement)) {\n-        continue;\n-      }\n-      const current = node.style.pointerEvents;\n-      node.dataset.prevPointerEvents = current ? current : \"__unset__\";\n-      node.style.pointerEvents = \"none\";\n-    }\n-  }, []);\n-\n-  const restoreIframePointerEvents = useCallback(() => {\n-    if (typeof document === \"undefined\") {\n-      return;\n-    }\n-    const iframes = document.querySelectorAll(\"iframe\");\n-    for (const node of Array.from(iframes)) {\n-      if (!(node instanceof HTMLIFrameElement)) {\n-        continue;\n-      }\n-      const prev = node.dataset.prevPointerEvents;\n-      if (prev !== undefined) {\n-        if (prev === \"__unset__\") {\n-          node.style.removeProperty(\"pointer-events\");\n-        } else {\n-          node.style.pointerEvents = prev;\n-        }\n-        delete node.dataset.prevPointerEvents;\n-      } else {\n-        node.style.removeProperty(\"pointer-events\");\n-      }\n-    }\n-  }, []);\n \n   const updateSplitFromEvent = useCallback(\n     (event: MouseEvent) => {\n@@ -389,10 +353,10 @@ export function EnvironmentConfiguration({\n     }\n     document.body.style.cursor = \"\";\n     document.body.classList.remove(\"select-none\");\n-    restoreIframePointerEvents();\n+    restoreDragPointerEvents();\n     window.removeEventListener(\"mousemove\", handleSplitDragMove);\n     window.removeEventListener(\"mouseup\", stopSplitDragging);\n-  }, [handleSplitDragMove, restoreIframePointerEvents]);\n+  }, [handleSplitDragMove]);\n \n   const startSplitDragging = useCallback(\n     (event: React.MouseEvent<HTMLDivElement>) => {\n@@ -405,11 +369,11 @@ export function EnvironmentConfiguration({\n       event.preventDefault();\n       document.body.style.cursor = \"row-resize\";\n       document.body.classList.add(\"select-none\");\n-      disableIframePointerEvents();\n+      disableDragPointerEvents();\n       window.addEventListener(\"mousemove\", handleSplitDragMove);\n       window.addEventListener(\"mouseup\", stopSplitDragging);\n     },\n-    [disableIframePointerEvents, handleSplitDragMove, previewMode, stopSplitDragging]\n+    [handleSplitDragMove, previewMode, stopSplitDragging]\n   );\n \n   useEffect(() => {\n@@ -424,9 +388,9 @@ export function EnvironmentConfiguration({\n         document.body.style.cursor = \"\";\n         document.body.classList.remove(\"select-none\");\n       }\n-      restoreIframePointerEvents();\n+      restoreDragPointerEvents();\n     };\n-  }, [handleSplitDragMove, restoreIframePointerEvents, stopSplitDragging]);\n+  }, [handleSplitDragMove, stopSplitDragging]);\n \n   const createEnvironmentMutation = useRQMutation(\n     postApiEnvironmentsMutation()\ndiff --git a/apps/client/src/components/FlexiblePanelLayout.tsx b/apps/client/src/components/FlexiblePanelLayout.tsx\nindex 7fddd05c5..3b0dfcb87 100644\n--- a/apps/client/src/components/FlexiblePanelLayout.tsx\n+++ b/apps/client/src/components/FlexiblePanelLayout.tsx\n@@ -6,6 +6,7 @@ import React, {\n   useState,\n } from \"react\";\n import type { LayoutMode } from \"@/lib/panel-config\";\n+import { disableDragPointerEvents, restoreDragPointerEvents } from \"@/lib/drag-pointer-events\";\n \n const PANEL_GAP = 4;\n const PANEL_GAP_HALF = PANEL_GAP / 2;\n@@ -90,20 +91,7 @@ export function FlexiblePanelLayout({\n       cancelAnimationFrame(rafIdRef.current);\n       rafIdRef.current = null;\n     }\n-    // Restore iframe pointer events\n-    const iframes = Array.from(document.querySelectorAll(\"iframe\"));\n-    for (const el of iframes) {\n-      if (el instanceof HTMLIFrameElement) {\n-        const prev = el.dataset.prevPointerEvents;\n-        if (prev !== undefined) {\n-          if (prev === \"__unset__\") el.style.removeProperty(\"pointer-events\");\n-          else el.style.pointerEvents = prev;\n-          delete el.dataset.prevPointerEvents;\n-        } else {\n-          el.style.removeProperty(\"pointer-events\");\n-        }\n-      }\n-    }\n+    restoreDragPointerEvents();\n     window.removeEventListener(\"mousemove\", onMouseMoveHorizontal);\n     window.removeEventListener(\"mousemove\", onMouseMoveVertical);\n     window.removeEventListener(\"mouseup\", stopResizing);\n@@ -114,15 +102,7 @@ export function FlexiblePanelLayout({\n       e.preventDefault();\n       document.body.style.cursor = \"col-resize\";\n       document.body.classList.add(\"select-none\");\n-      // Disable pointer events on iframes while dragging\n-      const iframes = Array.from(document.querySelectorAll(\"iframe\"));\n-      for (const el of iframes) {\n-        if (el instanceof HTMLIFrameElement) {\n-          const current = el.style.pointerEvents;\n-          el.dataset.prevPointerEvents = current ? current : \"__unset__\";\n-          el.style.pointerEvents = \"none\";\n-        }\n-      }\n+      disableDragPointerEvents();\n       window.addEventListener(\"mousemove\", onMouseMoveHorizontal);\n       window.addEventListener(\"mouseup\", stopResizing);\n     },\n@@ -134,15 +114,7 @@ export function FlexiblePanelLayout({\n       e.preventDefault();\n       document.body.style.cursor = \"row-resize\";\n       document.body.classList.add(\"select-none\");\n-      // Disable pointer events on iframes while dragging\n-      const iframes = Array.from(document.querySelectorAll(\"iframe\"));\n-      for (const el of iframes) {\n-        if (el instanceof HTMLIFrameElement) {\n-          const current = el.style.pointerEvents;\n-          el.dataset.prevPointerEvents = current ? current : \"__unset__\";\n-          el.style.pointerEvents = \"none\";\n-        }\n-      }\n+      disableDragPointerEvents();\n       window.addEventListener(\"mousemove\", onMouseMoveVertical);\n       window.addEventListener(\"mouseup\", stopResizing);\n     },\ndiff --git a/apps/client/src/components/ResizableColumns.tsx b/apps/client/src/components/ResizableColumns.tsx\nindex 4941c1103..2f6b3985b 100644\n--- a/apps/client/src/components/ResizableColumns.tsx\n+++ b/apps/client/src/components/ResizableColumns.tsx\n@@ -6,6 +6,7 @@ import React, {\n   useState,\n   type CSSProperties,\n } from \"react\";\n+import { disableDragPointerEvents, restoreDragPointerEvents } from \"@/lib/drag-pointer-events\";\n \n interface ResizableColumnsProps {\n   left: React.ReactNode;\n@@ -74,20 +75,7 @@ export function ResizableColumns({\n       cancelAnimationFrame(rafIdRef.current);\n       rafIdRef.current = null;\n     }\n-    // Restore iframe pointer events\n-    const iframes = Array.from(document.querySelectorAll(\"iframe\"));\n-    for (const el of iframes) {\n-      if (el instanceof HTMLIFrameElement) {\n-        const prev = el.dataset.prevPointerEvents;\n-        if (prev !== undefined) {\n-          if (prev === \"__unset__\") el.style.removeProperty(\"pointer-events\");\n-          else el.style.pointerEvents = prev;\n-          delete el.dataset.prevPointerEvents;\n-        } else {\n-          el.style.removeProperty(\"pointer-events\");\n-        }\n-      }\n-    }\n+    restoreDragPointerEvents();\n     window.removeEventListener(\"mousemove\", onMouseMove);\n     window.removeEventListener(\"mouseup\", stopResizing);\n   }, [onMouseMove]);\n@@ -102,15 +90,7 @@ export function ResizableColumns({\n         const rect = containerRef.current.getBoundingClientRect();\n         containerLeftRef.current = rect.left;\n       }\n-      // Disable pointer events on iframes while dragging\n-      const iframes = Array.from(document.querySelectorAll(\"iframe\"));\n-      for (const el of iframes) {\n-        if (el instanceof HTMLIFrameElement) {\n-          const current = el.style.pointerEvents;\n-          el.dataset.prevPointerEvents = current ? current : \"__unset__\";\n-          el.style.pointerEvents = \"none\";\n-        }\n-      }\n+      disableDragPointerEvents();\n       window.addEventListener(\"mousemove\", onMouseMove);\n       window.addEventListener(\"mouseup\", stopResizing);\n     },\ndiff --git a/apps/client/src/components/ResizableGrid.tsx b/apps/client/src/components/ResizableGrid.tsx\nindex ae88e2c02..db31a9778 100644\n--- a/apps/client/src/components/ResizableGrid.tsx\n+++ b/apps/client/src/components/ResizableGrid.tsx\n@@ -5,6 +5,7 @@ import React, {\n   useRef,\n   useState,\n } from \"react\";\n+import { disableDragPointerEvents, restoreDragPointerEvents } from \"@/lib/drag-pointer-events\";\n \n interface ResizableGridProps {\n   topLeft: React.ReactNode;\n@@ -96,20 +97,7 @@ export function ResizableGrid({\n       cancelAnimationFrame(rafIdRef.current);\n       rafIdRef.current = null;\n     }\n-    // Restore iframe pointer events\n-    const iframes = Array.from(document.querySelectorAll(\"iframe\"));\n-    for (const el of iframes) {\n-      if (el instanceof HTMLIFrameElement) {\n-        const prev = el.dataset.prevPointerEvents;\n-        if (prev !== undefined) {\n-          if (prev === \"__unset__\") el.style.removeProperty(\"pointer-events\");\n-          else el.style.pointerEvents = prev;\n-          delete el.dataset.prevPointerEvents;\n-        } else {\n-          el.style.removeProperty(\"pointer-events\");\n-        }\n-      }\n-    }\n+    restoreDragPointerEvents();\n     window.removeEventListener(\"mousemove\", onMouseMoveHorizontal);\n     window.removeEventListener(\"mousemove\", onMouseMoveVertical);\n     window.removeEventListener(\"mouseup\", stopResizing);\n@@ -120,15 +108,7 @@ export function ResizableGrid({\n       e.preventDefault();\n       document.body.style.cursor = \"col-resize\";\n       document.body.classList.add(\"select-none\");\n-      // Disable pointer events on iframes while dragging\n-      const iframes = Array.from(document.querySelectorAll(\"iframe\"));\n-      for (const el of iframes) {\n-        if (el instanceof HTMLIFrameElement) {\n-          const current = el.style.pointerEvents;\n-          el.dataset.prevPointerEvents = current ? current : \"__unset__\";\n-          el.style.pointerEvents = \"none\";\n-        }\n-      }\n+      disableDragPointerEvents();\n       window.addEventListener(\"mousemove\", onMouseMoveHorizontal);\n       window.addEventListener(\"mouseup\", stopResizing);\n     },\n@@ -140,15 +120,7 @@ export function ResizableGrid({\n       e.preventDefault();\n       document.body.style.cursor = \"row-resize\";\n       document.body.classList.add(\"select-none\");\n-      // Disable pointer events on iframes while dragging\n-      const iframes = Array.from(document.querySelectorAll(\"iframe\"));\n-      for (const el of iframes) {\n-        if (el instanceof HTMLIFrameElement) {\n-          const current = el.style.pointerEvents;\n-          el.dataset.prevPointerEvents = current ? current : \"__unset__\";\n-          el.style.pointerEvents = \"none\";\n-        }\n-      }\n+      disableDragPointerEvents();\n       window.addEventListener(\"mousemove\", onMouseMoveVertical);\n       window.addEventListener(\"mouseup\", stopResizing);\n     },\ndiff --git a/apps/client/src/components/Sidebar.tsx b/apps/client/src/components/Sidebar.tsx\nindex 238a76b7d..06ce31412 100644\n--- a/apps/client/src/components/Sidebar.tsx\n+++ b/apps/client/src/components/Sidebar.tsx\n@@ -1,6 +1,7 @@\n import { TaskTree } from \"@/components/TaskTree\";\n import { TaskTreeSkeleton } from \"@/components/TaskTreeSkeleton\";\n import { useExpandTasks } from \"@/contexts/expand-tasks/ExpandTasksContext\";\n+import { disableDragPointerEvents, restoreDragPointerEvents } from \"@/lib/drag-pointer-events\";\n import { isElectron } from \"@/lib/electron\";\n import { type Doc } from \"@cmux/convex/dataModel\";\n import { api } from \"@cmux/convex/api\";\n@@ -161,24 +162,7 @@ export function Sidebar({ tasks, teamSlugOrId }: SidebarProps) {\n       cancelAnimationFrame(rafIdRef.current);\n       rafIdRef.current = null;\n     }\n-    // Restore iframe pointer events\n-    const iframes = Array.from(document.querySelectorAll(\"iframe\"));\n-    for (const el of iframes) {\n-      if (el instanceof HTMLIFrameElement) {\n-        const prev = el.dataset.prevPointerEvents;\n-        if (prev !== undefined) {\n-          if (prev === \"__unset__\") {\n-            el.style.removeProperty(\"pointer-events\");\n-          } else {\n-            el.style.pointerEvents = prev;\n-          }\n-          delete el.dataset.prevPointerEvents;\n-        } else {\n-          // Fallback to clearing\n-          el.style.removeProperty(\"pointer-events\");\n-        }\n-      }\n-    }\n+    restoreDragPointerEvents();\n     window.removeEventListener(\"mousemove\", onMouseMove);\n     window.removeEventListener(\"mouseup\", stopResizing);\n   }, [onMouseMove]);\n@@ -195,15 +179,7 @@ export function Sidebar({ tasks, teamSlugOrId }: SidebarProps) {\n         const rect = containerRef.current.getBoundingClientRect();\n         containerLeftRef.current = rect.left;\n       }\n-      // Disable pointer events on all iframes so dragging works over them\n-      const iframes = Array.from(document.querySelectorAll(\"iframe\"));\n-      for (const el of iframes) {\n-        if (el instanceof HTMLIFrameElement) {\n-          const current = el.style.pointerEvents;\n-          el.dataset.prevPointerEvents = current ? current : \"__unset__\";\n-          el.style.pointerEvents = \"none\";\n-        }\n-      }\n+      disableDragPointerEvents();\n       window.addEventListener(\"mousemove\", onMouseMove);\n       window.addEventListener(\"mouseup\", stopResizing);\n     },\ndiff --git a/apps/client/src/components/electron-web-contents-view.tsx b/apps/client/src/components/electron-web-contents-view.tsx\nindex 569067139..43bc8a213 100644\n--- a/apps/client/src/components/electron-web-contents-view.tsx\n+++ b/apps/client/src/components/electron-web-contents-view.tsx\n@@ -804,6 +804,7 @@ export function ElectronWebContentsView({\n       style={{ ...style, borderRadius }}\n       data-role=\"electron-web-contents-view\"\n       data-suspended={suspended ? \"true\" : \"false\"}\n+      data-drag-disable-pointer\n     >\n       {shouldShowFallback ? (\n         <div className=\"flex h-full w-full items-center justify-center rounded-md border border-dashed border-neutral-300 bg-white/80 text-sm text-neutral-600 dark:border-neutral-700 dark:bg-neutral-900/80 dark:text-neutral-300\">\ndiff --git a/apps/client/src/components/lexical/LexicalEditor.tsx b/apps/client/src/components/lexical/LexicalEditor.tsx\nindex 60f052015..8f4dc958f 100644\n--- a/apps/client/src/components/lexical/LexicalEditor.tsx\n+++ b/apps/client/src/components/lexical/LexicalEditor.tsx\n@@ -1,7 +1,5 @@\n-import Prism from \"prismjs\";\n-if (typeof globalThis.Prism === \"undefined\") {\n-  globalThis.Prism = Prism;\n-}\n+// IMPORTANT: Import prism-setup BEFORE @lexical/code to ensure Prism is globally available\n+import \"./prism-setup\";\n \n import { editorStorage } from \"@/lib/editorStorage\";\n import { CodeNode } from \"@lexical/code\";\ndiff --git a/apps/client/src/components/lexical/prism-setup.ts b/apps/client/src/components/lexical/prism-setup.ts\nnew file mode 100644\nindex 000000000..c40c5b54d\n--- /dev/null\n+++ b/apps/client/src/components/lexical/prism-setup.ts\n@@ -0,0 +1,13 @@\n+// This file must be imported BEFORE any @lexical/code imports\n+// to ensure Prism is available globally for syntax highlighting\n+import Prism from \"prismjs\";\n+\n+// @lexical/code expects Prism to be available globally\n+if (typeof globalThis !== \"undefined\") {\n+  (globalThis as typeof globalThis & { Prism?: typeof Prism }).Prism = Prism;\n+}\n+if (typeof window !== \"undefined\") {\n+  (window as typeof window & { Prism?: typeof Prism }).Prism = Prism;\n+}\n+\n+export { Prism };\ndiff --git a/apps/client/src/lib/drag-pointer-events.ts b/apps/client/src/lib/drag-pointer-events.ts\nnew file mode 100644\nindex 000000000..14c055b5d\n--- /dev/null\n+++ b/apps/client/src/lib/drag-pointer-events.ts\n@@ -0,0 +1,42 @@\n+/**\n+ * Utility for disabling pointer events on marked elements during drag operations.\n+ * Elements should be marked with `data-drag-disable-pointer` attribute.\n+ * Also targets canvas/iframe children since pointer-events doesn't propagate to children.\n+ */\n+\n+const SELECTOR = \"[data-drag-disable-pointer], [data-drag-disable-pointer] canvas, [data-drag-disable-pointer] iframe\";\n+\n+/**\n+ * Disable pointer events on all marked elements.\n+ * Call this when starting a drag operation.\n+ */\n+export function disableDragPointerEvents(): void {\n+  const elements = Array.from(document.querySelectorAll(SELECTOR));\n+  for (const el of elements) {\n+    if (el instanceof HTMLElement) {\n+      const current = el.style.pointerEvents;\n+      el.dataset.prevPointerEvents = current ? current : \"__unset__\";\n+      el.style.pointerEvents = \"none\";\n+    }\n+  }\n+}\n+\n+/**\n+ * Restore pointer events on all marked elements.\n+ * Call this when ending a drag operation.\n+ */\n+export function restoreDragPointerEvents(): void {\n+  const elements = Array.from(document.querySelectorAll(SELECTOR));\n+  for (const el of elements) {\n+    if (el instanceof HTMLElement) {\n+      const prev = el.dataset.prevPointerEvents;\n+      if (prev !== undefined) {\n+        if (prev === \"__unset__\") el.style.removeProperty(\"pointer-events\");\n+        else el.style.pointerEvents = prev;\n+        delete el.dataset.prevPointerEvents;\n+      } else {\n+        el.style.removeProperty(\"pointer-events\");\n+      }\n+    }\n+  }\n+}\ndiff --git a/apps/client/src/lib/persistentIframeManager.ts b/apps/client/src/lib/persistentIframeManager.ts\nindex 2d9d7276d..4bf7400fa 100644\n--- a/apps/client/src/lib/persistentIframeManager.ts\n+++ b/apps/client/src/lib/persistentIframeManager.ts\n@@ -175,6 +175,7 @@ class PersistentIframeManager {\n       isolation: isolate;\n     `;\n     wrapper.setAttribute(\"data-iframe-key\", key);\n+    wrapper.setAttribute(\"data-drag-disable-pointer\", \"\");\n \n     // Create iframe\n     const iframe = document.createElement(\"iframe\");\ndiff --git a/apps/client/src/lib/toProxyWorkspaceUrl.ts b/apps/client/src/lib/toProxyWorkspaceUrl.ts\nindex 943250810..7ab69d548 100644\n--- a/apps/client/src/lib/toProxyWorkspaceUrl.ts\n+++ b/apps/client/src/lib/toProxyWorkspaceUrl.ts\n@@ -142,6 +142,26 @@ export function toMorphVncUrl(sourceUrl: string): string | null {\n   return vncUrl.toString();\n }\n \n+/**\n+ * Convert a workspace URL to a VNC websocket URL for direct noVNC/RFB connection.\n+ * This returns a wss:// URL pointing to the /websockify endpoint.\n+ */\n+export function toMorphVncWebsocketUrl(sourceUrl: string): string | null {\n+  const components = parseMorphUrl(sourceUrl);\n+\n+  if (!components) {\n+    return null;\n+  }\n+\n+  const wsUrl = createMorphPortUrl(components, 39380);\n+  wsUrl.protocol = \"wss:\";\n+  wsUrl.pathname = \"/websockify\";\n+  wsUrl.search = \"\";\n+  wsUrl.hash = \"\";\n+\n+  return wsUrl.toString();\n+}\n+\n export function toMorphXtermBaseUrl(sourceUrl: string): string | null {\n   const components = parseMorphUrl(sourceUrl);\n \ndiff --git a/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.browser.tsx b/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.browser.tsx\nindex c817f3813..a819dda5b 100644\n--- a/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.browser.tsx\n+++ b/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.browser.tsx\n@@ -1,17 +1,11 @@\n-import { PersistentWebView } from \"@/components/persistent-webview\";\n-import type { PersistentIframeStatus } from \"@/components/persistent-iframe\";\n+import { VncViewer, type VncConnectionStatus } from \"@cmux/shared/components/vnc-viewer\";\n import { WorkspaceLoadingIndicator } from \"@/components/workspace-loading-indicator\";\n-import { getTaskRunBrowserPersistKey } from \"@/lib/persistent-webview-keys\";\n-import {\n-  TASK_RUN_IFRAME_ALLOW,\n-  TASK_RUN_IFRAME_SANDBOX,\n-} from \"@/lib/preloadTaskRunIframes\";\n-import { toMorphVncUrl } from \"@/lib/toProxyWorkspaceUrl\";\n+import { toMorphVncWebsocketUrl } from \"@/lib/toProxyWorkspaceUrl\";\n import { api } from \"@cmux/convex/api\";\n import { typedZid } from \"@cmux/shared/utils/typed-zid\";\n import { createFileRoute } from \"@tanstack/react-router\";\n import clsx from \"clsx\";\n-import { useCallback, useEffect, useMemo, useState } from \"react\";\n+import { useCallback, useMemo, useState } from \"react\";\n import z from \"zod\";\n import { convexQueryClient } from \"@/contexts/convex/convex-query-client\";\n import { useQuery } from \"convex/react\";\n@@ -49,24 +43,18 @@ function BrowserComponent() {\n \n   const vscodeInfo = taskRun?.vscode ?? null;\n   const rawMorphUrl = vscodeInfo?.url ?? vscodeInfo?.workspaceUrl ?? null;\n-  const vncUrl = useMemo(() => {\n+  const vncWebsocketUrl = useMemo(() => {\n     if (!rawMorphUrl) {\n       return null;\n     }\n-    return toMorphVncUrl(rawMorphUrl);\n+    return toMorphVncWebsocketUrl(rawMorphUrl);\n   }, [rawMorphUrl]);\n \n-  const persistKey = getTaskRunBrowserPersistKey(taskRunId);\n-  const hasBrowserView = Boolean(vncUrl);\n+  const hasBrowserView = Boolean(vncWebsocketUrl);\n   const isMorphProvider = vscodeInfo?.provider === \"morph\";\n   const showLoader = isMorphProvider && !hasBrowserView;\n \n-  const [iframeStatus, setIframeStatus] =\n-    useState<PersistentIframeStatus>(\"loading\");\n-\n-  useEffect(() => {\n-    setIframeStatus(\"loading\");\n-  }, [vncUrl]);\n+  const [vncStatus, setVncStatus] = useState<VncConnectionStatus>(\"disconnected\");\n \n   const overlayMessage = useMemo(() => {\n     if (!isMorphProvider) {\n@@ -78,15 +66,14 @@ function BrowserComponent() {\n     return \"Launching browser preview...\";\n   }, [hasBrowserView, isMorphProvider]);\n \n-  const onLoad = useCallback(() => {\n-    console.log(`Browser view loaded for task run ${taskRunId}`);\n+  const onConnect = useCallback(() => {\n+    console.log(`Browser VNC connected for task run ${taskRunId}`);\n   }, [taskRunId]);\n \n-  const onError = useCallback(\n-    (error: Error) => {\n-      console.error(\n-        `Failed to load browser view for task run ${taskRunId}:`,\n-        error\n+  const onDisconnect = useCallback(\n+    (_rfb: unknown, detail: { clean: boolean }) => {\n+      console.log(\n+        `Browser VNC disconnected for task run ${taskRunId} (clean: ${detail.clean})`\n       );\n     },\n     [taskRunId]\n@@ -101,7 +88,7 @@ function BrowserComponent() {\n     []\n   );\n \n-  const isBrowserBusy = !hasBrowserView || iframeStatus !== \"loaded\";\n+  const isBrowserBusy = !hasBrowserView || vncStatus !== \"connected\";\n \n   return (\n     <div className=\"flex flex-col grow bg-neutral-50 dark:bg-black\">\n@@ -110,23 +97,22 @@ function BrowserComponent() {\n           className=\"flex flex-row grow min-h-0 relative\"\n           aria-busy={isBrowserBusy}\n         >\n-          {vncUrl ? (\n-            <PersistentWebView\n-              persistKey={persistKey}\n-              src={vncUrl}\n-              className=\"grow flex relative\"\n-              iframeClassName=\"select-none\"\n-              sandbox={TASK_RUN_IFRAME_SANDBOX}\n-              allow={TASK_RUN_IFRAME_ALLOW}\n-              retainOnUnmount\n-              onLoad={onLoad}\n-              onError={onError}\n-              fallback={loadingFallback}\n-              fallbackClassName=\"bg-neutral-50 dark:bg-black\"\n+          {vncWebsocketUrl ? (\n+            <VncViewer\n+              url={vncWebsocketUrl}\n+              className=\"grow\"\n+              background=\"#000000\"\n+              scaleViewport\n+              autoConnect\n+              autoReconnect\n+              reconnectDelay={1000}\n+              maxReconnectDelay={30000}\n+              focusOnClick\n+              onConnect={onConnect}\n+              onDisconnect={onDisconnect}\n+              onStatusChange={setVncStatus}\n+              loadingFallback={loadingFallback}\n               errorFallback={errorFallback}\n-              errorFallbackClassName=\"bg-neutral-50/95 dark:bg-black/95\"\n-              onStatusChange={setIframeStatus}\n-              loadTimeoutMs={60_000}\n             />\n           ) : (\n             <div className=\"grow\" />\ndiff --git a/apps/client/src/types/novnc.d.ts b/apps/client/src/types/novnc.d.ts\nnew file mode 100644\nindex 000000000..30e6f1d9e\n--- /dev/null\n+++ b/apps/client/src/types/novnc.d.ts\n@@ -0,0 +1,97 @@\n+// Type declarations for @novnc/novnc\n+// Based on https://github.com/novnc/noVNC/blob/master/docs/API.md\n+\n+// noVNC 1.7.0-beta exports from core/rfb.js via package.json \"exports\"\n+declare module \"@novnc/novnc\" {\n+  export interface RFBOptions {\n+    /** Object specifying credentials to provide to the server */\n+    credentials?: {\n+      username?: string;\n+      password?: string;\n+      target?: string;\n+    };\n+    /** An Array of strings specifying WebSocket subprotocols */\n+    wsProtocols?: string[];\n+  }\n+\n+  export interface RFBCapabilities {\n+    power?: boolean;\n+  }\n+\n+  export default class RFB {\n+    constructor(\n+      target: HTMLElement,\n+      urlOrChannel: string | WebSocket,\n+      options?: RFBOptions\n+    );\n+\n+    // Properties (settable)\n+    /** Scale the remote framebuffer to fit in the container element */\n+    scaleViewport: boolean;\n+    /** Limit the remote framebuffer to the container element bounds */\n+    clipViewport: boolean;\n+    /** Move the remote framebuffer within the container element by dragging */\n+    dragViewport: boolean;\n+    /** Request the remote session to resize to the container element bounds */\n+    resizeSession: boolean;\n+    /** Disable keyboard and mouse input */\n+    viewOnly: boolean;\n+    /** Request a dot cursor when the server sets invisible cursor */\n+    showDotCursor: boolean;\n+    /** Set the background of the noVNC canvas element */\n+    background: string;\n+    /** JPEG quality level (0-9) */\n+    qualityLevel: number;\n+    /** Compression level (0-9) */\n+    compressionLevel: number;\n+\n+    // Properties (read-only)\n+    /** Object with server capabilities */\n+    readonly capabilities: RFBCapabilities;\n+\n+    // Methods\n+    /** Disconnect from the server */\n+    disconnect(): void;\n+    /** Send credentials to the server */\n+    sendCredentials(credentials: { username?: string; password?: string; target?: string }): void;\n+    /** Send a key event */\n+    sendKey(keysym: number, code: string | null, down?: boolean): void;\n+    /** Send Ctrl+Alt+Del key sequence */\n+    sendCtrlAltDel(): void;\n+    /** Shift keyboard focus to the canvas element */\n+    focus(options?: FocusOptions): void;\n+    /** Move keyboard focus away from the canvas element */\n+    blur(): void;\n+    /** Send the clipboard text to the server */\n+    clipboardPasteFrom(text: string): void;\n+    /** Request graceful shutdown */\n+    machineShutdown(): void;\n+    /** Request reboot */\n+    machineReboot(): void;\n+    /** Request hard reset */\n+    machineReset(): void;\n+\n+    // Event handling\n+    addEventListener<K extends keyof RFBEventMap>(\n+      type: K,\n+      listener: (event: RFBEventMap[K]) => void,\n+      options?: boolean | AddEventListenerOptions\n+    ): void;\n+    removeEventListener<K extends keyof RFBEventMap>(\n+      type: K,\n+      listener: (event: RFBEventMap[K]) => void,\n+      options?: boolean | EventListenerOptions\n+    ): void;\n+  }\n+\n+  export interface RFBEventMap {\n+    connect: CustomEvent<void>;\n+    disconnect: CustomEvent<{ clean: boolean }>;\n+    credentialsrequired: CustomEvent<void>;\n+    securityfailure: CustomEvent<{ status: number; reason: string }>;\n+    clipboard: CustomEvent<{ text: string }>;\n+    bell: CustomEvent<void>;\n+    desktopname: CustomEvent<{ name: string }>;\n+    capabilities: CustomEvent<{ capabilities: RFBCapabilities }>;\n+  }\n+}\ndiff --git a/apps/www/components/preview/preview-configure-client.tsx b/apps/www/components/preview/preview-configure-client.tsx\nindex d432e52c8..9813b30b0 100644\n--- a/apps/www/components/preview/preview-configure-client.tsx\n+++ b/apps/www/components/preview/preview-configure-client.tsx\n@@ -29,6 +29,10 @@ import {\n   type FrameworkPreset,\n } from \"./framework-preset-select\";\n import type { PackageManager } from \"@/lib/github/framework-detection\";\n+import {\n+  VncViewer,\n+  type VncConnectionStatus,\n+} from \"@cmux/shared/components/vnc-viewer\";\n \n const MASKED_ENV_VALUE = \"••••••••••••••••\";\n \n@@ -138,6 +142,47 @@ function deriveVncUrl(\n   return normalizeVncUrl(baseUrl);\n }\n \n+/**\n+ * Convert a VNC iframe URL (https://hostname/vnc.html) to websocket URL (wss://hostname/websockify).\n+ * This handles the case where the server returns a vnc.html URL that needs to be converted\n+ * to a websockify endpoint for direct noVNC/RFB connection.\n+ */\n+function convertVncUrlToWebsocket(vncUrl: string): string | null {\n+  try {\n+    const url = new URL(vncUrl);\n+    // Already a websocket URL\n+    if (url.protocol === \"ws:\" || url.protocol === \"wss:\") {\n+      // Ensure it points to /websockify\n+      if (!url.pathname.includes(\"websockify\")) {\n+        url.pathname = \"/websockify\";\n+      }\n+      return url.toString();\n+    }\n+    // Convert http/https to ws/wss\n+    const wsProtocol = url.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n+    return `${wsProtocol}//${url.host}/websockify`;\n+  } catch {\n+    return null;\n+  }\n+}\n+\n+/**\n+ * Derive the VNC websocket URL for direct noVNC/RFB connection.\n+ * Returns a wss:// URL pointing to the /websockify endpoint.\n+ */\n+function deriveVncWebsocketUrl(\n+  instanceId?: string,\n+  workspaceUrl?: string\n+): string | null {\n+  const morphHostId = resolveMorphHostId(instanceId, workspaceUrl);\n+  if (!morphHostId) {\n+    return null;\n+  }\n+\n+  const hostname = `port-39380-${morphHostId}.http.cloud.morph.so`;\n+  return `wss://${hostname}/websockify`;\n+}\n+\n const ensureInitialEnvVars = (initial?: EnvVar[]): EnvVar[] => {\n   const base = (initial ?? []).map((item) => ({\n     name: item.name,\n@@ -505,9 +550,6 @@ export function PreviewConfigureClient({\n   const vscodePersistKey = instance?.instanceId\n     ? `preview-${instance.instanceId}:vscode`\n     : \"vscode\";\n-  const browserPersistKey = instance?.instanceId\n-    ? `preview-${instance.instanceId}:browser`\n-    : \"browser\";\n \n   const selectedTeam = useMemo(\n     () =>\n@@ -525,12 +567,18 @@ export function PreviewConfigureClient({\n     selectedTeamSlugOrIdRef.current = resolvedTeamSlugOrId;\n   }, [resolvedTeamSlugOrId]);\n \n-  const resolvedVncUrl = useMemo(() => {\n+  // WebSocket URL for direct VNC connection via noVNC/RFB\n+  // Prefer server-provided vncUrl (converted to websocket), fall back to derived\n+  const resolvedVncWebsocketUrl = useMemo(() => {\n     if (instance?.vncUrl) {\n-      return normalizeVncUrl(instance.vncUrl) ?? instance.vncUrl;\n+      // Convert iframe URL (https://host/vnc.html) to websocket URL (wss://host/websockify)\n+      return convertVncUrlToWebsocket(instance.vncUrl);\n     }\n-    return deriveVncUrl(instance?.instanceId, instance?.vscodeUrl);\n-  }, [instance?.instanceId, instance?.vncUrl, instance?.vscodeUrl]);\n+    return deriveVncWebsocketUrl(instance?.instanceId, instance?.vscodeUrl);\n+  }, [instance?.vncUrl, instance?.instanceId, instance?.vscodeUrl]);\n+\n+  // VNC connection status for the browser panel (may be used for UI indicators in the future)\n+  const [_vncStatus, setVncStatus] = useState<VncConnectionStatus>(\"disconnected\");\n \n   const workspacePlaceholder = useMemo(\n     () =>\n@@ -588,7 +636,7 @@ export function PreviewConfigureClient({\n \n   const browserPlaceholder = useMemo(\n     () =>\n-      resolvedVncUrl\n+      resolvedVncWebsocketUrl\n         ? null\n         : {\n             title: instance?.instanceId\n@@ -598,7 +646,7 @@ export function PreviewConfigureClient({\n               ? \"We'll embed the browser session as soon as the environment exposes it.\"\n               : \"Launch the workspace so the browser agent can stream the preview here.\",\n           },\n-    [instance?.instanceId, resolvedVncUrl]\n+    [instance?.instanceId, resolvedVncWebsocketUrl]\n   );\n \n   const provisionVM = useCallback(async () => {\n@@ -934,8 +982,9 @@ export function PreviewConfigureClient({\n     setCurrentConfigStep(step);\n   }, []);\n \n-  // Pre-create iframes during setup so they're ready when user clicks Next\n-  // Using useLayoutEffect so iframes are created before the mount effect runs\n+  // Pre-create VS Code iframe during setup so it's ready when user clicks Next\n+  // Using useLayoutEffect so iframe is created before the mount effect runs\n+  // Note: Browser VNC is now handled by VncViewer component, not iframe\n   useLayoutEffect(() => {\n     if (!instance || !persistentIframeManager) return;\n \n@@ -948,23 +997,14 @@ export function PreviewConfigureClient({\n         vscodeUrl.toString()\n       );\n     }\n-\n-    // Pre-create browser iframe if available\n-    if (resolvedVncUrl) {\n-      persistentIframeManager.getOrCreateIframe(\n-        browserPersistKey,\n-        resolvedVncUrl\n-      );\n-    }\n   }, [\n     instance,\n     persistentIframeManager,\n-    resolvedVncUrl,\n     vscodePersistKey,\n-    browserPersistKey,\n   ]);\n \n-  // Mount iframes to their targets when visible\n+  // Mount VS Code iframe to its target when visible\n+  // Note: Browser VNC is now handled by VncViewer component, not iframe\n   useLayoutEffect(() => {\n     if (!instance || !persistentIframeManager) return;\n     // Only mount when in workspace-config layout\n@@ -985,34 +1025,19 @@ export function PreviewConfigureClient({\n       }\n     }\n \n-    // Show browser for browser-setup step\n-    if (resolvedVncUrl && currentConfigStep === \"browser-setup\") {\n-      const target = document.querySelector(\n-        `[data-iframe-target=\"${browserPersistKey}\"]`\n-      ) as HTMLElement | null;\n-      if (target) {\n-        cleanupFunctions.push(\n-          persistentIframeManager.mountIframe(browserPersistKey, target, {\n-            backgroundColor: \"#000000\",\n-          })\n-        );\n-      }\n-    }\n-\n     return () => {\n       cleanupFunctions.forEach((fn) => fn());\n     };\n   }, [\n-    browserPersistKey,\n     instance,\n     persistentIframeManager,\n     currentConfigStep,\n     layoutPhase,\n-    resolvedVncUrl,\n     vscodePersistKey,\n   ]);\n \n-  // Control iframe visibility based on current step and layout phase\n+  // Control VS Code iframe visibility based on current step and layout phase\n+  // Note: Browser VNC visibility is now handled by VncViewer component\n   useEffect(() => {\n     if (!persistentIframeManager) {\n       return;\n@@ -1023,17 +1048,12 @@ export function PreviewConfigureClient({\n     // Show VSCode for steps before browser-setup\n     const showVscode = currentConfigStep !== \"browser-setup\";\n     const workspaceVisible = inWorkspaceConfig && showVscode && Boolean(instance?.vscodeUrl);\n-    // Show browser for browser-setup step\n-    const browserVisible = inWorkspaceConfig && currentConfigStep === \"browser-setup\" && Boolean(resolvedVncUrl);\n \n     persistentIframeManager.setVisibility(vscodePersistKey, workspaceVisible);\n-    persistentIframeManager.setVisibility(browserPersistKey, browserVisible);\n   }, [\n-    browserPersistKey,\n     currentConfigStep,\n     layoutPhase,\n     persistentIframeManager,\n-    resolvedVncUrl,\n     instance?.vscodeUrl,\n     vscodePersistKey,\n   ]);\n@@ -1063,10 +1083,29 @@ export function PreviewConfigureClient({\n     // Show browser only for browser-setup step, VSCode for others\n     const showBrowser = currentConfigStep === \"browser-setup\";\n     const placeholder = showBrowser ? browserPlaceholder : workspacePlaceholder;\n-    const iframeKey = showBrowser ? browserPersistKey : vscodePersistKey;\n+\n+    // Loading fallback for VNC viewer\n+    const vncLoadingFallback = (\n+      <div className=\"absolute inset-0 flex flex-col items-center justify-center gap-2 px-4 text-center\">\n+        <div className=\"h-8 w-8 animate-spin rounded-full border-2 border-neutral-400 border-t-transparent\" />\n+        <span className=\"text-sm text-neutral-400\">\n+          Connecting to browser preview...\n+        </span>\n+      </div>\n+    );\n+\n+    // Error fallback for VNC viewer\n+    const vncErrorFallback = (\n+      <div className=\"absolute inset-0 flex flex-col items-center justify-center gap-2 px-4 text-center\">\n+        <span className=\"text-sm text-red-400\">\n+          Failed to connect to browser preview\n+        </span>\n+      </div>\n+    );\n \n     return (\n       <div className=\"h-full flex flex-col overflow-hidden relative\">\n+        {/* Placeholder for VS Code or browser when not available */}\n         {placeholder ? (\n           <div className=\"absolute inset-0 flex flex-col items-center justify-center gap-2 px-4 text-center text-neutral-500 dark:text-neutral-400\">\n             <div className=\"text-sm font-medium text-neutral-600 dark:text-neutral-200\">\n@@ -1079,13 +1118,38 @@ export function PreviewConfigureClient({\n             ) : null}\n           </div>\n         ) : null}\n-        <div\n-          className={clsx(\n-            \"absolute inset-0\",\n-            placeholder ? \"opacity-0\" : \"opacity-100\"\n-          )}\n-          data-iframe-target={iframeKey}\n-        />\n+\n+        {/* VS Code iframe (shown for non-browser-setup steps) */}\n+        {!showBrowser && (\n+          <div\n+            className={clsx(\n+              \"absolute inset-0\",\n+              placeholder ? \"opacity-0\" : \"opacity-100\"\n+            )}\n+            data-iframe-target={vscodePersistKey}\n+          />\n+        )}\n+\n+        {/* VNC Viewer for browser preview (shown for browser-setup step) */}\n+        {showBrowser && resolvedVncWebsocketUrl && (\n+          <VncViewer\n+            url={resolvedVncWebsocketUrl}\n+            className={clsx(\n+              \"absolute inset-0\",\n+              browserPlaceholder ? \"opacity-0\" : \"opacity-100\"\n+            )}\n+            background=\"#000000\"\n+            scaleViewport\n+            autoConnect\n+            autoReconnect\n+            reconnectDelay={1000}\n+            maxReconnectDelay={30000}\n+            focusOnClick\n+            onStatusChange={setVncStatus}\n+            loadingFallback={vncLoadingFallback}\n+            errorFallback={vncErrorFallback}\n+          />\n+        )}\n       </div>\n     );\n   };\ndiff --git a/apps/www/types/novnc.d.ts b/apps/www/types/novnc.d.ts\nnew file mode 100644\nindex 000000000..f9eeee006\n--- /dev/null\n+++ b/apps/www/types/novnc.d.ts\n@@ -0,0 +1,101 @@\n+// Type declarations for @novnc/novnc\n+// Based on https://github.com/novnc/noVNC/blob/master/docs/API.md\n+\n+// noVNC 1.7.0-beta exports RFB directly from the package\n+declare module \"@novnc/novnc\" {\n+  export { default, RFBOptions, RFBCapabilities, RFBEventMap } from \"@novnc/novnc/core/rfb\";\n+}\n+\n+declare module \"@novnc/novnc/core/rfb\" {\n+  export interface RFBOptions {\n+    /** Object specifying credentials to provide to the server */\n+    credentials?: {\n+      username?: string;\n+      password?: string;\n+      target?: string;\n+    };\n+    /** An Array of strings specifying WebSocket subprotocols */\n+    wsProtocols?: string[];\n+  }\n+\n+  export interface RFBCapabilities {\n+    power?: boolean;\n+  }\n+\n+  export default class RFB {\n+    constructor(\n+      target: HTMLElement,\n+      urlOrChannel: string | WebSocket,\n+      options?: RFBOptions\n+    );\n+\n+    // Properties (settable)\n+    /** Scale the remote framebuffer to fit in the container element */\n+    scaleViewport: boolean;\n+    /** Limit the remote framebuffer to the container element bounds */\n+    clipViewport: boolean;\n+    /** Move the remote framebuffer within the container element by dragging */\n+    dragViewport: boolean;\n+    /** Request the remote session to resize to the container element bounds */\n+    resizeSession: boolean;\n+    /** Disable keyboard and mouse input */\n+    viewOnly: boolean;\n+    /** Request a dot cursor when the server sets invisible cursor */\n+    showDotCursor: boolean;\n+    /** Set the background of the noVNC canvas element */\n+    background: string;\n+    /** JPEG quality level (0-9) */\n+    qualityLevel: number;\n+    /** Compression level (0-9) */\n+    compressionLevel: number;\n+\n+    // Properties (read-only)\n+    /** Object with server capabilities */\n+    readonly capabilities: RFBCapabilities;\n+\n+    // Methods\n+    /** Disconnect from the server */\n+    disconnect(): void;\n+    /** Send credentials to the server */\n+    sendCredentials(credentials: { username?: string; password?: string; target?: string }): void;\n+    /** Send a key event */\n+    sendKey(keysym: number, code: string | null, down?: boolean): void;\n+    /** Send Ctrl+Alt+Del key sequence */\n+    sendCtrlAltDel(): void;\n+    /** Shift keyboard focus to the canvas element */\n+    focus(options?: FocusOptions): void;\n+    /** Move keyboard focus away from the canvas element */\n+    blur(): void;\n+    /** Send the clipboard text to the server */\n+    clipboardPasteFrom(text: string): void;\n+    /** Request graceful shutdown */\n+    machineShutdown(): void;\n+    /** Request reboot */\n+    machineReboot(): void;\n+    /** Request hard reset */\n+    machineReset(): void;\n+\n+    // Event handling\n+    addEventListener<K extends keyof RFBEventMap>(\n+      type: K,\n+      listener: (event: RFBEventMap[K]) => void,\n+      options?: boolean | AddEventListenerOptions\n+    ): void;\n+    removeEventListener<K extends keyof RFBEventMap>(\n+      type: K,\n+      listener: (event: RFBEventMap[K]) => void,\n+      options?: boolean | EventListenerOptions\n+    ): void;\n+  }\n+\n+  export interface RFBEventMap {\n+    connect: CustomEvent<void>;\n+    disconnect: CustomEvent<{ clean: boolean }>;\n+    credentialsrequired: CustomEvent<void>;\n+    securityfailure: CustomEvent<{ status: number; reason: string }>;\n+    clipboard: CustomEvent<{ text: string }>;\n+    bell: CustomEvent<void>;\n+    desktopname: CustomEvent<{ name: string }>;\n+    capabilities: CustomEvent<{ capabilities: RFBCapabilities }>;\n+  }\n+}\ndiff --git a/bun.lock b/bun.lock\nindex 27489d149..5c428b7e9 100644\n--- a/bun.lock\n+++ b/bun.lock\n@@ -5,6 +5,7 @@\n     \"\": {\n       \"name\": \"cmux\",\n       \"dependencies\": {\n+        \"@novnc/novnc\": \"1.7.0-beta\",\n         \"@sentry/browser\": \"10.27.0\",\n         \"@sentry/core\": \"10.27.0\",\n         \"@sentry/electron\": \"7.3.0\",\n@@ -77,6 +78,7 @@\n         \"@lezer/highlight\": \"^1.2.1\",\n         \"@mantine/hooks\": \"^8.1.3\",\n         \"@monaco-editor/react\": \"^4.7.0\",\n+        \"@novnc/novnc\": \"1.7.0-beta\",\n         \"@posthog/react\": \"^1.4.0\",\n         \"@radix-ui/react-dialog\": \"^1.1.6\",\n         \"@radix-ui/react-dropdown-menu\": \"^2.1.15\",\n@@ -459,6 +461,16 @@\n         \"typescript\": \"^5.9.3\",\n         \"vitest\": \"^3.2.4\",\n       },\n+      \"peerDependencies\": {\n+        \"@novnc/novnc\": \"^1.7.0-beta\",\n+        \"clsx\": \"^2.0.0\",\n+        \"react\": \"^18.0.0 || ^19.0.0\",\n+      },\n+      \"optionalPeers\": [\n+        \"@novnc/novnc\",\n+        \"clsx\",\n+        \"react\",\n+      ],\n     },\n     \"packages/vscode-extension\": {\n       \"name\": \"cmux-vscode-extension\",\n@@ -1440,6 +1452,8 @@\n \n     \"@nolyfill/is-core-module\": [\"@nolyfill/is-core-module@1.0.39\", \"\", {}, \"sha512-nn5ozdjYQpUCZlWGuxcJY/KpxkWQs4DcbMCmKojjyrYDEAGy4Ce19NN4v5MduafTwJlbKc99UA8YhSVqq9yPZA==\"],\n \n+    \"@novnc/novnc\": [\"@novnc/novnc@1.7.0-beta\", \"\", {}, \"sha512-h1NihPIO1bo023eL5b8OCSJarVOngWmCYQIN0jZfjgvP/s9ZKQZVsrH8pwVqB8zCkqmqzSSEOTN0mHtLp7u7gg==\"],\n+\n     \"@npmcli/fs\": [\"@npmcli/fs@2.1.2\", \"\", { \"dependencies\": { \"@gar/promisify\": \"^1.1.3\", \"semver\": \"^7.3.5\" } }, \"sha512-yOJKRvohFOaLqipNtwYB9WugyZKhC/DZC4VYPmpaCzDBrA8YpK3qHZ8/HGscMnE4GqbkLNuVcCnxkeQEdGt6LQ==\"],\n \n     \"@npmcli/move-file\": [\"@npmcli/move-file@2.0.1\", \"\", { \"dependencies\": { \"mkdirp\": \"^1.0.4\", \"rimraf\": \"^3.0.2\" } }, \"sha512-mJd2Z5TjYWq/ttPLLGqArdtnC74J6bOzg4rMDnN+p1xTacZ2yPRCk2y0oSWQtygLR9YVQXgOcONrwtnk3JupxQ==\"],\n@@ -5086,6 +5100,8 @@\n \n     \"@cloudflare/kv-asset-handler/mime\": [\"mime@3.0.0\", \"\", { \"bin\": { \"mime\": \"cli.js\" } }, \"sha512-jSCU7/VB1loIWBZe14aEYHU/+1UMEHoaO7qxCOVJOw9GgH72VAWppxNcjU+x9a2k3GSIBXNKxXQFqRvvZ7vr3A==\"],\n \n+    \"@cmux/client/typescript-eslint\": [\"typescript-eslint@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/eslint-plugin\": \"8.48.0\", \"@typescript-eslint/parser\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-fcKOvQD9GUn3Xw63EgiDqhvWJ5jsyZUaekl3KVpGsDJnN46WJTe3jWxtQP9lMZm1LJNkFLlTaWAxK2vUQR+cqw==\"],\n+\n     \"@cmux/morphcloud-openapi-client/typescript-eslint\": [\"typescript-eslint@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/eslint-plugin\": \"8.48.0\", \"@typescript-eslint/parser\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-fcKOvQD9GUn3Xw63EgiDqhvWJ5jsyZUaekl3KVpGsDJnN46WJTe3jWxtQP9lMZm1LJNkFLlTaWAxK2vUQR+cqw==\"],\n \n     \"@cmux/scripts/morphcloud\": [\"morphcloud@0.0.18\", \"\", { \"dependencies\": { \"ignore\": \"^7.0.0\", \"node-ssh\": \"^13.2.0\", \"undici\": \"^7.12.0\", \"uuid\": \"^11.1.0\" } }, \"sha512-k3kxdvmwUQbRM5RBJp/UMXQKOqZBBy+BVo/jgNLuNp8yLBq5CJqGAK3O0oZewwKUK2/UL4LyHkwJxBNf7gy0kg==\"],\n@@ -5994,6 +6010,14 @@\n \n     \"@babel/helper-compilation-targets/lru-cache/yallist\": [\"yallist@3.1.1\", \"\", {}, \"sha512-a4UGQaWPH59mOXUYnAG2ewncQS4i4F43Tv3JoAM+s2VDAmS9NsK8GpDMLrCHPksFT7h3K6TOoUNn2pb7RoXx4g==\"],\n \n+    \"@cmux/client/typescript-eslint/@typescript-eslint/eslint-plugin\": [\"@typescript-eslint/eslint-plugin@8.48.0\", \"\", { \"dependencies\": { \"@eslint-community/regexpp\": \"^4.10.0\", \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/type-utils\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\", \"graphemer\": \"^1.4.0\", \"ignore\": \"^7.0.0\", \"natural-compare\": \"^1.4.0\", \"ts-api-utils\": \"^2.1.0\" }, \"peerDependencies\": { \"@typescript-eslint/parser\": \"^8.48.0\", \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-XxXP5tL1txl13YFtrECECQYeZjBZad4fyd3cFV4a19LkAY/bIp9fev3US4S5fDVV2JaYFiKAZ/GRTOLer+mbyQ==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/parser\": [\"@typescript-eslint/parser@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\", \"debug\": \"^4.3.4\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-jCzKdm/QK0Kg4V4IK/oMlRZlY+QOcdjv89U2NgKHZk1CYTj82/RVSx1mV/0gqCVMJ/DA+Zf/S4NBWNF8GQ+eqQ==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/typescript-estree\": [\"@typescript-eslint/typescript-estree@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/project-service\": \"8.48.0\", \"@typescript-eslint/tsconfig-utils\": \"8.48.0\", \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\", \"debug\": \"^4.3.4\", \"minimatch\": \"^9.0.4\", \"semver\": \"^7.6.0\", \"tinyglobby\": \"^0.2.15\", \"ts-api-utils\": \"^2.1.0\" }, \"peerDependencies\": { \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-ljHab1CSO4rGrQIAyizUS6UGHHCiAYhbfcIZ1zVJr5nMryxlXMVWS3duFPSKvSUbFPwkXMFk1k0EMIjub4sRRQ==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/utils\": [\"@typescript-eslint/utils@8.48.0\", \"\", { \"dependencies\": { \"@eslint-community/eslint-utils\": \"^4.7.0\", \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-yTJO1XuGxCsSfIVt1+1UrLHtue8xz16V8apzPYI06W0HbEbEWHxHXgZaAgavIkoh+GeV6hKKd5jm0sS6OYxWXQ==\"],\n+\n     \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin\": [\"@typescript-eslint/eslint-plugin@8.48.0\", \"\", { \"dependencies\": { \"@eslint-community/regexpp\": \"^4.10.0\", \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/type-utils\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\", \"graphemer\": \"^1.4.0\", \"ignore\": \"^7.0.0\", \"natural-compare\": \"^1.4.0\", \"ts-api-utils\": \"^2.1.0\" }, \"peerDependencies\": { \"@typescript-eslint/parser\": \"^8.48.0\", \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-XxXP5tL1txl13YFtrECECQYeZjBZad4fyd3cFV4a19LkAY/bIp9fev3US4S5fDVV2JaYFiKAZ/GRTOLer+mbyQ==\"],\n \n     \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/parser\": [\"@typescript-eslint/parser@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\", \"debug\": \"^4.3.4\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-jCzKdm/QK0Kg4V4IK/oMlRZlY+QOcdjv89U2NgKHZk1CYTj82/RVSx1mV/0gqCVMJ/DA+Zf/S4NBWNF8GQ+eqQ==\"],\n@@ -6688,6 +6712,34 @@\n \n     \"@aws-crypto/util/@smithy/util-utf8/@smithy/util-buffer-from/@smithy/is-array-buffer\": [\"@smithy/is-array-buffer@2.2.0\", \"\", { \"dependencies\": { \"tslib\": \"^2.6.2\" } }, \"sha512-GGP3O9QFD24uGeAXYUjwSTXARoqpZykHadOmA8G5vfJPK0/DC67qa//0qvqrJzL1xc8WQWX7/yc7fwudjPHPhA==\"],\n \n+    \"@cmux/client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/scope-manager\": [\"@typescript-eslint/scope-manager@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\" } }, \"sha512-uGSSsbrtJrLduti0Q1Q9+BF1/iFKaxGoQwjWOIVNJv0o6omrdyR8ct37m4xIl5Zzpkp69Kkmvom7QFTtue89YQ==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/type-utils\": [\"@typescript-eslint/type-utils@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\", \"debug\": \"^4.3.4\", \"ts-api-utils\": \"^2.1.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-zbeVaVqeXhhab6QNEKfK96Xyc7UQuoFWERhEnj3mLVnUWrQnv15cJNseUni7f3g557gm0e46LZ6IJ4NJVOgOpw==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/eslint-plugin/ignore\": [\"ignore@7.0.5\", \"\", {}, \"sha512-Hs59xBNfUIunMFgWAbGX5cq6893IbWg4KnrjbYwX3tx0ztorVgTDA6B2sxf8ejHJ4wz8BqGUMYlnzNBer5NvGg==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/parser/@typescript-eslint/scope-manager\": [\"@typescript-eslint/scope-manager@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\" } }, \"sha512-uGSSsbrtJrLduti0Q1Q9+BF1/iFKaxGoQwjWOIVNJv0o6omrdyR8ct37m4xIl5Zzpkp69Kkmvom7QFTtue89YQ==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/parser/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/parser/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/project-service\": [\"@typescript-eslint/project-service@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/tsconfig-utils\": \"^8.48.0\", \"@typescript-eslint/types\": \"^8.48.0\", \"debug\": \"^4.3.4\" }, \"peerDependencies\": { \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-Ne4CTZyRh1BecBf84siv42wv5vQvVmgtk8AuiEffKTUo3DrBaGYZueJSxxBZ8fjk/N3DrgChH4TOdIOwOwiqqw==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/tsconfig-utils\": [\"@typescript-eslint/tsconfig-utils@8.48.0\", \"\", { \"peerDependencies\": { \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-WNebjBdFdyu10sR1M4OXTt2OkMd5KWIL+LLfeH9KhgP+jzfDV/LI3eXzwJ1s9+Yc0Kzo2fQCdY/OpdusCMmh6w==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/typescript-estree/minimatch\": [\"minimatch@9.0.5\", \"\", { \"dependencies\": { \"brace-expansion\": \"^2.0.1\" } }, \"sha512-G6T0ZX48xgozx7587koeX9Ys2NYy6Gmv//P89sEte9V9whIapMNF4idKxnW2QtCcLiTWlb/wfCabAtAFWhhBow==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/utils/@typescript-eslint/scope-manager\": [\"@typescript-eslint/scope-manager@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\" } }, \"sha512-uGSSsbrtJrLduti0Q1Q9+BF1/iFKaxGoQwjWOIVNJv0o6omrdyR8ct37m4xIl5Zzpkp69Kkmvom7QFTtue89YQ==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/utils/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n     \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/scope-manager\": [\"@typescript-eslint/scope-manager@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\" } }, \"sha512-uGSSsbrtJrLduti0Q1Q9+BF1/iFKaxGoQwjWOIVNJv0o6omrdyR8ct37m4xIl5Zzpkp69Kkmvom7QFTtue89YQ==\"],\n \n     \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/type-utils\": [\"@typescript-eslint/type-utils@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\", \"debug\": \"^4.3.4\", \"ts-api-utils\": \"^2.1.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-zbeVaVqeXhhab6QNEKfK96Xyc7UQuoFWERhEnj3mLVnUWrQnv15cJNseUni7f3g557gm0e46LZ6IJ4NJVOgOpw==\"],\n@@ -6978,6 +7030,16 @@\n \n     \"wrap-ansi/ansi-styles/color-convert/color-name\": [\"color-name@1.1.4\", \"\", {}, \"sha512-dOy+3AuW3a2wNbZHIuMZpTcgjGuLU/uBL/ubcZF9OXbDo8ff4O8yVp5Bf0efS8uEoYo5q4Fx7dY9OgQGXgAsQA==\"],\n \n+    \"@cmux/client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/scope-manager/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/type-utils/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/visitor-keys/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/typescript-estree/minimatch/brace-expansion\": [\"brace-expansion@2.0.2\", \"\", { \"dependencies\": { \"balanced-match\": \"^1.0.0\" } }, \"sha512-Jt0vHyM+jmUBqojB7E1NIYadt0vI0Qxjxd2TErW94wDz+E2LAm5vKMXXwg6ZZBTHPuUlDgQHKXvjGBdfcF1ZDQ==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/utils/@typescript-eslint/scope-manager/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n+\n     \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/scope-manager/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n \n     \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/type-utils/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\ndiff --git a/package.json b/package.json\nindex 03d735a98..212d9a1c5 100644\n--- a/package.json\n+++ b/package.json\n@@ -64,6 +64,7 @@\n     \"scripts\"\n   ],\n   \"dependencies\": {\n+    \"@novnc/novnc\": \"1.7.0-beta\",\n     \"@sentry/browser\": \"10.27.0\",\n     \"@sentry/core\": \"10.27.0\",\n     \"@sentry/electron\": \"7.3.0\",\ndiff --git a/packages/shared/package.json b/packages/shared/package.json\nindex 6db526c33..5a992f96b 100644\n--- a/packages/shared/package.json\n+++ b/packages/shared/package.json\n@@ -101,6 +101,26 @@\n     \"./screenshots/sanitize-markdown\": {\n       \"import\": \"./src/screenshots/sanitize-markdown.ts\",\n       \"types\": \"./src/screenshots/sanitize-markdown.ts\"\n+    },\n+    \"./components/vnc-viewer\": {\n+      \"import\": \"./src/components/vnc-viewer.tsx\",\n+      \"types\": \"./src/components/vnc-viewer.tsx\"\n+    }\n+  },\n+  \"peerDependencies\": {\n+    \"react\": \"^18.0.0 || ^19.0.0\",\n+    \"@novnc/novnc\": \"^1.7.0-beta\",\n+    \"clsx\": \"^2.0.0\"\n+  },\n+  \"peerDependenciesMeta\": {\n+    \"react\": {\n+      \"optional\": true\n+    },\n+    \"@novnc/novnc\": {\n+      \"optional\": true\n+    },\n+    \"clsx\": {\n+      \"optional\": true\n     }\n   },\n   \"dependencies\": {\ndiff --git a/packages/shared/src/components/vnc-viewer.tsx b/packages/shared/src/components/vnc-viewer.tsx\nnew file mode 100644\nindex 000000000..974d2af8b\n--- /dev/null\n+++ b/packages/shared/src/components/vnc-viewer.tsx\n@@ -0,0 +1,1049 @@\n+import {\n+  useCallback,\n+  useEffect,\n+  useImperativeHandle,\n+  useMemo,\n+  useRef,\n+  useState,\n+  forwardRef,\n+  type CSSProperties,\n+  type ReactNode,\n+} from \"react\";\n+import clsx from \"clsx\";\n+import { useNetwork } from \"../hooks/use-network\";\n+\n+// RFB type definition (copied from @novnc/novnc types to avoid static imports)\n+// The actual module is dynamically imported to avoid top-level await issues\n+interface RFBOptions {\n+  credentials?: {\n+    username?: string;\n+    password?: string;\n+    target?: string;\n+  };\n+  wsProtocols?: string[];\n+}\n+\n+interface RFBInstance {\n+  scaleViewport: boolean;\n+  clipViewport: boolean;\n+  dragViewport: boolean;\n+  resizeSession: boolean;\n+  viewOnly: boolean;\n+  showDotCursor: boolean;\n+  background: string;\n+  qualityLevel: number;\n+  compressionLevel: number;\n+  readonly capabilities: { power?: boolean };\n+  disconnect(): void;\n+  sendCredentials(credentials: { username?: string; password?: string; target?: string }): void;\n+  sendKey(keysym: number, code: string | null, down?: boolean): void;\n+  sendCtrlAltDel(): void;\n+  focus(options?: FocusOptions): void;\n+  blur(): void;\n+  clipboardPasteFrom(text: string): void;\n+  machineShutdown(): void;\n+  machineReboot(): void;\n+  machineReset(): void;\n+  addEventListener(type: string, listener: (event: CustomEvent) => void): void;\n+  removeEventListener(type: string, listener: (event: CustomEvent) => void): void;\n+}\n+\n+interface RFBConstructor {\n+  new (target: HTMLElement, urlOrChannel: string | WebSocket, options?: RFBOptions): RFBInstance;\n+}\n+\n+// Dynamically import RFB to avoid top-level await issues with noVNC\n+let RFBClass: RFBConstructor | null = null;\n+const loadRFB = async (): Promise<RFBConstructor> => {\n+  if (RFBClass) return RFBClass;\n+  // noVNC 1.7.0-beta exports from core/rfb.js via package.json \"exports\"\n+  // Type assertion since we have inline type definitions and don't need external @types/novnc__novnc\n+  const module = await import(\"@novnc/novnc\") as { default: RFBConstructor };\n+  RFBClass = module.default;\n+  return RFBClass;\n+};\n+\n+export type VncConnectionStatus =\n+  | \"disconnected\"\n+  | \"connecting\"\n+  | \"connected\"\n+  | \"error\";\n+\n+export interface VncViewerProps {\n+  /** WebSocket URL to connect to (wss:// or ws://) - should point to websockify endpoint */\n+  url: string;\n+  /** Additional CSS class for the container */\n+  className?: string;\n+  /** Inline styles for the container */\n+  style?: CSSProperties;\n+  /** Background color for the canvas container */\n+  background?: string;\n+  /** Scale the viewport to fit the container */\n+  scaleViewport?: boolean;\n+  /** Clip the viewport to the container bounds */\n+  clipViewport?: boolean;\n+  /** Allow dragging the viewport when clipped */\n+  dragViewport?: boolean;\n+  /** Resize the remote session to match container size */\n+  resizeSession?: boolean;\n+  /** View-only mode (no keyboard/mouse input) */\n+  viewOnly?: boolean;\n+  /** Show dot cursor when remote cursor is hidden */\n+  showDotCursor?: boolean;\n+  /** JPEG quality level (0-9, higher is better quality) */\n+  qualityLevel?: number;\n+  /** Compression level (0-9, higher is more compression) */\n+  compressionLevel?: number;\n+  /** Auto-connect on mount */\n+  autoConnect?: boolean;\n+  /** Auto-reconnect on disconnect */\n+  autoReconnect?: boolean;\n+  /** Initial reconnect delay in ms */\n+  reconnectDelay?: number;\n+  /** Maximum reconnect delay in ms */\n+  maxReconnectDelay?: number;\n+  /** Maximum number of reconnect attempts (0 = infinite) */\n+  maxReconnectAttempts?: number;\n+  /** Focus the canvas on click */\n+  focusOnClick?: boolean;\n+  /** Loading fallback element */\n+  loadingFallback?: ReactNode;\n+  /** Error fallback element */\n+  errorFallback?: ReactNode;\n+  /** Called when connection is established */\n+  onConnect?: (rfb: RFBInstance) => void;\n+  /** Called when connection is closed */\n+  onDisconnect?: (rfb: RFBInstance | null, detail: { clean: boolean }) => void;\n+  /** Called when credentials are required */\n+  onCredentialsRequired?: (rfb: RFBInstance) => void;\n+  /** Called when security failure occurs */\n+  onSecurityFailure?: (\n+    rfb: RFBInstance | null,\n+    detail: { status: number; reason: string }\n+  ) => void;\n+  /** Called when clipboard data is received from server */\n+  onClipboard?: (rfb: RFBInstance, text: string) => void;\n+  /** Called when connection status changes */\n+  onStatusChange?: (status: VncConnectionStatus) => void;\n+  /** Called when desktop name is received */\n+  onDesktopName?: (rfb: RFBInstance, name: string) => void;\n+  /** Called when capabilities are received */\n+  onCapabilities?: (rfb: RFBInstance, capabilities: Record<string, boolean>) => void;\n+}\n+\n+export interface VncViewerHandle {\n+  /** Connect to the VNC server */\n+  connect: () => void;\n+  /** Disconnect from the VNC server */\n+  disconnect: () => void;\n+  /** Get current connection status */\n+  getStatus: () => VncConnectionStatus;\n+  /** Check if currently connected */\n+  isConnected: () => boolean;\n+  /** Send clipboard text to remote server */\n+  clipboardPaste: (text: string) => void;\n+  /** Send Ctrl+Alt+Del */\n+  sendCtrlAltDel: () => void;\n+  /** Send a key event */\n+  sendKey: (keysym: number, code: string, down?: boolean) => void;\n+  /** Focus the VNC canvas */\n+  focus: () => void;\n+  /** Blur the VNC canvas */\n+  blur: () => void;\n+  /** Get the underlying RFB instance */\n+  getRfb: () => RFBInstance | null;\n+  /** Machine power actions */\n+  machineShutdown: () => void;\n+  machineReboot: () => void;\n+  machineReset: () => void;\n+}\n+\n+/**\n+ * VncViewer - A React component for connecting to VNC servers via websockify\n+ *\n+ * Features:\n+ * - Auto-connect and auto-reconnect with exponential backoff\n+ * - Full clipboard support (Cmd+V paste)\n+ * - Keyboard and mouse input\n+ * - Viewport scaling and resizing\n+ */\n+export const VncViewer = forwardRef<VncViewerHandle, VncViewerProps>(\n+  function VncViewer(\n+    {\n+      url,\n+      className,\n+      style,\n+      background = \"#000000\",\n+      scaleViewport = true,\n+      clipViewport = false,\n+      dragViewport = false,\n+      resizeSession = false,\n+      viewOnly = false,\n+      showDotCursor = false,\n+      qualityLevel = 6,\n+      compressionLevel = 2,\n+      autoConnect = true,\n+      autoReconnect = true,\n+      reconnectDelay = 1000,\n+      maxReconnectDelay = 30000,\n+      maxReconnectAttempts = 0,\n+      focusOnClick = true,\n+      loadingFallback,\n+      errorFallback,\n+      onConnect,\n+      onDisconnect,\n+      onCredentialsRequired,\n+      onSecurityFailure,\n+      onClipboard,\n+      onStatusChange,\n+      onDesktopName,\n+      onCapabilities,\n+    },\n+    ref\n+  ) {\n+    console.log(\"[VncViewer] Component rendering, url:\", url);\n+\n+    const containerRef = useRef<HTMLDivElement>(null);\n+    const rfbRef = useRef<RFBInstance | null>(null);\n+    const reconnectTimerRef = useRef<ReturnType<typeof setTimeout> | null>(\n+      null\n+    );\n+    const reconnectAttemptsRef = useRef(0);\n+    const currentReconnectDelayRef = useRef(reconnectDelay);\n+    const isUnmountedRef = useRef(false);\n+    const urlRef = useRef(url);\n+    const shouldReconnectRef = useRef(autoReconnect);\n+    const connectInternalRef = useRef<(() => Promise<void>) | null>(null);\n+\n+    const [status, setStatus] = useState<VncConnectionStatus>(\"disconnected\");\n+    const [errorMessage, setErrorMessage] = useState<string | null>(null);\n+    const [reconnectAttempt, setReconnectAttempt] = useState(0);\n+    const network = useNetwork();\n+    const isOffline = !network.online;\n+\n+    // Keep urlRef updated\n+    useEffect(() => {\n+      urlRef.current = url;\n+    }, [url]);\n+\n+    // Keep shouldReconnectRef updated\n+    useEffect(() => {\n+      shouldReconnectRef.current = autoReconnect;\n+    }, [autoReconnect]);\n+\n+    // Update status and notify\n+    const updateStatus = useCallback(\n+      (newStatus: VncConnectionStatus, error?: string) => {\n+        setStatus(newStatus);\n+        if (newStatus === \"error\") {\n+          setErrorMessage(error ?? \"Connection failed\");\n+        } else if (newStatus === \"connected\") {\n+          setErrorMessage(null);\n+          setReconnectAttempt(0);\n+        } else if (newStatus === \"connecting\") {\n+          // Keep error message during reconnect attempts for context\n+        }\n+        onStatusChange?.(newStatus);\n+      },\n+      [onStatusChange]\n+    );\n+\n+    // Clear reconnect timer\n+    const clearReconnectTimer = useCallback(() => {\n+      if (reconnectTimerRef.current) {\n+        clearTimeout(reconnectTimerRef.current);\n+        reconnectTimerRef.current = null;\n+      }\n+    }, []);\n+\n+    // Schedule reconnect with exponential backoff\n+    const scheduleReconnect = useCallback((error?: string) => {\n+      if (isUnmountedRef.current || !shouldReconnectRef.current) {\n+        return;\n+      }\n+\n+      // Check max attempts\n+      if (\n+        maxReconnectAttempts > 0 &&\n+        reconnectAttemptsRef.current >= maxReconnectAttempts\n+      ) {\n+        console.log(\n+          `[VncViewer] Max reconnect attempts (${maxReconnectAttempts}) reached`\n+        );\n+        updateStatus(\"error\", error ?? \"Max reconnect attempts reached\");\n+        return;\n+      }\n+\n+      clearReconnectTimer();\n+\n+      const delay = currentReconnectDelayRef.current;\n+      const nextAttempt = reconnectAttemptsRef.current + 1;\n+      console.log(\n+        `[VncViewer] Scheduling reconnect in ${delay}ms (attempt ${nextAttempt})`\n+      );\n+\n+      reconnectTimerRef.current = setTimeout(() => {\n+        if (isUnmountedRef.current) return;\n+        reconnectAttemptsRef.current++;\n+        setReconnectAttempt(reconnectAttemptsRef.current);\n+        // Exponential backoff\n+        currentReconnectDelayRef.current = Math.min(\n+          currentReconnectDelayRef.current * 2,\n+          maxReconnectDelay\n+        );\n+        connectInternalRef.current?.();\n+      }, delay);\n+    }, [\n+      clearReconnectTimer,\n+      maxReconnectAttempts,\n+      maxReconnectDelay,\n+      updateStatus,\n+    ]);\n+\n+    // Internal connect function\n+    const connectInternal = useCallback(async () => {\n+      if (isUnmountedRef.current) return;\n+      if (!containerRef.current) {\n+        console.warn(\"[VncViewer] Container not available for connection\");\n+        return;\n+      }\n+\n+      // Clean up existing connection\n+      if (rfbRef.current) {\n+        try {\n+          rfbRef.current.disconnect();\n+        } catch (e) {\n+          console.error(\"[VncViewer] Error disconnecting existing RFB:\", e);\n+        }\n+        rfbRef.current = null;\n+      }\n+\n+      updateStatus(\"connecting\");\n+\n+      try {\n+        // Dynamically load RFB class\n+        const RFB = await loadRFB();\n+        if (isUnmountedRef.current) return;\n+\n+        const wsUrl = urlRef.current;\n+        console.log(`[VncViewer] Connecting to ${wsUrl}`);\n+\n+        const rfb = new RFB(containerRef.current, wsUrl, {\n+          credentials: undefined,\n+          wsProtocols: [\"binary\"],\n+        });\n+\n+        // Configure RFB options\n+        rfb.scaleViewport = scaleViewport;\n+        rfb.clipViewport = clipViewport;\n+        rfb.dragViewport = dragViewport;\n+        rfb.resizeSession = resizeSession;\n+        rfb.viewOnly = viewOnly;\n+        rfb.showDotCursor = showDotCursor;\n+        rfb.qualityLevel = qualityLevel;\n+        rfb.compressionLevel = compressionLevel;\n+\n+        // Event handlers\n+        rfb.addEventListener(\"connect\", () => {\n+          if (isUnmountedRef.current) return;\n+          console.log(\"[VncViewer] Connected\");\n+          // Reset reconnect state on successful connection\n+          reconnectAttemptsRef.current = 0;\n+          currentReconnectDelayRef.current = reconnectDelay;\n+          updateStatus(\"connected\");\n+          onConnect?.(rfb);\n+        });\n+\n+        rfb.addEventListener(\"disconnect\", (e) => {\n+          if (isUnmountedRef.current) return;\n+          const detail = (e as CustomEvent<{ clean: boolean }>).detail;\n+          const isClean = detail?.clean ?? false;\n+          console.log(\n+            `[VncViewer] Disconnected (clean: ${isClean})`\n+          );\n+          rfbRef.current = null;\n+          updateStatus(\"disconnected\");\n+          onDisconnect?.(rfb, detail ?? { clean: false });\n+\n+          // Auto-reconnect on non-clean disconnect\n+          if (!isClean && shouldReconnectRef.current) {\n+            scheduleReconnect(\"Connection lost unexpectedly\");\n+          }\n+        });\n+\n+        rfb.addEventListener(\"credentialsrequired\", () => {\n+          if (isUnmountedRef.current) return;\n+          console.log(\"[VncViewer] Credentials required\");\n+          onCredentialsRequired?.(rfb);\n+        });\n+\n+        rfb.addEventListener(\"securityfailure\", (e) => {\n+          if (isUnmountedRef.current) return;\n+          const detail = (e as CustomEvent<{ status: number; reason: string }>)\n+            .detail;\n+          console.error(\"[VncViewer] Security failure:\", detail);\n+          updateStatus(\"error\", detail?.reason ?? \"Security failure\");\n+          onSecurityFailure?.(rfb, detail ?? { status: 0, reason: \"Unknown\" });\n+        });\n+\n+        rfb.addEventListener(\"clipboard\", (e) => {\n+          if (isUnmountedRef.current) return;\n+          const detail = (e as CustomEvent<{ text: string }>).detail;\n+          onClipboard?.(rfb, detail?.text ?? \"\");\n+        });\n+\n+        rfb.addEventListener(\"desktopname\", (e) => {\n+          if (isUnmountedRef.current) return;\n+          const detail = (e as CustomEvent<{ name: string }>).detail;\n+          onDesktopName?.(rfb, detail?.name ?? \"\");\n+        });\n+\n+        rfb.addEventListener(\"capabilities\", (e) => {\n+          if (isUnmountedRef.current) return;\n+          const detail = (\n+            e as CustomEvent<{ capabilities: Record<string, boolean> }>\n+          ).detail;\n+          onCapabilities?.(rfb, detail?.capabilities ?? {});\n+        });\n+\n+        rfbRef.current = rfb;\n+      } catch (error) {\n+        console.error(\"[VncViewer] Failed to create RFB connection:\", error);\n+        const errorMsg = error instanceof Error ? error.message : \"Failed to connect\";\n+        updateStatus(\"error\", errorMsg);\n+        if (shouldReconnectRef.current) {\n+          scheduleReconnect(errorMsg);\n+        }\n+      }\n+    }, [\n+      scaleViewport,\n+      clipViewport,\n+      dragViewport,\n+      resizeSession,\n+      viewOnly,\n+      showDotCursor,\n+      qualityLevel,\n+      compressionLevel,\n+      reconnectDelay,\n+      updateStatus,\n+      scheduleReconnect,\n+      onConnect,\n+      onDisconnect,\n+      onCredentialsRequired,\n+      onSecurityFailure,\n+      onClipboard,\n+      onDesktopName,\n+      onCapabilities,\n+    ]);\n+\n+    // Keep connectInternalRef updated\n+    useEffect(() => {\n+      connectInternalRef.current = connectInternal;\n+    }, [connectInternal]);\n+\n+    // Public connect method\n+    const connect = useCallback(() => {\n+      clearReconnectTimer();\n+      reconnectAttemptsRef.current = 0;\n+      currentReconnectDelayRef.current = reconnectDelay;\n+      connectInternal();\n+    }, [clearReconnectTimer, reconnectDelay, connectInternal]);\n+\n+    // Auto-reconnect when network comes back online\n+    const prevOnlineRef = useRef(network.online);\n+    useEffect(() => {\n+      if (network.online && !prevOnlineRef.current) {\n+        console.log(\"[VncViewer] Network back online, reconnecting...\");\n+        if (status === \"error\" || status === \"disconnected\") {\n+          connect();\n+        }\n+      }\n+      prevOnlineRef.current = network.online;\n+    }, [network.online, status, connect]);\n+\n+    // Public disconnect method\n+    const disconnect = useCallback(() => {\n+      clearReconnectTimer();\n+      shouldReconnectRef.current = false; // Prevent auto-reconnect on explicit disconnect\n+      if (rfbRef.current) {\n+        try {\n+          rfbRef.current.disconnect();\n+        } catch (e) {\n+          console.error(\"[VncViewer] Error during disconnect:\", e);\n+        }\n+        rfbRef.current = null;\n+      }\n+      updateStatus(\"disconnected\");\n+    }, [clearReconnectTimer, updateStatus]);\n+\n+    // Clipboard paste handler - syncs clipboard then sends Ctrl+V\n+    // Uses proper DOM key codes for QEMU extended key events\n+    const clipboardPaste = useCallback((text: string) => {\n+      const rfb = rfbRef.current;\n+      if (!rfb) return;\n+\n+      try {\n+        // Sync clipboard to VNC server\n+        rfb.clipboardPasteFrom(text);\n+        console.log(\"[VncViewer] Clipboard synced, sending Ctrl+V...\");\n+\n+        // X11 keysyms (same as noVNC's KeyTable)\n+        const XK_Meta_L = 0xffe7;\n+        const XK_Meta_R = 0xffe8;\n+        const XK_Super_L = 0xffeb;\n+        const XK_Super_R = 0xffec;\n+        const XK_Control_L = 0xffe3;\n+        const XK_v = 0x0076;\n+\n+        // Small delay to ensure clipboard is processed by VNC server\n+        setTimeout(() => {\n+          // Release Meta/Super keys that might be held from user's Cmd\n+          // (noVNC sent Meta down before we intercepted the V keydown)\n+          rfb.sendKey(XK_Meta_L, \"MetaLeft\", false);\n+          rfb.sendKey(XK_Meta_R, \"MetaRight\", false);\n+          rfb.sendKey(XK_Super_L, \"OSLeft\", false);\n+          rfb.sendKey(XK_Super_R, \"OSRight\", false);\n+\n+          // Send Ctrl+V with proper DOM codes (like noVNC's sendCtrlAltDel)\n+          rfb.sendKey(XK_Control_L, \"ControlLeft\", true);\n+          rfb.sendKey(XK_v, \"KeyV\", true);\n+          rfb.sendKey(XK_v, \"KeyV\", false);\n+          rfb.sendKey(XK_Control_L, \"ControlLeft\", false);\n+          console.log(\"[VncViewer] Ctrl+V sent\");\n+        }, 50);\n+      } catch (e) {\n+        console.error(\"[VncViewer] Error pasting to clipboard:\", e);\n+      }\n+    }, []);\n+\n+    // Send a key combo to VNC, releasing Meta/Super first (for Mac Cmd → Linux Ctrl translation)\n+    const sendKeyCombo = useCallback((keysym: number, code: string, withShift = false) => {\n+      const rfb = rfbRef.current;\n+      if (!rfb) return;\n+\n+      // X11 keysyms for modifiers\n+      const XK_Shift_L = 0xffe1;\n+      const XK_Meta_L = 0xffe7;\n+      const XK_Meta_R = 0xffe8;\n+      const XK_Super_L = 0xffeb;\n+      const XK_Super_R = 0xffec;\n+      const XK_Control_L = 0xffe3;\n+\n+      // Release Meta/Super keys that might be held from user's Cmd\n+      rfb.sendKey(XK_Meta_L, \"MetaLeft\", false);\n+      rfb.sendKey(XK_Meta_R, \"MetaRight\", false);\n+      rfb.sendKey(XK_Super_L, \"OSLeft\", false);\n+      rfb.sendKey(XK_Super_R, \"OSRight\", false);\n+\n+      // Send Ctrl+<key> (with optional Shift)\n+      rfb.sendKey(XK_Control_L, \"ControlLeft\", true);\n+      if (withShift) rfb.sendKey(XK_Shift_L, \"ShiftLeft\", true);\n+      rfb.sendKey(keysym, code, true);\n+      rfb.sendKey(keysym, code, false);\n+      if (withShift) rfb.sendKey(XK_Shift_L, \"ShiftLeft\", false);\n+      rfb.sendKey(XK_Control_L, \"ControlLeft\", false);\n+    }, []);\n+\n+    // Check if VNC viewer is focused (container or any child including canvas)\n+    const isVncFocused = useCallback(() => {\n+      const container = containerRef.current;\n+      if (!container) return false;\n+      const active = document.activeElement;\n+      return container === active || container.contains(active);\n+    }, []);\n+\n+    // Send Ctrl+key combo (releasing Meta first for Mac)\n+    const sendCtrlKey = useCallback((keysym: number, code: string, releaseMeta = false) => {\n+      const rfb = rfbRef.current;\n+      if (!rfb) return;\n+\n+      const XK_Control_L = 0xffe3;\n+\n+      if (releaseMeta) {\n+        // Release Meta/Super keys that might be held from user's Option key\n+        rfb.sendKey(0xffe7, \"MetaLeft\", false);\n+        rfb.sendKey(0xffe8, \"MetaRight\", false);\n+        rfb.sendKey(0xffeb, \"OSLeft\", false);\n+        rfb.sendKey(0xffec, \"OSRight\", false);\n+        // Also release Alt since Option maps to Alt\n+        rfb.sendKey(0xffe9, \"AltLeft\", false);\n+        rfb.sendKey(0xffea, \"AltRight\", false);\n+      }\n+\n+      rfb.sendKey(XK_Control_L, \"ControlLeft\", true);\n+      rfb.sendKey(keysym, code, true);\n+      rfb.sendKey(keysym, code, false);\n+      rfb.sendKey(XK_Control_L, \"ControlLeft\", false);\n+    }, []);\n+\n+    // Intercept Mac shortcuts and translate to Linux equivalents\n+    // Listen at document level to intercept before browser handles them\n+    useEffect(() => {\n+      const isMac = /Mac|iPhone|iPad|iPod/i.test(navigator.platform || navigator.userAgent);\n+      if (!isMac) return; // Only needed on Mac\n+\n+      const handleKeyDown = async (e: KeyboardEvent) => {\n+        // Only handle if VNC is focused\n+        if (!isVncFocused()) return;\n+\n+        // Don't send keyboard events in view-only mode\n+        if (viewOnly) return;\n+\n+        const rfb = rfbRef.current;\n+        const code = e.code; // Use e.code for reliable key identification\n+\n+        // Helper to handle a shortcut: preventDefault first, then send to VNC\n+        const handleShortcut = (\n+          logMsg: string,\n+          action: () => void\n+        ) => {\n+          e.preventDefault();\n+          e.stopPropagation();\n+          if (!rfb) {\n+            console.log(`[VncViewer] ${logMsg} - but VNC not connected`);\n+            return;\n+          }\n+          console.log(`[VncViewer] ${logMsg}`);\n+          action();\n+        };\n+\n+        // === Cmd+Shift+<key> combinations ===\n+        if (e.metaKey && e.shiftKey && !e.altKey && !e.ctrlKey) {\n+          // Cmd+Shift+[ → Ctrl+PageUp (previous tab in Linux)\n+          if (code === \"BracketLeft\") {\n+            handleShortcut(\"Cmd+Shift+[ → Ctrl+PageUp (prev tab)\", () => {\n+              sendKeyCombo(0xff55, \"PageUp\"); // XK_Page_Up, no shift needed\n+            });\n+            return;\n+          }\n+          // Cmd+Shift+] → Ctrl+PageDown (next tab in Linux)\n+          if (code === \"BracketRight\") {\n+            handleShortcut(\"Cmd+Shift+] → Ctrl+PageDown (next tab)\", () => {\n+              sendKeyCombo(0xff56, \"PageDown\"); // XK_Page_Down, no shift needed\n+            });\n+            return;\n+          }\n+          // Cmd+Shift+Z → Ctrl+Shift+Z (redo)\n+          if (code === \"KeyZ\") {\n+            handleShortcut(\"Cmd+Shift+Z → Ctrl+Shift+Z\", () => {\n+              sendKeyCombo(0x007a, \"KeyZ\", true);\n+            });\n+            return;\n+          }\n+          // Other Cmd+Shift combinations\n+          const cmdShiftMap: Record<string, [number, string]> = {\n+            KeyF: [0x0066, \"KeyF\"], // Find in files\n+            KeyS: [0x0073, \"KeyS\"], // Save as\n+            KeyP: [0x0070, \"KeyP\"], // Command palette\n+            KeyG: [0x0067, \"KeyG\"], // Find previous\n+          };\n+          if (cmdShiftMap[code]) {\n+            const [keysym, keyCode] = cmdShiftMap[code];\n+            handleShortcut(`Cmd+Shift+${code} → Ctrl+Shift+${code}`, () => {\n+              sendKeyCombo(keysym, keyCode, true);\n+            });\n+            return;\n+          }\n+        }\n+\n+        // === Cmd+<key> (no shift) ===\n+        if (e.metaKey && !e.shiftKey && !e.altKey && !e.ctrlKey) {\n+          // Arrow keys: Cmd+Arrow → Home/End\n+          if (code === \"ArrowLeft\") {\n+            handleShortcut(\"Cmd+Left → Home\", () => sendKeyCombo(0xff50, \"Home\"));\n+            return;\n+          }\n+          if (code === \"ArrowRight\") {\n+            handleShortcut(\"Cmd+Right → End\", () => sendKeyCombo(0xff57, \"End\"));\n+            return;\n+          }\n+          if (code === \"ArrowUp\") {\n+            handleShortcut(\"Cmd+Up → Ctrl+Home\", () => sendKeyCombo(0xff50, \"Home\"));\n+            return;\n+          }\n+          if (code === \"ArrowDown\") {\n+            handleShortcut(\"Cmd+Down → Ctrl+End\", () => sendKeyCombo(0xff57, \"End\"));\n+            return;\n+          }\n+\n+          // Cmd+Backspace → delete to beginning of line\n+          // Use Shift+Home (select to start) + Backspace (delete) instead of Ctrl+U\n+          // because Ctrl+U opens View Source in browsers\n+          if (code === \"Backspace\") {\n+            handleShortcut(\"Cmd+Backspace → Shift+Home, Backspace\", () => {\n+              const rfb = rfbRef.current;\n+              if (!rfb) return;\n+\n+              const XK_Shift_L = 0xffe1;\n+              const XK_Home = 0xff50;\n+              const XK_BackSpace = 0xff08;\n+              const XK_Meta_L = 0xffe7;\n+              const XK_Meta_R = 0xffe8;\n+              const XK_Super_L = 0xffeb;\n+              const XK_Super_R = 0xffec;\n+\n+              // Release Meta/Super keys first\n+              rfb.sendKey(XK_Meta_L, \"MetaLeft\", false);\n+              rfb.sendKey(XK_Meta_R, \"MetaRight\", false);\n+              rfb.sendKey(XK_Super_L, \"OSLeft\", false);\n+              rfb.sendKey(XK_Super_R, \"OSRight\", false);\n+\n+              // Shift+Home to select from cursor to beginning of line\n+              rfb.sendKey(XK_Shift_L, \"ShiftLeft\", true);\n+              rfb.sendKey(XK_Home, \"Home\", true);\n+              rfb.sendKey(XK_Home, \"Home\", false);\n+              rfb.sendKey(XK_Shift_L, \"ShiftLeft\", false);\n+\n+              // Backspace to delete the selection\n+              rfb.sendKey(XK_BackSpace, \"Backspace\", true);\n+              rfb.sendKey(XK_BackSpace, \"Backspace\", false);\n+            });\n+            return;\n+          }\n+\n+          // Cmd+V → Paste (special handling for clipboard)\n+          if (code === \"KeyV\") {\n+            e.preventDefault();\n+            e.stopPropagation();\n+            try {\n+              const text = await navigator.clipboard.readText();\n+              if (text && rfb) {\n+                console.log(\"[VncViewer] Cmd+V → paste\");\n+                clipboardPaste(text);\n+              }\n+            } catch (err) {\n+              console.error(\"[VncViewer] Clipboard read failed:\", err);\n+            }\n+            return;\n+          }\n+\n+          // Standard Cmd+<key> → Ctrl+<key> mappings\n+          const cmdMap: Record<string, [number, string]> = {\n+            KeyA: [0x0061, \"KeyA\"], KeyB: [0x0062, \"KeyB\"], KeyC: [0x0063, \"KeyC\"],\n+            KeyD: [0x0064, \"KeyD\"], KeyF: [0x0066, \"KeyF\"], KeyG: [0x0067, \"KeyG\"],\n+            KeyH: [0x0068, \"KeyH\"], KeyI: [0x0069, \"KeyI\"], KeyK: [0x006b, \"KeyK\"],\n+            KeyL: [0x006c, \"KeyL\"], KeyN: [0x006e, \"KeyN\"], KeyO: [0x006f, \"KeyO\"],\n+            KeyP: [0x0070, \"KeyP\"], KeyR: [0x0072, \"KeyR\"], KeyS: [0x0073, \"KeyS\"],\n+            KeyT: [0x0074, \"KeyT\"], KeyU: [0x0075, \"KeyU\"], KeyW: [0x0077, \"KeyW\"],\n+            KeyX: [0x0078, \"KeyX\"], KeyY: [0x0079, \"KeyY\"], KeyZ: [0x007a, \"KeyZ\"],\n+            Slash: [0x002f, \"Slash\"],\n+            BracketLeft: [0x005b, \"BracketLeft\"],\n+            BracketRight: [0x005d, \"BracketRight\"],\n+            Minus: [0x002d, \"Minus\"],         // Zoom out (Ctrl+-)\n+            Equal: [0x003d, \"Equal\"],         // Zoom in (Ctrl+=)\n+            Digit0: [0x0030, \"Digit0\"],       // Reset zoom / Tab 10 (Ctrl+0)\n+            Digit1: [0x0031, \"Digit1\"],       // Tab 1 (Ctrl+1)\n+            Digit2: [0x0032, \"Digit2\"],       // Tab 2 (Ctrl+2)\n+            Digit3: [0x0033, \"Digit3\"],       // Tab 3 (Ctrl+3)\n+            Digit4: [0x0034, \"Digit4\"],       // Tab 4 (Ctrl+4)\n+            Digit5: [0x0035, \"Digit5\"],       // Tab 5 (Ctrl+5)\n+            Digit6: [0x0036, \"Digit6\"],       // Tab 6 (Ctrl+6)\n+            Digit7: [0x0037, \"Digit7\"],       // Tab 7 (Ctrl+7)\n+            Digit8: [0x0038, \"Digit8\"],       // Tab 8 (Ctrl+8)\n+            Digit9: [0x0039, \"Digit9\"],       // Tab 9 / Last tab (Ctrl+9)\n+          };\n+          if (cmdMap[code]) {\n+            const [keysym, keyCode] = cmdMap[code];\n+            handleShortcut(`Cmd+${code} → Ctrl+${code}`, () => sendKeyCombo(keysym, keyCode));\n+            return;\n+          }\n+        }\n+\n+        // === Option+<key> (word navigation) ===\n+        if (e.altKey && !e.metaKey && !e.ctrlKey && !e.shiftKey) {\n+          if (code === \"ArrowLeft\") {\n+            handleShortcut(\"Option+Left → Ctrl+Left\", () => sendCtrlKey(0xff51, \"ArrowLeft\", true));\n+            return;\n+          }\n+          if (code === \"ArrowRight\") {\n+            handleShortcut(\"Option+Right → Ctrl+Right\", () => sendCtrlKey(0xff53, \"ArrowRight\", true));\n+            return;\n+          }\n+          if (code === \"Backspace\") {\n+            // Ctrl+Backspace = delete word backwards (works in terminals, VS Code, browsers)\n+            // Note: Ctrl+W is the readline binding but it also closes tabs in GUIs\n+            handleShortcut(\"Option+Backspace → Ctrl+Backspace\", () => sendCtrlKey(0xff08, \"Backspace\", true));\n+            return;\n+          }\n+          if (code === \"Delete\") {\n+            // Option+Delete (Fn+Option+Backspace) → Ctrl+Delete = delete word forwards\n+            handleShortcut(\"Option+Delete → Ctrl+Delete\", () => sendCtrlKey(0xffff, \"Delete\", true));\n+            return;\n+          }\n+        }\n+\n+        // === Ctrl+<key> (GNU readline) ===\n+        if (e.ctrlKey && !e.metaKey && !e.altKey && !e.shiftKey) {\n+          const readlineMap: Record<string, [number, string]> = {\n+            KeyA: [0x0061, \"KeyA\"], // Beginning of line\n+            KeyE: [0x0065, \"KeyE\"], // End of line\n+            KeyK: [0x006b, \"KeyK\"], // Kill to end\n+            KeyU: [0x0075, \"KeyU\"], // Kill to beginning\n+            KeyW: [0x0077, \"KeyW\"], // Delete word\n+            KeyY: [0x0079, \"KeyY\"], // Yank\n+            KeyL: [0x006c, \"KeyL\"], // Clear screen\n+            KeyC: [0x0063, \"KeyC\"], // Interrupt\n+            KeyD: [0x0064, \"KeyD\"], // EOF\n+          };\n+          if (readlineMap[code]) {\n+            const [keysym, keyCode] = readlineMap[code];\n+            handleShortcut(`Ctrl+${code} → Ctrl+${code}`, () => sendCtrlKey(keysym, keyCode, false));\n+            return;\n+          }\n+        }\n+      };\n+\n+      // Listen at document level with capture to intercept before browser default handlers\n+      document.addEventListener(\"keydown\", handleKeyDown, { capture: true });\n+      return () => {\n+        document.removeEventListener(\"keydown\", handleKeyDown, { capture: true });\n+      };\n+    }, [clipboardPaste, sendKeyCombo, sendCtrlKey, isVncFocused, viewOnly]);\n+\n+    // Fallback: Document-level paste event listener\n+    // Handles cases where keydown might not fire (e.g., Electron menu triggers paste)\n+    useEffect(() => {\n+      const container = containerRef.current;\n+      if (!container) return;\n+\n+      const handleDocumentPaste = (e: ClipboardEvent) => {\n+        // Only handle if VNC container has focus\n+        if (!container.contains(document.activeElement)) return;\n+        if (!rfbRef.current) return;\n+        // Don't paste in view-only mode\n+        if (viewOnly) return;\n+\n+        const text =\n+          e.clipboardData?.getData(\"text/plain\") ||\n+          e.clipboardData?.getData(\"text\");\n+        if (text) {\n+          console.log(\"[VncViewer] Document paste event intercepted\");\n+          e.preventDefault();\n+          e.stopPropagation();\n+          clipboardPaste(text);\n+        }\n+      };\n+\n+      // Capture phase to intercept before other handlers\n+      document.addEventListener(\"paste\", handleDocumentPaste, { capture: true });\n+      return () => document.removeEventListener(\"paste\", handleDocumentPaste, { capture: true });\n+    }, [clipboardPaste, viewOnly]);\n+\n+    // Focus the canvas\n+    const focus = useCallback(() => {\n+      rfbRef.current?.focus();\n+    }, []);\n+\n+    // Blur the canvas\n+    const blur = useCallback(() => {\n+      rfbRef.current?.blur();\n+    }, []);\n+\n+    // Expose imperative handle\n+    useImperativeHandle(\n+      ref,\n+      () => ({\n+        connect,\n+        disconnect,\n+        getStatus: () => status,\n+        isConnected: () => status === \"connected\",\n+        clipboardPaste,\n+        sendCtrlAltDel: () => rfbRef.current?.sendCtrlAltDel(),\n+        sendKey: (keysym, code, down) =>\n+          rfbRef.current?.sendKey(keysym, code, down),\n+        focus,\n+        blur,\n+        getRfb: () => rfbRef.current,\n+        machineShutdown: () => rfbRef.current?.machineShutdown(),\n+        machineReboot: () => rfbRef.current?.machineReboot(),\n+        machineReset: () => rfbRef.current?.machineReset(),\n+      }),\n+      [connect, disconnect, status, clipboardPaste, focus, blur]\n+    );\n+\n+    // Auto-connect on mount\n+    useEffect(() => {\n+      isUnmountedRef.current = false;\n+\n+      if (autoConnect) {\n+        // Small delay to ensure DOM is ready\n+        const timer = setTimeout(() => {\n+          if (!isUnmountedRef.current) {\n+            connect();\n+          }\n+        }, 100);\n+        return () => clearTimeout(timer);\n+      }\n+      return undefined;\n+    }, [autoConnect, connect]);\n+\n+    // Cleanup on unmount\n+    useEffect(() => {\n+      return () => {\n+        isUnmountedRef.current = true;\n+        clearReconnectTimer();\n+        if (rfbRef.current) {\n+          try {\n+            rfbRef.current.disconnect();\n+          } catch (e) {\n+            console.error(\"[VncViewer] Error during unmount cleanup:\", e);\n+          }\n+          rfbRef.current = null;\n+        }\n+      };\n+    }, [clearReconnectTimer]);\n+\n+    // Reconnect when URL changes\n+    useEffect(() => {\n+      if (status === \"connected\" || status === \"connecting\") {\n+        // URL changed, reconnect\n+        console.log(\"[VncViewer] URL changed, reconnecting...\");\n+        connect();\n+      }\n+      // eslint-disable-next-line react-hooks/exhaustive-deps\n+    }, [url]);\n+\n+\n+    // Handle container click for focus\n+    const handleContainerClick = useCallback(() => {\n+      if (focusOnClick && rfbRef.current) {\n+        focus();\n+      }\n+    }, [focusOnClick, focus]);\n+\n+    // Compute what to render\n+    const showLoading = (status === \"connecting\" || status === \"disconnected\") && !isOffline;\n+    const showError = status === \"error\" || isOffline;\n+\n+    // Default loading fallback\n+    const defaultLoadingFallback = useMemo(\n+      () => (\n+        <div className=\"absolute inset-0 flex items-center justify-center\">\n+          <div className=\"flex flex-col items-center gap-2\">\n+            <div className=\"h-5 w-5 animate-spin rounded-full border-[1.5px] border-neutral-600 border-t-transparent\" />\n+            <span className=\"text-xs text-neutral-500\">\n+              {status === \"connecting\"\n+                ? reconnectAttempt > 0\n+                  ? `Reconnecting (${reconnectAttempt})...`\n+                  : \"Connecting...\"\n+                : \"\"}\n+            </span>\n+            {reconnectAttempt > 0 && errorMessage && (\n+              <span className=\"text-xs text-neutral-600 max-w-[240px] text-center\">\n+                {errorMessage}\n+              </span>\n+            )}\n+          </div>\n+        </div>\n+      ),\n+      [status, reconnectAttempt, errorMessage]\n+    );\n+\n+    // Default error fallback\n+    const defaultErrorFallback = useMemo(\n+      () => (\n+        <div className=\"absolute inset-0 flex items-center justify-center\">\n+          <div className=\"flex flex-col items-center gap-3 text-center px-4\">\n+            {isOffline ? (\n+              // Network offline state\n+              <>\n+                <div className=\"flex h-10 w-10 items-center justify-center rounded-full bg-amber-500/10\">\n+                  <svg\n+                    className=\"h-5 w-5 text-amber-400\"\n+                    fill=\"none\"\n+                    viewBox=\"0 0 24 24\"\n+                    stroke=\"currentColor\"\n+                    strokeWidth={2}\n+                  >\n+                    <path\n+                      strokeLinecap=\"round\"\n+                      strokeLinejoin=\"round\"\n+                      d=\"M18.364 5.636a9 9 0 010 12.728m0 0l-2.829-2.829m2.829 2.829L21 21M15.536 8.464a5 5 0 010 7.072m0 0l-2.829-2.829m-4.243 2.829a4.978 4.978 0 01-1.414-2.83m-1.414 5.658a9 9 0 01-2.167-9.238m7.824 2.167a1 1 0 111.414 1.414m-1.414-1.414L3 3m8.293 8.293l1.414 1.414\"\n+                    />\n+                  </svg>\n+                </div>\n+                <div className=\"flex flex-col gap-1\">\n+                  <span className=\"text-sm font-medium text-neutral-200\">\n+                    Network offline\n+                  </span>\n+                  <span className=\"text-xs text-neutral-400 max-w-[280px]\">\n+                    Check your internet connection. Will reconnect automatically when online.\n+                  </span>\n+                </div>\n+              </>\n+            ) : (\n+              // Server/connection error state\n+              <>\n+                <div className=\"flex h-10 w-10 items-center justify-center rounded-full bg-red-500/10\">\n+                  <svg\n+                    className=\"h-5 w-5 text-red-400\"\n+                    fill=\"none\"\n+                    viewBox=\"0 0 24 24\"\n+                    stroke=\"currentColor\"\n+                    strokeWidth={2}\n+                  >\n+                    <path\n+                      strokeLinecap=\"round\"\n+                      strokeLinejoin=\"round\"\n+                      d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"\n+                    />\n+                  </svg>\n+                </div>\n+                <div className=\"flex flex-col gap-1\">\n+                  <span className=\"text-sm font-medium text-neutral-200\">\n+                    Connection failed\n+                  </span>\n+                  {errorMessage && (\n+                    <span className=\"text-xs text-neutral-400 max-w-[280px]\">\n+                      {errorMessage}\n+                    </span>\n+                  )}\n+                </div>\n+                <button\n+                  type=\"button\"\n+                  onClick={connect}\n+                  className=\"mt-1 rounded-md bg-neutral-700 px-4 py-2 text-sm font-medium text-white hover:bg-neutral-600 transition-colors\"\n+                >\n+                  Retry connection\n+                </button>\n+              </>\n+            )}\n+          </div>\n+        </div>\n+      ),\n+      [connect, errorMessage, isOffline]\n+    );\n+\n+    // Prevent Electron's context menu so noVNC can handle right-clicks\n+    const handleContextMenu = useCallback((e: React.MouseEvent) => {\n+      e.preventDefault();\n+    }, []);\n+\n+    return (\n+      <div\n+        className={clsx(\"relative overflow-hidden\", className)}\n+        style={{ background, ...style }}\n+        onClick={handleContainerClick}\n+        onContextMenu={handleContextMenu}\n+        data-drag-disable-pointer\n+      >\n+        {/* VNC Canvas Container - noVNC creates canvas inside this */}\n+        <div\n+          ref={containerRef}\n+          className=\"absolute inset-0\"\n+          style={{ background }}\n+          tabIndex={0}\n+          data-drag-disable-pointer\n+        />\n+\n+        {/* Loading Overlay */}\n+        {showLoading && (loadingFallback ?? defaultLoadingFallback)}\n+\n+        {/* Error Overlay */}\n+        {showError && (errorFallback ?? defaultErrorFallback)}\n+      </div>\n+    );\n+  }\n+);\n+\n+export default VncViewer;\ndiff --git a/packages/shared/src/hooks/use-network.ts b/packages/shared/src/hooks/use-network.ts\nnew file mode 100644\nindex 000000000..0de3d8649\n--- /dev/null\n+++ b/packages/shared/src/hooks/use-network.ts\n@@ -0,0 +1,76 @@\n+\"use client\";\n+\n+import { useState, useEffect, useCallback } from \"react\";\n+\n+export interface NetworkStatus {\n+  /** Whether the browser reports being online */\n+  online: boolean;\n+  /** Effective connection type (4g, 3g, 2g, slow-2g) if available */\n+  effectiveType?: \"slow-2g\" | \"2g\" | \"3g\" | \"4g\";\n+  /** Estimated round-trip time in milliseconds */\n+  rtt?: number;\n+  /** Estimated downlink speed in Mbps */\n+  downlink?: number;\n+  /** Whether data saver mode is enabled */\n+  saveData?: boolean;\n+}\n+\n+/**\n+ * Hook to monitor network connectivity status\n+ * Uses Navigator.onLine and Network Information API where available\n+ */\n+export function useNetwork(): NetworkStatus {\n+  const getNetworkStatus = useCallback((): NetworkStatus => {\n+    if (typeof navigator === \"undefined\") {\n+      return { online: true };\n+    }\n+\n+    const connection =\n+      (navigator as Navigator & { connection?: NetworkInformation }).connection;\n+\n+    return {\n+      online: navigator.onLine,\n+      effectiveType: connection?.effectiveType,\n+      rtt: connection?.rtt,\n+      downlink: connection?.downlink,\n+      saveData: connection?.saveData,\n+    };\n+  }, []);\n+\n+  const [status, setStatus] = useState<NetworkStatus>(getNetworkStatus);\n+\n+  useEffect(() => {\n+    const handleChange = () => {\n+      setStatus(getNetworkStatus());\n+    };\n+\n+    // Listen for online/offline events\n+    window.addEventListener(\"online\", handleChange);\n+    window.addEventListener(\"offline\", handleChange);\n+\n+    // Listen for connection changes if available\n+    const connection =\n+      (navigator as Navigator & { connection?: NetworkInformation }).connection;\n+    connection?.addEventListener?.(\"change\", handleChange);\n+\n+    return () => {\n+      window.removeEventListener(\"online\", handleChange);\n+      window.removeEventListener(\"offline\", handleChange);\n+      connection?.removeEventListener?.(\"change\", handleChange);\n+    };\n+  }, [getNetworkStatus]);\n+\n+  return status;\n+}\n+\n+// Network Information API types (not fully standardized)\n+interface NetworkInformation extends EventTarget {\n+  effectiveType?: \"slow-2g\" | \"2g\" | \"3g\" | \"4g\";\n+  rtt?: number;\n+  downlink?: number;\n+  saveData?: boolean;\n+  addEventListener(type: \"change\", listener: () => void): void;\n+  removeEventListener(type: \"change\", listener: () => void): void;\n+}\n+\n+export default useNetwork;\ndiff --git a/packages/shared/src/index.ts b/packages/shared/src/index.ts\nindex 4460dce18..15be1742b 100644\n--- a/packages/shared/src/index.ts\n+++ b/packages/shared/src/index.ts\n@@ -27,3 +27,5 @@ export * from \"./pull-request-state\";\n export * from \"./iframe-preflight\";\n export * from \"./morph-snapshots\";\n export * from \"./screenshots/types\";\n+// Note: useNetwork hook is NOT exported here to avoid SSR issues.\n+// Import directly from \"@cmux/shared/hooks/use-network\" in client components.\ndiff --git a/packages/shared/tsconfig.json b/packages/shared/tsconfig.json\nindex c42c45d94..40da1c017 100644\n--- a/packages/shared/tsconfig.json\n+++ b/packages/shared/tsconfig.json\n@@ -9,7 +9,8 @@\n     \"module\": \"ESNext\",\n     \"skipLibCheck\": true,\n     \"verbatimModuleSyntax\": true,\n-    \"resolveJsonModule\": true\n+    \"resolveJsonModule\": true,\n+    \"jsx\": \"react-jsx\"\n   },\n   \"include\": [\"src\"]\n }\n","comments":[{"type":"issue_comment","id":3610498270,"prNumber":1168,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn770664t1677x24zjap4dzsd17wn8hb?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn770664t1677x24zjap4dzsd17wn8hb/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1168?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"91aadb246182a2708e96fb9975e047090cbf8603","createdAt":"2025-12-04T06:22:33Z","updatedAt":"2025-12-04T22:56:12Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1168#issuecomment-3610498270"},{"type":"issue_comment","id":3610823055,"prNumber":1168,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.dev/manaflow/task/kn78mv8dfcvj7mxkye63ex3sts7wnq4p?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.dev/manaflow/task/kn78mv8dfcvj7mxkye63ex3sts7wnq4p/run/kd76f6tvwrdsdc5ttvb7hstggd7wmfkf/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1168?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 5 screenshots for commit `3126eb0` (2025-12-04 08:20:07.661 UTC).\n\n**Cmux client dashboard showing PR tasks list and workspace overview**\n\n![client-dashboard-overview.png](https://adorable-wombat-701.convex.cloud/api/storage/10969266-fa80-4860-8879-12ec248f6dc2)\n\n**PR \\#1168 overview page showing the code diff for replacing VNC iframe with React component**\n\n![pr-1168-overview-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/6566a98e-9ed0-492f-9c33-346d28af2833)\n\n**Preview.new workspace configuration page showing environment setup form with scripts and environment variables**\n\n![preview-configure-workspace-page.png](https://adorable-wombat-701.convex.cloud/api/storage/dbde0d65-8ca5-49b2-bf81-73d9be9dcad3)\n\n**Preview.new browser configuration page with VNC viewer component displaying the React-based VNC canvas \\(replaces iframe\\)**\n\n![preview-vnc-viewer-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/86fa50ab-aebe-44ad-a61d-0970a092c44d)\n\n**Preview.new workspace setup instructions page showing terminal commands to run in VS Code**\n\n![preview-workspace-setup-instructions.png](https://adorable-wombat-701.convex.cloud/api/storage/421e9e53-5fb3-4e46-9ffe-76ea6248c558)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"91aadb246182a2708e96fb9975e047090cbf8603","createdAt":"2025-12-04T08:20:08Z","updatedAt":"2025-12-04T12:16:11Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1168#issuecomment-3610823055"},{"type":"issue_comment","id":3611956843,"prNumber":1168,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.dev/manaflow/task/kn7bekfyb2vas5tsmgd8bgywnx7wmg92?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.dev/manaflow/task/kn7bekfyb2vas5tsmgd8bgywnx7wmg92/run/kd76jrtcg0smjk10j4q5hfyz157wmg2c/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1168?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 10 screenshots for commit `799caae` (2025-12-04 12:16:06.717 UTC).\n\n**Navigated back to initial setup showing the full configuration form with all environment variables and scripts**\n\n![back-to-initial-setup-view.png](https://adorable-wombat-701.convex.cloud/api/storage/dfe96619-279f-4bbf-8664-e2db813aabe1)\n\n**Main dashboard view showing navigation sidebar with pull requests, workspaces, and previews**\n\n![dashboard-view-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/86b25f28-6b97-4685-8d30-81dc7c59ff15)\n\n**Pull request view showing PR \\#1168 'Replace VNC iframe with React component' with diff stats and merge options**\n\n![pr-view-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/bd3e2816-b295-493d-bf89-cf3a37679080)\n\n**Initial setup page for configuring workspace with framework preset, maintenance scripts, dev scripts, and environment variables**\n\n![preview-configure-initial-setup.png](https://adorable-wombat-701.convex.cloud/api/storage/ae8a0317-555c-49a1-8eaa-d7a586e1ddcf)\n\n**Preview.new landing page showing the main interface with repository configuration options**\n\n![preview-new-landing-page.png](https://adorable-wombat-701.convex.cloud/api/storage/383e9c98-5efc-4796-85b0-86661e9f2847)\n\n**Final view of the VNC Viewer component with browser configuration sidebar and connected VNC canvas displaying remote desktop**\n\n![vnc-viewer-component-final.png](https://adorable-wombat-701.convex.cloud/api/storage/81d4641d-634a-49f0-81f3-e578accee58f)\n\n**VNC Viewer React component successfully connected, showing the noVNC canvas element rendering the remote browser desktop**\n\n![vnc-viewer-connected-browser-view.png](https://adorable-wombat-701.convex.cloud/api/storage/f4994241-054a-4759-ba37-d6798c40760a)\n\n**VNC Viewer React component in connecting state, displaying 'Connecting to browser preview...' message in the browser setup step**\n\n![vnc-viewer-connecting-state.png](https://adorable-wombat-701.convex.cloud/api/storage/a481db32-1a08-48bf-8f32-5b43f4d93ed0)\n\n**Workspace configuration view showing embedded VS Code with file explorer and the step to run scripts in terminal**\n\n![workspace-config-vscode-step.png](https://adorable-wombat-701.convex.cloud/api/storage/a8427113-2092-4776-925e-a40e092469b9)\n\n**Loading state while the VS Code workspace is being provisioned and started**\n\n![workspace-provisioning-loading.png](https://adorable-wombat-701.convex.cloud/api/storage/f62398c3-8875-4d44-8aa3-f08e6b211ba7)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"91aadb246182a2708e96fb9975e047090cbf8603","createdAt":"2025-12-04T12:16:09Z","updatedAt":"2025-12-04T22:34:49Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1168#issuecomment-3611956843"},{"type":"issue_comment","id":3614593318,"prNumber":1168,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.dev/manaflow/task/kn7djgrw2k3pmzqyw2pm1sbqgs7wnb47?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.dev/manaflow/task/kn7djgrw2k3pmzqyw2pm1sbqgs7wnb47/run/kd71jqatjq2ergtqbqtqffve3s7wnh9f/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1168?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"91aadb246182a2708e96fb9975e047090cbf8603","createdAt":"2025-12-04T22:34:48Z","updatedAt":"2025-12-04T23:50:04Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1168#issuecomment-3614593318"},{"type":"issue_comment","id":3614657357,"prNumber":1168,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7cfgw92y12ndhj6a49ay8h3d7wndn2?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7cfgw92y12ndhj6a49ay8h3d7wndn2/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1168?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 5 screenshots for commit `8cae1a9` (2025-12-04 22:56:10.313 UTC).\n\n**Initial homepage load showing the same OpenAPI client error**\n\n![01-homepage-after-load.png](https://famous-camel-162.convex.cloud/api/storage/3c8fc759-4d65-4853-9bf9-6e879207b55c)\n\n![02-homepage-full-page.png](https://famous-camel-162.convex.cloud/api/storage/0737b9e5-eeb8-427d-a1af-b031380e7a2c)\n\n**App error screen - Unable to load due to missing OpenAPI client configuration \\(pre-existing issue, not related to VNC changes\\)**\n\n![app-main-view.png](https://famous-camel-162.convex.cloud/api/storage/54056e82-54f9-4547-bb0c-2eb999674bd5)\n\n![homepage-after-fix.png](https://famous-camel-162.convex.cloud/api/storage/31dfd3be-e0a6-415e-988d-1254be367666)\n\n**Homepage showing Vite error for missing OpenAPI client \\(pre-existing configuration issue\\)**\n\n![homepage-new.png](https://famous-camel-162.convex.cloud/api/storage/f70c1b99-afb2-494a-9963-c6d1d0f9d3bd)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"91aadb246182a2708e96fb9975e047090cbf8603","createdAt":"2025-12-04T22:56:11Z","updatedAt":"2025-12-04T23:49:15Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1168#issuecomment-3614657357"},{"type":"issue_comment","id":3614764194,"prNumber":1168,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7751dcvg2mta60aeqvyxnfth7wmxtv?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7751dcvg2mta60aeqvyxnfth7wmxtv/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1168?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"91aadb246182a2708e96fb9975e047090cbf8603","createdAt":"2025-12-04T23:49:14Z","updatedAt":"2025-12-05T00:22:30Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1168#issuecomment-3614764194"},{"type":"issue_comment","id":3614765633,"prNumber":1168,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.dev/manaflow/task/kn7c4yssb1ewnjp7h144s9nnc17wmrda?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.dev/manaflow/task/kn7c4yssb1ewnjp7h144s9nnc17wmrda/run/kd7arqtn5f3cqv4188jw447ndx7wma3m/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1168?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 6 screenshots for commit `ea9291a` (2025-12-04 23:50:02.269 UTC).\n\n**Browser tab showing the VNC viewer initial loading state with 'Launching browser preview' message**\n\n![browser-tab-loading-state.png](https://adorable-wombat-701.convex.cloud/api/storage/32d48a4b-2a77-46ca-afb2-8590f7c76ec2)\n\n**Browser tab with VNC viewer canvas rendered and overlay message still visible**\n\n![browser-tab-vnc-canvas-rendering.png](https://adorable-wombat-701.convex.cloud/api/storage/84e8e660-c7c0-4d81-bf75-83b05fd705ac)\n\n**Browser tab showing VNC viewer with 'Launching browser preview...' overlay message**\n\n![browser-tab-with-overlay-message.png](https://adorable-wombat-701.convex.cloud/api/storage/0e7fcf51-83d6-4954-9e83-300fc6335ac4)\n\n**Full page view of PR \\#1168 showing the diff summary and file changes list**\n\n![pr-1168-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/52f896fd-0fc4-4017-afdb-3cef018e391e)\n\n**PR diff view highlighting the new vnc-viewer.tsx component file \\(+1044 lines\\)**\n\n![pr-diff-vnc-viewer-file.png](https://adorable-wombat-701.convex.cloud/api/storage/42b752c3-d0a4-4903-8311-a74da3203c25)\n\n**Full task view showing the Browser tab with VNC viewer component in loading state**\n\n![task-view-with-browser-tab-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/fc5af1c3-0dbb-4e6d-9aaf-a7ad411fd648)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"91aadb246182a2708e96fb9975e047090cbf8603","createdAt":"2025-12-04T23:50:03Z","updatedAt":"2025-12-05T00:24:08Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1168#issuecomment-3614765633"},{"type":"issue_comment","id":3614833606,"prNumber":1168,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7cp8a772c7nnrmmzk9vc47zd7wqj8z?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7cp8a772c7nnrmmzk9vc47zd7wqj8z/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1168?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"91aadb246182a2708e96fb9975e047090cbf8603","createdAt":"2025-12-05T00:22:29Z","updatedAt":"2025-12-05T00:29:42Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1168#issuecomment-3614833606"},{"type":"issue_comment","id":3614836788,"prNumber":1168,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn75yf46neyzdk2za3r96yzy3n7wp60d?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn75yf46neyzdk2za3r96yzy3n7wp60d/run/kd7bjrb49tnpngfz96qfpn738h7wp495/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1168?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 6 screenshots for commit `759e058` (2025-12-05 00:24:06.194 UTC).\n\n**Code comparison showing the migration from iframe-based PersistentWebView to React-based VncViewer component with key improvements listed**\n\n![code-changes-comparison.png](https://adorable-wombat-701.convex.cloud/api/storage/ebd52070-d338-4fe3-8223-9bb8112442a6)\n\n**VNC Viewer connected state - shows black canvas area where the remote desktop would be displayed when successfully connected**\n\n![vnc-viewer-connected-state.png](https://adorable-wombat-701.convex.cloud/api/storage/95396fe6-6af4-4f15-8784-139599163c61)\n\n**VNC Viewer connection failed error state - shows red error icon with 'Connection failed' message, error details, and 'Retry connection' button**\n\n![vnc-viewer-connection-failed-error.png](https://adorable-wombat-701.convex.cloud/api/storage/a00fbaec-508a-428b-b341-e1949b0a89b6)\n\n**VNC Viewer loading state - shows spinner with 'Connecting...' message on black background**\n\n![vnc-viewer-loading-state.png](https://adorable-wombat-701.convex.cloud/api/storage/319442af-881b-43af-8514-c21da1523001)\n\n**VNC Viewer network offline error state - shows amber warning icon with 'Network offline' message and explanation that it will reconnect automatically**\n\n![vnc-viewer-network-offline-error.png](https://adorable-wombat-701.convex.cloud/api/storage/99cbae1d-34dc-4c9f-a37a-4bc80c18701b)\n\n**VNC Viewer reconnecting state - shows spinner with 'Reconnecting \\(3\\)...' message and error context 'Connection lost unexpectedly'**\n\n![vnc-viewer-reconnecting-state.png](https://adorable-wombat-701.convex.cloud/api/storage/701a2932-cd86-4006-b6d6-c93612bad767)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"91aadb246182a2708e96fb9975e047090cbf8603","createdAt":"2025-12-05T00:24:07Z","updatedAt":"2025-12-05T01:03:18Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1168#issuecomment-3614836788"},{"type":"issue_comment","id":3614847523,"prNumber":1168,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7bynn82vmkbxhy4g9vxhpedn7wp82w?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7bynn82vmkbxhy4g9vxhpedn7wp82w/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1168?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"91aadb246182a2708e96fb9975e047090cbf8603","createdAt":"2025-12-05T00:29:41Z","updatedAt":"2025-12-05T00:29:41Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1168#issuecomment-3614847523"},{"type":"issue_comment","id":3614905908,"prNumber":1168,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn72a3p3xsa809xeztaxjy01fn7wqx43?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.sh/manaflow/task/kn72a3p3xsa809xeztaxjy01fn7wqx43/run/kd7337vtqc1zpqta0azxmk6bx57wpjge/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1168?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"91aadb246182a2708e96fb9975e047090cbf8603","createdAt":"2025-12-05T01:03:17Z","updatedAt":"2025-12-05T01:03:17Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1168#issuecomment-3614905908"}]}
{"number":1166,"title":"Add subtle banner for cmux.dev; download open-source app","state":"open","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1166","headRef":"cmux/add-subtle-banner-for-cmux-dev-download-open-sourc-yjqjt","headSha":"f0f3339ec927a82ae27b67b020372bc44c8ad3e3","baseRef":"main","baseSha":"645d6206b23efeb9652d9463a885959878dfa5f9","createdAt":"2025-12-04T05:38:41Z","updatedAt":"2025-12-04T05:49:27Z","diff":"diff --git a/apps/client/src/components/WebAppBanner.tsx b/apps/client/src/components/WebAppBanner.tsx\nnew file mode 100644\nindex 000000000..26048c582\n--- /dev/null\n+++ b/apps/client/src/components/WebAppBanner.tsx\n@@ -0,0 +1,48 @@\n+import { isElectron } from \"@/lib/electron\";\n+import { X } from \"lucide-react\";\n+import { useState, useEffect } from \"react\";\n+\n+const BANNER_DISMISSED_KEY = \"cmux-web-banner-dismissed\";\n+\n+export function WebAppBanner() {\n+  const [isDismissed, setIsDismissed] = useState(() => {\n+    if (typeof window === \"undefined\") return true;\n+    return localStorage.getItem(BANNER_DISMISSED_KEY) === \"true\";\n+  });\n+\n+  useEffect(() => {\n+    if (isDismissed) {\n+      localStorage.setItem(BANNER_DISMISSED_KEY, \"true\");\n+    }\n+  }, [isDismissed]);\n+\n+  // Don't show in Electron app\n+  if (isElectron) return null;\n+\n+  // Don't show if dismissed\n+  if (isDismissed) return null;\n+\n+  return (\n+    <div className=\"bg-[#1e3a5f] text-white/90 text-xs py-1 px-3 flex items-center justify-center gap-2 shrink-0\">\n+      <span className=\"text-center\">\n+        cmux is open source.{\" \"}\n+        <a\n+          href=\"https://cmux.dev\"\n+          target=\"_blank\"\n+          rel=\"noopener noreferrer\"\n+          className=\"underline hover:text-white\"\n+        >\n+          Download the desktop app\n+        </a>{\" \"}\n+        for the best experience.\n+      </span>\n+      <button\n+        onClick={() => setIsDismissed(true)}\n+        className=\"ml-1 p-0.5 hover:bg-white/10 rounded transition-colors\"\n+        aria-label=\"Dismiss banner\"\n+      >\n+        <X className=\"w-3 h-3\" />\n+      </button>\n+    </div>\n+  );\n+}\ndiff --git a/apps/client/src/routes/_layout.$teamSlugOrId.tsx b/apps/client/src/routes/_layout.$teamSlugOrId.tsx\nindex 3a8b157c7..caed6d82a 100644\n--- a/apps/client/src/routes/_layout.$teamSlugOrId.tsx\n+++ b/apps/client/src/routes/_layout.$teamSlugOrId.tsx\n@@ -1,6 +1,7 @@\n import { CmuxComments } from \"@/components/cmux-comments\";\n import { CommandBar } from \"@/components/CommandBar\";\n import { Sidebar } from \"@/components/Sidebar\";\n+import { WebAppBanner } from \"@/components/WebAppBanner\";\n import { SIDEBAR_PRS_DEFAULT_LIMIT } from \"@/components/sidebar/const\";\n import { convexQueryClient } from \"@/contexts/convex/convex-query-client\";\n import { ExpandTasksProvider } from \"@/contexts/expand-tasks/ExpandTasksProvider\";\n@@ -75,14 +76,16 @@ function LayoutComponent() {\n     <ExpandTasksProvider>\n       <CommandBar teamSlugOrId={teamSlugOrId} />\n \n-      <div className=\"flex flex-row grow min-h-0 h-dvh bg-white dark:bg-black\">\n+      <div className=\"flex flex-col h-dvh bg-white dark:bg-black\">\n+        <WebAppBanner />\n+        <div className=\"flex flex-row grow min-h-0\">\n         <Sidebar tasks={displayTasks} teamSlugOrId={teamSlugOrId} />\n \n         {/* <div className=\"flex flex-col grow overflow-hidden bg-white dark:bg-neutral-950\"> */}\n         <Suspense fallback={<div>Loading...</div>}>\n           <Outlet />\n         </Suspense>\n-        {/* </div> */}\n+        </div>\n       </div>\n \n       <button\n","comments":[{"type":"issue_comment","id":3610392295,"prNumber":1166,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn78xx17str3ztytbpshvjm7g97wmbt0?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn78xx17str3ztytbpshvjm7g97wmbt0/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1166?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 13 screenshots for commit `f0f3339` (2025-12-04 05:49:25.855 UTC).\n\n![dashboard-full-page-with-banner.png](https://adorable-wombat-701.convex.cloud/api/storage/b51d705d-ede5-44ec-a8fa-2e1c5f797786)\n\n**Full-page screenshot of dashboard with banner**\n\n![dashboard-with-banner-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/0a07a5fa-ec0c-40d2-8413-319a842cec2c)\n\n**Dashboard page with the new banner displayed at the top - dark blue banner with text 'cmux is open source. Download the desktop app for the best experience.' and dismiss button**\n\n![dashboard-with-banner-viewport.png](https://adorable-wombat-701.convex.cloud/api/storage/3300eea0-97a9-4c2e-a9a4-f4c77d2e45e6)\n\n**Full-page screenshot of environments page with banner**\n\n![environments-page-with-banner-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/f4a12d53-6b3f-48fa-b0a0-d3fa5fb0fa1c)\n\n**Environments page showing the banner consistently across different pages**\n\n![environments-page-with-banner-viewport.png](https://adorable-wombat-701.convex.cloud/api/storage/11ea6029-ad4f-4d3a-8149-215ecebab7f3)\n\n**Full-page screenshot of home page with banner dismissed**\n\n![home-page-banner-dismissed-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/72a11a04-6e48-4e42-8511-f37bbb3be61b)\n\n**Home page after clicking the dismiss button - banner is no longer visible**\n\n![home-page-banner-dismissed-viewport.png](https://adorable-wombat-701.convex.cloud/api/storage/9231fa52-0151-4767-9881-a218473a3faf)\n\n**Full-page screenshot of home page with banner**\n\n![home-page-with-banner-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/5090d2f7-9daa-46d9-be75-3500f4ae7660)\n\n**Home page showing the banner at the top**\n\n![home-page-with-banner-viewport.png](https://adorable-wombat-701.convex.cloud/api/storage/8a6459e4-6f63-4a36-ae0c-5ed01e5fe1eb)\n\n**Full-page screenshot of settings page with banner in dark mode**\n\n![settings-page-dark-mode-with-banner-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/d64a03bb-fcc2-4bd1-8f62-9c9248cb0650)\n\n**Settings page with banner in dark mode - showing the banner works well in both light and dark themes**\n\n![settings-page-dark-mode-with-banner-viewport.png](https://adorable-wombat-701.convex.cloud/api/storage/12423536-ee03-4c55-bb98-75f5ad94febd)\n\n**Full-page screenshot of settings page with banner in light mode**\n\n![settings-page-with-banner-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/c2707805-f34d-4b4e-b5d6-1a97aaadfe1f)\n\n**Settings page with banner in light mode**\n\n![settings-page-with-banner-viewport.png](https://adorable-wombat-701.convex.cloud/api/storage/768100d4-301d-4bb9-8e27-0a409aef3964)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"f0f3339ec927a82ae27b67b020372bc44c8ad3e3","createdAt":"2025-12-04T05:49:27Z","updatedAt":"2025-12-04T05:49:27Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1166#issuecomment-3610392295"}]}
{"number":1165,"title":"Hide build agent by default in VSCode","state":"open","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1165","headRef":"cmux/hide-build-agent-by-default-in-vs-code-on1zc","headSha":"32cab640c4ab7f4c67c1a4513f28e15079a6eb55","baseRef":"main","baseSha":"645d6206b23efeb9652d9463a885959878dfa5f9","createdAt":"2025-12-04T05:38:12Z","updatedAt":"2025-12-04T06:01:15Z","diff":"diff --git a/configs/systemd/bin/configure-openvscode b/configs/systemd/bin/configure-openvscode\nindex c6b347708..143a3dd50 100755\n--- a/configs/systemd/bin/configure-openvscode\n+++ b/configs/systemd/bin/configure-openvscode\n@@ -20,6 +20,7 @@ SETTINGS=$(jq -n \\\n   --arg theme \"$color\" \\\n   '{\n     \"workbench.startupEditor\": \"none\",\n+    \"workbench.secondarySideBar.visible\": false,\n     \"terminal.integrated.shellIntegration.enabled\": false,\n     \"terminal.integrated.macOptionClickForcesSelection\": true,\n     \"terminal.integrated.shell.linux\": \"/usr/bin/zsh\",\n","comments":[{"type":"issue_comment","id":3610371114,"prNumber":1165,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn73bcx6gvrqpbg5n6es2c0ysh7wna52?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn73bcx6gvrqpbg5n6es2c0ysh7wna52/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1165?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 4 screenshots for commit `32cab64` (2025-12-04 05:43:14.556 UTC).\n\n**Close-up view showing the 'Build with Agent' panel in the secondary sidebar when visible**\n\n![build-agent-panel-detail.png](https://famous-camel-162.convex.cloud/api/storage/360c6411-380a-437c-9a0d-e778e0a6bfef)\n\n**VS Code toolbar showing the toggle button for the secondary sidebar \\(users can still show/hide it manually with Ctrl+Alt+B\\)**\n\n![toolbar-with-secondary-sidebar-toggle.png](https://famous-camel-162.convex.cloud/api/storage/d59587c8-2c19-4c24-a9b8-1cbe25a1269a)\n\n**VS Code interface with the secondary sidebar hidden, providing more screen space for the editor and terminal \\(new default behavior after this PR\\)**\n\n![vscode-with-secondary-sidebar-hidden.png](https://famous-camel-162.convex.cloud/api/storage/8761b72e-54de-4a1a-ae2a-c5b9624a6d9a)\n\n**VS Code interface with the secondary sidebar visible, showing the 'Build with Agent' panel on the right side \\(old behavior\\)**\n\n![vscode-with-secondary-sidebar-visible.png](https://famous-camel-162.convex.cloud/api/storage/a11ad13f-fee1-4314-82b9-03529cf4dafb)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"32cab640c4ab7f4c67c1a4513f28e15079a6eb55","createdAt":"2025-12-04T05:43:15Z","updatedAt":"2025-12-04T05:43:15Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1165#issuecomment-3610371114"}]}
{"number":1164,"title":"Upgrade React and Next.js to latest","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1164","headRef":"cmux/upgrade-react-and-next-js-to-latest-d4fnm","headSha":"600622ff6685fbec5854fb26d9c9ee769d1eb8ab","baseRef":"main","baseSha":"645d6206b23efeb9652d9463a885959878dfa5f9","createdAt":"2025-12-04T05:31:44Z","updatedAt":"2025-12-04T06:18:11Z","diff":"diff --git a/apps/client/package.json b/apps/client/package.json\nindex 07049ce73..0d8c6f01c 100644\n--- a/apps/client/package.json\n+++ b/apps/client/package.json\n@@ -133,9 +133,9 @@\n     \"node-forge\": \"^1.3.1\",\n     \"posthog-js\": \"^1.297.2\",\n     \"prismjs\": \"^1.30.0\",\n-    \"react\": \"^19.1.0\",\n+    \"react\": \"^19.2.0\",\n     \"react-aria-components\": \"^1.12.1\",\n-    \"react-dom\": \"^19.1.0\",\n+    \"react-dom\": \"^19.2.0\",\n     \"react-markdown\": \"^10.1.0\",\n     \"react-textarea-autosize\": \"^8.5.9\",\n     \"remark-gfm\": \"^4.0.1\",\n@@ -168,8 +168,8 @@\n     \"@types/node\": \"^24.9.1\",\n     \"@types/node-forge\": \"^1.3.14\",\n     \"@types/prismjs\": \"^1.26.5\",\n-    \"@types/react\": \"^19.1.8\",\n-    \"@types/react-dom\": \"^19.1.6\",\n+    \"@types/react\": \"^19.2.0\",\n+    \"@types/react-dom\": \"^19.2.0\",\n     \"@types/semver\": \"^7.7.1\",\n     \"@vitejs/plugin-react\": \"^4.5.2\",\n     \"electron\": \"38.0.0\",\ndiff --git a/apps/preview-proxy/package.json b/apps/preview-proxy/package.json\nindex 7586e580b..8efbc7072 100644\n--- a/apps/preview-proxy/package.json\n+++ b/apps/preview-proxy/package.json\n@@ -13,8 +13,8 @@\n     \"bun-plugin-tailwind\": \"^0.0.15\",\n     \"convex\": \"1.29.3\",\n     \"lucide-react\": \"^0.540.0\",\n-    \"react\": \"^19.1.0\",\n-    \"react-dom\": \"^19.1.0\",\n+    \"react\": \"^19.2.0\",\n+    \"react-dom\": \"^19.2.0\",\n     \"tailwindcss\": \"^4.1.11\",\n     \"xpath-generator\": \"^1.1.0\"\n   },\ndiff --git a/apps/www/package.json b/apps/www/package.json\nindex 39afe98bd..4e92a5a4f 100644\n--- a/apps/www/package.json\n+++ b/apps/www/package.json\n@@ -50,13 +50,13 @@\n     \"jose\": \"^6.1.0\",\n     \"lucide-react\": \"^0.460.0\",\n     \"morphcloud\": \"^0.0.18\",\n-    \"next\": \"^16.0.5\",\n+    \"next\": \"^16.0.7\",\n     \"octokit\": \"^3.2.2\",\n     \"posthog-js\": \"^1.297.2\",\n     \"posthog-node\": \"^5.11.0\",\n-    \"react\": \"^19.1.0\",\n+    \"react\": \"^19.2.0\",\n     \"react-diff-view\": \"^3.3.2\",\n-    \"react-dom\": \"^19.1.0\",\n+    \"react-dom\": \"^19.2.0\",\n     \"refractor\": \"^5.0.0\",\n     \"socket.io-client\": \"^4.8.1\",\n     \"tailwind-merge\": \"^2.5.5\",\n@@ -67,7 +67,7 @@\n     \"@eslint/eslintrc\": \"^3\",\n     \"@hey-api/client-fetch\": \"^0.13.1\",\n     \"@hey-api/openapi-ts\": \"^0.82.1\",\n-    \"@next/eslint-plugin-next\": \"^16.0.5\",\n+    \"@next/eslint-plugin-next\": \"^16.0.7\",\n     \"@tailwindcss/postcss\": \"^4\",\n     \"@types/node\": \"^24.9.1\",\n     \"@types/react\": \"^19\",\n@@ -75,7 +75,7 @@\n     \"dotenv\": \"^16.4.5\",\n     \"dotenv-cli\": \"^10.0.0\",\n     \"eslint\": \"^9.33.0\",\n-    \"eslint-config-next\": \"^16.0.5\",\n+    \"eslint-config-next\": \"^16.0.7\",\n     \"tailwindcss\": \"^4\",\n     \"typescript\": \"^5.9.3\",\n     \"typescript-eslint\": \"^8.38.0\",\ndiff --git a/bun.lock b/bun.lock\nindex 27489d149..02f62cc6f 100644\n--- a/bun.lock\n+++ b/bun.lock\n@@ -139,9 +139,9 @@\n         \"node-forge\": \"^1.3.1\",\n         \"posthog-js\": \"^1.297.2\",\n         \"prismjs\": \"^1.30.0\",\n-        \"react\": \"^19.1.0\",\n+        \"react\": \"^19.2.0\",\n         \"react-aria-components\": \"^1.12.1\",\n-        \"react-dom\": \"^19.1.0\",\n+        \"react-dom\": \"^19.2.0\",\n         \"react-markdown\": \"^10.1.0\",\n         \"react-textarea-autosize\": \"^8.5.9\",\n         \"remark-gfm\": \"^4.0.1\",\n@@ -174,8 +174,8 @@\n         \"@types/node\": \"^24.9.1\",\n         \"@types/node-forge\": \"^1.3.14\",\n         \"@types/prismjs\": \"^1.26.5\",\n-        \"@types/react\": \"^19.1.8\",\n-        \"@types/react-dom\": \"^19.1.6\",\n+        \"@types/react\": \"^19.2.0\",\n+        \"@types/react-dom\": \"^19.2.0\",\n         \"@types/semver\": \"^7.7.1\",\n         \"@vitejs/plugin-react\": \"^4.5.2\",\n         \"electron\": \"38.0.0\",\n@@ -211,8 +211,8 @@\n         \"bun-plugin-tailwind\": \"^0.0.15\",\n         \"convex\": \"1.29.3\",\n         \"lucide-react\": \"^0.540.0\",\n-        \"react\": \"^19.1.0\",\n-        \"react-dom\": \"^19.1.0\",\n+        \"react\": \"^19.2.0\",\n+        \"react-dom\": \"^19.2.0\",\n         \"tailwindcss\": \"^4.1.11\",\n         \"xpath-generator\": \"^1.1.0\",\n       },\n@@ -341,13 +341,13 @@\n         \"jose\": \"^6.1.0\",\n         \"lucide-react\": \"^0.460.0\",\n         \"morphcloud\": \"^0.0.18\",\n-        \"next\": \"^16.0.5\",\n+        \"next\": \"^16.0.7\",\n         \"octokit\": \"^3.2.2\",\n         \"posthog-js\": \"^1.297.2\",\n         \"posthog-node\": \"^5.11.0\",\n-        \"react\": \"^19.1.0\",\n+        \"react\": \"^19.2.0\",\n         \"react-diff-view\": \"^3.3.2\",\n-        \"react-dom\": \"^19.1.0\",\n+        \"react-dom\": \"^19.2.0\",\n         \"refractor\": \"^5.0.0\",\n         \"socket.io-client\": \"^4.8.1\",\n         \"tailwind-merge\": \"^2.5.5\",\n@@ -358,7 +358,7 @@\n         \"@eslint/eslintrc\": \"^3\",\n         \"@hey-api/client-fetch\": \"^0.13.1\",\n         \"@hey-api/openapi-ts\": \"^0.82.1\",\n-        \"@next/eslint-plugin-next\": \"^16.0.5\",\n+        \"@next/eslint-plugin-next\": \"^16.0.7\",\n         \"@tailwindcss/postcss\": \"^4\",\n         \"@types/node\": \"^24.9.1\",\n         \"@types/react\": \"^19\",\n@@ -366,7 +366,7 @@\n         \"dotenv\": \"^16.4.5\",\n         \"dotenv-cli\": \"^10.0.0\",\n         \"eslint\": \"^9.33.0\",\n-        \"eslint-config-next\": \"^16.0.5\",\n+        \"eslint-config-next\": \"^16.0.7\",\n         \"tailwindcss\": \"^4\",\n         \"typescript\": \"^5.9.3\",\n         \"typescript-eslint\": \"^8.38.0\",\n@@ -530,8 +530,8 @@\n     \"convex\": \"1.29.3\",\n     \"monaco-editor\": \"^0.53.0\",\n     \"node-abi\": \"^4.14.0\",\n-    \"react\": \"^19.1.0\",\n-    \"react-dom\": \"^19.1.0\",\n+    \"react\": \"^19.2.0\",\n+    \"react-dom\": \"^19.2.0\",\n   },\n   \"packages\": {\n     \"7zip-bin\": [\"7zip-bin@5.2.0\", \"\", {}, \"sha512-ukTPVhqG4jNzMro2qA9HSCSSVJN3aN7tlb+hfqYCt3ER0yWroeA2VR38MNrOHLQ/cVj+DaIMad0kFCtWWowh/A==\"],\n@@ -1350,25 +1350,25 @@\n \n     \"@napi-rs/wasm-runtime\": [\"@napi-rs/wasm-runtime@1.0.5\", \"\", { \"dependencies\": { \"@emnapi/core\": \"^1.5.0\", \"@emnapi/runtime\": \"^1.5.0\", \"@tybys/wasm-util\": \"^0.10.1\" } }, \"sha512-TBr9Cf9onSAS2LQ2+QHx6XcC6h9+RIzJgbqG3++9TUZSH204AwEy5jg3BTQ0VATsyoGj4ee49tN/y6rvaOOtcg==\"],\n \n-    \"@next/env\": [\"@next/env@16.0.5\", \"\", {}, \"sha512-jRLOw822AE6aaIm9oh0NrauZEM0Vtx5xhYPgqx89txUmv/UmcRwpcXmGeQOvYNT/1bakUwA+nG5CA74upYVVDw==\"],\n+    \"@next/env\": [\"@next/env@16.0.7\", \"\", {}, \"sha512-gpaNgUh5nftFKRkRQGnVi5dpcYSKGcZZkQffZ172OrG/XkrnS7UBTQ648YY+8ME92cC4IojpI2LqTC8sTDhAaw==\"],\n \n-    \"@next/eslint-plugin-next\": [\"@next/eslint-plugin-next@16.0.5\", \"\", { \"dependencies\": { \"fast-glob\": \"3.3.1\" } }, \"sha512-m1zPz6hsBvQt1CMRz7rTga8OXpRE9rVW4JHCSjW+tswTxiEU+6ev+GTlgm7ZzcCiMEVQAHTNhpEGFzDtVha9qg==\"],\n+    \"@next/eslint-plugin-next\": [\"@next/eslint-plugin-next@16.0.7\", \"\", { \"dependencies\": { \"fast-glob\": \"3.3.1\" } }, \"sha512-hFrTNZcMEG+k7qxVxZJq3F32Kms130FAhG8lvw2zkKBgAcNOJIxlljNiCjGygvBshvaGBdf88q2CqWtnqezDHA==\"],\n \n-    \"@next/swc-darwin-arm64\": [\"@next/swc-darwin-arm64@16.0.5\", \"\", { \"os\": \"darwin\", \"cpu\": \"arm64\" }, \"sha512-65Mfo1rD+mVbJuBTlXbNelNOJ5ef+5pskifpFHsUt3cnOWjDNKctHBwwSz9tJlPp7qADZtiN/sdcG7mnc0El8Q==\"],\n+    \"@next/swc-darwin-arm64\": [\"@next/swc-darwin-arm64@16.0.7\", \"\", { \"os\": \"darwin\", \"cpu\": \"arm64\" }, \"sha512-LlDtCYOEj/rfSnEn/Idi+j1QKHxY9BJFmxx7108A6D8K0SB+bNgfYQATPk/4LqOl4C0Wo3LACg2ie6s7xqMpJg==\"],\n \n-    \"@next/swc-darwin-x64\": [\"@next/swc-darwin-x64@16.0.5\", \"\", { \"os\": \"darwin\", \"cpu\": \"x64\" }, \"sha512-2fDzXD/JpEjY500VUF0uuGq3YZcpC6XxmGabePPLyHCKbw/YXRugv3MRHH7MxE2hVHtryXeSYYnxcESb/3OUIQ==\"],\n+    \"@next/swc-darwin-x64\": [\"@next/swc-darwin-x64@16.0.7\", \"\", { \"os\": \"darwin\", \"cpu\": \"x64\" }, \"sha512-rtZ7BhnVvO1ICf3QzfW9H3aPz7GhBrnSIMZyr4Qy6boXF0b5E3QLs+cvJmg3PsTCG2M1PBoC+DANUi4wCOKXpA==\"],\n \n-    \"@next/swc-linux-arm64-gnu\": [\"@next/swc-linux-arm64-gnu@16.0.5\", \"\", { \"os\": \"linux\", \"cpu\": \"arm64\" }, \"sha512-meSLB52fw4tgDpPnyuhwA280EWLwwIntrxLYjzKU3e3730ur2WJAmmqoZ1LPIZ2l3eDfh9SBHnJGTczbgPeNeA==\"],\n+    \"@next/swc-linux-arm64-gnu\": [\"@next/swc-linux-arm64-gnu@16.0.7\", \"\", { \"os\": \"linux\", \"cpu\": \"arm64\" }, \"sha512-mloD5WcPIeIeeZqAIP5c2kdaTa6StwP4/2EGy1mUw8HiexSHGK/jcM7lFuS3u3i2zn+xH9+wXJs6njO7VrAqww==\"],\n \n-    \"@next/swc-linux-arm64-musl\": [\"@next/swc-linux-arm64-musl@16.0.5\", \"\", { \"os\": \"linux\", \"cpu\": \"arm64\" }, \"sha512-aAJtQkvUzz5t0xVAmK931SIhWnSQAaEoTyG/sKPCYq2u835K/E4a14A+WRPd4dkhxIHNudE8dI+FpHekgdrA4g==\"],\n+    \"@next/swc-linux-arm64-musl\": [\"@next/swc-linux-arm64-musl@16.0.7\", \"\", { \"os\": \"linux\", \"cpu\": \"arm64\" }, \"sha512-+ksWNrZrthisXuo9gd1XnjHRowCbMtl/YgMpbRvFeDEqEBd523YHPWpBuDjomod88U8Xliw5DHhekBC3EOOd9g==\"],\n \n-    \"@next/swc-linux-x64-gnu\": [\"@next/swc-linux-x64-gnu@16.0.5\", \"\", { \"os\": \"linux\", \"cpu\": \"x64\" }, \"sha512-bYwbjBwooMWRhy6vRxenaYdguTM2hlxFt1QBnUF235zTnU2DhGpETm5WU93UvtAy0uhC5Kgqsl8RyNXlprFJ6Q==\"],\n+    \"@next/swc-linux-x64-gnu\": [\"@next/swc-linux-x64-gnu@16.0.7\", \"\", { \"os\": \"linux\", \"cpu\": \"x64\" }, \"sha512-4WtJU5cRDxpEE44Ana2Xro1284hnyVpBb62lIpU5k85D8xXxatT+rXxBgPkc7C1XwkZMWpK5rXLXTh9PFipWsA==\"],\n \n-    \"@next/swc-linux-x64-musl\": [\"@next/swc-linux-x64-musl@16.0.5\", \"\", { \"os\": \"linux\", \"cpu\": \"x64\" }, \"sha512-iGv2K/4gW3mkzh+VcZTf2gEGX5o9xdb5oPqHjgZvHdVzCw0iSAJ7n9vKzl3SIEIIHZmqRsgNasgoLd0cxaD+tg==\"],\n+    \"@next/swc-linux-x64-musl\": [\"@next/swc-linux-x64-musl@16.0.7\", \"\", { \"os\": \"linux\", \"cpu\": \"x64\" }, \"sha512-HYlhqIP6kBPXalW2dbMTSuB4+8fe+j9juyxwfMwCe9kQPPeiyFn7NMjNfoFOfJ2eXkeQsoUGXg+O2SE3m4Qg2w==\"],\n \n-    \"@next/swc-win32-arm64-msvc\": [\"@next/swc-win32-arm64-msvc@16.0.5\", \"\", { \"os\": \"win32\", \"cpu\": \"arm64\" }, \"sha512-6xf52Hp4SH9+4jbYmfUleqkuxvdB9JJRwwFlVG38UDuEGPqpIA+0KiJEU9lxvb0RGNo2i2ZUhc5LHajij9H9+A==\"],\n+    \"@next/swc-win32-arm64-msvc\": [\"@next/swc-win32-arm64-msvc@16.0.7\", \"\", { \"os\": \"win32\", \"cpu\": \"arm64\" }, \"sha512-EviG+43iOoBRZg9deGauXExjRphhuYmIOJ12b9sAPy0eQ6iwcPxfED2asb/s2/yiLYOdm37kPaiZu8uXSYPs0Q==\"],\n \n-    \"@next/swc-win32-x64-msvc\": [\"@next/swc-win32-x64-msvc@16.0.5\", \"\", { \"os\": \"win32\", \"cpu\": \"x64\" }, \"sha512-06kTaOh+Qy/kguN+MMK+/VtKmRkQJrPlGQMvCUbABk1UxI5SKTgJhbmMj9Hf0qWwrS6g9JM6/Zk+etqeMyvHAw==\"],\n+    \"@next/swc-win32-x64-msvc\": [\"@next/swc-win32-x64-msvc@16.0.7\", \"\", { \"os\": \"win32\", \"cpu\": \"x64\" }, \"sha512-gniPjy55zp5Eg0896qSrf3yB1dw4F/3s8VK1ephdsZZ129j2n6e1WqCbE2YgcKhW9hPB9TVZENugquWJD5x0ug==\"],\n \n     \"@noble/hashes\": [\"@noble/hashes@2.0.1\", \"\", {}, \"sha512-XlOlEbQcE9fmuXxrVTXCTlG2nlRXa9Rj3rr5Ue/+tX+nmkgbX720YHh0VR3hBF9xDvwnb8D2shVGOwNx+ulArw==\"],\n \n@@ -2438,9 +2438,9 @@\n \n     \"@types/range-parser\": [\"@types/range-parser@1.2.7\", \"\", {}, \"sha512-hKormJbkJqzQGhziax5PItDUTMAM9uE2XXQmM37dyd4hVM+5aVl7oVxMVUiVQn2oCQFN/LKCZdvSM0pFRqbSmQ==\"],\n \n-    \"@types/react\": [\"@types/react@19.1.13\", \"\", { \"dependencies\": { \"csstype\": \"^3.0.2\" } }, \"sha512-hHkbU/eoO3EG5/MZkuFSKmYqPbSVk5byPFa3e7y/8TybHiLMACgI8seVYlicwk7H5K/rI2px9xrQp/C+AUDTiQ==\"],\n+    \"@types/react\": [\"@types/react@19.2.7\", \"\", { \"dependencies\": { \"csstype\": \"^3.2.2\" } }, \"sha512-MWtvHrGZLFttgeEj28VXHxpmwYbor/ATPYbBfSFZEIRK0ecCFLl2Qo55z52Hss+UV9CRN7trSeq1zbgx7YDWWg==\"],\n \n-    \"@types/react-dom\": [\"@types/react-dom@19.1.9\", \"\", { \"peerDependencies\": { \"@types/react\": \"^19.0.0\" } }, \"sha512-qXRuZaOsAdXKFyOhRBg6Lqqc0yay13vN7KrIg4L7N4aaHN68ma9OK3NE1BoDFgFOTfM7zg+3/8+2n8rLUH3OKQ==\"],\n+    \"@types/react-dom\": [\"@types/react-dom@19.2.3\", \"\", { \"peerDependencies\": { \"@types/react\": \"^19.2.0\" } }, \"sha512-jp2L/eY6fn+KgVVQAOqYItbF0VY/YApe5Mz2F0aykSO8gx31bYCZyvSeYxCHKvzHG5eZjc+zyaS5BrBWya2+kQ==\"],\n \n     \"@types/readdir-glob\": [\"@types/readdir-glob@1.1.5\", \"\", { \"dependencies\": { \"@types/node\": \"*\" } }, \"sha512-raiuEPUYqXu+nvtY2Pe8s8FEmZ3x5yAH4VkLdihcPdalvsHltomrRC9BzuStrJ9yk06470hS0Crw0f1pXqD+Hg==\"],\n \n@@ -3022,7 +3022,7 @@\n \n     \"css-what\": [\"css-what@2.1.3\", \"\", {}, \"sha512-a+EPoD+uZiNfh+5fxw2nO9QwFa6nJe2Or35fGY6Ipw1R3R4AGz1d1TEZrCegvw2YTmZ0jXirGYlzxxpYSHwpEg==\"],\n \n-    \"csstype\": [\"csstype@3.1.3\", \"\", {}, \"sha512-M1uQkMl8rQK/szD0LNhtqxIPLpimGm8sOBwU7lLnCpSbTyY3yeU1Vc7l4KT5zT4s/yOxHH5O7tIuuLOCnLADRw==\"],\n+    \"csstype\": [\"csstype@3.2.3\", \"\", {}, \"sha512-z1HGKcYy2xA8AGQfwrn0PAy+PB7X/GSj3UVJW9qKyn43xWa+gl5nXmU4qqLMRzWVLFC8KusUX8T/0kCiOYpAIQ==\"],\n \n     \"damerau-levenshtein\": [\"damerau-levenshtein@1.0.8\", \"\", {}, \"sha512-sdQSFB7+llfUcQHUQO3+B8ERRj0Oa4w9POWMI/puGtuf7gFywGmkaLCElnudfTiKZV+NvHqL0ifzdrI8Ro7ESA==\"],\n \n@@ -3232,7 +3232,7 @@\n \n     \"eslint\": [\"eslint@9.36.0\", \"\", { \"dependencies\": { \"@eslint-community/eslint-utils\": \"^4.8.0\", \"@eslint-community/regexpp\": \"^4.12.1\", \"@eslint/config-array\": \"^0.21.0\", \"@eslint/config-helpers\": \"^0.3.1\", \"@eslint/core\": \"^0.15.2\", \"@eslint/eslintrc\": \"^3.3.1\", \"@eslint/js\": \"9.36.0\", \"@eslint/plugin-kit\": \"^0.3.5\", \"@humanfs/node\": \"^0.16.6\", \"@humanwhocodes/module-importer\": \"^1.0.1\", \"@humanwhocodes/retry\": \"^0.4.2\", \"@types/estree\": \"^1.0.6\", \"@types/json-schema\": \"^7.0.15\", \"ajv\": \"^6.12.4\", \"chalk\": \"^4.0.0\", \"cross-spawn\": \"^7.0.6\", \"debug\": \"^4.3.2\", \"escape-string-regexp\": \"^4.0.0\", \"eslint-scope\": \"^8.4.0\", \"eslint-visitor-keys\": \"^4.2.1\", \"espree\": \"^10.4.0\", \"esquery\": \"^1.5.0\", \"esutils\": \"^2.0.2\", \"fast-deep-equal\": \"^3.1.3\", \"file-entry-cache\": \"^8.0.0\", \"find-up\": \"^5.0.0\", \"glob-parent\": \"^6.0.2\", \"ignore\": \"^5.2.0\", \"imurmurhash\": \"^0.1.4\", \"is-glob\": \"^4.0.0\", \"json-stable-stringify-without-jsonify\": \"^1.0.1\", \"lodash.merge\": \"^4.6.2\", \"minimatch\": \"^3.1.2\", \"natural-compare\": \"^1.4.0\", \"optionator\": \"^0.9.3\" }, \"peerDependencies\": { \"jiti\": \"*\" }, \"optionalPeers\": [\"jiti\"], \"bin\": { \"eslint\": \"bin/eslint.js\" } }, \"sha512-hB4FIzXovouYzwzECDcUkJ4OcfOEkXTv2zRY6B9bkwjx/cprAq0uvm1nl7zvQ0/TsUk0zQiN4uPfJpB9m+rPMQ==\"],\n \n-    \"eslint-config-next\": [\"eslint-config-next@16.0.5\", \"\", { \"dependencies\": { \"@next/eslint-plugin-next\": \"16.0.5\", \"eslint-import-resolver-node\": \"^0.3.6\", \"eslint-import-resolver-typescript\": \"^3.5.2\", \"eslint-plugin-import\": \"^2.32.0\", \"eslint-plugin-jsx-a11y\": \"^6.10.0\", \"eslint-plugin-react\": \"^7.37.0\", \"eslint-plugin-react-hooks\": \"^7.0.0\", \"globals\": \"16.4.0\", \"typescript-eslint\": \"^8.46.0\" }, \"peerDependencies\": { \"eslint\": \">=9.0.0\", \"typescript\": \">=3.3.1\" }, \"optionalPeers\": [\"typescript\"] }, \"sha512-9rBjZ/biSpolkIUiqvx/iwJJaz8sxJ6pKWSPptJenpj01HlWbCDeaA1v0yG3a71IIPMplxVCSXhmtP27SXqMdg==\"],\n+    \"eslint-config-next\": [\"eslint-config-next@16.0.7\", \"\", { \"dependencies\": { \"@next/eslint-plugin-next\": \"16.0.7\", \"eslint-import-resolver-node\": \"^0.3.6\", \"eslint-import-resolver-typescript\": \"^3.5.2\", \"eslint-plugin-import\": \"^2.32.0\", \"eslint-plugin-jsx-a11y\": \"^6.10.0\", \"eslint-plugin-react\": \"^7.37.0\", \"eslint-plugin-react-hooks\": \"^7.0.0\", \"globals\": \"16.4.0\", \"typescript-eslint\": \"^8.46.0\" }, \"peerDependencies\": { \"eslint\": \">=9.0.0\", \"typescript\": \">=3.3.1\" }, \"optionalPeers\": [\"typescript\"] }, \"sha512-WubFGLFHfk2KivkdRGfx6cGSFhaQqhERRfyO8BRx+qiGPGp7WLKcPvYC4mdx1z3VhVRcrfFzczjjTrbJZOpnEQ==\"],\n \n     \"eslint-import-resolver-node\": [\"eslint-import-resolver-node@0.3.9\", \"\", { \"dependencies\": { \"debug\": \"^3.2.7\", \"is-core-module\": \"^2.13.0\", \"resolve\": \"^1.22.4\" } }, \"sha512-WFj2isz22JahUv+B788TlO3N6zL3nNJGU8CcZbPZvVEkBPaJdCV4vy5wyghty5ROFbCRnm132v8BScu5/1BQ8g==\"],\n \n@@ -4032,7 +4032,7 @@\n \n     \"neo-async\": [\"neo-async@2.6.2\", \"\", {}, \"sha512-Yd3UES5mWCSqR+qNT93S3UoYUkqAZ9lLg8a7g9rimsWmYGK8cVToA4/sF3RrshdyV3sAGMXVUmpMYOw+dLpOuw==\"],\n \n-    \"next\": [\"next@16.0.5\", \"\", { \"dependencies\": { \"@next/env\": \"16.0.5\", \"@swc/helpers\": \"0.5.15\", \"caniuse-lite\": \"^1.0.30001579\", \"postcss\": \"8.4.31\", \"styled-jsx\": \"5.1.6\" }, \"optionalDependencies\": { \"@next/swc-darwin-arm64\": \"16.0.5\", \"@next/swc-darwin-x64\": \"16.0.5\", \"@next/swc-linux-arm64-gnu\": \"16.0.5\", \"@next/swc-linux-arm64-musl\": \"16.0.5\", \"@next/swc-linux-x64-gnu\": \"16.0.5\", \"@next/swc-linux-x64-musl\": \"16.0.5\", \"@next/swc-win32-arm64-msvc\": \"16.0.5\", \"@next/swc-win32-x64-msvc\": \"16.0.5\", \"sharp\": \"^0.34.4\" }, \"peerDependencies\": { \"@opentelemetry/api\": \"^1.1.0\", \"@playwright/test\": \"^1.51.1\", \"babel-plugin-react-compiler\": \"*\", \"react\": \"^18.2.0 || 19.0.0-rc-de68d2f4-20241204 || ^19.0.0\", \"react-dom\": \"^18.2.0 || 19.0.0-rc-de68d2f4-20241204 || ^19.0.0\", \"sass\": \"^1.3.0\" }, \"optionalPeers\": [\"@opentelemetry/api\", \"@playwright/test\", \"babel-plugin-react-compiler\", \"sass\"], \"bin\": { \"next\": \"dist/bin/next\" } }, \"sha512-XUPsFqSqu/NDdPfn/cju9yfIedkDI7ytDoALD9todaSMxk1Z5e3WcbUjfI9xsanFTys7xz62lnRWNFqJordzkQ==\"],\n+    \"next\": [\"next@16.0.7\", \"\", { \"dependencies\": { \"@next/env\": \"16.0.7\", \"@swc/helpers\": \"0.5.15\", \"caniuse-lite\": \"^1.0.30001579\", \"postcss\": \"8.4.31\", \"styled-jsx\": \"5.1.6\" }, \"optionalDependencies\": { \"@next/swc-darwin-arm64\": \"16.0.7\", \"@next/swc-darwin-x64\": \"16.0.7\", \"@next/swc-linux-arm64-gnu\": \"16.0.7\", \"@next/swc-linux-arm64-musl\": \"16.0.7\", \"@next/swc-linux-x64-gnu\": \"16.0.7\", \"@next/swc-linux-x64-musl\": \"16.0.7\", \"@next/swc-win32-arm64-msvc\": \"16.0.7\", \"@next/swc-win32-x64-msvc\": \"16.0.7\", \"sharp\": \"^0.34.4\" }, \"peerDependencies\": { \"@opentelemetry/api\": \"^1.1.0\", \"@playwright/test\": \"^1.51.1\", \"babel-plugin-react-compiler\": \"*\", \"react\": \"^18.2.0 || 19.0.0-rc-de68d2f4-20241204 || ^19.0.0\", \"react-dom\": \"^18.2.0 || 19.0.0-rc-de68d2f4-20241204 || ^19.0.0\", \"sass\": \"^1.3.0\" }, \"optionalPeers\": [\"@opentelemetry/api\", \"@playwright/test\", \"babel-plugin-react-compiler\", \"sass\"], \"bin\": { \"next\": \"dist/bin/next\" } }, \"sha512-3mBRJyPxT4LOxAJI6IsXeFtKfiJUbjCLgvXO02fV8Wy/lIhPvP94Fe7dGhUgHXcQy4sSuYwQNcOLhIfOm0rL0A==\"],\n \n     \"nice-try\": [\"nice-try@1.0.5\", \"\", {}, \"sha512-1nh45deeb5olNY7eX82BkPO7SSxR5SSYJiPTrTdFUVYwAl8CKMA5N9PjTYkHiRjisVcxcQ1HXdLhx2qxxJzLNQ==\"],\n \n@@ -4370,7 +4370,7 @@\n \n     \"rc9\": [\"rc9@2.1.2\", \"\", { \"dependencies\": { \"defu\": \"^6.1.4\", \"destr\": \"^2.0.3\" } }, \"sha512-btXCnMmRIBINM2LDZoEmOogIZU7Qe7zn4BpomSKZ/ykbLObuBdvG+mFq11DL6fjH1DRwHhrlgtYWG96bJiC7Cg==\"],\n \n-    \"react\": [\"react@19.1.1\", \"\", {}, \"sha512-w8nqGImo45dmMIfljjMwOGtbmC/mk4CMYhWIicdSflH91J9TyCyczcPFXJzrZ/ZXcgGRFeP6BU0BEJTw6tZdfQ==\"],\n+    \"react\": [\"react@19.2.1\", \"\", {}, \"sha512-DGrYcCWK7tvYMnWh79yrPHt+vdx9tY+1gPZa7nJQtO/p8bLTDaHp4dzwEhQB7pZ4Xe3ok4XKuEPrVuc+wlpkmw==\"],\n \n     \"react-aria\": [\"react-aria@3.43.2\", \"\", { \"dependencies\": { \"@internationalized/string\": \"^3.2.7\", \"@react-aria/breadcrumbs\": \"^3.5.28\", \"@react-aria/button\": \"^3.14.1\", \"@react-aria/calendar\": \"^3.9.1\", \"@react-aria/checkbox\": \"^3.16.1\", \"@react-aria/color\": \"^3.1.1\", \"@react-aria/combobox\": \"^3.13.2\", \"@react-aria/datepicker\": \"^3.15.1\", \"@react-aria/dialog\": \"^3.5.30\", \"@react-aria/disclosure\": \"^3.0.8\", \"@react-aria/dnd\": \"^3.11.2\", \"@react-aria/focus\": \"^3.21.1\", \"@react-aria/gridlist\": \"^3.14.0\", \"@react-aria/i18n\": \"^3.12.12\", \"@react-aria/interactions\": \"^3.25.5\", \"@react-aria/label\": \"^3.7.21\", \"@react-aria/landmark\": \"^3.0.6\", \"@react-aria/link\": \"^3.8.5\", \"@react-aria/listbox\": \"^3.14.8\", \"@react-aria/menu\": \"^3.19.2\", \"@react-aria/meter\": \"^3.4.26\", \"@react-aria/numberfield\": \"^3.12.1\", \"@react-aria/overlays\": \"^3.29.1\", \"@react-aria/progress\": \"^3.4.26\", \"@react-aria/radio\": \"^3.12.1\", \"@react-aria/searchfield\": \"^3.8.8\", \"@react-aria/select\": \"^3.16.2\", \"@react-aria/selection\": \"^3.25.1\", \"@react-aria/separator\": \"^3.4.12\", \"@react-aria/slider\": \"^3.8.1\", \"@react-aria/ssr\": \"^3.9.10\", \"@react-aria/switch\": \"^3.7.7\", \"@react-aria/table\": \"^3.17.7\", \"@react-aria/tabs\": \"^3.10.7\", \"@react-aria/tag\": \"^3.7.1\", \"@react-aria/textfield\": \"^3.18.1\", \"@react-aria/toast\": \"^3.0.7\", \"@react-aria/tooltip\": \"^3.8.7\", \"@react-aria/tree\": \"^3.1.3\", \"@react-aria/utils\": \"^3.30.1\", \"@react-aria/visually-hidden\": \"^3.8.27\", \"@react-types/shared\": \"^3.32.0\" }, \"peerDependencies\": { \"react\": \"^16.8.0 || ^17.0.0-rc.1 || ^18.0.0 || ^19.0.0-rc.1\", \"react-dom\": \"^16.8.0 || ^17.0.0-rc.1 || ^18.0.0 || ^19.0.0-rc.1\" } }, \"sha512-CfaXi3S69SeOkpp6pGc1w5FH8OvGPFphiMrO2tNSlqpYIecgk3gKoXjkqaAr6N+O1gasLMfAAF9sxtvS141qWg==\"],\n \n@@ -4380,7 +4380,7 @@\n \n     \"react-diff-view\": [\"react-diff-view@3.3.2\", \"\", { \"dependencies\": { \"classnames\": \"^2.3.2\", \"diff-match-patch\": \"^1.0.5\", \"gitdiff-parser\": \"^0.3.1\", \"lodash\": \"^4.17.21\", \"shallow-equal\": \"^3.1.0\", \"warning\": \"^4.0.3\" }, \"peerDependencies\": { \"react\": \">=16.14.0\" } }, \"sha512-wPVq4ktTcGOHbhnWKU/gHLtd3N2Xd+OZ/XQWcKA06dsxlSsESePAumQILwHtiak2nMCMiWcIfBpqZ5OiharUPA==\"],\n \n-    \"react-dom\": [\"react-dom@19.1.1\", \"\", { \"dependencies\": { \"scheduler\": \"^0.26.0\" }, \"peerDependencies\": { \"react\": \"^19.1.1\" } }, \"sha512-Dlq/5LAZgF0Gaz6yiqZCf6VCcZs1ghAJyrsu84Q/GT0gV+mCxbfmKNoGRKBYMJ8IEdGPqu49YWXD02GCknEDkw==\"],\n+    \"react-dom\": [\"react-dom@19.2.1\", \"\", { \"dependencies\": { \"scheduler\": \"^0.27.0\" }, \"peerDependencies\": { \"react\": \"^19.2.1\" } }, \"sha512-ibrK8llX2a4eOskq1mXKu/TGZj9qzomO+sNfO98M6d9zIPOEhlBkMkBUBLd1vgS0gQsLDBzA+8jJBVXDnfHmJg==\"],\n \n     \"react-easy-crop\": [\"react-easy-crop@5.5.1\", \"\", { \"dependencies\": { \"normalize-wheel\": \"^1.0.1\", \"tslib\": \"^2.0.1\" }, \"peerDependencies\": { \"react\": \">=16.4.0\", \"react-dom\": \">=16.4.0\" } }, \"sha512-8m6lCmfr6cSE9/447iHu+OniJuy7sdFbTqbsYyAXKygXJplvGCLpodujodWQeBGse11nDIgCbMUKbgucIxQWSQ==\"],\n \n@@ -4508,7 +4508,7 @@\n \n     \"sb-scandir\": [\"sb-scandir@3.1.1\", \"\", { \"dependencies\": { \"sb-promise-queue\": \"^2.1.0\" } }, \"sha512-Q5xiQMtoragW9z8YsVYTAZcew+cRzdVBefPbb9theaIKw6cBo34WonP9qOCTKgyAmn/Ch5gmtAxT/krUgMILpA==\"],\n \n-    \"scheduler\": [\"scheduler@0.26.0\", \"\", {}, \"sha512-NlHwttCI/l5gCPR3D1nNXtWABUmBwvZpEQiD4IXSbIDq8BzLIK/7Ir5gTFSGZDUu37K5cMNp0hFtzO38sC7gWA==\"],\n+    \"scheduler\": [\"scheduler@0.27.0\", \"\", {}, \"sha512-eNv+WrVbKu1f3vbYJT/xtiF5syA5HPIMtf9IgY/nKg0sWqzAUEvqY/xm7OcZc/qafLx/iO9FgOmeSAp4v5ti/Q==\"],\n \n     \"schema-utils\": [\"schema-utils@4.3.3\", \"\", { \"dependencies\": { \"@types/json-schema\": \"^7.0.9\", \"ajv\": \"^8.9.0\", \"ajv-formats\": \"^2.1.1\", \"ajv-keywords\": \"^5.1.0\" } }, \"sha512-eflK8wEtyOE6+hsaRVPxvUKYCpRgzLqDTb8krvAsRIwOGlHoSgYLgBXoubGgLd2fT41/OUYdb48v4k4WWHQurA==\"],\n \n@@ -5058,6 +5058,8 @@\n \n     \"@ai-sdk/gateway/@ai-sdk/provider-utils\": [\"@ai-sdk/provider-utils@3.0.9\", \"\", { \"dependencies\": { \"@ai-sdk/provider\": \"2.0.0\", \"@standard-schema/spec\": \"^1.0.0\", \"eventsource-parser\": \"^3.0.5\" }, \"peerDependencies\": { \"zod\": \"^3.25.76 || ^4\" } }, \"sha512-Pm571x5efqaI4hf9yW4KsVlDBDme8++UepZRnq+kqVBWWjgvGhQlzU8glaFq0YJEB9kkxZHbRRyVeHoV2sRYaQ==\"],\n \n+    \"@ant-design/cssinjs/csstype\": [\"csstype@3.1.3\", \"\", {}, \"sha512-M1uQkMl8rQK/szD0LNhtqxIPLpimGm8sOBwU7lLnCpSbTyY3yeU1Vc7l4KT5zT4s/yOxHH5O7tIuuLOCnLADRw==\"],\n+\n     \"@anthropic-ai/claude-agent-sdk/zod\": [\"zod@3.25.76\", \"\", {}, \"sha512-gzUt/qt81nXsFGKIFcC3YnfEAx5NkunCfnDlvuBSSFS02bcXu4Lmea0AFIUwbLWxWPx3d9p8S5QoaujKcNQxcQ==\"],\n \n     \"@auth/core/jose\": [\"jose@5.10.0\", \"\", {}, \"sha512-s+3Al/p9g32Iq+oqXxkW//7jk2Vig6FF1CFqzVXoTUXt2qz89YWbL+OwS17NFYEvxC35n0FKeGO2LGYSxeM2Gg==\"],\n@@ -5086,6 +5088,8 @@\n \n     \"@cloudflare/kv-asset-handler/mime\": [\"mime@3.0.0\", \"\", { \"bin\": { \"mime\": \"cli.js\" } }, \"sha512-jSCU7/VB1loIWBZe14aEYHU/+1UMEHoaO7qxCOVJOw9GgH72VAWppxNcjU+x9a2k3GSIBXNKxXQFqRvvZ7vr3A==\"],\n \n+    \"@cmux/client/typescript-eslint\": [\"typescript-eslint@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/eslint-plugin\": \"8.48.0\", \"@typescript-eslint/parser\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-fcKOvQD9GUn3Xw63EgiDqhvWJ5jsyZUaekl3KVpGsDJnN46WJTe3jWxtQP9lMZm1LJNkFLlTaWAxK2vUQR+cqw==\"],\n+\n     \"@cmux/morphcloud-openapi-client/typescript-eslint\": [\"typescript-eslint@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/eslint-plugin\": \"8.48.0\", \"@typescript-eslint/parser\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-fcKOvQD9GUn3Xw63EgiDqhvWJ5jsyZUaekl3KVpGsDJnN46WJTe3jWxtQP9lMZm1LJNkFLlTaWAxK2vUQR+cqw==\"],\n \n     \"@cmux/scripts/morphcloud\": [\"morphcloud@0.0.18\", \"\", { \"dependencies\": { \"ignore\": \"^7.0.0\", \"node-ssh\": \"^13.2.0\", \"undici\": \"^7.12.0\", \"uuid\": \"^11.1.0\" } }, \"sha512-k3kxdvmwUQbRM5RBJp/UMXQKOqZBBy+BVo/jgNLuNp8yLBq5CJqGAK3O0oZewwKUK2/UL4LyHkwJxBNf7gy0kg==\"],\n@@ -5890,6 +5894,8 @@\n \n     \"socks-proxy-agent/agent-base\": [\"agent-base@6.0.2\", \"\", { \"dependencies\": { \"debug\": \"4\" } }, \"sha512-RZNwNclF7+MS/8bDg70amg32dyeZGZxiDuQmZxKLAlQjr3jGyLx+4Kkk58UO7D2QdgFIQCovuSuZESne6RG6XQ==\"],\n \n+    \"solid-js/csstype\": [\"csstype@3.1.3\", \"\", {}, \"sha512-M1uQkMl8rQK/szD0LNhtqxIPLpimGm8sOBwU7lLnCpSbTyY3yeU1Vc7l4KT5zT4s/yOxHH5O7tIuuLOCnLADRw==\"],\n+\n     \"sort-keys/is-plain-obj\": [\"is-plain-obj@1.1.0\", \"\", {}, \"sha512-yvkRyxmFKEOQ4pNXCmJG5AEQNlXJS5LaONXo5/cLdTZdWvsZ1ioJEonLGAosKlMWE8lwUy/bJzMjcw8az73+Fg==\"],\n \n     \"source-map-support/source-map\": [\"source-map@0.6.1\", \"\", {}, \"sha512-UjgapumWlbMhkBgzT7Ykc5YXUT46F0iKu8SGXq0bcwP5dz/h0Plj6enJqjz1Zbq2l5WaqYnrVbwWOWMyF3F47g==\"],\n@@ -5994,6 +6000,14 @@\n \n     \"@babel/helper-compilation-targets/lru-cache/yallist\": [\"yallist@3.1.1\", \"\", {}, \"sha512-a4UGQaWPH59mOXUYnAG2ewncQS4i4F43Tv3JoAM+s2VDAmS9NsK8GpDMLrCHPksFT7h3K6TOoUNn2pb7RoXx4g==\"],\n \n+    \"@cmux/client/typescript-eslint/@typescript-eslint/eslint-plugin\": [\"@typescript-eslint/eslint-plugin@8.48.0\", \"\", { \"dependencies\": { \"@eslint-community/regexpp\": \"^4.10.0\", \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/type-utils\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\", \"graphemer\": \"^1.4.0\", \"ignore\": \"^7.0.0\", \"natural-compare\": \"^1.4.0\", \"ts-api-utils\": \"^2.1.0\" }, \"peerDependencies\": { \"@typescript-eslint/parser\": \"^8.48.0\", \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-XxXP5tL1txl13YFtrECECQYeZjBZad4fyd3cFV4a19LkAY/bIp9fev3US4S5fDVV2JaYFiKAZ/GRTOLer+mbyQ==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/parser\": [\"@typescript-eslint/parser@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\", \"debug\": \"^4.3.4\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-jCzKdm/QK0Kg4V4IK/oMlRZlY+QOcdjv89U2NgKHZk1CYTj82/RVSx1mV/0gqCVMJ/DA+Zf/S4NBWNF8GQ+eqQ==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/typescript-estree\": [\"@typescript-eslint/typescript-estree@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/project-service\": \"8.48.0\", \"@typescript-eslint/tsconfig-utils\": \"8.48.0\", \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\", \"debug\": \"^4.3.4\", \"minimatch\": \"^9.0.4\", \"semver\": \"^7.6.0\", \"tinyglobby\": \"^0.2.15\", \"ts-api-utils\": \"^2.1.0\" }, \"peerDependencies\": { \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-ljHab1CSO4rGrQIAyizUS6UGHHCiAYhbfcIZ1zVJr5nMryxlXMVWS3duFPSKvSUbFPwkXMFk1k0EMIjub4sRRQ==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/utils\": [\"@typescript-eslint/utils@8.48.0\", \"\", { \"dependencies\": { \"@eslint-community/eslint-utils\": \"^4.7.0\", \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-yTJO1XuGxCsSfIVt1+1UrLHtue8xz16V8apzPYI06W0HbEbEWHxHXgZaAgavIkoh+GeV6hKKd5jm0sS6OYxWXQ==\"],\n+\n     \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin\": [\"@typescript-eslint/eslint-plugin@8.48.0\", \"\", { \"dependencies\": { \"@eslint-community/regexpp\": \"^4.10.0\", \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/type-utils\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\", \"graphemer\": \"^1.4.0\", \"ignore\": \"^7.0.0\", \"natural-compare\": \"^1.4.0\", \"ts-api-utils\": \"^2.1.0\" }, \"peerDependencies\": { \"@typescript-eslint/parser\": \"^8.48.0\", \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-XxXP5tL1txl13YFtrECECQYeZjBZad4fyd3cFV4a19LkAY/bIp9fev3US4S5fDVV2JaYFiKAZ/GRTOLer+mbyQ==\"],\n \n     \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/parser\": [\"@typescript-eslint/parser@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\", \"debug\": \"^4.3.4\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-jCzKdm/QK0Kg4V4IK/oMlRZlY+QOcdjv89U2NgKHZk1CYTj82/RVSx1mV/0gqCVMJ/DA+Zf/S4NBWNF8GQ+eqQ==\"],\n@@ -6688,6 +6702,34 @@\n \n     \"@aws-crypto/util/@smithy/util-utf8/@smithy/util-buffer-from/@smithy/is-array-buffer\": [\"@smithy/is-array-buffer@2.2.0\", \"\", { \"dependencies\": { \"tslib\": \"^2.6.2\" } }, \"sha512-GGP3O9QFD24uGeAXYUjwSTXARoqpZykHadOmA8G5vfJPK0/DC67qa//0qvqrJzL1xc8WQWX7/yc7fwudjPHPhA==\"],\n \n+    \"@cmux/client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/scope-manager\": [\"@typescript-eslint/scope-manager@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\" } }, \"sha512-uGSSsbrtJrLduti0Q1Q9+BF1/iFKaxGoQwjWOIVNJv0o6omrdyR8ct37m4xIl5Zzpkp69Kkmvom7QFTtue89YQ==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/type-utils\": [\"@typescript-eslint/type-utils@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\", \"debug\": \"^4.3.4\", \"ts-api-utils\": \"^2.1.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-zbeVaVqeXhhab6QNEKfK96Xyc7UQuoFWERhEnj3mLVnUWrQnv15cJNseUni7f3g557gm0e46LZ6IJ4NJVOgOpw==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/eslint-plugin/ignore\": [\"ignore@7.0.5\", \"\", {}, \"sha512-Hs59xBNfUIunMFgWAbGX5cq6893IbWg4KnrjbYwX3tx0ztorVgTDA6B2sxf8ejHJ4wz8BqGUMYlnzNBer5NvGg==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/parser/@typescript-eslint/scope-manager\": [\"@typescript-eslint/scope-manager@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\" } }, \"sha512-uGSSsbrtJrLduti0Q1Q9+BF1/iFKaxGoQwjWOIVNJv0o6omrdyR8ct37m4xIl5Zzpkp69Kkmvom7QFTtue89YQ==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/parser/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/parser/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/project-service\": [\"@typescript-eslint/project-service@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/tsconfig-utils\": \"^8.48.0\", \"@typescript-eslint/types\": \"^8.48.0\", \"debug\": \"^4.3.4\" }, \"peerDependencies\": { \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-Ne4CTZyRh1BecBf84siv42wv5vQvVmgtk8AuiEffKTUo3DrBaGYZueJSxxBZ8fjk/N3DrgChH4TOdIOwOwiqqw==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/tsconfig-utils\": [\"@typescript-eslint/tsconfig-utils@8.48.0\", \"\", { \"peerDependencies\": { \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-WNebjBdFdyu10sR1M4OXTt2OkMd5KWIL+LLfeH9KhgP+jzfDV/LI3eXzwJ1s9+Yc0Kzo2fQCdY/OpdusCMmh6w==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/typescript-estree/minimatch\": [\"minimatch@9.0.5\", \"\", { \"dependencies\": { \"brace-expansion\": \"^2.0.1\" } }, \"sha512-G6T0ZX48xgozx7587koeX9Ys2NYy6Gmv//P89sEte9V9whIapMNF4idKxnW2QtCcLiTWlb/wfCabAtAFWhhBow==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/utils/@typescript-eslint/scope-manager\": [\"@typescript-eslint/scope-manager@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\" } }, \"sha512-uGSSsbrtJrLduti0Q1Q9+BF1/iFKaxGoQwjWOIVNJv0o6omrdyR8ct37m4xIl5Zzpkp69Kkmvom7QFTtue89YQ==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/utils/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n     \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/scope-manager\": [\"@typescript-eslint/scope-manager@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\" } }, \"sha512-uGSSsbrtJrLduti0Q1Q9+BF1/iFKaxGoQwjWOIVNJv0o6omrdyR8ct37m4xIl5Zzpkp69Kkmvom7QFTtue89YQ==\"],\n \n     \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/type-utils\": [\"@typescript-eslint/type-utils@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\", \"debug\": \"^4.3.4\", \"ts-api-utils\": \"^2.1.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-zbeVaVqeXhhab6QNEKfK96Xyc7UQuoFWERhEnj3mLVnUWrQnv15cJNseUni7f3g557gm0e46LZ6IJ4NJVOgOpw==\"],\n@@ -6978,6 +7020,16 @@\n \n     \"wrap-ansi/ansi-styles/color-convert/color-name\": [\"color-name@1.1.4\", \"\", {}, \"sha512-dOy+3AuW3a2wNbZHIuMZpTcgjGuLU/uBL/ubcZF9OXbDo8ff4O8yVp5Bf0efS8uEoYo5q4Fx7dY9OgQGXgAsQA==\"],\n \n+    \"@cmux/client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/scope-manager/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/type-utils/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/visitor-keys/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/typescript-estree/minimatch/brace-expansion\": [\"brace-expansion@2.0.2\", \"\", { \"dependencies\": { \"balanced-match\": \"^1.0.0\" } }, \"sha512-Jt0vHyM+jmUBqojB7E1NIYadt0vI0Qxjxd2TErW94wDz+E2LAm5vKMXXwg6ZZBTHPuUlDgQHKXvjGBdfcF1ZDQ==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/utils/@typescript-eslint/scope-manager/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n+\n     \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/scope-manager/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n \n     \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/type-utils/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\ndiff --git a/package.json b/package.json\nindex 03d735a98..ecd14b8a5 100644\n--- a/package.json\n+++ b/package.json\n@@ -24,8 +24,8 @@\n     \"@sentry/core\": \"10.27.0\",\n     \"@sentry/types\": \"10.27.0\",\n     \"node-abi\": \"^4.14.0\",\n-    \"react\": \"^19.1.0\",\n-    \"react-dom\": \"^19.1.0\",\n+    \"react\": \"^19.2.0\",\n+    \"react-dom\": \"^19.2.0\",\n     \"monaco-editor\": \"^0.53.0\",\n     \"convex\": \"1.29.3\"\n   },\n","comments":[{"type":"issue_comment","id":3610347714,"prNumber":1164,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn7f6jznjmcqd5vncfp53c4b3x7wmrer?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn7f6jznjmcqd5vncfp53c4b3x7wmrer/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1164?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 5 screenshots for commit `600622f` (2025-12-04 05:36:54.024 UTC).\n\n**Close-up view of the Radix UI AlertDialog showing improved accessibility and structure**\n\n![alert-dialog-close-up.png](https://adorable-wombat-701.convex.cloud/api/storage/cbd223fe-d25a-4c5c-bfb3-4144240c1b30)\n\n**Full page view of the new Radix UI AlertDialog component for delete confirmation \\(replaces custom modal\\)**\n\n![alert-dialog-delete-confirmation.png](https://adorable-wombat-701.convex.cloud/api/storage/9b2b9902-050f-45ae-a5f5-bea73e437c83)\n\n**cmux client app sidebar with improved keyboard shortcut handling \\(Ctrl+Shift+S\\) using React 19.2.0**\n\n![client-sidebar-full-view.png](https://adorable-wombat-701.convex.cloud/api/storage/f557b0a0-4a3c-4715-8e43-96329defbf46)\n\n**Configured repositories section showing repository cards with delete and settings buttons**\n\n![configured-repositories-section.png](https://adorable-wombat-701.convex.cloud/api/storage/56da6e37-9123-4141-9521-d2d69012050b)\n\n**Full preview.new page showing the updated metadata \\(title and SEO improvements\\) with React 19.2.0 and Next.js 16.0.7**\n\n![preview-page-full.png](https://adorable-wombat-701.convex.cloud/api/storage/a18ca893-b5e5-4ac5-ba8f-a2e66042ceec)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"600622ff6685fbec5854fb26d9c9ee769d1eb8ab","createdAt":"2025-12-04T05:36:55Z","updatedAt":"2025-12-04T05:36:55Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1164#issuecomment-3610347714"}]}
{"number":1163,"title":"Make cmux default layout three-panel arrangement","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1163","headRef":"cmux/make-cmux-default-layout-three-panel-arrangement-kjo8f","headSha":"3f5cd3958a8fd34cb5c25b0eda2ff7f58e2fa976","baseRef":"main","baseSha":"645d6206b23efeb9652d9463a885959878dfa5f9","createdAt":"2025-12-04T05:31:12Z","updatedAt":"2025-12-04T05:39:52Z","diff":"diff --git a/apps/client/src/lib/panel-config.ts b/apps/client/src/lib/panel-config.ts\nindex 463b4734e..f6c49407d 100644\n--- a/apps/client/src/lib/panel-config.ts\n+++ b/apps/client/src/lib/panel-config.ts\n@@ -31,12 +31,12 @@ const DEFAULT_LAYOUT_PANELS: LayoutPanels = {\n };\n \n export const DEFAULT_PANEL_CONFIG: PanelConfig = {\n-  layoutMode: \"four-panel\",\n+  layoutMode: \"three-left\",\n   layouts: {\n     \"four-panel\": { ...DEFAULT_LAYOUT_PANELS },\n     \"two-horizontal\": { topLeft: \"chat\", topRight: \"workspace\", bottomLeft: null, bottomRight: null },\n     \"two-vertical\": { topLeft: \"chat\", topRight: null, bottomLeft: \"workspace\", bottomRight: null },\n-    \"three-left\": { topLeft: \"workspace\", topRight: \"chat\", bottomLeft: null, bottomRight: \"terminal\" },\n+    \"three-left\": { topLeft: \"workspace\", topRight: \"browser\", bottomLeft: null, bottomRight: \"gitDiff\" },\n     \"three-right\": { topLeft: \"chat\", topRight: null, bottomLeft: \"terminal\", bottomRight: \"workspace\" },\n     \"three-top\": { topLeft: \"workspace\", topRight: null, bottomLeft: \"chat\", bottomRight: \"terminal\" },\n     \"three-bottom\": { topLeft: \"chat\", topRight: \"workspace\", bottomLeft: null, bottomRight: \"terminal\" },\n","comments":[{"type":"issue_comment","id":3610346573,"prNumber":1163,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace](https://cmux.sh/austin-dev/task/kn75b2jw4ny9dtqg2tsmgrcawh7wmc63?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) 🔒 · [Open Dev Browser](https://cmux.sh/austin-dev/task/kn75b2jw4ny9dtqg2tsmgrcawh7wmc63/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) 🔒 · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1163?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n_🔒 = requires [cmux](https://cmux.sh) team access_\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"3f5cd3958a8fd34cb5c25b0eda2ff7f58e2fa976","createdAt":"2025-12-04T05:36:38Z","updatedAt":"2025-12-04T05:38:19Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1163#issuecomment-3610346573"},{"type":"issue_comment","id":3610353991,"prNumber":1163,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn73d9dxb70a3n6n7hqgrb3hgh7wnnwk?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn73d9dxb70a3n6n7hqgrb3hgh7wnnwk/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1163?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"3f5cd3958a8fd34cb5c25b0eda2ff7f58e2fa976","createdAt":"2025-12-04T05:38:18Z","updatedAt":"2025-12-04T05:38:18Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1163#issuecomment-3610353991"}]}
{"number":1159,"title":"Add diff-viewer screenshots UI to pr-review","state":"open","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1159","headRef":"cmux/add-diff-viewer-screenshots-ui-to-pr-review-2q8y2","headSha":"2567a3aee1f5648a6ccd470e1ed48e71ad052d66","baseRef":"main","baseSha":"fcca1695305ea57f2a763d2ef80cedd8949c763c","createdAt":"2025-12-04T04:27:38Z","updatedAt":"2025-12-04T06:52:18Z","diff":"diff --git a/apps/www/components/pr/pr-screenshot-gallery.tsx b/apps/www/components/pr/pr-screenshot-gallery.tsx\nnew file mode 100644\nindex 000000000..1aa293fc1\n--- /dev/null\n+++ b/apps/www/components/pr/pr-screenshot-gallery.tsx\n@@ -0,0 +1,721 @@\n+\"use client\";\n+\n+import {\n+  useCallback,\n+  useEffect,\n+  useMemo,\n+  useRef,\n+  useState,\n+  type SyntheticEvent,\n+} from \"react\";\n+import { formatDistanceToNow } from \"date-fns\";\n+import * as Dialog from \"@radix-ui/react-dialog\";\n+import {\n+  ChevronLeft,\n+  ChevronRight,\n+  Image as ImageIcon,\n+  Maximize2,\n+  RotateCcw,\n+  X,\n+  ZoomIn,\n+  ZoomOut,\n+} from \"lucide-react\";\n+import { cn } from \"@/lib/utils\";\n+\n+type ScreenshotStatus = \"completed\" | \"failed\" | \"skipped\";\n+\n+interface ScreenshotImage {\n+  storageId: string;\n+  mimeType: string;\n+  fileName: string | null;\n+  commitSha: string | null;\n+  url: string | null;\n+}\n+\n+interface ScreenshotSet {\n+  _id: string;\n+  status: ScreenshotStatus;\n+  commitSha: string | null;\n+  capturedAt: number;\n+  error: string | null;\n+  images: ScreenshotImage[];\n+  previewRunId: string | null;\n+  prNumber: number;\n+}\n+\n+interface PrScreenshotGalleryProps {\n+  screenshotSets: ScreenshotSet[];\n+}\n+\n+const MIN_ZOOM = 0.2;\n+const MAX_ZOOM = 40;\n+\n+const STATUS_LABELS: Record<ScreenshotStatus, string> = {\n+  completed: \"Completed\",\n+  failed: \"Failed\",\n+  skipped: \"Skipped\",\n+};\n+\n+const STATUS_STYLES: Record<ScreenshotStatus, string> = {\n+  completed:\n+    \"bg-emerald-100/70 text-emerald-700 dark:bg-emerald-950/60 dark:text-emerald-300\",\n+  failed: \"bg-rose-100/70 text-rose-700 dark:bg-rose-950/60 dark:text-rose-300\",\n+  skipped:\n+    \"bg-neutral-200/70 text-neutral-700 dark:bg-neutral-800 dark:text-neutral-300\",\n+};\n+\n+const getImageKey = (\n+  setId: string,\n+  image: ScreenshotImage,\n+  indexInSet: number\n+) => `${setId}:${image.storageId}:${indexInSet}`;\n+\n+export function PrScreenshotGallery(props: PrScreenshotGalleryProps) {\n+  const { screenshotSets } = props;\n+\n+  // Sort by capturedAt descending (latest first)\n+  const sortedScreenshotSets = useMemo(\n+    () =>\n+      [...screenshotSets].sort((a, b) => {\n+        if (a.capturedAt === b.capturedAt) {\n+          return a._id.localeCompare(b._id);\n+        }\n+        return b.capturedAt - a.capturedAt;\n+      }),\n+    [screenshotSets]\n+  );\n+\n+  const flattenedImages = useMemo(() => {\n+    const entries: Array<{\n+      set: ScreenshotSet;\n+      image: ScreenshotImage;\n+      indexInSet: number;\n+      key: string;\n+      globalIndex: number;\n+    }> = [];\n+    sortedScreenshotSets.forEach((set) => {\n+      set.images.forEach((image, indexInSet) => {\n+        if (!image.url) {\n+          return;\n+        }\n+        entries.push({\n+          set,\n+          image,\n+          indexInSet,\n+          key: getImageKey(set._id, image, indexInSet),\n+          globalIndex: entries.length,\n+        });\n+      });\n+    });\n+    return entries;\n+  }, [sortedScreenshotSets]);\n+\n+  const globalIndexByKey = useMemo(() => {\n+    const indexMap = new Map<string, number>();\n+    flattenedImages.forEach((entry) => {\n+      indexMap.set(entry.key, entry.globalIndex);\n+    });\n+    return indexMap;\n+  }, [flattenedImages]);\n+\n+  const [activeImageKey, setActiveImageKey] = useState<string | null>(null);\n+  const [zoom, setZoom] = useState(1);\n+  const [offset, setOffset] = useState({ x: 0, y: 0 });\n+  const [isPanning, setIsPanning] = useState(false);\n+  const [baseImageScale, setBaseImageScale] = useState(1);\n+  const viewportRef = useRef<HTMLDivElement | null>(null);\n+  const panPointerIdRef = useRef<number | null>(null);\n+  const lastPanPositionRef = useRef<{ x: number; y: number } | null>(null);\n+  const defaultZoomRef = useRef(1);\n+  const defaultOffsetRef = useRef<{ x: number; y: number }>({ x: 0, y: 0 });\n+\n+  const clampZoom = useCallback((value: number) => {\n+    return Math.min(MAX_ZOOM, Math.max(MIN_ZOOM, value));\n+  }, []);\n+\n+  const setZoomWithFocus = useCallback(\n+    (\n+      resolver: (prevZoom: number) => number,\n+      focusPoint: { x: number; y: number } = { x: 0, y: 0 }\n+    ) => {\n+      setZoom((prevZoom) => {\n+        const safePrevZoom = prevZoom || 1;\n+        const nextZoom = clampZoom(resolver(safePrevZoom));\n+        if (nextZoom === safePrevZoom) {\n+          return nextZoom;\n+        }\n+        setOffset((prevOffset) => ({\n+          x:\n+            focusPoint.x -\n+            (nextZoom * (focusPoint.x - prevOffset.x)) / safePrevZoom,\n+          y:\n+            focusPoint.y -\n+            (nextZoom * (focusPoint.y - prevOffset.y)) / safePrevZoom,\n+        }));\n+        return nextZoom;\n+      });\n+    },\n+    [clampZoom]\n+  );\n+\n+  const resetZoomState = useCallback(\n+    (options?: { zoom?: number; offset?: { x: number; y: number } }) => {\n+      const targetZoom = clampZoom(options?.zoom ?? defaultZoomRef.current);\n+      setZoom(targetZoom);\n+      setOffset(options?.offset ?? defaultOffsetRef.current);\n+      setIsPanning(false);\n+      panPointerIdRef.current = null;\n+      lastPanPositionRef.current = null;\n+    },\n+    [clampZoom]\n+  );\n+\n+  const handleImageLoad = (event: SyntheticEvent<HTMLImageElement>) => {\n+    const { naturalWidth, naturalHeight } = event.currentTarget;\n+    const viewportRect = viewportRef.current?.getBoundingClientRect();\n+    if (!viewportRect || naturalWidth <= 0 || naturalHeight <= 0) {\n+      setBaseImageScale(1);\n+      defaultZoomRef.current = 1;\n+      defaultOffsetRef.current = { x: 0, y: 0 };\n+      resetZoomState({ zoom: 1, offset: { x: 0, y: 0 } });\n+      return;\n+    }\n+\n+    const viewportWidth = viewportRect.width;\n+    const viewportHeight = viewportRect.height;\n+    const baseScale = Math.min(\n+      viewportWidth / naturalWidth,\n+      viewportHeight / naturalHeight\n+    );\n+    const normalizedBaseScale = Math.min(1, baseScale);\n+    setBaseImageScale(normalizedBaseScale);\n+    const baseWidth = naturalWidth * baseScale;\n+    const baseHeight = naturalHeight * baseScale;\n+\n+    const fitHeightZoom = viewportHeight / baseHeight;\n+    const fitWidthZoom = viewportWidth / baseWidth;\n+    const desiredZoom = Math.min(1, fitHeightZoom, fitWidthZoom);\n+    const clampedZoom = clampZoom(desiredZoom);\n+\n+    const scaledHeight = baseHeight * clampedZoom;\n+    const offsetY = -((viewportHeight - scaledHeight) / 2);\n+    const initialOffset = { x: 0, y: offsetY };\n+\n+    defaultZoomRef.current = clampedZoom;\n+    defaultOffsetRef.current = initialOffset;\n+    resetZoomState({ zoom: clampedZoom, offset: initialOffset });\n+  };\n+\n+  const activeImageIndex =\n+    activeImageKey !== null\n+      ? globalIndexByKey.get(activeImageKey) ?? null\n+      : null;\n+  const currentEntry =\n+    activeImageIndex !== null &&\n+    activeImageIndex >= 0 &&\n+    activeImageIndex < flattenedImages.length\n+      ? flattenedImages[activeImageIndex]\n+      : null;\n+\n+  const activeOverallIndex =\n+    currentEntry?.globalIndex !== undefined\n+      ? currentEntry.globalIndex + 1\n+      : null;\n+\n+  // Highlight the latest set (first in sorted order)\n+  const effectiveHighlight = sortedScreenshotSets[0]?._id ?? null;\n+\n+  useEffect(() => {\n+    if (activeImageKey === null) {\n+      return;\n+    }\n+    if (flattenedImages.length === 0 || !globalIndexByKey.has(activeImageKey)) {\n+      setActiveImageKey(null);\n+    }\n+  }, [activeImageKey, flattenedImages.length, globalIndexByKey]);\n+\n+  useEffect(() => {\n+    defaultZoomRef.current = 1;\n+    defaultOffsetRef.current = { x: 0, y: 0 };\n+    setBaseImageScale(1);\n+    resetZoomState({ zoom: 1, offset: { x: 0, y: 0 } });\n+  }, [currentEntry?.key, resetZoomState]);\n+\n+  const closeSlideshow = useCallback(() => {\n+    setActiveImageKey(null);\n+  }, []);\n+\n+  const goNext = useCallback(() => {\n+    if (activeImageIndex === null) {\n+      return;\n+    }\n+    const len = flattenedImages.length;\n+    if (len <= 1) {\n+      return;\n+    }\n+    const nextIndex = (activeImageIndex + 1) % len;\n+    setActiveImageKey(flattenedImages[nextIndex]?.key ?? null);\n+  }, [activeImageIndex, flattenedImages]);\n+\n+  const goPrev = useCallback(() => {\n+    if (activeImageIndex === null) {\n+      return;\n+    }\n+    const len = flattenedImages.length;\n+    if (len <= 1) {\n+      return;\n+    }\n+    const prevIndex = (activeImageIndex - 1 + len) % len;\n+    setActiveImageKey(flattenedImages[prevIndex]?.key ?? null);\n+  }, [activeImageIndex, flattenedImages]);\n+\n+  const isSlideshowOpen = Boolean(currentEntry);\n+  const hasMultipleImages = flattenedImages.length > 1;\n+  const showNavButtons = hasMultipleImages;\n+  const effectiveScale = Math.max(0, zoom * baseImageScale);\n+  const zoomPercent = Math.round(effectiveScale * 100);\n+  const canZoomIn = zoom < MAX_ZOOM - 0.001;\n+  const canZoomOut = zoom > MIN_ZOOM + 0.001;\n+  const canResetZoom = zoom !== 1 || offset.x !== 0 || offset.y !== 0;\n+\n+  const handleWheel = useCallback(\n+    (event: React.WheelEvent<HTMLDivElement>) => {\n+      if (!currentEntry || !viewportRef.current) {\n+        return;\n+      }\n+      event.preventDefault();\n+      const rect = viewportRef.current.getBoundingClientRect();\n+      const pointerX = event.clientX - (rect.left + rect.width / 2);\n+      const pointerY = event.clientY - (rect.top + rect.height / 2);\n+      const { deltaMode, deltaY } = event;\n+      let pixelDelta = deltaY;\n+      if (deltaMode === 1) {\n+        pixelDelta *= 16;\n+      } else if (deltaMode === 2) {\n+        pixelDelta *= rect.height;\n+      }\n+      if (pixelDelta === 0) {\n+        return;\n+      }\n+      const sensitivity = event.ctrlKey ? 0.0016 : 0.0009;\n+      const factor = Math.exp(-pixelDelta * sensitivity);\n+      setZoomWithFocus((prevZoom) => prevZoom * factor, {\n+        x: pointerX,\n+        y: pointerY,\n+      });\n+    },\n+    [currentEntry, setZoomWithFocus]\n+  );\n+\n+  const startPanning = useCallback(\n+    (event: React.PointerEvent<HTMLDivElement>) => {\n+      if (!currentEntry || event.button !== 0) {\n+        return;\n+      }\n+      event.preventDefault();\n+      setIsPanning(true);\n+      panPointerIdRef.current = event.pointerId;\n+      lastPanPositionRef.current = {\n+        x: event.clientX,\n+        y: event.clientY,\n+      };\n+      event.currentTarget.setPointerCapture(event.pointerId);\n+    },\n+    [currentEntry]\n+  );\n+\n+  const handlePointerMove = useCallback(\n+    (event: React.PointerEvent<HTMLDivElement>) => {\n+      if (\n+        !isPanning ||\n+        panPointerIdRef.current !== event.pointerId ||\n+        !lastPanPositionRef.current\n+      ) {\n+        return;\n+      }\n+      event.preventDefault();\n+      const deltaX = event.clientX - lastPanPositionRef.current.x;\n+      const deltaY = event.clientY - lastPanPositionRef.current.y;\n+      lastPanPositionRef.current = {\n+        x: event.clientX,\n+        y: event.clientY,\n+      };\n+      setOffset((prev) => ({\n+        x: prev.x + deltaX,\n+        y: prev.y + deltaY,\n+      }));\n+    },\n+    [isPanning]\n+  );\n+\n+  const stopPanning = useCallback(\n+    (event?: React.PointerEvent<HTMLDivElement>) => {\n+      if (panPointerIdRef.current !== null && event) {\n+        try {\n+          event.currentTarget.releasePointerCapture(panPointerIdRef.current);\n+        } catch {\n+          // Ignore release errors if pointer capture is no longer active\n+        }\n+      }\n+      panPointerIdRef.current = null;\n+      lastPanPositionRef.current = null;\n+      setIsPanning(false);\n+    },\n+    []\n+  );\n+\n+  const handlePointerUp = useCallback(\n+    (event: React.PointerEvent<HTMLDivElement>) => {\n+      if (panPointerIdRef.current !== event.pointerId) {\n+        return;\n+      }\n+      event.preventDefault();\n+      stopPanning(event);\n+    },\n+    [stopPanning]\n+  );\n+\n+  const handlePointerLeave = useCallback(\n+    (event: React.PointerEvent<HTMLDivElement>) => {\n+      if (!isPanning) {\n+        return;\n+      }\n+      stopPanning(event);\n+    },\n+    [isPanning, stopPanning]\n+  );\n+\n+  const handlePointerCancel = useCallback(\n+    (event: React.PointerEvent<HTMLDivElement>) => {\n+      if (panPointerIdRef.current !== event.pointerId) {\n+        return;\n+      }\n+      stopPanning(event);\n+    },\n+    [stopPanning]\n+  );\n+\n+  const handleZoomIn = useCallback(() => {\n+    setZoomWithFocus((prevZoom) => prevZoom * 1.2);\n+  }, [setZoomWithFocus]);\n+\n+  const handleZoomOut = useCallback(() => {\n+    setZoomWithFocus((prevZoom) => prevZoom / 1.2);\n+  }, [setZoomWithFocus]);\n+\n+  useEffect(() => {\n+    if (!isSlideshowOpen) {\n+      return;\n+    }\n+    const handleKeyDown = (event: KeyboardEvent) => {\n+      if (event.key === \"ArrowRight\") {\n+        event.preventDefault();\n+        goNext();\n+      } else if (event.key === \"ArrowLeft\") {\n+        event.preventDefault();\n+        goPrev();\n+      }\n+    };\n+    window.addEventListener(\"keydown\", handleKeyDown);\n+    return () => {\n+      window.removeEventListener(\"keydown\", handleKeyDown);\n+    };\n+  }, [goNext, goPrev, isSlideshowOpen]);\n+\n+  // Don't render if there are no screenshot sets\n+  if (sortedScreenshotSets.length === 0) {\n+    return null;\n+  }\n+\n+  // Only show sets with images\n+  const setsWithImages = sortedScreenshotSets.filter(\n+    (set) => set.images.length > 0 && set.images.some((img) => img.url)\n+  );\n+\n+  if (setsWithImages.length === 0) {\n+    return null;\n+  }\n+\n+  return (\n+    <div className=\"border border-neutral-200 bg-white p-5 pt-4 text-sm text-neutral-700\">\n+      <div className=\"flex items-center justify-between gap-3 mb-3\">\n+        <div className=\"flex items-center gap-2\">\n+          <ImageIcon className=\"h-4 w-4 text-neutral-500\" aria-hidden />\n+          <span className=\"font-medium text-neutral-700\">Screenshots</span>\n+        </div>\n+        <span className=\"text-xs text-neutral-500\">\n+          {setsWithImages.length}{\" \"}\n+          {setsWithImages.length === 1 ? \"capture\" : \"captures\"}\n+        </span>\n+      </div>\n+\n+      {currentEntry ? (\n+        <Dialog.Root\n+          open={isSlideshowOpen}\n+          onOpenChange={(open) => !open && closeSlideshow()}\n+        >\n+          <Dialog.Portal>\n+            <Dialog.Overlay className=\"fixed inset-0 bg-neutral-950/60 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=open]:fade-in data-[state=closed]:fade-out z-50\" />\n+            <Dialog.Content className=\"fixed left-1/2 top-1/2 z-50 flex max-h-[calc(100vh-4rem)] w-[min(2600px,calc(100vw-4rem))] -translate-x-1/2 -translate-y-1/2 flex-col gap-4 rounded-xl border border-neutral-200 bg-white/95 p-4 shadow-2xl focus:outline-none sm:max-h-[calc(100vh-6rem)] sm:w-[min(2600px,calc(100vw-6rem))] sm:p-6\">\n+              <div className=\"flex flex-wrap items-start justify-between gap-3\">\n+                <div className=\"space-y-1\">\n+                  <Dialog.Title className=\"text-base font-semibold text-neutral-900\">\n+                    {activeOverallIndex !== null ? `${activeOverallIndex}. ` : \"\"}\n+                    {currentEntry.image.fileName ?? \"Screenshot\"}\n+                  </Dialog.Title>\n+                  <Dialog.Description className=\"text-xs text-neutral-600\">\n+                    Image {currentEntry.indexInSet + 1} of{\" \"}\n+                    {currentEntry.set.images.length}\n+                    <span className=\"px-1 text-neutral-400\">•</span>\n+                    {formatDistanceToNow(new Date(currentEntry.set.capturedAt), {\n+                      addSuffix: true,\n+                    })}\n+                  </Dialog.Description>\n+                </div>\n+                <div className=\"flex items-center gap-2\">\n+                  <div className=\"flex items-center gap-1 rounded-full border border-neutral-200 bg-white/90 px-2 py-1 text-xs font-medium text-neutral-600 shadow-sm\">\n+                    <button\n+                      type=\"button\"\n+                      onClick={handleZoomOut}\n+                      disabled={!canZoomOut}\n+                      className=\"rounded-full p-1 transition disabled:opacity-40 hover:bg-neutral-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/70\"\n+                      aria-label=\"Zoom out\"\n+                    >\n+                      <ZoomOut className=\"h-3.5 w-3.5\" />\n+                    </button>\n+                    <span className=\"min-w-[3rem] text-center tabular-nums\">\n+                      {zoomPercent}%\n+                    </span>\n+                    <button\n+                      type=\"button\"\n+                      onClick={handleZoomIn}\n+                      disabled={!canZoomIn}\n+                      className=\"rounded-full p-1 transition disabled:opacity-40 hover:bg-neutral-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/70\"\n+                      aria-label=\"Zoom in\"\n+                    >\n+                      <ZoomIn className=\"h-3.5 w-3.5\" />\n+                    </button>\n+                    <button\n+                      type=\"button\"\n+                      onClick={() => resetZoomState()}\n+                      disabled={!canResetZoom}\n+                      className=\"rounded-full p-1 transition disabled:opacity-40 hover:bg-neutral-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/70\"\n+                      aria-label=\"Reset zoom\"\n+                    >\n+                      <RotateCcw className=\"h-3.5 w-3.5\" />\n+                    </button>\n+                  </div>\n+                  <Dialog.Close asChild>\n+                    <button\n+                      type=\"button\"\n+                      onClick={closeSlideshow}\n+                      className=\"rounded-full p-1.5 text-neutral-600 transition hover:bg-neutral-100 hover:text-neutral-900 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/70\"\n+                      aria-label=\"Close slideshow\"\n+                    >\n+                      <X className=\"h-4 w-4\" />\n+                    </button>\n+                  </Dialog.Close>\n+                </div>\n+              </div>\n+              <div className=\"flex flex-1 items-center gap-4\">\n+                {showNavButtons ? (\n+                  <button\n+                    type=\"button\"\n+                    onClick={goPrev}\n+                    className=\"rounded-full border border-neutral-200 bg-white p-2 text-neutral-600 transition hover:text-neutral-900 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/70\"\n+                    aria-label=\"Previous screenshot\"\n+                  >\n+                    <ChevronLeft className=\"h-5 w-5\" />\n+                  </button>\n+                ) : null}\n+                <div\n+                  ref={viewportRef}\n+                  className={cn(\n+                    \"relative flex h-[70vh] max-h-[calc(100vh-10rem)] min-h-[360px] w-full flex-1 items-center justify-center overflow-hidden rounded-lg border border-neutral-200 bg-neutral-50\",\n+                    zoom > 1\n+                      ? isPanning\n+                        ? \"cursor-grabbing\"\n+                        : \"cursor-grab\"\n+                      : \"cursor-zoom-in\"\n+                  )}\n+                  onWheel={handleWheel}\n+                  onPointerDown={startPanning}\n+                  onPointerMove={handlePointerMove}\n+                  onPointerUp={handlePointerUp}\n+                  onPointerLeave={handlePointerLeave}\n+                  onPointerCancel={handlePointerCancel}\n+                  onDoubleClick={() => resetZoomState()}\n+                  style={{ touchAction: \"none\" }}\n+                >\n+                  <img\n+                    src={currentEntry.image.url ?? undefined}\n+                    alt={currentEntry.image.fileName ?? \"Screenshot\"}\n+                    className=\"select-none h-full w-full object-contain\"\n+                    draggable={false}\n+                    onLoad={handleImageLoad}\n+                    style={{\n+                      transform: `translate3d(${offset.x}px, ${offset.y}px, 0) scale(${zoom})`,\n+                      transition: isPanning ? \"none\" : \"transform 120ms ease-out\",\n+                    }}\n+                  />\n+                </div>\n+                {showNavButtons ? (\n+                  <button\n+                    type=\"button\"\n+                    onClick={goNext}\n+                    className=\"rounded-full border border-neutral-200 bg-white p-2 text-neutral-600 transition hover:text-neutral-900 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/70\"\n+                    aria-label=\"Next screenshot\"\n+                  >\n+                    <ChevronRight className=\"h-5 w-5\" />\n+                  </button>\n+                ) : null}\n+              </div>\n+              {hasMultipleImages ? (\n+                <div className=\"space-y-2\">\n+                  <div className=\"flex items-center justify-between text-xs font-medium text-neutral-500\">\n+                    <span className=\"sr-only\">All screenshots</span>\n+                    <span className=\"tabular-nums text-neutral-600\">\n+                      {activeOverallIndex ?? \"–\"} / {flattenedImages.length}\n+                    </span>\n+                  </div>\n+                  <div className=\"-mx-1 flex gap-2 overflow-x-auto px-1 pb-1\">\n+                    {flattenedImages.map((entry) => {\n+                      const isActiveThumb = entry.key === currentEntry?.key;\n+                      const label = entry.globalIndex + 1;\n+                      const displayName = entry.image.fileName ?? \"Screenshot\";\n+                      return (\n+                        <button\n+                          key={entry.key}\n+                          type=\"button\"\n+                          onClick={() => setActiveImageKey(entry.key)}\n+                          className={cn(\n+                            \"group relative flex h-20 w-32 flex-shrink-0 items-center justify-center overflow-hidden rounded-lg border border-neutral-200 bg-neutral-50 p-1 transition hover:border-neutral-400 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/70\",\n+                            isActiveThumb &&\n+                              \"border-sky-400/70 shadow-[0_0_0_1px_rgba(14,165,233,0.25)]\"\n+                          )}\n+                          aria-label={`View ${displayName}`}\n+                          aria-current={isActiveThumb ? \"true\" : undefined}\n+                          title={displayName}\n+                        >\n+                          <img\n+                            src={entry.image.url ?? undefined}\n+                            alt={displayName}\n+                            className=\"h-full w-full object-contain\"\n+                            loading=\"lazy\"\n+                            decoding=\"async\"\n+                          />\n+                          <span className=\"pointer-events-none absolute bottom-1 left-1 rounded-full bg-neutral-950/80 px-1 text-[10px] font-semibold text-white shadow-sm\">\n+                            {label}\n+                          </span>\n+                        </button>\n+                      );\n+                    })}\n+                  </div>\n+                </div>\n+              ) : null}\n+            </Dialog.Content>\n+          </Dialog.Portal>\n+        </Dialog.Root>\n+      ) : null}\n+\n+      <div className=\"space-y-3\">\n+        {setsWithImages.map((set) => {\n+          const capturedAtDate = new Date(set.capturedAt);\n+          const relativeCapturedAt = formatDistanceToNow(capturedAtDate, {\n+            addSuffix: true,\n+          });\n+          const shortCommit = set.commitSha?.slice(0, 7);\n+          const isHighlighted = effectiveHighlight === set._id;\n+\n+          return (\n+            <div\n+              key={set._id}\n+              className={cn(\n+                \"rounded-lg border border-neutral-200 bg-neutral-50 p-3 transition-shadow\",\n+                isHighlighted &&\n+                  \"border-sky-400/70 shadow-[0_0_0_1px_rgba(14,165,233,0.25)]\"\n+              )}\n+            >\n+              <div className=\"flex flex-wrap items-center gap-2 mb-2\">\n+                <span\n+                  className={cn(\n+                    \"px-2 py-0.5 text-xs font-medium rounded-full\",\n+                    STATUS_STYLES[set.status]\n+                  )}\n+                >\n+                  {STATUS_LABELS[set.status]}\n+                </span>\n+                {isHighlighted && (\n+                  <span className=\"px-2 py-0.5 text-xs font-medium rounded-full bg-sky-100/80 text-sky-700\">\n+                    Latest\n+                  </span>\n+                )}\n+                <span\n+                  className=\"text-xs text-neutral-500\"\n+                  title={capturedAtDate.toLocaleString()}\n+                >\n+                  {relativeCapturedAt}\n+                </span>\n+                {shortCommit && (\n+                  <span className=\"text-xs font-mono text-neutral-500\">\n+                    {shortCommit.toLowerCase()}\n+                  </span>\n+                )}\n+              </div>\n+              {set.error && (\n+                <p className=\"mb-2 text-xs text-rose-600\">{set.error}</p>\n+              )}\n+              <div className=\"flex gap-2 overflow-x-auto pb-1\">\n+                {set.images.map((image, indexInSet) => {\n+                  const displayName = image.fileName ?? \"Screenshot\";\n+                  const stableKey = getImageKey(set._id, image, indexInSet);\n+                  if (!image.url) {\n+                    return (\n+                      <div\n+                        key={stableKey}\n+                        className=\"flex h-24 min-w-[120px] items-center justify-center rounded border border-dashed border-neutral-300 bg-neutral-100 text-xs text-neutral-500\"\n+                      >\n+                        URL expired\n+                      </div>\n+                    );\n+                  }\n+                  const flatIndex = globalIndexByKey.get(stableKey) ?? null;\n+                  const humanIndex = flatIndex !== null ? flatIndex + 1 : null;\n+                  const isActive = activeImageKey === stableKey;\n+\n+                  return (\n+                    <button\n+                      key={stableKey}\n+                      type=\"button\"\n+                      onClick={() => setActiveImageKey(stableKey)}\n+                      className={cn(\n+                        \"group relative flex w-[140px] flex-col overflow-hidden rounded border border-neutral-200 bg-white text-left transition-colors hover:border-neutral-400\",\n+                        isActive &&\n+                          \"border-sky-400/70 shadow-[0_0_0_1px_rgba(14,165,233,0.25)]\"\n+                      )}\n+                      aria-label={`Open ${displayName} in slideshow`}\n+                    >\n+                      <img\n+                        src={image.url}\n+                        alt={displayName}\n+                        className=\"h-24 w-[140px] object-contain bg-neutral-100\"\n+                        loading=\"lazy\"\n+                      />\n+                      <div className=\"absolute top-1.5 right-1.5 text-neutral-600 opacity-0 transition group-hover:opacity-100\">\n+                        <Maximize2 className=\"h-3 w-3\" />\n+                      </div>\n+                      <div className=\"border-t border-neutral-200 px-2 py-1 text-[11px] text-neutral-600 truncate\">\n+                        {humanIndex !== null ? `${humanIndex}. ` : \"\"}\n+                        {displayName}\n+                      </div>\n+                    </button>\n+                  );\n+                })}\n+              </div>\n+            </div>\n+          );\n+        })}\n+      </div>\n+    </div>\n+  );\n+}\ndiff --git a/apps/www/components/pr/pull-request-diff-viewer.tsx b/apps/www/components/pr/pull-request-diff-viewer.tsx\nindex d1cd5ebe1..2c9d8f964 100644\n--- a/apps/www/components/pr/pull-request-diff-viewer.tsx\n+++ b/apps/www/components/pr/pull-request-diff-viewer.tsx\n@@ -89,6 +89,7 @@ import {\n   ReviewCompletionNotificationCard,\n   type ReviewCompletionNotificationCardState,\n } from \"./review-completion-notification-card\";\n+import { PrScreenshotGallery } from \"./pr-screenshot-gallery\";\n import clsx from \"clsx\";\n import { kitties } from \"./kitty\";\n import {\n@@ -1022,6 +1023,26 @@ export function PullRequestDiffViewer({\n   const fileOutputs =\n     normalizedJobType === \"comparison\" ? comparisonFileOutputs : prFileOutputs;\n \n+  // Fetch screenshots for the PR\n+  const screenshotQueryArgs = useMemo(\n+    () =>\n+      normalizedJobType !== \"pull_request\" ||\n+      prNumber === null ||\n+      prNumber === undefined\n+        ? (\"skip\" as const)\n+        : {\n+            teamSlugOrId,\n+            repoFullName,\n+            prNumber,\n+          },\n+    [normalizedJobType, teamSlugOrId, repoFullName, prNumber]\n+  );\n+\n+  const screenshotSets = useConvexQuery(\n+    api.codeReview.getScreenshotSetsForPr,\n+    screenshotQueryArgs\n+  );\n+\n   const fileOutputIndex = useMemo(() => {\n     if (!fileOutputs) {\n       return new Map<string, FileOutput>();\n@@ -2187,6 +2208,9 @@ export function PullRequestDiffViewer({\n                 selectedModel={heatmapModelPreference}\n                 onModelChange={handleHeatmapModelPreferenceChange}\n               />\n+              {screenshotSets && screenshotSets.length > 0 ? (\n+                <PrScreenshotGallery screenshotSets={screenshotSets} />\n+              ) : null}\n               <CmuxPromoCard />\n               {targetCount > 0 ? (\n                 <div className=\"flex justify-center\">\ndiff --git a/packages/convex/convex/codeReview.ts b/packages/convex/convex/codeReview.ts\nindex 44fc8af45..a6b5fb225 100644\n--- a/packages/convex/convex/codeReview.ts\n+++ b/packages/convex/convex/codeReview.ts\n@@ -1095,3 +1095,125 @@ export const listFileOutputsForComparison = authQuery({\n     }));\n   },\n });\n+\n+/**\n+ * Get screenshot sets for a PR.\n+ * This is a public query that doesn't require authentication,\n+ * similar to how the heatmap data is fetched for public repos.\n+ */\n+export const getScreenshotSetsForPr = authQuery({\n+  args: {\n+    teamSlugOrId: v.string(),\n+    repoFullName: v.string(),\n+    prNumber: v.number(),\n+    limit: v.optional(v.number()),\n+  },\n+  handler: async (ctx, args) => {\n+    const limit = Math.min(args.limit ?? 10, 50);\n+    const normalizedRepoFullName = args.repoFullName.trim().toLowerCase();\n+\n+    // Try to find a teamId if possible\n+    let teamId: string | undefined;\n+    try {\n+      teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    } catch {\n+      // If team resolution fails, we'll proceed without it\n+      // This allows the query to work for public repos\n+    }\n+\n+    // Find preview configs for this repo\n+    const previewConfigs = teamId\n+      ? await ctx.db\n+          .query(\"previewConfigs\")\n+          .withIndex(\"by_team_repo\", (q) =>\n+            q.eq(\"teamId\", teamId).eq(\"repoFullName\", normalizedRepoFullName)\n+          )\n+          .collect()\n+      : [];\n+\n+    if (previewConfigs.length === 0) {\n+      return [];\n+    }\n+\n+    // Find preview runs for this PR from any of the configs\n+    const allScreenshotSets: Array<{\n+      _id: string;\n+      status: \"completed\" | \"failed\" | \"skipped\";\n+      commitSha: string | null;\n+      capturedAt: number;\n+      error: string | null;\n+      images: Array<{\n+        storageId: string;\n+        mimeType: string;\n+        fileName: string | null;\n+        commitSha: string | null;\n+        url: string | null;\n+      }>;\n+      previewRunId: string | null;\n+      prNumber: number;\n+    }> = [];\n+\n+    for (const config of previewConfigs) {\n+      // Get preview runs for this PR\n+      const previewRuns = await ctx.db\n+        .query(\"previewRuns\")\n+        .withIndex(\"by_config_pr\", (q) =>\n+          q.eq(\"previewConfigId\", config._id).eq(\"prNumber\", args.prNumber)\n+        )\n+        .order(\"desc\")\n+        .take(limit);\n+\n+      // Get screenshot sets for runs that have them\n+      for (const run of previewRuns) {\n+        if (!run.screenshotSetId) {\n+          continue;\n+        }\n+\n+        const screenshotSet = await ctx.db.get(run.screenshotSetId);\n+        if (!screenshotSet) {\n+          continue;\n+        }\n+\n+        // Get signed URLs for images\n+        const imagesWithUrls = await Promise.all(\n+          screenshotSet.images.map(async (image) => {\n+            const url = await ctx.storage.getUrl(image.storageId);\n+            return {\n+              storageId: image.storageId as string,\n+              mimeType: image.mimeType,\n+              fileName: image.fileName ?? null,\n+              commitSha: image.commitSha ?? null,\n+              url: url ?? null,\n+            };\n+          })\n+        );\n+\n+        allScreenshotSets.push({\n+          _id: screenshotSet._id as string,\n+          status: screenshotSet.status,\n+          commitSha: screenshotSet.commitSha ?? null,\n+          capturedAt: screenshotSet.capturedAt,\n+          error: screenshotSet.error ?? null,\n+          images: imagesWithUrls,\n+          previewRunId: run._id as string,\n+          prNumber: run.prNumber,\n+        });\n+      }\n+    }\n+\n+    // Sort by capturedAt descending and deduplicate by screenshot set ID\n+    const seenIds = new Set<string>();\n+    const dedupedSets = allScreenshotSets\n+      .sort((a, b) => b.capturedAt - a.capturedAt)\n+      .filter((set) => {\n+        if (seenIds.has(set._id)) {\n+          return false;\n+        }\n+        seenIds.add(set._id);\n+        return true;\n+      })\n+      .slice(0, limit);\n+\n+    return dedupedSets;\n+  },\n+});\n","comments":[{"type":"issue_comment","id":3610573327,"prNumber":1159,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn786p102thh8p4xaevjytv2r97wn2f3?src=preview.new) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn786p102thh8p4xaevjytv2r97wn2f3/browser?src=preview.new) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1159?src=preview.new)\n\n\n\nCaptured 13 screenshots for commit `2567a3a` (2025-12-04 06:52:15.946 UTC).\n\n![dashboard-initial.png](https://famous-camel-162.convex.cloud/api/storage/cf9494f5-c955-4331-81c6-1b7be56387ea)\n\n![heatmap-page.png](https://famous-camel-162.convex.cloud/api/storage/21c7ad86-3c02-47b6-b306-7e9f6b9e9f32)\n\n![pr-1141-viewport.png](https://famous-camel-162.convex.cloud/api/storage/66b30089-1e5c-4fda-9aaf-f9456e9587bf)\n\n![pr-page-full-view.png](https://famous-camel-162.convex.cloud/api/storage/a776e6d5-2d16-44c8-a404-fe9c7db3788c)\n\n![pr-page-loading.png](https://famous-camel-162.convex.cloud/api/storage/f1e41efb-09c7-497a-a786-ac90f3cd19f7)\n\n**Preview configuration page showing the cmux application interface where users can set up screenshot previews for GitHub repositories**\n\n![preview-page-initial.png](https://famous-camel-162.convex.cloud/api/storage/db2e3215-f186-4571-b53f-690a314e0168)\n\n**Close-up view of the Screenshot Gallery component showing the 'Screenshots' header, capture count, and screenshot sets with status badges (Completed, Latest, Failed)**\n\n![screenshot-gallery-component-closeup.png](https://famous-camel-162.convex.cloud/api/storage/039455c0-956f-48dc-bb89-43f7a10e1362)\n\n**Full page view of the Screenshot Gallery component demo showing all features including the gallery interface, status badges, timestamps, and thumbnail navigation**\n\n![screenshot-gallery-demo-full.png](https://famous-camel-162.convex.cloud/api/storage/2763ecf6-b6ad-4691-b74b-b56f7b3222ed)\n\n**Detailed view of the Screenshot Gallery key features including latest highlight, status indicators, timestamps, commit SHAs, thumbnail previews, and error handling**\n\n![screenshot-gallery-features.png](https://famous-camel-162.convex.cloud/api/storage/7e3ba5ff-b653-4b02-a296-a53612802966)\n\n**In-context view of the Screenshot Gallery within the PR review interface, highlighting its placement in the sidebar and integration with the diff viewer**\n\n![screenshot-gallery-in-context.png](https://famous-camel-162.convex.cloud/api/storage/8b7424c4-71de-421c-b64a-4065ecd14d7e)\n\n**Full integration view showing how the Screenshot Gallery component appears in the PR review page context, including the sidebar file tree and diff viewer**\n\n![screenshot-gallery-integration-full.png](https://famous-camel-162.convex.cloud/api/storage/40355192-3bad-483c-9b67-229d172c7a0d)\n\n**Screenshot Lightbox features overview showing zoom controls, navigation options, interaction methods, and information display capabilities**\n\n![screenshot-gallery-lightbox-features.png](https://famous-camel-162.convex.cloud/api/storage/1b0ad4f8-f6c4-4cd6-991d-e6be8fece08e)\n\n**Technical implementation details including component structure, integration with PullRequestDiffViewer, Convex query integration, and key technical features**\n\n![screenshot-gallery-technical-details.png](https://famous-camel-162.convex.cloud/api/storage/d387f8ef-996f-45c9-af75-2cf48c729e74)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"2567a3aee1f5648a6ccd470e1ed48e71ad052d66","createdAt":"2025-12-04T06:52:18Z","updatedAt":"2025-12-04T06:52:18Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1159#issuecomment-3610573327"}]}
{"number":1158,"title":"Unify preview tmux session and scripts","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1158","headRef":"cmux/unify-preview-tmux-session-and-scripts-ermun","headSha":"89b00ec193fe82d9770092d9f90f1aa79ee6f5f2","baseRef":"main","baseSha":"1ac66708f1f671e0497dabada5b71e388e21cfa9","createdAt":"2025-12-04T04:25:39Z","updatedAt":"2025-12-04T05:27:57Z","diff":"diff --git a/apps/www/lib/routes/sandboxes/startDevAndMaintenanceScript.ts b/apps/www/lib/routes/sandboxes/startDevAndMaintenanceScript.ts\nindex 998013775..b766153bb 100644\n--- a/apps/www/lib/routes/sandboxes/startDevAndMaintenanceScript.ts\n+++ b/apps/www/lib/routes/sandboxes/startDevAndMaintenanceScript.ts\n@@ -87,6 +87,10 @@ export async function runMaintenanceAndDevScripts({\n   const maintenanceScriptContent = hasMaintenanceScript\n     ? `#!/bin/zsh\n set -eux\n+\n+# Source system profile for environment variables (RUSTUP_HOME, etc.)\n+[[ -f /etc/profile ]] && source /etc/profile\n+\n cd ${WORKSPACE_ROOT}\n \n echo \"=== Maintenance Script Started at \\\\$(date) ===\"\n@@ -99,6 +103,10 @@ echo \"=== Maintenance Script Completed at \\\\$(date) ===\"\n   const devScriptContent = hasDevScript\n     ? `#!/bin/zsh\n set -ux\n+\n+# Source system profile for environment variables (RUSTUP_HOME, etc.)\n+[[ -f /etc/profile ]] && source /etc/profile\n+\n cd ${WORKSPACE_ROOT}\n \n echo \"=== Dev Script Started at \\\\$(date) ===\"\ndiff --git a/packages/convex/convex/preview_jobs_worker.ts b/packages/convex/convex/preview_jobs_worker.ts\nindex 52432ab38..bf6f11211 100644\n--- a/packages/convex/convex/preview_jobs_worker.ts\n+++ b/packages/convex/convex/preview_jobs_worker.ts\n@@ -479,10 +479,11 @@ async function ensureTmuxSession({\n   repoDir: string;\n   previewRunId: Id<\"previewRuns\">;\n }): Promise<void> {\n+  // Match the orchestrator: create session with -n main for the initial window\n   const sessionCmd = [\n-    \"bash\",\n+    \"zsh\",\n     \"-lc\",\n-    `tmux has-session -t cmux 2>/dev/null || tmux new-session -d -s cmux -c ${singleQuote(repoDir)}`,\n+    `tmux has-session -t cmux 2>/dev/null || tmux new-session -d -s cmux -c ${singleQuote(repoDir)} -n main`,\n   ];\n   const response = await execInstanceInstanceIdExecPost({\n     client: morphClient,\n@@ -500,6 +501,10 @@ async function ensureTmuxSession({\n   }\n }\n \n+// Constants matching the environment orchestrator script\n+const MAINTENANCE_WINDOW_NAME = \"maintenance\";\n+const DEV_WINDOW_NAME = \"dev\";\n+\n async function runScriptInTmuxWindow({\n   morphClient,\n   instanceId,\n@@ -507,6 +512,7 @@ async function runScriptInTmuxWindow({\n   windowName,\n   scriptContent,\n   previewRunId,\n+  useSetE = true,\n }: {\n   morphClient: ReturnType<typeof createMorphCloudClient>;\n   instanceId: string;\n@@ -514,31 +520,90 @@ async function runScriptInTmuxWindow({\n   windowName: string;\n   scriptContent: string;\n   previewRunId: Id<\"previewRuns\">;\n+  useSetE?: boolean;\n }): Promise<void> {\n   const trimmed = scriptContent.trim();\n   if (!trimmed) {\n     return;\n   }\n \n-  const scriptBase64 = stringToBase64(trimmed);\n-  const command = [\n-    \"bash\",\n-    \"-lc\",\n-    [\n-      `SESSION=\\\"cmux\\\"`,\n-      `WINDOW=${singleQuote(windowName)}`,\n-      `tmux has-session -t \\\"$SESSION\\\" 2>/dev/null || tmux new-session -d -s \\\"$SESSION\\\" -c ${singleQuote(repoDir)}`,\n-      `tmux new-window -t \\\"$SESSION\\\" -n \\\"$WINDOW\\\" -c ${singleQuote(repoDir)}`,\n-      `echo '${scriptBase64}' | base64 -d > /tmp/cmux-${windowName}.sh`,\n-      `chmod +x /tmp/cmux-${windowName}.sh`,\n-      `tmux send-keys -t \\\"$SESSION\\\":\\\"$WINDOW\\\" \"bash /tmp/cmux-${windowName}.sh\" C-m`,\n-    ].join(\" && \"),\n-  ];\n+  // Create script wrapper matching the environment orchestrator format\n+  // Source /etc/profile to get system environment variables like RUSTUP_HOME\n+  const setFlags = useSetE ? \"set -eux\" : \"set -ux\";\n+  const wrappedScript = `#!/bin/zsh\n+${setFlags}\n+\n+# Source system profile for environment variables (RUSTUP_HOME, etc.)\n+[[ -f /etc/profile ]] && source /etc/profile\n+\n+cd ${repoDir}\n+\n+echo \"=== ${windowName} Script Started at $(date) ===\"\n+${trimmed}\n+${useSetE ? `echo \"=== ${windowName} Script Completed at $(date) ===\"` : \"\"}\n+`;\n+\n+  const runtimeDir = \"/var/tmp/cmux-scripts\";\n+  const runId = `${Date.now().toString(36)}_${Math.random().toString(36).slice(2, 8)}`;\n+  const scriptFilePath = `${runtimeDir}/${windowName}.sh`;\n+  const launcherScriptPath = `${runtimeDir}/${windowName}-launcher.sh`;\n+  const logFilePath = `${runtimeDir}/${windowName}_${runId}.log`;\n+  const exitCodePath = `${runtimeDir}/${windowName}_${runId}.exit-code`;\n+\n+  // Create a launcher script that runs INSIDE the VM to handle tmux operations\n+  // This matches how the environment orchestrator works - it runs tmux commands\n+  // from within a shell process inside the VM, not via exec API\n+  const launcherScript = `#!/bin/zsh\n+set -eu\n+\n+# Create the tmux window\n+tmux new-window -t cmux: -n '${windowName}' -d\n+\n+# Send keys to run the script (matching orchestrator pattern exactly)\n+# Pattern: zsh 'script.sh' 2>&1 | tee 'log'; echo \\${pipestatus[1]} > 'exit-code'\n+tmux send-keys -t cmux:'${windowName}' \"zsh '${scriptFilePath}' 2>&1 | tee '${logFilePath}'; echo \\\\\\${pipestatus[1]} > '${exitCodePath}'\" C-m\n+\n+echo \"[launcher] Started ${windowName} window\"\n+`;\n+\n+  // Build a setup command that writes both scripts and runs the launcher in background\n+  // The key insight: Morph exec API doesn't have a TTY, but a background process can\n+  // interact with tmux properly. This matches the sandbox orchestrator pattern.\n+  const setupCommand = `\n+set -eu\n+mkdir -p '${runtimeDir}'\n+\n+# Write the main script\n+cat > '${scriptFilePath}' <<'SCRIPT_EOF'\n+${wrappedScript}\n+SCRIPT_EOF\n+chmod +x '${scriptFilePath}'\n+\n+# Write the launcher script\n+cat > '${launcherScriptPath}' <<'LAUNCHER_EOF'\n+${launcherScript}\n+LAUNCHER_EOF\n+chmod +x '${launcherScriptPath}'\n+\n+# Run the launcher in background (like sandbox orchestrator does with nohup)\n+nohup zsh '${launcherScriptPath}' > '${runtimeDir}/${windowName}-launcher.log' 2>&1 &\n+LAUNCHER_PID=$!\n+\n+# Give it a moment to start\n+sleep 1\n+\n+# Verify it started\n+if kill -0 $LAUNCHER_PID 2>/dev/null; then\n+  echo \"[setup] Launcher started (PID: $LAUNCHER_PID)\"\n+else\n+  echo \"[setup] Launcher may have completed or failed, check log\" >&2\n+fi\n+`;\n \n   const response = await execInstanceInstanceIdExecPost({\n     client: morphClient,\n     path: { instance_id: instanceId },\n-    body: { command },\n+    body: { command: [\"zsh\", \"-lc\", setupCommand] },\n   });\n \n   if (response.error || response.data?.exit_code !== 0) {\n@@ -1164,9 +1229,10 @@ export async function runPreviewJob(\n           morphClient,\n           instanceId: instance.id,\n           repoDir,\n-          windowName: \"maintenance\",\n+          windowName: MAINTENANCE_WINDOW_NAME,\n           scriptContent: environment.maintenanceScript,\n           previewRunId,\n+          useSetE: true,\n         });\n       }\n \n@@ -1175,9 +1241,10 @@ export async function runPreviewJob(\n           morphClient,\n           instanceId: instance.id,\n           repoDir,\n-          windowName: \"devserver\",\n+          windowName: DEV_WINDOW_NAME,\n           scriptContent: environment.devScript,\n           previewRunId,\n+          useSetE: false, // Dev script runs indefinitely, don't exit on error\n         });\n       }\n \n","comments":[{"type":"issue_comment","id":3610149130,"prNumber":1158,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn73zbq7eemxwhh98k0q0vft557wmhk9?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn73zbq7eemxwhh98k0q0vft557wmhk9/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1158?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"89b00ec193fe82d9770092d9f90f1aa79ee6f5f2","createdAt":"2025-12-04T05:01:02Z","updatedAt":"2025-12-04T05:27:20Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1158#issuecomment-3610149130"},{"type":"issue_comment","id":3610278619,"prNumber":1158,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn7f4m1pqcphp1qvh09w8m7w317wmgtw?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn7f4m1pqcphp1qvh09w8m7w317wmgtw/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1158?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 3 screenshots for commit `89b00ec` (2025-12-04 05:27:17.458 UTC).\n\n**Close-up view of the AlertDialog component showing the delete confirmation message with Cancel and Delete buttons, featuring improved accessibility and structure**\n\n![preview-dashboard-delete-dialog-close-up.png](https://adorable-wombat-701.convex.cloud/api/storage/231963d9-3a5f-40a6-8c59-c1ba791fb11e)\n\n**Full page view of the delete confirmation dialog using the new AlertDialog component, showing the modal overlay and dialog asking to confirm deletion of manaflow-ai/cmux repository**\n\n![preview-dashboard-delete-dialog.png](https://adorable-wombat-701.convex.cloud/api/storage/e808a055-bbfa-47e6-8ef1-2b2bfd14cde7)\n\n**Preview dashboard main view showing configured repositories \\(manaflow-ai/cmux and austinywang/landing\\) with delete and settings buttons**\n\n![preview-dashboard-main-view.png](https://adorable-wombat-701.convex.cloud/api/storage/1877b4fb-8569-4c77-8861-974cc197cc35)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"89b00ec193fe82d9770092d9f90f1aa79ee6f5f2","createdAt":"2025-12-04T05:27:20Z","updatedAt":"2025-12-04T05:27:20Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1158#issuecomment-3610278619"}]}
{"number":1156,"title":"Add waitlist handling for GitLab and Bitbucket","state":"open","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1156","headRef":"cmux/add-waitlist-handling-for-git-lab-and-bitbucket-rocsl","headSha":"5fc636761158279f790e4b7bb4a0d3d0133bb50e","baseRef":"main","baseSha":"1e277427fa54e537a664bff7805ebbbd4b14f8b9","createdAt":"2025-12-04T03:53:48Z","updatedAt":"2025-12-04T04:03:33Z","diff":"diff --git a/apps/www/components/preview/preview-dashboard.tsx b/apps/www/components/preview/preview-dashboard.tsx\nindex da07882c9..ed5e33419 100644\n--- a/apps/www/components/preview/preview-dashboard.tsx\n+++ b/apps/www/components/preview/preview-dashboard.tsx\n@@ -5,6 +5,7 @@ import {\n   ArrowLeft,\n   Camera,\n   CheckCircle2,\n+  Clock,\n   ExternalLink,\n   Github,\n   Link2,\n@@ -14,6 +15,7 @@ import {\n   Server,\n   Star,\n   Trash2,\n+  X,\n } from \"lucide-react\";\n import Link from \"next/link\";\n import clsx from \"clsx\";\n@@ -74,6 +76,13 @@ type PreviewDashboardProps = {\n \n const ADD_INSTALLATION_VALUE = \"__add_github_account__\";\n \n+type WaitlistProvider = \"gitlab\" | \"bitbucket\";\n+\n+const WAITLIST_PROVIDER_INFO: Record<WaitlistProvider, { name: string; color: string }> = {\n+  gitlab: { name: \"GitLab\", color: \"#fc6d26\" },\n+  bitbucket: { name: \"Bitbucket\", color: \"#0052cc\" },\n+};\n+\n type FeatureCardProps = {\n   icon: LucideIcon;\n   iconBgColor: string;\n@@ -203,6 +212,121 @@ function PopupCompleteView() {\n   );\n }\n \n+type WaitlistModalProps = {\n+  provider: WaitlistProvider;\n+  onClose: () => void;\n+};\n+\n+function WaitlistModal({ provider, onClose }: WaitlistModalProps) {\n+  const [email, setEmail] = useState(\"\");\n+  const [isSubmitting, setIsSubmitting] = useState(false);\n+  const [isSubmitted, setIsSubmitted] = useState(false);\n+  const [error, setError] = useState<string | null>(null);\n+\n+  const providerInfo = WAITLIST_PROVIDER_INFO[provider];\n+\n+  const handleSubmit = async (e: React.FormEvent) => {\n+    e.preventDefault();\n+    if (!email.trim()) return;\n+\n+    setIsSubmitting(true);\n+    setError(null);\n+\n+    try {\n+      const response = await fetch(\"/api/preview/waitlist\", {\n+        method: \"POST\",\n+        headers: { \"Content-Type\": \"application/json\" },\n+        body: JSON.stringify({ email: email.trim(), provider }),\n+      });\n+\n+      if (!response.ok) {\n+        const text = await response.text();\n+        throw new Error(text || \"Failed to join waitlist\");\n+      }\n+\n+      setIsSubmitted(true);\n+    } catch (err) {\n+      const message = err instanceof Error ? err.message : \"Something went wrong\";\n+      console.error(\"[WaitlistModal] Failed to submit\", err);\n+      setError(message);\n+    } finally {\n+      setIsSubmitting(false);\n+    }\n+  };\n+\n+  return (\n+    <div\n+      className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm px-4 py-6\"\n+      onClick={onClose}\n+    >\n+      <div\n+        className=\"w-full max-w-md rounded-lg border border-white/10 bg-neutral-900 px-6 py-5 shadow-2xl\"\n+        onClick={(e) => e.stopPropagation()}\n+      >\n+        <div className=\"flex items-start justify-between\">\n+          <div className=\"flex items-start gap-3\">\n+            <div\n+              className=\"rounded-full p-2\"\n+              style={{ backgroundColor: `${providerInfo.color}20` }}\n+            >\n+              <Clock className=\"h-5 w-5\" style={{ color: providerInfo.color }} />\n+            </div>\n+            <div>\n+              <h3 className=\"text-lg font-semibold text-white\">\n+                {providerInfo.name} support coming soon\n+              </h3>\n+              <p className=\"pt-1 text-sm text-neutral-400\">\n+                We&apos;re working on {providerInfo.name} integration. Join the waitlist to get notified when it&apos;s ready.\n+              </p>\n+            </div>\n+          </div>\n+          <button\n+            type=\"button\"\n+            onClick={onClose}\n+            className=\"p-1 text-neutral-500 hover:text-white transition-colors\"\n+          >\n+            <X className=\"h-5 w-5\" />\n+          </button>\n+        </div>\n+\n+        {isSubmitted ? (\n+          <div className=\"pt-5 flex items-center gap-2 text-emerald-400\">\n+            <CheckCircle2 className=\"h-5 w-5\" />\n+            <span className=\"text-sm\">You&apos;re on the list! We&apos;ll notify you when {providerInfo.name} is ready.</span>\n+          </div>\n+        ) : (\n+          <form onSubmit={handleSubmit} className=\"pt-5\">\n+            <div className=\"flex gap-2\">\n+              <input\n+                type=\"email\"\n+                value={email}\n+                onChange={(e) => setEmail(e.target.value)}\n+                placeholder=\"Enter your email\"\n+                required\n+                className=\"flex-1 h-10 rounded-md border border-white/10 bg-white/5 px-3 text-sm text-white placeholder:text-neutral-500 focus:border-white/20 focus:outline-none\"\n+              />\n+              <Button\n+                type=\"submit\"\n+                disabled={isSubmitting || !email.trim()}\n+                className=\"h-10 px-4 bg-white text-black hover:bg-neutral-200\"\n+              >\n+                {isSubmitting ? (\n+                  <Loader2 className=\"h-4 w-4 animate-spin\" />\n+                ) : (\n+                  \"Join waitlist\"\n+                )}\n+              </Button>\n+            </div>\n+            {error && (\n+              <p className=\"pt-2 text-sm text-red-400\">{error}</p>\n+            )}\n+          </form>\n+        )}\n+      </div>\n+    </div>\n+  );\n+}\n+\n /** Opens a centered popup window */\n function openCenteredPopup(\n   url: string,\n@@ -272,6 +396,9 @@ function PreviewDashboardInner({\n   // OAuth sign-in with popup\n   const { signInWithPopup, signingInProvider } = useOAuthPopup();\n \n+  // Waitlist modal state for GitLab/Bitbucket\n+  const [waitlistProvider, setWaitlistProvider] = useState<WaitlistProvider | null>(null);\n+\n   // Public URL input state\n   const [repoUrlInput, setRepoUrlInput] = useState(\"\");\n \n@@ -688,61 +815,53 @@ function PreviewDashboardInner({\n           Continue with GitHub\n         </Button>\n         <Button\n-          onClick={() => signInWithPopup(\"gitlab\")}\n+          onClick={() => setWaitlistProvider(\"gitlab\")}\n           disabled={signingInProvider !== null}\n           className=\"w-full h-10 bg-[#fc6d26] text-white hover:bg-[#ff8245] inline-flex items-center justify-center gap-2 disabled:opacity-50\"\n         >\n-          {signingInProvider === \"gitlab\" ? (\n-            <Loader2 className=\"h-4 w-4 animate-spin\" />\n-          ) : (\n-            <svg\n-              className=\"h-4 w-4 shrink-0\"\n-              viewBox=\"90 90 200 175\"\n-              fill=\"currentColor\"\n-            >\n-              <path d=\"M282.83,170.73l-.27-.69-26.14-68.22a6.81,6.81,0,0,0-2.69-3.24,7,7,0,0,0-8,.43,7,7,0,0,0-2.32,3.52l-17.65,54H154.29l-17.65-54A6.86,6.86,0,0,0,134.32,99a7,7,0,0,0-8-.43,6.87,6.87,0,0,0-2.69,3.24L97.44,170l-.26.69a48.54,48.54,0,0,0,16.1,56.1l.09.07.24.17,39.82,29.82,19.7,14.91,12,9.06a8.07,8.07,0,0,0,9.76,0l12-9.06,19.7-14.91,40.06-30,.1-.08A48.56,48.56,0,0,0,282.83,170.73Z\" />\n-            </svg>\n-          )}\n+          <svg\n+            className=\"h-4 w-4 shrink-0\"\n+            viewBox=\"90 90 200 175\"\n+            fill=\"currentColor\"\n+          >\n+            <path d=\"M282.83,170.73l-.27-.69-26.14-68.22a6.81,6.81,0,0,0-2.69-3.24,7,7,0,0,0-8,.43,7,7,0,0,0-2.32,3.52l-17.65,54H154.29l-17.65-54A6.86,6.86,0,0,0,134.32,99a7,7,0,0,0-8-.43,6.87,6.87,0,0,0-2.69,3.24L97.44,170l-.26.69a48.54,48.54,0,0,0,16.1,56.1l.09.07.24.17,39.82,29.82,19.7,14.91,12,9.06a8.07,8.07,0,0,0,9.76,0l12-9.06,19.7-14.91,40.06-30,.1-.08A48.56,48.56,0,0,0,282.83,170.73Z\" />\n+          </svg>\n           Continue with GitLab\n         </Button>\n         <Button\n-          onClick={() => signInWithPopup(\"bitbucket\")}\n+          onClick={() => setWaitlistProvider(\"bitbucket\")}\n           disabled={signingInProvider !== null}\n           className=\"w-full h-10 bg-[#0052cc] text-white hover:bg-[#006cf2] inline-flex items-center justify-center gap-2 disabled:opacity-50\"\n         >\n-          {signingInProvider === \"bitbucket\" ? (\n-            <Loader2 className=\"h-4 w-4 animate-spin\" />\n-          ) : (\n-            <svg className=\"h-4 w-4 shrink-0\" viewBox=\"-2 -2 65 59\">\n-              <defs>\n-                <linearGradient\n-                  id=\"bitbucket-grad\"\n-                  x1=\"104.953%\"\n-                  x2=\"46.569%\"\n-                  y1=\"21.921%\"\n-                  y2=\"75.234%\"\n-                >\n-                  <stop\n-                    offset=\"7%\"\n-                    stopColor=\"currentColor\"\n-                    stopOpacity=\"0.4\"\n-                  />\n-                  <stop offset=\"100%\" stopColor=\"currentColor\" />\n-                </linearGradient>\n-              </defs>\n-              <path\n-                d=\"M59.696 18.86h-18.77l-3.15 18.39h-13L9.426 55.47a2.71 2.71 0 001.75.66h40.74a2 2 0 002-1.68l5.78-35.59z\"\n-                fill=\"url(#bitbucket-grad)\"\n-                fillRule=\"nonzero\"\n-                transform=\"translate(-.026 .82)\"\n-              />\n-              <path\n-                d=\"M2 .82a2 2 0 00-2 2.32l8.49 51.54a2.7 2.7 0 00.91 1.61 2.71 2.71 0 001.75.66l15.76-18.88H24.7l-3.47-18.39h38.44l2.7-16.53a2 2 0 00-2-2.32L2 .82z\"\n-                fill=\"currentColor\"\n-                fillRule=\"nonzero\"\n-              />\n-            </svg>\n-          )}\n+          <svg className=\"h-4 w-4 shrink-0\" viewBox=\"-2 -2 65 59\">\n+            <defs>\n+              <linearGradient\n+                id=\"bitbucket-grad\"\n+                x1=\"104.953%\"\n+                x2=\"46.569%\"\n+                y1=\"21.921%\"\n+                y2=\"75.234%\"\n+              >\n+                <stop\n+                  offset=\"7%\"\n+                  stopColor=\"currentColor\"\n+                  stopOpacity=\"0.4\"\n+                />\n+                <stop offset=\"100%\" stopColor=\"currentColor\" />\n+              </linearGradient>\n+            </defs>\n+            <path\n+              d=\"M59.696 18.86h-18.77l-3.15 18.39h-13L9.426 55.47a2.71 2.71 0 001.75.66h40.74a2 2 0 002-1.68l5.78-35.59z\"\n+              fill=\"url(#bitbucket-grad)\"\n+              fillRule=\"nonzero\"\n+              transform=\"translate(-.026 .82)\"\n+            />\n+            <path\n+              d=\"M2 .82a2 2 0 00-2 2.32l8.49 51.54a2.7 2.7 0 00.91 1.61 2.71 2.71 0 001.75.66l15.76-18.88H24.7l-3.47-18.39h38.44l2.7-16.53a2 2 0 00-2-2.32L2 .82z\"\n+              fill=\"currentColor\"\n+              fillRule=\"nonzero\"\n+            />\n+          </svg>\n           Continue with Bitbucket\n         </Button>\n       </div>\n@@ -1224,6 +1343,13 @@ function PreviewDashboardInner({\n           </div>\n         </div>\n       )}\n+\n+      {waitlistProvider && (\n+        <WaitlistModal\n+          provider={waitlistProvider}\n+          onClose={() => setWaitlistProvider(null)}\n+        />\n+      )}\n     </div>\n   );\n }\ndiff --git a/apps/www/lib/routes/preview.route.ts b/apps/www/lib/routes/preview.route.ts\nindex a6ad48eae..5425c9c4b 100644\n--- a/apps/www/lib/routes/preview.route.ts\n+++ b/apps/www/lib/routes/preview.route.ts\n@@ -1,5 +1,5 @@\n import { getAccessTokenFromRequest } from \"@/lib/utils/auth\";\n-import { getConvex } from \"@/lib/utils/get-convex\";\n+import { getConvex, getPublicConvex } from \"@/lib/utils/get-convex\";\n import { verifyTeamAccess } from \"@/lib/utils/team-verification\";\n import { api } from \"@cmux/convex/api\";\n import type { Doc } from \"@cmux/convex/dataModel\";\n@@ -287,3 +287,53 @@ previewRouter.openapi(\n     return c.json({ runs: runs.map(formatPreviewRun) });\n   },\n );\n+\n+// Waitlist endpoint for GitLab/Bitbucket preview interest\n+const WaitlistBody = z\n+  .object({\n+    email: z.string().email(),\n+    provider: z.enum([\"gitlab\", \"bitbucket\"]),\n+  })\n+  .openapi(\"PreviewWaitlistBody\");\n+\n+previewRouter.openapi(\n+  createRoute({\n+    method: \"post\",\n+    path: \"/preview/waitlist\",\n+    tags: [\"Preview\"],\n+    summary: \"Join the preview waitlist for GitLab or Bitbucket\",\n+    request: {\n+      body: {\n+        content: {\n+          \"application/json\": {\n+            schema: WaitlistBody,\n+          },\n+        },\n+        required: true,\n+      },\n+    },\n+    responses: {\n+      200: {\n+        description: \"Successfully joined waitlist\",\n+        content: {\n+          \"application/json\": {\n+            schema: z.object({\n+              success: z.boolean(),\n+              alreadyRegistered: z.boolean(),\n+            }),\n+          },\n+        },\n+      },\n+      400: { description: \"Invalid request\" },\n+    },\n+  }),\n+  async (c) => {\n+    const body = c.req.valid(\"json\");\n+    const convex = getPublicConvex();\n+    const result = await convex.mutation(api.previewWaitlist.join, {\n+      email: body.email,\n+      provider: body.provider,\n+    });\n+    return c.json(result);\n+  },\n+);\ndiff --git a/apps/www/lib/utils/get-convex.ts b/apps/www/lib/utils/get-convex.ts\nindex 802c483f7..14a843d0b 100644\n--- a/apps/www/lib/utils/get-convex.ts\n+++ b/apps/www/lib/utils/get-convex.ts\n@@ -20,3 +20,25 @@ export function getConvex({ accessToken }: { accessToken: string }) {\n   convexClientCache.set(accessToken, env.NEXT_PUBLIC_CONVEX_URL, client);\n   return client;\n }\n+\n+const PUBLIC_CACHE_KEY = \"__public__\";\n+\n+/**\n+ * Get a Convex client for unauthenticated (public) access.\n+ * Use this for public mutations like waitlist signups.\n+ */\n+export function getPublicConvex() {\n+  // Try to get from cache first\n+  const cachedClient = convexClientCache.get(\n+    PUBLIC_CACHE_KEY,\n+    env.NEXT_PUBLIC_CONVEX_URL\n+  );\n+  if (cachedClient) {\n+    return cachedClient;\n+  }\n+\n+  // Create new client and cache it\n+  const client = new ConvexHttpClient(env.NEXT_PUBLIC_CONVEX_URL);\n+  convexClientCache.set(PUBLIC_CACHE_KEY, env.NEXT_PUBLIC_CONVEX_URL, client);\n+  return client;\n+}\ndiff --git a/packages/convex/convex/_generated/api.d.ts b/packages/convex/convex/_generated/api.d.ts\nindex e694bb11f..06ee47ee5 100644\n--- a/packages/convex/convex/_generated/api.d.ts\n+++ b/packages/convex/convex/_generated/api.d.ts\n@@ -39,6 +39,7 @@ import type * as migrations from \"../migrations.js\";\n import type * as previewConfigs from \"../previewConfigs.js\";\n import type * as previewRuns from \"../previewRuns.js\";\n import type * as previewScreenshots from \"../previewScreenshots.js\";\n+import type * as previewWaitlist from \"../previewWaitlist.js\";\n import type * as preview_jobs from \"../preview_jobs.js\";\n import type * as preview_jobs_http from \"../preview_jobs_http.js\";\n import type * as preview_jobs_worker from \"../preview_jobs_worker.js\";\n@@ -100,6 +101,7 @@ declare const fullApi: ApiFromModules<{\n   previewConfigs: typeof previewConfigs;\n   previewRuns: typeof previewRuns;\n   previewScreenshots: typeof previewScreenshots;\n+  previewWaitlist: typeof previewWaitlist;\n   preview_jobs: typeof preview_jobs;\n   preview_jobs_http: typeof preview_jobs_http;\n   preview_jobs_worker: typeof preview_jobs_worker;\ndiff --git a/packages/convex/convex/previewWaitlist.ts b/packages/convex/convex/previewWaitlist.ts\nnew file mode 100644\nindex 000000000..044c95602\n--- /dev/null\n+++ b/packages/convex/convex/previewWaitlist.ts\n@@ -0,0 +1,39 @@\n+import { v } from \"convex/values\";\n+import { mutation } from \"./_generated/server\";\n+\n+/**\n+ * Join the preview waitlist for GitLab or Bitbucket support.\n+ * This is a public mutation (no auth required).\n+ */\n+export const join = mutation({\n+  args: {\n+    email: v.string(),\n+    provider: v.union(v.literal(\"gitlab\"), v.literal(\"bitbucket\")),\n+  },\n+  returns: v.object({\n+    success: v.boolean(),\n+    alreadyRegistered: v.boolean(),\n+  }),\n+  handler: async (ctx, args) => {\n+    // Check if already registered\n+    const existing = await ctx.db\n+      .query(\"previewWaitlist\")\n+      .withIndex(\"by_email_provider\", (q) =>\n+        q.eq(\"email\", args.email).eq(\"provider\", args.provider)\n+      )\n+      .first();\n+\n+    if (existing) {\n+      return { success: true, alreadyRegistered: true };\n+    }\n+\n+    // Insert new waitlist entry\n+    await ctx.db.insert(\"previewWaitlist\", {\n+      email: args.email,\n+      provider: args.provider,\n+      createdAt: Date.now(),\n+    });\n+\n+    return { success: true, alreadyRegistered: false };\n+  },\n+});\ndiff --git a/packages/convex/convex/schema.ts b/packages/convex/convex/schema.ts\nindex 8b5b43981..fc0b1d853 100644\n--- a/packages/convex/convex/schema.ts\n+++ b/packages/convex/convex/schema.ts\n@@ -1042,6 +1042,15 @@ const convexSchema = defineSchema({\n     .index(\"by_statusId\", [\"statusId\"])\n     .index(\"by_sha_context\", [\"sha\", \"context\", \"updatedAt\"])\n     .index(\"by_sha\", [\"sha\", \"updatedAt\"]),\n+\n+  // Preview waitlist for GitLab/Bitbucket users\n+  previewWaitlist: defineTable({\n+    email: v.string(),\n+    provider: v.union(v.literal(\"gitlab\"), v.literal(\"bitbucket\")),\n+    createdAt: v.number(),\n+  })\n+    .index(\"by_email_provider\", [\"email\", \"provider\"])\n+    .index(\"by_provider\", [\"provider\", \"createdAt\"]),\n });\n \n export default convexSchema;\ndiff --git a/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts b/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts\nindex f99506014..407fc7f52 100644\n--- a/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts\n+++ b/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts\n@@ -1,8 +1,8 @@\n // This file is auto-generated by @hey-api/openapi-ts\n \n-import { type Options, getApiHealth, postApiAuthAnonymousSignUp, getApiUsers, postApiUsers, deleteApiUsersById, getApiUsersById, patchApiUsersById, getApiBooks, postApiBooks, getApiBooksById, postApiBooksByIdBorrow, postApiBooksByIdReturn, postApiDevServerStart, getApiIntegrationsGithubRepos, getApiIntegrationsGithubPrs, postApiIntegrationsGithubPrsBackfill, postApiIntegrationsGithubPrsBackfillRepo, getApiIntegrationsGithubPrsCode, postApiIntegrationsGithubPrsOpen, postApiIntegrationsGithubPrsMerge, postApiIntegrationsGithubPrsClose, postApiIntegrationsGithubPrsMergeSimple, getApiIntegrationsGithubPrsRaw, getApiIntegrationsGithubPrsFiles, getApiIntegrationsGithubPrsFileContents, postApiIntegrationsGithubPrsFileContentsBatch, postApiIntegrationsGithubInstallState, getApiIntegrationsGithubOauthToken, postApiMorphTaskRunsByTaskRunIdResume, postApiMorphTaskRunsByTaskRunIdIsPaused, postApiMorphSetupInstance, getApiEnvironments, postApiEnvironments, deleteApiEnvironmentsById, getApiEnvironmentsById, patchApiEnvironmentsById, getApiEnvironmentsByIdVars, patchApiEnvironmentsByIdPorts, getApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivate, postApiSandboxesStart, postApiSandboxesByIdEnv, postApiSandboxesByIdStop, getApiSandboxesByIdStatus, postApiSandboxesByIdPublishDevcontainer, postApiTeams, postApiBranchesGenerate, postApiCodeReviewStart, getApiWorkspaceConfigs, postApiWorkspaceConfigs, getApiPreviewConfigs, postApiPreviewConfigs, deleteApiPreviewConfigsByPreviewConfigId, getApiPreviewConfigsByPreviewConfigIdRuns } from '../sdk.gen.js';\n+import { type Options, getApiHealth, postApiAuthAnonymousSignUp, getApiUsers, postApiUsers, deleteApiUsersById, getApiUsersById, patchApiUsersById, getApiBooks, postApiBooks, getApiBooksById, postApiBooksByIdBorrow, postApiBooksByIdReturn, postApiDevServerStart, getApiIntegrationsGithubRepos, getApiIntegrationsGithubPrs, postApiIntegrationsGithubPrsBackfill, postApiIntegrationsGithubPrsBackfillRepo, getApiIntegrationsGithubPrsCode, postApiIntegrationsGithubPrsOpen, postApiIntegrationsGithubPrsMerge, postApiIntegrationsGithubPrsClose, postApiIntegrationsGithubPrsMergeSimple, getApiIntegrationsGithubPrsRaw, getApiIntegrationsGithubPrsFiles, getApiIntegrationsGithubPrsFileContents, postApiIntegrationsGithubPrsFileContentsBatch, postApiIntegrationsGithubInstallState, getApiIntegrationsGithubOauthToken, postApiMorphTaskRunsByTaskRunIdResume, postApiMorphTaskRunsByTaskRunIdIsPaused, postApiMorphSetupInstance, getApiEnvironments, postApiEnvironments, deleteApiEnvironmentsById, getApiEnvironmentsById, patchApiEnvironmentsById, getApiEnvironmentsByIdVars, patchApiEnvironmentsByIdPorts, getApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivate, postApiSandboxesStart, postApiSandboxesByIdEnv, postApiSandboxesByIdStop, getApiSandboxesByIdStatus, postApiSandboxesByIdPublishDevcontainer, postApiTeams, postApiBranchesGenerate, postApiCodeReviewStart, getApiWorkspaceConfigs, postApiWorkspaceConfigs, getApiPreviewConfigs, postApiPreviewConfigs, deleteApiPreviewConfigsByPreviewConfigId, getApiPreviewConfigsByPreviewConfigIdRuns, postApiPreviewWaitlist } from '../sdk.gen.js';\n import { queryOptions, type UseMutationOptions, type DefaultError, infiniteQueryOptions, type InfiniteData } from '@tanstack/react-query';\n-import type { GetApiHealthData, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponse, GetApiUsersData, GetApiUsersResponse, PostApiUsersData, PostApiUsersError, PostApiUsersResponse, DeleteApiUsersByIdData, DeleteApiUsersByIdError, DeleteApiUsersByIdResponse, GetApiUsersByIdData, PatchApiUsersByIdData, PatchApiUsersByIdError, PatchApiUsersByIdResponse, GetApiBooksData, PostApiBooksData, PostApiBooksError, PostApiBooksResponse, GetApiBooksByIdData, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowError, PostApiBooksByIdBorrowResponse, PostApiBooksByIdReturnData, PostApiBooksByIdReturnError, PostApiBooksByIdReturnResponse, PostApiDevServerStartData, PostApiDevServerStartError, PostApiDevServerStartResponse, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponse, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponse, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillRepoData, GetApiIntegrationsGithubPrsCodeData, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponse, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponse, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponse, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponse, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFileContentsData, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponse, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponse, GetApiIntegrationsGithubOauthTokenData, PostApiMorphTaskRunsByTaskRunIdResumeData, PostApiMorphTaskRunsByTaskRunIdResumeResponse, PostApiMorphTaskRunsByTaskRunIdIsPausedData, PostApiMorphTaskRunsByTaskRunIdIsPausedResponse, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponse, GetApiEnvironmentsData, PostApiEnvironmentsData, PostApiEnvironmentsResponse, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdData, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdVarsData, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponse, GetApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponse, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponse, PostApiSandboxesStartData, PostApiSandboxesStartResponse, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponse, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponse, GetApiSandboxesByIdStatusData, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponse, PostApiTeamsData, PostApiTeamsError, PostApiTeamsResponse, PostApiBranchesGenerateData, PostApiBranchesGenerateResponse, PostApiCodeReviewStartData, PostApiCodeReviewStartResponse, GetApiWorkspaceConfigsData, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponse, GetApiPreviewConfigsData, PostApiPreviewConfigsData, PostApiPreviewConfigsResponse, DeleteApiPreviewConfigsByPreviewConfigIdData, DeleteApiPreviewConfigsByPreviewConfigIdResponse, GetApiPreviewConfigsByPreviewConfigIdRunsData } from '../types.gen.js';\n+import type { GetApiHealthData, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponse, GetApiUsersData, GetApiUsersResponse, PostApiUsersData, PostApiUsersError, PostApiUsersResponse, DeleteApiUsersByIdData, DeleteApiUsersByIdError, DeleteApiUsersByIdResponse, GetApiUsersByIdData, PatchApiUsersByIdData, PatchApiUsersByIdError, PatchApiUsersByIdResponse, GetApiBooksData, PostApiBooksData, PostApiBooksError, PostApiBooksResponse, GetApiBooksByIdData, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowError, PostApiBooksByIdBorrowResponse, PostApiBooksByIdReturnData, PostApiBooksByIdReturnError, PostApiBooksByIdReturnResponse, PostApiDevServerStartData, PostApiDevServerStartError, PostApiDevServerStartResponse, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponse, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponse, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillRepoData, GetApiIntegrationsGithubPrsCodeData, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponse, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponse, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponse, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponse, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFileContentsData, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponse, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponse, GetApiIntegrationsGithubOauthTokenData, PostApiMorphTaskRunsByTaskRunIdResumeData, PostApiMorphTaskRunsByTaskRunIdResumeResponse, PostApiMorphTaskRunsByTaskRunIdIsPausedData, PostApiMorphTaskRunsByTaskRunIdIsPausedResponse, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponse, GetApiEnvironmentsData, PostApiEnvironmentsData, PostApiEnvironmentsResponse, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdData, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdVarsData, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponse, GetApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponse, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponse, PostApiSandboxesStartData, PostApiSandboxesStartResponse, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponse, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponse, GetApiSandboxesByIdStatusData, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponse, PostApiTeamsData, PostApiTeamsError, PostApiTeamsResponse, PostApiBranchesGenerateData, PostApiBranchesGenerateResponse, PostApiCodeReviewStartData, PostApiCodeReviewStartResponse, GetApiWorkspaceConfigsData, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponse, GetApiPreviewConfigsData, PostApiPreviewConfigsData, PostApiPreviewConfigsResponse, DeleteApiPreviewConfigsByPreviewConfigIdData, DeleteApiPreviewConfigsByPreviewConfigIdResponse, GetApiPreviewConfigsByPreviewConfigIdRunsData, PostApiPreviewWaitlistData, PostApiPreviewWaitlistResponse } from '../types.gen.js';\n import { client as _heyApiClient } from '../client.gen.js';\n \n export type QueryKey<TOptions extends Options> = [\n@@ -1152,4 +1152,21 @@ export const getApiPreviewConfigsByPreviewConfigIdRunsOptions = (options: Option\n         },\n         queryKey: getApiPreviewConfigsByPreviewConfigIdRunsQueryKey(options)\n     });\n+};\n+\n+/**\n+ * Join the preview waitlist for GitLab or Bitbucket\n+ */\n+export const postApiPreviewWaitlistMutation = (options?: Partial<Options<PostApiPreviewWaitlistData>>): UseMutationOptions<PostApiPreviewWaitlistResponse, DefaultError, Options<PostApiPreviewWaitlistData>> => {\n+    const mutationOptions: UseMutationOptions<PostApiPreviewWaitlistResponse, DefaultError, Options<PostApiPreviewWaitlistData>> = {\n+        mutationFn: async (fnOptions) => {\n+            const { data } = await postApiPreviewWaitlist({\n+                ...options,\n+                ...fnOptions,\n+                throwOnError: true\n+            });\n+            return data;\n+        }\n+    };\n+    return mutationOptions;\n };\n\\ No newline at end of file\ndiff --git a/packages/www-openapi-client/src/client/sdk.gen.ts b/packages/www-openapi-client/src/client/sdk.gen.ts\nindex 834397a27..c7c446aa2 100644\n--- a/packages/www-openapi-client/src/client/sdk.gen.ts\n+++ b/packages/www-openapi-client/src/client/sdk.gen.ts\n@@ -1,7 +1,7 @@\n // This file is auto-generated by @hey-api/openapi-ts\n \n import type { Options as ClientOptions, TDataShape, Client } from './client/index.js';\n-import type { GetApiHealthData, GetApiHealthResponses, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponses, PostApiAuthAnonymousSignUpErrors, GetApiUsersData, GetApiUsersResponses, PostApiUsersData, PostApiUsersResponses, PostApiUsersErrors, DeleteApiUsersByIdData, DeleteApiUsersByIdResponses, DeleteApiUsersByIdErrors, GetApiUsersByIdData, GetApiUsersByIdResponses, GetApiUsersByIdErrors, PatchApiUsersByIdData, PatchApiUsersByIdResponses, PatchApiUsersByIdErrors, GetApiBooksData, GetApiBooksResponses, PostApiBooksData, PostApiBooksResponses, PostApiBooksErrors, GetApiBooksByIdData, GetApiBooksByIdResponses, GetApiBooksByIdErrors, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowResponses, PostApiBooksByIdBorrowErrors, PostApiBooksByIdReturnData, PostApiBooksByIdReturnResponses, PostApiBooksByIdReturnErrors, PostApiDevServerStartData, PostApiDevServerStartResponses, PostApiDevServerStartErrors, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponses, GetApiIntegrationsGithubReposErrors, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponses, GetApiIntegrationsGithubPrsErrors, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillResponses, PostApiIntegrationsGithubPrsBackfillErrors, PostApiIntegrationsGithubPrsBackfillRepoData, PostApiIntegrationsGithubPrsBackfillRepoResponses, PostApiIntegrationsGithubPrsBackfillRepoErrors, GetApiIntegrationsGithubPrsCodeData, GetApiIntegrationsGithubPrsCodeResponses, GetApiIntegrationsGithubPrsCodeErrors, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponses, PostApiIntegrationsGithubPrsOpenErrors, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponses, PostApiIntegrationsGithubPrsMergeErrors, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponses, PostApiIntegrationsGithubPrsCloseErrors, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponses, PostApiIntegrationsGithubPrsMergeSimpleErrors, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsRawResponses, GetApiIntegrationsGithubPrsRawErrors, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFilesResponses, GetApiIntegrationsGithubPrsFilesErrors, GetApiIntegrationsGithubPrsFileContentsData, GetApiIntegrationsGithubPrsFileContentsResponses, GetApiIntegrationsGithubPrsFileContentsErrors, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponses, PostApiIntegrationsGithubPrsFileContentsBatchErrors, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponses, PostApiIntegrationsGithubInstallStateErrors, GetApiIntegrationsGithubOauthTokenData, GetApiIntegrationsGithubOauthTokenResponses, GetApiIntegrationsGithubOauthTokenErrors, PostApiMorphTaskRunsByTaskRunIdResumeData, PostApiMorphTaskRunsByTaskRunIdResumeResponses, PostApiMorphTaskRunsByTaskRunIdResumeErrors, PostApiMorphTaskRunsByTaskRunIdIsPausedData, PostApiMorphTaskRunsByTaskRunIdIsPausedResponses, PostApiMorphTaskRunsByTaskRunIdIsPausedErrors, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponses, PostApiMorphSetupInstanceErrors, GetApiIframePreflightData, GetApiIframePreflightResponses, GetApiIframePreflightErrors, GetApiEnvironmentsData, GetApiEnvironmentsResponses, GetApiEnvironmentsErrors, PostApiEnvironmentsData, PostApiEnvironmentsResponses, PostApiEnvironmentsErrors, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponses, DeleteApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdData, GetApiEnvironmentsByIdResponses, GetApiEnvironmentsByIdErrors, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponses, PatchApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdVarsData, GetApiEnvironmentsByIdVarsResponses, GetApiEnvironmentsByIdVarsErrors, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponses, PatchApiEnvironmentsByIdPortsErrors, GetApiEnvironmentsByIdSnapshotsData, GetApiEnvironmentsByIdSnapshotsResponses, GetApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponses, PostApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponses, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateErrors, PostApiSandboxesStartData, PostApiSandboxesStartResponses, PostApiSandboxesStartErrors, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponses, PostApiSandboxesByIdEnvErrors, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponses, PostApiSandboxesByIdStopErrors, GetApiSandboxesByIdStatusData, GetApiSandboxesByIdStatusResponses, GetApiSandboxesByIdStatusErrors, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponses, PostApiSandboxesByIdPublishDevcontainerErrors, PostApiTeamsData, PostApiTeamsResponses, PostApiTeamsErrors, PostApiBranchesGenerateData, PostApiBranchesGenerateResponses, PostApiBranchesGenerateErrors, PostApiCodeReviewStartData, PostApiCodeReviewStartResponses, PostApiCodeReviewStartErrors, GetApiWorkspaceConfigsData, GetApiWorkspaceConfigsResponses, GetApiWorkspaceConfigsErrors, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponses, PostApiWorkspaceConfigsErrors, GetApiPreviewConfigsData, GetApiPreviewConfigsResponses, GetApiPreviewConfigsErrors, PostApiPreviewConfigsData, PostApiPreviewConfigsResponses, PostApiPreviewConfigsErrors, DeleteApiPreviewConfigsByPreviewConfigIdData, DeleteApiPreviewConfigsByPreviewConfigIdResponses, DeleteApiPreviewConfigsByPreviewConfigIdErrors, GetApiPreviewConfigsByPreviewConfigIdRunsData, GetApiPreviewConfigsByPreviewConfigIdRunsResponses, GetApiPreviewConfigsByPreviewConfigIdRunsErrors } from './types.gen.js';\n+import type { GetApiHealthData, GetApiHealthResponses, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponses, PostApiAuthAnonymousSignUpErrors, GetApiUsersData, GetApiUsersResponses, PostApiUsersData, PostApiUsersResponses, PostApiUsersErrors, DeleteApiUsersByIdData, DeleteApiUsersByIdResponses, DeleteApiUsersByIdErrors, GetApiUsersByIdData, GetApiUsersByIdResponses, GetApiUsersByIdErrors, PatchApiUsersByIdData, PatchApiUsersByIdResponses, PatchApiUsersByIdErrors, GetApiBooksData, GetApiBooksResponses, PostApiBooksData, PostApiBooksResponses, PostApiBooksErrors, GetApiBooksByIdData, GetApiBooksByIdResponses, GetApiBooksByIdErrors, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowResponses, PostApiBooksByIdBorrowErrors, PostApiBooksByIdReturnData, PostApiBooksByIdReturnResponses, PostApiBooksByIdReturnErrors, PostApiDevServerStartData, PostApiDevServerStartResponses, PostApiDevServerStartErrors, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponses, GetApiIntegrationsGithubReposErrors, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponses, GetApiIntegrationsGithubPrsErrors, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillResponses, PostApiIntegrationsGithubPrsBackfillErrors, PostApiIntegrationsGithubPrsBackfillRepoData, PostApiIntegrationsGithubPrsBackfillRepoResponses, PostApiIntegrationsGithubPrsBackfillRepoErrors, GetApiIntegrationsGithubPrsCodeData, GetApiIntegrationsGithubPrsCodeResponses, GetApiIntegrationsGithubPrsCodeErrors, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponses, PostApiIntegrationsGithubPrsOpenErrors, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponses, PostApiIntegrationsGithubPrsMergeErrors, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponses, PostApiIntegrationsGithubPrsCloseErrors, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponses, PostApiIntegrationsGithubPrsMergeSimpleErrors, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsRawResponses, GetApiIntegrationsGithubPrsRawErrors, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFilesResponses, GetApiIntegrationsGithubPrsFilesErrors, GetApiIntegrationsGithubPrsFileContentsData, GetApiIntegrationsGithubPrsFileContentsResponses, GetApiIntegrationsGithubPrsFileContentsErrors, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponses, PostApiIntegrationsGithubPrsFileContentsBatchErrors, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponses, PostApiIntegrationsGithubInstallStateErrors, GetApiIntegrationsGithubOauthTokenData, GetApiIntegrationsGithubOauthTokenResponses, GetApiIntegrationsGithubOauthTokenErrors, PostApiMorphTaskRunsByTaskRunIdResumeData, PostApiMorphTaskRunsByTaskRunIdResumeResponses, PostApiMorphTaskRunsByTaskRunIdResumeErrors, PostApiMorphTaskRunsByTaskRunIdIsPausedData, PostApiMorphTaskRunsByTaskRunIdIsPausedResponses, PostApiMorphTaskRunsByTaskRunIdIsPausedErrors, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponses, PostApiMorphSetupInstanceErrors, GetApiIframePreflightData, GetApiIframePreflightResponses, GetApiIframePreflightErrors, GetApiEnvironmentsData, GetApiEnvironmentsResponses, GetApiEnvironmentsErrors, PostApiEnvironmentsData, PostApiEnvironmentsResponses, PostApiEnvironmentsErrors, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponses, DeleteApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdData, GetApiEnvironmentsByIdResponses, GetApiEnvironmentsByIdErrors, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponses, PatchApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdVarsData, GetApiEnvironmentsByIdVarsResponses, GetApiEnvironmentsByIdVarsErrors, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponses, PatchApiEnvironmentsByIdPortsErrors, GetApiEnvironmentsByIdSnapshotsData, GetApiEnvironmentsByIdSnapshotsResponses, GetApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponses, PostApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponses, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateErrors, PostApiSandboxesStartData, PostApiSandboxesStartResponses, PostApiSandboxesStartErrors, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponses, PostApiSandboxesByIdEnvErrors, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponses, PostApiSandboxesByIdStopErrors, GetApiSandboxesByIdStatusData, GetApiSandboxesByIdStatusResponses, GetApiSandboxesByIdStatusErrors, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponses, PostApiSandboxesByIdPublishDevcontainerErrors, PostApiTeamsData, PostApiTeamsResponses, PostApiTeamsErrors, PostApiBranchesGenerateData, PostApiBranchesGenerateResponses, PostApiBranchesGenerateErrors, PostApiCodeReviewStartData, PostApiCodeReviewStartResponses, PostApiCodeReviewStartErrors, GetApiWorkspaceConfigsData, GetApiWorkspaceConfigsResponses, GetApiWorkspaceConfigsErrors, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponses, PostApiWorkspaceConfigsErrors, GetApiPreviewConfigsData, GetApiPreviewConfigsResponses, GetApiPreviewConfigsErrors, PostApiPreviewConfigsData, PostApiPreviewConfigsResponses, PostApiPreviewConfigsErrors, DeleteApiPreviewConfigsByPreviewConfigIdData, DeleteApiPreviewConfigsByPreviewConfigIdResponses, DeleteApiPreviewConfigsByPreviewConfigIdErrors, GetApiPreviewConfigsByPreviewConfigIdRunsData, GetApiPreviewConfigsByPreviewConfigIdRunsResponses, GetApiPreviewConfigsByPreviewConfigIdRunsErrors, PostApiPreviewWaitlistData, PostApiPreviewWaitlistResponses, PostApiPreviewWaitlistErrors } from './types.gen.js';\n import { client as _heyApiClient } from './client.gen.js';\n \n export type Options<TData extends TDataShape = TDataShape, ThrowOnError extends boolean = boolean> = ClientOptions<TData, ThrowOnError> & {\n@@ -689,4 +689,18 @@ export const getApiPreviewConfigsByPreviewConfigIdRuns = <ThrowOnError extends b\n         url: '/api/preview/configs/{previewConfigId}/runs',\n         ...options\n     });\n+};\n+\n+/**\n+ * Join the preview waitlist for GitLab or Bitbucket\n+ */\n+export const postApiPreviewWaitlist = <ThrowOnError extends boolean = false>(options: Options<PostApiPreviewWaitlistData, ThrowOnError>) => {\n+    return (options.client ?? _heyApiClient).post<PostApiPreviewWaitlistResponses, PostApiPreviewWaitlistErrors, ThrowOnError>({\n+        url: '/api/preview/waitlist',\n+        ...options,\n+        headers: {\n+            'Content-Type': 'application/json',\n+            ...options.headers\n+        }\n+    });\n };\n\\ No newline at end of file\ndiff --git a/packages/www-openapi-client/src/client/types.gen.ts b/packages/www-openapi-client/src/client/types.gen.ts\nindex 5f08c420c..85b8f3ce4 100644\n--- a/packages/www-openapi-client/src/client/types.gen.ts\n+++ b/packages/www-openapi-client/src/client/types.gen.ts\n@@ -689,6 +689,11 @@ export type PreviewRunsResponse = {\n     runs: Array<PreviewRun>;\n };\n \n+export type PreviewWaitlistBody = {\n+    email: string;\n+    provider: 'gitlab' | 'bitbucket';\n+};\n+\n export type GetApiHealthData = {\n     body?: never;\n     path?: never;\n@@ -2565,6 +2570,32 @@ export type GetApiPreviewConfigsByPreviewConfigIdRunsResponses = {\n \n export type GetApiPreviewConfigsByPreviewConfigIdRunsResponse = GetApiPreviewConfigsByPreviewConfigIdRunsResponses[keyof GetApiPreviewConfigsByPreviewConfigIdRunsResponses];\n \n+export type PostApiPreviewWaitlistData = {\n+    body: PreviewWaitlistBody;\n+    path?: never;\n+    query?: never;\n+    url: '/api/preview/waitlist';\n+};\n+\n+export type PostApiPreviewWaitlistErrors = {\n+    /**\n+     * Invalid request\n+     */\n+    400: unknown;\n+};\n+\n+export type PostApiPreviewWaitlistResponses = {\n+    /**\n+     * Successfully joined waitlist\n+     */\n+    200: {\n+        success: boolean;\n+        alreadyRegistered: boolean;\n+    };\n+};\n+\n+export type PostApiPreviewWaitlistResponse = PostApiPreviewWaitlistResponses[keyof PostApiPreviewWaitlistResponses];\n+\n export type ClientOptions = {\n     baseUrl: `${string}://${string}` | (string & {});\n };\n\\ No newline at end of file\n","comments":[{"type":"issue_comment","id":3609978119,"prNumber":1156,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7fbzn06j03g8y40zvnx95pn97wnjgq?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7fbzn06j03g8y40zvnx95pn97wnjgq/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1156?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 6 screenshots for commit `5fc6367` (2025-12-04 04:01:29.269 UTC).\n\n**Bitbucket waitlist modal showing the email input form for joining the waitlist**\n\n![bitbucket-waitlist-modal.png](https://famous-camel-162.convex.cloud/api/storage/e0ef0ede-a2b6-459d-a9be-d0c54f446029)\n\n**GitLab waitlist modal showing the email input form for joining the waitlist**\n\n![gitlab-waitlist-modal.png](https://famous-camel-162.convex.cloud/api/storage/457fd16e-b1e4-4e13-8b3e-8b44acb90c3e)\n\n**Authenticated dashboard view showing configured repositories and team selection**\n\n![preview-dashboard-authenticated-view.png](https://famous-camel-162.convex.cloud/api/storage/eabbfaec-84ea-44e2-b9bc-34b07fbb1045)\n\n**Full page view of the preview dashboard showing the overall layout and structure**\n\n![preview-dashboard-full-page.png](https://famous-camel-162.convex.cloud/api/storage/70dc027c-5ebb-42dd-9015-ba106eb84589)\n\n**Provider selection view showing the new GitLab and Bitbucket buttons alongside GitHub**\n\n![provider-selection-with-gitlab-bitbucket.png](https://famous-camel-162.convex.cloud/api/storage/8c914d55-7d05-4233-ba1e-c3b1491a5bcf)\n\n**Waitlist modal success state showing confirmation message after joining the waitlist**\n\n![waitlist-success-state.png](https://famous-camel-162.convex.cloud/api/storage/6fb50615-2c3f-483f-a13d-2492fa67972a)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"5fc636761158279f790e4b7bb4a0d3d0133bb50e","createdAt":"2025-12-04T04:01:32Z","updatedAt":"2025-12-04T04:03:34Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1156#issuecomment-3609978119"},{"type":"issue_comment","id":3609983595,"prNumber":1156,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn7cj6g93zbr2cf23de7xzvajs7wmvqq?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn7cj6g93zbr2cf23de7xzvajs7wmvqq/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1156?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 7 screenshots for commit `5fc6367` (2025-12-04 04:03:32.556 UTC).\n\n**Bitbucket waitlist modal showing the empty form with email input and 'Join waitlist' button**\n\n![bitbucket-waitlist-modal.png](https://adorable-wombat-701.convex.cloud/api/storage/e6b015d1-8287-4675-8ca9-51e08356592b)\n\n**GitLab waitlist modal with email field filled in \\(user \\(at\\) example \\(dot\\) com\\)**\n\n![gitlab-waitlist-modal-filled.png](https://adorable-wombat-701.convex.cloud/api/storage/5551886d-b45b-488b-b2a6-c2ec2a9b8647)\n\n**GitLab waitlist modal showing success state with green checkmark and confirmation message**\n\n![gitlab-waitlist-modal-success.png](https://adorable-wombat-701.convex.cloud/api/storage/569dc00d-b67d-4d3a-9f16-c651f189465a)\n\n**GitLab waitlist modal showing the empty form with email input and 'Join waitlist' button**\n\n![gitlab-waitlist-modal.png](https://adorable-wombat-701.convex.cloud/api/storage/51c8e9db-d7d6-4a6d-a05b-b4bf7c0f1191)\n\n**Preview dashboard in authenticated state \\(baseline - no new UI changes visible in this state\\)**\n\n![preview-dashboard-authenticated-state.png](https://adorable-wombat-701.convex.cloud/api/storage/0d3cf281-c954-4b6f-9149-9f98f9a82e4b)\n\n**Preview dashboard showing new GitLab and Bitbucket provider buttons alongside GitHub button in unauthenticated state**\n\n![preview-dashboard-with-provider-buttons.png](https://adorable-wombat-701.convex.cloud/api/storage/eecc8496-6a13-4658-8caa-66d77e3ba131)\n\n**Close-up view of the three provider buttons: Continue with GitHub \\(black\\), Continue with GitLab \\(orange\\), and Continue with Bitbucket \\(blue\\)**\n\n![provider-buttons-closeup.png](https://adorable-wombat-701.convex.cloud/api/storage/56e6b86b-81ac-4c2a-8f64-591e55dc3e13)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"5fc636761158279f790e4b7bb4a0d3d0133bb50e","createdAt":"2025-12-04T04:03:33Z","updatedAt":"2025-12-04T04:03:33Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1156#issuecomment-3609983595"}]}
{"number":1155,"title":"vercel related projects www origin","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1155","headRef":"vercel-related-projs","headSha":"efadfec263b56fca14bf6e8a3e661a16c614f35a","baseRef":"main","baseSha":"1e277427fa54e537a664bff7805ebbbd4b14f8b9","createdAt":"2025-12-04T03:52:30Z","updatedAt":"2025-12-04T07:00:40Z","diff":"diff --git a/apps/client/package.json b/apps/client/package.json\nindex 07049ce73..d768e5201 100644\n--- a/apps/client/package.json\n+++ b/apps/client/package.json\n@@ -89,6 +89,7 @@\n     \"@tanstack/react-router-devtools\": \"^1.124.0\",\n     \"@tanstack/react-router-with-query\": \"^1.129.8\",\n     \"@tanstack/react-virtual\": \"^3.0.0\",\n+    \"@vercel/related-projects\": \"^1.0.0\",\n     \"@xterm/addon-attach\": \"^0.11.0\",\n     \"@xterm/addon-fit\": \"^0.10.0\",\n     \"@xterm/addon-search\": \"^0.15.0\",\ndiff --git a/apps/client/src/lib/wwwOrigin.ts b/apps/client/src/lib/wwwOrigin.ts\nindex da0e7f902..7416fb17c 100644\n--- a/apps/client/src/lib/wwwOrigin.ts\n+++ b/apps/client/src/lib/wwwOrigin.ts\n@@ -1,4 +1,7 @@\n import { normalizeOrigin } from \"@cmux/shared\";\n import { env } from \"@/client-env\";\n \n-export const WWW_ORIGIN = normalizeOrigin(env.NEXT_PUBLIC_WWW_ORIGIN);\n+export const WWW_ORIGIN = normalizeOrigin(\n+  process.env.NEXT_PUBLIC_RELATED_WWW_ORIGIN_PREVIEW ||\n+    env.NEXT_PUBLIC_WWW_ORIGIN\n+);\ndiff --git a/apps/client/vercel.json b/apps/client/vercel.json\nindex 29c0269f8..1dfc23c92 100644\n--- a/apps/client/vercel.json\n+++ b/apps/client/vercel.json\n@@ -4,5 +4,6 @@\n       \"source\": \"/(.*)\",\n       \"destination\": \"/index.html\"\n     }\n-  ]\n-}\n\\ No newline at end of file\n+  ],\n+  \"relatedProjects\": [\"prj_2WNSLqIZWRGIIRMQLQrDom5DhivV\"]\n+}\ndiff --git a/apps/client/vite.config.ts b/apps/client/vite.config.ts\nindex 1f18302fd..55e97d780 100644\n--- a/apps/client/vite.config.ts\n+++ b/apps/client/vite.config.ts\n@@ -5,18 +5,26 @@ import { defineConfig } from \"vite\";\n import tsconfigPaths from \"vite-tsconfig-paths\";\n import { sentryVitePlugin } from \"@sentry/vite-plugin\";\n \n+import { relatedProjects } from \"@vercel/related-projects\";\n+\n+const NEXT_PUBLIC_RELATED_WWW_ORIGIN_PREVIEW = relatedProjects().find(\n+  (p) => p.project.name === \"cmux-www\"\n+)?.preview.branch;\n+\n // Ensure all env is loaded\n await import(\"./src/client-env.ts\");\n \n-const SentryVitePlugin = process.env.SENTRY_AUTH_TOKEN ?  sentryVitePlugin({\n-  org: \"manaflow\",\n-  project: \"cmux-client-web\",\n-  authToken: process.env.SENTRY_AUTH_TOKEN,\n-  sourcemaps: {\n-    filesToDeleteAfterUpload: [\"**/*.map\"],\n-  },\n-  telemetry: false\n-}) : undefined;\n+const SentryVitePlugin = process.env.SENTRY_AUTH_TOKEN\n+  ? sentryVitePlugin({\n+      org: \"manaflow\",\n+      project: \"cmux-client-web\",\n+      authToken: process.env.SENTRY_AUTH_TOKEN,\n+      sourcemaps: {\n+        filesToDeleteAfterUpload: [\"**/*.map\"],\n+      },\n+      telemetry: false,\n+    })\n+  : undefined;\n \n // https://vite.dev/config/\n export default defineConfig({\n@@ -43,6 +51,9 @@ export default defineConfig({\n     \"process.env.NODE_ENV\": JSON.stringify(\n       process.env.NODE_ENV || \"development\"\n     ),\n+    \"process.env.NEXT_PUBLIC_RELATED_WWW_ORIGIN_PREVIEW\": JSON.stringify(\n+      NEXT_PUBLIC_RELATED_WWW_ORIGIN_PREVIEW\n+    ),\n     global: \"globalThis\",\n   },\n   envPrefix: \"NEXT_PUBLIC_\",\ndiff --git a/apps/www/lib/hono-app.ts b/apps/www/lib/hono-app.ts\nindex fc783d9ab..b0a29bfbe 100644\n--- a/apps/www/lib/hono-app.ts\n+++ b/apps/www/lib/hono-app.ts\n@@ -1,3 +1,4 @@\n+import { normalizeOrigin } from \"@cmux/shared\";\n import { githubPrsBackfillRepoRouter } from \"@/lib/routes/github.prs.backfill-repo.route\";\n import { githubPrsBackfillRouter } from \"@/lib/routes/github.prs.backfill.route\";\n import { githubPrsCodeRouter } from \"@/lib/routes/github.prs.code.route\";\n@@ -29,11 +30,20 @@ import { authAnonymousRouter } from \"@/lib/routes/auth.anonymous.route\";\n import { stackServerApp } from \"@/lib/utils/stack\";\n import { swaggerUI } from \"@hono/swagger-ui\";\n import { OpenAPIHono } from \"@hono/zod-openapi\";\n+import { relatedProjects } from \"@vercel/related-projects\";\n import { cors } from \"hono/cors\";\n import { logger } from \"hono/logger\";\n import { prettyJSON } from \"hono/pretty-json\";\n import { decodeJwt } from \"jose\";\n \n+// Get client preview URL from related projects for CORS\n+const clientPreviewOriginRaw = relatedProjects({ noThrow: true }).find(\n+  (p) => p.project.name === \"cmux-client\",\n+)?.preview.branch;\n+const clientPreviewOrigin = clientPreviewOriginRaw\n+  ? normalizeOrigin(clientPreviewOriginRaw)\n+  : undefined;\n+\n const app = new OpenAPIHono({\n   defaultHook: (result, c) => {\n     if (!result.success) {\n@@ -72,6 +82,7 @@ app.use(\n       \"http://localhost:9779\",\n       \"https://cmux.sh\",\n       \"https://www.cmux.sh\",\n+      ...(clientPreviewOrigin ? [clientPreviewOrigin] : []),\n     ],\n     credentials: true,\n     allowHeaders: [\"x-stack-auth\", \"content-type\", \"authorization\"],\ndiff --git a/apps/www/package.json b/apps/www/package.json\nindex 39afe98bd..6274feaf2 100644\n--- a/apps/www/package.json\n+++ b/apps/www/package.json\n@@ -42,6 +42,7 @@\n     \"@t3-oss/env-core\": \"^0.13.8\",\n     \"@tanstack/react-query\": \"^5.86.2\",\n     \"@vercel/functions\": \"^1.4.0\",\n+    \"@vercel/related-projects\": \"^1.0.0\",\n     \"ai\": \"^5.0.82\",\n     \"class-variance-authority\": \"^0.7.1\",\n     \"clsx\": \"^2.1.1\",\ndiff --git a/apps/www/vercel.json b/apps/www/vercel.json\nnew file mode 100644\nindex 000000000..0d0526211\n--- /dev/null\n+++ b/apps/www/vercel.json\n@@ -0,0 +1,3 @@\n+{\n+  \"relatedProjects\": [\"prj_MYvZXLJdc3TpayecPo3D7rsGctJA\"]\n+}\ndiff --git a/bun.lock b/bun.lock\nindex 27489d149..ea6d79106 100644\n--- a/bun.lock\n+++ b/bun.lock\n@@ -95,6 +95,7 @@\n         \"@tanstack/react-router-devtools\": \"^1.124.0\",\n         \"@tanstack/react-router-with-query\": \"^1.129.8\",\n         \"@tanstack/react-virtual\": \"^3.0.0\",\n+        \"@vercel/related-projects\": \"^1.0.0\",\n         \"@xterm/addon-attach\": \"^0.11.0\",\n         \"@xterm/addon-fit\": \"^0.10.0\",\n         \"@xterm/addon-search\": \"^0.15.0\",\n@@ -333,6 +334,7 @@\n         \"@t3-oss/env-core\": \"^0.13.8\",\n         \"@tanstack/react-query\": \"^5.86.2\",\n         \"@vercel/functions\": \"^1.4.0\",\n+        \"@vercel/related-projects\": \"^1.0.0\",\n         \"ai\": \"^5.0.82\",\n         \"class-variance-authority\": \"^0.7.1\",\n         \"clsx\": \"^2.1.1\",\n@@ -2540,6 +2542,8 @@\n \n     \"@vercel/oidc\": [\"@vercel/oidc@3.0.3\", \"\", {}, \"sha512-yNEQvPcVrK9sIe637+I0jD6leluPxzwJKx/Haw6F4H77CdDsszUn5V3o96LPziXkSNE2B83+Z3mjqGKBK/R6Gg==\"],\n \n+    \"@vercel/related-projects\": [\"@vercel/related-projects@1.0.0\", \"\", { \"optionalDependencies\": { \"ajv\": \"^6.12.3\" } }, \"sha512-wGk91hdzpQMMSTCE9q6q5caKWMse9OzH3IeeC83SBZ/ZprvjPSusgftYBrbkDehV0gytRd22MFzYFaSwbVYiDw==\"],\n+\n     \"@vitejs/plugin-react\": [\"@vitejs/plugin-react@4.7.0\", \"\", { \"dependencies\": { \"@babel/core\": \"^7.28.0\", \"@babel/plugin-transform-react-jsx-self\": \"^7.27.1\", \"@babel/plugin-transform-react-jsx-source\": \"^7.27.1\", \"@rolldown/pluginutils\": \"1.0.0-beta.27\", \"@types/babel__core\": \"^7.20.5\", \"react-refresh\": \"^0.17.0\" }, \"peerDependencies\": { \"vite\": \"^4.2.0 || ^5.0.0 || ^6.0.0 || ^7.0.0\" } }, \"sha512-gUu9hwfWvvEDBBmgtAowQCojwZmJ5mcLn3aufeCsitijs3+f2NsrPtlAWIR6OPiqljl96GVCUbLe0HyqIpVaoA==\"],\n \n     \"@vitest/expect\": [\"@vitest/expect@3.2.4\", \"\", { \"dependencies\": { \"@types/chai\": \"^5.2.2\", \"@vitest/spy\": \"3.2.4\", \"@vitest/utils\": \"3.2.4\", \"chai\": \"^5.2.0\", \"tinyrainbow\": \"^2.0.0\" } }, \"sha512-Io0yyORnB6sikFlt8QW5K7slY4OjqNX9jmJQ02QDda8lyM6B5oNgVWoSoKPac8/kgnCUzuHQKrSLtu/uOqqrig==\"],\n@@ -5086,6 +5090,8 @@\n \n     \"@cloudflare/kv-asset-handler/mime\": [\"mime@3.0.0\", \"\", { \"bin\": { \"mime\": \"cli.js\" } }, \"sha512-jSCU7/VB1loIWBZe14aEYHU/+1UMEHoaO7qxCOVJOw9GgH72VAWppxNcjU+x9a2k3GSIBXNKxXQFqRvvZ7vr3A==\"],\n \n+    \"@cmux/client/typescript-eslint\": [\"typescript-eslint@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/eslint-plugin\": \"8.48.0\", \"@typescript-eslint/parser\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-fcKOvQD9GUn3Xw63EgiDqhvWJ5jsyZUaekl3KVpGsDJnN46WJTe3jWxtQP9lMZm1LJNkFLlTaWAxK2vUQR+cqw==\"],\n+\n     \"@cmux/morphcloud-openapi-client/typescript-eslint\": [\"typescript-eslint@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/eslint-plugin\": \"8.48.0\", \"@typescript-eslint/parser\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-fcKOvQD9GUn3Xw63EgiDqhvWJ5jsyZUaekl3KVpGsDJnN46WJTe3jWxtQP9lMZm1LJNkFLlTaWAxK2vUQR+cqw==\"],\n \n     \"@cmux/scripts/morphcloud\": [\"morphcloud@0.0.18\", \"\", { \"dependencies\": { \"ignore\": \"^7.0.0\", \"node-ssh\": \"^13.2.0\", \"undici\": \"^7.12.0\", \"uuid\": \"^11.1.0\" } }, \"sha512-k3kxdvmwUQbRM5RBJp/UMXQKOqZBBy+BVo/jgNLuNp8yLBq5CJqGAK3O0oZewwKUK2/UL4LyHkwJxBNf7gy0kg==\"],\n@@ -5994,6 +6000,14 @@\n \n     \"@babel/helper-compilation-targets/lru-cache/yallist\": [\"yallist@3.1.1\", \"\", {}, \"sha512-a4UGQaWPH59mOXUYnAG2ewncQS4i4F43Tv3JoAM+s2VDAmS9NsK8GpDMLrCHPksFT7h3K6TOoUNn2pb7RoXx4g==\"],\n \n+    \"@cmux/client/typescript-eslint/@typescript-eslint/eslint-plugin\": [\"@typescript-eslint/eslint-plugin@8.48.0\", \"\", { \"dependencies\": { \"@eslint-community/regexpp\": \"^4.10.0\", \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/type-utils\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\", \"graphemer\": \"^1.4.0\", \"ignore\": \"^7.0.0\", \"natural-compare\": \"^1.4.0\", \"ts-api-utils\": \"^2.1.0\" }, \"peerDependencies\": { \"@typescript-eslint/parser\": \"^8.48.0\", \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-XxXP5tL1txl13YFtrECECQYeZjBZad4fyd3cFV4a19LkAY/bIp9fev3US4S5fDVV2JaYFiKAZ/GRTOLer+mbyQ==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/parser\": [\"@typescript-eslint/parser@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\", \"debug\": \"^4.3.4\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-jCzKdm/QK0Kg4V4IK/oMlRZlY+QOcdjv89U2NgKHZk1CYTj82/RVSx1mV/0gqCVMJ/DA+Zf/S4NBWNF8GQ+eqQ==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/typescript-estree\": [\"@typescript-eslint/typescript-estree@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/project-service\": \"8.48.0\", \"@typescript-eslint/tsconfig-utils\": \"8.48.0\", \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\", \"debug\": \"^4.3.4\", \"minimatch\": \"^9.0.4\", \"semver\": \"^7.6.0\", \"tinyglobby\": \"^0.2.15\", \"ts-api-utils\": \"^2.1.0\" }, \"peerDependencies\": { \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-ljHab1CSO4rGrQIAyizUS6UGHHCiAYhbfcIZ1zVJr5nMryxlXMVWS3duFPSKvSUbFPwkXMFk1k0EMIjub4sRRQ==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/utils\": [\"@typescript-eslint/utils@8.48.0\", \"\", { \"dependencies\": { \"@eslint-community/eslint-utils\": \"^4.7.0\", \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-yTJO1XuGxCsSfIVt1+1UrLHtue8xz16V8apzPYI06W0HbEbEWHxHXgZaAgavIkoh+GeV6hKKd5jm0sS6OYxWXQ==\"],\n+\n     \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin\": [\"@typescript-eslint/eslint-plugin@8.48.0\", \"\", { \"dependencies\": { \"@eslint-community/regexpp\": \"^4.10.0\", \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/type-utils\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\", \"graphemer\": \"^1.4.0\", \"ignore\": \"^7.0.0\", \"natural-compare\": \"^1.4.0\", \"ts-api-utils\": \"^2.1.0\" }, \"peerDependencies\": { \"@typescript-eslint/parser\": \"^8.48.0\", \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-XxXP5tL1txl13YFtrECECQYeZjBZad4fyd3cFV4a19LkAY/bIp9fev3US4S5fDVV2JaYFiKAZ/GRTOLer+mbyQ==\"],\n \n     \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/parser\": [\"@typescript-eslint/parser@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\", \"debug\": \"^4.3.4\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-jCzKdm/QK0Kg4V4IK/oMlRZlY+QOcdjv89U2NgKHZk1CYTj82/RVSx1mV/0gqCVMJ/DA+Zf/S4NBWNF8GQ+eqQ==\"],\n@@ -6688,6 +6702,34 @@\n \n     \"@aws-crypto/util/@smithy/util-utf8/@smithy/util-buffer-from/@smithy/is-array-buffer\": [\"@smithy/is-array-buffer@2.2.0\", \"\", { \"dependencies\": { \"tslib\": \"^2.6.2\" } }, \"sha512-GGP3O9QFD24uGeAXYUjwSTXARoqpZykHadOmA8G5vfJPK0/DC67qa//0qvqrJzL1xc8WQWX7/yc7fwudjPHPhA==\"],\n \n+    \"@cmux/client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/scope-manager\": [\"@typescript-eslint/scope-manager@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\" } }, \"sha512-uGSSsbrtJrLduti0Q1Q9+BF1/iFKaxGoQwjWOIVNJv0o6omrdyR8ct37m4xIl5Zzpkp69Kkmvom7QFTtue89YQ==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/type-utils\": [\"@typescript-eslint/type-utils@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\", \"debug\": \"^4.3.4\", \"ts-api-utils\": \"^2.1.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-zbeVaVqeXhhab6QNEKfK96Xyc7UQuoFWERhEnj3mLVnUWrQnv15cJNseUni7f3g557gm0e46LZ6IJ4NJVOgOpw==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/eslint-plugin/ignore\": [\"ignore@7.0.5\", \"\", {}, \"sha512-Hs59xBNfUIunMFgWAbGX5cq6893IbWg4KnrjbYwX3tx0ztorVgTDA6B2sxf8ejHJ4wz8BqGUMYlnzNBer5NvGg==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/parser/@typescript-eslint/scope-manager\": [\"@typescript-eslint/scope-manager@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\" } }, \"sha512-uGSSsbrtJrLduti0Q1Q9+BF1/iFKaxGoQwjWOIVNJv0o6omrdyR8ct37m4xIl5Zzpkp69Kkmvom7QFTtue89YQ==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/parser/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/parser/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/project-service\": [\"@typescript-eslint/project-service@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/tsconfig-utils\": \"^8.48.0\", \"@typescript-eslint/types\": \"^8.48.0\", \"debug\": \"^4.3.4\" }, \"peerDependencies\": { \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-Ne4CTZyRh1BecBf84siv42wv5vQvVmgtk8AuiEffKTUo3DrBaGYZueJSxxBZ8fjk/N3DrgChH4TOdIOwOwiqqw==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/tsconfig-utils\": [\"@typescript-eslint/tsconfig-utils@8.48.0\", \"\", { \"peerDependencies\": { \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-WNebjBdFdyu10sR1M4OXTt2OkMd5KWIL+LLfeH9KhgP+jzfDV/LI3eXzwJ1s9+Yc0Kzo2fQCdY/OpdusCMmh6w==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/typescript-estree/minimatch\": [\"minimatch@9.0.5\", \"\", { \"dependencies\": { \"brace-expansion\": \"^2.0.1\" } }, \"sha512-G6T0ZX48xgozx7587koeX9Ys2NYy6Gmv//P89sEte9V9whIapMNF4idKxnW2QtCcLiTWlb/wfCabAtAFWhhBow==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/utils/@typescript-eslint/scope-manager\": [\"@typescript-eslint/scope-manager@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\" } }, \"sha512-uGSSsbrtJrLduti0Q1Q9+BF1/iFKaxGoQwjWOIVNJv0o6omrdyR8ct37m4xIl5Zzpkp69Kkmvom7QFTtue89YQ==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/utils/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n     \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/scope-manager\": [\"@typescript-eslint/scope-manager@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\" } }, \"sha512-uGSSsbrtJrLduti0Q1Q9+BF1/iFKaxGoQwjWOIVNJv0o6omrdyR8ct37m4xIl5Zzpkp69Kkmvom7QFTtue89YQ==\"],\n \n     \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/type-utils\": [\"@typescript-eslint/type-utils@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\", \"debug\": \"^4.3.4\", \"ts-api-utils\": \"^2.1.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-zbeVaVqeXhhab6QNEKfK96Xyc7UQuoFWERhEnj3mLVnUWrQnv15cJNseUni7f3g557gm0e46LZ6IJ4NJVOgOpw==\"],\n@@ -6978,6 +7020,16 @@\n \n     \"wrap-ansi/ansi-styles/color-convert/color-name\": [\"color-name@1.1.4\", \"\", {}, \"sha512-dOy+3AuW3a2wNbZHIuMZpTcgjGuLU/uBL/ubcZF9OXbDo8ff4O8yVp5Bf0efS8uEoYo5q4Fx7dY9OgQGXgAsQA==\"],\n \n+    \"@cmux/client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/scope-manager/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/type-utils/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/visitor-keys/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/typescript-estree/minimatch/brace-expansion\": [\"brace-expansion@2.0.2\", \"\", { \"dependencies\": { \"balanced-match\": \"^1.0.0\" } }, \"sha512-Jt0vHyM+jmUBqojB7E1NIYadt0vI0Qxjxd2TErW94wDz+E2LAm5vKMXXwg6ZZBTHPuUlDgQHKXvjGBdfcF1ZDQ==\"],\n+\n+    \"@cmux/client/typescript-eslint/@typescript-eslint/utils/@typescript-eslint/scope-manager/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n+\n     \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/scope-manager/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n \n     \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/type-utils/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\ndiff --git a/packages/shared/src/utils/normalize-origin.test.ts b/packages/shared/src/utils/normalize-origin.test.ts\nindex 834d581b5..0d753dbac 100644\n--- a/packages/shared/src/utils/normalize-origin.test.ts\n+++ b/packages/shared/src/utils/normalize-origin.test.ts\n@@ -28,9 +28,17 @@ describe(\"normalizeOrigin\", () => {\n     );\n   });\n \n+  it(\"adds https:// prefix when protocol is missing\", () => {\n+    expect(normalizeOrigin(\"cmux.dev\")).toBe(\"https://cmux.dev\");\n+    expect(normalizeOrigin(\"example.vercel.app\")).toBe(\n+      \"https://example.vercel.app\"\n+    );\n+  });\n+\n   it(\"returns trimmed origin when parsing fails\", () => {\n     const warn = vi.spyOn(console, \"warn\").mockImplementation(() => {});\n-    expect(normalizeOrigin(\" not-a-url \")).toBe(\"not-a-url\");\n+    // Use invalid characters that can't form a valid URL even with https://\n+    expect(normalizeOrigin(\" :invalid: \")).toBe(\":invalid:\");\n     expect(warn).toHaveBeenCalled();\n     warn.mockRestore();\n   });\ndiff --git a/packages/shared/src/utils/normalize-origin.ts b/packages/shared/src/utils/normalize-origin.ts\nindex f3384f87f..aed4fe621 100644\n--- a/packages/shared/src/utils/normalize-origin.ts\n+++ b/packages/shared/src/utils/normalize-origin.ts\n@@ -3,18 +3,27 @@ import { isLocalHostname } from \"./is-local-host\";\n export function normalizeOrigin(rawOrigin: string): string {\n   const trimmed = rawOrigin?.trim();\n   if (!trimmed) return rawOrigin;\n+\n+  // Try parsing as-is first\n+  let url: URL | null = null;\n   try {\n-    const url = new URL(trimmed);\n-    const isLocal = isLocalHostname(url.hostname);\n-    if (url.protocol === \"http:\" && !isLocal) {\n-      url.protocol = \"https:\";\n+    url = new URL(trimmed);\n+  } catch {\n+    // If parsing fails, try adding https:// prefix\n+    try {\n+      url = new URL(`https://${trimmed}`);\n+    } catch (error) {\n+      console.warn(\n+        `[normalizeOrigin] Unable to parse origin: ${rawOrigin}`,\n+        error instanceof Error ? error.message : error\n+      );\n+      return trimmed;\n     }\n-    return url.origin;\n-  } catch (error) {\n-    console.warn(\n-      `[normalizeOrigin] Unable to parse origin: ${rawOrigin}`,\n-      error instanceof Error ? error.message : error\n-    );\n-    return trimmed;\n   }\n+\n+  const isLocal = isLocalHostname(url.hostname);\n+  if (url.protocol === \"http:\" && !isLocal) {\n+    url.protocol = \"https:\";\n+  }\n+  return url.origin;\n }\n","comments":[{"type":"issue_comment","id":3610118822,"prNumber":1155,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7c6vr6gbqvtggbezk2e61tq97wmhr3?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7c6vr6gbqvtggbezk2e61tq97wmhr3/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1155?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"efadfec263b56fca14bf6e8a3e661a16c614f35a","createdAt":"2025-12-04T04:51:13Z","updatedAt":"2025-12-04T05:16:48Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1155#issuecomment-3610118822"},{"type":"issue_comment","id":3610216159,"prNumber":1155,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn7fkwf0aah38skkzhj7c2mkgs7wnj04?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn7fkwf0aah38skkzhj7c2mkgs7wnj04/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1155?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 5 screenshots for commit `8e57c84` (2025-12-04 05:16:46.259 UTC).\n\n**Close-up of the AlertDialog delete confirmation modal showing the new Radix UI implementation**\n\n![alert-dialog-delete-confirmation-element.png](https://adorable-wombat-701.convex.cloud/api/storage/fb783ac9-92d0-42fa-9819-ba38668ab673)\n\n**Delete confirmation AlertDialog shown in context - the main UI change in this PR \\(refactored to use Radix UI AlertDialog component\\)**\n\n![alert-dialog-delete-confirmation-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/ab1ad048-c8b5-47b6-97ee-5b50565cb5bd)\n\n**Client dashboard with sidebar \\(sidebar keyboard shortcut handling was improved but no visual changes\\)**\n\n![client-dashboard-with-sidebar.png](https://adorable-wombat-701.convex.cloud/api/storage/abf7369b-1340-41cc-bbe4-56f474f13581)\n\n**Configured repositories section with delete buttons that trigger the AlertDialog**\n\n![configured-repositories-section.png](https://adorable-wombat-701.convex.cloud/api/storage/7480a446-08c6-41cb-a804-3b274b079841)\n\n**Preview dashboard page showing the main interface with configured repositories section**\n\n![preview-dashboard-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/fbd1add6-6588-4af5-b2f7-3bc380f1da34)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"efadfec263b56fca14bf6e8a3e661a16c614f35a","createdAt":"2025-12-04T05:16:47Z","updatedAt":"2025-12-04T05:38:36Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1155#issuecomment-3610216159"},{"type":"issue_comment","id":3610354896,"prNumber":1155,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn7emb9sjtp4d7j9xc04nrexy17wn9hb?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn7emb9sjtp4d7j9xc04nrexy17wn9hb/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1155?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"efadfec263b56fca14bf6e8a3e661a16c614f35a","createdAt":"2025-12-04T05:38:35Z","updatedAt":"2025-12-04T05:38:35Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1155#issuecomment-3610354896"}]}
{"number":1153,"title":"Add diff-viewer screenshots UI to pr-review","state":"open","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1153","headRef":"cmux/add-diff-viewer-screenshots-ui-to-pr-review-f63vf","headSha":"9743c22f03d884f43e346348cc066874ff3ecdbe","baseRef":"main","baseSha":"f17b9392414d09faf5916968b94717421117055e","createdAt":"2025-12-04T03:41:34Z","updatedAt":"2025-12-04T04:06:55Z","diff":"diff --git a/apps/www/components/pr/pr-screenshot-gallery.tsx b/apps/www/components/pr/pr-screenshot-gallery.tsx\nnew file mode 100644\nindex 000000000..4c282b4e5\n--- /dev/null\n+++ b/apps/www/components/pr/pr-screenshot-gallery.tsx\n@@ -0,0 +1,718 @@\n+\"use client\";\n+\n+import {\n+  type SyntheticEvent,\n+  useCallback,\n+  useEffect,\n+  useMemo,\n+  useRef,\n+  useState,\n+} from \"react\";\n+import { formatDistanceToNow } from \"date-fns\";\n+import * as Dialog from \"@radix-ui/react-dialog\";\n+import {\n+  Camera,\n+  ChevronLeft,\n+  ChevronRight,\n+  Maximize2,\n+  RotateCcw,\n+  X,\n+  ZoomIn,\n+  ZoomOut,\n+} from \"lucide-react\";\n+import { cn } from \"@/lib/utils\";\n+import type { FunctionReturnType } from \"convex/server\";\n+import type { api } from \"@cmux/convex/api\";\n+\n+type ScreenshotSet = FunctionReturnType<\n+  typeof api.github_pr_queries.listScreenshotSetsForPr\n+>[number];\n+\n+type ScreenshotStatus = \"completed\" | \"failed\" | \"skipped\";\n+\n+interface PrScreenshotGalleryProps {\n+  screenshotSets: ScreenshotSet[] | undefined;\n+  commitRef?: string | null;\n+}\n+\n+const MIN_ZOOM = 0.2;\n+const MAX_ZOOM = 40;\n+\n+const STATUS_LABELS: Record<ScreenshotStatus, string> = {\n+  completed: \"Completed\",\n+  failed: \"Failed\",\n+  skipped: \"Skipped\",\n+};\n+\n+const STATUS_STYLES: Record<ScreenshotStatus, string> = {\n+  completed:\n+    \"bg-emerald-100/70 text-emerald-700\",\n+  failed: \"bg-rose-100/70 text-rose-700\",\n+  skipped:\n+    \"bg-neutral-200/70 text-neutral-700\",\n+};\n+\n+const getImageKey = (\n+  setId: string,\n+  storageId: string,\n+  indexInSet: number,\n+) => `${setId}:${storageId}:${indexInSet}`;\n+\n+export function PrScreenshotGallery({\n+  screenshotSets,\n+  commitRef,\n+}: PrScreenshotGalleryProps) {\n+  const normalizedCommit = commitRef?.toLowerCase().trim() ?? null;\n+\n+  const sortedSets = useMemo(() => {\n+    if (!screenshotSets || screenshotSets.length === 0) {\n+      return [];\n+    }\n+\n+    const filtered = screenshotSets.filter((set) => {\n+      if (!normalizedCommit) return true;\n+      return set.commitSha?.toLowerCase() === normalizedCommit;\n+    });\n+\n+    return filtered.sort((a, b) => b.capturedAt - a.capturedAt);\n+  }, [screenshotSets, normalizedCommit]);\n+\n+  const flattenedImages = useMemo(() => {\n+    const entries: Array<{\n+      set: ScreenshotSet;\n+      image: ScreenshotSet[\"images\"][number];\n+      indexInSet: number;\n+      key: string;\n+      globalIndex: number;\n+    }> = [];\n+    sortedSets.forEach((set) => {\n+      set.images.forEach((image, indexInSet) => {\n+        if (!image.url) {\n+          return;\n+        }\n+        entries.push({\n+          set,\n+          image,\n+          indexInSet,\n+          key: getImageKey(set._id, image.storageId, indexInSet),\n+          globalIndex: entries.length,\n+        });\n+      });\n+    });\n+    return entries;\n+  }, [sortedSets]);\n+\n+  const globalIndexByKey = useMemo(() => {\n+    const indexMap = new Map<string, number>();\n+    flattenedImages.forEach((entry) => {\n+      indexMap.set(entry.key, entry.globalIndex);\n+    });\n+    return indexMap;\n+  }, [flattenedImages]);\n+\n+  const [activeImageKey, setActiveImageKey] = useState<string | null>(null);\n+  const [zoom, setZoom] = useState(1);\n+  const [offset, setOffset] = useState({ x: 0, y: 0 });\n+  const [isPanning, setIsPanning] = useState(false);\n+  const [baseImageScale, setBaseImageScale] = useState(1);\n+  const viewportRef = useRef<HTMLDivElement | null>(null);\n+  const panPointerIdRef = useRef<number | null>(null);\n+  const lastPanPositionRef = useRef<{ x: number; y: number } | null>(null);\n+  const defaultZoomRef = useRef(1);\n+  const defaultOffsetRef = useRef<{ x: number; y: number }>({ x: 0, y: 0 });\n+\n+  const clampZoom = useCallback((value: number) => {\n+    return Math.min(MAX_ZOOM, Math.max(MIN_ZOOM, value));\n+  }, []);\n+\n+  const setZoomWithFocus = useCallback(\n+    (\n+      resolver: (prevZoom: number) => number,\n+      focusPoint: { x: number; y: number } = { x: 0, y: 0 },\n+    ) => {\n+      setZoom((prevZoom) => {\n+        const safePrevZoom = prevZoom || 1;\n+        const nextZoom = clampZoom(resolver(safePrevZoom));\n+        if (nextZoom === safePrevZoom) {\n+          return nextZoom;\n+        }\n+        setOffset((prevOffset) => ({\n+          x:\n+            focusPoint.x -\n+            (nextZoom * (focusPoint.x - prevOffset.x)) / safePrevZoom,\n+          y:\n+            focusPoint.y -\n+            (nextZoom * (focusPoint.y - prevOffset.y)) / safePrevZoom,\n+        }));\n+        return nextZoom;\n+      });\n+    },\n+    [clampZoom],\n+  );\n+\n+  const resetZoomState = useCallback(\n+    (options?: { zoom?: number; offset?: { x: number; y: number } }) => {\n+      const targetZoom = clampZoom(options?.zoom ?? defaultZoomRef.current);\n+      setZoom(targetZoom);\n+      setOffset(options?.offset ?? defaultOffsetRef.current);\n+      setIsPanning(false);\n+      panPointerIdRef.current = null;\n+      lastPanPositionRef.current = null;\n+    },\n+    [clampZoom],\n+  );\n+\n+  const handleImageLoad = (event: SyntheticEvent<HTMLImageElement>) => {\n+    const { naturalWidth, naturalHeight } = event.currentTarget;\n+    const viewportRect = viewportRef.current?.getBoundingClientRect();\n+    if (!viewportRect || naturalWidth <= 0 || naturalHeight <= 0) {\n+      setBaseImageScale(1);\n+      defaultZoomRef.current = 1;\n+      defaultOffsetRef.current = { x: 0, y: 0 };\n+      resetZoomState({ zoom: 1, offset: { x: 0, y: 0 } });\n+      return;\n+    }\n+\n+    const viewportWidth = viewportRect.width;\n+    const viewportHeight = viewportRect.height;\n+    const baseScale = Math.min(\n+      viewportWidth / naturalWidth,\n+      viewportHeight / naturalHeight,\n+    );\n+    const normalizedBaseScale = Math.min(1, baseScale);\n+    setBaseImageScale(normalizedBaseScale);\n+    const baseWidth = naturalWidth * baseScale;\n+    const baseHeight = naturalHeight * baseScale;\n+\n+    const fitHeightZoom = viewportHeight / baseHeight;\n+    const fitWidthZoom = viewportWidth / baseWidth;\n+    const desiredZoom = Math.min(1, fitHeightZoom, fitWidthZoom);\n+    const clampedZoom = clampZoom(desiredZoom);\n+\n+    const scaledHeight = baseHeight * clampedZoom;\n+    const offsetY = -((viewportHeight - scaledHeight) / 2);\n+    const initialOffset = { x: 0, y: offsetY };\n+\n+    defaultZoomRef.current = clampedZoom;\n+    defaultOffsetRef.current = initialOffset;\n+    resetZoomState({ zoom: clampedZoom, offset: initialOffset });\n+  };\n+\n+  const activeImageIndex =\n+    activeImageKey !== null ? globalIndexByKey.get(activeImageKey) ?? null : null;\n+  const currentEntry =\n+    activeImageIndex !== null &&\n+      activeImageIndex >= 0 &&\n+      activeImageIndex < flattenedImages.length\n+      ? flattenedImages[activeImageIndex]\n+      : null;\n+\n+  const activeOverallIndex =\n+    currentEntry?.globalIndex !== undefined\n+      ? currentEntry.globalIndex + 1\n+      : null;\n+\n+  useEffect(() => {\n+    if (activeImageKey === null) {\n+      return;\n+    }\n+    if (flattenedImages.length === 0 || !globalIndexByKey.has(activeImageKey)) {\n+      setActiveImageKey(null);\n+    }\n+  }, [activeImageKey, flattenedImages.length, globalIndexByKey]);\n+\n+  useEffect(() => {\n+    defaultZoomRef.current = 1;\n+    defaultOffsetRef.current = { x: 0, y: 0 };\n+    setBaseImageScale(1);\n+    resetZoomState({ zoom: 1, offset: { x: 0, y: 0 } });\n+  }, [currentEntry?.key, resetZoomState]);\n+\n+  const closeSlideshow = useCallback(() => {\n+    setActiveImageKey(null);\n+  }, []);\n+\n+  const goNext = useCallback(() => {\n+    if (activeImageIndex === null) {\n+      return;\n+    }\n+    const len = flattenedImages.length;\n+    if (len <= 1) {\n+      return;\n+    }\n+    const nextIndex = (activeImageIndex + 1) % len;\n+    setActiveImageKey(flattenedImages[nextIndex]?.key ?? null);\n+  }, [activeImageIndex, flattenedImages]);\n+\n+  const goPrev = useCallback(() => {\n+    if (activeImageIndex === null) {\n+      return;\n+    }\n+    const len = flattenedImages.length;\n+    if (len <= 1) {\n+      return;\n+    }\n+    const prevIndex = (activeImageIndex - 1 + len) % len;\n+    setActiveImageKey(flattenedImages[prevIndex]?.key ?? null);\n+  }, [activeImageIndex, flattenedImages]);\n+\n+  const isSlideshowOpen = Boolean(currentEntry);\n+  const hasMultipleImages = flattenedImages.length > 1;\n+  const showNavButtons = hasMultipleImages;\n+  const effectiveScale = Math.max(0, zoom * baseImageScale);\n+  const zoomPercent = Math.round(effectiveScale * 100);\n+  const canZoomIn = zoom < MAX_ZOOM - 0.001;\n+  const canZoomOut = zoom > MIN_ZOOM + 0.001;\n+  const canResetZoom = zoom !== 1 || offset.x !== 0 || offset.y !== 0;\n+\n+  const handleWheel = useCallback(\n+    (event: React.WheelEvent<HTMLDivElement>) => {\n+      if (!currentEntry || !viewportRef.current) {\n+        return;\n+      }\n+      event.preventDefault();\n+      const rect = viewportRef.current.getBoundingClientRect();\n+      const pointerX = event.clientX - (rect.left + rect.width / 2);\n+      const pointerY = event.clientY - (rect.top + rect.height / 2);\n+      const { deltaMode, deltaY } = event;\n+      let pixelDelta = deltaY;\n+      if (deltaMode === 1) {\n+        pixelDelta *= 16;\n+      } else if (deltaMode === 2) {\n+        pixelDelta *= rect.height;\n+      }\n+      if (pixelDelta === 0) {\n+        return;\n+      }\n+      const sensitivity = event.ctrlKey ? 0.0016 : 0.0009;\n+      const factor = Math.exp(-pixelDelta * sensitivity);\n+      setZoomWithFocus((prevZoom) => prevZoom * factor, {\n+        x: pointerX,\n+        y: pointerY,\n+      });\n+    },\n+    [currentEntry, setZoomWithFocus],\n+  );\n+\n+  const startPanning = useCallback(\n+    (event: React.PointerEvent<HTMLDivElement>) => {\n+      if (!currentEntry || event.button !== 0) {\n+        return;\n+      }\n+      event.preventDefault();\n+      setIsPanning(true);\n+      panPointerIdRef.current = event.pointerId;\n+      lastPanPositionRef.current = {\n+        x: event.clientX,\n+        y: event.clientY,\n+      };\n+      event.currentTarget.setPointerCapture(event.pointerId);\n+    },\n+    [currentEntry],\n+  );\n+\n+  const handlePointerMove = useCallback(\n+    (event: React.PointerEvent<HTMLDivElement>) => {\n+      if (\n+        !isPanning ||\n+        panPointerIdRef.current !== event.pointerId ||\n+        !lastPanPositionRef.current\n+      ) {\n+        return;\n+      }\n+      event.preventDefault();\n+      const deltaX = event.clientX - lastPanPositionRef.current.x;\n+      const deltaY = event.clientY - lastPanPositionRef.current.y;\n+      lastPanPositionRef.current = {\n+        x: event.clientX,\n+        y: event.clientY,\n+      };\n+      setOffset((prev) => ({\n+        x: prev.x + deltaX,\n+        y: prev.y + deltaY,\n+      }));\n+    },\n+    [isPanning],\n+  );\n+\n+  const stopPanning = useCallback(\n+    (event?: React.PointerEvent<HTMLDivElement>) => {\n+      if (panPointerIdRef.current !== null && event) {\n+        try {\n+          event.currentTarget.releasePointerCapture(\n+            panPointerIdRef.current,\n+          );\n+        } catch {\n+          // Ignore release errors if pointer capture is no longer active\n+        }\n+      }\n+      panPointerIdRef.current = null;\n+      lastPanPositionRef.current = null;\n+      setIsPanning(false);\n+    },\n+    [],\n+  );\n+\n+  const handlePointerUp = useCallback(\n+    (event: React.PointerEvent<HTMLDivElement>) => {\n+      if (panPointerIdRef.current !== event.pointerId) {\n+        return;\n+      }\n+      event.preventDefault();\n+      stopPanning(event);\n+    },\n+    [stopPanning],\n+  );\n+\n+  const handlePointerLeave = useCallback(\n+    (event: React.PointerEvent<HTMLDivElement>) => {\n+      if (!isPanning) {\n+        return;\n+      }\n+      stopPanning(event);\n+    },\n+    [isPanning, stopPanning],\n+  );\n+\n+  const handlePointerCancel = useCallback(\n+    (event: React.PointerEvent<HTMLDivElement>) => {\n+      if (panPointerIdRef.current !== event.pointerId) {\n+        return;\n+      }\n+      stopPanning(event);\n+    },\n+    [stopPanning],\n+  );\n+\n+  const handleZoomIn = useCallback(() => {\n+    setZoomWithFocus((prevZoom) => prevZoom * 1.2);\n+  }, [setZoomWithFocus]);\n+\n+  const handleZoomOut = useCallback(() => {\n+    setZoomWithFocus((prevZoom) => prevZoom / 1.2);\n+  }, [setZoomWithFocus]);\n+\n+  useEffect(() => {\n+    if (!isSlideshowOpen) {\n+      return;\n+    }\n+    const handleKeyDown = (event: KeyboardEvent) => {\n+      if (event.key === \"ArrowRight\") {\n+        event.preventDefault();\n+        goNext();\n+      } else if (event.key === \"ArrowLeft\") {\n+        event.preventDefault();\n+        goPrev();\n+      }\n+    };\n+    window.addEventListener(\"keydown\", handleKeyDown);\n+    return () => {\n+      window.removeEventListener(\"keydown\", handleKeyDown);\n+    };\n+  }, [goNext, goPrev, isSlideshowOpen]);\n+\n+  // Don't render anything if there are no screenshot sets or no images\n+  if (sortedSets.length === 0 || flattenedImages.length === 0) {\n+    return null;\n+  }\n+\n+  const latestSet = sortedSets[0];\n+\n+  return (\n+    <section className=\"border border-neutral-200 bg-white\">\n+      <div className=\"px-5 py-4 flex items-center justify-between gap-3 border-b border-neutral-200 bg-neutral-50\">\n+        <div className=\"flex items-center gap-2\">\n+          <Camera className=\"h-4 w-4 text-neutral-500\" aria-hidden />\n+          <h2 className=\"text-sm font-medium text-neutral-900\">\n+            Screenshots\n+          </h2>\n+        </div>\n+        <span className=\"text-xs text-neutral-600\">\n+          {sortedSets.length}{\" \"}\n+          {sortedSets.length === 1 ? \"capture\" : \"captures\"}\n+        </span>\n+      </div>\n+      <div className=\"p-4 space-y-4\">\n+        {currentEntry ? (\n+          <Dialog.Root\n+            open={isSlideshowOpen}\n+            onOpenChange={(open) => !open && closeSlideshow()}\n+          >\n+            <Dialog.Portal>\n+              <Dialog.Overlay className=\"fixed inset-0 bg-neutral-950/60 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=open]:fade-in data-[state=closed]:fade-out z-50\" />\n+              <Dialog.Content className=\"fixed left-1/2 top-1/2 z-[60] flex max-h-[calc(100vh-4rem)] w-[min(2600px,calc(100vw-4rem))] -translate-x-1/2 -translate-y-1/2 flex-col gap-4 border border-neutral-200 bg-white/95 p-4 shadow-2xl focus:outline-none sm:max-h-[calc(100vh-6rem)] sm:w-[min(2600px,calc(100vw-6rem))] sm:p-6\">\n+                <div className=\"flex flex-wrap items-start justify-between gap-3\">\n+                  <div className=\"space-y-1\">\n+                    <Dialog.Title className=\"text-base font-semibold text-neutral-900\">\n+                      {activeOverallIndex !== null ? `${activeOverallIndex}. ` : \"\"}\n+                      {currentEntry.image.fileName ?? \"Screenshot\"}\n+                    </Dialog.Title>\n+                    <Dialog.Description className=\"text-xs text-neutral-600\">\n+                      Image {currentEntry.indexInSet + 1} of {currentEntry.set.images.length}\n+                      <span className=\"px-1 text-neutral-400\">•</span>\n+                      {formatDistanceToNow(new Date(currentEntry.set.capturedAt), {\n+                        addSuffix: true,\n+                      })}\n+                    </Dialog.Description>\n+                  </div>\n+                  <div className=\"flex items-center gap-2\">\n+                    <div className=\"flex items-center gap-1 border border-neutral-200 bg-white/90 px-2 py-1 text-xs font-medium text-neutral-600 shadow-sm\">\n+                      <button\n+                        type=\"button\"\n+                        onClick={handleZoomOut}\n+                        disabled={!canZoomOut}\n+                        className=\"p-1 transition disabled:opacity-40 hover:bg-neutral-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/70\"\n+                        aria-label=\"Zoom out\"\n+                      >\n+                        <ZoomOut className=\"h-3.5 w-3.5\" />\n+                      </button>\n+                      <span className=\"min-w-[3rem] text-center tabular-nums\">\n+                        {zoomPercent}%\n+                      </span>\n+                      <button\n+                        type=\"button\"\n+                        onClick={handleZoomIn}\n+                        disabled={!canZoomIn}\n+                        className=\"p-1 transition disabled:opacity-40 hover:bg-neutral-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/70\"\n+                        aria-label=\"Zoom in\"\n+                      >\n+                        <ZoomIn className=\"h-3.5 w-3.5\" />\n+                      </button>\n+                      <button\n+                        type=\"button\"\n+                        onClick={() => resetZoomState()}\n+                        disabled={!canResetZoom}\n+                        className=\"p-1 transition disabled:opacity-40 hover:bg-neutral-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/70\"\n+                        aria-label=\"Reset zoom\"\n+                      >\n+                        <RotateCcw className=\"h-3.5 w-3.5\" />\n+                      </button>\n+                    </div>\n+                    <Dialog.Close asChild>\n+                      <button\n+                        type=\"button\"\n+                        onClick={closeSlideshow}\n+                        className=\"p-1.5 text-neutral-600 transition hover:bg-neutral-100 hover:text-neutral-900 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/70\"\n+                        aria-label=\"Close slideshow\"\n+                      >\n+                        <X className=\"h-4 w-4\" />\n+                      </button>\n+                    </Dialog.Close>\n+                  </div>\n+                </div>\n+                <div className=\"flex flex-1 items-center gap-4\">\n+                  {showNavButtons ? (\n+                    <button\n+                      type=\"button\"\n+                      onClick={goPrev}\n+                      className=\"border border-neutral-200 bg-white p-2 text-neutral-600 transition hover:text-neutral-900 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/70\"\n+                      aria-label=\"Previous screenshot\"\n+                    >\n+                      <ChevronLeft className=\"h-5 w-5\" />\n+                    </button>\n+                  ) : null}\n+                  <div\n+                    ref={viewportRef}\n+                    className={cn(\n+                      \"relative flex h-[70vh] max-h-[calc(100vh-10rem)] min-h-[360px] w-full flex-1 items-center justify-center overflow-hidden border border-neutral-200 bg-neutral-50\",\n+                      zoom > 1\n+                        ? isPanning\n+                          ? \"cursor-grabbing\"\n+                          : \"cursor-grab\"\n+                        : \"cursor-zoom-in\",\n+                    )}\n+                    onWheel={handleWheel}\n+                    onPointerDown={startPanning}\n+                    onPointerMove={handlePointerMove}\n+                    onPointerUp={handlePointerUp}\n+                    onPointerLeave={handlePointerLeave}\n+                    onPointerCancel={handlePointerCancel}\n+                    onDoubleClick={() => resetZoomState()}\n+                    style={{ touchAction: \"none\" }}\n+                  >\n+                    <img\n+                      src={currentEntry.image.url ?? undefined}\n+                      alt={currentEntry.image.fileName ?? \"Screenshot\"}\n+                      className=\"select-none h-full w-full object-contain\"\n+                      draggable={false}\n+                      onLoad={handleImageLoad}\n+                      style={{\n+                        transform: `translate3d(${offset.x}px, ${offset.y}px, 0) scale(${zoom})`,\n+                        transition: isPanning ? \"none\" : \"transform 120ms ease-out\",\n+                      }}\n+                    />\n+                  </div>\n+                  {showNavButtons ? (\n+                    <button\n+                      type=\"button\"\n+                      onClick={goNext}\n+                      className=\"border border-neutral-200 bg-white p-2 text-neutral-600 transition hover:text-neutral-900 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/70\"\n+                      aria-label=\"Next screenshot\"\n+                    >\n+                      <ChevronRight className=\"h-5 w-5\" />\n+                    </button>\n+                  ) : null}\n+                </div>\n+                {hasMultipleImages ? (\n+                  <div className=\"space-y-2\">\n+                    <div className=\"flex items-center justify-between text-xs font-medium text-neutral-500\">\n+                      <span className=\"sr-only\">All screenshots</span>\n+                      <span className=\"tabular-nums text-neutral-600\">\n+                        {activeOverallIndex ?? \"–\"} / {flattenedImages.length}\n+                      </span>\n+                    </div>\n+                    <div className=\"-mx-1 flex gap-2 overflow-x-auto px-1 pb-1\">\n+                      {flattenedImages.map((entry) => {\n+                        const isActiveThumb = entry.key === currentEntry?.key;\n+                        const label = entry.globalIndex + 1;\n+                        const displayName = entry.image.fileName ?? \"Screenshot\";\n+                        return (\n+                          <button\n+                            key={entry.key}\n+                            type=\"button\"\n+                            onClick={() => setActiveImageKey(entry.key)}\n+                            className={cn(\n+                              \"group relative flex h-24 w-40 flex-shrink-0 items-center justify-center overflow-hidden border border-neutral-200 bg-neutral-50 p-1 transition hover:border-neutral-400 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/70\",\n+                              isActiveThumb &&\n+                                \"border-sky-400/70 shadow-[0_0_0_1px_rgba(14,165,233,0.25)]\",\n+                            )}\n+                            aria-label={`View ${displayName}`}\n+                            aria-current={isActiveThumb ? \"true\" : undefined}\n+                            title={displayName}\n+                          >\n+                            <img\n+                              src={entry.image.url ?? undefined}\n+                              alt={displayName}\n+                              className=\"h-full w-full object-contain\"\n+                              loading=\"lazy\"\n+                              decoding=\"async\"\n+                            />\n+                            <span className=\"pointer-events-none absolute bottom-1 left-1 bg-neutral-950/80 px-1 text-[10px] font-semibold text-white shadow-sm\">\n+                              {label}\n+                            </span>\n+                          </button>\n+                        );\n+                      })}\n+                    </div>\n+                  </div>\n+                ) : null}\n+              </Dialog.Content>\n+            </Dialog.Portal>\n+          </Dialog.Root>\n+        ) : null}\n+        {sortedSets.map((set) => {\n+          const capturedAtDate = new Date(set.capturedAt);\n+          const relativeCapturedAt = formatDistanceToNow(capturedAtDate, {\n+            addSuffix: true,\n+          });\n+          const shortCommit = set.commitSha?.slice(0, 7);\n+          const isLatest = set._id === latestSet?._id;\n+\n+          return (\n+            <article\n+              key={set._id}\n+              className={cn(\n+                \"border border-neutral-200 bg-white p-3 transition-shadow\",\n+                isLatest &&\n+                \"border-sky-300 shadow-[0_0_0_1px_rgba(14,165,233,0.15)]\"\n+              )}\n+            >\n+              <div className=\"flex flex-wrap items-center gap-2\">\n+                <span\n+                  className={cn(\n+                    \"px-2 py-0.5 text-xs font-medium\",\n+                    STATUS_STYLES[set.status]\n+                  )}\n+                >\n+                  {STATUS_LABELS[set.status]}\n+                </span>\n+                {isLatest && (\n+                  <span className=\"px-2 py-0.5 text-xs font-medium bg-sky-100/80 text-sky-700\">\n+                    Latest\n+                  </span>\n+                )}\n+                <span\n+                  className=\"text-xs text-neutral-600\"\n+                  title={capturedAtDate.toLocaleString()}\n+                >\n+                  {relativeCapturedAt}\n+                </span>\n+                {shortCommit && (\n+                  <span className=\"text-xs font-mono text-neutral-600\">\n+                    {shortCommit.toLowerCase()}\n+                  </span>\n+                )}\n+                {set.images.length > 0 && (\n+                  <span className=\"text-xs text-neutral-500\">\n+                    {set.images.length}{\" \"}\n+                    {set.images.length === 1 ? \"image\" : \"images\"}\n+                  </span>\n+                )}\n+              </div>\n+              {set.error && (\n+                <p className=\"mt-2 text-xs text-rose-600\">\n+                  {set.error}\n+                </p>\n+              )}\n+              {set.images.length > 0 ? (\n+                <div className=\"mt-3 flex gap-3 overflow-x-auto pb-1\">\n+                  {set.images.map((image, indexInSet) => {\n+                    const displayName = image.fileName ?? \"Screenshot\";\n+                    const stableKey = getImageKey(set._id, image.storageId, indexInSet);\n+                    if (!image.url) {\n+                      return (\n+                        <div\n+                          key={stableKey}\n+                          className=\"flex h-48 min-w-[200px] items-center justify-center border border-dashed border-neutral-300 bg-neutral-100 text-xs text-neutral-500\"\n+                        >\n+                          URL expired\n+                        </div>\n+                      );\n+                    }\n+                    const flatIndex = globalIndexByKey.get(stableKey) ?? null;\n+                    const humanIndex = flatIndex !== null ? flatIndex + 1 : null;\n+                    const isActive = activeImageKey === stableKey;\n+\n+                    return (\n+                      <button\n+                        key={stableKey}\n+                        type=\"button\"\n+                        onClick={() => setActiveImageKey(stableKey)}\n+                        className={cn(\n+                          \"group relative flex w-[220px] flex-col overflow-hidden border border-neutral-200 bg-neutral-50 text-left transition-colors hover:border-neutral-400\",\n+                          isActive &&\n+                          \"border-sky-400/70 shadow-[0_0_0_1px_rgba(14,165,233,0.25)]\",\n+                        )}\n+                        aria-label={`Open ${displayName} in slideshow`}\n+                      >\n+                        <img\n+                          src={image.url}\n+                          alt={displayName}\n+                          className=\"h-48 w-[220px] object-contain bg-neutral-100\"\n+                          loading=\"lazy\"\n+                        />\n+                        <div className=\"absolute top-2 right-2 text-neutral-600 opacity-0 transition group-hover:opacity-100\">\n+                          <Maximize2 className=\"h-3.5 w-3.5\" />\n+                        </div>\n+                        <div className=\"border-t border-neutral-200 px-2 py-1 text-xs text-neutral-600 truncate\">\n+                          {humanIndex !== null ? `${humanIndex}. ` : \"\"}\n+                          {displayName}\n+                        </div>\n+                      </button>\n+                    );\n+                  })}\n+                </div>\n+              ) : (\n+                <p className=\"mt-2 text-xs text-neutral-500\">\n+                  {set.status === \"failed\"\n+                    ? \"Screenshot capture failed before any images were saved.\"\n+                    : \"No screenshots were captured for this attempt.\"}\n+                </p>\n+              )}\n+            </article>\n+          );\n+        })}\n+      </div>\n+    </section>\n+  );\n+}\ndiff --git a/apps/www/components/pr/pull-request-diff-viewer.tsx b/apps/www/components/pr/pull-request-diff-viewer.tsx\nindex d1cd5ebe1..568f04a16 100644\n--- a/apps/www/components/pr/pull-request-diff-viewer.tsx\n+++ b/apps/www/components/pr/pull-request-diff-viewer.tsx\n@@ -100,6 +100,7 @@ import {\n   HEATMAP_MODEL_QUERY_KEY,\n   type HeatmapModelQueryValue,\n } from \"@/lib/services/code-review/model-config\";\n+import { PrScreenshotGallery } from \"./pr-screenshot-gallery\";\n \n type PullRequestDiffViewerProps = {\n   files: GithubFileChange[];\n@@ -1019,6 +1020,25 @@ export function PullRequestDiffViewer({\n     comparisonQueryArgs\n   );\n \n+  const screenshotQueryArgs = useMemo(\n+    () =>\n+      normalizedJobType !== \"pull_request\" ||\n+      prNumber === null ||\n+      prNumber === undefined\n+        ? (\"skip\" as const)\n+        : {\n+            teamSlugOrId,\n+            repoFullName,\n+            prNumber,\n+          },\n+    [normalizedJobType, teamSlugOrId, repoFullName, prNumber]\n+  );\n+\n+  const prScreenshotSets = useConvexQuery(\n+    api.github_pr_queries.listScreenshotSetsForPr,\n+    screenshotQueryArgs\n+  );\n+\n   const fileOutputs =\n     normalizedJobType === \"comparison\" ? comparisonFileOutputs : prFileOutputs;\n \n@@ -2187,6 +2207,10 @@ export function PullRequestDiffViewer({\n                 selectedModel={heatmapModelPreference}\n                 onModelChange={handleHeatmapModelPreferenceChange}\n               />\n+              <PrScreenshotGallery\n+                screenshotSets={prScreenshotSets}\n+                commitRef={commitRef}\n+              />\n               <CmuxPromoCard />\n               {targetCount > 0 ? (\n                 <div className=\"flex justify-center\">\ndiff --git a/packages/convex/convex/github_pr_queries.ts b/packages/convex/convex/github_pr_queries.ts\nindex 7933ad23b..28ace9eae 100644\n--- a/packages/convex/convex/github_pr_queries.ts\n+++ b/packages/convex/convex/github_pr_queries.ts\n@@ -1,5 +1,6 @@\n import { v } from \"convex/values\";\n-import { internalQuery } from \"./_generated/server\";\n+import { internalQuery, query } from \"./_generated/server\";\n+import { resolveTeamIdLoose } from \"../_shared/team\";\n \n export const findTaskRunsForPr = internalQuery({\n   args: {\n@@ -58,3 +59,91 @@ export const getScreenshotSet = internalQuery({\n     };\n   },\n });\n+\n+/**\n+ * List screenshot sets for a pull request.\n+ * Finds task runs linked to the PR via taskRunPullRequests junction table,\n+ * then returns their associated screenshot sets.\n+ */\n+export const listScreenshotSetsForPr = query({\n+  args: {\n+    teamSlugOrId: v.string(),\n+    repoFullName: v.string(),\n+    prNumber: v.number(),\n+    limit: v.optional(v.number()),\n+  },\n+  handler: async (ctx, args) => {\n+    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const maxSets = Math.min(args.limit ?? 10, 10);\n+\n+    // Find task run links for this PR using the junction table\n+    const prLinks = await ctx.db\n+      .query(\"taskRunPullRequests\")\n+      .withIndex(\"by_pr\", (q) =>\n+        q\n+          .eq(\"teamId\", teamId)\n+          .eq(\"repoFullName\", args.repoFullName)\n+          .eq(\"prNumber\", args.prNumber)\n+      )\n+      .order(\"desc\")\n+      .take(50);\n+\n+    if (prLinks.length === 0) {\n+      return [];\n+    }\n+\n+    // Get unique run IDs\n+    const runIds = [...new Set(prLinks.map((link) => link.taskRunId))];\n+\n+    // Fetch runs to get their latestScreenshotSetId\n+    const runs = await Promise.all(runIds.map((id) => ctx.db.get(id)));\n+    const validRuns = runs.filter(\n+      (run): run is NonNullable<typeof run> =>\n+        run !== null && run.latestScreenshotSetId !== undefined\n+    );\n+\n+    if (validRuns.length === 0) {\n+      return [];\n+    }\n+\n+    // Get unique screenshot set IDs from the runs\n+    const screenshotSetIds = [\n+      ...new Set(\n+        validRuns\n+          .map((run) => run.latestScreenshotSetId)\n+          .filter((id): id is NonNullable<typeof id> => id !== undefined)\n+      ),\n+    ];\n+\n+    // Fetch the screenshot sets\n+    const screenshotSets = await Promise.all(\n+      screenshotSetIds.slice(0, maxSets).map(async (setId) => {\n+        const set = await ctx.db.get(setId);\n+        if (!set) {\n+          return null;\n+        }\n+\n+        // Get URLs for all images\n+        const imagesWithUrls = await Promise.all(\n+          set.images.map(async (image) => {\n+            const url = await ctx.storage.getUrl(image.storageId);\n+            return {\n+              ...image,\n+              url: url ?? undefined,\n+            };\n+          })\n+        );\n+\n+        return {\n+          ...set,\n+          images: imagesWithUrls,\n+        };\n+      })\n+    );\n+\n+    // Filter out nulls and sort by capturedAt descending\n+    return screenshotSets\n+      .filter((set): set is NonNullable<typeof set> => set !== null)\n+      .sort((a, b) => b.capturedAt - a.capturedAt);\n+  },\n+});\n","comments":[{"type":"issue_comment","id":3609990031,"prNumber":1153,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7eyw561dgbawggjmkz0ajt717wm4t9?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7eyw561dgbawggjmkz0ajt717wm4t9/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1153?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 2 screenshots for commit `9743c22` (2025-12-04 04:06:54.997 UTC).\n\n**Complete overview of the new PR Screenshot Gallery component showing the gallery interface with screenshot thumbnails, status badges \\(Completed/Latest\\), metadata \\(timestamps, commit SHAs\\), and a preview of the modal viewer with zoom controls. This demonstrates the main UI for viewing screenshots captured during PR reviews.**\n\n![01-screenshot-gallery-overview-cmux-add-diff-viewer-screenshots-ui-to-pr-review-f63vf.png](https://famous-camel-162.convex.cloud/api/storage/5c3a0837-be80-4e56-bfa6-42e56900d100)\n\n**Technical documentation diagram showing the component structure including files changed, props interface, status types, key features \\(8 total: gallery, status indicators, lightbox modal, zoom/pan, keyboard nav, metadata, multiple sets, latest highlighting\\), and implementation details \\(React hooks, external libraries, constants\\).**\n\n![05-code-structure-diagram-cmux-add-diff-viewer-screenshots-ui-to-pr-review-f63vf.png](https://famous-camel-162.convex.cloud/api/storage/20822011-e666-416e-ba6e-4395dc5a8426)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"9743c22f03d884f43e346348cc066874ff3ecdbe","createdAt":"2025-12-04T04:06:55Z","updatedAt":"2025-12-04T04:06:55Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1153#issuecomment-3609990031"}]}
{"number":1152,"title":"feat(sandbox): add copy scrollback to clipboard command","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1152","headRef":"feat/sandbox-copy-scrollback","headSha":"83f8aea159a3e15d58032f61df8491de0790378c","baseRef":"main","baseSha":"70199f97b08bf8a891d4b79d504c7fc96a25a72a","createdAt":"2025-12-04T03:35:20Z","updatedAt":"2025-12-04T03:43:58Z","diff":"diff --git a/packages/sandbox/.beads/issues.jsonl b/packages/sandbox/.beads/issues.jsonl\nindex c333baed8..95d71a192 100644\n--- a/packages/sandbox/.beads/issues.jsonl\n+++ b/packages/sandbox/.beads/issues.jsonl\n@@ -24,6 +24,6 @@\n {\"id\":\"sandbox-t33\",\"title\":\"Fix Alt+E Open Editor - SSH URI uses sandbox_id not actual host\",\"description\":\"Alt+E tries vscode-remote://ssh-remote+root@{sandbox_id}/workspace but sandbox_id is a UUID, not an SSH hostname. Need to use proper connection method - either container IP, port forwarding, or web-based editor.\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"bug\",\"created_at\":\"2025-12-02T17:19:47.617841-08:00\",\"updated_at\":\"2025-12-02T17:19:47.617841-08:00\",\"dependencies\":[{\"issue_id\":\"sandbox-t33\",\"depends_on_id\":\"sandbox-ic9\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T21:10:48.728812-08:00\",\"created_by\":\"daemon\"}]}\n {\"id\":\"sandbox-ubb\",\"title\":\"Add command palette actions for opening sandbox browser (alt+b) and editor (alt+e)\",\"description\":\"\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"feature\",\"created_at\":\"2025-12-02T15:28:21.761978-08:00\",\"updated_at\":\"2025-12-02T16:44:05.75665-08:00\",\"closed_at\":\"2025-12-02T16:44:05.75665-08:00\"}\n {\"id\":\"sandbox-v2g\",\"title\":\"Alternate screen buffer content persists after app exit (git diff/less)\",\"description\":\"After running git diff and it exits, the previous content stays on screen instead of being restored. This suggests alternate screen buffer (DECSET 1049) restore isn't working correctly.\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"bug\",\"created_at\":\"2025-12-02T17:19:49.997267-08:00\",\"updated_at\":\"2025-12-02T17:19:49.997267-08:00\"}\n-{\"id\":\"sandbox-wf5\",\"title\":\"Command palette option to copy entire scrollback to clipboard\",\"description\":\"\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"feature\",\"created_at\":\"2025-12-02T21:09:59.95193-08:00\",\"updated_at\":\"2025-12-02T21:09:59.95193-08:00\"}\n+{\"id\":\"sandbox-wf5\",\"title\":\"Command palette option to copy entire scrollback to clipboard\",\"description\":\"\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"feature\",\"created_at\":\"2025-12-02T21:09:59.95193-08:00\",\"updated_at\":\"2025-12-03T19:32:55.369802-08:00\",\"closed_at\":\"2025-12-03T19:32:55.369802-08:00\"}\n {\"id\":\"sandbox-xrq\",\"title\":\"Add keyboard shortcut to delete sandbox (alt+shift+w is currently CloseTab)\",\"description\":\"\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"feature\",\"created_at\":\"2025-12-02T15:28:25.430463-08:00\",\"updated_at\":\"2025-12-02T16:19:33.257153-08:00\",\"closed_at\":\"2025-12-02T16:19:33.257153-08:00\"}\n {\"id\":\"sandbox-xyz\",\"title\":\"Add better logging for sandbox lifecycle (creation, cleanup, FD usage)\",\"description\":\"\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T21:57:23.496291-08:00\",\"updated_at\":\"2025-12-02T21:57:37.966722-08:00\",\"closed_at\":\"2025-12-02T21:57:37.966722-08:00\"}\ndiff --git a/packages/sandbox/Cargo.lock b/packages/sandbox/Cargo.lock\nindex fd4621b37..12932efb3 100644\n--- a/packages/sandbox/Cargo.lock\n+++ b/packages/sandbox/Cargo.lock\n@@ -147,6 +147,26 @@ dependencies = [\n  \"derive_arbitrary\",\n ]\n \n+[[package]]\n+name = \"arboard\"\n+version = \"3.6.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"0348a1c054491f4bfe6ab86a7b6ab1e44e45d899005de92f58b3df180b36ddaf\"\n+dependencies = [\n+ \"clipboard-win\",\n+ \"image\",\n+ \"log\",\n+ \"objc2\",\n+ \"objc2-app-kit\",\n+ \"objc2-core-foundation\",\n+ \"objc2-core-graphics\",\n+ \"objc2-foundation\",\n+ \"parking_lot\",\n+ \"percent-encoding\",\n+ \"windows-sys 0.60.2\",\n+ \"x11rb\",\n+]\n+\n [[package]]\n name = \"arrayvec\"\n version = \"0.7.6\"\n@@ -358,12 +378,24 @@ version = \"3.19.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"46c5e41b57b8bba42a04676d81cb89e9ee8e859a1a66f80a5a72e1cb76b34d43\"\n \n+[[package]]\n+name = \"bytemuck\"\n+version = \"1.24.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"1fbdf580320f38b612e485521afda1ee26d10cc9884efaaa750d383e13e3c5f4\"\n+\n [[package]]\n name = \"byteorder\"\n version = \"1.5.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"1fd0f2584146f6f2ef48085050886acf353beff7305ebd1ae69500e27c67f64b\"\n \n+[[package]]\n+name = \"byteorder-lite\"\n+version = \"0.1.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"8f1fe948ff07f4bd06c30984e69f5b4899c516a3ef74f34df92a2df2ab535495\"\n+\n [[package]]\n name = \"bytes\"\n version = \"1.11.0\"\n@@ -496,6 +528,15 @@ version = \"0.7.6\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"a1d728cc89cf3aee9ff92b05e62b19ee65a02b5702cff7d5a377e32c6ae29d8d\"\n \n+[[package]]\n+name = \"clipboard-win\"\n+version = \"5.4.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"bde03770d3df201d4fb868f2c9c59e66a3e4e2bd06692a0fe701e7103c7e84d4\"\n+dependencies = [\n+ \"error-code\",\n+]\n+\n [[package]]\n name = \"cmake\"\n version = \"0.1.54\"\n@@ -511,6 +552,7 @@ version = \"0.0.1\"\n dependencies = [\n  \"agent-client-protocol\",\n  \"anyhow\",\n+ \"arboard\",\n  \"assert_cmd\",\n  \"async-trait\",\n  \"axum\",\n@@ -888,6 +930,16 @@ dependencies = [\n  \"crypto-common\",\n ]\n \n+[[package]]\n+name = \"dispatch2\"\n+version = \"0.3.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"89a09f22a6c6069a18470eb92d2298acf25463f14256d24778e1230d789a2aec\"\n+dependencies = [\n+ \"bitflags 2.10.0\",\n+ \"objc2\",\n+]\n+\n [[package]]\n name = \"displaydoc\"\n version = \"0.2.5\"\n@@ -948,6 +1000,12 @@ dependencies = [\n  \"windows-sys 0.61.2\",\n ]\n \n+[[package]]\n+name = \"error-code\"\n+version = \"3.3.2\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"dea2df4cf52843e0452895c455a1a2cfbb842a1e7329671acf418fdc53ed4c59\"\n+\n [[package]]\n name = \"event-listener\"\n version = \"5.4.1\"\n@@ -975,6 +1033,35 @@ version = \"2.3.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"37909eebbb50d72f9059c3b6d82c0463f2ff062c9e95845c43a6c9c0355411be\"\n \n+[[package]]\n+name = \"fax\"\n+version = \"0.2.6\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"f05de7d48f37cd6730705cbca900770cab77a89f413d23e100ad7fad7795a0ab\"\n+dependencies = [\n+ \"fax_derive\",\n+]\n+\n+[[package]]\n+name = \"fax_derive\"\n+version = \"0.2.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"a0aca10fb742cb43f9e7bb8467c91aa9bcb8e3ffbc6a6f7389bb93ffc920577d\"\n+dependencies = [\n+ \"proc-macro2\",\n+ \"quote\",\n+ \"syn\",\n+]\n+\n+[[package]]\n+name = \"fdeflate\"\n+version = \"0.3.7\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"1e6853b52649d4ac5c0bd02320cddc5ba956bdb407c4b75a2c6b75bf51500f8c\"\n+dependencies = [\n+ \"simd-adler32\",\n+]\n+\n [[package]]\n name = \"filedescriptor\"\n version = \"0.8.3\"\n@@ -1156,6 +1243,16 @@ dependencies = [\n  \"version_check\",\n ]\n \n+[[package]]\n+name = \"gethostname\"\n+version = \"1.1.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"1bd49230192a3797a9a4d6abe9b3eed6f7fa4c8a8a4947977c6f80025f92cbd8\"\n+dependencies = [\n+ \"rustix 1.1.2\",\n+ \"windows-link\",\n+]\n+\n [[package]]\n name = \"getopts\"\n version = \"0.2.24\"\n@@ -1537,6 +1634,20 @@ dependencies = [\n  \"winapi-util\",\n ]\n \n+[[package]]\n+name = \"image\"\n+version = \"0.25.9\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"e6506c6c10786659413faa717ceebcb8f70731c0a60cbae39795fdf114519c1a\"\n+dependencies = [\n+ \"bytemuck\",\n+ \"byteorder-lite\",\n+ \"moxcms\",\n+ \"num-traits\",\n+ \"png\",\n+ \"tiff\",\n+]\n+\n [[package]]\n name = \"indexmap\"\n version = \"2.12.1\"\n@@ -1851,6 +1962,16 @@ dependencies = [\n  \"windows-sys 0.61.2\",\n ]\n \n+[[package]]\n+name = \"moxcms\"\n+version = \"0.7.10\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"80986bbbcf925ebd3be54c26613d861255284584501595cf418320c078945608\"\n+dependencies = [\n+ \"num-traits\",\n+ \"pxfm\",\n+]\n+\n [[package]]\n name = \"nix\"\n version = \"0.25.1\"\n@@ -1917,6 +2038,79 @@ dependencies = [\n  \"autocfg\",\n ]\n \n+[[package]]\n+name = \"objc2\"\n+version = \"0.6.3\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"b7c2599ce0ec54857b29ce62166b0ed9b4f6f1a70ccc9a71165b6154caca8c05\"\n+dependencies = [\n+ \"objc2-encode\",\n+]\n+\n+[[package]]\n+name = \"objc2-app-kit\"\n+version = \"0.3.2\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"d49e936b501e5c5bf01fda3a9452ff86dc3ea98ad5f283e1455153142d97518c\"\n+dependencies = [\n+ \"bitflags 2.10.0\",\n+ \"objc2\",\n+ \"objc2-core-graphics\",\n+ \"objc2-foundation\",\n+]\n+\n+[[package]]\n+name = \"objc2-core-foundation\"\n+version = \"0.3.2\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"2a180dd8642fa45cdb7dd721cd4c11b1cadd4929ce112ebd8b9f5803cc79d536\"\n+dependencies = [\n+ \"bitflags 2.10.0\",\n+ \"dispatch2\",\n+ \"objc2\",\n+]\n+\n+[[package]]\n+name = \"objc2-core-graphics\"\n+version = \"0.3.2\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"e022c9d066895efa1345f8e33e584b9f958da2fd4cd116792e15e07e4720a807\"\n+dependencies = [\n+ \"bitflags 2.10.0\",\n+ \"dispatch2\",\n+ \"objc2\",\n+ \"objc2-core-foundation\",\n+ \"objc2-io-surface\",\n+]\n+\n+[[package]]\n+name = \"objc2-encode\"\n+version = \"4.1.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"ef25abbcd74fb2609453eb695bd2f860d389e457f67dc17cafc8b8cbc89d0c33\"\n+\n+[[package]]\n+name = \"objc2-foundation\"\n+version = \"0.3.2\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"e3e0adef53c21f888deb4fa59fc59f7eb17404926ee8a6f59f5df0fd7f9f3272\"\n+dependencies = [\n+ \"bitflags 2.10.0\",\n+ \"objc2\",\n+ \"objc2-core-foundation\",\n+]\n+\n+[[package]]\n+name = \"objc2-io-surface\"\n+version = \"0.3.2\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"180788110936d59bab6bd83b6060ffdfffb3b922ba1396b312ae795e1de9d81d\"\n+dependencies = [\n+ \"bitflags 2.10.0\",\n+ \"objc2\",\n+ \"objc2-core-foundation\",\n+]\n+\n [[package]]\n name = \"once_cell\"\n version = \"1.21.3\"\n@@ -2090,6 +2284,19 @@ dependencies = [\n  \"plotters-backend\",\n ]\n \n+[[package]]\n+name = \"png\"\n+version = \"0.18.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"97baced388464909d42d89643fe4361939af9b7ce7a31ee32a168f832a70f2a0\"\n+dependencies = [\n+ \"bitflags 2.10.0\",\n+ \"crc32fast\",\n+ \"fdeflate\",\n+ \"flate2\",\n+ \"miniz_oxide\",\n+]\n+\n [[package]]\n name = \"portable-pty\"\n version = \"0.8.1\"\n@@ -2225,6 +2432,21 @@ version = \"0.11.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"007d8adb5ddab6f8e3f491ac63566a7d5002cc7ed73901f72057943fa71ae1ae\"\n \n+[[package]]\n+name = \"pxfm\"\n+version = \"0.1.26\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"b3502d6155304a4173a5f2c34b52b7ed0dd085890326cb50fd625fdf39e86b3b\"\n+dependencies = [\n+ \"num-traits\",\n+]\n+\n+[[package]]\n+name = \"quick-error\"\n+version = \"2.0.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"a993555f31e5a609f617c12db6250dedcac1b0a85076912c436e6fc9b2c8e6a3\"\n+\n [[package]]\n name = \"quick-xml\"\n version = \"0.38.4\"\n@@ -3236,6 +3458,20 @@ dependencies = [\n  \"cfg-if\",\n ]\n \n+[[package]]\n+name = \"tiff\"\n+version = \"0.10.3\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"af9605de7fee8d9551863fd692cce7637f548dbd9db9180fcc07ccc6d26c336f\"\n+dependencies = [\n+ \"fax\",\n+ \"flate2\",\n+ \"half\",\n+ \"quick-error\",\n+ \"weezl\",\n+ \"zune-jpeg\",\n+]\n+\n [[package]]\n name = \"time\"\n version = \"0.3.44\"\n@@ -3927,6 +4163,12 @@ dependencies = [\n  \"rustls-pki-types\",\n ]\n \n+[[package]]\n+name = \"weezl\"\n+version = \"0.1.12\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"a28ac98ddc8b9274cb41bb4d9d4d5c425b6020c50c46f25559911905610b4a88\"\n+\n [[package]]\n name = \"which\"\n version = \"6.0.3\"\n@@ -4230,6 +4472,23 @@ version = \"0.6.2\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"9edde0db4769d2dc68579893f2306b26c6ecfbe0ef499b013d731b7b9247e0b9\"\n \n+[[package]]\n+name = \"x11rb\"\n+version = \"0.13.2\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"9993aa5be5a26815fe2c3eacfc1fde061fc1a1f094bf1ad2a18bf9c495dd7414\"\n+dependencies = [\n+ \"gethostname\",\n+ \"rustix 1.1.2\",\n+ \"x11rb-protocol\",\n+]\n+\n+[[package]]\n+name = \"x11rb-protocol\"\n+version = \"0.13.2\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"ea6fc2961e4ef194dcbfe56bb845534d0dc8098940c7e5c012a258bfec6701bd\"\n+\n [[package]]\n name = \"xattr\"\n version = \"1.6.1\"\n@@ -4408,3 +4667,18 @@ dependencies = [\n  \"log\",\n  \"simd-adler32\",\n ]\n+\n+[[package]]\n+name = \"zune-core\"\n+version = \"0.4.12\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"3f423a2c17029964870cfaabb1f13dfab7d092a62a29a89264f4d36990ca414a\"\n+\n+[[package]]\n+name = \"zune-jpeg\"\n+version = \"0.4.21\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"29ce2c8a9384ad323cf564b67da86e21d3cfdff87908bc1223ed5c99bc792713\"\n+dependencies = [\n+ \"zune-core\",\n+]\ndiff --git a/packages/sandbox/Cargo.toml b/packages/sandbox/Cargo.toml\nindex 4773c1e08..6e883e600 100644\n--- a/packages/sandbox/Cargo.toml\n+++ b/packages/sandbox/Cargo.toml\n@@ -68,6 +68,7 @@ vte = \"0.15\"\n base64 = \"0.22.1\"\n unicode-width = \"0.2\"\n open = \"5\"\n+arboard = \"3\"\n \n [dev-dependencies]\n assert_cmd = \"2.0\"\ndiff --git a/packages/sandbox/src/mux/commands.rs b/packages/sandbox/src/mux/commands.rs\nindex 63129dfea..4a59feb82 100644\n--- a/packages/sandbox/src/mux/commands.rs\n+++ b/packages/sandbox/src/mux/commands.rs\n@@ -79,6 +79,7 @@ pub enum MuxCommand {\n     // Terminal utilities\n     EnableDeltaPager,\n     DisableDeltaPager,\n+    CopyScrollback,\n }\n \n #[derive(Debug, Clone, PartialEq, Eq)]\n@@ -158,6 +159,7 @@ impl MuxCommand {\n             // Terminal utilities\n             MuxCommand::EnableDeltaPager,\n             MuxCommand::DisableDeltaPager,\n+            MuxCommand::CopyScrollback,\n         ]\n     }\n \n@@ -222,6 +224,7 @@ impl MuxCommand {\n             MuxCommand::ScrollToBottom => \"Scroll to Bottom\",\n             MuxCommand::EnableDeltaPager => \"Enable Delta Pager\",\n             MuxCommand::DisableDeltaPager => \"Disable Delta Pager\",\n+            MuxCommand::CopyScrollback => \"Copy Scrollback\",\n         }\n     }\n \n@@ -255,6 +258,7 @@ impl MuxCommand {\n             MuxCommand::ScrollToBottom => &[\"end\", \"bottom\"],\n             MuxCommand::EnableDeltaPager => &[\"git diff\", \"syntax highlighting\", \"pretty diff\"],\n             MuxCommand::DisableDeltaPager => &[\"git diff\", \"plain diff\", \"default pager\"],\n+            MuxCommand::CopyScrollback => &[\"copy\", \"clipboard\", \"terminal output\", \"history\"],\n             _ => &[],\n         }\n     }\n@@ -320,6 +324,7 @@ impl MuxCommand {\n             MuxCommand::ScrollToBottom => \"Scroll to the bottom\",\n             MuxCommand::EnableDeltaPager => \"Use delta for syntax-highlighted git diffs\",\n             MuxCommand::DisableDeltaPager => \"Use default pager for git diffs\",\n+            MuxCommand::CopyScrollback => \"Copy entire terminal scrollback to clipboard\",\n         }\n     }\n \n@@ -389,7 +394,9 @@ impl MuxCommand {\n             | MuxCommand::ScrollToTop\n             | MuxCommand::ScrollToBottom => \"General\",\n \n-            MuxCommand::EnableDeltaPager | MuxCommand::DisableDeltaPager => \"Terminal\",\n+            MuxCommand::EnableDeltaPager\n+            | MuxCommand::DisableDeltaPager\n+            | MuxCommand::CopyScrollback => \"Terminal\",\n         }\n     }\n \n@@ -517,6 +524,7 @@ impl MuxCommand {\n             // Terminal utilities - access via command palette only\n             MuxCommand::EnableDeltaPager => None,\n             MuxCommand::DisableDeltaPager => None,\n+            MuxCommand::CopyScrollback => None,\n         }\n     }\n \ndiff --git a/packages/sandbox/src/mux/state.rs b/packages/sandbox/src/mux/state.rs\nindex 975e25640..f7585ed7b 100644\n--- a/packages/sandbox/src/mux/state.rs\n+++ b/packages/sandbox/src/mux/state.rs\n@@ -715,6 +715,47 @@ impl<'a> MuxApp<'a> {\n                     self.set_status(\"Delta pager disabled\");\n                 }\n             }\n+            MuxCommand::CopyScrollback => {\n+                // Get the active pane's terminal content and copy to clipboard\n+                // Extract the text first to avoid borrow conflicts with set_status\n+                let result: Result<String, &'static str> = (|| {\n+                    let pane_id = self.active_pane_id().ok_or(\"No active pane\")?;\n+                    let manager = self\n+                        .terminal_manager\n+                        .as_ref()\n+                        .ok_or(\"Terminal manager not available\")?;\n+                    let mut guard = manager\n+                        .try_lock()\n+                        .map_err(|_| \"Could not access terminal\")?;\n+                    let buffer = guard\n+                        .get_buffer_mut(pane_id)\n+                        .ok_or(\"No terminal in active pane\")?;\n+                    Ok(buffer.get_all_text())\n+                })();\n+\n+                match result {\n+                    Ok(text) if text.is_empty() => {\n+                        self.set_status(\"Terminal is empty\");\n+                    }\n+                    Ok(text) => match arboard::Clipboard::new() {\n+                        Ok(mut clipboard) => match clipboard.set_text(&text) {\n+                            Ok(()) => {\n+                                let lines = text.lines().count();\n+                                self.set_status(format!(\"Copied {} lines to clipboard\", lines));\n+                            }\n+                            Err(e) => {\n+                                self.set_status(format!(\"Failed to copy: {}\", e));\n+                            }\n+                        },\n+                        Err(e) => {\n+                            self.set_status(format!(\"Clipboard not available: {}\", e));\n+                        }\n+                    },\n+                    Err(msg) => {\n+                        self.set_status(msg);\n+                    }\n+                }\n+            }\n         }\n     }\n \ndiff --git a/packages/sandbox/src/mux/terminal.rs b/packages/sandbox/src/mux/terminal.rs\nindex ba3eb786c..b80307bf5 100644\n--- a/packages/sandbox/src/mux/terminal.rs\n+++ b/packages/sandbox/src/mux/terminal.rs\n@@ -3155,6 +3155,29 @@ impl TerminalBuffer {\n         self.terminal.rows()\n     }\n \n+    /// Get all terminal content as plain text (scrollback + viewport).\n+    /// Each line is joined with newlines, and trailing whitespace is trimmed.\n+    pub fn get_all_text(&self) -> String {\n+        let mut lines = Vec::new();\n+\n+        // Add scrollback lines first\n+        for row in &self.terminal.internal_grid.lines_above {\n+            lines.push(row.as_string().trim_end().to_string());\n+        }\n+\n+        // Add viewport lines\n+        for row in &self.terminal.internal_grid.viewport {\n+            lines.push(row.as_string().trim_end().to_string());\n+        }\n+\n+        // Remove trailing empty lines\n+        while lines.last().is_some_and(|l| l.is_empty()) {\n+            lines.pop();\n+        }\n+\n+        lines.join(\"\\n\")\n+    }\n+\n     /// Try to extract a URL at the given row and column (0-indexed).\n     pub fn url_at_position(&self, row: usize, col: usize) -> Option<String> {\n         if self.scroll_offset != 0 {\n","comments":[{"type":"issue_comment","id":3609945066,"prNumber":1152,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn74q29c2h9mzkev85cxsgsvhh7wmrnz?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn74q29c2h9mzkev85cxsgsvhh7wmrnz/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1152?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"83f8aea159a3e15d58032f61df8491de0790378c","createdAt":"2025-12-04T03:43:34Z","updatedAt":"2025-12-04T03:43:34Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1152#issuecomment-3609945066"}]}
{"number":1151,"title":"Investigate vscode remote in cloud mode errors","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1151","headRef":"cmux/investigate-vscode-remote-in-cloud-mode-errors-67q0a","headSha":"f0ce8bca0f13e7cf3fa4e8f52c7bd4b8787d7933","baseRef":"main","baseSha":"f17b9392414d09faf5916968b94717421117055e","createdAt":"2025-12-04T03:21:42Z","updatedAt":"2025-12-04T04:33:39Z","diff":"diff --git a/apps/server/src/vscode/serveWeb.test.ts b/apps/server/src/vscode/serveWeb.test.ts\nnew file mode 100644\nindex 000000000..00119ca3d\n--- /dev/null\n+++ b/apps/server/src/vscode/serveWeb.test.ts\n@@ -0,0 +1,24 @@\n+import { describe, expect, it } from \"vitest\";\n+import { normalizeVSCodeExecutableCandidate } from \"./serveWeb\";\n+\n+describe(\"normalizeVSCodeExecutableCandidate\", () => {\n+  it(\"extracts executable path from common alias formats\", () => {\n+    expect(\n+      normalizeVSCodeExecutableCandidate(\n+        \"alias code=/app/openvscode-server/bin/openvscode-server\"\n+      )\n+    ).toBe(\"/app/openvscode-server/bin/openvscode-server\");\n+\n+    expect(\n+      normalizeVSCodeExecutableCandidate(\n+        \"code: aliased to /usr/bin/code --reuse-window\"\n+      )\n+    ).toBe(\"/usr/bin/code\");\n+  });\n+\n+  it(\"returns the candidate untouched when it is already a path\", () => {\n+    expect(normalizeVSCodeExecutableCandidate(\"/usr/local/bin/code\")).toBe(\n+      \"/usr/local/bin/code\"\n+    );\n+  });\n+});\ndiff --git a/apps/server/src/vscode/serveWeb.ts b/apps/server/src/vscode/serveWeb.ts\nindex 3797dab5c..61f50bd10 100644\n--- a/apps/server/src/vscode/serveWeb.ts\n+++ b/apps/server/src/vscode/serveWeb.ts\n@@ -221,8 +221,16 @@ async function resolveVSCodeExecutable(logger: Logger) {\n         .find((line) => line.length > 0);\n \n       if (candidate) {\n-        resolvedVSCodeExecutable = candidate;\n-        logger.info(`Resolved VS Code CLI executable: ${candidate}`);\n+        const normalizedCandidate =\n+          normalizeVSCodeExecutableCandidate(candidate);\n+        resolvedVSCodeExecutable = normalizedCandidate;\n+        logger.info(\n+          `Resolved VS Code CLI executable: ${\n+            normalizedCandidate !== candidate\n+              ? `${normalizedCandidate} (from ${candidate})`\n+              : normalizedCandidate\n+          }`\n+        );\n         break;\n       }\n     } catch (error) {\n@@ -241,9 +249,15 @@ async function resolveVSCodeExecutable(logger: Logger) {\n         .map((line) => line.trim())\n         .find((line) => line.length > 0);\n       if (candidate) {\n-        resolvedVSCodeExecutable = candidate;\n+        const normalizedCandidate =\n+          normalizeVSCodeExecutableCandidate(candidate);\n+        resolvedVSCodeExecutable = normalizedCandidate;\n         logger.info(\n-          `Resolved VS Code CLI executable via shell lookup: ${candidate}`\n+          `Resolved VS Code CLI executable via shell lookup: ${\n+            normalizedCandidate !== candidate\n+              ? `${normalizedCandidate} (from ${candidate})`\n+              : normalizedCandidate\n+          }`\n         );\n       }\n     } catch (error) {\n@@ -257,6 +271,40 @@ async function resolveVSCodeExecutable(logger: Logger) {\n   return resolvedVSCodeExecutable;\n }\n \n+/**\n+ * VS Code CLI binaries are sometimes exposed as shell aliases (e.g.\n+ * `alias code=/app/openvscode-server/bin/openvscode-server`). Normalize those\n+ * alias strings into an executable path we can `access`/`spawn`.\n+ */\n+export function normalizeVSCodeExecutableCandidate(candidate: string): string {\n+  const trimmed = candidate.trim();\n+  const aliasPatterns = [\n+    /^alias\\s+code=(.+)$/i,\n+    /^code:\\s*aliased to\\s*(.+)$/i,\n+    /^code is an alias for\\s+(.+)$/i,\n+  ];\n+\n+  for (const pattern of aliasPatterns) {\n+    const match = trimmed.match(pattern);\n+    if (match?.[1]) {\n+      let aliasTarget = match[1].trim();\n+      if (\n+        (aliasTarget.startsWith(\"'\") && aliasTarget.endsWith(\"'\")) ||\n+        (aliasTarget.startsWith('\"') && aliasTarget.endsWith('\"'))\n+      ) {\n+        aliasTarget = aliasTarget.slice(1, -1);\n+      }\n+      // Alias definitions can include arguments; we only need the binary path.\n+      const [path] = aliasTarget.split(/\\s+/);\n+      if (path) {\n+        return path;\n+      }\n+    }\n+  }\n+\n+  return trimmed;\n+}\n+\n async function warmUpVSCodeServeWeb(port: number, logger: Logger) {\n   const warmupDeadline = Date.now() + 10_000;\n \n","comments":[{"type":"issue_comment","id":3609898495,"prNumber":1151,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7440mf6nc1ckjje9khgr5c6h7wmjvy?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7440mf6nc1ckjje9khgr5c6h7wmjvy/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1151?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 6 screenshots for commit `4f8bb68` (2025-12-04 03:27:05.380 UTC).\n\n**Dashboard full page view - showing the main cmux interface with sidebar, task creation area, and workspaces/previews sections**\n\n![dashboard-full-page.png](https://famous-camel-162.convex.cloud/api/storage/5e3ffb7a-ba95-4f1f-bb89-2d365b8d2477)\n\n**Dashboard sidebar element - navigation menu showing Home, Environments, Settings, Pull requests, Workspaces, and Previews sections**\n\n![dashboard-sidebar.png](https://famous-camel-162.convex.cloud/api/storage/398b5731-7306-4cda-8829-10e1f7d4a611)\n\n**Dashboard with sidebar visible - full page view showing navigation menu with pull requests, workspaces, and previews**\n\n![dashboard-with-sidebar-full.png](https://famous-camel-162.convex.cloud/api/storage/6704cd94-5ffe-4ff8-a5ae-55b36919f4fb)\n\n**Delete confirmation dialog element - close-up of the custom dialog showing 'Delete configuration?' prompt for manaflow-ai/cmux**\n\n![preview-delete-dialog-element.png](https://famous-camel-162.convex.cloud/api/storage/340b8c77-0cbe-4e9a-8c58-20b1e009292c)\n\n**Preview page delete confirmation dialog - full page view showing the custom modal overlay that replaced RadixUI AlertDialog**\n\n![preview-delete-dialog-full.png](https://famous-camel-162.convex.cloud/api/storage/94be614c-15a6-4be5-be4b-03dd0ba33601)\n\n**Preview page full view - showing configured repositories \\(manaflow-ai/cmux and austinywang/landing\\) with delete and settings buttons**\n\n![preview-page-full.png](https://famous-camel-162.convex.cloud/api/storage/d2a876f4-45ca-4e25-afec-d0014206c7dc)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"f0ce8bca0f13e7cf3fa4e8f52c7bd4b8787d7933","createdAt":"2025-12-04T03:27:06Z","updatedAt":"2025-12-04T03:43:51Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1151#issuecomment-3609898495"},{"type":"issue_comment","id":3609945461,"prNumber":1151,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7fdtkchpp6rxhaxmxntpachh7wmjtn?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7fdtkchpp6rxhaxmxntpachh7wmjtn/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1151?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 4 screenshots for commit `f0ce8bc` (2025-12-04 03:43:49.961 UTC).\n\n**Client dashboard with sidebar \\(no visible changes - only internal keyboard event handling improvements\\)**\n\n![client-dashboard-sidebar.png](https://famous-camel-162.convex.cloud/api/storage/935d0456-9818-4397-9986-49b867135c33)\n\n**Close-up of the new AlertDialog component showing delete confirmation with Cancel and Delete buttons**\n\n![delete-confirmation-dialog.png](https://famous-camel-162.convex.cloud/api/storage/bceb6d39-cb45-4529-8410-af5e0b35e94e)\n\n**Preview dashboard with the delete confirmation AlertDialog open \\(full page view showing modal overlay\\)**\n\n![preview-dashboard-delete-dialog-full.png](https://famous-camel-162.convex.cloud/api/storage/21185e13-365a-44ae-ba40-2ed1869bbb0b)\n\n**Preview dashboard main view showing the repository selection interface and configured repositories list**\n\n![preview-dashboard-main-view.png](https://famous-camel-162.convex.cloud/api/storage/b889164c-94e1-458d-985f-0b3222887164)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"f0ce8bca0f13e7cf3fa4e8f52c7bd4b8787d7933","createdAt":"2025-12-04T03:43:51Z","updatedAt":"2025-12-04T03:43:51Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1151#issuecomment-3609945461"}]}
{"number":1150,"title":"Post PR comment for previews with no-ui-changes","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1150","headRef":"cmux/post-pr-comment-for-previews-with-no-ui-changes-utmyi","headSha":"49cd2a32f2d76463e554a28b3638a801e3a66d81","baseRef":"main","baseSha":"70199f97b08bf8a891d4b79d504c7fc96a25a72a","createdAt":"2025-12-04T03:17:55Z","updatedAt":"2025-12-05T09:05:57Z","diff":"diff --git a/packages/convex/convex/screenshots_http.ts b/packages/convex/convex/screenshots_http.ts\nindex 8b2d8de9e..b2d779899 100644\n--- a/packages/convex/convex/screenshots_http.ts\n+++ b/packages/convex/convex/screenshots_http.ts\n@@ -119,7 +119,14 @@ export const uploadScreenshot = httpAction(async (ctx, req) => {\n       commitSha: primaryScreenshot.commitSha,\n       screenshotSetId: resolvedScreenshotSetId,\n     });\n-  } else if (payload.status !== \"completed\") {\n+  } else if (resolvedScreenshotSetId) {\n+    // No screenshots but we have a screenshot set (e.g., skipped/no-UI-changes).\n+    // Still link the screenshot set to the task run so PR comments can be posted.\n+    await ctx.runMutation(internal.taskRuns.updateLatestScreenshotSetId, {\n+      id: payload.runId,\n+      screenshotSetId: resolvedScreenshotSetId,\n+    });\n+  } else {\n     await ctx.runMutation(internal.taskRuns.clearScreenshotMetadata, {\n       id: payload.runId,\n     });\ndiff --git a/packages/convex/convex/taskRuns.ts b/packages/convex/convex/taskRuns.ts\nindex 8891b8a7d..459dbd245 100644\n--- a/packages/convex/convex/taskRuns.ts\n+++ b/packages/convex/convex/taskRuns.ts\n@@ -695,6 +695,24 @@ export const clearScreenshotMetadata = internalMutation({\n   },\n });\n \n+/**\n+ * Update only the latestScreenshotSetId without modifying other screenshot fields.\n+ * Used when a screenshot set is created (e.g., for skipped/no-UI-changes runs)\n+ * but there are no actual image files to store.\n+ */\n+export const updateLatestScreenshotSetId = internalMutation({\n+  args: {\n+    id: v.id(\"taskRuns\"),\n+    screenshotSetId: v.id(\"taskRunScreenshotSets\"),\n+  },\n+  handler: async (ctx, args) => {\n+    await ctx.db.patch(args.id, {\n+      latestScreenshotSetId: args.screenshotSetId,\n+      updatedAt: Date.now(),\n+    });\n+  },\n+});\n+\n // Update worktree path for a task run\n export const updateWorktreePath = authMutation({\n   args: {\ndiff --git a/packages/www-openapi-client/src/client/types.gen.ts b/packages/www-openapi-client/src/client/types.gen.ts\nindex e63d671f2..f6f443416 100644\n--- a/packages/www-openapi-client/src/client/types.gen.ts\n+++ b/packages/www-openapi-client/src/client/types.gen.ts\n@@ -384,7 +384,7 @@ export type SetupInstanceBody = {\n     instanceId?: string;\n     selectedRepos?: Array<string>;\n     ttlSeconds?: number;\n-    snapshotId?: string | ('snapshot_hszt8v6s' | 'snapshot_smvgcirt' | 'snapshot_pcmfvjra');\n+    snapshotId?: string | ('snapshot_6az195xq' | 'snapshot_0kz5x004' | 'snapshot_pcmfvjra');\n };\n \n export type CreateEnvironmentResponse = {\n","comments":[{"type":"issue_comment","id":3609883687,"prNumber":1150,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn73p42epe0vechps4be55s66n7wn8xp?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn73p42epe0vechps4be55s66n7wn8xp/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1150?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nScreenshot capture was skipped.\n\n> No UI changes detected in this PR\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"49cd2a32f2d76463e554a28b3638a801e3a66d81","createdAt":"2025-12-04T03:22:15Z","updatedAt":"2025-12-04T03:22:15Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1150#issuecomment-3609883687"}]}
{"number":1149,"title":"Make setup script textarea resizable","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1149","headRef":"cmux/make-setup-script-textarea-resizable-u8e8p","headSha":"6fbfa9128ccc740afc92fa9411ecb67d4e2b1868","baseRef":"main","baseSha":"7f9ef2448a6b98e3ab165acc6dd93eb0234dae6c","createdAt":"2025-12-04T03:14:47Z","updatedAt":"2025-12-04T05:52:12Z","diff":"diff --git a/apps/client/src/components/ScriptTextareaField.tsx b/apps/client/src/components/ScriptTextareaField.tsx\nindex 034fec381..434633753 100644\n--- a/apps/client/src/components/ScriptTextareaField.tsx\n+++ b/apps/client/src/components/ScriptTextareaField.tsx\n@@ -57,7 +57,7 @@ export function ScriptTextareaField({\n         minRows={minRows}\n         maxRows={maxRows}\n         className={cn(\n-          \"w-full rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-3 py-2 text-xs font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 resize-none\",\n+          \"w-full rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-3 py-2 text-xs font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 resize-y\",\n           minHeightClassName,\n           disabled && \"opacity-80 cursor-not-allowed\"\n         )}\n","comments":[{"type":"issue_comment","id":3609890890,"prNumber":1149,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7f4rpetf1dvp9xn8kynhg6k97wnktg?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7f4rpetf1dvp9xn8kynhg6k97wnktg/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1149?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 4 screenshots for commit `6fbfa91` (2025-12-04 03:24:23.906 UTC).\n\n**Full page view of environment detail page with Dev Script textarea in edit mode, showing the resizable textarea with resize-y CSS class applied**\n\n![01-environment-detail-dev-script-edit-mode-full.png](https://famous-camel-162.convex.cloud/api/storage/40ca8f6b-7854-4b57-9e90-7a26ca9b27c7)\n\n**Close-up of the Dev Script textarea element showing the resize handle and content 'SKIP\\_DOCKER\\_BUILD=true ./scripts/dev.sh'**\n\n![02-dev-script-textarea-element.png](https://famous-camel-162.convex.cloud/api/storage/f3b4419f-de87-4b7c-a2f7-1213a8b2ee44)\n\n**Full page view of environment detail page with Maintenance Script textarea in edit mode, demonstrating the resizable textarea functionality**\n\n![03-environment-detail-maintenance-script-edit-mode-full.png](https://famous-camel-162.convex.cloud/api/storage/6a684c34-56f8-4aca-9764-02323c632487)\n\n**Close-up of the Maintenance Script textarea element showing the resize handle and content 'bun i'**\n\n![04-maintenance-script-textarea-element.png](https://famous-camel-162.convex.cloud/api/storage/d6060268-7769-4250-94b5-9c87adf8b65d)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"6fbfa9128ccc740afc92fa9411ecb67d4e2b1868","createdAt":"2025-12-04T03:24:25Z","updatedAt":"2025-12-04T03:38:55Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1149#issuecomment-3609890890"},{"type":"issue_comment","id":3609933304,"prNumber":1149,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn72jatkh384nhkc44t68y8pwn7wnb6d?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn72jatkh384nhkc44t68y8pwn7wnb6d/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1149?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 5 screenshots for commit `6fbfa91` (2025-12-04 03:38:53.921 UTC).\n\n**Close-up view of the Dev script section showing the resizable textarea field with exposed ports configuration**\n\n![dev-script-section.png](https://adorable-wombat-701.convex.cloud/api/storage/fbbafbcd-696a-4f56-aed9-d682d019a7e3)\n\n**Full page view of the environment configuration showing all script textarea fields including Maintenance script and Dev script with the resize-y CSS class applied**\n\n![environment-configuration-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/9b5d704b-076f-470b-a861-7adbef362ba3)\n\n**Close-up view of the Maintenance script section showing the resizable textarea field**\n\n![maintenance-script-section.png](https://adorable-wombat-701.convex.cloud/api/storage/a36c9914-a4b5-4892-93cf-883fc8862037)\n\n**View showing one of the script textareas with the vertical resize functionality enabled by the resize-y CSS class**\n\n![textarea-with-resize-handle.png](https://adorable-wombat-701.convex.cloud/api/storage/26945a31-3c97-46e6-9ee8-7f70d4445aa6)\n\n**Top section of the configuration page showing environment name and variables sections above the script textareas**\n\n![top-of-configuration-page.png](https://adorable-wombat-701.convex.cloud/api/storage/4ed6709b-7076-4f83-b58f-0020c1bce421)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"6fbfa9128ccc740afc92fa9411ecb67d4e2b1868","createdAt":"2025-12-04T03:38:54Z","updatedAt":"2025-12-04T05:31:32Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1149#issuecomment-3609933304"},{"type":"issue_comment","id":3610308605,"prNumber":1149,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn70fbczys2mwzyk8gwpcvcmds7wn118?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn70fbczys2mwzyk8gwpcvcmds7wn118/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1149?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 4 screenshots for commit `6fbfa91` (2025-12-04 05:31:31.198 UTC).\n\n**Close-up view of the Dev Script textarea showing the resizable control at the bottom-right corner**\n\n![dev-script-textarea-resizable.png](https://famous-camel-162.convex.cloud/api/storage/d4df9385-4752-4056-a36f-9dec669919e3)\n\n**Full page view showing both Dev Script and Maintenance Script textareas in edit mode, both with vertical resize capability**\n\n![environment-config-both-scripts-edit-fullpage.png](https://famous-camel-162.convex.cloud/api/storage/1624bd69-b7ba-41da-8131-b8487064ae2a)\n\n**Full page view of the environment configuration page with the Dev Script textarea in edit mode, showing the resizable textarea**\n\n![environment-config-dev-script-edit-fullpage.png](https://famous-camel-162.convex.cloud/api/storage/e4e38e1c-002c-4b75-9d11-a8c835632a2b)\n\n**Close-up view of the Maintenance Script textarea showing the resizable control**\n\n![maintenance-script-textarea-resizable.png](https://famous-camel-162.convex.cloud/api/storage/78edce11-ac16-44d5-9315-01072535915f)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"6fbfa9128ccc740afc92fa9411ecb67d4e2b1868","createdAt":"2025-12-04T05:31:32Z","updatedAt":"2025-12-04T05:31:32Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1149#issuecomment-3610308605"}]}
{"number":1148,"title":"beads + abstract providers","state":"open","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1148","headRef":"beads-0","headSha":"b2c4f682e6b548b3dd3e8f286ec9c05674309b88","baseRef":"main","baseSha":"4104173a4d043e6ebeb286561981ba16eef5d917","createdAt":"2025-12-04T02:50:33Z","updatedAt":"2025-12-04T03:09:47Z","diff":"diff --git a/.beads/.gitignore b/.beads/.gitignore\nnew file mode 100644\nindex 000000000..f438450fc\n--- /dev/null\n+++ b/.beads/.gitignore\n@@ -0,0 +1,29 @@\n+# SQLite databases\n+*.db\n+*.db?*\n+*.db-journal\n+*.db-wal\n+*.db-shm\n+\n+# Daemon runtime files\n+daemon.lock\n+daemon.log\n+daemon.pid\n+bd.sock\n+\n+# Legacy database files\n+db.sqlite\n+bd.db\n+\n+# Merge artifacts (temporary files from 3-way merge)\n+beads.base.jsonl\n+beads.base.meta.json\n+beads.left.jsonl\n+beads.left.meta.json\n+beads.right.jsonl\n+beads.right.meta.json\n+\n+# Keep JSONL exports and config (source of truth for git)\n+!issues.jsonl\n+!metadata.json\n+!config.json\ndiff --git a/.beads/README.md b/.beads/README.md\nnew file mode 100644\nindex 000000000..50f281f03\n--- /dev/null\n+++ b/.beads/README.md\n@@ -0,0 +1,81 @@\n+# Beads - AI-Native Issue Tracking\n+\n+Welcome to Beads! This repository uses **Beads** for issue tracking - a modern, AI-native tool designed to live directly in your codebase alongside your code.\n+\n+## What is Beads?\n+\n+Beads is issue tracking that lives in your repo, making it perfect for AI coding agents and developers who want their issues close to their code. No web UI required - everything works through the CLI and integrates seamlessly with git.\n+\n+**Learn more:** [github.com/steveyegge/beads](https://github.com/steveyegge/beads)\n+\n+## Quick Start\n+\n+### Essential Commands\n+\n+```bash\n+# Create new issues\n+bd create \"Add user authentication\"\n+\n+# View all issues\n+bd list\n+\n+# View issue details\n+bd show <issue-id>\n+\n+# Update issue status\n+bd update <issue-id> --status in_progress\n+bd update <issue-id> --status done\n+\n+# Sync with git remote\n+bd sync\n+```\n+\n+### Working with Issues\n+\n+Issues in Beads are:\n+- **Git-native**: Stored in `.beads/issues.jsonl` and synced like code\n+- **AI-friendly**: CLI-first design works perfectly with AI coding agents\n+- **Branch-aware**: Issues can follow your branch workflow\n+- **Always in sync**: Auto-syncs with your commits\n+\n+## Why Beads?\n+\n+✨ **AI-Native Design**\n+- Built specifically for AI-assisted development workflows\n+- CLI-first interface works seamlessly with AI coding agents\n+- No context switching to web UIs\n+\n+🚀 **Developer Focused**\n+- Issues live in your repo, right next to your code\n+- Works offline, syncs when you push\n+- Fast, lightweight, and stays out of your way\n+\n+🔧 **Git Integration**\n+- Automatic sync with git commits\n+- Branch-aware issue tracking\n+- Intelligent JSONL merge resolution\n+\n+## Get Started with Beads\n+\n+Try Beads in your own projects:\n+\n+```bash\n+# Install Beads\n+curl -sSL https://raw.githubusercontent.com/steveyegge/beads/main/scripts/install.sh | bash\n+\n+# Initialize in your repo\n+bd init\n+\n+# Create your first issue\n+bd create \"Try out Beads\"\n+```\n+\n+## Learn More\n+\n+- **Documentation**: [github.com/steveyegge/beads/docs](https://github.com/steveyegge/beads/tree/main/docs)\n+- **Quick Start Guide**: Run `bd quickstart`\n+- **Examples**: [github.com/steveyegge/beads/examples](https://github.com/steveyegge/beads/tree/main/examples)\n+\n+---\n+\n+*Beads: Issue tracking that moves at the speed of thought* ⚡\ndiff --git a/.beads/config.yaml b/.beads/config.yaml\nnew file mode 100644\nindex 000000000..78174d4ed\n--- /dev/null\n+++ b/.beads/config.yaml\n@@ -0,0 +1,61 @@\n+# Beads Configuration File\n+# This file configures default behavior for all bd commands in this repository\n+# All settings can also be set via environment variables (BD_* prefix)\n+# or overridden with command-line flags\n+\n+# Issue prefix for this repository (used by bd init)\n+# If not set, bd init will auto-detect from directory name\n+# Example: issue-prefix: \"myproject\" creates issues like \"myproject-1\", \"myproject-2\", etc.\n+# issue-prefix: \"\"\n+\n+# Use no-db mode: load from JSONL, no SQLite, write back after each command\n+# When true, bd will use .beads/issues.jsonl as the source of truth\n+# instead of SQLite database\n+# no-db: false\n+\n+# Disable daemon for RPC communication (forces direct database access)\n+# no-daemon: false\n+\n+# Disable auto-flush of database to JSONL after mutations\n+# no-auto-flush: false\n+\n+# Disable auto-import from JSONL when it's newer than database\n+# no-auto-import: false\n+\n+# Enable JSON output by default\n+# json: false\n+\n+# Default actor for audit trails (overridden by BD_ACTOR or --actor)\n+# actor: \"\"\n+\n+# Path to database (overridden by BEADS_DB or --db)\n+# db: \"\"\n+\n+# Auto-start daemon if not running (can also use BEADS_AUTO_START_DAEMON)\n+# auto-start-daemon: true\n+\n+# Debounce interval for auto-flush (can also use BEADS_FLUSH_DEBOUNCE)\n+# flush-debounce: \"5s\"\n+\n+# Git branch for beads commits (bd sync will commit to this branch)\n+# IMPORTANT: Set this for team projects so all clones use the same sync branch.\n+# This setting persists across clones (unlike database config which is gitignored).\n+# Can also use BEADS_SYNC_BRANCH env var for local override.\n+# If not set, bd sync will require you to run 'bd config set sync.branch <branch>'.\n+sync-branch: \"beads-sync\"\n+# Multi-repo configuration (experimental - bd-307)\n+# Allows hydrating from multiple repositories and routing writes to the correct JSONL\n+# repos:\n+#   primary: \".\"  # Primary repo (where this database lives)\n+#   additional:   # Additional repos to hydrate from (read-only)\n+#     - ~/beads-planning  # Personal planning repo\n+#     - ~/work-planning   # Work planning repo\n+\n+# Integration settings (access with 'bd config get/set')\n+# These are stored in the database, not in this file:\n+# - jira.url\n+# - jira.project\n+# - linear.url\n+# - linear.api-key\n+# - github.org\n+# - github.repo\ndiff --git a/.beads/deletions.jsonl b/.beads/deletions.jsonl\nnew file mode 100644\nindex 000000000..8032321f3\n--- /dev/null\n+++ b/.beads/deletions.jsonl\n@@ -0,0 +1,16 @@\n+{\"id\":\"cmux15-ddx\",\"ts\":\"2025-12-03T07:55:10.304441Z\",\"by\":\"git-history-backfill\",\"reason\":\"recovered from git history (pruned from manifest)\"}\n+{\"id\":\"cmux15-abu\",\"ts\":\"2025-12-03T07:55:10.311761Z\",\"by\":\"git-history-backfill\",\"reason\":\"recovered from git history (pruned from manifest)\"}\n+{\"id\":\"cmux15-ppy\",\"ts\":\"2025-12-03T07:55:10.322555Z\",\"by\":\"git-history-backfill\",\"reason\":\"recovered from git history (pruned from manifest)\"}\n+{\"id\":\"cmux15-slv\",\"ts\":\"2025-12-03T07:55:10.329244Z\",\"by\":\"git-history-backfill\",\"reason\":\"recovered from git history (pruned from manifest)\"}\n+{\"id\":\"cmux15-gcu\",\"ts\":\"2025-12-03T07:55:10.334327Z\",\"by\":\"git-history-backfill\",\"reason\":\"recovered from git history (pruned from manifest)\"}\n+{\"id\":\"cmux15-5ex\",\"ts\":\"2025-12-03T07:55:10.339696Z\",\"by\":\"git-history-backfill\",\"reason\":\"recovered from git history (pruned from manifest)\"}\n+{\"id\":\"cmux15-l9s\",\"ts\":\"2025-12-03T07:55:10.344589Z\",\"by\":\"git-history-backfill\",\"reason\":\"recovered from git history (pruned from manifest)\"}\n+{\"id\":\"cmux15-81p\",\"ts\":\"2025-12-03T07:55:10.35003Z\",\"by\":\"git-history-backfill\",\"reason\":\"recovered from git history (pruned from manifest)\"}\n+{\"id\":\"cmux15-6ma\",\"ts\":\"2025-12-03T07:55:10.361301Z\",\"by\":\"git-history-backfill\",\"reason\":\"recovered from git history (pruned from manifest)\"}\n+{\"id\":\"cmux15-0me\",\"ts\":\"2025-12-03T07:55:10.367313Z\",\"by\":\"git-history-backfill\",\"reason\":\"recovered from git history (pruned from manifest)\"}\n+{\"id\":\"cmux15-czo\",\"ts\":\"2025-12-03T07:55:10.37327Z\",\"by\":\"git-history-backfill\",\"reason\":\"recovered from git history (pruned from manifest)\"}\n+{\"id\":\"cmux15-0bz\",\"ts\":\"2025-12-03T07:55:10.378325Z\",\"by\":\"git-history-backfill\",\"reason\":\"recovered from git history (pruned from manifest)\"}\n+{\"id\":\"cmux15-fq3\",\"ts\":\"2025-12-03T07:55:10.383622Z\",\"by\":\"git-history-backfill\",\"reason\":\"recovered from git history (pruned from manifest)\"}\n+{\"id\":\"cmux15-dvj\",\"ts\":\"2025-12-03T07:55:10.388847Z\",\"by\":\"git-history-backfill\",\"reason\":\"recovered from git history (pruned from manifest)\"}\n+{\"id\":\"cmux15-6jg\",\"ts\":\"2025-12-03T07:55:10.394865Z\",\"by\":\"git-history-backfill\",\"reason\":\"recovered from git history (pruned from manifest)\"}\n+{\"id\":\"cmux15-2vu\",\"ts\":\"2025-12-03T07:55:10.400986Z\",\"by\":\"git-history-backfill\",\"reason\":\"recovered from git history (pruned from manifest)\"}\ndiff --git a/.beads/issues.jsonl b/.beads/issues.jsonl\nnew file mode 100644\nindex 000000000..31f363034\n--- /dev/null\n+++ b/.beads/issues.jsonl\n@@ -0,0 +1,29 @@\n+{\"id\":\"cmux15-08d\",\"title\":\"Implement Bitbucket provider adapter\",\"description\":\"Implement Bitbucket support using the GitProvider abstraction.\\n\\n## Files to Create\\n- packages/shared/src/git-providers/bitbucket/index.ts\\n- packages/shared/src/git-providers/bitbucket/types.ts\\n\\n## Implementation\\n- Use Bitbucket Cloud REST API 2.0\\n- Implement GitProvider interface\\n- Map Bitbucket concepts to normalized types:\\n  - Pull Request → PullRequest (same name)\\n  - Repository → Repository\\n  - Comments → Comments\\n\\n## Bitbucket-Specific Considerations\\n- Bitbucket Apps (OAuth consumers)\\n- Workspace vs Repository permissions\\n- Bitbucket Pipelines integration\\n- Self-hosted Bitbucket Server/Data Center (different API)\\n\\n## API Client\\n- Custom fetch-based client\\n- OAuth 2.0 with refresh tokens\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T22:55:33.788951-08:00\",\"updated_at\":\"2025-12-02T22:55:33.788951-08:00\",\"dependencies\":[{\"issue_id\":\"cmux15-08d\",\"depends_on_id\":\"cmux15-t6p\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T22:55:40.195772-08:00\",\"created_by\":\"daemon\"}]}\n+{\"id\":\"cmux15-1yl\",\"title\":\"Update code review system for multi-provider support\",\"description\":\"Update AI code review system to work with GitLab and Bitbucket.\\n\\n## Current State\\n- apps/www/lib/services/code-review/ - Code review services\\n- apps/www/lib/routes/github.prs.code.route.ts - Code review endpoint\\n- Uses GitHub API to fetch PR diff and files\\n- Posts review comments to GitHub PRs\\n\\n## Components to Abstract\\n\\n### 1. Diff Fetching\\n- Get PR/MR diff content\\n- Get changed files list\\n- Already covered by cmux15-xha (file content retrieval)\\n\\n### 2. Review Comment Posting\\n```typescript\\ninterface CodeReviewProvider {\\n  // Create review with comments\\n  createReview(repo: string, prNumber: number, review: ReviewInput): Promise\\u003cReview\\u003e\\n  \\n  // Single comment on specific line\\n  createLineComment(repo: string, prNumber: number, comment: LineComment): Promise\\u003cComment\\u003e\\n  \\n  // Reply to existing comment\\n  replyToComment(repo: string, commentId: string, body: string): Promise\\u003cComment\\u003e\\n  \\n  // List existing reviews/comments\\n  listReviews(repo: string, prNumber: number): Promise\\u003cReview[]\\u003e\\n}\\n```\\n\\n## Provider Differences\\n| Feature | GitHub | GitLab | Bitbucket |\\n|---------|--------|--------|-----------|\\n| Reviews | Pull Request Reviews | MR Approvals | PR Approvals |\\n| Line comments | Review comments | Discussion notes | Inline comments |\\n| Suggestions | Suggestion blocks | Suggestion syntax | Not supported |\\n| Approval status | APPROVE/REQUEST_CHANGES | approve/unapprove | approve |\\n\\n## Files to Modify\\n- apps/www/lib/services/code-review/*.ts\\n- apps/www/lib/routes/github.prs.code.route.ts\\n\\n## Considerations\\n- Review UX may differ by provider\\n- Suggestion syntax varies\\n- Approval workflows differ\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T23:13:59.215428-08:00\",\"updated_at\":\"2025-12-02T23:13:59.215428-08:00\",\"dependencies\":[{\"issue_id\":\"cmux15-1yl\",\"depends_on_id\":\"cmux15-xha\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T23:14:05.551574-08:00\",\"created_by\":\"daemon\"},{\"issue_id\":\"cmux15-1yl\",\"depends_on_id\":\"cmux15-jiw\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T23:14:05.590776-08:00\",\"created_by\":\"daemon\"}]}\n+{\"id\":\"cmux15-282\",\"title\":\"Add integration tests for git providers\",\"description\":\"Create comprehensive tests for the git provider abstraction.\\n\\n## Test Categories\\n\\n### Unit Tests\\n- Provider interface implementation tests\\n- Webhook payload normalization tests\\n- Auth token generation tests\\n\\n### Integration Tests\\n- GitHub API mock tests\\n- GitLab API mock tests  \\n- Bitbucket API mock tests\\n\\n### E2E Tests\\n- OAuth flow tests (per provider)\\n- Webhook delivery tests\\n- PR operations tests\\n\\n## Test Files to Create\\n- packages/shared/src/git-providers/__tests__/github.test.ts\\n- packages/shared/src/git-providers/__tests__/gitlab.test.ts\\n- packages/shared/src/git-providers/__tests__/bitbucket.test.ts\\n- packages/shared/src/git-providers/__tests__/webhook-normalization.test.ts\\n- packages/convex/convex/__tests__/webhook.test.ts\\n\\n## Test Data\\n- Sample webhook payloads for each provider\\n- Mock API responses\\n- Test fixtures for normalized types\\n\\n## Considerations\\n- Use vitest per project conventions\\n- No mocking per project rules - use real API calls where possible\\n- Test files next to implementation files\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T22:58:03.044863-08:00\",\"updated_at\":\"2025-12-02T22:58:03.044863-08:00\",\"dependencies\":[{\"issue_id\":\"cmux15-282\",\"depends_on_id\":\"cmux15-lv3\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T22:58:08.475058-08:00\",\"created_by\":\"daemon\"}]}\n+{\"id\":\"cmux15-2i4\",\"title\":\"Add Bitbucket App setup and OAuth flow\",\"description\":\"Create Bitbucket OAuth Consumer and implement integration.\\n\\n## Bitbucket App Setup\\n1. Create OAuth consumer at bitbucket.org/[workspace]/workspace/settings/oauth-consumers\\n2. Configure permissions: repository, pullrequest, webhook\\n3. Set callback URL to /auth/callback/bitbucket\\n\\n## Implementation\\n\\n### OAuth Routes\\n- GET /auth/bitbucket/authorize - Redirect to Bitbucket OAuth\\n- GET /auth/callback/bitbucket - Handle OAuth callback\\n\\n### Stack Auth Integration\\n- Add Bitbucket as OAuth provider in Stack Auth config\\n- Store Bitbucket OAuth tokens with refresh token handling\\n\\n### Environment Variables\\n```\\nCMUX_BITBUCKET_APP_KEY=\\nCMUX_BITBUCKET_APP_SECRET=\\nBITBUCKET_WEBHOOK_SECRET=\\n```\\n\\n### Files to Create\\n- apps/www/lib/routes/bitbucket.oauth.route.ts\\n- apps/www/lib/routes/bitbucket.setup.route.ts\\n\\n### Considerations\\n- Workspace-level vs Repository-level access\\n- Bitbucket Cloud vs Bitbucket Server (Data Center)\\n- Token refresh flow (Bitbucket tokens expire)\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T22:57:30.907592-08:00\",\"updated_at\":\"2025-12-02T22:57:30.907592-08:00\",\"dependencies\":[{\"issue_id\":\"cmux15-2i4\",\"depends_on_id\":\"cmux15-08d\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T22:57:35.487238-08:00\",\"created_by\":\"daemon\"}]}\n+{\"id\":\"cmux15-3os\",\"title\":\"Document git provider abstraction\",\"description\":\"Create developer documentation for the git provider abstraction.\\n\\n## Documentation Needed\\n\\n### Architecture Overview\\n- Provider abstraction pattern explanation\\n- How to add a new provider\\n- Webhook handling flow\\n\\n### Setup Guides\\n- GitHub App setup (existing, update)\\n- GitLab App setup (new)\\n- Bitbucket OAuth setup (new)\\n\\n### API Reference\\n- GitProvider interface documentation\\n- Normalized types documentation\\n- Webhook event mapping table\\n\\n### Migration Guide\\n- How to migrate existing GitHub-only code\\n- Breaking changes list\\n- Deprecation timeline\\n\\n## Files to Create (if requested)\\n- docs/git-providers/architecture.md\\n- docs/git-providers/adding-providers.md\\n- docs/git-providers/webhook-events.md\\n\\n## Code Comments\\n- Add JSDoc to all interfaces\\n- Document provider-specific quirks\\n- Note any missing features per provider\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T22:58:17.343312-08:00\",\"updated_at\":\"2025-12-02T22:58:17.343312-08:00\",\"dependencies\":[{\"issue_id\":\"cmux15-3os\",\"depends_on_id\":\"cmux15-282\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T22:58:22.383628-08:00\",\"created_by\":\"daemon\"}]}\n+{\"id\":\"cmux15-4o8\",\"title\":\"Update crown worker for multi-provider PR creation\",\"description\":\"Update crown worker to create PRs on GitLab and Bitbucket, not just GitHub.\\n\\n## Current State\\napps/worker/src/crown/pullRequest.ts:\\n- Uses `gh pr create` CLI command\\n- Only handles GitHub PRs\\n\\napps/worker/src/crown/workflow.ts:\\n- Hardcodes `https://github.com/${info.task.projectFullName}.git`\\n\\n## gh CLI Commands Used\\n```bash\\ngh pr create --base \\\"$PR_BASE\\\" --head \\\"$PR_HEAD\\\" --title \\\"$PR_TITLE\\\" --body-file \\\"$BODY_FILE\\\" --json url,number,state,isDraft\\n```\\n\\n## Provider CLI Equivalents\\n| Action | GitHub | GitLab | Bitbucket |\\n|--------|--------|--------|-----------|\\n| Create PR/MR | gh pr create | glab mr create | API only |\\n| Get PR URL | --json url | --json web_url | API response |\\n\\n## Implementation Options\\n\\n### Option A: CLI per provider\\n```typescript\\nfunction createPrWithCli(provider: Provider, params: CreatePRParams) {\\n  switch(provider) {\\n    case 'github': return execGhPrCreate(params)\\n    case 'gitlab': return execGlabMrCreate(params)\\n    case 'bitbucket': return createBitbucketPrViaApi(params)\\n  }\\n}\\n```\\n\\n### Option B: Use API abstraction (preferred)\\n- Use the provider abstraction layer from cmux15-7f4\\n- More consistent behavior across providers\\n- No CLI dependency\\n\\n## Files to Modify\\n- apps/worker/src/crown/pullRequest.ts\\n- apps/worker/src/crown/workflow.ts\\n\\n## Dependencies\\n- Requires cmux15-7f4 (PR operations abstraction)\\n- Requires cmux15-c6k (URL parsing)\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T23:31:35.715814-08:00\",\"updated_at\":\"2025-12-02T23:31:35.715814-08:00\",\"dependencies\":[{\"issue_id\":\"cmux15-4o8\",\"depends_on_id\":\"cmux15-7f4\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T23:31:40.649353-08:00\",\"created_by\":\"daemon\"},{\"issue_id\":\"cmux15-4o8\",\"depends_on_id\":\"cmux15-c6k\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T23:31:40.69077-08:00\",\"created_by\":\"daemon\"}]}\n+{\"id\":\"cmux15-7dc\",\"title\":\"Update preview system for multi-provider support\",\"description\":\"Update the preview.new system to work with GitLab and Bitbucket.\\n\\n## Current State\\n- preview.new domain serves screenshot preview functionality\\n- packages/convex/convex/previewConfigs.ts - Stores repoProvider, repoInstallationId\\n- packages/convex/convex/previewRuns.ts - Tracks PR previews\\n- Triggered by GitHub webhook on PR events\\n- Posts screenshots as PR comments\\n\\n## Already Provider-Aware\\n- previewConfigs table has `repoProvider` field (defaults to 'github')\\n- Can store different installationIds per provider\\n\\n## Updates Needed\\n1. **Webhook Integration**\\n   - Trigger preview runs from GitLab MR webhooks\\n   - Trigger preview runs from Bitbucket PR webhooks\\n\\n2. **Screenshot Posting**\\n   - Post to GitLab MR notes\\n   - Post to Bitbucket PR comments\\n\\n3. **PR Info Extraction**\\n   - Extract PR number, base/head SHA from each provider's format\\n\\n## Files to Modify\\n- packages/convex/convex/previewConfigs.ts - Already has provider field\\n- packages/convex/convex/previewRuns.ts - Update PR info extraction\\n- packages/convex/convex/preview_jobs_worker.ts - Use provider abstraction\\n\\n## Considerations\\n- Diff heatmap (0github.com) is GitHub-only feature\\n- May need provider-specific diff viewer alternatives\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T23:12:56.436861-08:00\",\"updated_at\":\"2025-12-02T23:12:56.436861-08:00\",\"dependencies\":[{\"issue_id\":\"cmux15-7dc\",\"depends_on_id\":\"cmux15-cyr\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T23:13:03.697951-08:00\",\"created_by\":\"daemon\"},{\"issue_id\":\"cmux15-7dc\",\"depends_on_id\":\"cmux15-jiw\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T23:13:03.792308-08:00\",\"created_by\":\"daemon\"}]}\n+{\"id\":\"cmux15-7f4\",\"title\":\"Abstract PR operations (create/merge/close) for git providers\",\"description\":\"Abstract PR lifecycle operations across providers.\\n\\n## Current State\\n- apps/www/lib/routes/github.prs.open.route.ts - Create, merge, close PRs\\n- apps/worker/src/crown/pullRequest.ts - Crown winner auto-PR (uses gh CLI)\\n- Uses Octokit for GitHub API calls\\n- GraphQL for marking PR ready for review\\n\\n## Operations to Abstract\\n```typescript\\ninterface PROperationsProvider {\\n  // Create\\n  createPullRequest(params: CreatePRParams): Promise\\u003cPullRequest\\u003e\\n  \\n  // Update state\\n  markReadyForReview(repo: string, number: number): Promise\\u003cvoid\\u003e\\n  closePullRequest(repo: string, number: number): Promise\\u003cvoid\\u003e\\n  reopenPullRequest(repo: string, number: number): Promise\\u003cvoid\\u003e\\n  \\n  // Merge\\n  mergePullRequest(repo: string, number: number, method: MergeMethod): Promise\\u003cvoid\\u003e\\n  \\n  // Query\\n  getPullRequest(repo: string, number: number): Promise\\u003cPullRequest\\u003e\\n  getPullRequestByBranch(repo: string, branch: string): Promise\\u003cPullRequest | null\\u003e\\n  listPullRequests(repo: string, options?: ListOptions): Promise\\u003cPullRequest[]\\u003e\\n}\\n\\ntype MergeMethod = 'merge' | 'squash' | 'rebase'\\n```\\n\\n## Provider Differences\\n| Feature | GitHub | GitLab | Bitbucket |\\n|---------|--------|--------|-----------|\\n| Draft PRs | Supported | Supported (WIP MRs) | Not supported |\\n| Merge methods | merge/squash/rebase | merge/squash/rebase | merge/squash |\\n| Ready for review | GraphQL mutation | Remove WIP prefix | N/A |\\n| Auto-merge | Supported | Supported | Limited |\\n\\n## Files to Modify\\n- apps/www/lib/routes/github.prs.open.route.ts → abstract\\n- apps/worker/src/crown/pullRequest.ts → use provider abstraction instead of gh CLI\\n\\n## Considerations\\n- Crown worker currently uses gh CLI - need to abstract or ensure CLI exists for other providers\\n- GraphQL vs REST for certain operations\\n- Draft PR support varies\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T23:12:38.436281-08:00\",\"updated_at\":\"2025-12-02T23:12:38.436281-08:00\",\"dependencies\":[{\"issue_id\":\"cmux15-7f4\",\"depends_on_id\":\"cmux15-lv3\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T23:12:43.927552-08:00\",\"created_by\":\"daemon\"}]}\n+{\"id\":\"cmux15-80t\",\"title\":\"Design git provider abstraction architecture\",\"description\":\"Define the core interfaces and architecture for abstracting git providers (GitHub, GitLab, Bitbucket).\\n\\n## Key Decisions\\n- Interface design patterns (strategy pattern, factory pattern)\\n- Provider configuration structure\\n- How to handle provider-specific features that don't exist in all providers\\n- Webhook payload normalization strategy\\n- Token/auth abstraction approach\\n\\n## Deliverables\\n- Architecture document or code comments\\n- Core TypeScript interfaces\\n- Provider factory/registry pattern\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"feature\",\"created_at\":\"2025-12-02T22:54:46.891551-08:00\",\"updated_at\":\"2025-12-03T00:50:33.780145-08:00\",\"closed_at\":\"2025-12-03T00:50:33.780145-08:00\"}\n+{\"id\":\"cmux15-8b1\",\"title\":\"Abstract server-side API client (ghApi) for git providers\",\"description\":\"Abstract the direct GitHub API client to support multiple providers.\\n\\n## Current State\\napps/server/src/ghApi.ts - Direct GitHub API wrapper:\\n- Hardcodes `https://api.github.com`\\n- Uses GitHub-specific Accept header\\n- Methods: getUser, getUserRepos, getUserOrgs, getOrgRepos, getRepoBranches\\n\\n## Provider API Endpoints\\n| Provider | Base URL | Auth Header |\\n|----------|----------|-------------|\\n| GitHub | api.github.com | Bearer token |\\n| GitLab | gitlab.com/api/v4 | PRIVATE-TOKEN or Bearer |\\n| Bitbucket | api.bitbucket.org/2.0 | Bearer token |\\n\\n## API Mapping\\n| Feature | GitHub | GitLab | Bitbucket |\\n|---------|--------|--------|-----------|\\n| Current user | /user | /user | /user |\\n| User repos | /user/repos | /projects?membership=true | /repositories |\\n| User orgs | /user/orgs | /groups | /workspaces |\\n| Org repos | /orgs/:org/repos | /groups/:id/projects | /repositories/:workspace |\\n| Branches | /repos/:repo/branches | /projects/:id/repository/branches | /repositories/:repo/refs/branches |\\n\\n## Implementation\\n```typescript\\n// apps/server/src/providerApi.ts\\ninterface ProviderApiClient {\\n  getUser(): Promise\\u003c{ login: string }\\u003e\\n  getUserRepos(): Promise\\u003cstring[]\\u003e\\n  getUserOrgs(): Promise\\u003cstring[]\\u003e\\n  getOrgRepos(org: string): Promise\\u003cstring[]\\u003e\\n  getRepoBranches(repo: string): Promise\\u003cstring[]\\u003e\\n  getRepoBranchesWithActivity(repo: string): Promise\\u003cBranchWithActivity[]\\u003e\\n}\\n\\nfunction createProviderApiClient(provider: Provider, token: string): ProviderApiClient\\n```\\n\\n## Files to Modify\\n- apps/server/src/ghApi.ts → rename to providerApi.ts\\n- All files importing ghApi\\n\\n## Considerations\\n- Different pagination styles (GitHub: Link header, GitLab: X-Page headers, Bitbucket: next URL)\\n- Different rate limit handling\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T23:31:59.018826-08:00\",\"updated_at\":\"2025-12-02T23:31:59.018826-08:00\",\"dependencies\":[{\"issue_id\":\"cmux15-8b1\",\"depends_on_id\":\"cmux15-fy2\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T23:32:05.751212-08:00\",\"created_by\":\"daemon\"},{\"issue_id\":\"cmux15-8b1\",\"depends_on_id\":\"cmux15-t6p\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T23:32:05.79401-08:00\",\"created_by\":\"daemon\"}]}\n+{\"id\":\"cmux15-ab7\",\"title\":\"Implement GitLab provider adapter\",\"description\":\"Implement GitLab support using the GitProvider abstraction.\\n\\n## Files to Create\\n- packages/shared/src/git-providers/gitlab/index.ts\\n- packages/shared/src/git-providers/gitlab/types.ts\\n\\n## Implementation\\n- Use GitLab REST API v4 or GraphQL API\\n- Implement GitProvider interface\\n- Map GitLab concepts to normalized types:\\n  - Merge Request → PullRequest\\n  - Project → Repository\\n  - Notes → Comments\\n\\n## GitLab-Specific Considerations\\n- GitLab Apps vs OAuth Apps vs Personal Access Tokens\\n- Project access tokens\\n- Group-level access\\n- Self-hosted GitLab support (custom base URL)\\n- MR approval rules (GitLab-specific feature)\\n\\n## Dependencies\\n- @gitbeaker/rest or custom fetch-based client\\n- GitLab webhook types\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T22:55:25.425309-08:00\",\"updated_at\":\"2025-12-02T22:55:25.425309-08:00\",\"dependencies\":[{\"issue_id\":\"cmux15-ab7\",\"depends_on_id\":\"cmux15-t6p\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T22:55:40.153419-08:00\",\"created_by\":\"daemon\"}]}\n+{\"id\":\"cmux15-b2c\",\"title\":\"Update UI for multi-provider support\",\"description\":\"Update frontend components to support multiple git providers.\\n\\n## Components to Update\\n\\n### Provider Selection\\n- Add provider selector in integration setup flow\\n- Show provider icons (GitHub, GitLab, Bitbucket)\\n- Update repository selection to show provider context\\n\\n### Repository Display\\n- Show provider badge/icon next to repo names\\n- Update repo URL formatting for different providers\\n\\n### PR/MR Display\\n- Normalize 'Pull Request' vs 'Merge Request' terminology\\n- Show provider-appropriate icons and links\\n\\n### Settings Pages\\n- Add GitLab connection UI\\n- Add Bitbucket connection UI\\n- Show connected providers list\\n\\n## Files to Modify\\n- apps/client/src/components/integrations/* \\n- apps/client/src/components/repo-selector/*\\n- apps/client/src/routes/settings/*\\n\\n## New Components\\n- ProviderIcon - Display provider logo\\n- ProviderBadge - Small badge showing provider\\n- ProviderSelector - Dropdown/tabs for provider selection\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T22:57:45.888327-08:00\",\"updated_at\":\"2025-12-02T22:57:45.888327-08:00\",\"dependencies\":[{\"issue_id\":\"cmux15-b2c\",\"depends_on_id\":\"cmux15-d8u\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T22:57:52.621031-08:00\",\"created_by\":\"daemon\"},{\"issue_id\":\"cmux15-b2c\",\"depends_on_id\":\"cmux15-d3i\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T22:57:52.66606-08:00\",\"created_by\":\"daemon\"},{\"issue_id\":\"cmux15-b2c\",\"depends_on_id\":\"cmux15-2i4\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T22:57:52.718468-08:00\",\"created_by\":\"daemon\"}]}\n+{\"id\":\"cmux15-c6k\",\"title\":\"Abstract repo URL parsing for git providers\",\"description\":\"Replace GitHub-specific URL parsing with multi-provider support.\\n\\n## Current State\\n- packages/shared/src/utils/parse-github-repo-url.ts - Only parses GitHub URLs\\n- Hardcoded patterns: `github.com`, `git@github.com:`\\n\\n## Provider URL Formats\\n| Provider | HTTPS | SSH |\\n|----------|-------|-----|\\n| GitHub | https://github.com/owner/repo | git@github.com:owner/repo.git |\\n| GitLab | https://gitlab.com/owner/repo | git@gitlab.com:owner/repo.git |\\n| Bitbucket | https://bitbucket.org/owner/repo | git@bitbucket.org:owner/repo.git |\\n\\n## Implementation\\n```typescript\\n// packages/shared/src/utils/parse-repo-url.ts\\ntype Provider = 'github' | 'gitlab' | 'bitbucket' | 'unknown'\\n\\ninterface ParsedRepoUrl {\\n  provider: Provider\\n  owner: string\\n  repo: string\\n  fullName: string\\n  url: string\\n  gitUrl: string\\n}\\n\\nfunction parseRepoUrl(input: string): ParsedRepoUrl | null\\nfunction detectProvider(url: string): Provider\\nfunction buildRepoUrl(provider: Provider, owner: string, repo: string): string\\n```\\n\\n## Files to Modify\\n- packages/shared/src/utils/parse-github-repo-url.ts → rename to parse-repo-url.ts\\n- All files importing parseGithubRepoUrl\\n\\n## Usages to Update\\n- apps/worker/src/screenshotCollector/claudeScreenshotCollectorCli.ts\\n- packages/convex/convex/*.ts (multiple files)\\n- apps/server/src/socket-handlers.ts\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T23:29:52.743824-08:00\",\"updated_at\":\"2025-12-03T00:54:28.41948-08:00\",\"closed_at\":\"2025-12-03T00:54:28.41948-08:00\",\"dependencies\":[{\"issue_id\":\"cmux15-c6k\",\"depends_on_id\":\"cmux15-80t\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T23:29:58.603415-08:00\",\"created_by\":\"daemon\"}]}\n+{\"id\":\"cmux15-cyr\",\"title\":\"Abstract webhook handling for git providers\",\"description\":\"Create unified webhook handling that normalizes events across providers.\\n\\n## Current State\\n- GitHub webhook handler in packages/convex/convex/github_webhook.ts\\n- Handles: installation, pull_request, push, workflow_run, check_run, deployment, status, ping\\n\\n## Webhook Event Mapping\\n\\n| Normalized Event | GitHub | GitLab | Bitbucket |\\n|-----------------|--------|--------|-----------|\\n| pr.opened | pull_request.opened | merge_request.open | pullrequest:created |\\n| pr.closed | pull_request.closed | merge_request.close | pullrequest:rejected/declined |\\n| pr.merged | pull_request.closed+merged | merge_request.merge | pullrequest:fulfilled |\\n| pr.updated | pull_request.synchronize | merge_request.update | pullrequest:updated |\\n| push | push | push | repo:push |\\n| comment | issue_comment | note | pullrequest:comment_* |\\n\\n## Implementation\\n\\n### Webhook Router\\n```typescript\\n// packages/convex/convex/webhook.ts (new unified handler)\\nasync function handleWebhook(provider: string, headers: Headers, body: string) {\\n  const providerAdapter = getProviderWebhookAdapter(provider)\\n  const verified = await providerAdapter.verifySignature(headers, body)\\n  const normalizedEvent = providerAdapter.normalizeEvent(JSON.parse(body))\\n  // Route to appropriate handler\\n}\\n```\\n\\n### Files to Create\\n- packages/convex/convex/webhook.ts - Unified entry point\\n- packages/convex/convex/webhook_adapters/github.ts\\n- packages/convex/convex/webhook_adapters/gitlab.ts\\n- packages/convex/convex/webhook_adapters/bitbucket.ts\\n\\n### Files to Modify\\n- packages/convex/convex/github_webhook.ts → Extract to adapter pattern\\n- packages/convex/convex/http.ts → Add routes for /webhook/gitlab, /webhook/bitbucket\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T22:56:08.600244-08:00\",\"updated_at\":\"2025-12-02T22:56:08.600244-08:00\",\"dependencies\":[{\"issue_id\":\"cmux15-cyr\",\"depends_on_id\":\"cmux15-t6p\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T22:56:13.808374-08:00\",\"created_by\":\"daemon\"},{\"issue_id\":\"cmux15-cyr\",\"depends_on_id\":\"cmux15-u5n\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T22:56:13.861146-08:00\",\"created_by\":\"daemon\"}]}\n+{\"id\":\"cmux15-d3i\",\"title\":\"Add GitLab App setup and OAuth flow\",\"description\":\"Create GitLab App and implement OAuth integration.\\n\\n## GitLab App Setup\\n1. Create GitLab Application at gitlab.com/oauth/applications\\n2. Configure scopes: api, read_user, read_repository\\n3. Set callback URL to /auth/callback/gitlab\\n\\n## Implementation\\n\\n### OAuth Routes\\n- GET /auth/gitlab/authorize - Redirect to GitLab OAuth\\n- GET /auth/callback/gitlab - Handle OAuth callback\\n\\n### Stack Auth Integration\\n- Add GitLab as OAuth provider in Stack Auth config\\n- Store GitLab OAuth tokens\\n\\n### Environment Variables\\n```\\nCMUX_GITLAB_APP_ID=\\nCMUX_GITLAB_APP_SECRET=\\nGITLAB_WEBHOOK_SECRET=\\n```\\n\\n### Files to Create\\n- apps/www/lib/routes/gitlab.oauth.route.ts\\n- apps/www/lib/routes/gitlab.setup.route.ts\\n\\n### Considerations\\n- GitLab Groups vs Projects access\\n- Self-hosted GitLab support (custom baseUrl)\\n- GitLab Premium/Ultimate features\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T22:57:15.971669-08:00\",\"updated_at\":\"2025-12-02T22:57:15.971669-08:00\",\"dependencies\":[{\"issue_id\":\"cmux15-d3i\",\"depends_on_id\":\"cmux15-ab7\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T22:57:21.401026-08:00\",\"created_by\":\"daemon\"}]}\n+{\"id\":\"cmux15-d8u\",\"title\":\"Abstract Hono API routes for git providers\",\"description\":\"Refactor API routes to support multiple providers through abstraction.\\n\\n## Current GitHub-Specific Routes\\nAll in apps/www/lib/routes/github.*.route.ts:\\n- github.oauth-token.route.ts\\n- github.prs.route.ts (list, open, patch, files, file-contents, etc.)\\n- github.repos.route.ts\\n- github.install-state.route.ts\\n\\n## Abstraction Strategy\\n\\n### Option A: Provider Parameter in Existing Routes\\n```typescript\\n// /integrations/:provider/prs\\n// /integrations/:provider/repos\\n// Provider extracted from path parameter\\n```\\n\\n### Option B: Unified Routes with Query Param\\n```typescript\\n// /integrations/prs?provider=github\\n// /integrations/repos?provider=gitlab\\n```\\n\\n### Recommended: Option A with Shared Logic\\n```typescript\\n// apps/www/lib/routes/integrations/\\n//   prs.route.ts        (handles all providers)\\n//   repos.route.ts\\n//   oauth.route.ts\\n//   webhooks.route.ts\\n\\n// Route handler\\napp.get('/integrations/:provider/prs', async (c) =\\u003e {\\n  const provider = c.req.param('provider')\\n  const gitProvider = getGitProvider(provider)\\n  return gitProvider.listPullRequests(...)\\n})\\n```\\n\\n## Files to Create\\n- apps/www/lib/routes/integrations/prs.route.ts\\n- apps/www/lib/routes/integrations/repos.route.ts\\n- apps/www/lib/routes/integrations/oauth.route.ts\\n\\n## Files to Deprecate/Migrate\\n- apps/www/lib/routes/github.*.route.ts → redirect to new routes\\n\\n## Backward Compatibility\\n- Keep old /integrations/github/* routes working\\n- Add deprecation warnings in logs\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T22:56:42.93431-08:00\",\"updated_at\":\"2025-12-02T22:56:42.93431-08:00\",\"dependencies\":[{\"issue_id\":\"cmux15-d8u\",\"depends_on_id\":\"cmux15-saz\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T22:56:47.893684-08:00\",\"created_by\":\"daemon\"},{\"issue_id\":\"cmux15-d8u\",\"depends_on_id\":\"cmux15-u5n\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T22:56:47.945075-08:00\",\"created_by\":\"daemon\"}]}\n+{\"id\":\"cmux15-dcg\",\"title\":\"Update server socket handlers for multi-provider URLs\",\"description\":\"Update socket handlers that hardcode GitHub URLs to use provider abstraction.\\n\\n## Current State\\napps/server/src/socket-handlers.ts has multiple hardcoded GitHub URLs:\\n- Line 824: `https://github.com/${projectFullName}.git`\\n- Line 1980: `targetRepoUrl: https://github.com/${repoFullName}.git`\\n- Line 2170: `repoUrl: https://github.com/manaflow-ai/cmux.git`\\n\\nOther files:\\n- apps/server/src/utils/refreshGitHubData.ts: `https://github.com/${repo}.git`\\n- apps/server/src/utils/ensureRunWorktree.ts: `https://github.com/${task.projectFullName}.git`\\n- apps/server/native/core/src/repo/cache.rs: `https://github.com/{}.git`\\n\\n## Implementation\\n- Import URL builder from provider abstraction\\n- Get provider from task/environment context\\n- Build correct clone URL based on provider\\n\\n```typescript\\n// Before\\nconst repoUrl = `https://github.com/${fullName}.git`\\n\\n// After\\nconst repoUrl = buildCloneUrl(provider, fullName)\\n// or\\nconst repoUrl = getProviderHelper(provider).buildCloneUrl(fullName)\\n```\\n\\n## Files to Modify\\n- apps/server/src/socket-handlers.ts\\n- apps/server/src/utils/refreshGitHubData.ts\\n- apps/server/src/utils/ensureRunWorktree.ts\\n- apps/server/native/core/src/repo/cache.rs (Rust)\\n\\n## Considerations\\n- Provider should come from task.provider or environment.provider\\n- Need to handle cases where provider is not set (default to GitHub for backward compat)\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T23:31:17.074131-08:00\",\"updated_at\":\"2025-12-02T23:31:17.074131-08:00\",\"dependencies\":[{\"issue_id\":\"cmux15-dcg\",\"depends_on_id\":\"cmux15-c6k\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T23:31:22.679867-08:00\",\"created_by\":\"daemon\"},{\"issue_id\":\"cmux15-dcg\",\"depends_on_id\":\"cmux15-idf\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T23:31:22.73036-08:00\",\"created_by\":\"daemon\"}]}\n+{\"id\":\"cmux15-fy2\",\"title\":\"Abstract token retrieval for git providers\",\"description\":\"Abstract OAuth token retrieval to support multiple providers.\\n\\n## Current State\\nFiles with GitHub-specific token retrieval:\\n- apps/server/src/utils/getGitHubToken.ts - Gets GitHub OAuth token from Stack Auth or gh CLI\\n- apps/www/lib/routes/github.oauth-token.route.ts - Returns GitHub OAuth token\\n\\n## Token Sources\\n| Source | GitHub | GitLab | Bitbucket |\\n|--------|--------|--------|-----------|\\n| Stack Auth | getConnectedAccount('github') | getConnectedAccount('gitlab') | getConnectedAccount('bitbucket') |\\n| CLI | gh auth token | glab auth token | N/A (no official CLI) |\\n| Env var | GITHUB_TOKEN | GITLAB_TOKEN | BITBUCKET_TOKEN |\\n\\n## Implementation\\n```typescript\\n// apps/server/src/utils/getProviderToken.ts\\ntype Provider = 'github' | 'gitlab' | 'bitbucket'\\n\\nasync function getProviderToken(provider: Provider): Promise\\u003cstring | null\\u003e\\nasync function getProviderTokenFromStackAuth(provider: Provider): Promise\\u003cstring | null\\u003e\\nasync function getProviderTokenFromCli(provider: Provider): Promise\\u003cstring | null\\u003e\\n```\\n\\n## Files to Modify\\n- apps/server/src/utils/getGitHubToken.ts → rename to getProviderToken.ts\\n- apps/www/lib/routes/github.oauth-token.route.ts → abstract to provider route\\n\\n## CLI Considerations\\n- GitHub: `gh auth token` (widely available)\\n- GitLab: `glab auth token` (less common)\\n- Bitbucket: No official CLI, may need to skip or use env var\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T23:30:11.071188-08:00\",\"updated_at\":\"2025-12-02T23:30:11.071188-08:00\",\"dependencies\":[{\"issue_id\":\"cmux15-fy2\",\"depends_on_id\":\"cmux15-u5n\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T23:30:18.569684-08:00\",\"created_by\":\"daemon\"}]}\n+{\"id\":\"cmux15-idf\",\"title\":\"Abstract git credentials setup in containers/sandboxes\",\"description\":\"Abstract git credential setup to support multiple providers in Docker containers and sandboxes.\\n\\n## Current State (GitHub-only)\\nFiles with hardcoded github.com credentials:\\n- apps/server/src/utils/dockerGitSetup.ts - Writes `https://oauth:${token}@github.com`\\n- apps/server/src/vscode/DockerVSCodeInstance.ts - Uses `gh auth login`\\n- apps/worker/src/index.ts - Writes github.com git credentials\\n- packages/convex/convex/preview_jobs_worker.ts - Uses `gh auth login`\\n- packages/sandbox/src/*.rs - Caches `gh auth status`\\n\\n## Provider CLI Tools\\n| Provider | CLI | Auth Command |\\n|----------|-----|--------------|\\n| GitHub | gh | gh auth login --with-token |\\n| GitLab | glab | glab auth login --token |\\n| Bitbucket | N/A | git config credential.helper |\\n\\n## Git Credentials Format\\n```\\n# Multi-provider git-credentials file\\nhttps://oauth:${githubToken}@github.com\\nhttps://oauth:${gitlabToken}@gitlab.com\\nhttps://x-token-auth:${bitbucketToken}@bitbucket.org\\n```\\n\\n## Implementation\\n```typescript\\ninterface GitCredential {\\n  provider: Provider\\n  host: string\\n  username: string\\n  token: string\\n}\\n\\nfunction buildGitCredentialsFile(credentials: GitCredential[]): string\\nfunction setupProviderCliAuth(provider: Provider, token: string): Promise\\u003cvoid\\u003e\\n```\\n\\n## Files to Modify\\n- apps/server/src/utils/dockerGitSetup.ts\\n- apps/server/src/vscode/DockerVSCodeInstance.ts\\n- apps/worker/src/index.ts\\n- packages/convex/convex/preview_jobs_worker.ts\\n\\n## Sandbox (Rust) Changes\\n- packages/sandbox/src/service.rs - Cache per-provider auth status\\n- packages/sandbox/src/bin/server.rs - Handle provider-specific CLI checks\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T23:30:37.399675-08:00\",\"updated_at\":\"2025-12-02T23:30:37.399675-08:00\",\"dependencies\":[{\"issue_id\":\"cmux15-idf\",\"depends_on_id\":\"cmux15-fy2\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T23:30:43.891927-08:00\",\"created_by\":\"daemon\"},{\"issue_id\":\"cmux15-idf\",\"depends_on_id\":\"cmux15-c6k\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T23:30:43.932851-08:00\",\"created_by\":\"daemon\"}]}\n+{\"id\":\"cmux15-jiw\",\"title\":\"Abstract PR comments posting for git providers\",\"description\":\"Abstract the PR comment posting functionality used by preview screenshots.\\n\\n## Current State\\n- packages/convex/convex/github_pr_comments.ts - Posts screenshot previews as PR comments\\n- Uses Octokit directly for GitHub API\\n- Creates/updates/collapses comments on PRs\\n- Includes 0github.com diff heatmap links (GitHub-specific)\\n\\n## Provider Differences\\n| Feature | GitHub | GitLab | Bitbucket |\\n|---------|--------|--------|-----------|\\n| PR Comments | Issue comments API | MR Notes API | PR Comments API |\\n| Reactions | Reactions API | Award Emoji API | Not supported |\\n| Collapse old | HTML details tag | Same | Same |\\n| Diff view URL | 0github.com (custom) | GitLab native diff | Bitbucket native diff |\\n\\n## Implementation\\n```typescript\\ninterface PRCommentsProvider {\\n  createComment(repo: string, prNumber: number, body: string): Promise\\u003cCommentResult\\u003e\\n  updateComment(repo: string, commentId: number, body: string): Promise\\u003cCommentResult\\u003e\\n  listComments(repo: string, prNumber: number): Promise\\u003cComment[]\\u003e\\n  addReaction?(repo: string, prNumber: number, reaction: string): Promise\\u003cvoid\\u003e\\n}\\n```\\n\\n## Files to Modify\\n- packages/convex/convex/github_pr_comments.ts → abstract\\n\\n## Considerations\\n- 0github.com is GitHub-specific (diff heatmap viewer)\\n- Need provider-specific diff URLs or skip for non-GitHub\\n- Reaction support varies by provider\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T23:12:18.085123-08:00\",\"updated_at\":\"2025-12-02T23:12:18.085123-08:00\",\"dependencies\":[{\"issue_id\":\"cmux15-jiw\",\"depends_on_id\":\"cmux15-lv3\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T23:12:24.11438-08:00\",\"created_by\":\"daemon\"}]}\n+{\"id\":\"cmux15-k3z\",\"title\":\"Abstract screenshot collector CLI for git providers\",\"description\":\"Update screenshot collector to work with GitLab MRs and Bitbucket PRs.\\n\\n## Current State\\n- apps/worker/src/screenshotCollector/claudeScreenshotCollectorCli.ts\\n- Uses `gh pr view` to get PR info\\n- Parses only github.com URLs\\n- Clones from github.com\\n\\n## gh CLI Commands Used\\n```bash\\ngh pr view ${prNumber} --repo ${owner}/${repo} --json baseRefName,headRefName,title,body\\ngh pr view ${prNumber} --repo ${owner}/${repo} --json files --jq '.files[].path'\\ngh pr view ${prNumber} --repo ${owner}/${repo} --json headRefName --jq '.headRefName'\\n```\\n\\n## Provider CLI Equivalents\\n| Action | GitHub | GitLab | Bitbucket |\\n|--------|--------|--------|-----------|\\n| View MR/PR | gh pr view | glab mr view | API call |\\n| Get files | gh pr view --json files | glab mr view --json | API call |\\n| Get branch | gh pr view --json headRefName | glab mr view -F json | API call |\\n\\n## Implementation Options\\n\\n### Option A: Abstract CLI wrapper\\n```typescript\\ninterface ProviderCli {\\n  getPRInfo(repo: string, number: number): Promise\\u003cPRInfo\\u003e\\n  getPRFiles(repo: string, number: number): Promise\\u003cstring[]\\u003e\\n  getPRBranch(repo: string, number: number): Promise\\u003cstring\\u003e\\n}\\n```\\n\\n### Option B: Use API instead of CLI\\n- More reliable and consistent across providers\\n- Already have provider abstraction layer\\n\\n## Files to Modify\\n- apps/worker/src/screenshotCollector/claudeScreenshotCollectorCli.ts\\n- Should use provider abstraction instead of raw CLI calls\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T23:30:56.793333-08:00\",\"updated_at\":\"2025-12-02T23:30:56.793333-08:00\",\"dependencies\":[{\"issue_id\":\"cmux15-k3z\",\"depends_on_id\":\"cmux15-7dc\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T23:31:02.381494-08:00\",\"created_by\":\"daemon\"},{\"issue_id\":\"cmux15-k3z\",\"depends_on_id\":\"cmux15-c6k\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T23:31:02.422859-08:00\",\"created_by\":\"daemon\"}]}\n+{\"id\":\"cmux15-lbq\",\"title\":\"Add Daytona provider support\",\"description\":\"Add Daytona as second VM provider. Thin wrapper if interface differs.\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-03T18:57:27.251578-08:00\",\"updated_at\":\"2025-12-03T18:57:27.251578-08:00\"}\n+{\"id\":\"cmux15-lv3\",\"title\":\"Create provider factory and registry\",\"description\":\"Implement factory pattern for instantiating git providers.\\n\\n## Implementation\\n\\n### Provider Registry\\n```typescript\\n// packages/shared/src/git-providers/registry.ts\\n\\ntype ProviderName = 'github' | 'gitlab' | 'bitbucket'\\n\\nconst providers: Record\\u003cProviderName, () =\\u003e GitProvider\\u003e = {\\n  github: () =\\u003e new GitHubProvider(config.github),\\n  gitlab: () =\\u003e new GitLabProvider(config.gitlab),\\n  bitbucket: () =\\u003e new BitbucketProvider(config.bitbucket),\\n}\\n\\nexport function getProvider(name: ProviderName): GitProvider {\\n  const factory = providers[name]\\n  if (\\\\!factory) throw new Error(`Unknown provider: ${name}`)\\n  return factory()\\n}\\n\\nexport function getProviderForInstallation(installationId: string): Promise\\u003cGitProvider\\u003e {\\n  // Look up provider from providerConnections table\\n}\\n```\\n\\n### Configuration\\n```typescript\\n// packages/shared/src/git-providers/config.ts\\n\\ninterface ProviderConfig {\\n  github?: {\\n    appId: string\\n    privateKey: string\\n    webhookSecret: string\\n  }\\n  gitlab?: {\\n    appId: string\\n    appSecret: string\\n    webhookSecret: string\\n    baseUrl?: string  // For self-hosted\\n  }\\n  bitbucket?: {\\n    appKey: string\\n    appSecret: string\\n    webhookSecret: string\\n  }\\n}\\n```\\n\\n## Usage Examples\\n```typescript\\n// In route handlers\\nconst provider = getProvider(req.params.provider)\\nconst prs = await provider.listPullRequests(repo)\\n\\n// In webhook handlers\\nconst provider = getProviderForInstallation(installationId)\\nawait provider.addReaction(repo, prNumber, 'eyes')\\n```\\n\\n## Files to Create\\n- packages/shared/src/git-providers/registry.ts\\n- packages/shared/src/git-providers/config.ts\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T22:56:59.411446-08:00\",\"updated_at\":\"2025-12-03T00:55:25.71748-08:00\",\"closed_at\":\"2025-12-03T00:55:25.71748-08:00\",\"dependencies\":[{\"issue_id\":\"cmux15-lv3\",\"depends_on_id\":\"cmux15-saz\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T22:57:06.47341-08:00\",\"created_by\":\"daemon\"},{\"issue_id\":\"cmux15-lv3\",\"depends_on_id\":\"cmux15-ab7\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T22:57:06.51816-08:00\",\"created_by\":\"daemon\"},{\"issue_id\":\"cmux15-lv3\",\"depends_on_id\":\"cmux15-08d\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T22:57:06.566599-08:00\",\"created_by\":\"daemon\"}]}\n+{\"id\":\"cmux15-oxp\",\"title\":\"Update database schema for multi-provider support\",\"description\":\"Modify Convex schema to support multiple git providers.\\n\\n## Current GitHub-Specific Tables\\n- providerConnections - Already has 'provider' field, good!\\n- pullRequests - Has 'provider' field\\n- githubWorkflowRuns - GitHub-specific (Actions)\\n- githubCheckRuns - GitHub-specific (Checks API)\\n- githubDeployments - GitHub-specific (Deployments API)\\n- githubCommitStatuses - GitHub-specific (Status API)\\n\\n## Schema Changes Needed\\n\\n### 1. Rename/Generalize Tables\\n```typescript\\n// Option A: Keep GitHub-specific tables, add parallel tables\\n// - gitlabPipelines (equivalent to githubWorkflowRuns)\\n// - gitlabJobs (equivalent to githubCheckRuns)\\n// - bitbucketPipelines\\n\\n// Option B: Create generic tables with provider field\\n// - ciRuns (unified CI/CD runs)\\n// - deployments (unified deployments)\\n```\\n\\n### 2. providerConnections Updates\\n- Already supports provider field\\n- Need to add GitLab/Bitbucket specific fields\\n- Consider: workspace_id (Bitbucket), group_id (GitLab)\\n\\n### 3. New Indexes\\n- Add compound indexes on (provider, installationId)\\n- Add indexes for provider-specific queries\\n\\n### 4. Migration Strategy\\n- Keep existing tables working (backward compat)\\n- Add new fields as optional initially\\n- Gradual migration of queries\\n\\n## Files to Modify\\n- packages/convex/convex/schema.ts\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T22:56:25.820748-08:00\",\"updated_at\":\"2025-12-03T01:15:59.205524-08:00\",\"closed_at\":\"2025-12-03T01:15:59.205524-08:00\",\"dependencies\":[{\"issue_id\":\"cmux15-oxp\",\"depends_on_id\":\"cmux15-80t\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T22:56:30.467005-08:00\",\"created_by\":\"daemon\"}]}\n+{\"id\":\"cmux15-saz\",\"title\":\"Implement GitHub provider adapter\",\"description\":\"Refactor existing GitHub code into the new provider abstraction.\\n\\n## Files to Modify\\n- packages/convex/_shared/githubApp.ts → Extract to provider pattern\\n- apps/www/lib/utils/github-app-token.ts → Use provider abstraction\\n- apps/www/lib/github/*.ts → Migrate to provider\\n\\n## Implementation\\n- Create packages/shared/src/git-providers/github/index.ts\\n- Implement GitProvider interface using existing Octokit code\\n- Keep backward compatibility during migration\\n- Map GitHub-specific responses to normalized types\\n\\n## Considerations\\n- GitHub App authentication flow\\n- Installation tokens\\n- GitHub-specific features (Actions, Checks, Deployments)\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T22:55:15.125579-08:00\",\"updated_at\":\"2025-12-03T00:55:27.755109-08:00\",\"closed_at\":\"2025-12-03T00:55:27.755109-08:00\",\"dependencies\":[{\"issue_id\":\"cmux15-saz\",\"depends_on_id\":\"cmux15-t6p\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T22:55:40.101323-08:00\",\"created_by\":\"daemon\"}]}\n+{\"id\":\"cmux15-t6p\",\"title\":\"Create core GitProvider interface\",\"description\":\"Implement the core TypeScript interfaces that all git providers must implement.\\n\\n## Files to Create/Modify\\n- packages/shared/src/git-providers/types.ts - Core interfaces\\n- packages/shared/src/git-providers/index.ts - Exports\\n\\n## Interfaces Needed\\n```typescript\\ninterface GitProvider {\\n  name: 'github' | 'gitlab' | 'bitbucket'\\n  // Authentication\\n  createAppAuth(): Promise\\u003cAuthResult\\u003e\\n  getInstallationToken(installationId: string): Promise\\u003cstring\\u003e\\n  // Repositories\\n  listRepositories(installationId: string): AsyncIterable\\u003cRepository\\u003e\\n  getRepository(owner: string, repo: string): Promise\\u003cRepository\\u003e\\n  // Pull Requests / Merge Requests\\n  listPullRequests(repo: string, options?: PRListOptions): Promise\\u003cPullRequest[]\\u003e\\n  getPullRequest(repo: string, number: number): Promise\\u003cPullRequest\\u003e\\n  createPullRequest(repo: string, params: CreatePRParams): Promise\\u003cPullRequest\\u003e\\n  getPullRequestPatch(repo: string, number: number): Promise\\u003cstring\\u003e\\n  getPullRequestFiles(repo: string, number: number): Promise\\u003cPRFile[]\\u003e\\n  // Comments\\n  createPRComment(repo: string, number: number, body: string): Promise\\u003cComment\\u003e\\n  updatePRComment(repo: string, commentId: number, body: string): Promise\\u003cComment\\u003e\\n  // Reactions\\n  addReaction(repo: string, issueNumber: number, reaction: string): Promise\\u003cvoid\\u003e\\n  // File Contents\\n  getFileContent(repo: string, path: string, ref?: string): Promise\\u003cstring\\u003e\\n}\\n```\\n\\n## Normalized Types\\n- Repository, PullRequest, Branch, User, Comment, etc.\\n- Map provider-specific fields to common fields\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T22:54:57.750531-08:00\",\"updated_at\":\"2025-12-03T00:51:00.446908-08:00\",\"closed_at\":\"2025-12-03T00:51:00.446908-08:00\",\"dependencies\":[{\"issue_id\":\"cmux15-t6p\",\"depends_on_id\":\"cmux15-80t\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T22:55:05.415868-08:00\",\"created_by\":\"daemon\"}]}\n+{\"id\":\"cmux15-tcf\",\"title\":\"Abstract CI/CD status tracking for git providers\",\"description\":\"Abstract CI/CD pipeline status tracking across providers.\\n\\n## Current State (GitHub-specific tables)\\n- githubWorkflowRuns - GitHub Actions workflow runs\\n- githubCheckRuns - Third-party checks (Vercel, etc.)\\n- githubDeployments - Deployment events\\n- githubCommitStatuses - Legacy commit status API\\n\\n## Provider CI/CD Systems\\n| Feature | GitHub | GitLab | Bitbucket |\\n|---------|--------|--------|-----------|\\n| CI/CD | Actions | Pipelines | Pipelines |\\n| Checks | Check Runs API | Pipeline jobs | Build status |\\n| Deployments | Environments | Environments | Deployments |\\n| Status API | Commit status | Commit status | Build status |\\n\\n## Options\\n\\n### Option A: Unified Tables\\n```typescript\\n// ciRuns - unified CI/CD runs\\n{\\n  provider: 'github' | 'gitlab' | 'bitbucket'\\n  runId: string  // provider-specific ID\\n  pipelineId?: string\\n  name: string\\n  status: 'queued' | 'in_progress' | 'completed'\\n  conclusion?: 'success' | 'failure' | 'cancelled' | ...\\n  // ...normalized fields\\n}\\n```\\n\\n### Option B: Provider-Specific Tables (current approach extended)\\n- Keep githubWorkflowRuns\\n- Add gitlabPipelines, gitlabJobs\\n- Add bitbucketPipelines\\n\\n## Webhook Events\\n| Event | GitHub | GitLab | Bitbucket |\\n|-------|--------|--------|-----------|\\n| CI start | workflow_run.queued | pipeline.pending | repo:commit_status_created |\\n| CI complete | workflow_run.completed | pipeline.success/failed | repo:commit_status_updated |\\n| Check | check_run | pipeline job | build status |\\n\\n## Considerations\\n- Different granularity (workflow vs job vs step)\\n- Not all fields map cleanly\\n- May want to query 'all CI status for this commit' across providers\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T23:13:20.554037-08:00\",\"updated_at\":\"2025-12-02T23:13:20.554037-08:00\",\"dependencies\":[{\"issue_id\":\"cmux15-tcf\",\"depends_on_id\":\"cmux15-cyr\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T23:13:27.662206-08:00\",\"created_by\":\"daemon\"},{\"issue_id\":\"cmux15-tcf\",\"depends_on_id\":\"cmux15-oxp\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T23:13:27.713223-08:00\",\"created_by\":\"daemon\"}]}\n+{\"id\":\"cmux15-u5n\",\"title\":\"Abstract authentication layer for git providers\",\"description\":\"Create unified authentication handling for all git providers.\\n\\n## Current State (GitHub-only)\\n- GitHub App with JWT + installation tokens\\n- OAuth tokens via Stack Auth\\n- Environment: CMUX_GITHUB_APP_ID, CMUX_GITHUB_APP_PRIVATE_KEY\\n\\n## Required Abstraction\\n\\n### Environment Variables Pattern\\n```\\n# GitHub\\nCMUX_GITHUB_APP_ID\\nCMUX_GITHUB_APP_PRIVATE_KEY\\nGITHUB_APP_WEBHOOK_SECRET\\n\\n# GitLab\\nCMUX_GITLAB_APP_ID\\nCMUX_GITLAB_APP_SECRET\\nGITLAB_WEBHOOK_SECRET\\n\\n# Bitbucket\\nCMUX_BITBUCKET_APP_KEY\\nCMUX_BITBUCKET_APP_SECRET\\nBITBUCKET_WEBHOOK_SECRET\\n```\\n\\n### Auth Interface\\n```typescript\\ninterface ProviderAuth {\\n  getAppToken(): Promise\\u003cstring\\u003e\\n  getInstallationToken(installationId: string, permissions?: Permissions): Promise\\u003cTokenResult\\u003e\\n  validateWebhookSignature(payload: string, signature: string): boolean\\n  getOAuthUrl(state: string, scopes: string[]): string\\n  exchangeOAuthCode(code: string): Promise\\u003cOAuthTokens\\u003e\\n}\\n```\\n\\n## Files to Modify\\n- packages/convex/_shared/convex-env.ts - Add new env vars\\n- packages/convex/_shared/githubApp.ts → refactor to provider pattern\\n- apps/www/lib/utils/github-app-token.ts → abstract\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T22:55:51.909751-08:00\",\"updated_at\":\"2025-12-02T22:55:51.909751-08:00\",\"dependencies\":[{\"issue_id\":\"cmux15-u5n\",\"depends_on_id\":\"cmux15-t6p\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T22:55:56.379716-08:00\",\"created_by\":\"daemon\"}]}\n+{\"id\":\"cmux15-xha\",\"title\":\"Abstract file content retrieval for git providers\",\"description\":\"Abstract file content retrieval across providers for code review and diff viewing.\\n\\n## Current State\\n- apps/www/lib/routes/github.prs.file-contents.route.ts - Get file at specific ref\\n- apps/www/lib/routes/github.prs.file-contents-batch.route.ts - Batch file retrieval\\n- apps/www/lib/routes/github.prs.patch.route.ts - Get PR patch/diff\\n- apps/www/lib/routes/github.prs.files.route.ts - List changed files\\n\\n## Operations to Abstract\\n```typescript\\ninterface FileContentsProvider {\\n  // Single file\\n  getFileContent(repo: string, path: string, ref?: string): Promise\\u003cFileContent\\u003e\\n  \\n  // Batch files\\n  getFileContentsBatch(repo: string, files: FileRequest[]): Promise\\u003cFileContent[]\\u003e\\n  \\n  // PR-specific\\n  getPRPatch(repo: string, prNumber: number): Promise\\u003cstring\\u003e\\n  getPRChangedFiles(repo: string, prNumber: number): Promise\\u003cChangedFile[]\\u003e\\n  \\n  // Compare\\n  getCompare(repo: string, base: string, head: string): Promise\\u003cCompareResult\\u003e\\n}\\n\\ninterface FileContent {\\n  path: string\\n  content: string\\n  encoding: 'utf-8' | 'base64'\\n  sha?: string\\n  size?: number\\n}\\n\\ninterface ChangedFile {\\n  filename: string\\n  status: 'added' | 'removed' | 'modified' | 'renamed'\\n  additions: number\\n  deletions: number\\n  patch?: string\\n}\\n```\\n\\n## Provider Differences\\n| Feature | GitHub | GitLab | Bitbucket |\\n|---------|--------|--------|-----------|\\n| File content | contents API | repository files API | src endpoint |\\n| Batch files | GraphQL | GraphQL | Multiple requests |\\n| PR diff | pulls.get (diff media type) | MR changes | diffstat endpoint |\\n| Compare | repos.compareCommits | compare | diff endpoint |\\n\\n## Files to Modify\\n- apps/www/lib/routes/github.prs.file-contents*.route.ts\\n- apps/www/lib/routes/github.prs.patch.route.ts\\n- apps/www/lib/routes/github.prs.files.route.ts\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T23:13:41.487378-08:00\",\"updated_at\":\"2025-12-02T23:13:41.487378-08:00\",\"dependencies\":[{\"issue_id\":\"cmux15-xha\",\"depends_on_id\":\"cmux15-lv3\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T23:13:46.205114-08:00\",\"created_by\":\"daemon\"}]}\ndiff --git a/.beads/metadata.json b/.beads/metadata.json\nnew file mode 100644\nindex 000000000..881801f99\n--- /dev/null\n+++ b/.beads/metadata.json\n@@ -0,0 +1,5 @@\n+{\n+  \"database\": \"beads.db\",\n+  \"jsonl_export\": \"issues.jsonl\",\n+  \"last_bd_version\": \"0.28.0\"\n+}\n\\ No newline at end of file\ndiff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..0724cebfd\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,35 @@\n+{\n+  \"$schema\": \"https://json.schemastore.org/claude-code-settings.json\",\n+  \"alwaysThinkingEnabled\": true,\n+  \"feedbackSurveyState\": {\n+    \"lastShownTime\": 1754013974739\n+  },\n+  \"hooks\": {\n+    \"PreCompact\": [\n+      {\n+        \"hooks\": [\n+          {\n+            \"command\": \"bd prime\",\n+            \"type\": \"command\"\n+          }\n+        ],\n+        \"matcher\": \"\"\n+      }\n+    ],\n+    \"SessionStart\": [\n+      {\n+        \"hooks\": [\n+          {\n+            \"command\": \"bd prime\",\n+            \"type\": \"command\"\n+          }\n+        ],\n+        \"matcher\": \"\"\n+      }\n+    ]\n+  },\n+  \"includeCoAuthoredBy\": false,\n+  \"permissions\": {\n+    \"defaultMode\": \"default\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/.gitattributes b/.gitattributes\nnew file mode 100644\nindex 000000000..807d5983d\n--- /dev/null\n+++ b/.gitattributes\n@@ -0,0 +1,3 @@\n+\n+# Use bd merge for beads JSONL files\n+.beads/issues.jsonl merge=beads\ndiff --git a/packages/convex/_shared/providers.ts b/packages/convex/_shared/providers.ts\nnew file mode 100644\nindex 000000000..e59f3626e\n--- /dev/null\n+++ b/packages/convex/_shared/providers.ts\n@@ -0,0 +1,80 @@\n+/**\n+ * Shared provider types and validators for multi-provider git support.\n+ */\n+import { v } from \"convex/values\";\n+\n+/**\n+ * Git provider types.\n+ */\n+export const GIT_PROVIDERS = [\"github\", \"gitlab\", \"bitbucket\"] as const;\n+export type GitProvider = (typeof GIT_PROVIDERS)[number];\n+\n+/**\n+ * Provider connection types.\n+ */\n+export const PROVIDER_CONNECTION_TYPES = [\n+  \"github_app\",\n+  \"gitlab_oauth\",\n+  \"bitbucket_oauth\",\n+] as const;\n+export type ProviderConnectionType = (typeof PROVIDER_CONNECTION_TYPES)[number];\n+\n+/**\n+ * Account/owner types across providers.\n+ */\n+export const OWNER_TYPES = [\"User\", \"Organization\", \"Group\", \"Team\"] as const;\n+export type OwnerType = (typeof OWNER_TYPES)[number];\n+\n+/**\n+ * Convex validators for use in mutation/query args.\n+ */\n+export const gitProviderValidator = v.union(\n+  v.literal(\"github\"),\n+  v.literal(\"gitlab\"),\n+  v.literal(\"bitbucket\")\n+);\n+\n+export const providerConnectionTypeValidator = v.union(\n+  v.literal(\"github_app\"),\n+  v.literal(\"gitlab_oauth\"),\n+  v.literal(\"bitbucket_oauth\")\n+);\n+\n+export const ownerTypeValidator = v.union(\n+  v.literal(\"User\"),\n+  v.literal(\"Organization\"),\n+  v.literal(\"Group\"),\n+  v.literal(\"Team\")\n+);\n+\n+/**\n+ * Parse a string to a GitProvider type.\n+ * Returns undefined if the string is not a valid provider.\n+ */\n+export function parseGitProvider(value: string | undefined): GitProvider | undefined {\n+  if (!value) return undefined;\n+  if (GIT_PROVIDERS.includes(value as GitProvider)) {\n+    return value as GitProvider;\n+  }\n+  return undefined;\n+}\n+\n+/**\n+ * Assert a string is a valid GitProvider.\n+ * Defaults to \"github\" if invalid or undefined.\n+ */\n+export function asGitProvider(value: string | undefined): GitProvider {\n+  return parseGitProvider(value) ?? \"github\";\n+}\n+\n+/**\n+ * Parse a string to an OwnerType.\n+ * Returns undefined if the string is not a valid owner type.\n+ */\n+export function parseOwnerType(value: string | undefined): OwnerType | undefined {\n+  if (!value) return undefined;\n+  if (OWNER_TYPES.includes(value as OwnerType)) {\n+    return value as OwnerType;\n+  }\n+  return undefined;\n+}\ndiff --git a/packages/convex/convex/github.ts b/packages/convex/convex/github.ts\nindex 209e9dd18..29de7ed69 100644\n--- a/packages/convex/convex/github.ts\n+++ b/packages/convex/convex/github.ts\n@@ -1,5 +1,6 @@\n import { v } from \"convex/values\";\n import { getTeamId } from \"../_shared/team\";\n+import { gitProviderValidator } from \"../_shared/providers\";\n import type { Doc } from \"./_generated/dataModel\";\n import { internalMutation, internalQuery } from \"./_generated/server\";\n import { authMutation, authQuery } from \"./users/utils\";\n@@ -431,13 +432,13 @@ export const insertRepo = internalMutation({\n     org: v.string(),\n     name: v.string(),\n     gitRemote: v.string(),\n-    provider: v.optional(v.string()),\n+    provider: v.optional(gitProviderValidator),\n     userId: v.string(),\n     teamSlugOrId: v.string(),\n   },\n   handler: async (ctx, args) => {\n     const teamId = await getTeamId(ctx, args.teamSlugOrId);\n-    const { ...rest } = args;\n+    const { teamSlugOrId: _, ...rest } = args;\n     return await ctx.db.insert(\"repos\", { ...rest, teamId });\n   },\n });\n@@ -449,7 +450,7 @@ export const upsertRepo = authMutation({\n     org: v.string(),\n     name: v.string(),\n     gitRemote: v.string(),\n-    provider: v.optional(v.string()),\n+    provider: v.optional(gitProviderValidator),\n   },\n   handler: async (ctx, args) => {\n     const userId = ctx.identity.subject;\n@@ -465,6 +466,8 @@ export const upsertRepo = authMutation({\n       .filter((q) => q.eq(q.field(\"userId\"), userId))\n       .first();\n \n+    const provider = args.provider ?? \"github\";\n+\n     if (existing) {\n       // Update existing repo\n       return await ctx.db.patch(existing._id, {\n@@ -472,7 +475,7 @@ export const upsertRepo = authMutation({\n         org: args.org,\n         name: args.name,\n         gitRemote: args.gitRemote,\n-        provider: args.provider,\n+        provider,\n         lastSyncedAt: now,\n       });\n     } else {\n@@ -482,7 +485,7 @@ export const upsertRepo = authMutation({\n         org: args.org,\n         name: args.name,\n         gitRemote: args.gitRemote,\n-        provider: args.provider || \"github\",\n+        provider,\n         userId,\n         teamId,\n         lastSyncedAt: now,\n@@ -529,7 +532,7 @@ export const bulkInsertRepos = authMutation({\n         org: v.string(),\n         name: v.string(),\n         gitRemote: v.string(),\n-        provider: v.optional(v.string()),\n+        provider: v.optional(gitProviderValidator),\n       })\n     ),\n   },\n@@ -555,7 +558,7 @@ export const bulkInsertRepos = authMutation({\n       newRepos.map((repo) =>\n         ctx.db.insert(\"repos\", {\n           ...repo,\n-          provider: repo.provider || \"github\",\n+          provider: repo.provider ?? \"github\",\n           userId,\n           teamId,\n           lastSyncedAt: now,\n@@ -684,7 +687,7 @@ export const replaceAllRepos = authMutation({\n         org: v.string(),\n         name: v.string(),\n         gitRemote: v.string(),\n-        provider: v.optional(v.string()),\n+        provider: v.optional(gitProviderValidator),\n       })\n     ),\n   },\n@@ -704,7 +707,13 @@ export const replaceAllRepos = authMutation({\n     const now = Date.now();\n     const insertedIds = await Promise.all(\n       repos.map((repo) =>\n-        ctx.db.insert(\"repos\", { ...repo, userId, teamId, lastSyncedAt: now })\n+        ctx.db.insert(\"repos\", {\n+          ...repo,\n+          provider: repo.provider ?? \"github\",\n+          userId,\n+          teamId,\n+          lastSyncedAt: now,\n+        })\n       )\n     );\n     return insertedIds;\ndiff --git a/packages/convex/convex/schema.ts b/packages/convex/convex/schema.ts\nindex 8b5b43981..808f89a86 100644\n--- a/packages/convex/convex/schema.ts\n+++ b/packages/convex/convex/schema.ts\n@@ -487,14 +487,22 @@ const convexSchema = defineSchema({\n     org: v.string(),\n     name: v.string(),\n     gitRemote: v.string(),\n-    provider: v.optional(v.string()), // e.g. \"github\", \"gitlab\", etc.\n+    provider: v.optional(\n+      v.union(v.literal(\"github\"), v.literal(\"gitlab\"), v.literal(\"bitbucket\"))\n+    ),\n     userId: v.string(),\n     teamId: v.string(),\n-    // Provider metadata (GitHub App)\n-    providerRepoId: v.optional(v.number()),\n+    // Provider metadata\n+    providerRepoId: v.optional(v.number()), // Numeric repo ID (GitHub/GitLab)\n+    providerRepoIdStr: v.optional(v.string()), // String repo ID (Bitbucket slug)\n     ownerLogin: v.optional(v.string()),\n     ownerType: v.optional(\n-      v.union(v.literal(\"User\"), v.literal(\"Organization\"))\n+      v.union(\n+        v.literal(\"User\"),\n+        v.literal(\"Organization\"),\n+        v.literal(\"Group\"),\n+        v.literal(\"Team\")\n+      )\n     ),\n     visibility: v.optional(v.union(v.literal(\"public\"), v.literal(\"private\"))),\n     defaultBranch: v.optional(v.string()),\n@@ -568,8 +576,11 @@ const convexSchema = defineSchema({\n     teamId: v.string(),\n     createdByUserId: v.string(),\n     repoFullName: v.string(),\n-    repoProvider: v.optional(v.literal(\"github\")),\n-    repoInstallationId: v.number(),\n+    repoProvider: v.optional(\n+      v.union(v.literal(\"github\"), v.literal(\"gitlab\"), v.literal(\"bitbucket\"))\n+    ),\n+    repoInstallationId: v.number(), // GitHub numeric installation ID (kept required for backward compat)\n+    repoInstallationIdStr: v.optional(v.string()), // GitLab/Bitbucket string identifier\n     repoDefaultBranch: v.optional(v.string()),\n     environmentId: v.optional(v.id(\"environments\")),\n     status: v.optional(\n@@ -699,22 +710,39 @@ const convexSchema = defineSchema({\n     .index(\"by_user\", [\"userId\", \"createdAt\"])\n     .index(\"by_team_user\", [\"teamId\", \"userId\"]),\n \n-  // GitHub App installation connections (team-scoped, but teamId may be set later)\n+  // Git provider connections (team-scoped, but teamId may be set later)\n+  // Supports GitHub App, GitLab OAuth, and Bitbucket OAuth\n   providerConnections: defineTable({\n     teamId: v.optional(v.string()), // Canonical team UUID; may be set post-install\n     connectedByUserId: v.optional(v.string()), // Stack user who linked the install (when known)\n-    type: v.literal(\"github_app\"),\n+    type: v.union(\n+      v.literal(\"github_app\"),\n+      v.literal(\"gitlab_oauth\"),\n+      v.literal(\"bitbucket_oauth\")\n+    ),\n+    // GitHub App installation ID (required for GitHub, optional for others)\n     installationId: v.number(),\n-    accountLogin: v.optional(v.string()), // org or user login\n-    accountId: v.optional(v.number()),\n+    // GitLab/Bitbucket string identifier (when not using numeric ID)\n+    installationIdStr: v.optional(v.string()),\n+    accountLogin: v.optional(v.string()), // org/user/group login\n+    accountId: v.optional(v.number()), // numeric account ID (GitHub/GitLab)\n+    accountIdStr: v.optional(v.string()), // string account ID (Bitbucket workspace)\n     accountType: v.optional(\n-      v.union(v.literal(\"User\"), v.literal(\"Organization\"))\n+      v.union(\n+        v.literal(\"User\"),\n+        v.literal(\"Organization\"),\n+        v.literal(\"Group\"),\n+        v.literal(\"Team\")\n+      )\n     ),\n     isActive: v.optional(v.boolean()),\n+    // Provider-specific metadata (API base URLs for self-hosted, etc.)\n+    providerMetadata: v.optional(v.any()),\n     createdAt: v.number(),\n     updatedAt: v.number(),\n   })\n-    .index(\"by_installationId\", [\"installationId\"]) // resolve installation -> connection\n+    .index(\"by_installationId\", [\"installationId\"]) // resolve GitHub installation -> connection\n+    .index(\"by_installationIdStr\", [\"installationIdStr\"]) // resolve GitLab/Bitbucket -> connection\n     .index(\"by_team\", [\"teamId\"]) // list connections for team\n     .index(\"by_team_type\", [\"teamId\", \"type\"]),\n \n@@ -778,11 +806,16 @@ const convexSchema = defineSchema({\n     returnUrl: v.optional(v.string()),\n   }).index(\"by_nonce\", [\"nonce\"]),\n \n-  // Pull Requests ingested from GitHub (via webhook or backfill)\n+  // Pull Requests / Merge Requests ingested from providers (via webhook or backfill)\n   pullRequests: defineTable({\n     // Identity within provider and repo context\n-    provider: v.literal(\"github\"),\n-    installationId: v.number(),\n+    provider: v.union(\n+      v.literal(\"github\"),\n+      v.literal(\"gitlab\"),\n+      v.literal(\"bitbucket\")\n+    ),\n+    installationId: v.number(), // GitHub numeric installation ID (kept required for backward compat)\n+    installationIdStr: v.optional(v.string()), // GitLab/Bitbucket string identifier\n     repositoryId: v.optional(v.number()),\n     repoFullName: v.string(), // owner/repo\n     number: v.number(), // PR number\ndiff --git a/packages/shared/package.json b/packages/shared/package.json\nindex 6db526c33..236b30fcd 100644\n--- a/packages/shared/package.json\n+++ b/packages/shared/package.json\n@@ -101,6 +101,22 @@\n     \"./screenshots/sanitize-markdown\": {\n       \"import\": \"./src/screenshots/sanitize-markdown.ts\",\n       \"types\": \"./src/screenshots/sanitize-markdown.ts\"\n+    },\n+    \"./git-providers\": {\n+      \"import\": \"./src/git-providers/index.ts\",\n+      \"types\": \"./src/git-providers/index.ts\"\n+    },\n+    \"./git-providers/types\": {\n+      \"import\": \"./src/git-providers/types.ts\",\n+      \"types\": \"./src/git-providers/types.ts\"\n+    },\n+    \"./git-providers/registry\": {\n+      \"import\": \"./src/git-providers/registry.ts\",\n+      \"types\": \"./src/git-providers/registry.ts\"\n+    },\n+    \"./git-providers/providers/github\": {\n+      \"import\": \"./src/git-providers/providers/github.ts\",\n+      \"types\": \"./src/git-providers/providers/github.ts\"\n     }\n   },\n   \"dependencies\": {\ndiff --git a/packages/shared/src/git-providers/index.test.ts b/packages/shared/src/git-providers/index.test.ts\nnew file mode 100644\nindex 000000000..733f0f5a9\n--- /dev/null\n+++ b/packages/shared/src/git-providers/index.test.ts\n@@ -0,0 +1,387 @@\n+import { describe, it, expect, beforeEach } from \"vitest\";\n+import {\n+  providerRegistry,\n+  GitProviderRegistry,\n+  githubProvider,\n+  type ParsedRepo,\n+} from \"./index.js\";\n+\n+describe(\"GitProviderRegistry\", () => {\n+  describe(\"parseRepoUrl\", () => {\n+    it(\"parses GitHub HTTPS URLs\", () => {\n+      const result = providerRegistry.parseRepoUrl(\n+        \"https://github.com/owner/repo\"\n+      );\n+      expect(result).toEqual({\n+        owner: \"owner\",\n+        name: \"repo\",\n+        fullName: \"owner/repo\",\n+        url: \"https://github.com/owner/repo\",\n+        gitUrl: \"https://github.com/owner/repo.git\",\n+        provider: \"github\",\n+      });\n+    });\n+\n+    it(\"parses GitHub HTTPS URLs with .git suffix\", () => {\n+      const result = providerRegistry.parseRepoUrl(\n+        \"https://github.com/owner/repo.git\"\n+      );\n+      expect(result).toEqual({\n+        owner: \"owner\",\n+        name: \"repo\",\n+        fullName: \"owner/repo\",\n+        url: \"https://github.com/owner/repo\",\n+        gitUrl: \"https://github.com/owner/repo.git\",\n+        provider: \"github\",\n+      });\n+    });\n+\n+    it(\"parses GitHub SSH URLs\", () => {\n+      const result = providerRegistry.parseRepoUrl(\n+        \"git@github.com:owner/repo.git\"\n+      );\n+      expect(result).toEqual({\n+        owner: \"owner\",\n+        name: \"repo\",\n+        fullName: \"owner/repo\",\n+        url: \"https://github.com/owner/repo\",\n+        gitUrl: \"https://github.com/owner/repo.git\",\n+        provider: \"github\",\n+      });\n+    });\n+\n+    it(\"parses simple owner/repo format\", () => {\n+      const result = providerRegistry.parseRepoUrl(\"owner/repo\");\n+      expect(result).toEqual({\n+        owner: \"owner\",\n+        name: \"repo\",\n+        fullName: \"owner/repo\",\n+        url: \"https://github.com/owner/repo\",\n+        gitUrl: \"https://github.com/owner/repo.git\",\n+        provider: \"github\",\n+      });\n+    });\n+\n+    it(\"returns null for invalid URLs\", () => {\n+      expect(providerRegistry.parseRepoUrl(\"\")).toBeNull();\n+      expect(providerRegistry.parseRepoUrl(\"not-a-url\")).toBeNull();\n+      expect(\n+        providerRegistry.parseRepoUrl(\"https://example.com/something\")\n+      ).toBeNull();\n+    });\n+\n+    it(\"handles URLs with trailing slash\", () => {\n+      const result = providerRegistry.parseRepoUrl(\n+        \"https://github.com/owner/repo/\"\n+      );\n+      expect(result?.fullName).toBe(\"owner/repo\");\n+    });\n+\n+    it(\"handles owner names with hyphens and underscores\", () => {\n+      const result = providerRegistry.parseRepoUrl(\n+        \"https://github.com/my-org_name/my-repo\"\n+      );\n+      expect(result?.owner).toBe(\"my-org_name\");\n+      expect(result?.name).toBe(\"my-repo\");\n+    });\n+  });\n+\n+  describe(\"get\", () => {\n+    it(\"returns registered provider by id\", () => {\n+      const provider = providerRegistry.get(\"github\");\n+      expect(provider.id).toBe(\"github\");\n+      expect(provider.displayName).toBe(\"GitHub\");\n+    });\n+\n+    it(\"throws for unregistered provider\", () => {\n+      expect(() => providerRegistry.get(\"gitlab\" as \"github\")).toThrow(\n+        /not registered/\n+      );\n+    });\n+  });\n+\n+  describe(\"tryGet\", () => {\n+    it(\"returns provider if registered\", () => {\n+      const provider = providerRegistry.tryGet(\"github\");\n+      expect(provider?.id).toBe(\"github\");\n+    });\n+\n+    it(\"returns undefined for unregistered provider\", () => {\n+      const provider = providerRegistry.tryGet(\"gitlab\" as \"github\");\n+      expect(provider).toBeUndefined();\n+    });\n+  });\n+\n+  describe(\"has\", () => {\n+    it(\"returns true for registered provider\", () => {\n+      expect(providerRegistry.has(\"github\")).toBe(true);\n+    });\n+\n+    it(\"returns false for unregistered provider\", () => {\n+      expect(providerRegistry.has(\"gitlab\" as \"github\")).toBe(false);\n+    });\n+  });\n+\n+  describe(\"detectProvider\", () => {\n+    it(\"detects GitHub from URL\", () => {\n+      expect(\n+        providerRegistry.detectProvider(\"https://github.com/owner/repo\")\n+      ).toBe(\"github\");\n+    });\n+\n+    it(\"returns null for unknown URLs\", () => {\n+      expect(\n+        providerRegistry.detectProvider(\"https://unknown.com/owner/repo\")\n+      ).toBeNull();\n+    });\n+  });\n+\n+  describe(\"getByDomain\", () => {\n+    it(\"returns provider by domain\", () => {\n+      const provider = providerRegistry.getByDomain(\"github.com\");\n+      expect(provider?.id).toBe(\"github\");\n+    });\n+\n+    it(\"is case insensitive\", () => {\n+      const provider = providerRegistry.getByDomain(\"GitHub.COM\");\n+      expect(provider?.id).toBe(\"github\");\n+    });\n+\n+    it(\"returns undefined for unknown domain\", () => {\n+      expect(providerRegistry.getByDomain(\"unknown.com\")).toBeUndefined();\n+    });\n+  });\n+\n+  describe(\"all and ids\", () => {\n+    it(\"returns all registered providers\", () => {\n+      const all = providerRegistry.all();\n+      expect(all.length).toBeGreaterThanOrEqual(1);\n+      expect(all.some((p) => p.id === \"github\")).toBe(true);\n+    });\n+\n+    it(\"returns all registered provider ids\", () => {\n+      const ids = providerRegistry.ids();\n+      expect(ids).toContain(\"github\");\n+    });\n+  });\n+});\n+\n+describe(\"githubProvider\", () => {\n+  describe(\"parseRepoUrl\", () => {\n+    it(\"returns null for non-GitHub URLs when used directly\", () => {\n+      // The simple format owner/repo is ambiguous and GitHub claims it\n+      // But explicit other-provider URLs should return null\n+      const result = githubProvider.parseRepoUrl(\n+        \"https://gitlab.com/owner/repo\"\n+      );\n+      expect(result).toBeNull();\n+    });\n+  });\n+\n+  describe(\"buildRepoUrl\", () => {\n+    it(\"builds correct GitHub URL\", () => {\n+      expect(githubProvider.buildRepoUrl(\"owner\", \"repo\")).toBe(\n+        \"https://github.com/owner/repo\"\n+      );\n+    });\n+  });\n+\n+  describe(\"buildGitUrl\", () => {\n+    it(\"builds correct git clone URL\", () => {\n+      expect(githubProvider.buildGitUrl(\"owner\", \"repo\")).toBe(\n+        \"https://github.com/owner/repo.git\"\n+      );\n+    });\n+  });\n+\n+  describe(\"getWebhookEventType\", () => {\n+    it(\"extracts event type from headers\", () => {\n+      const eventType = githubProvider.getWebhookEventType({\n+        \"x-github-event\": \"pull_request\",\n+      });\n+      expect(eventType).toBe(\"pull_request\");\n+    });\n+\n+    it(\"returns null if header is missing\", () => {\n+      const eventType = githubProvider.getWebhookEventType({});\n+      expect(eventType).toBeNull();\n+    });\n+  });\n+\n+  describe(\"mapWebhookEvent\", () => {\n+    it(\"maps pull_request event\", () => {\n+      const payload = {\n+        action: \"opened\",\n+        installation: { id: 12345 },\n+        repository: {\n+          id: 67890,\n+          full_name: \"owner/repo\",\n+          name: \"repo\",\n+          owner: { login: \"owner\" },\n+        },\n+      };\n+\n+      const event = githubProvider.mapWebhookEvent(\"pull_request\", payload);\n+\n+      expect(event).toEqual({\n+        type: \"pull_request\",\n+        action: \"opened\",\n+        provider: \"github\",\n+        installationId: 12345,\n+        repository: {\n+          id: 67890,\n+          fullName: \"owner/repo\",\n+          name: \"repo\",\n+          owner: \"owner\",\n+        },\n+        deliveryId: undefined,\n+        rawPayload: payload,\n+      });\n+    });\n+\n+    it(\"maps push event\", () => {\n+      const payload = {\n+        installation: { id: 12345 },\n+        repository: {\n+          id: 67890,\n+          full_name: \"owner/repo\",\n+          name: \"repo\",\n+          owner: { login: \"owner\" },\n+        },\n+      };\n+\n+      const event = githubProvider.mapWebhookEvent(\"push\", payload);\n+\n+      expect(event?.type).toBe(\"push\");\n+      expect(event?.action).toBeUndefined();\n+    });\n+\n+    it(\"maps workflow_run event\", () => {\n+      const event = githubProvider.mapWebhookEvent(\"workflow_run\", {\n+        action: \"completed\",\n+        installation: { id: 123 },\n+      });\n+\n+      expect(event?.type).toBe(\"workflow_run\");\n+      expect(event?.action).toBe(\"completed\");\n+    });\n+\n+    it(\"returns null for unknown event types\", () => {\n+      const event = githubProvider.mapWebhookEvent(\"unknown_event\", {});\n+      expect(event).toBeNull();\n+    });\n+  });\n+\n+  describe(\"verifyWebhookSignature\", () => {\n+    it(\"rejects missing signature\", async () => {\n+      const result = await githubProvider.verifyWebhookSignature(\n+        { headers: {}, body: \"{}\" },\n+        \"secret\"\n+      );\n+\n+      expect(result.isValid).toBe(false);\n+      expect(result.error).toContain(\"Missing\");\n+    });\n+\n+    it(\"rejects invalid signature format\", async () => {\n+      const result = await githubProvider.verifyWebhookSignature(\n+        { headers: { \"x-hub-signature-256\": \"invalid\" }, body: \"{}\" },\n+        \"secret\"\n+      );\n+\n+      expect(result.isValid).toBe(false);\n+      expect(result.error).toContain(\"format\");\n+    });\n+\n+    it(\"accepts valid signature\", async () => {\n+      const secret = \"test-secret\";\n+      const body = '{\"test\":\"data\"}';\n+\n+      // Generate valid signature\n+      const encoder = new TextEncoder();\n+      const keyData = encoder.encode(secret);\n+      const messageData = encoder.encode(body);\n+\n+      const key = await crypto.subtle.importKey(\n+        \"raw\",\n+        keyData,\n+        { name: \"HMAC\", hash: \"SHA-256\" },\n+        false,\n+        [\"sign\"]\n+      );\n+\n+      const signatureBuffer = await crypto.subtle.sign(\"HMAC\", key, messageData);\n+      const signature = Array.from(new Uint8Array(signatureBuffer))\n+        .map((b) => b.toString(16).padStart(2, \"0\"))\n+        .join(\"\");\n+\n+      const result = await githubProvider.verifyWebhookSignature(\n+        {\n+          headers: { \"x-hub-signature-256\": `sha256=${signature}` },\n+          body,\n+        },\n+        secret\n+      );\n+\n+      expect(result.isValid).toBe(true);\n+      expect(result.error).toBeUndefined();\n+    });\n+\n+    it(\"rejects invalid signature\", async () => {\n+      const result = await githubProvider.verifyWebhookSignature(\n+        {\n+          headers: {\n+            \"x-hub-signature-256\":\n+              \"sha256=0000000000000000000000000000000000000000000000000000000000000000\",\n+          },\n+          body: '{\"test\":\"data\"}',\n+        },\n+        \"secret\"\n+      );\n+\n+      expect(result.isValid).toBe(false);\n+      expect(result.error).toContain(\"mismatch\");\n+    });\n+  });\n+});\n+\n+describe(\"GitProviderRegistry isolation\", () => {\n+  let isolated: GitProviderRegistry;\n+\n+  beforeEach(() => {\n+    isolated = new GitProviderRegistry();\n+  });\n+\n+  it(\"starts empty\", () => {\n+    expect(isolated.all()).toHaveLength(0);\n+    expect(isolated.ids()).toHaveLength(0);\n+  });\n+\n+  it(\"allows registering providers\", () => {\n+    isolated.register(githubProvider);\n+    expect(isolated.has(\"github\")).toBe(true);\n+  });\n+\n+  it(\"prevents duplicate registration\", () => {\n+    isolated.register(githubProvider);\n+    expect(() => isolated.register(githubProvider)).toThrow(/already registered/);\n+  });\n+\n+  it(\"allows replacing providers\", () => {\n+    isolated.register(githubProvider);\n+\n+    const modified = {\n+      ...githubProvider,\n+      displayName: \"Modified GitHub\",\n+    };\n+\n+    isolated.replace(modified);\n+    expect(isolated.get(\"github\").displayName).toBe(\"Modified GitHub\");\n+  });\n+\n+  it(\"can be cleared\", () => {\n+    isolated.register(githubProvider);\n+    isolated.clear();\n+    expect(isolated.all()).toHaveLength(0);\n+  });\n+});\ndiff --git a/packages/shared/src/git-providers/index.ts b/packages/shared/src/git-providers/index.ts\nnew file mode 100644\nindex 000000000..02d0f227c\n--- /dev/null\n+++ b/packages/shared/src/git-providers/index.ts\n@@ -0,0 +1,81 @@\n+/**\n+ * Git Provider Abstraction Layer\n+ *\n+ * This module provides a unified interface for interacting with multiple\n+ * git providers (GitHub, GitLab, Bitbucket).\n+ *\n+ * ## Quick Start\n+ *\n+ * ```typescript\n+ * import {\n+ *   providerRegistry,\n+ *   type ParsedRepo,\n+ *   type GitProvider,\n+ * } from \"@cmux/shared/git-providers\";\n+ *\n+ * // Parse a repo URL (auto-detects provider)\n+ * const repo = providerRegistry.parseRepoUrl(\"https://github.com/owner/repo\");\n+ * console.log(repo?.provider); // \"github\"\n+ *\n+ * // Get a specific provider\n+ * const github = providerRegistry.get(\"github\");\n+ *\n+ * // List repositories for an installation\n+ * for await (const batch of github.listRepositories(installationId, token)) {\n+ *   console.log(`Got ${batch.length} repos`);\n+ * }\n+ * ```\n+ *\n+ * ## Architecture\n+ *\n+ * - `types.ts` - Core interfaces and type definitions\n+ * - `registry.ts` - Provider registry (singleton pattern)\n+ * - `providers/` - Provider implementations\n+ *\n+ * ## Adding a New Provider\n+ *\n+ * 1. Create a new file in `providers/` (e.g., `gitlab.ts`)\n+ * 2. Implement the `GitProvider` interface\n+ * 3. Register the provider in this index file\n+ *\n+ * @module\n+ */\n+\n+// Re-export all types\n+export type {\n+  GitProviderId,\n+  OwnerType,\n+  ParsedRepo,\n+  ProviderRepository,\n+  ProviderAppConfig,\n+  ProviderToken,\n+  WebhookEventType,\n+  ProviderWebhookEvent,\n+  ProviderPullRequest,\n+  WebhookVerificationResult,\n+  WebhookRequest,\n+  GitProvider,\n+  GitProviderErrorType,\n+} from \"./types.js\";\n+\n+export { GitProviderError } from \"./types.js\";\n+\n+// Re-export registry\n+export { providerRegistry, GitProviderRegistry } from \"./registry.js\";\n+\n+// Re-export providers\n+export { githubProvider } from \"./providers/github.js\";\n+\n+// ─────────────────────────────────────────────────────────────────────────────\n+// Auto-register built-in providers\n+// ─────────────────────────────────────────────────────────────────────────────\n+\n+import { providerRegistry } from \"./registry.js\";\n+import { githubProvider } from \"./providers/github.js\";\n+\n+// Register GitHub provider by default\n+providerRegistry.register(githubProvider);\n+\n+// Future: Register GitLab and Bitbucket providers when implemented\n+// providerRegistry.register(gitlabProvider);\n+// providerRegistry.register(bitbucketProvider);\ndiff --git a/packages/shared/src/git-providers/providers/github.ts b/packages/shared/src/git-providers/providers/github.ts\nnew file mode 100644\nindex 000000000..d66b18f32\n--- /dev/null\n+++ b/packages/shared/src/git-providers/providers/github.ts\n@@ -0,0 +1,532 @@\n+/**\n+ * GitHub Provider Implementation\n+ *\n+ * Reference implementation of the GitProvider interface for GitHub.com\n+ * and GitHub Enterprise.\n+ *\n+ * ## Authentication Flow\n+ *\n+ * GitHub uses a multi-step authentication process for GitHub Apps:\n+ * 1. Create a JWT signed with the app's private key\n+ * 2. Exchange JWT for an installation access token\n+ * 3. Use installation token for API calls (scoped to installation)\n+ *\n+ * ## Supported URL Formats\n+ *\n+ * - Simple: owner/repo\n+ * - HTTPS: https://github.com/owner/repo\n+ * - SSH: git@github.com:owner/repo.git\n+ *\n+ * ## Webhook Events\n+ *\n+ * Supports all major GitHub webhook events:\n+ * - installation, installation_repositories\n+ * - push, pull_request\n+ * - workflow_run, workflow_job\n+ * - check_run, check_suite\n+ * - deployment, deployment_status\n+ * - status (commit status)\n+ */\n+\n+import type {\n+  GitProvider,\n+  GitProviderId,\n+  ParsedRepo,\n+  ProviderAppConfig,\n+  ProviderToken,\n+  ProviderRepository,\n+  ProviderPullRequest,\n+  ProviderWebhookEvent,\n+  WebhookEventType,\n+  WebhookRequest,\n+  WebhookVerificationResult,\n+  OwnerType,\n+} from \"../types.js\";\n+import { GitProviderError } from \"../types.js\";\n+\n+const GITHUB_API_BASE = \"https://api.github.com\";\n+\n+/**\n+ * GitHub webhook event to normalized event type mapping.\n+ */\n+const GITHUB_EVENT_MAP: Record<string, WebhookEventType | undefined> = {\n+  installation: \"installation\",\n+  installation_repositories: \"installation_repositories\",\n+  push: \"push\",\n+  pull_request: \"pull_request\",\n+  workflow_run: \"workflow_run\",\n+  workflow_job: \"workflow_job\",\n+  check_run: \"check_run\",\n+  check_suite: \"check_suite\",\n+  deployment: \"deployment\",\n+  deployment_status: \"deployment_status\",\n+  status: \"commit_status\",\n+};\n+\n+/**\n+ * GitHub provider implementation.\n+ */\n+export const githubProvider: GitProvider = {\n+  id: \"github\" as GitProviderId,\n+  displayName: \"GitHub\",\n+  domain: \"github.com\",\n+\n+  // ─────────────────────────────────────────────────────────────────────────────\n+  // URL Parsing\n+  // ─────────────────────────────────────────────────────────────────────────────\n+\n+  parseRepoUrl(input: string): ParsedRepo | null {\n+    if (!input) {\n+      return null;\n+    }\n+\n+    const trimmed = input.trim();\n+\n+    // Try matching against different patterns\n+    // Simple: owner/repo\n+    const simpleMatch = trimmed.match(/^([a-zA-Z0-9_-]+)\\/([a-zA-Z0-9_.-]+)$/);\n+    // HTTPS: https://github.com/owner/repo or https://github.com/owner/repo.git\n+    const httpsMatch = trimmed.match(\n+      /^https?:\\/\\/github\\.com\\/([a-zA-Z0-9_-]+)\\/([a-zA-Z0-9_.-]+?)(?:\\.git)?(?:\\/)?$/i\n+    );\n+    // SSH: git@github.com:owner/repo.git\n+    const sshMatch = trimmed.match(\n+      /^git@github\\.com:([a-zA-Z0-9_-]+)\\/([a-zA-Z0-9_.-]+?)(?:\\.git)?$/i\n+    );\n+\n+    const match = simpleMatch || httpsMatch || sshMatch;\n+    if (!match) {\n+      return null;\n+    }\n+\n+    const [, owner, repo] = match;\n+    if (!owner || !repo) {\n+      return null;\n+    }\n+\n+    const cleanRepo = repo.replace(/\\.git$/, \"\");\n+    return {\n+      owner,\n+      name: cleanRepo,\n+      fullName: `${owner}/${cleanRepo}`,\n+      url: this.buildRepoUrl(owner, cleanRepo),\n+      gitUrl: this.buildGitUrl(owner, cleanRepo),\n+      provider: \"github\",\n+    };\n+  },\n+\n+  buildRepoUrl(owner: string, name: string): string {\n+    return `https://github.com/${owner}/${name}`;\n+  },\n+\n+  buildGitUrl(owner: string, name: string): string {\n+    return `https://github.com/${owner}/${name}.git`;\n+  },\n+\n+  // ─────────────────────────────────────────────────────────────────────────────\n+  // Authentication\n+  // ─────────────────────────────────────────────────────────────────────────────\n+\n+  async createAppToken(config: ProviderAppConfig): Promise<string | null> {\n+    // GitHub App JWT creation\n+    // JWT is signed with the app's private key and has a 10-minute expiry\n+    //\n+    // Implementation note: This requires crypto operations that may need\n+    // to be implemented differently in browser vs Node.js environments.\n+    // The actual JWT signing is done in the consuming code (www, server)\n+    // using their crypto implementations.\n+    //\n+    // The JWT claims are:\n+    // - iss: GitHub App ID\n+    // - iat: Current time - 60 seconds (clock drift buffer)\n+    // - exp: Current time + 10 minutes\n+    // - alg: RS256\n+\n+    // For now, this method documents the pattern but actual implementation\n+    // lives in environment-specific code (www/lib/utils/github-app-token.ts)\n+    throw new GitProviderError(\n+      \"createAppToken should be called on environment-specific implementation\",\n+      \"validation\",\n+      \"github\"\n+    );\n+  },\n+\n+  async fetchInstallationToken(\n+    installationId: string | number,\n+    config: ProviderAppConfig,\n+    permissions?: Record<string, string>\n+  ): Promise<ProviderToken | null> {\n+    // This method creates an installation access token by:\n+    // 1. Creating a JWT using createAppToken\n+    // 2. POSTing to /app/installations/{id}/access_tokens\n+    // 3. Returning the token with expiry info\n+    //\n+    // Implementation note: Like createAppToken, the actual implementation\n+    // lives in environment-specific code that has access to crypto APIs.\n+\n+    throw new GitProviderError(\n+      \"fetchInstallationToken should be called on environment-specific implementation\",\n+      \"validation\",\n+      \"github\"\n+    );\n+  },\n+\n+  // ─────────────────────────────────────────────────────────────────────────────\n+  // Repository Discovery\n+  // ─────────────────────────────────────────────────────────────────────────────\n+\n+  async *listRepositories(\n+    installationId: string | number,\n+    token: string\n+  ): AsyncIterable<ProviderRepository[]> {\n+    // Paginate through installation repositories\n+    // GET /installation/repositories\n+    let page = 1;\n+    const perPage = 100;\n+\n+    while (true) {\n+      const response = await fetch(\n+        `${GITHUB_API_BASE}/installation/repositories?per_page=${perPage}&page=${page}`,\n+        {\n+          headers: {\n+            Authorization: `Bearer ${token}`,\n+            Accept: \"application/vnd.github+json\",\n+            \"X-GitHub-Api-Version\": \"2022-11-28\",\n+          },\n+        }\n+      );\n+\n+      if (!response.ok) {\n+        throw new GitProviderError(\n+          `Failed to list repositories: ${response.status} ${response.statusText}`,\n+          response.status === 401 ? \"authentication\" : \"unknown\",\n+          \"github\"\n+        );\n+      }\n+\n+      const data = (await response.json()) as {\n+        repositories: Array<{\n+          id: number;\n+          full_name: string;\n+          name: string;\n+          owner: {\n+            login: string;\n+            type: string;\n+          };\n+          html_url: string;\n+          private: boolean;\n+          default_branch: string;\n+          pushed_at: string | null;\n+        }>;\n+        total_count: number;\n+      };\n+\n+      if (data.repositories.length === 0) {\n+        break;\n+      }\n+\n+      const repos: ProviderRepository[] = data.repositories.map((repo) => ({\n+        id: repo.id,\n+        fullName: repo.full_name,\n+        owner: repo.owner.login,\n+        ownerType: mapGitHubOwnerType(repo.owner.type),\n+        name: repo.name,\n+        url: repo.html_url,\n+        isPrivate: repo.private,\n+        defaultBranch: repo.default_branch,\n+        lastPushedAt: repo.pushed_at ? new Date(repo.pushed_at).getTime() : undefined,\n+      }));\n+\n+      yield repos;\n+\n+      if (data.repositories.length < perPage) {\n+        break;\n+      }\n+\n+      page++;\n+    }\n+  },\n+\n+  async getRepository(\n+    owner: string,\n+    name: string,\n+    token: string\n+  ): Promise<ProviderRepository | null> {\n+    const response = await fetch(`${GITHUB_API_BASE}/repos/${owner}/${name}`, {\n+      headers: {\n+        Authorization: `Bearer ${token}`,\n+        Accept: \"application/vnd.github+json\",\n+        \"X-GitHub-Api-Version\": \"2022-11-28\",\n+      },\n+    });\n+\n+    if (response.status === 404) {\n+      return null;\n+    }\n+\n+    if (!response.ok) {\n+      throw new GitProviderError(\n+        `Failed to get repository: ${response.status} ${response.statusText}`,\n+        response.status === 401 ? \"authentication\" : \"unknown\",\n+        \"github\"\n+      );\n+    }\n+\n+    const repo = (await response.json()) as {\n+      id: number;\n+      full_name: string;\n+      name: string;\n+      owner: {\n+        login: string;\n+        type: string;\n+      };\n+      html_url: string;\n+      private: boolean;\n+      default_branch: string;\n+      pushed_at: string | null;\n+    };\n+\n+    return {\n+      id: repo.id,\n+      fullName: repo.full_name,\n+      owner: repo.owner.login,\n+      ownerType: mapGitHubOwnerType(repo.owner.type),\n+      name: repo.name,\n+      url: repo.html_url,\n+      isPrivate: repo.private,\n+      defaultBranch: repo.default_branch,\n+      lastPushedAt: repo.pushed_at ? new Date(repo.pushed_at).getTime() : undefined,\n+    };\n+  },\n+\n+  // ─────────────────────────────────────────────────────────────────────────────\n+  // Webhook Handling\n+  // ─────────────────────────────────────────────────────────────────────────────\n+\n+  async verifyWebhookSignature(\n+    request: WebhookRequest,\n+    secret: string\n+  ): Promise<WebhookVerificationResult> {\n+    const signature = request.headers[\"x-hub-signature-256\"];\n+\n+    if (!signature) {\n+      return {\n+        isValid: false,\n+        error: \"Missing x-hub-signature-256 header\",\n+      };\n+    }\n+\n+    // Verify HMAC-SHA256 signature\n+    // signature format: sha256=<hex>\n+    const expectedPrefix = \"sha256=\";\n+    if (!signature.startsWith(expectedPrefix)) {\n+      return {\n+        isValid: false,\n+        error: \"Invalid signature format\",\n+      };\n+    }\n+\n+    const providedSignature = signature.slice(expectedPrefix.length);\n+\n+    // Use crypto.subtle for HMAC-SHA256\n+    const encoder = new TextEncoder();\n+    const keyData = encoder.encode(secret);\n+    const messageData = encoder.encode(request.body);\n+\n+    const key = await crypto.subtle.importKey(\n+      \"raw\",\n+      keyData,\n+      { name: \"HMAC\", hash: \"SHA-256\" },\n+      false,\n+      [\"sign\"]\n+    );\n+\n+    const signatureBuffer = await crypto.subtle.sign(\"HMAC\", key, messageData);\n+    const expectedSignature = Array.from(new Uint8Array(signatureBuffer))\n+      .map((b) => b.toString(16).padStart(2, \"0\"))\n+      .join(\"\");\n+\n+    // Constant-time comparison\n+    if (providedSignature.length !== expectedSignature.length) {\n+      return {\n+        isValid: false,\n+        error: \"Signature mismatch\",\n+      };\n+    }\n+\n+    let mismatch = 0;\n+    for (let i = 0; i < providedSignature.length; i++) {\n+      mismatch |= providedSignature.charCodeAt(i) ^ expectedSignature.charCodeAt(i);\n+    }\n+\n+    if (mismatch !== 0) {\n+      return {\n+        isValid: false,\n+        error: \"Signature mismatch\",\n+      };\n+    }\n+\n+    return { isValid: true };\n+  },\n+\n+  getWebhookEventType(headers: Record<string, string | undefined>): string | null {\n+    return headers[\"x-github-event\"] ?? null;\n+  },\n+\n+  mapWebhookEvent(eventType: string, payload: unknown): ProviderWebhookEvent | null {\n+    const normalizedType = GITHUB_EVENT_MAP[eventType];\n+    if (!normalizedType) {\n+      return null;\n+    }\n+\n+    // Type assertion - we trust the webhook payload structure\n+    const p = payload as Record<string, unknown>;\n+\n+    // Extract common fields\n+    const action = typeof p.action === \"string\" ? p.action : undefined;\n+    const installationId = (p.installation as { id?: number } | undefined)?.id ?? 0;\n+\n+    // Extract repository info if present\n+    const repoPayload = p.repository as {\n+      id?: number;\n+      full_name?: string;\n+      name?: string;\n+      owner?: { login?: string };\n+    } | undefined;\n+\n+    const repository = repoPayload\n+      ? {\n+          id: repoPayload.id ?? 0,\n+          fullName: repoPayload.full_name ?? \"\",\n+          name: repoPayload.name ?? \"\",\n+          owner: repoPayload.owner?.login ?? \"\",\n+        }\n+      : undefined;\n+\n+    return {\n+      type: normalizedType,\n+      action,\n+      provider: \"github\",\n+      installationId,\n+      repository,\n+      deliveryId: undefined, // Set from headers in the handler\n+      rawPayload: payload,\n+    };\n+  },\n+\n+  // ─────────────────────────────────────────────────────────────────────────────\n+  // Pull Request Operations\n+  // ─────────────────────────────────────────────────────────────────────────────\n+\n+  async getPullRequest(\n+    owner: string,\n+    repo: string,\n+    number: number,\n+    token: string\n+  ): Promise<ProviderPullRequest | null> {\n+    const response = await fetch(\n+      `${GITHUB_API_BASE}/repos/${owner}/${repo}/pulls/${number}`,\n+      {\n+        headers: {\n+          Authorization: `Bearer ${token}`,\n+          Accept: \"application/vnd.github+json\",\n+          \"X-GitHub-Api-Version\": \"2022-11-28\",\n+        },\n+      }\n+    );\n+\n+    if (response.status === 404) {\n+      return null;\n+    }\n+\n+    if (!response.ok) {\n+      throw new GitProviderError(\n+        `Failed to get pull request: ${response.status} ${response.statusText}`,\n+        response.status === 401 ? \"authentication\" : \"unknown\",\n+        \"github\"\n+      );\n+    }\n+\n+    const pr = (await response.json()) as {\n+      number: number;\n+      title: string;\n+      state: string;\n+      html_url: string;\n+      head: { ref: string; sha: string };\n+      base: { ref: string };\n+      user: { login: string };\n+      draft: boolean;\n+      created_at: string;\n+      updated_at: string;\n+      merged_at: string | null;\n+    };\n+\n+    return {\n+      number: pr.number,\n+      title: pr.title,\n+      state: mapGitHubPrState(pr.state, pr.merged_at),\n+      url: pr.html_url,\n+      headRef: pr.head.ref,\n+      baseRef: pr.base.ref,\n+      author: pr.user.login,\n+      isDraft: pr.draft,\n+      headSha: pr.head.sha,\n+      createdAt: new Date(pr.created_at).getTime(),\n+      updatedAt: new Date(pr.updated_at).getTime(),\n+      mergedAt: pr.merged_at ? new Date(pr.merged_at).getTime() : undefined,\n+    };\n+  },\n+\n+  async createPullRequestComment(\n+    owner: string,\n+    repo: string,\n+    number: number,\n+    body: string,\n+    token: string\n+  ): Promise<string | number> {\n+    const response = await fetch(\n+      `${GITHUB_API_BASE}/repos/${owner}/${repo}/issues/${number}/comments`,\n+      {\n+        method: \"POST\",\n+        headers: {\n+          Authorization: `Bearer ${token}`,\n+          Accept: \"application/vnd.github+json\",\n+          \"X-GitHub-Api-Version\": \"2022-11-28\",\n+          \"Content-Type\": \"application/json\",\n+        },\n+        body: JSON.stringify({ body }),\n+      }\n+    );\n+\n+    if (!response.ok) {\n+      throw new GitProviderError(\n+        `Failed to create comment: ${response.status} ${response.statusText}`,\n+        response.status === 401 ? \"authentication\" : \"unknown\",\n+        \"github\"\n+      );\n+    }\n+\n+    const comment = (await response.json()) as { id: number };\n+    return comment.id;\n+  },\n+};\n+\n+/**\n+ * Map GitHub owner type to normalized type.\n+ */\n+function mapGitHubOwnerType(type: string): OwnerType {\n+  return type === \"Organization\" ? \"organization\" : \"user\";\n+}\n+\n+/**\n+ * Map GitHub PR state to normalized state.\n+ */\n+function mapGitHubPrState(\n+  state: string,\n+  mergedAt: string | null\n+): \"open\" | \"closed\" | \"merged\" {\n+  if (mergedAt) {\n+    return \"merged\";\n+  }\n+  return state === \"open\" ? \"open\" : \"closed\";\n+}\ndiff --git a/packages/shared/src/git-providers/registry.ts b/packages/shared/src/git-providers/registry.ts\nnew file mode 100644\nindex 000000000..d95d29846\n--- /dev/null\n+++ b/packages/shared/src/git-providers/registry.ts\n@@ -0,0 +1,203 @@\n+/**\n+ * Git Provider Registry\n+ *\n+ * Central registry for managing git provider implementations.\n+ * Uses a singleton pattern to ensure consistent provider access across the application.\n+ *\n+ * ## Usage\n+ *\n+ * ```typescript\n+ * import { providerRegistry } from \"@cmux/shared/git-providers\";\n+ *\n+ * // Get a specific provider\n+ * const github = providerRegistry.get(\"github\");\n+ *\n+ * // Parse a URL and auto-detect provider\n+ * const parsed = providerRegistry.parseRepoUrl(\"https://github.com/owner/repo\");\n+ * // parsed.provider === \"github\"\n+ *\n+ * // List all registered providers\n+ * const providers = providerRegistry.all();\n+ * ```\n+ */\n+\n+import type { GitProvider, GitProviderId, ParsedRepo } from \"./types.js\";\n+\n+/**\n+ * Registry for git provider implementations.\n+ *\n+ * Providers are registered at startup and can be retrieved by ID or\n+ * auto-detected from repository URLs.\n+ */\n+class GitProviderRegistry {\n+  private providers = new Map<GitProviderId, GitProvider>();\n+\n+  /**\n+   * Register a provider implementation.\n+   *\n+   * @param provider - Provider instance to register\n+   * @throws Error if a provider with the same ID is already registered\n+   */\n+  register(provider: GitProvider): void {\n+    if (this.providers.has(provider.id)) {\n+      throw new Error(\n+        `Provider \"${provider.id}\" is already registered. ` +\n+          `Use replace() to update an existing provider.`\n+      );\n+    }\n+    this.providers.set(provider.id, provider);\n+  }\n+\n+  /**\n+   * Replace an existing provider registration.\n+   * Useful for testing or swapping implementations.\n+   *\n+   * @param provider - Provider instance to register\n+   */\n+  replace(provider: GitProvider): void {\n+    this.providers.set(provider.id, provider);\n+  }\n+\n+  /**\n+   * Get a provider by ID.\n+   *\n+   * @param id - Provider identifier\n+   * @returns Provider instance\n+   * @throws Error if provider is not registered\n+   */\n+  get(id: GitProviderId): GitProvider {\n+    const provider = this.providers.get(id);\n+    if (!provider) {\n+      throw new Error(\n+        `Provider \"${id}\" is not registered. ` +\n+          `Available providers: ${Array.from(this.providers.keys()).join(\", \")}`\n+      );\n+    }\n+    return provider;\n+  }\n+\n+  /**\n+   * Get a provider by ID if registered, or undefined if not.\n+   *\n+   * @param id - Provider identifier\n+   * @returns Provider instance or undefined\n+   */\n+  tryGet(id: GitProviderId): GitProvider | undefined {\n+    return this.providers.get(id);\n+  }\n+\n+  /**\n+   * Check if a provider is registered.\n+   *\n+   * @param id - Provider identifier\n+   * @returns True if provider is registered\n+   */\n+  has(id: GitProviderId): boolean {\n+    return this.providers.has(id);\n+  }\n+\n+  /**\n+   * Get all registered providers.\n+   *\n+   * @returns Array of all registered providers\n+   */\n+  all(): GitProvider[] {\n+    return Array.from(this.providers.values());\n+  }\n+\n+  /**\n+   * Get all registered provider IDs.\n+   *\n+   * @returns Array of provider IDs\n+   */\n+  ids(): GitProviderId[] {\n+    return Array.from(this.providers.keys());\n+  }\n+\n+  /**\n+   * Parse a repository URL and auto-detect the provider.\n+   *\n+   * Tries each registered provider in order until one successfully parses the URL.\n+   * Provider order: github, gitlab, bitbucket (by convention)\n+   *\n+   * @param input - Repository URL or identifier\n+   * @returns Parsed repository with provider, or null if no provider matched\n+   */\n+  parseRepoUrl(input: string): ParsedRepo | null {\n+    // Try providers in a deterministic order\n+    const providerOrder: GitProviderId[] = [\"github\", \"gitlab\", \"bitbucket\"];\n+\n+    for (const id of providerOrder) {\n+      const provider = this.providers.get(id);\n+      if (provider) {\n+        const parsed = provider.parseRepoUrl(input);\n+        if (parsed) {\n+          return parsed;\n+        }\n+      }\n+    }\n+\n+    // Try any remaining providers not in the preferred order\n+    for (const [id, provider] of this.providers) {\n+      if (!providerOrder.includes(id)) {\n+        const parsed = provider.parseRepoUrl(input);\n+        if (parsed) {\n+          return parsed;\n+        }\n+      }\n+    }\n+\n+    return null;\n+  }\n+\n+  /**\n+   * Detect which provider a URL belongs to without fully parsing it.\n+   *\n+   * @param input - Repository URL or identifier\n+   * @returns Provider ID if detected, or null\n+   */\n+  detectProvider(input: string): GitProviderId | null {\n+    const parsed = this.parseRepoUrl(input);\n+    return parsed?.provider ?? null;\n+  }\n+\n+  /**\n+   * Get a provider by domain name.\n+   *\n+   * @param domain - Domain to match (e.g., \"github.com\")\n+   * @returns Provider instance or undefined\n+   */\n+  getByDomain(domain: string): GitProvider | undefined {\n+    const normalized = domain.toLowerCase();\n+    for (const provider of this.providers.values()) {\n+      if (provider.domain.toLowerCase() === normalized) {\n+        return provider;\n+      }\n+    }\n+    return undefined;\n+  }\n+\n+  /**\n+   * Clear all registered providers.\n+   * Primarily for testing purposes.\n+   */\n+  clear(): void {\n+    this.providers.clear();\n+  }\n+}\n+\n+/**\n+ * Singleton provider registry instance.\n+ *\n+ * Import and use this instance throughout the application:\n+ *\n+ * ```typescript\n+ * import { providerRegistry } from \"@cmux/shared/git-providers\";\n+ * ```\n+ */\n+export const providerRegistry = new GitProviderRegistry();\n+\n+/**\n+ * Re-export the registry class for testing/extension purposes.\n+ */\n+export { GitProviderRegistry };\ndiff --git a/packages/shared/src/git-providers/types.ts b/packages/shared/src/git-providers/types.ts\nnew file mode 100644\nindex 000000000..86bfdb81e\n--- /dev/null\n+++ b/packages/shared/src/git-providers/types.ts\n@@ -0,0 +1,439 @@\n+/**\n+ * Git Provider Abstraction Layer\n+ *\n+ * This module defines the core interfaces for abstracting git providers\n+ * (GitHub, GitLab, Bitbucket) to enable multi-provider support.\n+ *\n+ * ## Architecture Overview\n+ *\n+ * The abstraction uses a strategy pattern where each provider implements\n+ * the GitProvider interface. A central registry manages provider instances\n+ * and provides factory methods for creating provider-specific clients.\n+ *\n+ * ## Key Design Decisions\n+ *\n+ * 1. **Provider ID as branded type**: Ensures type safety when passing provider IDs\n+ * 2. **Async iterators for pagination**: Natural pattern for paginated API responses\n+ * 3. **Normalized types**: Common types work across all providers while preserving\n+ *    provider-specific metadata in dedicated fields\n+ * 4. **Webhook event mapping**: Providers normalize their events to a common format\n+ * 5. **Pluggable authentication**: Each provider implements its own auth strategy\n+ *\n+ * ## Provider Compatibility Matrix\n+ *\n+ * | Feature           | GitHub    | GitLab    | Bitbucket |\n+ * |-------------------|-----------|-----------|-----------|\n+ * | App Auth          | JWT+Token | OAuth+PAT | OAuth 2.0 |\n+ * | Webhook Signature | HMAC-SHA256| Header   | HMAC-SHA256|\n+ * | Repo ID Type      | number    | number    | slug      |\n+ * | Owner Types       | User/Org  | User/Group| User/Team |\n+ * | PR Name           | Pull Request | Merge Request | Pull Request |\n+ */\n+\n+/**\n+ * Supported git provider identifiers.\n+ *\n+ * - `github`: GitHub.com and GitHub Enterprise\n+ * - `gitlab`: GitLab.com and self-hosted GitLab\n+ * - `bitbucket`: Bitbucket Cloud and Bitbucket Server\n+ */\n+export type GitProviderId = \"github\" | \"gitlab\" | \"bitbucket\";\n+\n+/**\n+ * Owner account types normalized across providers.\n+ *\n+ * GitHub: User | Organization\n+ * GitLab: Individual | Group\n+ * Bitbucket: User | Team\n+ */\n+export type OwnerType = \"user\" | \"organization\";\n+\n+/**\n+ * Parsed repository information normalized across providers.\n+ * All URL formats (HTTPS, SSH, simple) are normalized to this structure.\n+ */\n+export interface ParsedRepo {\n+  /** Repository owner (user or organization) */\n+  owner: string;\n+  /** Repository name */\n+  name: string;\n+  /** Full repository identifier: owner/name */\n+  fullName: string;\n+  /** HTTPS URL to the repository */\n+  url: string;\n+  /** Git clone URL (HTTPS with .git suffix) */\n+  gitUrl: string;\n+  /** Which provider this repository belongs to */\n+  provider: GitProviderId;\n+}\n+\n+/**\n+ * Repository metadata from the provider's API.\n+ * Represents a repository accessible through an installation/connection.\n+ */\n+export interface ProviderRepository {\n+  /** Provider-specific repository ID (number for GitHub/GitLab, slug for Bitbucket) */\n+  id: string | number;\n+  /** Full repository identifier: owner/name */\n+  fullName: string;\n+  /** Repository owner username/login */\n+  owner: string;\n+  /** Owner account type */\n+  ownerType: OwnerType;\n+  /** Repository name */\n+  name: string;\n+  /** HTTPS URL to the repository */\n+  url: string;\n+  /** Whether the repository is private */\n+  isPrivate: boolean;\n+  /** Default branch name (e.g., \"main\", \"master\") */\n+  defaultBranch?: string;\n+  /** Timestamp of last push (Unix milliseconds) */\n+  lastPushedAt?: number;\n+  /** Provider-specific metadata not covered by standard fields */\n+  providerMetadata?: Record<string, unknown>;\n+}\n+\n+/**\n+ * Configuration for provider app/OAuth authentication.\n+ * Structure varies by provider but common fields are extracted here.\n+ */\n+export interface ProviderAppConfig {\n+  /** Application/Client ID */\n+  appId: string;\n+  /** Private key (GitHub), client secret, or similar credential */\n+  privateKeyOrSecret: string;\n+  /** Webhook signature secret for verification */\n+  webhookSecret?: string;\n+  /** Optional API base URL for self-hosted instances */\n+  apiBaseUrl?: string;\n+}\n+\n+/**\n+ * Token with optional metadata about permissions and expiry.\n+ */\n+export interface ProviderToken {\n+  /** The access token string */\n+  token: string;\n+  /** When the token expires (Unix milliseconds) */\n+  expiresAt?: number;\n+  /** Permissions/scopes the token has */\n+  permissions?: Record<string, string>;\n+}\n+\n+/**\n+ * Normalized webhook event types across providers.\n+ *\n+ * Maps provider-specific events to common types:\n+ * - GitHub: installation, push, pull_request, workflow_run, check_run, deployment, status\n+ * - GitLab: push, merge_request, pipeline, job, deployment\n+ * - Bitbucket: push, pullrequest, deployment\n+ */\n+export type WebhookEventType =\n+  | \"installation\"\n+  | \"installation_repositories\"\n+  | \"push\"\n+  | \"pull_request\"\n+  | \"workflow_run\"\n+  | \"workflow_job\"\n+  | \"check_run\"\n+  | \"check_suite\"\n+  | \"deployment\"\n+  | \"deployment_status\"\n+  | \"commit_status\";\n+\n+/**\n+ * Normalized webhook event structure.\n+ * Each provider maps their events to this common format.\n+ */\n+export interface ProviderWebhookEvent {\n+  /** Normalized event type */\n+  type: WebhookEventType;\n+  /** Event action (e.g., \"opened\", \"closed\", \"synchronize\") */\n+  action?: string;\n+  /** Which provider sent this event */\n+  provider: GitProviderId;\n+  /** Installation/connection ID that received this event */\n+  installationId: string | number;\n+  /** Repository information if event is repo-scoped */\n+  repository?: {\n+    fullName: string;\n+    owner: string;\n+    name: string;\n+    id: string | number;\n+  };\n+  /** Unique delivery ID from the provider */\n+  deliveryId?: string;\n+  /** Raw provider-specific payload for access to all fields */\n+  rawPayload: unknown;\n+}\n+\n+/**\n+ * Pull request/merge request normalized across providers.\n+ */\n+export interface ProviderPullRequest {\n+  /** Provider-specific PR/MR number */\n+  number: number;\n+  /** PR title */\n+  title: string;\n+  /** PR state */\n+  state: \"open\" | \"closed\" | \"merged\";\n+  /** URL to the PR */\n+  url: string;\n+  /** Source branch name */\n+  headRef: string;\n+  /** Target branch name */\n+  baseRef: string;\n+  /** Author username */\n+  author: string;\n+  /** Whether this is a draft PR */\n+  isDraft: boolean;\n+  /** Head commit SHA */\n+  headSha: string;\n+  /** When the PR was created (Unix milliseconds) */\n+  createdAt: number;\n+  /** When the PR was last updated (Unix milliseconds) */\n+  updatedAt: number;\n+  /** When the PR was merged, if applicable (Unix milliseconds) */\n+  mergedAt?: number;\n+}\n+\n+/**\n+ * Webhook verification result.\n+ */\n+export interface WebhookVerificationResult {\n+  /** Whether the signature is valid */\n+  isValid: boolean;\n+  /** Error message if verification failed */\n+  error?: string;\n+}\n+\n+/**\n+ * Request context for webhook handling.\n+ */\n+export interface WebhookRequest {\n+  /** Request headers (normalized to lowercase keys) */\n+  headers: Record<string, string | undefined>;\n+  /** Raw request body as string */\n+  body: string;\n+}\n+\n+/**\n+ * Core interface that all git providers must implement.\n+ *\n+ * ## Implementation Notes\n+ *\n+ * - Providers should be stateless - configuration is passed to methods\n+ * - All async operations should handle rate limiting internally\n+ * - Errors should be thrown as typed errors (see GitProviderError)\n+ * - Provider-specific features should be exposed through metadata fields\n+ */\n+export interface GitProvider {\n+  /** Unique provider identifier */\n+  readonly id: GitProviderId;\n+\n+  /** Human-readable provider name */\n+  readonly displayName: string;\n+\n+  /** Domain pattern for URL matching (e.g., \"github.com\") */\n+  readonly domain: string;\n+\n+  // ─────────────────────────────────────────────────────────────────────────────\n+  // URL Parsing\n+  // ─────────────────────────────────────────────────────────────────────────────\n+\n+  /**\n+   * Parse a repository URL/identifier and extract repository information.\n+   *\n+   * Supported formats vary by provider but typically include:\n+   * - Simple: owner/repo\n+   * - HTTPS: https://provider.com/owner/repo\n+   * - SSH: git@provider.com:owner/repo.git\n+   *\n+   * @param input - Repository URL or identifier\n+   * @returns Parsed repository info, or null if not a valid URL for this provider\n+   */\n+  parseRepoUrl(input: string): ParsedRepo | null;\n+\n+  /**\n+   * Construct the canonical HTTPS URL for a repository.\n+   *\n+   * @param owner - Repository owner\n+   * @param name - Repository name\n+   * @returns HTTPS URL to the repository\n+   */\n+  buildRepoUrl(owner: string, name: string): string;\n+\n+  /**\n+   * Construct the git clone URL for a repository.\n+   *\n+   * @param owner - Repository owner\n+   * @param name - Repository name\n+   * @returns Git clone URL (typically HTTPS with .git suffix)\n+   */\n+  buildGitUrl(owner: string, name: string): string;\n+\n+  // ─────────────────────────────────────────────────────────────────────────────\n+  // Authentication\n+  // ─────────────────────────────────────────────────────────────────────────────\n+\n+  /**\n+   * Create an app-level authentication token (e.g., GitHub App JWT).\n+   * Not all providers support this - may return null.\n+   *\n+   * @param config - Provider app configuration\n+   * @returns JWT or app token, or null if not supported\n+   */\n+  createAppToken?(config: ProviderAppConfig): Promise<string | null>;\n+\n+  /**\n+   * Fetch an installation/connection-scoped access token.\n+   *\n+   * @param installationId - Provider-specific installation ID\n+   * @param config - Provider app configuration\n+   * @param permissions - Optional permission scopes to request\n+   * @returns Access token with metadata, or null if failed\n+   */\n+  fetchInstallationToken(\n+    installationId: string | number,\n+    config: ProviderAppConfig,\n+    permissions?: Record<string, string>\n+  ): Promise<ProviderToken | null>;\n+\n+  // ─────────────────────────────────────────────────────────────────────────────\n+  // Repository Discovery\n+  // ─────────────────────────────────────────────────────────────────────────────\n+\n+  /**\n+   * List repositories accessible through an installation.\n+   * Returns an async iterator for efficient pagination handling.\n+   *\n+   * @param installationId - Provider-specific installation ID\n+   * @param token - Access token for API calls\n+   * @yields Batches of repositories as returned by API pagination\n+   */\n+  listRepositories(\n+    installationId: string | number,\n+    token: string\n+  ): AsyncIterable<ProviderRepository[]>;\n+\n+  /**\n+   * Get detailed information about a specific repository.\n+   *\n+   * @param owner - Repository owner\n+   * @param name - Repository name\n+   * @param token - Access token for API calls\n+   * @returns Repository metadata, or null if not found\n+   */\n+  getRepository(\n+    owner: string,\n+    name: string,\n+    token: string\n+  ): Promise<ProviderRepository | null>;\n+\n+  // ─────────────────────────────────────────────────────────────────────────────\n+  // Webhook Handling\n+  // ─────────────────────────────────────────────────────────────────────────────\n+\n+  /**\n+   * Verify a webhook signature is authentic.\n+   *\n+   * @param request - Webhook request with headers and body\n+   * @param secret - Webhook secret for verification\n+   * @returns Verification result with validity and optional error\n+   */\n+  verifyWebhookSignature(\n+    request: WebhookRequest,\n+    secret: string\n+  ): Promise<WebhookVerificationResult>;\n+\n+  /**\n+   * Extract the event type from webhook headers.\n+   *\n+   * @param headers - Request headers (lowercase keys)\n+   * @returns Provider-specific event type string, or null if not found\n+   */\n+  getWebhookEventType(headers: Record<string, string | undefined>): string | null;\n+\n+  /**\n+   * Map a raw webhook payload to the normalized event structure.\n+   *\n+   * @param eventType - Provider-specific event type\n+   * @param payload - Raw webhook payload\n+   * @returns Normalized webhook event, or null if event type is not supported\n+   */\n+  mapWebhookEvent(\n+    eventType: string,\n+    payload: unknown\n+  ): ProviderWebhookEvent | null;\n+\n+  // ─────────────────────────────────────────────────────────────────────────────\n+  // Pull Request Operations (Optional)\n+  // ─────────────────────────────────────────────────────────────────────────────\n+\n+  /**\n+   * Get a pull request by number.\n+   *\n+   * @param owner - Repository owner\n+   * @param repo - Repository name\n+   * @param number - PR number\n+   * @param token - Access token\n+   * @returns Pull request info, or null if not found\n+   */\n+  getPullRequest?(\n+    owner: string,\n+    repo: string,\n+    number: number,\n+    token: string\n+  ): Promise<ProviderPullRequest | null>;\n+\n+  /**\n+   * Create a comment on a pull request.\n+   *\n+   * @param owner - Repository owner\n+   * @param repo - Repository name\n+   * @param number - PR number\n+   * @param body - Comment body (markdown)\n+   * @param token - Access token\n+   * @returns Comment ID\n+   */\n+  createPullRequestComment?(\n+    owner: string,\n+    repo: string,\n+    number: number,\n+    body: string,\n+    token: string\n+  ): Promise<string | number>;\n+}\n+\n+/**\n+ * Error types that can occur during provider operations.\n+ */\n+export type GitProviderErrorType =\n+  | \"authentication\"\n+  | \"not_found\"\n+  | \"rate_limit\"\n+  | \"permission\"\n+  | \"validation\"\n+  | \"network\"\n+  | \"unknown\";\n+\n+/**\n+ * Structured error for git provider operations.\n+ */\n+export class GitProviderError extends Error {\n+  public readonly type: GitProviderErrorType;\n+  public readonly provider: GitProviderId;\n+\n+  constructor(\n+    message: string,\n+    type: GitProviderErrorType,\n+    provider: GitProviderId,\n+    cause?: unknown\n+  ) {\n+    super(message, { cause });\n+    this.name = \"GitProviderError\";\n+    this.type = type;\n+    this.provider = provider;\n+  }\n+}\ndiff --git a/packages/shared/src/utils/parse-github-repo-url.ts b/packages/shared/src/utils/parse-github-repo-url.ts\nindex 6ac53e6ce..cbf4f7479 100644\n--- a/packages/shared/src/utils/parse-github-repo-url.ts\n+++ b/packages/shared/src/utils/parse-github-repo-url.ts\n@@ -1,4 +1,6 @@\n /**\n+ * @deprecated Use `parseRepoUrl` from `@cmux/shared/git-providers` for multi-provider support.\n+ *\n  * Parses a GitHub repository URL and extracts repository information.\n  * Supports multiple formats:\n  * - Simple: owner/repo\n@@ -49,3 +51,30 @@ export function parseGithubRepoUrl(input: string): {\n     gitUrl: `https://github.com/${owner}/${cleanRepo}.git`,\n   };\n }\n+\n+// Re-export types and utilities from git-providers for convenience\n+export type { ParsedRepo, GitProviderId } from \"../git-providers/types.js\";\n+export { providerRegistry } from \"../git-providers/registry.js\";\n+\n+import { providerRegistry } from \"../git-providers/registry.js\";\n+import type { ParsedRepo } from \"../git-providers/types.js\";\n+\n+/**\n+ * Parse a repository URL from any supported provider (GitHub, GitLab, Bitbucket).\n+ * Auto-detects the provider from the URL format.\n+ *\n+ * @param input - Repository URL or identifier\n+ * @returns Parsed repository with provider info, or null if invalid\n+ *\n+ * @example\n+ * ```typescript\n+ * parseRepoUrl(\"https://github.com/owner/repo\")\n+ * // => { provider: \"github\", owner: \"owner\", name: \"repo\", ... }\n+ *\n+ * parseRepoUrl(\"https://gitlab.com/group/project\")\n+ * // => { provider: \"gitlab\", owner: \"group\", name: \"project\", ... }\n+ * ```\n+ */\n+export function parseRepoUrl(input: string): ParsedRepo | null {\n+  return providerRegistry.parseRepoUrl(input);\n+}\n","comments":[{"type":"issue_comment","id":3609809779,"prNumber":1148,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7d9fqyxvprap7ztwa1kbanp57wm0pr?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7d9fqyxvprap7ztwa1kbanp57wm0pr/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1148?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"b2c4f682e6b548b3dd3e8f286ec9c05674309b88","createdAt":"2025-12-04T02:54:55Z","updatedAt":"2025-12-04T02:54:55Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1148#issuecomment-3609809779"}]}
{"number":1147,"title":"Resolve merge-base for screenshot previews","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1147","headRef":"cmux/resolve-merge-base-for-screenshot-previews-9qwic","headSha":"1e5ea8dd127cf2ecc3af255026a6b8c80926d32f","baseRef":"main","baseSha":"70199f97b08bf8a891d4b79d504c7fc96a25a72a","createdAt":"2025-12-04T02:37:50Z","updatedAt":"2025-12-04T03:37:37Z","diff":"diff --git a/apps/worker/src/screenshotCollector/git.ts b/apps/worker/src/screenshotCollector/git.ts\nindex 9466d99ae..e36563d8e 100644\n--- a/apps/worker/src/screenshotCollector/git.ts\n+++ b/apps/worker/src/screenshotCollector/git.ts\n@@ -128,6 +128,40 @@ export async function detectRemoteHead(\n   );\n }\n \n+async function tryFetchBranch(\n+  workspaceDir: string,\n+  branch: string\n+): Promise<boolean> {\n+  // Extract the branch name without origin/ prefix for fetching\n+  const branchName = branch.startsWith(\"origin/\")\n+    ? branch.slice(\"origin/\".length)\n+    : branch.startsWith(\"refs/remotes/origin/\")\n+      ? branch.slice(\"refs/remotes/origin/\".length)\n+      : branch;\n+\n+  try {\n+    await runCommandCapture(\n+      \"git\",\n+      [\"fetch\", \"origin\", branchName, \"--depth=1\"],\n+      { cwd: workspaceDir }\n+    );\n+    return true;\n+  } catch {\n+    return false;\n+  }\n+}\n+\n+async function tryDeepen(workspaceDir: string): Promise<boolean> {\n+  try {\n+    await runCommandCapture(\"git\", [\"fetch\", \"--deepen=100\"], {\n+      cwd: workspaceDir,\n+    });\n+    return true;\n+  } catch {\n+    return false;\n+  }\n+}\n+\n export async function resolveMergeBase(\n   workspaceDir: string,\n   baseBranchOverride?: string | null\n@@ -169,20 +203,71 @@ export async function resolveMergeBase(\n     }\n   }\n \n+  // If no override-based branch was found, try to detect remote HEAD\n   if (!baseBranch) {\n-    baseBranch = await detectRemoteHead(workspaceDir);\n+    try {\n+      baseBranch = await detectRemoteHead(workspaceDir);\n+    } catch {\n+      // Remote HEAD detection failed, try fetching origin/main or origin/master\n+      for (const defaultBranch of [\"origin/main\", \"origin/master\"]) {\n+        const fetched = await tryFetchBranch(workspaceDir, defaultBranch);\n+        if (fetched) {\n+          try {\n+            await runCommandCapture(\n+              \"git\",\n+              [\"rev-parse\", \"--verify\", \"--quiet\", `${defaultBranch}^{}`],\n+              { cwd: workspaceDir }\n+            );\n+            baseBranch = defaultBranch;\n+            break;\n+          } catch {\n+            // Continue to next candidate\n+          }\n+        }\n+      }\n+    }\n+  }\n+\n+  if (!baseBranch) {\n+    throw new Error(\n+      \"Unable to determine base branch: no override provided and remote HEAD detection failed\"\n+    );\n+  }\n+\n+  // Try merge-base, and if it fails, attempt to fetch/deepen and retry\n+  const tryMergeBase = async (): Promise<string | null> => {\n+    try {\n+      const mergeBaseRaw = await runCommandCapture(\n+        \"git\",\n+        [\"merge-base\", \"HEAD\", baseBranch],\n+        { cwd: workspaceDir }\n+      );\n+      return mergeBaseRaw.split(\"\\n\")[0]?.trim() || null;\n+    } catch {\n+      return null;\n+    }\n+  };\n+\n+  let mergeBase = await tryMergeBase();\n+\n+  // If merge-base failed, the base branch ref might be missing or shallow clone\n+  if (!mergeBase) {\n+    // Try fetching the specific branch first\n+    await tryFetchBranch(workspaceDir, baseBranch);\n+    mergeBase = await tryMergeBase();\n+  }\n+\n+  // If still no merge base, try deepening the shallow clone\n+  if (!mergeBase) {\n+    await tryDeepen(workspaceDir);\n+    mergeBase = await tryMergeBase();\n   }\n \n-  const mergeBaseRaw = await runCommandCapture(\n-    \"git\",\n-    [\"merge-base\", \"HEAD\", baseBranch],\n-    { cwd: workspaceDir }\n-  );\n-  const mergeBase = mergeBaseRaw.split(\"\\n\")[0]?.trim();\n   if (!mergeBase) {\n     throw new Error(\n-      `Unable to determine merge base between HEAD and ${baseBranch}`\n+      `Command \"git merge-base HEAD ${baseBranch}\" failed: unable to find common ancestor (possibly shallow clone without shared history)`\n     );\n   }\n+\n   return { baseBranch, mergeBase };\n }\ndiff --git a/packages/shared/src/morph-snapshots.json b/packages/shared/src/morph-snapshots.json\nindex f5cab4299..a598d043b 100644\n--- a/packages/shared/src/morph-snapshots.json\n+++ b/packages/shared/src/morph-snapshots.json\n@@ -1,6 +1,6 @@\n {\n   \"schemaVersion\": 1,\n-  \"updatedAt\": \"2025-12-04T01:41:09Z\",\n+  \"updatedAt\": \"2025-12-04T02:54:46Z\",\n   \"presets\": [\n     {\n       \"presetId\": \"4vcpu_16gb_48gb\",\n@@ -83,6 +83,11 @@\n           \"version\": 15,\n           \"snapshotId\": \"snapshot_6az195xq\",\n           \"capturedAt\": \"2025-12-04T01:41:29Z\"\n+        },\n+        {\n+          \"version\": 16,\n+          \"snapshotId\": \"snapshot_g6va110f\",\n+          \"capturedAt\": \"2025-12-04T02:56:35Z\"\n         }\n       ],\n       \"description\": \"Great default for day-to-day work. Balanced CPU, memory, and storage.\"\n@@ -168,6 +173,11 @@\n           \"version\": 15,\n           \"snapshotId\": \"snapshot_0kz5x004\",\n           \"capturedAt\": \"2025-12-04T01:41:09Z\"\n+        },\n+        {\n+          \"version\": 16,\n+          \"snapshotId\": \"snapshot_9ng3y6jd\",\n+          \"capturedAt\": \"2025-12-04T02:54:46Z\"\n         }\n       ],\n       \"description\": \"Extra headroom for larger codebases or heavier workloads.\"\ndiff --git a/packages/www-openapi-client/src/client/types.gen.ts b/packages/www-openapi-client/src/client/types.gen.ts\nindex e63d671f2..1f7c49bd2 100644\n--- a/packages/www-openapi-client/src/client/types.gen.ts\n+++ b/packages/www-openapi-client/src/client/types.gen.ts\n@@ -384,7 +384,7 @@ export type SetupInstanceBody = {\n     instanceId?: string;\n     selectedRepos?: Array<string>;\n     ttlSeconds?: number;\n-    snapshotId?: string | ('snapshot_hszt8v6s' | 'snapshot_smvgcirt' | 'snapshot_pcmfvjra');\n+    snapshotId?: string | ('snapshot_g6va110f' | 'snapshot_9ng3y6jd' | 'snapshot_pcmfvjra');\n };\n \n export type CreateEnvironmentResponse = {\n","comments":[{"type":"issue_comment","id":3609859360,"prNumber":1147,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn74k56w7gp1rc1tdywtsckk9x7wnwz0?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn74k56w7gp1rc1tdywtsckk9x7wnwz0/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1147?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"1e5ea8dd127cf2ecc3af255026a6b8c80926d32f","createdAt":"2025-12-04T03:14:28Z","updatedAt":"2025-12-04T03:14:28Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1147#issuecomment-3609859360"}]}
{"number":1144,"title":"Add UI screenshot previews for PRs","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1144","headRef":"cmux/add-ui-screenshot-previews-for-prs-vrt7r","headSha":"b0c127467104378fc91a5741b2e14c609ccede20","baseRef":"main","baseSha":"1ef78f2003cedf2a7e58dd6f820256ab5cee3c00","createdAt":"2025-12-04T01:54:04Z","updatedAt":"2025-12-04T02:03:59Z","diff":"diff --git a/apps/www/app/(preview)/preview/page.tsx b/apps/www/app/(preview)/preview/page.tsx\nindex 75a5e823e..5d17d6f79 100644\n--- a/apps/www/app/(preview)/preview/page.tsx\n+++ b/apps/www/app/(preview)/preview/page.tsx\n@@ -1,3 +1,4 @@\n+import type { Metadata } from \"next\";\n import { stackServerApp } from \"@/lib/utils/stack\";\n import { getConvex } from \"@/lib/utils/get-convex\";\n import { api } from \"@cmux/convex/api\";\n@@ -8,6 +9,24 @@ import {\n   type StackTeam,\n } from \"@/lib/team-utils\";\n \n+export const metadata: Metadata = {\n+  title: \"Screenshot previews for GitHub PRs\",\n+  description:\n+    \"Code review agent that takes screenshots of code diffs involving UI changes. Automatically capture and preview visual changes in your pull requests.\",\n+  openGraph: {\n+    title: \"Screenshot previews for GitHub PRs\",\n+    description:\n+      \"Code review agent that takes screenshots of code diffs involving UI changes\",\n+    type: \"website\",\n+  },\n+  twitter: {\n+    card: \"summary_large_image\",\n+    title: \"Screenshot previews for GitHub PRs\",\n+    description:\n+      \"Code review agent that takes screenshots of code diffs involving UI changes\",\n+  },\n+};\n+\n export const dynamic = \"force-dynamic\";\n \n type PageProps = {\n","comments":[{"type":"issue_comment","id":3609630846,"prNumber":1144,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn74cgpzh72t6egetsptk376m97wn96z?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn74cgpzh72t6egetsptk376m97wn96z/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1144?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"b0c127467104378fc91a5741b2e14c609ccede20","createdAt":"2025-12-04T01:57:51Z","updatedAt":"2025-12-04T01:57:51Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1144#issuecomment-3609630846"}]}
{"number":1142,"title":"Make delete-configs modal accessible with no backdrop blur","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1142","headRef":"cmux/make-delete-configs-modal-accessible-with-no-backd-9z5ye","headSha":"cd8be356f3b99dca29a5a1c64e2665b6798af402","baseRef":"main","baseSha":"1ef78f2003cedf2a7e58dd6f820256ab5cee3c00","createdAt":"2025-12-04T01:48:12Z","updatedAt":"2025-12-04T02:36:44Z","diff":"diff --git a/apps/www/components/preview/preview-dashboard.tsx b/apps/www/components/preview/preview-dashboard.tsx\nindex bff053a06..70db13932 100644\n--- a/apps/www/components/preview/preview-dashboard.tsx\n+++ b/apps/www/components/preview/preview-dashboard.tsx\n@@ -26,6 +26,16 @@ import {\n   TooltipProvider,\n   TooltipTrigger,\n } from \"@/components/ui/tooltip-base\";\n+import {\n+  AlertDialog,\n+  AlertDialogAction,\n+  AlertDialogCancel,\n+  AlertDialogContent,\n+  AlertDialogDescription,\n+  AlertDialogFooter,\n+  AlertDialogHeader,\n+  AlertDialogTitle,\n+} from \"@/components/ui/alert-dialog\";\n import { LucideIcon } from \"lucide-react\";\n import { useOAuthPopup } from \"@/hooks/use-oauth-popup\";\n \n@@ -1169,62 +1179,59 @@ function PreviewDashboardInner({\n         </div>\n       </div>\n \n-      {configPendingDelete && (\n-        <div\n-          className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm px-4 py-6\"\n-          onClick={() => {\n-            if (updatingConfigId === configPendingDelete.id) return;\n+      <AlertDialog\n+        open={configPendingDelete !== null}\n+        onOpenChange={(open) => {\n+          if (!open && updatingConfigId !== configPendingDelete?.id) {\n             handleCancelDelete();\n-          }}\n-        >\n-          <div\n-            className=\"w-full max-w-md rounded-lg border border-white/10 bg-neutral-900 px-6 py-5 shadow-2xl\"\n-            onClick={(event) => event.stopPropagation()}\n-          >\n-            <div className=\"flex items-start gap-3\">\n-              <div className=\"rounded-full bg-red-500/10 p-2 text-red-400\">\n-                <Trash2 className=\"h-5 w-5\" />\n-              </div>\n-              <div className=\"flex-1\">\n-                <h3 className=\"text-lg font-semibold text-white\">\n-                  Delete configuration?\n-                </h3>\n-                <p className=\"pt-1 text-sm text-neutral-400\">\n-                  Are you sure you want to remove{\" \"}\n-                  <span className=\"text-white\">\n-                    {configPendingDelete.repoFullName}\n-                  </span>{\" \"}\n-                  from preview.new? This stops screenshot previews for this\n-                  repository.\n-                </p>\n-              </div>\n+          }\n+        }}\n+      >\n+        <AlertDialogContent>\n+          <AlertDialogHeader>\n+            <div className=\"rounded-full bg-red-500/10 p-2 text-red-400\">\n+              <Trash2 className=\"h-5 w-5\" />\n             </div>\n-            {configError && (\n-              <p className=\"pt-3 text-sm text-red-400\">{configError}</p>\n-            )}\n-            <div className=\"pt-5 flex justify-end gap-3\">\n+            <div className=\"flex-1\">\n+              <AlertDialogTitle>Delete configuration?</AlertDialogTitle>\n+              <AlertDialogDescription>\n+                Are you sure you want to remove{\" \"}\n+                <span className=\"text-white\">\n+                  {configPendingDelete?.repoFullName}\n+                </span>{\" \"}\n+                from preview.new? This stops screenshot previews for this\n+                repository.\n+              </AlertDialogDescription>\n+            </div>\n+          </AlertDialogHeader>\n+          {configError && (\n+            <p className=\"pt-3 text-sm text-red-400\">{configError}</p>\n+          )}\n+          <AlertDialogFooter>\n+            <AlertDialogCancel asChild>\n               <Button\n-                onClick={handleCancelDelete}\n-                disabled={updatingConfigId === configPendingDelete.id}\n+                disabled={updatingConfigId === configPendingDelete?.id}\n                 variant=\"secondary\"\n               >\n                 Cancel\n               </Button>\n+            </AlertDialogCancel>\n+            <AlertDialogAction asChild>\n               <Button\n                 onClick={() => void handleDeleteConfig()}\n-                disabled={updatingConfigId === configPendingDelete.id}\n+                disabled={updatingConfigId === configPendingDelete?.id}\n                 variant=\"destructive\"\n               >\n-                {updatingConfigId === configPendingDelete.id ? (\n+                {updatingConfigId === configPendingDelete?.id ? (\n                   <Loader2 className=\"pr-2 h-4 w-4 animate-spin\" />\n                 ) : (\n                   \"Delete\"\n                 )}\n               </Button>\n-            </div>\n-          </div>\n-        </div>\n-      )}\n+            </AlertDialogAction>\n+          </AlertDialogFooter>\n+        </AlertDialogContent>\n+      </AlertDialog>\n     </div>\n   );\n }\ndiff --git a/apps/www/components/ui/alert-dialog.tsx b/apps/www/components/ui/alert-dialog.tsx\nnew file mode 100644\nindex 000000000..f9ec18b42\n--- /dev/null\n+++ b/apps/www/components/ui/alert-dialog.tsx\n@@ -0,0 +1,146 @@\n+import * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\";\n+import type { ComponentProps } from \"react\";\n+\n+import { cn } from \"@/lib/utils\";\n+\n+function AlertDialog(props: ComponentProps<typeof AlertDialogPrimitive.Root>) {\n+  return <AlertDialogPrimitive.Root data-slot=\"alert-dialog\" {...props} />;\n+}\n+\n+function AlertDialogTrigger(\n+  props: ComponentProps<typeof AlertDialogPrimitive.Trigger>\n+) {\n+  return (\n+    <AlertDialogPrimitive.Trigger data-slot=\"alert-dialog-trigger\" {...props} />\n+  );\n+}\n+\n+function AlertDialogPortal(\n+  props: ComponentProps<typeof AlertDialogPrimitive.Portal>\n+) {\n+  return (\n+    <AlertDialogPrimitive.Portal data-slot=\"alert-dialog-portal\" {...props} />\n+  );\n+}\n+\n+function AlertDialogOverlay({\n+  className,\n+  ...props\n+}: ComponentProps<typeof AlertDialogPrimitive.Overlay>) {\n+  return (\n+    <AlertDialogPrimitive.Overlay\n+      data-slot=\"alert-dialog-overlay\"\n+      className={cn(\n+        \"fixed inset-0 z-50 bg-black/60\",\n+        \"data-[state=open]:animate-in data-[state=open]:fade-in-0\",\n+        \"data-[state=closed]:animate-out data-[state=closed]:fade-out-0\",\n+        className\n+      )}\n+      {...props}\n+    />\n+  );\n+}\n+\n+function AlertDialogContent({\n+  className,\n+  ...props\n+}: ComponentProps<typeof AlertDialogPrimitive.Content>) {\n+  return (\n+    <AlertDialogPortal>\n+      <AlertDialogOverlay />\n+      <AlertDialogPrimitive.Content\n+        data-slot=\"alert-dialog-content\"\n+        className={cn(\n+          \"fixed left-1/2 top-1/2 z-50 w-full max-w-md -translate-x-1/2 -translate-y-1/2\",\n+          \"rounded-lg border border-white/10 bg-neutral-900 px-6 py-5 shadow-2xl font-sans\",\n+          \"data-[state=open]:animate-in data-[state=open]:fade-in-0 data-[state=open]:zoom-in-95 data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]\",\n+          \"data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%]\",\n+          className\n+        )}\n+        {...props}\n+      />\n+    </AlertDialogPortal>\n+  );\n+}\n+\n+function AlertDialogHeader({\n+  className,\n+  ...props\n+}: ComponentProps<\"div\">) {\n+  return (\n+    <div\n+      data-slot=\"alert-dialog-header\"\n+      className={cn(\"flex items-start gap-3\", className)}\n+      {...props}\n+    />\n+  );\n+}\n+\n+function AlertDialogFooter({\n+  className,\n+  ...props\n+}: ComponentProps<\"div\">) {\n+  return (\n+    <div\n+      data-slot=\"alert-dialog-footer\"\n+      className={cn(\"flex justify-end gap-3 pt-5\", className)}\n+      {...props}\n+    />\n+  );\n+}\n+\n+function AlertDialogTitle({\n+  className,\n+  ...props\n+}: ComponentProps<typeof AlertDialogPrimitive.Title>) {\n+  return (\n+    <AlertDialogPrimitive.Title\n+      data-slot=\"alert-dialog-title\"\n+      className={cn(\"text-lg font-semibold text-white\", className)}\n+      {...props}\n+    />\n+  );\n+}\n+\n+function AlertDialogDescription({\n+  className,\n+  ...props\n+}: ComponentProps<typeof AlertDialogPrimitive.Description>) {\n+  return (\n+    <AlertDialogPrimitive.Description\n+      data-slot=\"alert-dialog-description\"\n+      className={cn(\"pt-1 text-sm text-neutral-400\", className)}\n+      {...props}\n+    />\n+  );\n+}\n+\n+function AlertDialogAction(\n+  props: ComponentProps<typeof AlertDialogPrimitive.Action>\n+) {\n+  return (\n+    <AlertDialogPrimitive.Action data-slot=\"alert-dialog-action\" {...props} />\n+  );\n+}\n+\n+function AlertDialogCancel(\n+  props: ComponentProps<typeof AlertDialogPrimitive.Cancel>\n+) {\n+  return (\n+    <AlertDialogPrimitive.Cancel data-slot=\"alert-dialog-cancel\" {...props} />\n+  );\n+}\n+\n+export {\n+  AlertDialog,\n+  AlertDialogAction,\n+  AlertDialogCancel,\n+  AlertDialogContent,\n+  AlertDialogDescription,\n+  AlertDialogFooter,\n+  AlertDialogHeader,\n+  AlertDialogOverlay,\n+  AlertDialogPortal,\n+  AlertDialogTitle,\n+  AlertDialogTrigger,\n+};\ndiff --git a/apps/www/package.json b/apps/www/package.json\nindex ff8d86da0..39afe98bd 100644\n--- a/apps/www/package.json\n+++ b/apps/www/package.json\n@@ -32,6 +32,7 @@\n     \"@mantine/hooks\": \"^8.1.3\",\n     \"@octokit/auth-app\": \"^6.1.4\",\n     \"@openai/codex-sdk\": \"^0.46.0\",\n+    \"@radix-ui/react-alert-dialog\": \"^1.1.15\",\n     \"@radix-ui/react-select\": \"^2.2.6\",\n     \"@radix-ui/react-slot\": \"^1.2.3\",\n     \"@radix-ui/react-tooltip\": \"^1.2.8\",\ndiff --git a/bun.lock b/bun.lock\nindex 04966cc2d..27489d149 100644\n--- a/bun.lock\n+++ b/bun.lock\n@@ -323,6 +323,7 @@\n         \"@mantine/hooks\": \"^8.1.3\",\n         \"@octokit/auth-app\": \"^6.1.4\",\n         \"@openai/codex-sdk\": \"^0.46.0\",\n+        \"@radix-ui/react-alert-dialog\": \"^1.1.15\",\n         \"@radix-ui/react-select\": \"^2.2.6\",\n         \"@radix-ui/react-slot\": \"^1.2.3\",\n         \"@radix-ui/react-tooltip\": \"^1.2.8\",\n","comments":[{"type":"issue_comment","id":3609630191,"prNumber":1142,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn76ha0w4dgwbcb74h99s0wh6x7wnvjh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn76ha0w4dgwbcb74h99s0wh6x7wnvjh/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1142?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 10 screenshots for commit `cd8be35` (2025-12-04 01:57:33.994 UTC).\n\n**Close-up view of the configured repositories section showing delete and edit buttons for each repository**\n\n![configured-repositories-section.png](https://famous-camel-162.convex.cloud/api/storage/cac1188d-090c-4993-86e3-a22a73685d1a)\n\n**Delete button with tooltip showing 'Delete configuration' on hover**\n\n![delete-button-tooltip.png](https://famous-camel-162.convex.cloud/api/storage/d3bd7dac-e75a-4f52-b4c4-9d502708b865)\n\n**Isolated screenshot of the delete confirmation modal element showing the accessible AlertDialog component**\n\n![delete-confirmation-modal-element.png](https://famous-camel-162.convex.cloud/api/storage/81310ef5-6868-488a-a73c-2eca1857301f)\n\n**Delete confirmation modal open for manaflow-ai/cmux repository - full page screenshot showing modal with backdrop**\n\n![delete-confirmation-modal-open-full-page.png](https://famous-camel-162.convex.cloud/api/storage/f3a4d7f5-544c-428a-9eb6-0c34b5f53435)\n\n**Delete confirmation modal open for manaflow-ai/cmux repository - viewport screenshot**\n\n![delete-confirmation-modal-open.png](https://famous-camel-162.convex.cloud/api/storage/5ae4ca94-f597-4c3b-ac2b-5fcd87b689b3)\n\n**Delete modal with Cancel button in hover state**\n\n![delete-modal-cancel-button-hover.png](https://famous-camel-162.convex.cloud/api/storage/01aa14bd-ed32-4bed-b568-be4731bd8b61)\n\n**Delete modal with Delete button in hover state showing destructive styling**\n\n![delete-modal-delete-button-hover.png](https://famous-camel-162.convex.cloud/api/storage/3ac07d5d-8bba-4eaa-afd5-449c01040b6a)\n\n**Isolated screenshot of delete modal for second repository**\n\n![delete-modal-second-repository-element.png](https://famous-camel-162.convex.cloud/api/storage/317b8fe8-8dd3-42a3-8155-2bb9e5256973)\n\n**Delete confirmation modal open for austinywang/landing repository - demonstrating dynamic content**\n\n![delete-modal-second-repository.png](https://famous-camel-162.convex.cloud/api/storage/7d364a3e-cef1-4f13-b7b1-a5a305cc9828)\n\n**Full page view of the preview dashboard showing the main interface with configured repositories**\n\n![preview-dashboard-main-view.png](https://famous-camel-162.convex.cloud/api/storage/8ed8f3d1-ed70-4af8-897d-74115cb54124)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"cd8be356f3b99dca29a5a1c64e2665b6798af402","createdAt":"2025-12-04T01:57:36Z","updatedAt":"2025-12-04T02:15:14Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1142#issuecomment-3609630191"},{"type":"issue_comment","id":3609689642,"prNumber":1142,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn7d947jewy771c3rmrz6t2n0h7wmcny?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn7d947jewy771c3rmrz6t2n0h7wmcny/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1142?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 2 screenshots for commit `cd8be35` (2025-12-04 02:15:13.049 UTC).\n\n**Delete configuration modal using the new accessible AlertDialog component with semi-transparent backdrop, centered dialog, confirmation message, and Cancel/Delete action buttons**\n\n![delete-modal-full-view.png](https://adorable-wombat-701.convex.cloud/api/storage/2994f5cf-9fe6-4908-ab35-f1880a6f4ece)\n\n**Preview dashboard showing the configured repositories section with edit and delete action buttons**\n\n![preview-dashboard-viewport.png](https://adorable-wombat-701.convex.cloud/api/storage/3b2a16ea-5edb-4d93-80c6-a6a78fdc5005)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"cd8be356f3b99dca29a5a1c64e2665b6798af402","createdAt":"2025-12-04T02:15:13Z","updatedAt":"2025-12-04T02:15:13Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1142#issuecomment-3609689642"}]}
{"number":1140,"title":"fix: use unique id as React key for provider connections","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1140","headRef":"fix/provider-connection-duplicate-key","headSha":"cfbe57a4de88a0c1a7934625579d2294bd40f7fe","baseRef":"main","baseSha":"a0935e35e3971f501feab4783ff34314c64b38a7","createdAt":"2025-12-04T00:24:51Z","updatedAt":"2025-12-04T00:30:24Z","diff":"diff --git a/apps/www/app/(preview)/preview/page.tsx b/apps/www/app/(preview)/preview/page.tsx\nindex 2b6ebd89e..75a5e823e 100644\n--- a/apps/www/app/(preview)/preview/page.tsx\n+++ b/apps/www/app/(preview)/preview/page.tsx\n@@ -33,6 +33,7 @@ type TeamOption = {\n \n function serializeProviderConnections(\n   connections: Array<{\n+    id: string;\n     installationId: number;\n     accountLogin: string | null | undefined;\n     accountType: string | null | undefined;\n@@ -40,6 +41,7 @@ function serializeProviderConnections(\n   }>\n ) {\n   return connections.map((conn) => ({\n+    id: conn.id,\n     installationId: conn.installationId,\n     accountLogin: conn.accountLogin ?? null,\n     accountType: conn.accountType ?? null,\ndiff --git a/apps/www/components/preview/preview-dashboard.tsx b/apps/www/components/preview/preview-dashboard.tsx\nindex da07882c9..bff053a06 100644\n--- a/apps/www/components/preview/preview-dashboard.tsx\n+++ b/apps/www/components/preview/preview-dashboard.tsx\n@@ -30,6 +30,7 @@ import { LucideIcon } from \"lucide-react\";\n import { useOAuthPopup } from \"@/hooks/use-oauth-popup\";\n \n type ProviderConnection = {\n+  id: string;\n   installationId: number;\n   accountLogin: string | null;\n   accountType: string | null;\n@@ -800,7 +801,7 @@ function PreviewDashboardInner({\n             className=\"h-10 appearance-none bg-transparent py-2 pl-11 pr-8 text-sm text-white focus:outline-none disabled:cursor-not-allowed disabled:opacity-50\"\n           >\n             {activeConnections.map((conn) => (\n-              <option key={conn.installationId} value={conn.installationId}>\n+              <option key={conn.id} value={conn.installationId}>\n                 {conn.accountLogin || `ID: ${conn.installationId}`}\n               </option>\n             ))}\ndiff --git a/packages/convex/convex/github.ts b/packages/convex/convex/github.ts\nindex dd61aebc9..209e9dd18 100644\n--- a/packages/convex/convex/github.ts\n+++ b/packages/convex/convex/github.ts\n@@ -179,6 +179,7 @@ export const listProviderConnections = authQuery({\n       .withIndex(\"by_team\", (q) => q.eq(\"teamId\", teamId))\n       .collect();\n     return rows.map((r) => ({\n+      id: r._id,\n       installationId: r.installationId,\n       accountLogin: r.accountLogin,\n       accountType: r.accountType,\n","comments":[{"type":"issue_comment","id":3609396803,"prNumber":1140,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn79bz465f9amj7g02q7s7vnq57wnwb1?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn79bz465f9amj7g02q7s7vnq57wnwb1/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1140?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 5 screenshots for commit `cfbe57a` (2025-12-04 00:30:23.773 UTC).\n\n**Full page view of preview dashboard in authenticated state showing the new SVG gradient background and 'No connected repositories' section**\n\n![preview-dashboard-authenticated-no-repos.png](https://adorable-wombat-701.convex.cloud/api/storage/c44b1163-bef6-4ca4-8012-03ed64f68104)\n\n**Bottom section showing 'Configured repositories' and 'From the creators of' sections with cmux branding**\n\n![preview-dashboard-configured-repos-section.png](https://adorable-wombat-701.convex.cloud/api/storage/eb8ce832-db48-4219-99e0-9439a0cfce74)\n\n**Header section showing the page title, description, and Git repository URL input field with the new gradient background**\n\n![preview-dashboard-header-section.png](https://adorable-wombat-701.convex.cloud/api/storage/c0d17637-f182-4871-b72c-7f79b4cc9b06)\n\n**Full page view highlighting the updated SVG radial gradient background that replaced the CSS gradient**\n\n![preview-dashboard-new-gradient-background.png](https://adorable-wombat-701.convex.cloud/api/storage/337927df-ed5c-4bd1-b1e1-53809ff2e43d)\n\n**Close-up view of the 'Choose a repository' section with team selector and 'No connected repositories' state showing the 'Add repositories' button**\n\n![preview-dashboard-no-connected-repos.png](https://adorable-wombat-701.convex.cloud/api/storage/1601ab0f-73e5-4d1a-b24f-97c7ae8ae111)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"cfbe57a4de88a0c1a7934625579d2294bd40f7fe","createdAt":"2025-12-04T00:30:24Z","updatedAt":"2025-12-04T00:30:24Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1140#issuecomment-3609396803"}]}
{"number":1139,"title":"Revert \"Revert \"make preview tasks visible to team members\"\"","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1139","headRef":"revert-1138-revert-1134-cmux/make-preview-tasks-visible-to-team-members-iaajr","headSha":"97acf497924e76495ea6653ef740da4031996cf9","baseRef":"main","baseSha":"50ca29d595ca0467b99056cad6829521b502089d","createdAt":"2025-12-04T00:04:39Z","updatedAt":"2025-12-04T00:08:51Z","diff":"diff --git a/packages/convex/convex/taskRunLogChunks.ts b/packages/convex/convex/taskRunLogChunks.ts\nindex 0696b310e..cf545b0b2 100644\n--- a/packages/convex/convex/taskRunLogChunks.ts\n+++ b/packages/convex/convex/taskRunLogChunks.ts\n@@ -43,11 +43,25 @@ export const getChunks = authQuery({\n   handler: async (ctx, args) => {\n     const userId = ctx.identity.subject;\n     const teamId = await getTeamId(ctx, args.teamSlugOrId);\n+\n+    // Check if this is a preview task - if so, allow team-wide access\n+    const taskRun = await ctx.db.get(args.taskRunId);\n+    if (!taskRun || taskRun.teamId !== teamId) {\n+      return [];\n+    }\n+\n+    const task = await ctx.db.get(taskRun.taskId);\n+    const isPreviewTask = task?.isPreview === true;\n+\n+    // For preview tasks, only require team membership; otherwise require user ownership\n+    if (!isPreviewTask && taskRun.userId !== userId) {\n+      return [];\n+    }\n+\n     const chunks = await ctx.db\n       .query(\"taskRunLogChunks\")\n       .withIndex(\"by_taskRun\", (q) => q.eq(\"taskRunId\", args.taskRunId))\n       .filter((q) => q.eq(q.field(\"teamId\"), teamId))\n-      .filter((q) => q.eq(q.field(\"userId\"), userId))\n       .collect();\n \n     return chunks;\ndiff --git a/packages/convex/convex/taskRuns.ts b/packages/convex/convex/taskRuns.ts\nindex 6c27ab94f..8891b8a7d 100644\n--- a/packages/convex/convex/taskRuns.ts\n+++ b/packages/convex/convex/taskRuns.ts\n@@ -617,9 +617,19 @@ export const subscribe = authQuery({\n     const userId = ctx.identity.subject;\n     const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n     const doc = await ctx.db.get(args.id);\n-    if (!doc || doc.teamId !== teamId || doc.userId !== userId) {\n+    if (!doc || doc.teamId !== teamId) {\n       return null;\n     }\n+\n+    // Check if this is a preview task - if so, allow team-wide access\n+    const task = await ctx.db.get(doc.taskId);\n+    const isPreviewTask = task?.isPreview === true;\n+\n+    // For preview tasks, only require team membership; otherwise require user ownership\n+    if (!isPreviewTask && doc.userId !== userId) {\n+      return null;\n+    }\n+\n     // Rewrite morph URLs in networking field\n     if (doc.networking) {\n       return {\n","comments":[{"type":"issue_comment","id":3609350715,"prNumber":1139,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn79w4db6d52zgc6fn4s5xqnyd7wn1zv?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn79w4db6d52zgc6fn4s5xqnyd7wn1zv/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1139?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"97acf497924e76495ea6653ef740da4031996cf9","createdAt":"2025-12-04T00:08:51Z","updatedAt":"2025-12-04T00:08:51Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1139#issuecomment-3609350715"}]}
{"number":1136,"title":"Collapse duplicate previews, surface latest in PR UI","state":"open","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1136","headRef":"cmux/collapse-duplicate-previews-surface-latest-in-pr-u-in8pr","headSha":"e0843f082e791bd88d9f72d57f30d1472f73c5f6","baseRef":"main","baseSha":"755a167b5171c7af7e1dd67408f15a911864984b","createdAt":"2025-12-03T21:23:15Z","updatedAt":"2025-12-04T07:22:34Z","diff":"diff --git a/apps/client/src/components/RunScreenshotGallery.tsx b/apps/client/src/components/RunScreenshotGallery.tsx\nindex 95a0b3419..aee4a4966 100644\n--- a/apps/client/src/components/RunScreenshotGallery.tsx\n+++ b/apps/client/src/components/RunScreenshotGallery.tsx\n@@ -9,6 +9,7 @@ import {\n import { formatDistanceToNow } from \"date-fns\";\n import * as Dialog from \"@radix-ui/react-dialog\";\n import {\n+  ChevronDown,\n   ChevronLeft,\n   ChevronRight,\n   Maximize2,\n@@ -217,10 +218,6 @@ export function RunScreenshotGallery(props: RunScreenshotGalleryProps) {\n       ? currentEntry.globalIndex + 1\n       : null;\n \n-  const effectiveHighlight =\n-    highlightedSetId ??\n-    sortedScreenshotSets[sortedScreenshotSets.length - 1]?._id ?? null;\n-\n   useEffect(() => {\n     if (activeImageKey === null) {\n       return;\n@@ -603,119 +600,240 @@ export function RunScreenshotGallery(props: RunScreenshotGalleryProps) {\n             </Dialog.Portal>\n           </Dialog.Root>\n         ) : null}\n-        {sortedScreenshotSets.map((set) => {\n-          const capturedAtDate = new Date(set.capturedAt);\n-          const relativeCapturedAt = formatDistanceToNow(capturedAtDate, {\n-            addSuffix: true,\n-          });\n-          const shortCommit = set.commitSha?.slice(0, 12);\n-          const isHighlighted = effectiveHighlight === set._id;\n-\n+        {/* Render the most recent (latest) set prominently */}\n+        {(() => {\n+          const latestSet = sortedScreenshotSets[sortedScreenshotSets.length - 1];\n+          const isLatestHighlighted =\n+            !highlightedSetId || highlightedSetId === latestSet._id;\n           return (\n-            <article\n-              key={set._id}\n-              className={cn(\n-                \"rounded-xl border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950/70 p-3 transition-shadow\",\n-                isHighlighted &&\n-                \"border-emerald-400/70 dark:border-emerald-400/60 shadow-[0_0_0_1px_rgba(16,185,129,0.25)]\"\n-              )}\n-            >\n-              <div className=\"flex flex-wrap items-center gap-2\">\n-                <span\n+            <ScreenshotSetCard\n+              set={latestSet}\n+              isHighlighted={isLatestHighlighted}\n+              globalIndexByKey={globalIndexByKey}\n+              activeImageKey={activeImageKey}\n+              setActiveImageKey={setActiveImageKey}\n+            />\n+          );\n+        })()}\n+\n+        {/* Older sets in a collapsible section */}\n+        {sortedScreenshotSets.length > 1 && (\n+          <OlderScreenshotSets\n+            sets={sortedScreenshotSets.slice(0, -1).reverse()}\n+            globalIndexByKey={globalIndexByKey}\n+            activeImageKey={activeImageKey}\n+            setActiveImageKey={setActiveImageKey}\n+            highlightedSetId={highlightedSetId}\n+          />\n+        )}\n+      </div>\n+    </section>\n+  );\n+}\n+\n+interface ScreenshotSetCardProps {\n+  set: RunScreenshotSet;\n+  isHighlighted: boolean;\n+  globalIndexByKey: Map<string, number>;\n+  activeImageKey: string | null;\n+  setActiveImageKey: (key: string | null) => void;\n+  compact?: boolean;\n+}\n+\n+function ScreenshotSetCard({\n+  set,\n+  isHighlighted,\n+  globalIndexByKey,\n+  activeImageKey,\n+  setActiveImageKey,\n+  compact = false,\n+}: ScreenshotSetCardProps) {\n+  const capturedAtDate = new Date(set.capturedAt);\n+  const relativeCapturedAt = formatDistanceToNow(capturedAtDate, {\n+    addSuffix: true,\n+  });\n+  const shortCommit = set.commitSha?.slice(0, 12);\n+\n+  return (\n+    <article\n+      className={cn(\n+        \"rounded-xl border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950/70 p-3 transition-shadow\",\n+        isHighlighted &&\n+          \"border-emerald-400/70 dark:border-emerald-400/60 shadow-[0_0_0_1px_rgba(16,185,129,0.25)]\"\n+      )}\n+    >\n+      <div className=\"flex flex-wrap items-center gap-2\">\n+        <span\n+          className={cn(\n+            \"px-2 py-0.5 text-xs font-medium rounded-full\",\n+            STATUS_STYLES[set.status]\n+          )}\n+        >\n+          {STATUS_LABELS[set.status]}\n+        </span>\n+        {isHighlighted && (\n+          <span className=\"px-2 py-0.5 text-xs font-medium rounded-full bg-emerald-100/80 text-emerald-700 dark:bg-emerald-900/60 dark:text-emerald-300\">\n+            Latest\n+          </span>\n+        )}\n+        <span\n+          className=\"text-xs text-neutral-600 dark:text-neutral-400\"\n+          title={capturedAtDate.toLocaleString()}\n+        >\n+          {relativeCapturedAt}\n+        </span>\n+        {shortCommit && (\n+          <span className=\"text-xs font-mono text-neutral-600 dark:text-neutral-400\">\n+            {shortCommit.toLowerCase()}\n+          </span>\n+        )}\n+        {set.images.length > 0 && (\n+          <span className=\"text-xs text-neutral-500 dark:text-neutral-500\">\n+            {set.images.length} {set.images.length === 1 ? \"image\" : \"images\"}\n+          </span>\n+        )}\n+      </div>\n+      {set.error && (\n+        <p className=\"mt-2 text-xs text-rose-600 dark:text-rose-400\">\n+          {set.error}\n+        </p>\n+      )}\n+      {set.images.length > 0 ? (\n+        <div\n+          className={cn(\n+            \"mt-3 flex gap-3 overflow-x-auto pb-1\",\n+            compact && \"gap-2\"\n+          )}\n+        >\n+          {set.images.map((image, indexInSet) => {\n+            const displayName = image.fileName ?? \"Screenshot\";\n+            const stableKey = getImageKey(set._id, image, indexInSet);\n+            if (!image.url) {\n+              return (\n+                <div\n+                  key={stableKey}\n                   className={cn(\n-                    \"px-2 py-0.5 text-xs font-medium rounded-full\",\n-                    STATUS_STYLES[set.status]\n+                    \"flex items-center justify-center rounded-lg border border-dashed border-neutral-300 bg-neutral-100 text-xs text-neutral-500 dark:border-neutral-700 dark:bg-neutral-900 dark:text-neutral-400\",\n+                    compact ? \"h-32 min-w-[140px]\" : \"h-48 min-w-[200px]\"\n                   )}\n                 >\n-                  {STATUS_LABELS[set.status]}\n-                </span>\n-                {isHighlighted && (\n-                  <span className=\"px-2 py-0.5 text-xs font-medium rounded-full bg-emerald-100/80 text-emerald-700 dark:bg-emerald-900/60 dark:text-emerald-300\">\n-                    Latest\n-                  </span>\n-                )}\n-                <span\n-                  className=\"text-xs text-neutral-600 dark:text-neutral-400\"\n-                  title={capturedAtDate.toLocaleString()}\n-                >\n-                  {relativeCapturedAt}\n-                </span>\n-                {shortCommit && (\n-                  <span className=\"text-xs font-mono text-neutral-600 dark:text-neutral-400\">\n-                    {shortCommit.toLowerCase()}\n-                  </span>\n-                )}\n-                {set.images.length > 0 && (\n-                  <span className=\"text-xs text-neutral-500 dark:text-neutral-500\">\n-                    {set.images.length}{\" \"}\n-                    {set.images.length === 1 ? \"image\" : \"images\"}\n-                  </span>\n+                  URL expired\n+                </div>\n+              );\n+            }\n+            const flatIndex = globalIndexByKey.get(stableKey) ?? null;\n+            const humanIndex = flatIndex !== null ? flatIndex + 1 : null;\n+            const isActive = activeImageKey === stableKey;\n+\n+            return (\n+              <button\n+                key={stableKey}\n+                type=\"button\"\n+                onClick={() => setActiveImageKey(stableKey)}\n+                className={cn(\n+                  \"group relative flex flex-col overflow-hidden rounded-lg border border-neutral-200 bg-neutral-50 text-left transition-colors hover:border-neutral-400 dark:border-neutral-700 dark:bg-neutral-900/70 dark:hover:border-neutral-500\",\n+                  compact ? \"w-[160px]\" : \"w-[220px]\",\n+                  isActive &&\n+                    \"border-emerald-400/70 shadow-[0_0_0_1px_rgba(16,185,129,0.25)] dark:border-emerald-400/60\"\n                 )}\n-              </div>\n-              {set.error && (\n-                <p className=\"mt-2 text-xs text-rose-600 dark:text-rose-400\">\n-                  {set.error}\n-                </p>\n-              )}\n-              {set.images.length > 0 ? (\n-                <div className=\"mt-3 flex gap-3 overflow-x-auto pb-1\">\n-                  {set.images.map((image, indexInSet) => {\n-                    const displayName = image.fileName ?? \"Screenshot\";\n-                    const stableKey = getImageKey(set._id, image, indexInSet);\n-                    if (!image.url) {\n-                      return (\n-                        <div\n-                          key={stableKey}\n-                          className=\"flex h-48 min-w-[200px] items-center justify-center rounded-lg border border-dashed border-neutral-300 bg-neutral-100 text-xs text-neutral-500 dark:border-neutral-700 dark:bg-neutral-900 dark:text-neutral-400\"\n-                        >\n-                          URL expired\n-                        </div>\n-                      );\n-                    }\n-                    const flatIndex = globalIndexByKey.get(stableKey) ?? null;\n-                    const humanIndex = flatIndex !== null ? flatIndex + 1 : null;\n-                    const isActive = activeImageKey === stableKey;\n-\n-                    return (\n-                      <button\n-                        key={stableKey}\n-                        type=\"button\"\n-                        onClick={() => setActiveImageKey(stableKey)}\n-                        className={cn(\n-                          \"group relative flex w-[220px] flex-col overflow-hidden rounded-lg border border-neutral-200 bg-neutral-50 text-left transition-colors hover:border-neutral-400 dark:border-neutral-700 dark:bg-neutral-900/70 dark:hover:border-neutral-500\",\n-                          isActive &&\n-                          \"border-emerald-400/70 shadow-[0_0_0_1px_rgba(16,185,129,0.25)] dark:border-emerald-400/60\",\n-                        )}\n-                        aria-label={`Open ${displayName} in slideshow`}\n-                      >\n-                        <img\n-                          src={image.url}\n-                          alt={displayName}\n-                          className=\"h-48 w-[220px] object-contain bg-neutral-100 dark:bg-neutral-950\"\n-                          loading=\"lazy\"\n-                        />\n-                        <div className=\"absolute top-2 right-2 text-neutral-600 opacity-0 transition group-hover:opacity-100 dark:text-neutral-300\">\n-                          <Maximize2 className=\"h-3.5 w-3.5\" />\n-                        </div>\n-                        <div className=\"border-t border-neutral-200 px-2 py-1 text-xs text-neutral-600 dark:border-neutral-700 dark:text-neutral-300 truncate\">\n-                          {humanIndex !== null ? `${humanIndex}. ` : \"\"}\n-                          {displayName}\n-                        </div>\n-                      </button>\n-                    );\n-                  })}\n+                aria-label={`Open ${displayName} in slideshow`}\n+              >\n+                <img\n+                  src={image.url}\n+                  alt={displayName}\n+                  className={cn(\n+                    \"object-contain bg-neutral-100 dark:bg-neutral-950\",\n+                    compact ? \"h-32 w-[160px]\" : \"h-48 w-[220px]\"\n+                  )}\n+                  loading=\"lazy\"\n+                />\n+                <div className=\"absolute top-2 right-2 text-neutral-600 opacity-0 transition group-hover:opacity-100 dark:text-neutral-300\">\n+                  <Maximize2 className=\"h-3.5 w-3.5\" />\n                 </div>\n-              ) : (\n-                <p className=\"mt-2 text-xs text-neutral-500 dark:text-neutral-400\">\n-                  {set.status === \"failed\"\n-                    ? \"Screenshot capture failed before any images were saved.\"\n-                    : \"No screenshots were captured for this attempt.\"}\n-                </p>\n-              )}\n-            </article>\n-          );\n-        })}\n-      </div>\n-    </section>\n+                <div className=\"border-t border-neutral-200 px-2 py-1 text-xs text-neutral-600 dark:border-neutral-700 dark:text-neutral-300 truncate\">\n+                  {humanIndex !== null ? `${humanIndex}. ` : \"\"}\n+                  {displayName}\n+                </div>\n+              </button>\n+            );\n+          })}\n+        </div>\n+      ) : (\n+        <p className=\"mt-2 text-xs text-neutral-500 dark:text-neutral-400\">\n+          {set.status === \"failed\"\n+            ? \"Screenshot capture failed before any images were saved.\"\n+            : \"No screenshots were captured for this attempt.\"}\n+        </p>\n+      )}\n+    </article>\n+  );\n+}\n+\n+interface OlderScreenshotSetsProps {\n+  sets: RunScreenshotSet[];\n+  globalIndexByKey: Map<string, number>;\n+  activeImageKey: string | null;\n+  setActiveImageKey: (key: string | null) => void;\n+  highlightedSetId?: Id<\"taskRunScreenshotSets\"> | null;\n+}\n+\n+function OlderScreenshotSets({\n+  sets,\n+  globalIndexByKey,\n+  activeImageKey,\n+  setActiveImageKey,\n+  highlightedSetId,\n+}: OlderScreenshotSetsProps) {\n+  const [isExpanded, setIsExpanded] = useState(false);\n+\n+  if (sets.length === 0) return null;\n+\n+  const totalImages = sets.reduce((acc, set) => acc + set.images.length, 0);\n+\n+  return (\n+    <div className=\"rounded-xl border border-neutral-200 dark:border-neutral-800 bg-neutral-50/50 dark:bg-neutral-900/30 overflow-hidden\">\n+      <button\n+        type=\"button\"\n+        onClick={() => setIsExpanded(!isExpanded)}\n+        className=\"w-full flex items-center justify-between gap-3 px-3 py-2.5 text-left hover:bg-neutral-100/60 dark:hover:bg-neutral-800/40 transition-colors\"\n+      >\n+        <div className=\"flex items-center gap-2\">\n+          <ChevronDown\n+            className={cn(\n+              \"w-4 h-4 text-neutral-500 transition-transform\",\n+              isExpanded && \"rotate-180\"\n+            )}\n+          />\n+          <span className=\"text-sm font-medium text-neutral-700 dark:text-neutral-300\">\n+            {sets.length} older {sets.length === 1 ? \"capture\" : \"captures\"}\n+          </span>\n+          {totalImages > 0 && (\n+            <span className=\"text-xs text-neutral-500 dark:text-neutral-500\">\n+              ({totalImages} {totalImages === 1 ? \"image\" : \"images\"})\n+            </span>\n+          )}\n+        </div>\n+        <span className=\"text-xs text-neutral-500 dark:text-neutral-500\">\n+          {isExpanded ? \"Hide\" : \"Show\"}\n+        </span>\n+      </button>\n+\n+      {isExpanded && (\n+        <div className=\"px-3 pb-3 space-y-3 border-t border-neutral-200 dark:border-neutral-800\">\n+          <div className=\"pt-3\" />\n+          {sets.map((set) => (\n+            <ScreenshotSetCard\n+              key={set._id}\n+              set={set}\n+              isHighlighted={highlightedSetId === set._id}\n+              globalIndexByKey={globalIndexByKey}\n+              activeImageKey={activeImageKey}\n+              setActiveImageKey={setActiveImageKey}\n+              compact\n+            />\n+          ))}\n+        </div>\n+      )}\n+    </div>\n   );\n }\ndiff --git a/apps/client/src/components/sidebar/SidebarPRPreviewRuns.tsx b/apps/client/src/components/sidebar/SidebarPRPreviewRuns.tsx\nnew file mode 100644\nindex 000000000..0fee3660d\n--- /dev/null\n+++ b/apps/client/src/components/sidebar/SidebarPRPreviewRuns.tsx\n@@ -0,0 +1,169 @@\n+import { api } from \"@cmux/convex/api\";\n+import type { Id } from \"@cmux/convex/dataModel\";\n+import { Link } from \"@tanstack/react-router\";\n+import { useQuery } from \"convex/react\";\n+import { formatDistanceToNow } from \"date-fns\";\n+import {\n+  Camera,\n+  CheckCircle,\n+  Circle,\n+  Loader2,\n+  XCircle,\n+} from \"lucide-react\";\n+import { useMemo } from \"react\";\n+\n+type Props = {\n+  teamSlugOrId: string;\n+  repoFullName: string;\n+  prNumber: number;\n+};\n+\n+type PreviewRunStatus = \"pending\" | \"running\" | \"completed\" | \"failed\" | \"skipped\";\n+\n+function getStatusIcon(status: PreviewRunStatus) {\n+  switch (status) {\n+    case \"pending\":\n+      return <Circle className=\"w-3 h-3 text-neutral-400\" />;\n+    case \"running\":\n+      return <Loader2 className=\"w-3 h-3 text-blue-500 animate-spin\" />;\n+    case \"completed\":\n+      return <CheckCircle className=\"w-3 h-3 text-green-500\" />;\n+    case \"failed\":\n+      return <XCircle className=\"w-3 h-3 text-red-500\" />;\n+    case \"skipped\":\n+      return <Circle className=\"w-3 h-3 text-neutral-400\" />;\n+  }\n+}\n+\n+export function SidebarPRPreviewRuns({ teamSlugOrId, repoFullName, prNumber }: Props) {\n+  const previewRuns = useQuery(api.previewRuns.listByPullRequest, {\n+    teamSlugOrId,\n+    repoFullName,\n+    prNumber,\n+    limit: 5,\n+  });\n+\n+  const latestRun = useMemo(() => {\n+    if (!previewRuns || previewRuns.length === 0) return null;\n+    return previewRuns[0];\n+  }, [previewRuns]);\n+\n+  const olderRuns = useMemo(() => {\n+    if (!previewRuns || previewRuns.length <= 1) return [];\n+    return previewRuns.slice(1);\n+  }, [previewRuns]);\n+\n+  if (previewRuns === undefined) {\n+    return (\n+      <div className=\"mt-px flex items-center gap-2 text-xs text-neutral-500 dark:text-neutral-400 py-1.5\" style={{ paddingLeft: \"32px\" }}>\n+        <Loader2 className=\"w-3 h-3 animate-spin\" />\n+        <span>Loading previews...</span>\n+      </div>\n+    );\n+  }\n+\n+  if (!latestRun) {\n+    return null;\n+  }\n+\n+  return (\n+    <div className=\"flex flex-col\" role=\"group\">\n+      {/* Most recent preview run - always shown */}\n+      <PreviewRunItem\n+        run={latestRun}\n+        teamSlugOrId={teamSlugOrId}\n+        isLatest\n+      />\n+\n+      {/* Older runs - shown in a subtle collapsed style */}\n+      {olderRuns.length > 0 && (\n+        <details className=\"group/older\">\n+          <summary className=\"mt-px flex w-full items-center rounded-md pr-2 py-1 text-xs cursor-pointer hover:bg-neutral-200/45 dark:hover:bg-neutral-800/45 list-none\" style={{ paddingLeft: \"32px\" }}>\n+            <span className=\"text-[10px] text-neutral-500 dark:text-neutral-500\">\n+              {olderRuns.length} older {olderRuns.length === 1 ? \"run\" : \"runs\"}\n+            </span>\n+          </summary>\n+          <div className=\"flex flex-col\">\n+            {olderRuns.map((run) => (\n+              <PreviewRunItem\n+                key={run._id}\n+                run={run}\n+                teamSlugOrId={teamSlugOrId}\n+                isLatest={false}\n+              />\n+            ))}\n+          </div>\n+        </details>\n+      )}\n+    </div>\n+  );\n+}\n+\n+type PreviewRunItemProps = {\n+  run: {\n+    _id: string;\n+    status: PreviewRunStatus;\n+    taskId?: Id<\"tasks\">;\n+    screenshotCount: number;\n+    createdAt: number;\n+    headSha: string;\n+  };\n+  teamSlugOrId: string;\n+  isLatest: boolean;\n+};\n+\n+function PreviewRunItem({ run, teamSlugOrId, isLatest }: PreviewRunItemProps) {\n+  const timeAgo = formatDistanceToNow(new Date(run.createdAt), { addSuffix: true });\n+  const shortSha = run.headSha?.slice(0, 7);\n+\n+  // If we have a linked task, we can navigate to it\n+  const hasTask = Boolean(run.taskId);\n+\n+  const content = (\n+    <div\n+      className={`mt-px flex w-full items-center gap-2 rounded-md pr-2 py-1 text-xs transition-colors ${\n+        hasTask ? \"hover:bg-neutral-200/45 dark:hover:bg-neutral-800/45 cursor-default\" : \"\"\n+      }`}\n+      style={{ paddingLeft: \"32px\" }}\n+    >\n+      <span className=\"flex items-center justify-center w-4 h-4 flex-shrink-0\">\n+        {getStatusIcon(run.status)}\n+      </span>\n+      <span className=\"flex-1 min-w-0 flex items-center gap-1.5 text-neutral-600 dark:text-neutral-400\">\n+        {isLatest && (\n+          <span className=\"px-1 py-0.5 text-[9px] font-medium rounded bg-emerald-100/80 text-emerald-700 dark:bg-emerald-900/60 dark:text-emerald-300\">\n+            Latest\n+          </span>\n+        )}\n+        <span className=\"truncate\">{timeAgo}</span>\n+        {shortSha && (\n+          <span className=\"font-mono text-[10px] text-neutral-500 dark:text-neutral-500 flex-shrink-0\">\n+            {shortSha}\n+          </span>\n+        )}\n+      </span>\n+      {run.screenshotCount > 0 && (\n+        <span className=\"flex items-center gap-0.5 text-[10px] text-neutral-500 dark:text-neutral-500 flex-shrink-0\">\n+          <Camera className=\"w-3 h-3\" />\n+          {run.screenshotCount}\n+        </span>\n+      )}\n+    </div>\n+  );\n+\n+  if (hasTask && run.taskId) {\n+    return (\n+      <Link\n+        to=\"/$teamSlugOrId/task/$taskId\"\n+        params={{ teamSlugOrId, taskId: run.taskId }}\n+        search={{ runId: undefined }}\n+      >\n+        {content}\n+      </Link>\n+    );\n+  }\n+\n+  return content;\n+}\n+\n+export default SidebarPRPreviewRuns;\ndiff --git a/apps/client/src/components/sidebar/SidebarPullRequestList.tsx b/apps/client/src/components/sidebar/SidebarPullRequestList.tsx\nindex d7709e6d5..96a592595 100644\n--- a/apps/client/src/components/sidebar/SidebarPullRequestList.tsx\n+++ b/apps/client/src/components/sidebar/SidebarPullRequestList.tsx\n@@ -10,6 +10,7 @@ import {\n } from \"lucide-react\";\n import { useMemo, useState, type MouseEvent } from \"react\";\n import { SidebarListItem } from \"./SidebarListItem\";\n+import { SidebarPRPreviewRuns } from \"./SidebarPRPreviewRuns\";\n import { SIDEBAR_PRS_DEFAULT_LIMIT } from \"./const\";\n import type { Doc } from \"@cmux/convex/dataModel\";\n \n@@ -144,26 +145,35 @@ function PullRequestListItem({ pr, teamSlugOrId, expanded, setExpanded }: PullRe\n           meta={leadingIcon}\n         />\n       </Link>\n-      {isExpanded && pr.htmlUrl ? (\n+      {isExpanded ? (\n         <div className=\"mt-px flex flex-col\" role=\"group\">\n-          <a\n-            href={pr.htmlUrl}\n-            target=\"_blank\"\n-            rel=\"noreferrer\"\n-            onClick={(event) => {\n-              event.stopPropagation();\n-            }}\n-            className=\"mt-px flex w-full items-center rounded-md pr-2 py-1 text-xs transition-colors hover:bg-neutral-200/45 dark:hover:bg-neutral-800/45\"\n-            style={{ paddingLeft: \"32px\" }}\n-          >\n-            <GitHubIcon\n-              className=\"mr-2 h-3 w-3 text-neutral-400 grayscale opacity-60\"\n-              aria-hidden\n-            />\n-            <span className=\"text-neutral-600 dark:text-neutral-400\">\n-              GitHub\n-            </span>\n-          </a>\n+          {/* Preview runs for this PR */}\n+          <SidebarPRPreviewRuns\n+            teamSlugOrId={teamSlugOrId}\n+            repoFullName={pr.repoFullName}\n+            prNumber={pr.number}\n+          />\n+          {/* GitHub link */}\n+          {pr.htmlUrl ? (\n+            <a\n+              href={pr.htmlUrl}\n+              target=\"_blank\"\n+              rel=\"noreferrer\"\n+              onClick={(event) => {\n+                event.stopPropagation();\n+              }}\n+              className=\"mt-px flex w-full items-center rounded-md pr-2 py-1 text-xs transition-colors hover:bg-neutral-200/45 dark:hover:bg-neutral-800/45\"\n+              style={{ paddingLeft: \"32px\" }}\n+            >\n+              <GitHubIcon\n+                className=\"mr-2 h-3 w-3 text-neutral-400 grayscale opacity-60\"\n+                aria-hidden\n+              />\n+              <span className=\"text-neutral-600 dark:text-neutral-400\">\n+                GitHub\n+              </span>\n+            </a>\n+          ) : null}\n         </div>\n       ) : null}\n     </li>\ndiff --git a/apps/client/src/routes/_layout.$teamSlugOrId.previews.tsx b/apps/client/src/routes/_layout.$teamSlugOrId.previews.tsx\nindex b763addfd..00ae0febf 100644\n--- a/apps/client/src/routes/_layout.$teamSlugOrId.previews.tsx\n+++ b/apps/client/src/routes/_layout.$teamSlugOrId.previews.tsx\n@@ -5,22 +5,50 @@ import { convexQueryClient } from \"@/contexts/convex/convex-query-client\";\n import { useExpandTasks } from \"@/contexts/expand-tasks/ExpandTasksContext\";\n import { api } from \"@cmux/convex/api\";\n import { convexQuery } from \"@convex-dev/react-query\";\n-import { createFileRoute } from \"@tanstack/react-router\";\n+import { Link, createFileRoute } from \"@tanstack/react-router\";\n import { useQuery } from \"convex/react\";\n+import { formatDistanceToNow } from \"date-fns\";\n+import {\n+  Camera,\n+  CheckCircle,\n+  ChevronDown,\n+  Circle,\n+  GitPullRequest,\n+  Loader2,\n+  XCircle,\n+} from \"lucide-react\";\n+import { useState, type ReactNode } from \"react\";\n \n export const Route = createFileRoute(\"/_layout/$teamSlugOrId/previews\")({\n   component: PreviewsRoute,\n   loader: async ({ params }) => {\n     const { teamSlugOrId } = params;\n     void convexQueryClient.queryClient.ensureQueryData(\n-      convexQuery(api.tasks.getPreviewTasks, { teamSlugOrId })\n+      convexQuery(api.tasks.getPreviewTasksGroupedByPR, { teamSlugOrId })\n     );\n   },\n });\n \n+type PreviewRunStatus = \"pending\" | \"running\" | \"completed\" | \"failed\" | \"skipped\";\n+\n+function getStatusIcon(status: PreviewRunStatus): ReactNode {\n+  switch (status) {\n+    case \"pending\":\n+      return <Circle className=\"w-3.5 h-3.5 text-neutral-400\" />;\n+    case \"running\":\n+      return <Loader2 className=\"w-3.5 h-3.5 text-blue-500 animate-spin\" />;\n+    case \"completed\":\n+      return <CheckCircle className=\"w-3.5 h-3.5 text-green-500\" />;\n+    case \"failed\":\n+      return <XCircle className=\"w-3.5 h-3.5 text-red-500\" />;\n+    case \"skipped\":\n+      return <Circle className=\"w-3.5 h-3.5 text-neutral-400\" />;\n+  }\n+}\n+\n function PreviewsRoute() {\n   const { teamSlugOrId } = Route.useParams();\n-  const tasks = useQuery(api.tasks.getPreviewTasks, { teamSlugOrId });\n+  const prGroups = useQuery(api.tasks.getPreviewTasksGroupedByPR, { teamSlugOrId });\n   const { expandTaskIds } = useExpandTasks();\n \n   return (\n@@ -30,22 +58,29 @@ function PreviewsRoute() {\n           <h1 className=\"text-base font-semibold text-neutral-900 dark:text-neutral-100 select-none\">\n             Previews\n           </h1>\n+          <p className=\"mt-1 text-xs text-neutral-500 dark:text-neutral-400\">\n+            Screenshot previews grouped by pull request\n+          </p>\n         </div>\n         <div className=\"overflow-y-auto px-4 pb-6\">\n-          {tasks === undefined ? (\n+          {prGroups === undefined ? (\n             <TaskTreeSkeleton count={10} />\n-          ) : tasks.length === 0 ? (\n+          ) : prGroups.length === 0 ? (\n             <p className=\"mt-6 text-sm text-neutral-500 dark:text-neutral-400 select-none\">\n               No preview runs yet.\n             </p>\n           ) : (\n-            <div className=\"mt-2 space-y-1\">\n-              {tasks.map((task) => (\n-                <TaskTree\n-                  key={task._id}\n-                  task={task}\n-                  defaultExpanded={expandTaskIds?.includes(task._id) ?? false}\n+            <div className=\"mt-4 space-y-3\">\n+              {prGroups.map((group) => (\n+                <PRPreviewGroup\n+                  key={group.prKey}\n+                  group={group}\n                   teamSlugOrId={teamSlugOrId}\n+                  defaultExpanded={\n+                    group.latestTask?._id\n+                      ? expandTaskIds?.includes(group.latestTask._id) ?? false\n+                      : false\n+                  }\n                 />\n               ))}\n             </div>\n@@ -55,3 +90,122 @@ function PreviewsRoute() {\n     </FloatingPane>\n   );\n }\n+\n+type PRGroup = {\n+  prKey: string;\n+  repoFullName: string;\n+  prNumber: number;\n+  prUrl: string;\n+  totalRuns: number;\n+  totalScreenshots: number;\n+  latestTask: {\n+    _id: string;\n+    text: string;\n+    isCompleted: boolean;\n+  } | null;\n+  latestRunStatus: PreviewRunStatus;\n+  hasRunningRun: boolean;\n+  latestRunAt: number;\n+};\n+\n+function PRPreviewGroup({\n+  group,\n+  teamSlugOrId,\n+  defaultExpanded,\n+}: {\n+  group: PRGroup;\n+  teamSlugOrId: string;\n+  defaultExpanded: boolean;\n+}) {\n+  const [isExpanded, setIsExpanded] = useState(defaultExpanded);\n+  const timeAgo = formatDistanceToNow(new Date(group.latestRunAt), {\n+    addSuffix: true,\n+  });\n+\n+  return (\n+    <div className=\"rounded-xl border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950/70 overflow-hidden\">\n+      {/* PR Header - always visible */}\n+      <button\n+        type=\"button\"\n+        onClick={() => setIsExpanded(!isExpanded)}\n+        className=\"w-full flex items-center gap-3 px-4 py-3 text-left hover:bg-neutral-50 dark:hover:bg-neutral-900/50 transition-colors\"\n+      >\n+        <div className=\"flex items-center gap-2 flex-shrink-0\">\n+          <ChevronDown\n+            className={`w-4 h-4 text-neutral-400 transition-transform ${\n+              isExpanded ? \"rotate-180\" : \"\"\n+            }`}\n+          />\n+          <GitPullRequest className=\"w-4 h-4 text-[#1f883d] dark:text-[#238636]\" />\n+        </div>\n+\n+        <div className=\"flex-1 min-w-0\">\n+          <div className=\"flex items-center gap-2\">\n+            <span className=\"font-medium text-sm text-neutral-900 dark:text-neutral-100 truncate\">\n+              {group.repoFullName}\n+            </span>\n+            <span className=\"text-sm text-neutral-500 dark:text-neutral-400 flex-shrink-0\">\n+              #{group.prNumber}\n+            </span>\n+          </div>\n+          <div className=\"flex items-center gap-2 mt-0.5\">\n+            <span className=\"text-xs text-neutral-500 dark:text-neutral-500\">\n+              {timeAgo}\n+            </span>\n+            <span className=\"text-neutral-300 dark:text-neutral-700\">·</span>\n+            <span className=\"text-xs text-neutral-500 dark:text-neutral-500\">\n+              {group.totalRuns} {group.totalRuns === 1 ? \"run\" : \"runs\"}\n+            </span>\n+            {group.totalScreenshots > 0 && (\n+              <>\n+                <span className=\"text-neutral-300 dark:text-neutral-700\">·</span>\n+                <span className=\"flex items-center gap-1 text-xs text-neutral-500 dark:text-neutral-500\">\n+                  <Camera className=\"w-3 h-3\" />\n+                  {group.totalScreenshots}\n+                </span>\n+              </>\n+            )}\n+          </div>\n+        </div>\n+\n+        <div className=\"flex items-center gap-2 flex-shrink-0\">\n+          {getStatusIcon(group.latestRunStatus)}\n+          {group.hasRunningRun && (\n+            <span className=\"px-1.5 py-0.5 text-[10px] font-medium rounded bg-blue-100 text-blue-700 dark:bg-blue-900/60 dark:text-blue-300\">\n+              Running\n+            </span>\n+          )}\n+        </div>\n+      </button>\n+\n+      {/* Expanded content - preview runs for this PR */}\n+      {isExpanded && group.latestTask && (\n+        <div className=\"border-t border-neutral-200 dark:border-neutral-800 px-4 py-3 bg-neutral-50/50 dark:bg-neutral-900/30\">\n+          <TaskTree\n+            task={group.latestTask as Parameters<typeof TaskTree>[0][\"task\"]}\n+            defaultExpanded\n+            teamSlugOrId={teamSlugOrId}\n+          />\n+\n+          {/* Link to view all runs for this PR */}\n+          {group.totalRuns > 1 && (\n+            <div className=\"mt-2 pt-2 border-t border-neutral-200 dark:border-neutral-800\">\n+              <Link\n+                to=\"/$teamSlugOrId/prs-only/$owner/$repo/$number\"\n+                params={{\n+                  teamSlugOrId,\n+                  owner: group.repoFullName.split(\"/\")[0] ?? \"\",\n+                  repo: group.repoFullName.split(\"/\")[1] ?? \"\",\n+                  number: String(group.prNumber),\n+                }}\n+                className=\"text-xs text-neutral-500 hover:text-neutral-700 dark:text-neutral-400 dark:hover:text-neutral-300 transition-colors\"\n+              >\n+                View all {group.totalRuns} runs for this PR →\n+              </Link>\n+            </div>\n+          )}\n+        </div>\n+      )}\n+    </div>\n+  );\n+}\ndiff --git a/packages/convex/convex/previewRuns.ts b/packages/convex/convex/previewRuns.ts\nindex f49480904..7447aeea6 100644\n--- a/packages/convex/convex/previewRuns.ts\n+++ b/packages/convex/convex/previewRuns.ts\n@@ -488,6 +488,74 @@ export const listByTeam = authQuery({\n   },\n });\n \n+/**\n+ * Get preview runs for a specific pull request.\n+ * Returns runs sorted by creation date (most recent first).\n+ */\n+export const listByPullRequest = authQuery({\n+  args: {\n+    teamSlugOrId: v.string(),\n+    repoFullName: v.string(),\n+    prNumber: v.number(),\n+    limit: v.optional(v.number()),\n+  },\n+  handler: async (ctx, args) => {\n+    const teamId = await getTeamId(ctx, args.teamSlugOrId);\n+    const repoFullName = normalizeRepoFullName(args.repoFullName);\n+    const take = Math.max(1, Math.min(args.limit ?? 20, 100));\n+\n+    // Find the preview config for this repo\n+    const config = await ctx.db\n+      .query(\"previewConfigs\")\n+      .withIndex(\"by_team_repo\", (q) =>\n+        q.eq(\"teamId\", teamId).eq(\"repoFullName\", repoFullName),\n+      )\n+      .first();\n+\n+    if (!config) {\n+      return [];\n+    }\n+\n+    const runs = await ctx.db\n+      .query(\"previewRuns\")\n+      .withIndex(\"by_config_pr\", (q) =>\n+        q.eq(\"previewConfigId\", config._id).eq(\"prNumber\", args.prNumber),\n+      )\n+      .order(\"desc\")\n+      .take(take);\n+\n+    // Enrich with taskId and screenshot info\n+    const enrichedRuns = await Promise.all(\n+      runs.map(async (run) => {\n+        let taskId: Id<\"tasks\"> | undefined;\n+        let screenshotCount = 0;\n+\n+        if (run.taskRunId) {\n+          const taskRun = await ctx.db.get(run.taskRunId);\n+          if (taskRun) {\n+            taskId = taskRun.taskId;\n+          }\n+        }\n+\n+        if (run.screenshotSetId) {\n+          const screenshotSet = await ctx.db.get(run.screenshotSetId);\n+          if (screenshotSet) {\n+            screenshotCount = screenshotSet.images?.length ?? 0;\n+          }\n+        }\n+\n+        return {\n+          ...run,\n+          taskId,\n+          screenshotCount,\n+        };\n+      })\n+    );\n+\n+    return enrichedRuns;\n+  },\n+});\n+\n /**\n  * Create a preview run manually (for local preview scripts).\n  * Follows the same flow as the GitHub webhook handler:\ndiff --git a/packages/convex/convex/tasks.ts b/packages/convex/convex/tasks.ts\nindex 8fb4be292..8f4055f03 100644\n--- a/packages/convex/convex/tasks.ts\n+++ b/packages/convex/convex/tasks.ts\n@@ -74,6 +74,120 @@ export const getPreviewTasks = authQuery({\n   },\n });\n \n+/**\n+ * Get preview tasks grouped by pull request.\n+ * Returns most recent task per PR, with count of total runs.\n+ */\n+export const getPreviewTasksGroupedByPR = authQuery({\n+  args: {\n+    teamSlugOrId: v.string(),\n+    limit: v.optional(v.number()),\n+  },\n+  handler: async (ctx, args) => {\n+    const teamId = await getTeamId(ctx, args.teamSlugOrId);\n+    const take = Math.max(1, Math.min(args.limit ?? 20, 50));\n+\n+    // Get all preview runs for this team, ordered by creation time desc\n+    const previewRuns = await ctx.db\n+      .query(\"previewRuns\")\n+      .withIndex(\"by_team_created\", (q) => q.eq(\"teamId\", teamId))\n+      .order(\"desc\")\n+      .take(200); // Fetch more to group properly\n+\n+    // Group by PR identity (repoFullName + prNumber)\n+    const prGroups = new Map<\n+      string,\n+      {\n+        repoFullName: string;\n+        prNumber: number;\n+        prUrl: string;\n+        runs: typeof previewRuns;\n+        latestTaskId?: Id<\"tasks\">;\n+        latestTask?: Awaited<ReturnType<typeof ctx.db.get>>;\n+      }\n+    >();\n+\n+    for (const run of previewRuns) {\n+      const prKey = `${run.repoFullName}#${run.prNumber}`;\n+      const existing = prGroups.get(prKey);\n+      if (existing) {\n+        existing.runs.push(run);\n+      } else {\n+        prGroups.set(prKey, {\n+          repoFullName: run.repoFullName,\n+          prNumber: run.prNumber,\n+          prUrl: run.prUrl,\n+          runs: [run],\n+        });\n+      }\n+    }\n+\n+    // For each group, get the latest task\n+    const enrichedGroups = await Promise.all(\n+      Array.from(prGroups.values())\n+        .slice(0, take)\n+        .map(async (group) => {\n+          // Find the most recent run with a linked taskRun\n+          let latestTask = null;\n+          for (const run of group.runs) {\n+            if (run.taskRunId) {\n+              const taskRun = await ctx.db.get(run.taskRunId);\n+              if (taskRun) {\n+                const task = await ctx.db.get(taskRun.taskId);\n+                if (task && !task.isArchived) {\n+                  latestTask = task;\n+                  break;\n+                }\n+              }\n+            }\n+          }\n+\n+          // Count screenshots across all runs\n+          let totalScreenshots = 0;\n+          for (const run of group.runs) {\n+            if (run.screenshotSetId) {\n+              const screenshotSet = await ctx.db.get(run.screenshotSetId);\n+              if (screenshotSet) {\n+                totalScreenshots += screenshotSet.images?.length ?? 0;\n+              }\n+            }\n+          }\n+\n+          // Get status of most recent run\n+          const latestRun = group.runs[0];\n+          const hasRunningRun = group.runs.some(\n+            (r) => r.status === \"pending\" || r.status === \"running\"\n+          );\n+\n+          return {\n+            prKey: `${group.repoFullName}#${group.prNumber}`,\n+            repoFullName: group.repoFullName,\n+            prNumber: group.prNumber,\n+            prUrl: group.prUrl,\n+            totalRuns: group.runs.length,\n+            totalScreenshots,\n+            latestTask,\n+            latestRunStatus: latestRun?.status ?? \"pending\",\n+            hasRunningRun,\n+            latestRunAt: latestRun?.createdAt ?? 0,\n+          };\n+        })\n+    );\n+\n+    // Filter out groups without any visible task and sort\n+    const filtered = enrichedGroups.filter((g) => g.latestTask !== null);\n+    filtered.sort((a, b) => {\n+      // Running first\n+      if (a.hasRunningRun && !b.hasRunningRun) return -1;\n+      if (!a.hasRunningRun && b.hasRunningRun) return 1;\n+      // Then by latest run time\n+      return b.latestRunAt - a.latestRunAt;\n+    });\n+\n+    return filtered;\n+  },\n+});\n+\n export const getPinned = authQuery({\n   args: {\n     teamSlugOrId: v.string(),\n","comments":[{"type":"issue_comment","id":3608963317,"prNumber":1136,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn75v2jrk64bfp2cczs3bjj7v57wkdh0?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn75v2jrk64bfp2cczs3bjj7v57wkdh0/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1136?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 7 screenshots for commit `d6b9f3f` (2025-12-03 21:42:08.100 UTC).\n\n**Full page layout showing the complete application interface with sidebar, main content, and task detail panels**\n\n![full-page-layout.png](https://adorable-wombat-701.convex.cloud/api/storage/b4502f3a-0862-4a1b-bee9-603f7e071bfd)\n\n**Full page view of the Previews page showing all PR groups with screenshot counts**\n\n![previews-page-full.png](https://adorable-wombat-701.convex.cloud/api/storage/7df2c711-2489-4399-ac7d-8b3d0275f353)\n\n**Previews page with PR \\#1135 expanded showing a single task entry**\n\n![previews-page-pr-expanded.png](https://adorable-wombat-701.convex.cloud/api/storage/cc7d6c69-7d19-427b-97ed-16d153c2b622)\n\n**PR \\#1118 expanded view showing the latest run with 'View all 11 runs for this PR' link - demonstrates the new collapsing feature**\n\n![previews-pr1118-expanded-collapsed-runs.png](https://adorable-wombat-701.convex.cloud/api/storage/f0c99a0d-db99-4efb-86cb-7d871c3e1e92)\n\n**Close-up viewport view of PR \\#1118 showing the collapsed runs UI with only the latest task visible**\n\n![previews-pr1118-expanded-viewport.png](https://adorable-wombat-701.convex.cloud/api/storage/892ba7c7-6328-4208-b73b-218c62f89d8b)\n\n**Sidebar navigation showing Preview screenshots entries for PR \\#1118 with task hierarchy**\n\n![sidebar-pr1118-view.png](https://adorable-wombat-701.convex.cloud/api/storage/21fd2f2d-8cb7-490c-9b49-f0163df4387e)\n\n**Task detail view for PR \\#1118 showing the task interface with sidebar navigation**\n\n![task-detail-view-pr1118.png](https://adorable-wombat-701.convex.cloud/api/storage/ce003fc9-d24a-446e-9749-a35b0037a6cd)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"e0843f082e791bd88d9f72d57f30d1472f73c5f6","createdAt":"2025-12-03T21:42:10Z","updatedAt":"2025-12-03T23:49:03Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1136#issuecomment-3608963317"},{"type":"issue_comment","id":3609309195,"prNumber":1136,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7fhkdqhpjk39m8d8cxmpxcex7wkttz?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7fhkdqhpjk39m8d8cxmpxcex7wkttz/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1136?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 6 screenshots for commit `a69fee4` (2025-12-03 23:48:59.951 UTC).\n\n**Full page view of the Previews page showing PR groups with collapsed/expandable preview runs**\n\n![previews-page-full.png](https://famous-camel-162.convex.cloud/api/storage/e8642c15-a2f9-4717-8314-fbb7666b2ce6)\n\n**Pull Requests list page showing all open PRs with sidebar navigation**\n\n![pull-requests-list-page-full.png](https://famous-camel-162.convex.cloud/api/storage/facdf3ca-fbdf-4378-b1e7-023deb426a54)\n\n**Sidebar showing PR expanded with 'Loading previews...' state**\n\n![sidebar-pr-expanded-loading.png](https://famous-camel-162.convex.cloud/api/storage/17e68f5f-6b68-46b9-8bb8-321c3d40dca0)\n\n**Screenshot collector task detail view**\n\n![task-detail-screenshot-collector-full.png](https://famous-camel-162.convex.cloud/api/storage/2c943f97-cf13-4eaa-9ae4-2f1f779456dc)\n\n**Task detail page for PR \\#1136 'Collapse duplicate previews, surface latest in PR UI'**\n\n![task-page-pr-1136-full.png](https://famous-camel-162.convex.cloud/api/storage/ad115bc7-11ad-41a6-b205-021e278ddddf)\n\n**Screenshot collector task detail for PR \\#1137**\n\n![task-pr-1137-screenshot-collector-full.png](https://famous-camel-162.convex.cloud/api/storage/0b7eaedb-0105-4766-a86c-0923024e9cb5)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"e0843f082e791bd88d9f72d57f30d1472f73c5f6","createdAt":"2025-12-03T23:49:02Z","updatedAt":"2025-12-04T00:33:31Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1136#issuecomment-3609309195"},{"type":"issue_comment","id":3609403278,"prNumber":1136,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn72fttx30as26c076g81ktgah7wn5j3?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn72fttx30as26c076g81ktgah7wn5j3/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1136?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"e0843f082e791bd88d9f72d57f30d1472f73c5f6","createdAt":"2025-12-04T00:33:31Z","updatedAt":"2025-12-04T00:33:31Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1136#issuecomment-3609403278"},{"type":"issue_comment","id":3610633178,"prNumber":1136,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.dev/manaflow/task/kn7fy3q84mdww1ckw56psvrpch7wn8j8?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.dev/manaflow/task/kn7fy3q84mdww1ckw56psvrpch7wn8j8/run/kd70dkhzmwr1kn2t84acx7x4dn7wm1qt/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1136?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 6 screenshots for commit `e0843f0` (2025-12-04 07:13:47.342 UTC).\n\n**Expanded PR group showing the latest task prominently with 'View all 4 runs for this PR' link**\n\n![previews-page-expanded-pr-1136.png](https://adorable-wombat-701.convex.cloud/api/storage/f9e2145a-33a7-4ede-9d72-48496a92cd45)\n\n**Previews page overview showing PR groups with run counts and timestamps**\n\n![previews-page-overview.png](https://adorable-wombat-701.convex.cloud/api/storage/f9c6a3dd-2ad6-4d8c-8afd-c6ab1bd8a0b9)\n\n**Close-up of the Screenshots section header showing capture count and status**\n\n![screenshots-section-close-up.png](https://adorable-wombat-701.convex.cloud/api/storage/1448ae2e-0b42-4776-9d3f-6828c84c7d5b)\n\n**Sidebar showing preview runs hierarchy with the latest run shown and older runs collapsed under a disclosure**\n\n![sidebar-with-preview-runs.png](https://adorable-wombat-701.convex.cloud/api/storage/79ca9aa9-1069-45f9-b772-f300d6c64c07)\n\n**Task detail view showing the git diff for PR \\#1136 with the modified files**\n\n![task-detail-view-with-diff.png](https://adorable-wombat-701.convex.cloud/api/storage/9940c623-6116-4ae8-9fc2-dea75d31a11d)\n\n**Task view with Screenshots section showing 1 capture with 'Failed' status and 'Latest' badge**\n\n![task-with-screenshots-section-failed.png](https://adorable-wombat-701.convex.cloud/api/storage/50129b42-5b29-4f35-abbc-1befd6e00e4b)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"e0843f082e791bd88d9f72d57f30d1472f73c5f6","createdAt":"2025-12-04T07:13:50Z","updatedAt":"2025-12-04T07:17:26Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1136#issuecomment-3610633178"},{"type":"issue_comment","id":3610642264,"prNumber":1136,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://www.cmux.dev/austin-dev/task/kn7emrk4htjs8h4sp80p887srd7wmjw9?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://www.cmux.dev/austin-dev/task/kn7emrk4htjs8h4sp80p887srd7wmjw9/run/kd7da7haxhqtwhr34nxee6hccx7wn9dm/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1136?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 8 screenshots for commit `e0843f0` (2025-12-04 07:17:22.784 UTC).\n\n**Previews page with PR \\#1136 expanded showing the latest preview run surfaced at the top**\n\n![previews-page-expanded-pr-1136.png](https://famous-camel-162.convex.cloud/api/storage/8449cada-578a-46df-88e1-89f0e5bce1f6)\n\n**Previews page showing all PRs grouped together with run counts and screenshot counts, demonstrating the new grouping UI**\n\n![previews-page-grouped-by-pr.png](https://famous-camel-162.convex.cloud/api/storage/d7ffa8c4-2b8a-4bb5-b8f0-d20ea8d08345)\n\n**Previews page showing PRs grouped by pull request with collapsed view**\n\n![previews-page-overview.png](https://famous-camel-162.convex.cloud/api/storage/7d3f9f43-089c-4042-917c-262008190d3c)\n\n**PR \\#1136 expanded view showing the latest task and a link to view all 4 runs, demonstrating how older runs are collapsed and latest is surfaced**\n\n![previews-page-pr1136-expanded.png](https://famous-camel-162.convex.cloud/api/storage/c7cfb293-349c-4cc2-9f10-5f0926fbbcd5)\n\n**Pull requests page in loading state showing the sidebar with PR list**\n\n![pull-requests-page-loading.png](https://famous-camel-162.convex.cloud/api/storage/b3c0f016-dcc4-4d08-9cfd-645406d3020b)\n\n**Full page view of the task page showing the complete interface with sidebar navigation and workspace panels**\n\n![task-page-full-view.png](https://famous-camel-162.convex.cloud/api/storage/557398ff-ad7a-48f5-9468-7515efac2ee2)\n\n**Complete task page view for PR \\#1136 with all panels \\(Workspace, Browser, Git Diff\\) showing the code changes for the screenshot gallery feature**\n\n![task-page-pr1136-with-panels.png](https://famous-camel-162.convex.cloud/api/storage/1beed681-3442-44b9-9f09-a9fdfefdacb9)\n\n**Task page for PR \\#1136 preview run showing the full layout with git diff**\n\n![task-page-with-screenshots.png](https://famous-camel-162.convex.cloud/api/storage/10fed56f-dd52-4243-96ed-4b8bd132dff8)\n\n---\n\n_Generated by [cmux](https://cmux.dev?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"e0843f082e791bd88d9f72d57f30d1472f73c5f6","createdAt":"2025-12-04T07:17:25Z","updatedAt":"2025-12-04T07:17:25Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1136#issuecomment-3610642264"}]}
{"number":1135,"title":"Collapse duplicate previews, surface latest in PR UI","state":"open","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1135","headRef":"cmux/collapse-duplicate-previews-surface-latest-in-pr-u-xy8nd","headSha":"369a3ef6227bf27aa21fdf9d68dd32a2187da2d9","baseRef":"main","baseSha":"83415aed27552656a044b0c340234b58bbbe859b","createdAt":"2025-12-03T20:56:57Z","updatedAt":"2025-12-03T21:03:59Z","diff":"diff --git a/apps/client/src/components/dashboard/TaskList.tsx b/apps/client/src/components/dashboard/TaskList.tsx\nindex 1bc7e946c..e35948558 100644\n--- a/apps/client/src/components/dashboard/TaskList.tsx\n+++ b/apps/client/src/components/dashboard/TaskList.tsx\n@@ -116,6 +116,16 @@ type PreviewRunWithConfig = Doc<\"previewRuns\"> & {\n   taskId?: Id<\"tasks\">;\n };\n \n+// Preview run grouped by PR\n+type PreviewRunGroup = {\n+  key: string; // \"repoFullName#prNumber\"\n+  repoFullName: string;\n+  prNumber: number;\n+  prUrl: string;\n+  latestRun: PreviewRunWithConfig;\n+  olderRuns: PreviewRunWithConfig[];\n+};\n+\n type PreviewCategoryKey = \"in_progress\" | \"completed\";\n \n const PREVIEW_CATEGORY_ORDER: PreviewCategoryKey[] = [\"in_progress\", \"completed\"];\n@@ -136,7 +146,7 @@ const PREVIEW_CATEGORY_META: Record<\n \n const createEmptyPreviewCategoryBuckets = (): Record<\n   PreviewCategoryKey,\n-  PreviewRunWithConfig[]\n+  PreviewRunGroup[]\n > => ({\n   in_progress: [],\n   completed: [],\n@@ -154,20 +164,61 @@ const getPreviewCategory = (run: PreviewRunWithConfig): PreviewCategoryKey | nul\n   return null;\n };\n \n+// Group preview runs by PR, with the most recent run as the \"latestRun\"\n+const groupPreviewRunsByPr = (\n+  runs: PreviewRunWithConfig[]\n+): Map<string, PreviewRunGroup> => {\n+  const groups = new Map<string, PreviewRunGroup>();\n+\n+  // Runs are already sorted by createdAt desc from the API\n+  for (const run of runs) {\n+    const key = `${run.repoFullName}#${run.prNumber}`;\n+    const existing = groups.get(key);\n+\n+    if (!existing) {\n+      groups.set(key, {\n+        key,\n+        repoFullName: run.repoFullName,\n+        prNumber: run.prNumber,\n+        prUrl: run.prUrl,\n+        latestRun: run,\n+        olderRuns: [],\n+      });\n+    } else {\n+      existing.olderRuns.push(run);\n+    }\n+  }\n+\n+  return groups;\n+};\n+\n const categorizePreviewRuns = (\n   runs: PreviewRunWithConfig[] | undefined\n-): Record<PreviewCategoryKey, PreviewRunWithConfig[]> | null => {\n+): Record<PreviewCategoryKey, PreviewRunGroup[]> | null => {\n   if (!runs) {\n     return null;\n   }\n+\n+  // First group all runs by PR\n+  const groups = groupPreviewRunsByPr(runs);\n+\n+  // Then categorize groups by the status of the latest run\n   const buckets = createEmptyPreviewCategoryBuckets();\n-  for (const run of runs) {\n-    const key = getPreviewCategory(run);\n-    // Skip runs that don't belong to any category (e.g., failed runs)\n+  for (const group of groups.values()) {\n+    const key = getPreviewCategory(group.latestRun);\n+    // Skip groups where the latest run doesn't belong to any category (e.g., failed runs)\n     if (key !== null) {\n-      buckets[key].push(run);\n+      buckets[key].push(group);\n     }\n   }\n+\n+  // Sort groups by the latest run's createdAt\n+  for (const key of PREVIEW_CATEGORY_ORDER) {\n+    buckets[key].sort((a, b) =>\n+      (b.latestRun.createdAt ?? 0) - (a.latestRun.createdAt ?? 0)\n+    );\n+  }\n+\n   return buckets;\n };\n \n@@ -263,6 +314,16 @@ export const TaskList = memo(function TaskList({\n     }));\n   }, [setCollapsedPreviewCategories]);\n \n+  // State for expanded preview groups (PRs with older runs)\n+  const [expandedPreviewGroups, setExpandedPreviewGroups] = useState<Record<string, boolean>>({});\n+\n+  const togglePreviewGroup = useCallback((groupKey: string) => {\n+    setExpandedPreviewGroups((prev) => ({\n+      ...prev,\n+      [groupKey]: !prev[groupKey],\n+    }));\n+  }, []);\n+\n   return (\n     <div className=\"mt-6 w-full\">\n       <div className=\"mb-3 px-4\">\n@@ -339,10 +400,12 @@ export const TaskList = memo(function TaskList({\n                 <PreviewCategorySection\n                   key={categoryKey}\n                   categoryKey={categoryKey}\n-                  previewRuns={previewCategoryBuckets[categoryKey]}\n+                  previewGroups={previewCategoryBuckets[categoryKey]}\n                   teamSlugOrId={teamSlugOrId}\n                   collapsed={Boolean(collapsedPreviewCategories[categoryKey])}\n                   onToggle={togglePreviewCategoryCollapse}\n+                  expandedGroups={expandedPreviewGroups}\n+                  onToggleGroup={togglePreviewGroup}\n                 />\n               ))}\n             </div>\n@@ -448,16 +511,20 @@ function TaskCategorySection({\n \n function PreviewCategorySection({\n   categoryKey,\n-  previewRuns,\n+  previewGroups,\n   teamSlugOrId,\n   collapsed,\n   onToggle,\n+  expandedGroups,\n+  onToggleGroup,\n }: {\n   categoryKey: PreviewCategoryKey;\n-  previewRuns: PreviewRunWithConfig[];\n+  previewGroups: PreviewRunGroup[];\n   teamSlugOrId: string;\n   collapsed: boolean;\n   onToggle: (key: PreviewCategoryKey) => void;\n+  expandedGroups: Record<string, boolean>;\n+  onToggleGroup: (groupKey: string) => void;\n }) {\n   const meta = PREVIEW_CATEGORY_META[categoryKey];\n   const handleToggle = useCallback(\n@@ -468,6 +535,10 @@ function PreviewCategorySection({\n   const toggleLabel = collapsed\n     ? `Expand ${meta.title}`\n     : `Collapse ${meta.title}`;\n+\n+  // Count total PRs (groups)\n+  const groupCount = previewGroups.length;\n+\n   return (\n     <div className=\"w-full\">\n       <div\n@@ -494,15 +565,21 @@ function PreviewCategorySection({\n           <div className=\"flex items-center gap-2 text-xs font-medium tracking-tight text-neutral-900 dark:text-neutral-100\">\n             <span>{meta.title}</span>\n             <span className=\"text-xs text-neutral-500 dark:text-neutral-400\">\n-              {previewRuns.length}\n+              {groupCount}\n             </span>\n           </div>\n         </div>\n       </div>\n-      {collapsed ? null : previewRuns.length > 0 ? (\n+      {collapsed ? null : groupCount > 0 ? (\n         <div id={contentId} className=\"flex flex-col w-full\">\n-          {previewRuns.map((run) => (\n-            <PreviewItem key={run._id} previewRun={run} teamSlugOrId={teamSlugOrId} />\n+          {previewGroups.map((group) => (\n+            <PreviewGroupItem\n+              key={group.key}\n+              group={group}\n+              teamSlugOrId={teamSlugOrId}\n+              isExpanded={expandedGroups[group.key] ?? false}\n+              onToggle={() => onToggleGroup(group.key)}\n+            />\n           ))}\n         </div>\n       ) : (\n@@ -515,3 +592,69 @@ function PreviewCategorySection({\n     </div>\n   );\n }\n+\n+// Component for displaying a preview group (PR) with expandable older runs\n+function PreviewGroupItem({\n+  group,\n+  teamSlugOrId,\n+  isExpanded,\n+  onToggle,\n+}: {\n+  group: PreviewRunGroup;\n+  teamSlugOrId: string;\n+  isExpanded: boolean;\n+  onToggle: () => void;\n+}) {\n+  const hasOlderRuns = group.olderRuns.length > 0;\n+\n+  return (\n+    <div className=\"w-full\">\n+      {/* Latest run - always visible */}\n+      <div className=\"relative\">\n+        <PreviewItem\n+          previewRun={group.latestRun}\n+          teamSlugOrId={teamSlugOrId}\n+        />\n+        {/* Expand/collapse button for older runs */}\n+        {hasOlderRuns && (\n+          <button\n+            type=\"button\"\n+            onClick={(e) => {\n+              e.preventDefault();\n+              e.stopPropagation();\n+              onToggle();\n+            }}\n+            className=\"absolute left-1 top-1/2 -translate-y-1/2 flex items-center justify-center w-5 h-5 rounded hover:bg-neutral-200/60 dark:hover:bg-neutral-700/60 transition-colors\"\n+            aria-label={isExpanded ? \"Collapse previous runs\" : `Show ${group.olderRuns.length} previous run${group.olderRuns.length === 1 ? \"\" : \"s\"}`}\n+            aria-expanded={isExpanded}\n+          >\n+            <ChevronRight\n+              className={clsx(\n+                \"h-3 w-3 text-neutral-400 dark:text-neutral-500 transition-transform duration-200\",\n+                isExpanded && \"rotate-90\"\n+              )}\n+              aria-hidden=\"true\"\n+            />\n+          </button>\n+        )}\n+      </div>\n+\n+      {/* Older runs - collapsible */}\n+      {hasOlderRuns && isExpanded && (\n+        <div className=\"relative pl-6 border-l-2 border-neutral-200 dark:border-neutral-700 ml-3\">\n+          <div className=\"absolute -left-[7px] top-0 text-[9px] text-neutral-400 dark:text-neutral-500 bg-white dark:bg-neutral-900 px-0.5 select-none\">\n+            {group.olderRuns.length} older\n+          </div>\n+          {group.olderRuns.map((run) => (\n+            <div key={run._id} className=\"opacity-60 hover:opacity-100 transition-opacity\">\n+              <PreviewItem\n+                previewRun={run}\n+                teamSlugOrId={teamSlugOrId}\n+              />\n+            </div>\n+          ))}\n+        </div>\n+      )}\n+    </div>\n+  );\n+}\ndiff --git a/apps/client/src/components/sidebar/SidebarPullRequestList.tsx b/apps/client/src/components/sidebar/SidebarPullRequestList.tsx\nindex d7709e6d5..14e3a7af7 100644\n--- a/apps/client/src/components/sidebar/SidebarPullRequestList.tsx\n+++ b/apps/client/src/components/sidebar/SidebarPullRequestList.tsx\n@@ -2,16 +2,29 @@ import { GitHubIcon } from \"@/components/icons/github\";\n import { api } from \"@cmux/convex/api\";\n import { Link } from \"@tanstack/react-router\";\n import { useQuery as useConvexQuery } from \"convex/react\";\n+import clsx from \"clsx\";\n import {\n+  Eye,\n   GitMerge,\n   GitPullRequest,\n   GitPullRequestClosed,\n   GitPullRequestDraft,\n+  Loader2,\n } from \"lucide-react\";\n import { useMemo, useState, type MouseEvent } from \"react\";\n import { SidebarListItem } from \"./SidebarListItem\";\n import { SIDEBAR_PRS_DEFAULT_LIMIT } from \"./const\";\n-import type { Doc } from \"@cmux/convex/dataModel\";\n+import type { Doc, Id } from \"@cmux/convex/dataModel\";\n+\n+type PreviewRunInfo = {\n+  _id: string;\n+  status: string;\n+  createdAt: number;\n+  completedAt?: number;\n+  headRef?: string;\n+  screenshotSetId?: string;\n+  taskId?: string;\n+};\n \n type Props = {\n   teamSlugOrId: string;\n@@ -32,6 +45,22 @@ export function SidebarPullRequestList({\n \n   const list = useMemo(() => prs ?? [], [prs]);\n \n+  // Build the list of PRs to query for preview runs\n+  const prsToQuery = useMemo(\n+    () =>\n+      list.map((pr) => ({\n+        repoFullName: pr.repoFullName,\n+        prNumber: pr.number,\n+      })),\n+    [list]\n+  );\n+\n+  // Fetch preview runs for all visible PRs\n+  const previewRuns = useConvexQuery(\n+    api.previewRuns.getMostRecentForPrs,\n+    list.length > 0 ? { teamSlugOrId, prs: prsToQuery } : \"skip\"\n+  );\n+\n   if (prs === undefined) {\n     return (\n       <ul className=\"flex flex-col gap-px\" aria-label=\"Loading pull requests\">\n@@ -54,15 +83,20 @@ export function SidebarPullRequestList({\n \n   return (\n     <ul className=\"flex flex-col gap-px\">\n-      {list.map((pr) => (\n-        <PullRequestListItem\n-          key={`${pr.repoFullName}#${pr.number}`}\n-          pr={pr}\n-          teamSlugOrId={teamSlugOrId}\n-          expanded={expanded}\n-          setExpanded={setExpanded}\n-        />\n-      ))}\n+      {list.map((pr) => {\n+        const key = `${pr.repoFullName}#${pr.number}`;\n+        const previewRun = previewRuns?.[key];\n+        return (\n+          <PullRequestListItem\n+            key={key}\n+            pr={pr}\n+            teamSlugOrId={teamSlugOrId}\n+            expanded={expanded}\n+            setExpanded={setExpanded}\n+            previewRun={previewRun}\n+          />\n+        );\n+      })}\n     </ul>\n   );\n }\n@@ -72,9 +106,10 @@ type PullRequestListItemProps = {\n   teamSlugOrId: string;\n   expanded: Record<string, boolean>;\n   setExpanded: React.Dispatch<React.SetStateAction<Record<string, boolean>>>;\n+  previewRun?: PreviewRunInfo;\n };\n \n-function PullRequestListItem({ pr, teamSlugOrId, expanded, setExpanded }: PullRequestListItemProps) {\n+function PullRequestListItem({ pr, teamSlugOrId, expanded, setExpanded, previewRun }: PullRequestListItemProps) {\n   const [owner = \"\", repo = \"\"] = pr.repoFullName?.split(\"/\", 2) ?? [\"\", \"\"];\n   const key = `${pr.repoFullName}#${pr.number}`;\n   const isExpanded = expanded[key] ?? false;\n@@ -107,6 +142,37 @@ function PullRequestListItem({ pr, teamSlugOrId, expanded, setExpanded }: PullRe\n     }));\n   };\n \n+  // Format preview status for display\n+  const getPreviewStatusInfo = (run: PreviewRunInfo) => {\n+    const isInProgress = run.status === \"pending\" || run.status === \"running\";\n+    const isCompleted = run.status === \"completed\" || run.status === \"skipped\";\n+    const isFailed = run.status === \"failed\";\n+\n+    const statusLabel = isInProgress\n+      ? \"Running\"\n+      : isCompleted\n+        ? \"Complete\"\n+        : isFailed\n+          ? \"Failed\"\n+          : run.status;\n+\n+    return { isInProgress, isCompleted, isFailed, statusLabel };\n+  };\n+\n+  // Format time ago for preview run\n+  const formatTimeAgo = (timestamp: number) => {\n+    const now = Date.now();\n+    const diff = now - timestamp;\n+    const minutes = Math.floor(diff / 60000);\n+    const hours = Math.floor(diff / 3600000);\n+    const days = Math.floor(diff / 86400000);\n+\n+    if (minutes < 1) return \"just now\";\n+    if (minutes < 60) return `${minutes}m ago`;\n+    if (hours < 24) return `${hours}h ago`;\n+    return `${days}d ago`;\n+  };\n+\n   return (\n     <li key={key} className=\"rounded-md select-none\">\n       <Link\n@@ -144,30 +210,131 @@ function PullRequestListItem({ pr, teamSlugOrId, expanded, setExpanded }: PullRe\n           meta={leadingIcon}\n         />\n       </Link>\n-      {isExpanded && pr.htmlUrl ? (\n+      {isExpanded ? (\n         <div className=\"mt-px flex flex-col\" role=\"group\">\n-          <a\n-            href={pr.htmlUrl}\n-            target=\"_blank\"\n-            rel=\"noreferrer\"\n-            onClick={(event) => {\n-              event.stopPropagation();\n-            }}\n-            className=\"mt-px flex w-full items-center rounded-md pr-2 py-1 text-xs transition-colors hover:bg-neutral-200/45 dark:hover:bg-neutral-800/45\"\n-            style={{ paddingLeft: \"32px\" }}\n-          >\n-            <GitHubIcon\n-              className=\"mr-2 h-3 w-3 text-neutral-400 grayscale opacity-60\"\n-              aria-hidden\n+          {/* Preview run info */}\n+          {previewRun && (\n+            <PreviewRunLink\n+              previewRun={previewRun}\n+              teamSlugOrId={teamSlugOrId}\n+              getStatusInfo={getPreviewStatusInfo}\n+              formatTimeAgo={formatTimeAgo}\n             />\n-            <span className=\"text-neutral-600 dark:text-neutral-400\">\n-              GitHub\n-            </span>\n-          </a>\n+          )}\n+          {/* GitHub link */}\n+          {pr.htmlUrl && (\n+            <a\n+              href={pr.htmlUrl}\n+              target=\"_blank\"\n+              rel=\"noreferrer\"\n+              onClick={(event) => {\n+                event.stopPropagation();\n+              }}\n+              className=\"mt-px flex w-full items-center rounded-md pr-2 py-1 text-xs transition-colors hover:bg-neutral-200/45 dark:hover:bg-neutral-800/45\"\n+              style={{ paddingLeft: \"32px\" }}\n+            >\n+              <GitHubIcon\n+                className=\"mr-2 h-3 w-3 text-neutral-400 grayscale opacity-60\"\n+                aria-hidden\n+              />\n+              <span className=\"text-neutral-600 dark:text-neutral-400\">\n+                GitHub\n+              </span>\n+            </a>\n+          )}\n         </div>\n       ) : null}\n     </li>\n   );\n }\n \n+// Component to render the preview run link under a PR\n+function PreviewRunLink({\n+  previewRun,\n+  teamSlugOrId,\n+  getStatusInfo,\n+  formatTimeAgo,\n+}: {\n+  previewRun: PreviewRunInfo;\n+  teamSlugOrId: string;\n+  getStatusInfo: (run: PreviewRunInfo) => {\n+    isInProgress: boolean;\n+    isCompleted: boolean;\n+    isFailed: boolean;\n+    statusLabel: string;\n+  };\n+  formatTimeAgo: (timestamp: number) => string;\n+}) {\n+  const { isInProgress, isCompleted, isFailed, statusLabel } = getStatusInfo(previewRun);\n+  const timestamp = previewRun.completedAt || previewRun.createdAt;\n+\n+  // Status indicator dot/spinner\n+  const StatusIndicator = () => {\n+    if (isInProgress) {\n+      return (\n+        <Loader2\n+          className=\"mr-2 h-3 w-3 text-blue-500 animate-spin\"\n+          aria-hidden\n+        />\n+      );\n+    }\n+    return (\n+      <div\n+        className={clsx(\n+          \"mr-2 h-2 w-2 rounded-full flex-shrink-0\",\n+          isCompleted && \"bg-green-500\",\n+          isFailed && \"bg-red-500\",\n+          !isCompleted && !isFailed && \"bg-neutral-400\"\n+        )}\n+        aria-hidden\n+      />\n+    );\n+  };\n+\n+  // If there's a taskId, make it a link to the task\n+  if (previewRun.taskId) {\n+    return (\n+      <Link\n+        to=\"/$teamSlugOrId/task/$taskId\"\n+        params={{\n+          teamSlugOrId,\n+          taskId: previewRun.taskId as Id<\"tasks\">,\n+        }}\n+        search={{ runId: undefined }}\n+        onClick={(event) => {\n+          event.stopPropagation();\n+        }}\n+        className=\"mt-px flex w-full items-center rounded-md pr-2 py-1 text-xs transition-colors hover:bg-neutral-200/45 dark:hover:bg-neutral-800/45\"\n+        style={{ paddingLeft: \"32px\" }}\n+      >\n+        <StatusIndicator />\n+        <Eye className=\"mr-1.5 h-3 w-3 text-neutral-400 dark:text-neutral-500\" aria-hidden />\n+        <span className=\"text-neutral-600 dark:text-neutral-400 flex-1 min-w-0 truncate\">\n+          Preview\n+        </span>\n+        <span className=\"ml-1 text-neutral-400 dark:text-neutral-500 text-[10px]\">\n+          {statusLabel} {formatTimeAgo(timestamp)}\n+        </span>\n+      </Link>\n+    );\n+  }\n+\n+  // Without taskId, just show status (no link)\n+  return (\n+    <div\n+      className=\"mt-px flex w-full items-center rounded-md pr-2 py-1 text-xs\"\n+      style={{ paddingLeft: \"32px\" }}\n+    >\n+      <StatusIndicator />\n+      <Eye className=\"mr-1.5 h-3 w-3 text-neutral-400 dark:text-neutral-500\" aria-hidden />\n+      <span className=\"text-neutral-500 dark:text-neutral-500 flex-1 min-w-0 truncate\">\n+        Preview\n+      </span>\n+      <span className=\"ml-1 text-neutral-400 dark:text-neutral-500 text-[10px]\">\n+        {statusLabel} {formatTimeAgo(timestamp)}\n+      </span>\n+    </div>\n+  );\n+}\n+\n export default SidebarPullRequestList;\ndiff --git a/packages/convex/convex/previewRuns.ts b/packages/convex/convex/previewRuns.ts\nindex f49480904..e69eeb8a9 100644\n--- a/packages/convex/convex/previewRuns.ts\n+++ b/packages/convex/convex/previewRuns.ts\n@@ -613,3 +613,151 @@ export const createManual = authMutation({\n     return { previewRunId: runId, reused: false };\n   },\n });\n+\n+/**\n+ * Get the most recent preview run for a specific repo and PR number.\n+ * Used by the sidebar to show preview status under each PR.\n+ */\n+export const getMostRecentByRepoPr = authQuery({\n+  args: {\n+    teamSlugOrId: v.string(),\n+    repoFullName: v.string(),\n+    prNumber: v.number(),\n+  },\n+  handler: async (ctx, args) => {\n+    const teamId = await getTeamId(ctx, args.teamSlugOrId);\n+    const repoFullName = normalizeRepoFullName(args.repoFullName);\n+\n+    // First find the preview config for this repo\n+    const config = await ctx.db\n+      .query(\"previewConfigs\")\n+      .withIndex(\"by_team_repo\", (q) =>\n+        q.eq(\"teamId\", teamId).eq(\"repoFullName\", repoFullName),\n+      )\n+      .first();\n+\n+    if (!config) {\n+      return null;\n+    }\n+\n+    // Get the most recent preview run for this config and PR\n+    const run = await ctx.db\n+      .query(\"previewRuns\")\n+      .withIndex(\"by_config_pr\", (q) =>\n+        q.eq(\"previewConfigId\", config._id).eq(\"prNumber\", args.prNumber),\n+      )\n+      .order(\"desc\")\n+      .first();\n+\n+    if (!run) {\n+      return null;\n+    }\n+\n+    // Get taskId if available\n+    let taskId = undefined;\n+    if (run.taskRunId) {\n+      const taskRun = await ctx.db.get(run.taskRunId);\n+      if (taskRun) {\n+        taskId = taskRun.taskId;\n+      }\n+    }\n+\n+    return {\n+      ...run,\n+      taskId,\n+    };\n+  },\n+});\n+\n+/**\n+ * Get preview runs for multiple PRs at once (batch query for sidebar efficiency).\n+ * Returns a map of \"repoFullName#prNumber\" -> most recent preview run.\n+ */\n+export const getMostRecentForPrs = authQuery({\n+  args: {\n+    teamSlugOrId: v.string(),\n+    prs: v.array(\n+      v.object({\n+        repoFullName: v.string(),\n+        prNumber: v.number(),\n+      })\n+    ),\n+  },\n+  handler: async (ctx, args) => {\n+    const teamId = await getTeamId(ctx, args.teamSlugOrId);\n+\n+    // Group PRs by repo to minimize config lookups\n+    const prsByRepo = new Map<string, number[]>();\n+    for (const pr of args.prs) {\n+      const repo = normalizeRepoFullName(pr.repoFullName);\n+      const existing = prsByRepo.get(repo);\n+      if (existing) {\n+        existing.push(pr.prNumber);\n+      } else {\n+        prsByRepo.set(repo, [pr.prNumber]);\n+      }\n+    }\n+\n+    // Results map: \"repoFullName#prNumber\" -> preview run\n+    const results: Record<\n+      string,\n+      {\n+        _id: string;\n+        status: string;\n+        createdAt: number;\n+        completedAt?: number;\n+        headRef?: string;\n+        screenshotSetId?: string;\n+        taskId?: string;\n+      }\n+    > = {};\n+\n+    for (const [repoFullName, prNumbers] of prsByRepo) {\n+      // Find the preview config for this repo\n+      const config = await ctx.db\n+        .query(\"previewConfigs\")\n+        .withIndex(\"by_team_repo\", (q) =>\n+          q.eq(\"teamId\", teamId).eq(\"repoFullName\", repoFullName),\n+        )\n+        .first();\n+\n+      if (!config) {\n+        continue;\n+      }\n+\n+      // Get most recent preview run for each PR\n+      for (const prNumber of prNumbers) {\n+        const run = await ctx.db\n+          .query(\"previewRuns\")\n+          .withIndex(\"by_config_pr\", (q) =>\n+            q.eq(\"previewConfigId\", config._id).eq(\"prNumber\", prNumber),\n+          )\n+          .order(\"desc\")\n+          .first();\n+\n+        if (run) {\n+          let taskId = undefined;\n+          if (run.taskRunId) {\n+            const taskRun = await ctx.db.get(run.taskRunId);\n+            if (taskRun) {\n+              taskId = taskRun.taskId;\n+            }\n+          }\n+\n+          const key = `${repoFullName}#${prNumber}`;\n+          results[key] = {\n+            _id: run._id,\n+            status: run.status,\n+            createdAt: run.createdAt,\n+            completedAt: run.completedAt,\n+            headRef: run.headRef,\n+            screenshotSetId: run.screenshotSetId,\n+            taskId,\n+          };\n+        }\n+      }\n+    }\n+\n+    return results;\n+  },\n+});\n","comments":[{"type":"issue_comment","id":3608825330,"prNumber":1135,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7bc3m282rjc2pkrbwxsvwdws7wjdm2?src=preview.new) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7bc3m282rjc2pkrbwxsvwdws7wjdm2/browser?src=preview.new) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1135?src=preview.new)\n\nCaptured 2 screenshots for commit `369a3ef` (2025-12-03 21:01:48.660 UTC).\n\n**Full-page screenshot of the Previews tab showing preview runs grouped by PR number, with 'In Progress' (2 items) and 'Completed' (48 items) sections. Shows the new UI for collapsing duplicate preview runs and surfacing the latest ones, with PRs like #1135, #1134, #1133, and multiple entries for #1118 with different timestamps.**\n\n![previews-tab-overview-grouped-by-pr.png](https://famous-camel-162.convex.cloud/api/storage/a9de5d7d-951b-4065-b2c3-2af41b1e9ef7)\n\n![pull-requests-page-with-preview-status.png](https://famous-camel-162.convex.cloud/api/storage/f02776a7-4032-4be2-a04c-ce120eb6192d)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"369a3ef6227bf27aa21fdf9d68dd32a2187da2d9","createdAt":"2025-12-03T21:01:49Z","updatedAt":"2025-12-03T21:04:00Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1135#issuecomment-3608825330"},{"type":"issue_comment","id":3608832157,"prNumber":1135,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn7apd5j03etrp1swm0v0vv33s7wjd58?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn7apd5j03etrp1swm0v0vv33s7wjd58/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1135?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 3 screenshots for commit `369a3ef` (2025-12-03 21:03:58.238 UTC).\n\n**Full dashboard view showing the Tasks tab with sidebar containing PRs and preview items**\n\n![dashboard-tasks-view-full.png](https://adorable-wombat-701.convex.cloud/api/storage/f1359b79-cff9-40ba-bffe-5477d4fd6102)\n\n**Detailed viewport view of the Previews tab showing individual preview run entries with PR information, timestamps, and action buttons**\n\n![previews-tab-duplicate-entries-detail.png](https://adorable-wombat-701.convex.cloud/api/storage/2098be6b-311a-43b8-9b19-1b01ca451715)\n\n**Full view of the Previews tab showing preview runs organized by status \\(In Progress and Completed sections\\)**\n\n![previews-tab-with-duplicates-full.png](https://adorable-wombat-701.convex.cloud/api/storage/bd5408de-cf17-4e1b-b668-50385ca9036b)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"369a3ef6227bf27aa21fdf9d68dd32a2187da2d9","createdAt":"2025-12-03T21:03:59Z","updatedAt":"2025-12-03T21:03:59Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1135#issuecomment-3608832157"}]}
{"number":1130,"title":"Set default models to claude and opus-4.5","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1130","headRef":"cmux/set-default-models-to-claude-and-opus-4-5-qkpb9","headSha":"50c412dcab639c01164cc1f40529990c5b8593fd","baseRef":"main","baseSha":"7e48f7d1be7442c844ac699220eb38adfdccd693","createdAt":"2025-12-03T08:46:47Z","updatedAt":"2025-12-03T09:16:38Z","diff":"diff --git a/apps/client/src/routes/_layout.$teamSlugOrId.dashboard.tsx b/apps/client/src/routes/_layout.$teamSlugOrId.dashboard.tsx\nindex b24500110..eb6125de5 100644\n--- a/apps/client/src/routes/_layout.$teamSlugOrId.dashboard.tsx\n+++ b/apps/client/src/routes/_layout.$teamSlugOrId.dashboard.tsx\n@@ -65,11 +65,7 @@ export const Route = createFileRoute(\"/_layout/$teamSlugOrId/dashboard\")({\n });\n \n // Default agents (not persisted to localStorage)\n-const DEFAULT_AGENTS = [\n-  \"claude/sonnet-4.5\",\n-  \"claude/opus-4.1\",\n-  \"codex/gpt-5.1-codex-high\",\n-];\n+const DEFAULT_AGENTS = [\"claude/opus-4.5\"];\n const KNOWN_AGENT_NAMES = new Set(AGENT_CONFIGS.map((agent) => agent.name));\n const DEFAULT_AGENT_SELECTION = DEFAULT_AGENTS.filter((agent) =>\n   KNOWN_AGENT_NAMES.has(agent)\n","comments":[{"type":"issue_comment","id":3605782702,"prNumber":1130,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn705wgmab1ycpnw6pmab2c8ds7wj7ca?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn705wgmab1ycpnw6pmab2c8ds7wj7ca/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1130?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 4 screenshots for commit `50c412d` (2025-12-03 09:04:28.676 UTC).\n\n**Dashboard with agent selector button in closed state showing 'Select agents'**\n\n![dashboard-agent-selector-closed.png](https://adorable-wombat-701.convex.cloud/api/storage/9d5285b3-6686-4e94-97dd-f5288af00986)\n\n**Detailed view of the agent selector dropdown with all available agent options visible**\n\n![dashboard-agent-selector-dropdown-detail.png](https://adorable-wombat-701.convex.cloud/api/storage/5635eb53-eac7-43a6-b528-5401d9c59043)\n\n**Dashboard with agent selector dropdown opened, showing claude/opus-4.5 as the default selected agent**\n\n![dashboard-agent-selector-open.png](https://adorable-wombat-701.convex.cloud/api/storage/7119704a-11a7-438f-b220-bf6954f025bd)\n\n**Full-page screenshot of the dashboard with agent selector dropdown open**\n\n![dashboard-fullpage.png](https://adorable-wombat-701.convex.cloud/api/storage/a97353c5-02d6-4bdd-92a2-8dca6c39bf5b)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"50c412dcab639c01164cc1f40529990c5b8593fd","createdAt":"2025-12-03T09:04:31Z","updatedAt":"2025-12-03T09:04:31Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1130#issuecomment-3605782702"}]}
{"number":1129,"title":"Parallelize Rust crate CI workflows","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1129","headRef":"ci-cd-parallel-0","headSha":"267fb7630d902833bfd046463bcee2bdadd3bfb1","baseRef":"main","baseSha":"7e48f7d1be7442c844ac699220eb38adfdccd693","createdAt":"2025-12-03T07:46:12Z","updatedAt":"2025-12-03T08:59:50Z","diff":"diff --git a/.github/workflows/cmux-env.yml b/.github/workflows/cmux-env.yml\nnew file mode 100644\nindex 000000000..02622d330\n--- /dev/null\n+++ b/.github/workflows/cmux-env.yml\n@@ -0,0 +1,45 @@\n+name: cmux-env (Rust)\n+\n+on:\n+  push:\n+    branches: [main]\n+    paths:\n+      - crates/cmux-env/**\n+      - .github/workflows/cmux-env.yml\n+  pull_request:\n+    paths:\n+      - crates/cmux-env/**\n+      - .github/workflows/cmux-env.yml\n+  workflow_dispatch:\n+\n+jobs:\n+  rust-checks:\n+    name: Rust checks\n+    runs-on: ubuntu-24.04\n+    env:\n+      CARGO_TERM_COLOR: always\n+    steps:\n+      - name: Checkout\n+        uses: actions/checkout@v4\n+\n+      - name: Setup Rust\n+        uses: dtolnay/rust-toolchain@stable\n+        with:\n+          components: clippy, rustfmt\n+\n+      - name: Cache cargo registry + build\n+        uses: Swatinem/rust-cache@v2\n+        with:\n+          workspaces: crates/cmux-env\n+\n+      - name: Format\n+        run: cargo fmt --all -- --check\n+        working-directory: crates/cmux-env\n+\n+      - name: Clippy\n+        run: cargo clippy --all-targets --all-features -- -D warnings\n+        working-directory: crates/cmux-env\n+\n+      - name: Tests\n+        run: cargo test --all-features --locked\n+        working-directory: crates/cmux-env\ndiff --git a/.github/workflows/cmux-proxy.yml b/.github/workflows/cmux-proxy.yml\nnew file mode 100644\nindex 000000000..f765934ca\n--- /dev/null\n+++ b/.github/workflows/cmux-proxy.yml\n@@ -0,0 +1,45 @@\n+name: cmux-proxy (Rust)\n+\n+on:\n+  push:\n+    branches: [main]\n+    paths:\n+      - crates/cmux-proxy/**\n+      - .github/workflows/cmux-proxy.yml\n+  pull_request:\n+    paths:\n+      - crates/cmux-proxy/**\n+      - .github/workflows/cmux-proxy.yml\n+  workflow_dispatch:\n+\n+jobs:\n+  rust-checks:\n+    name: Rust checks\n+    runs-on: ubuntu-24.04\n+    env:\n+      CARGO_TERM_COLOR: always\n+    steps:\n+      - name: Checkout\n+        uses: actions/checkout@v4\n+\n+      - name: Setup Rust\n+        uses: dtolnay/rust-toolchain@stable\n+        with:\n+          components: clippy, rustfmt\n+\n+      - name: Cache cargo registry + build\n+        uses: Swatinem/rust-cache@v2\n+        with:\n+          workspaces: crates/cmux-proxy\n+\n+      - name: Format\n+        run: cargo fmt --all -- --check\n+        working-directory: crates/cmux-proxy\n+\n+      - name: Clippy\n+        run: cargo clippy --all-targets --all-features -- -D warnings\n+        working-directory: crates/cmux-proxy\n+\n+      - name: Tests\n+        run: cargo test --all-features --locked\n+        working-directory: crates/cmux-proxy\ndiff --git a/.github/workflows/cmux-xterm.yml b/.github/workflows/cmux-xterm.yml\nnew file mode 100644\nindex 000000000..3c4d90dd9\n--- /dev/null\n+++ b/.github/workflows/cmux-xterm.yml\n@@ -0,0 +1,45 @@\n+name: cmux-xterm (Rust)\n+\n+on:\n+  push:\n+    branches: [main]\n+    paths:\n+      - crates/cmux-xterm/**\n+      - .github/workflows/cmux-xterm.yml\n+  pull_request:\n+    paths:\n+      - crates/cmux-xterm/**\n+      - .github/workflows/cmux-xterm.yml\n+  workflow_dispatch:\n+\n+jobs:\n+  rust-checks:\n+    name: Rust checks\n+    runs-on: ubuntu-24.04\n+    env:\n+      CARGO_TERM_COLOR: always\n+    steps:\n+      - name: Checkout\n+        uses: actions/checkout@v4\n+\n+      - name: Setup Rust\n+        uses: dtolnay/rust-toolchain@stable\n+        with:\n+          components: clippy, rustfmt\n+\n+      - name: Cache cargo registry + build\n+        uses: Swatinem/rust-cache@v2\n+        with:\n+          workspaces: crates/cmux-xterm\n+\n+      - name: Format\n+        run: cargo fmt --all -- --check\n+        working-directory: crates/cmux-xterm\n+\n+      - name: Clippy\n+        run: cargo clippy --all-targets --all-features -- -D warnings\n+        working-directory: crates/cmux-xterm\n+\n+      - name: Tests\n+        run: cargo test --all-features --locked\n+        working-directory: crates/cmux-xterm\ndiff --git a/.github/workflows/global-proxy.yml b/.github/workflows/global-proxy.yml\nnew file mode 100644\nindex 000000000..d35b860b1\n--- /dev/null\n+++ b/.github/workflows/global-proxy.yml\n@@ -0,0 +1,45 @@\n+name: global-proxy (Rust)\n+\n+on:\n+  push:\n+    branches: [main]\n+    paths:\n+      - apps/global-proxy/**\n+      - .github/workflows/global-proxy.yml\n+  pull_request:\n+    paths:\n+      - apps/global-proxy/**\n+      - .github/workflows/global-proxy.yml\n+  workflow_dispatch:\n+\n+jobs:\n+  rust-checks:\n+    name: Rust checks\n+    runs-on: ubuntu-24.04\n+    env:\n+      CARGO_TERM_COLOR: always\n+    steps:\n+      - name: Checkout\n+        uses: actions/checkout@v4\n+\n+      - name: Setup Rust\n+        uses: dtolnay/rust-toolchain@stable\n+        with:\n+          components: clippy, rustfmt\n+\n+      - name: Cache cargo registry + build\n+        uses: Swatinem/rust-cache@v2\n+        with:\n+          workspaces: apps/global-proxy\n+\n+      - name: Format\n+        run: cargo fmt --all -- --check\n+        working-directory: apps/global-proxy\n+\n+      - name: Clippy\n+        run: cargo clippy --all-targets --all-features -- -D warnings\n+        working-directory: apps/global-proxy\n+\n+      - name: Tests\n+        run: cargo test --all-features --locked\n+        working-directory: apps/global-proxy\ndiff --git a/.github/workflows/native-core.yml b/.github/workflows/native-core.yml\nnew file mode 100644\nindex 000000000..686b17649\n--- /dev/null\n+++ b/.github/workflows/native-core.yml\n@@ -0,0 +1,45 @@\n+name: native-core (Rust)\n+\n+on:\n+  push:\n+    branches: [main]\n+    paths:\n+      - apps/server/native/core/**\n+      - .github/workflows/native-core.yml\n+  pull_request:\n+    paths:\n+      - apps/server/native/core/**\n+      - .github/workflows/native-core.yml\n+  workflow_dispatch:\n+\n+jobs:\n+  rust-checks:\n+    name: Rust checks\n+    runs-on: ubuntu-24.04\n+    env:\n+      CARGO_TERM_COLOR: always\n+    steps:\n+      - name: Checkout\n+        uses: actions/checkout@v4\n+\n+      - name: Setup Rust\n+        uses: dtolnay/rust-toolchain@stable\n+        with:\n+          components: clippy, rustfmt\n+\n+      - name: Cache cargo registry + build\n+        uses: Swatinem/rust-cache@v2\n+        with:\n+          workspaces: apps/server/native/core\n+\n+      - name: Format\n+        run: cargo fmt --all -- --check\n+        working-directory: apps/server/native/core\n+\n+      - name: Clippy\n+        run: cargo clippy --all-targets --all-features -- -D warnings\n+        working-directory: apps/server/native/core\n+\n+      - name: Tests\n+        run: cargo test --all-features --locked\n+        working-directory: apps/server/native/core\ndiff --git a/.github/workflows/tests.yml b/.github/workflows/tests.yml\nindex 9448dfd2e..f001fff9f 100644\n--- a/.github/workflows/tests.yml\n+++ b/.github/workflows/tests.yml\n@@ -47,14 +47,15 @@ jobs:\n       - name: Cache Cargo registry + build\n         uses: Swatinem/rust-cache@v2\n         with:\n-          workspaces: |\n-            apps/server/native/core\n-            crates/cmux-env\n-            crates/cmux-proxy\n+          workspaces: apps/server/native/core\n \n       - name: Install dependencies\n         run: bun install --frozen-lockfile\n \n+      - name: Build native-core addon\n+        run: bun run build\n+        working-directory: apps/server/native/core\n+\n       - name: Run tests\n         env:\n           # CI environment flag\n@@ -63,8 +64,8 @@ jobs:\n           CMUX_BUILD_LINUX: \"0\"\n           # Skip Docker E2E tests in CI for stability/speed\n           CMUX_SKIP_DOCKER_TESTS: \"1\"\n-          # Skip slow cargo crates handled in dedicated workflows\n-          CMUX_SKIP_CARGO_CRATES: \"sandbox\"\n+          # Skip cargo crates handled in dedicated workflows\n+          CMUX_SKIP_CARGO_CRATES: \"sandbox,cmux-env,cmux-xterm,cmux-proxy,global-proxy,server/native/core\"\n           # Stack Auth env vars\n           STACK_SECRET_SERVER_KEY: ${{ secrets.STACK_SECRET_SERVER_KEY }}\n           STACK_SUPER_SECRET_ADMIN_KEY: ${{ secrets.STACK_SUPER_SECRET_ADMIN_KEY }}\ndiff --git a/apps/global-proxy/src/lib.rs b/apps/global-proxy/src/lib.rs\nindex 1c5f9fead..1d30eba3a 100644\n--- a/apps/global-proxy/src/lib.rs\n+++ b/apps/global-proxy/src/lib.rs\n@@ -4,25 +4,25 @@ use std::{\n     sync::Arc,\n };\n \n+use brotli::Decompressor;\n use bytes::Bytes;\n+use flate2::read::{GzDecoder, ZlibDecoder};\n use http::{\n     HeaderMap, Method, Request, Response, StatusCode, Uri, Version,\n-    header::{self, HeaderValue, CONNECTION, UPGRADE},\n+    header::{self, CONNECTION, HeaderValue, UPGRADE},\n     uri::Scheme,\n };\n+use hyper::upgrade::Upgraded;\n use hyper::{\n     Body, Client, body,\n     client::HttpConnector,\n     server::conn::AddrStream,\n     service::{make_service_fn, service_fn},\n };\n-use hyper::upgrade::Upgraded;\n use hyper_rustls::HttpsConnectorBuilder;\n use lol_html::{HtmlRewriter, Settings, element, html_content::ContentType};\n-use flate2::read::{GzDecoder, ZlibDecoder};\n-use brotli::Decompressor;\n use tokio::{\n-    io::{copy_bidirectional, AsyncWriteExt},\n+    io::{AsyncWriteExt, copy_bidirectional},\n     sync::oneshot,\n     task::JoinHandle,\n };\n@@ -419,14 +419,11 @@ async fn forward_request(\n             response.status(),\n             StatusCode::METHOD_NOT_ALLOWED | StatusCode::NOT_IMPLEMENTED\n         )\n+        && let Some(context) = head_fallback_context\n+        && let Some(fallback) =\n+            handle_head_method_not_allowed(state, context, behavior.clone()).await\n     {\n-        if let Some(context) = head_fallback_context {\n-            if let Some(fallback) =\n-                handle_head_method_not_allowed(state, context, behavior.clone()).await\n-            {\n-                return fallback;\n-            }\n-        }\n+        return fallback;\n     }\n \n     transform_response(response, behavior).await\n@@ -456,10 +453,7 @@ async fn handle_head_method_not_allowed(\n     get_request.headers_mut().remove(header::CONTENT_LENGTH);\n \n     match state.client.request(get_request).await {\n-        Ok(resp) => match transform_head_response_from_get(resp, behavior).await {\n-            Ok(head_response) => Some(head_response),\n-            Err(_) => None,\n-        },\n+        Ok(resp) => (transform_head_response_from_get(resp, behavior).await).ok(),\n         Err(_) => None,\n     }\n }\n@@ -511,15 +505,15 @@ fn build_head_response(\n     if force_cors_headers && !behavior.strip_cors_headers {\n         add_cors_headers(&mut new_headers);\n     }\n-    if let Some(frame_ancestors) = behavior.frame_ancestors {\n-        if let Ok(value) = HeaderValue::from_str(frame_ancestors) {\n-            new_headers.insert(\"content-security-policy\", value);\n-        }\n+    if let Some(frame_ancestors) = behavior.frame_ancestors\n+        && let Ok(value) = HeaderValue::from_str(frame_ancestors)\n+    {\n+        new_headers.insert(\"content-security-policy\", value);\n     }\n-    if let Some(len) = body_len {\n-        if let Ok(value) = HeaderValue::from_str(&len.to_string()) {\n-            new_headers.insert(header::CONTENT_LENGTH, value);\n-        }\n+    if let Some(len) = body_len\n+        && let Ok(value) = HeaderValue::from_str(&len.to_string())\n+    {\n+        new_headers.insert(header::CONTENT_LENGTH, value);\n     }\n     let headers_mut = builder.headers_mut().unwrap();\n     for (name, value) in new_headers.iter() {\n@@ -554,15 +548,16 @@ async fn handle_websocket(\n         .map(|pq| pq.as_str())\n         .unwrap_or(\"/\");\n \n-    let backend_uri = match format!(\"{}://{}{}\", scheme.as_str(), authority, path_and_query).parse::<Uri>() {\n-        Ok(uri) => uri,\n-        Err(_) => {\n-            return text_response(\n-                StatusCode::BAD_GATEWAY,\n-                \"Failed to build upstream websocket URI\",\n-            );\n-        }\n-    };\n+    let backend_uri =\n+        match format!(\"{}://{}{}\", scheme.as_str(), authority, path_and_query).parse::<Uri>() {\n+            Ok(uri) => uri,\n+            Err(_) => {\n+                return text_response(\n+                    StatusCode::BAD_GATEWAY,\n+                    \"Failed to build upstream websocket URI\",\n+                );\n+            }\n+        };\n \n     let headers_to_forward = collect_forward_headers(req.headers(), &behavior);\n \n@@ -590,10 +585,11 @@ async fn handle_websocket(\n             .insert(name.clone(), value.clone());\n     }\n \n-    let (backend_stream, backend_headers) = match connect_upstream_websocket(state.client.clone(), backend_request).await {\n-        Ok(result) => result,\n-        Err(response) => return response,\n-    };\n+    let (backend_stream, backend_headers) =\n+        match connect_upstream_websocket(state.client.clone(), backend_request).await {\n+            Ok(result) => result,\n+            Err(response) => return response,\n+        };\n \n     let client_upgrade = hyper::upgrade::on(req);\n     let response = build_websocket_response(&backend_headers);\n@@ -626,19 +622,19 @@ fn collect_forward_headers(\n         http::HeaderMap::new()\n     };\n     headers.remove(header::HOST);\n-    if let Some(port) = &behavior.port_header {\n-        if let Ok(value) = HeaderValue::from_str(port) {\n-            headers.insert(\"X-Cmux-Port-Internal\", value);\n-        }\n+    if let Some(port) = &behavior.port_header\n+        && let Ok(value) = HeaderValue::from_str(port)\n+    {\n+        headers.insert(\"X-Cmux-Port-Internal\", value);\n     }\n     if let Some(workspace) = behavior.workspace_header.as_ref() {\n         if let Ok(value) = HeaderValue::from_str(workspace) {\n             headers.insert(\"X-Cmux-Workspace-Internal\", value);\n         }\n-    } else if let Some(workspace) = derive_workspace_scope_from_headers(original) {\n-        if let Ok(value) = HeaderValue::from_str(&workspace) {\n-            headers.insert(\"X-Cmux-Workspace-Internal\", value);\n-        }\n+    } else if let Some(workspace) = derive_workspace_scope_from_headers(original)\n+        && let Ok(value) = HeaderValue::from_str(&workspace)\n+    {\n+        headers.insert(\"X-Cmux-Workspace-Internal\", value);\n     }\n     headers.insert(\"X-Cmux-Proxied\", HeaderValue::from_static(\"true\"));\n \n@@ -672,9 +668,7 @@ fn scope_from_cmux_subdomain(subdomain: &str) -> Option<String> {\n     }\n \n     let port_segment = segments.last()?;\n-    if port_segment.parse::<u16>().ok().is_none() {\n-        return None;\n-    }\n+    port_segment.parse::<u16>().ok()?;\n \n     let scope_segments = &segments[1..segments.len() - 1];\n     if scope_segments.is_empty()\n@@ -708,7 +702,7 @@ async fn connect_upstream_websocket(\n         error!(%err, \"upstream websocket request error\");\n         text_response(\n             StatusCode::BAD_GATEWAY,\n-            \"Failed to connect to websocket backend\".into(),\n+            \"Failed to connect to websocket backend\",\n         )\n     })?;\n \n@@ -717,12 +711,10 @@ async fn connect_upstream_websocket(\n         let body_bytes = body::to_bytes(response.into_body())\n             .await\n             .unwrap_or_else(|_| Bytes::new());\n-        return Err(\n-            Response::builder()\n-                .status(status)\n-                .body(Body::from(body_bytes))\n-                .unwrap(),\n-        );\n+        return Err(Response::builder()\n+            .status(status)\n+            .body(Body::from(body_bytes))\n+            .unwrap());\n     }\n \n     let headers = response.headers().clone();\n@@ -732,7 +724,7 @@ async fn connect_upstream_websocket(\n             error!(%err, \"upstream websocket upgrade failed\");\n             Err(text_response(\n                 StatusCode::BAD_GATEWAY,\n-                \"Failed to upgrade websocket backend\".into(),\n+                \"Failed to upgrade websocket backend\",\n             ))\n         }\n     }\n@@ -757,10 +749,7 @@ fn build_websocket_response(headers: &HeaderMap) -> Response<Body> {\n     builder.body(Body::empty()).unwrap()\n }\n \n-async fn tunnel_upgraded(\n-    mut client: Upgraded,\n-    mut backend: Upgraded,\n-) -> io::Result<()> {\n+async fn tunnel_upgraded(mut client: Upgraded, mut backend: Upgraded) -> io::Result<()> {\n     let result = copy_bidirectional(&mut client, &mut backend).await;\n     let _ = client.shutdown().await;\n     let _ = backend.shutdown().await;\n@@ -784,20 +773,21 @@ async fn transform_response(response: Response<Body>, behavior: ProxyBehavior) -\n     if content_type.contains(\"text/html\") {\n         match body::to_bytes(response.into_body()).await {\n             Ok(bytes) => {\n-                let decoded = match decode_body_with_encoding(bytes.as_ref(), content_encoding.as_deref()) {\n-                    Ok(body) => Bytes::from(body),\n-                    Err(err) => {\n-                        warn!(%err, \"failed to decode upstream body; skipping rewrite\");\n-                        return forward_response_with_body(\n-                            status,\n-                            version,\n-                            &headers,\n-                            &behavior,\n-                            Body::from(bytes),\n-                            /* strip_payload_headers */ false,\n-                        );\n-                    }\n-                };\n+                let decoded =\n+                    match decode_body_with_encoding(bytes.as_ref(), content_encoding.as_deref()) {\n+                        Ok(body) => Bytes::from(body),\n+                        Err(err) => {\n+                            warn!(%err, \"failed to decode upstream body; skipping rewrite\");\n+                            return forward_response_with_body(\n+                                status,\n+                                version,\n+                                &headers,\n+                                &behavior,\n+                                Body::from(bytes),\n+                                /* strip_payload_headers */ false,\n+                            );\n+                        }\n+                    };\n                 match rewrite_html(decoded, behavior.skip_service_worker) {\n                     Ok(body) => {\n                         let mut builder = Response::builder().status(status).version(version);\n@@ -809,10 +799,10 @@ async fn transform_response(response: Response<Body>, behavior: ProxyBehavior) -\n                         } else if behavior.add_cors {\n                             add_cors_headers(&mut new_headers);\n                         }\n-                        if let Some(frame_ancestors) = behavior.frame_ancestors {\n-                            if let Ok(value) = HeaderValue::from_str(frame_ancestors) {\n-                                new_headers.insert(\"content-security-policy\", value);\n-                            }\n+                        if let Some(frame_ancestors) = behavior.frame_ancestors\n+                            && let Ok(value) = HeaderValue::from_str(frame_ancestors)\n+                        {\n+                            new_headers.insert(\"content-security-policy\", value);\n                         }\n                         new_headers.insert(\n                             header::CONTENT_LENGTH,\n@@ -824,7 +814,9 @@ async fn transform_response(response: Response<Body>, behavior: ProxyBehavior) -\n                         }\n                         builder.body(Body::from(body)).unwrap()\n                     }\n-                    Err(_) => text_response(StatusCode::INTERNAL_SERVER_ERROR, \"HTML rewrite failed\"),\n+                    Err(_) => {\n+                        text_response(StatusCode::INTERNAL_SERVER_ERROR, \"HTML rewrite failed\")\n+                    }\n                 }\n             }\n             Err(_) => text_response(StatusCode::BAD_GATEWAY, \"Failed to read upstream body\"),\n@@ -857,10 +849,10 @@ fn forward_response_with_body(\n     } else if behavior.add_cors {\n         add_cors_headers(&mut new_headers);\n     }\n-    if let Some(frame_ancestors) = behavior.frame_ancestors {\n-        if let Ok(value) = HeaderValue::from_str(frame_ancestors) {\n-            new_headers.insert(\"content-security-policy\", value);\n-        }\n+    if let Some(frame_ancestors) = behavior.frame_ancestors\n+        && let Ok(value) = HeaderValue::from_str(frame_ancestors)\n+    {\n+        new_headers.insert(\"content-security-policy\", value);\n     }\n     let headers_mut = builder.headers_mut().unwrap();\n     for (name, value) in new_headers.iter() {\n@@ -906,51 +898,6 @@ fn decode_body_with_encoding(bytes: &[u8], encoding: Option<&str>) -> io::Result\n     }\n }\n \n-#[cfg(test)]\n-mod tests {\n-    use super::decode_body_with_encoding;\n-    use flate2::{write::GzEncoder, Compression};\n-    use std::io::Write;\n-\n-    #[test]\n-    fn decodes_identity_and_none_encodings() {\n-        let payload = b\"hello world\";\n-        assert_eq!(\n-            decode_body_with_encoding(payload, None).unwrap(),\n-            payload\n-        );\n-        assert_eq!(\n-            decode_body_with_encoding(payload, Some(\"identity\")).unwrap(),\n-            payload\n-        );\n-        assert_eq!(\n-            decode_body_with_encoding(payload, Some(\"\")).unwrap(),\n-            payload\n-        );\n-    }\n-\n-    #[test]\n-    fn decodes_gzip_payloads() {\n-        let payload = b\"compressed content\";\n-        let compressed = gzip(payload);\n-        let decoded = decode_body_with_encoding(&compressed, Some(\"gzip\")).unwrap();\n-        assert_eq!(decoded, payload);\n-    }\n-\n-    #[test]\n-    fn errors_on_unsupported_encoding() {\n-        let payload = b\"noop\";\n-        let err = decode_body_with_encoding(payload, Some(\"unknown-enc\")).unwrap_err();\n-        assert_eq!(err.kind(), std::io::ErrorKind::InvalidData);\n-    }\n-\n-    fn gzip(payload: &[u8]) -> Vec<u8> {\n-        let mut encoder = GzEncoder::new(Vec::new(), Compression::default());\n-        encoder.write_all(payload).unwrap();\n-        encoder.finish().unwrap()\n-    }\n-}\n-\n fn sanitize_headers(headers: &HeaderMap, strip_payload_headers: bool) -> HeaderMap {\n     let ignored_payload_headers = [\n         \"content-length\",\n@@ -1032,10 +979,10 @@ fn rewrite_html(\n                     Ok(())\n                 }),\n                 element!(\"meta\", |el| {\n-                    if let Some(value) = el.get_attribute(\"http-equiv\") {\n-                        if value.eq_ignore_ascii_case(\"content-security-policy\") {\n-                            el.remove();\n-                        }\n+                    if let Some(value) = el.get_attribute(\"http-equiv\")\n+                        && value.eq_ignore_ascii_case(\"content-security-policy\")\n+                    {\n+                        el.remove();\n                     }\n                     Ok(())\n                 }),\n@@ -1255,10 +1202,10 @@ fn extract_host(req: &Request<Body>) -> Option<String> {\n \n fn normalize_host(value: &str) -> String {\n     let mut host = value.to_ascii_lowercase();\n-    if let Some(idx) = host.rfind(':') {\n-        if host[idx + 1..].chars().all(|c| c.is_ascii_digit()) {\n-            host.truncate(idx);\n-        }\n+    if let Some(idx) = host.rfind(':')\n+        && host[idx + 1..].chars().all(|c| c.is_ascii_digit())\n+    {\n+        host.truncate(idx);\n     }\n     host\n }\n@@ -1367,3 +1314,45 @@ fn service_worker_response() -> Response<Body> {\n         .body(Body::from(SERVICE_WORKER_JS))\n         .unwrap()\n }\n+\n+#[cfg(test)]\n+mod tests {\n+    use super::decode_body_with_encoding;\n+    use flate2::{Compression, write::GzEncoder};\n+    use std::io::Write;\n+\n+    #[test]\n+    fn decodes_identity_and_none_encodings() {\n+        let payload = b\"hello world\";\n+        assert_eq!(decode_body_with_encoding(payload, None).unwrap(), payload);\n+        assert_eq!(\n+            decode_body_with_encoding(payload, Some(\"identity\")).unwrap(),\n+            payload\n+        );\n+        assert_eq!(\n+            decode_body_with_encoding(payload, Some(\"\")).unwrap(),\n+            payload\n+        );\n+    }\n+\n+    #[test]\n+    fn decodes_gzip_payloads() {\n+        let payload = b\"compressed content\";\n+        let compressed = gzip(payload);\n+        let decoded = decode_body_with_encoding(&compressed, Some(\"gzip\")).unwrap();\n+        assert_eq!(decoded, payload);\n+    }\n+\n+    #[test]\n+    fn errors_on_unsupported_encoding() {\n+        let payload = b\"noop\";\n+        let err = decode_body_with_encoding(payload, Some(\"unknown-enc\")).unwrap_err();\n+        assert_eq!(err.kind(), std::io::ErrorKind::InvalidData);\n+    }\n+\n+    fn gzip(payload: &[u8]) -> Vec<u8> {\n+        let mut encoder = GzEncoder::new(Vec::new(), Compression::default());\n+        encoder.write_all(payload).unwrap();\n+        encoder.finish().unwrap()\n+    }\n+}\ndiff --git a/apps/global-proxy/tests/proxy_tests.rs b/apps/global-proxy/tests/proxy_tests.rs\nindex 69603d49e..9b9a241a8 100644\n--- a/apps/global-proxy/tests/proxy_tests.rs\n+++ b/apps/global-proxy/tests/proxy_tests.rs\n@@ -14,7 +14,8 @@ use hyper::{\n use reqwest::Method;\n use tokio::{sync::oneshot, task::JoinHandle};\n use tokio_tungstenite::tungstenite::{\n-    Message, client::IntoClientRequest,\n+    Message,\n+    client::IntoClientRequest,\n     handshake::server::{Request as WsHandshakeRequest, Response as WsHandshakeResponse},\n };\n \n@@ -26,9 +27,11 @@ struct TestProxy {\n \n impl TestProxy {\n     async fn spawn() -> Self {\n-        let mut config = ProxyConfig::default();\n-        config.bind_addr = SocketAddr::from((Ipv4Addr::LOCALHOST, 0));\n-        config.backend_host = \"127.0.0.1\".to_string();\n+        let config = ProxyConfig {\n+            bind_addr: SocketAddr::from((Ipv4Addr::LOCALHOST, 0)),\n+            backend_host: \"127.0.0.1\".to_string(),\n+            ..Default::default()\n+        };\n \n         let handle = spawn_proxy(config).await.expect(\"failed to start proxy\");\n \n@@ -241,19 +244,16 @@ impl TestWsBackend {\n         }\n     }\n \n-    async fn spawn_with_handshake(\n-        protocol: Option<&str>,\n-        extensions: Option<&str>,\n-    ) -> Self {\n+    async fn spawn_with_handshake(protocol: Option<&str>, extensions: Option<&str>) -> Self {\n         let listener = tokio::net::TcpListener::bind(SocketAddr::from((Ipv4Addr::LOCALHOST, 0)))\n             .await\n             .expect(\"ws bind\");\n         let addr = listener.local_addr().expect(\"ws addr\");\n         let (tx, mut rx) = oneshot::channel();\n-        let protocol_value = protocol\n-            .map(|value| HeaderValue::from_str(value).expect(\"protocol header\"));\n-        let extensions_value = extensions\n-            .map(|value| HeaderValue::from_str(value).expect(\"extensions header\"));\n+        let protocol_value =\n+            protocol.map(|value| HeaderValue::from_str(value).expect(\"protocol header\"));\n+        let extensions_value =\n+            extensions.map(|value| HeaderValue::from_str(value).expect(\"extensions header\"));\n \n         let task = tokio::spawn(async move {\n             loop {\n@@ -756,8 +756,7 @@ async fn html_responses_inject_scripts() {\n \n #[tokio::test]\n async fn html_with_unsupported_encoding_skips_rewrite() {\n-    static HTML_BODY: &str =\n-        \"<!DOCTYPE html><html><head><title>Encoded</title></head><body>Encoded Content</body></html>\";\n+    static HTML_BODY: &str = \"<!DOCTYPE html><html><head><title>Encoded</title></head><body>Encoded Content</body></html>\";\n     let backend = TestHttpBackend::serve(Arc::new(|_req| {\n         Response::builder()\n             .status(StatusCode::OK)\n@@ -897,19 +896,12 @@ async fn port_39378_strips_cors_and_applies_csp() {\n         );\n     }\n     assert!(\n-        cmux_headers\n-            .get(\"content-security-policy\")\n-            .is_none(),\n+        cmux_headers.get(\"content-security-policy\").is_none(),\n         \"CSP should remain stripped for cmux host\"\n     );\n \n     let cmux_localhost_response = proxy\n-        .request(\n-            Method::GET,\n-            \"cmux-test-base-39378.cmux.localhost\",\n-            \"/\",\n-            &[],\n-        )\n+        .request(Method::GET, \"cmux-test-base-39378.cmux.localhost\", \"/\", &[])\n         .await;\n     assert_eq!(cmux_localhost_response.status(), StatusCode::OK);\n     for name in [\n@@ -1180,8 +1172,7 @@ async fn websocket_proxy_for_cmux_route() {\n \n #[tokio::test]\n async fn websocket_subprotocol_matches_backend_choice() {\n-    let backend =\n-        TestWsBackend::spawn_with_handshake(Some(\"vite-hmr\"), None).await;\n+    let backend = TestWsBackend::spawn_with_handshake(Some(\"vite-hmr\"), None).await;\n     let proxy = TestProxy::spawn().await;\n     let host = format!(\"cmux-demo-feature-{}.cmux.sh\", backend.port());\n \n@@ -1190,9 +1181,10 @@ async fn websocket_subprotocol_matches_backend_choice() {\n     request\n         .headers_mut()\n         .insert(\"Host\", host.parse().expect(\"host header\"));\n-    request\n-        .headers_mut()\n-        .insert(\"Sec-WebSocket-Protocol\", HeaderValue::from_str(\"foo, vite-hmr\").unwrap());\n+    request.headers_mut().insert(\n+        \"Sec-WebSocket-Protocol\",\n+        HeaderValue::from_str(\"foo, vite-hmr\").unwrap(),\n+    );\n \n     let (mut ws, response) = tokio_tungstenite::connect_async(request)\n         .await\n@@ -1216,8 +1208,7 @@ async fn websocket_subprotocol_matches_backend_choice() {\n \n #[tokio::test]\n async fn websocket_extensions_are_forwarded() {\n-    let backend =\n-        TestWsBackend::spawn_with_handshake(None, Some(\"permessage-deflate\")).await;\n+    let backend = TestWsBackend::spawn_with_handshake(None, Some(\"permessage-deflate\")).await;\n     let proxy = TestProxy::spawn().await;\n     let host = format!(\"cmux-demo-feature-{}.cmux.sh\", backend.port());\n \n@@ -1226,9 +1217,10 @@ async fn websocket_extensions_are_forwarded() {\n     request\n         .headers_mut()\n         .insert(\"Host\", host.parse().expect(\"host header\"));\n-    request\n-        .headers_mut()\n-        .insert(\"Sec-WebSocket-Extensions\", HeaderValue::from_static(\"permessage-deflate\"));\n+    request.headers_mut().insert(\n+        \"Sec-WebSocket-Extensions\",\n+        HeaderValue::from_static(\"permessage-deflate\"),\n+    );\n \n     let (mut ws, response) = tokio_tungstenite::connect_async(request)\n         .await\ndiff --git a/apps/server/native/core/src/branches.rs b/apps/server/native/core/src/branches.rs\nindex c850ceeb7..57fe4b3d8 100644\n--- a/apps/server/native/core/src/branches.rs\n+++ b/apps/server/native/core/src/branches.rs\n@@ -1,214 +1,247 @@\n use anyhow::Result;\n use gix::bstr::ByteSlice;\n-use gix::{hash::ObjectId};\n+use gix::hash::ObjectId;\n \n use crate::repo::cache::{ensure_repo, resolve_repo_url, swr_fetch_origin_all_path};\n use crate::types::{BranchInfo, GitListRemoteBranchesOptions};\n \n fn refname_to_branch(name: &str) -> Option<(String /*remote*/, String /*branch*/)> {\n-  // Expect refs/remotes/<remote>/<branch>\n-  let p = name.strip_prefix(\"refs/remotes/\")?;\n-  let mut it = p.splitn(2, '/');\n-  let remote = it.next().unwrap_or(\"\");\n-  let branch = it.next().unwrap_or(\"\");\n-  if branch.is_empty() || branch == \"HEAD\" { return None; }\n-  Some((remote.to_string(), branch.to_string()))\n+    // Expect refs/remotes/<remote>/<branch>\n+    let p = name.strip_prefix(\"refs/remotes/\")?;\n+    let mut it = p.splitn(2, '/');\n+    let remote = it.next().unwrap_or(\"\");\n+    let branch = it.next().unwrap_or(\"\");\n+    if branch.is_empty() || branch == \"HEAD\" {\n+        return None;\n+    }\n+    Some((remote.to_string(), branch.to_string()))\n }\n \n fn oid_to_hex(oid: ObjectId) -> String {\n-  oid.to_hex().to_string()\n+    oid.to_hex().to_string()\n }\n \n pub fn list_remote_branches(opts: GitListRemoteBranchesOptions) -> Result<Vec<BranchInfo>> {\n-  // Resolve local repo path\n-  let repo_path = if let Some(p) = &opts.originPathOverride {\n-    std::path::PathBuf::from(p)\n-  } else {\n-    let url = resolve_repo_url(opts.repoFullName.as_deref(), opts.repoUrl.as_deref())?;\n-    ensure_repo(&url)?\n-  };\n-\n-  // Make sure remotes are fresh (this is cheap if within SWR window)\n-  let _ = swr_fetch_origin_all_path(&repo_path, crate::repo::cache::fetch_window_ms());\n-\n-  let repo = gix::open(&repo_path)?;\n-\n-  // Iterate remote refs and assemble info\n-  let refs = repo.references()?;\n-  let mut out: Vec<BranchInfo> = Vec::new();\n-  let mut iter = refs.all()?;\n-\n-  // Determine origin/HEAD target branch (short name)\n-  let mut origin_head_short: Option<String> = None;\n-  if let Ok(head_ref) = repo.find_reference(\"refs/remotes/origin/HEAD\") {\n-    if let Some(name) = head_ref.target().try_name() {\n-      let s = name.as_bstr().to_str_lossy().into_owned();\n-      if let Some((remote, short)) = refname_to_branch(&s) {\n-        if remote == \"origin\" {\n-          origin_head_short = Some(short);\n-        }\n-      }\n-    }\n-  }\n-\n-  while let Some(r) = iter.next() {\n-    let r = match r {\n-      Ok(v) => v,\n-      Err(_) => continue,\n+    // Resolve local repo path\n+    let repo_path = if let Some(p) = &opts.originPathOverride {\n+        std::path::PathBuf::from(p)\n+    } else {\n+        let url = resolve_repo_url(opts.repoFullName.as_deref(), opts.repoUrl.as_deref())?;\n+        ensure_repo(&url)?\n     };\n-    let name = r.name().as_bstr().to_str_lossy().into_owned();\n-    if !name.starts_with(\"refs/remotes/\") { continue; }\n-    let Some((remote, short)) = refname_to_branch(&name) else { continue };\n-    if remote != \"origin\" { continue; }\n-\n-    // Resolve target OID (skip symbolic remote/HEAD)\n-    let tgt = r.target();\n-    let Some(id_ref) = tgt.try_id() else { continue };\n-    let id: ObjectId = id_ref.to_owned();\n-    // Read commit to get committer time; if it's not a commit, skip time\n-    let mut last_ts: Option<i64> = None;\n-    if let Ok(obj) = repo.find_object(id) {\n-      if let Ok(commit) = obj.try_into_commit() {\n-        // Prefer committer time, then author time\n-        let t = commit\n-          .committer()\n-          .ok()\n-          .map(|sig| sig.time)\n-          .or_else(|| commit.author().ok().map(|sig| sig.time));\n-        if let Some(t) = t {\n-          last_ts = Some((t.seconds as i64) * 1000);\n+\n+    // Make sure remotes are fresh (this is cheap if within SWR window)\n+    let _ = swr_fetch_origin_all_path(&repo_path, crate::repo::cache::fetch_window_ms());\n+\n+    let repo = gix::open(&repo_path)?;\n+\n+    // Iterate remote refs and assemble info\n+    let refs = repo.references()?;\n+    let mut out: Vec<BranchInfo> = Vec::new();\n+    let iter = refs.all()?;\n+\n+    // Determine origin/HEAD target branch (short name)\n+    let mut origin_head_short: Option<String> = None;\n+    if let Ok(head_ref) = repo.find_reference(\"refs/remotes/origin/HEAD\") {\n+        if let Some(name) = head_ref.target().try_name() {\n+            let s = name.as_bstr().to_str_lossy().into_owned();\n+            if let Some((remote, short)) = refname_to_branch(&s) {\n+                if remote == \"origin\" {\n+                    origin_head_short = Some(short);\n+                }\n+            }\n         }\n-      }\n     }\n \n-    let is_default = origin_head_short\n-      .as_ref()\n-      .map(|h| h == &short)\n-      .unwrap_or(false);\n-    out.push(BranchInfo {\n-      name: short,\n-      lastCommitSha: Some(oid_to_hex(id)),\n-      lastActivityAt: last_ts,\n-      isDefault: Some(is_default),\n-      lastKnownBaseSha: None,\n-      lastKnownMergeCommitSha: None,\n-    });\n-  }\n-\n-  // Sort: pin main/dev/master/develop first; then by activity desc; then name asc\n-  fn pin_rank(name: &str) -> i32 {\n-    match name {\n-      \"main\" => 0,\n-      \"dev\" => 1,\n-      \"master\" => 2,\n-      \"develop\" => 3,\n-      _ => i32::MAX,\n-    }\n-  }\n-\n-  let head = origin_head_short.clone();\n-  out.sort_by(|a, b| {\n-    if let Some(h) = &head {\n-      let a_is_head = &a.name == h;\n-      let b_is_head = &b.name == h;\n-      if a_is_head != b_is_head {\n-        return if a_is_head {\n-          std::cmp::Ordering::Less\n-        } else {\n-          std::cmp::Ordering::Greater\n+    for r in iter {\n+        let r = match r {\n+            Ok(v) => v,\n+            Err(_) => continue,\n         };\n-      }\n-    }\n-    let pa = pin_rank(&a.name);\n-    let pb = pin_rank(&b.name);\n-    if pa != pb {\n-      return pa.cmp(&pb);\n+        let name = r.name().as_bstr().to_str_lossy().into_owned();\n+        if !name.starts_with(\"refs/remotes/\") {\n+            continue;\n+        }\n+        let Some((remote, short)) = refname_to_branch(&name) else {\n+            continue;\n+        };\n+        if remote != \"origin\" {\n+            continue;\n+        }\n+\n+        // Resolve target OID (skip symbolic remote/HEAD)\n+        let tgt = r.target();\n+        let Some(id_ref) = tgt.try_id() else { continue };\n+        let id: ObjectId = id_ref.to_owned();\n+        // Read commit to get committer time; if it's not a commit, skip time\n+        let mut last_ts: Option<i64> = None;\n+        if let Ok(obj) = repo.find_object(id) {\n+            if let Ok(commit) = obj.try_into_commit() {\n+                // Prefer committer time, then author time\n+                let t = commit\n+                    .committer()\n+                    .ok()\n+                    .map(|sig| sig.time)\n+                    .or_else(|| commit.author().ok().map(|sig| sig.time));\n+                if let Some(t) = t {\n+                    last_ts = Some(t.seconds * 1000);\n+                }\n+            }\n+        }\n+\n+        let is_default = origin_head_short\n+            .as_ref()\n+            .map(|h| h == &short)\n+            .unwrap_or(false);\n+        out.push(BranchInfo {\n+            name: short,\n+            lastCommitSha: Some(oid_to_hex(id)),\n+            lastActivityAt: last_ts,\n+            isDefault: Some(is_default),\n+            lastKnownBaseSha: None,\n+            lastKnownMergeCommitSha: None,\n+        });\n     }\n-    let at = a.lastActivityAt.unwrap_or(i64::MIN);\n-    let bt = b.lastActivityAt.unwrap_or(i64::MIN);\n-    if at != bt {\n-      return bt.cmp(&at);\n+\n+    // Sort: pin main/dev/master/develop first; then by activity desc; then name asc\n+    fn pin_rank(name: &str) -> i32 {\n+        match name {\n+            \"main\" => 0,\n+            \"dev\" => 1,\n+            \"master\" => 2,\n+            \"develop\" => 3,\n+            _ => i32::MAX,\n+        }\n     }\n-    a.name.cmp(&b.name)\n-  });\n \n-  Ok(out)\n+    let head = origin_head_short.clone();\n+    out.sort_by(|a, b| {\n+        if let Some(h) = &head {\n+            let a_is_head = &a.name == h;\n+            let b_is_head = &b.name == h;\n+            if a_is_head != b_is_head {\n+                return if a_is_head {\n+                    std::cmp::Ordering::Less\n+                } else {\n+                    std::cmp::Ordering::Greater\n+                };\n+            }\n+        }\n+        let pa = pin_rank(&a.name);\n+        let pb = pin_rank(&b.name);\n+        if pa != pb {\n+            return pa.cmp(&pb);\n+        }\n+        let at = a.lastActivityAt.unwrap_or(i64::MIN);\n+        let bt = b.lastActivityAt.unwrap_or(i64::MIN);\n+        if at != bt {\n+            return bt.cmp(&at);\n+        }\n+        a.name.cmp(&b.name)\n+    });\n+\n+    Ok(out)\n }\n \n #[cfg(test)]\n mod tests {\n-  use super::*;\n-  use tempfile::tempdir;\n-  use std::fs;\n-  use crate::util::run_git;\n-\n-  #[test]\n-  fn lists_and_sorts_origin_remote_branches() {\n-    let tmp = tempdir().expect(\"tempdir\");\n-    let root = tmp.path();\n-\n-    // Create bare origin\n-    let origin_path = root.join(\"origin.git\");\n-    fs::create_dir_all(&origin_path).unwrap();\n-    run_git(root.to_str().unwrap(), &[\"init\", \"--bare\", origin_path.file_name().unwrap().to_str().unwrap()]).expect(\"init bare\");\n-\n-    // Create seed repo, make branches and commits\n-    let seed = root.join(\"seed\");\n-    fs::create_dir_all(&seed).unwrap();\n-    run_git(seed.to_str().unwrap(), &[\"init\"]).expect(\"init seed\");\n-    run_git(seed.to_str().unwrap(), &[\"config\", \"user.name\", \"Test\"]).unwrap();\n-    run_git(seed.to_str().unwrap(), &[\"config\", \"user.email\", \"test@example.com\"]).unwrap();\n-    // main branch with initial commit\n-    run_git(seed.to_str().unwrap(), &[\"checkout\", \"-b\", \"main\"]).unwrap();\n-    fs::write(seed.join(\"a.txt\"), b\"one\").unwrap();\n-    run_git(seed.to_str().unwrap(), &[\"add\", \".\"]).unwrap();\n-    run_git(seed.to_str().unwrap(), &[\"commit\", \"-m\", \"initial\"]).unwrap();\n-    // dev branch with a commit\n-    run_git(seed.to_str().unwrap(), &[\"checkout\", \"-b\", \"dev\"]).unwrap();\n-    fs::write(seed.join(\"a.txt\"), b\"two\").unwrap();\n-    run_git(seed.to_str().unwrap(), &[\"commit\", \"-am\", \"dev1\"]).unwrap();\n-    // feature branch with a commit\n-    run_git(seed.to_str().unwrap(), &[\"checkout\", \"-b\", \"feature\"]).unwrap();\n-    fs::write(seed.join(\"a.txt\"), b\"three\").unwrap();\n-    run_git(seed.to_str().unwrap(), &[\"commit\", \"-am\", \"feature1\"]).unwrap();\n-    // Bump main to be most recent\n-    run_git(seed.to_str().unwrap(), &[\"checkout\", \"main\"]).unwrap();\n-    fs::write(seed.join(\"a.txt\"), b\"main2\").unwrap();\n-    run_git(seed.to_str().unwrap(), &[\"commit\", \"-am\", \"main2\"]).unwrap();\n-\n-    // Push to origin\n-    let origin_url = origin_path.to_string_lossy().to_string();\n-    run_git(seed.to_str().unwrap(), &[\"remote\", \"add\", \"origin\", &origin_url]).unwrap();\n-    run_git(seed.to_str().unwrap(), &[\"push\", \"-u\", \"origin\", \"main\"]).unwrap();\n-    run_git(\n-      origin_path.to_str().unwrap(),\n-      &[\"symbolic-ref\", \"HEAD\", \"refs/heads/main\"]\n-    )\n-    .unwrap();\n-    run_git(seed.to_str().unwrap(), &[\"push\", \"-u\", \"origin\", \"dev\"]).unwrap();\n-    run_git(seed.to_str().unwrap(), &[\"push\", \"-u\", \"origin\", \"feature\"]).unwrap();\n-\n-    // Fresh clone to obtain refs/remotes/origin/*\n-    let clone = root.join(\"clone\");\n-    run_git(root.to_str().unwrap(), &[\"clone\", &origin_url, clone.file_name().unwrap().to_str().unwrap()]).unwrap();\n-\n-    let res = list_remote_branches(GitListRemoteBranchesOptions {\n-      repoFullName: None,\n-      repoUrl: None,\n-      originPathOverride: Some(clone.to_string_lossy().to_string()),\n-    }).expect(\"list branches\");\n-    let names: Vec<String> = res.iter().map(|b| b.name.clone()).collect();\n-\n-    // Expect pinned and sorted: main first, dev second\n-    let idx_main = names.iter().position(|n| n == \"main\").unwrap();\n-    let idx_dev = names.iter().position(|n| n == \"dev\").unwrap();\n-    let idx_feat = names.iter().position(|n| n == \"feature\").unwrap();\n-    assert_eq!(idx_main, 0, \"main should be first\");\n-    assert_eq!(idx_dev, 1, \"dev should be second due to pinning\");\n-    assert!(idx_feat >= 2, \"feature should come after pinned branches\");\n-\n-    // Verify isDefault marker for main\n-    let main_row = res.iter().find(|b| b.name == \"main\").unwrap();\n-    assert_eq!(main_row.isDefault, Some(true));\n-  }\n+    use super::*;\n+    use crate::util::run_git;\n+    use std::fs;\n+    use tempfile::tempdir;\n+\n+    #[test]\n+    fn lists_and_sorts_origin_remote_branches() {\n+        let tmp = tempdir().expect(\"tempdir\");\n+        let root = tmp.path();\n+\n+        // Create bare origin\n+        let origin_path = root.join(\"origin.git\");\n+        fs::create_dir_all(&origin_path).unwrap();\n+        run_git(\n+            root.to_str().unwrap(),\n+            &[\n+                \"init\",\n+                \"--bare\",\n+                origin_path.file_name().unwrap().to_str().unwrap(),\n+            ],\n+        )\n+        .expect(\"init bare\");\n+\n+        // Create seed repo, make branches and commits\n+        let seed = root.join(\"seed\");\n+        fs::create_dir_all(&seed).unwrap();\n+        run_git(seed.to_str().unwrap(), &[\"init\"]).expect(\"init seed\");\n+        run_git(seed.to_str().unwrap(), &[\"config\", \"user.name\", \"Test\"]).unwrap();\n+        run_git(\n+            seed.to_str().unwrap(),\n+            &[\"config\", \"user.email\", \"test@example.com\"],\n+        )\n+        .unwrap();\n+        // main branch with initial commit\n+        run_git(seed.to_str().unwrap(), &[\"checkout\", \"-b\", \"main\"]).unwrap();\n+        fs::write(seed.join(\"a.txt\"), b\"one\").unwrap();\n+        run_git(seed.to_str().unwrap(), &[\"add\", \".\"]).unwrap();\n+        run_git(seed.to_str().unwrap(), &[\"commit\", \"-m\", \"initial\"]).unwrap();\n+        // dev branch with a commit\n+        run_git(seed.to_str().unwrap(), &[\"checkout\", \"-b\", \"dev\"]).unwrap();\n+        fs::write(seed.join(\"a.txt\"), b\"two\").unwrap();\n+        run_git(seed.to_str().unwrap(), &[\"commit\", \"-am\", \"dev1\"]).unwrap();\n+        // feature branch with a commit\n+        run_git(seed.to_str().unwrap(), &[\"checkout\", \"-b\", \"feature\"]).unwrap();\n+        fs::write(seed.join(\"a.txt\"), b\"three\").unwrap();\n+        run_git(seed.to_str().unwrap(), &[\"commit\", \"-am\", \"feature1\"]).unwrap();\n+        // Bump main to be most recent\n+        run_git(seed.to_str().unwrap(), &[\"checkout\", \"main\"]).unwrap();\n+        fs::write(seed.join(\"a.txt\"), b\"main2\").unwrap();\n+        run_git(seed.to_str().unwrap(), &[\"commit\", \"-am\", \"main2\"]).unwrap();\n+\n+        // Push to origin\n+        let origin_url = origin_path.to_string_lossy().to_string();\n+        run_git(\n+            seed.to_str().unwrap(),\n+            &[\"remote\", \"add\", \"origin\", &origin_url],\n+        )\n+        .unwrap();\n+        run_git(seed.to_str().unwrap(), &[\"push\", \"-u\", \"origin\", \"main\"]).unwrap();\n+        run_git(\n+            origin_path.to_str().unwrap(),\n+            &[\"symbolic-ref\", \"HEAD\", \"refs/heads/main\"],\n+        )\n+        .unwrap();\n+        run_git(seed.to_str().unwrap(), &[\"push\", \"-u\", \"origin\", \"dev\"]).unwrap();\n+        run_git(seed.to_str().unwrap(), &[\"push\", \"-u\", \"origin\", \"feature\"]).unwrap();\n+\n+        // Fresh clone to obtain refs/remotes/origin/*\n+        let clone = root.join(\"clone\");\n+        run_git(\n+            root.to_str().unwrap(),\n+            &[\n+                \"clone\",\n+                &origin_url,\n+                clone.file_name().unwrap().to_str().unwrap(),\n+            ],\n+        )\n+        .unwrap();\n+\n+        let res = list_remote_branches(GitListRemoteBranchesOptions {\n+            repoFullName: None,\n+            repoUrl: None,\n+            originPathOverride: Some(clone.to_string_lossy().to_string()),\n+        })\n+        .expect(\"list branches\");\n+        let names: Vec<String> = res.iter().map(|b| b.name.clone()).collect();\n+\n+        // Expect pinned and sorted: main first, dev second\n+        let idx_main = names.iter().position(|n| n == \"main\").unwrap();\n+        let idx_dev = names.iter().position(|n| n == \"dev\").unwrap();\n+        let idx_feat = names.iter().position(|n| n == \"feature\").unwrap();\n+        assert_eq!(idx_main, 0, \"main should be first\");\n+        assert_eq!(idx_dev, 1, \"dev should be second due to pinning\");\n+        assert!(idx_feat >= 2, \"feature should come after pinned branches\");\n+\n+        // Verify isDefault marker for main\n+        let main_row = res.iter().find(|b| b.name == \"main\").unwrap();\n+        assert_eq!(main_row.isDefault, Some(true));\n+    }\n }\ndiff --git a/apps/server/native/core/src/diff/mod.rs b/apps/server/native/core/src/diff/mod.rs\nindex 6d08a1d95..aa4981b22 100644\n--- a/apps/server/native/core/src/diff/mod.rs\n+++ b/apps/server/native/core/src/diff/mod.rs\n@@ -1,3 +1,3 @@\n+pub mod refs;\n #[cfg(test)]\n pub mod workspace;\n-pub mod refs;\ndiff --git a/apps/server/native/core/src/diff/refs.rs b/apps/server/native/core/src/diff/refs.rs\nindex fd6ca8eb9..64499be57 100644\n--- a/apps/server/native/core/src/diff/refs.rs\n+++ b/apps/server/native/core/src/diff/refs.rs\n@@ -1,511 +1,592 @@\n use anyhow::Result;\n use gix::bstr::ByteSlice;\n-use std::collections::HashMap;\n-use std::time::{Duration, Instant};\n #[cfg(test)]\n use std::cell::RefCell;\n+use std::collections::HashMap;\n+use std::time::{Duration, Instant};\n \n use crate::{\n-  repo::cache::{ensure_repo, resolve_repo_url},\n-  types::{DiffEntry, GitDiffOptions},\n+    repo::cache::{ensure_repo, resolve_repo_url},\n+    types::{DiffEntry, GitDiffOptions},\n };\n-use gix::{Repository, hash::ObjectId};\n+use gix::{hash::ObjectId, Repository};\n use similar::TextDiff;\n \n fn oid_from_rev_parse(repo: &Repository, rev: &str) -> anyhow::Result<ObjectId> {\n-  if let Ok(oid) = ObjectId::from_hex(rev.as_bytes()) { return Ok(oid); }\n-  let candidates = [\n-    rev.to_string(),\n-    format!(\"refs/remotes/origin/{}\", rev),\n-    format!(\"refs/heads/{}\", rev),\n-    format!(\"refs/tags/{}\", rev),\n-  ];\n-  for cand in candidates {\n-    if let Ok(r) = repo.find_reference(&cand) {\n-      if let Some(id) = r.target().try_id() { return Ok(id.to_owned()); }\n+    if let Ok(oid) = ObjectId::from_hex(rev.as_bytes()) {\n+        return Ok(oid);\n+    }\n+    let candidates = [\n+        rev.to_string(),\n+        format!(\"refs/remotes/origin/{}\", rev),\n+        format!(\"refs/heads/{}\", rev),\n+        format!(\"refs/tags/{}\", rev),\n+    ];\n+    for cand in candidates {\n+        if let Ok(r) = repo.find_reference(&cand) {\n+            if let Some(id) = r.target().try_id() {\n+                return Ok(id.to_owned());\n+            }\n+        }\n     }\n-  }\n-  if let Ok(spec) = repo.rev_parse_single(rev) {\n-    if let Ok(obj) = spec.object() { return Ok(obj.id); }\n-  }\n-  Err(anyhow::anyhow!(\"could not resolve rev '{}'\", rev))\n+    if let Ok(spec) = repo.rev_parse_single(rev) {\n+        if let Ok(obj) = spec.object() {\n+            return Ok(obj.id);\n+        }\n+    }\n+    Err(anyhow::anyhow!(\"could not resolve rev '{}'\", rev))\n }\n \n fn is_binary(data: &[u8]) -> bool {\n-  data.iter().any(|&b| b == 0) || std::str::from_utf8(data).is_err()\n+    data.contains(&0) || std::str::from_utf8(data).is_err()\n }\n \n-fn collect_tree_blobs(repo: &Repository, tree_id: ObjectId, prefix: &str, out: &mut HashMap<String, ObjectId>) -> anyhow::Result<()> {\n-  let obj = repo.find_object(tree_id)?;\n-  let tree = obj.try_into_tree()?;\n-  for entry_res in tree.iter() {\n-    let entry = entry_res?;\n-    let name = entry.filename().to_str_lossy().into_owned();\n-    let full = if prefix.is_empty() { name.clone() } else { format!(\"{}/{}\", prefix, name) };\n-    let mode = entry.mode();\n-    if mode.is_tree() {\n-      let id = entry.oid().to_owned();\n-      collect_tree_blobs(repo, id, &full, out)?;\n-    } else {\n-      let id = entry.oid().to_owned();\n-      out.insert(full, id);\n+fn collect_tree_blobs(\n+    repo: &Repository,\n+    tree_id: ObjectId,\n+    prefix: &str,\n+    out: &mut HashMap<String, ObjectId>,\n+) -> anyhow::Result<()> {\n+    let obj = repo.find_object(tree_id)?;\n+    let tree = obj.try_into_tree()?;\n+    for entry_res in tree.iter() {\n+        let entry = entry_res?;\n+        let name = entry.filename().to_str_lossy().into_owned();\n+        let full = if prefix.is_empty() {\n+            name.clone()\n+        } else {\n+            format!(\"{}/{}\", prefix, name)\n+        };\n+        let mode = entry.mode();\n+        if mode.is_tree() {\n+            let id = entry.oid().to_owned();\n+            collect_tree_blobs(repo, id, &full, out)?;\n+        } else {\n+            let id = entry.oid().to_owned();\n+            out.insert(full, id);\n+        }\n     }\n-  }\n-  Ok(())\n+    Ok(())\n }\n \n fn resolve_default_base(repo: &Repository, head_oid: ObjectId) -> ObjectId {\n-  if let Ok(r) = repo.find_reference(\"refs/remotes/origin/HEAD\") {\n-    if let Some(name) = r.target().try_name() {\n-      let s = name.as_bstr().to_str_lossy().into_owned();\n-      if let Ok(rr) = repo.find_reference(&s) {\n-        if let Some(id) = rr.target().try_id() {\n-          return id.to_owned();\n+    if let Ok(r) = repo.find_reference(\"refs/remotes/origin/HEAD\") {\n+        if let Some(name) = r.target().try_name() {\n+            let s = name.as_bstr().to_str_lossy().into_owned();\n+            if let Ok(rr) = repo.find_reference(&s) {\n+                if let Some(id) = rr.target().try_id() {\n+                    return id.to_owned();\n+                }\n+            }\n         }\n-      }\n     }\n-  }\n-  if let Ok(r) = repo.find_reference(\"refs/remotes/origin/main\") {\n-    if let Some(id) = r.target().try_id() {\n-      return id.to_owned();\n+    if let Ok(r) = repo.find_reference(\"refs/remotes/origin/main\") {\n+        if let Some(id) = r.target().try_id() {\n+            return id.to_owned();\n+        }\n+    }\n+    if let Ok(commit) = repo.head_commit() {\n+        return commit.id;\n     }\n-  }\n-  if let Ok(commit) = repo.head_commit() {\n-    return commit.id;\n-  }\n-  head_oid\n+    head_oid\n }\n \n #[cfg(test)]\n #[allow(dead_code)]\n #[derive(Clone, Debug)]\n pub struct DiffComputationDebug {\n-  pub head_oid: String,\n-  pub resolved_base_oid: String,\n-  pub compare_base_oid: String,\n-  pub base_ref_input: Option<String>,\n-  pub repo_path: String,\n-  pub merge_commit_oid: Option<String>,\n+    pub head_oid: String,\n+    pub resolved_base_oid: String,\n+    pub compare_base_oid: String,\n+    pub base_ref_input: Option<String>,\n+    pub repo_path: String,\n+    pub merge_commit_oid: Option<String>,\n }\n \n #[cfg(test)]\n thread_local! {\n-  static LAST_DIFF_DEBUG: RefCell<Option<DiffComputationDebug>> = RefCell::new(None);\n+  static LAST_DIFF_DEBUG: RefCell<Option<DiffComputationDebug>> = const { RefCell::new(None) };\n }\n \n #[cfg(test)]\n pub fn last_diff_debug() -> Option<DiffComputationDebug> {\n-  LAST_DIFF_DEBUG.with(|cell| cell.borrow().clone())\n+    LAST_DIFF_DEBUG.with(|cell| cell.borrow().clone())\n }\n \n fn is_ancestor(repo: &Repository, anc: ObjectId, desc: ObjectId) -> bool {\n-  match crate::merge_base::merge_base(\n-    \"\",\n-    repo,\n-    desc,\n-    anc,\n-    crate::merge_base::MergeBaseStrategy::Bfs,\n-  ) {\n-    Some(x) if x == anc => true,\n-    _ => false,\n-  }\n+    matches!(\n+        crate::merge_base::merge_base(\n+            \"\",\n+            repo,\n+            desc,\n+            anc,\n+            crate::merge_base::MergeBaseStrategy::Bfs,\n+        ),\n+        Some(x) if x == anc\n+    )\n }\n \n fn find_merge_parent_on_base(\n-  repo: &Repository,\n-  mut base_tip: ObjectId,\n-  head_tip: ObjectId,\n-  limit: usize,\n+    repo: &Repository,\n+    mut base_tip: ObjectId,\n+    head_tip: ObjectId,\n+    limit: usize,\n ) -> Option<(ObjectId, ObjectId)> {\n-  let mut seen = 0usize;\n-  let mut ancestor_candidate: Option<(ObjectId, ObjectId)> = None;\n-  while seen < limit {\n-    seen += 1;\n-    let obj = repo.find_object(base_tip).ok()?;\n-    let commit = obj.try_into_commit().ok()?;\n-    let mut parents_iter = commit.parent_ids();\n-    let first_parent = parents_iter.next().map(|p| p.detach());\n-    let rest: Vec<ObjectId> = parents_iter.map(|p| p.detach()).collect();\n-    if let Some(p1) = first_parent {\n-      if rest.iter().any(|p| *p == head_tip) {\n-        return Some((base_tip, p1));\n-      }\n-      if ancestor_candidate.is_none()\n-        && rest.iter().any(|p| is_ancestor(repo, *p, head_tip))\n-      {\n-        ancestor_candidate = Some((base_tip, p1));\n-      }\n-      base_tip = p1;\n-    } else {\n-      break;\n+    let mut seen = 0usize;\n+    let mut ancestor_candidate: Option<(ObjectId, ObjectId)> = None;\n+    while seen < limit {\n+        seen += 1;\n+        let obj = repo.find_object(base_tip).ok()?;\n+        let commit = obj.try_into_commit().ok()?;\n+        let mut parents_iter = commit.parent_ids();\n+        let first_parent = parents_iter.next().map(|p| p.detach());\n+        let rest: Vec<ObjectId> = parents_iter.map(|p| p.detach()).collect();\n+        if let Some(p1) = first_parent {\n+            if rest.contains(&head_tip) {\n+                return Some((base_tip, p1));\n+            }\n+            if ancestor_candidate.is_none() && rest.iter().any(|p| is_ancestor(repo, *p, head_tip))\n+            {\n+                ancestor_candidate = Some((base_tip, p1));\n+            }\n+            base_tip = p1;\n+        } else {\n+            break;\n+        }\n     }\n-  }\n-  ancestor_candidate\n+    ancestor_candidate\n }\n \n fn parse_oid(hex: &str) -> Option<ObjectId> {\n-  let trimmed = hex.trim();\n-  if trimmed.is_empty() {\n-    return None;\n-  }\n-  ObjectId::from_hex(trimmed.as_bytes()).ok()\n+    let trimmed = hex.trim();\n+    if trimmed.is_empty() {\n+        return None;\n+    }\n+    ObjectId::from_hex(trimmed.as_bytes()).ok()\n }\n \n pub fn diff_refs(opts: GitDiffOptions) -> Result<Vec<DiffEntry>> {\n-  let include = opts.includeContents.unwrap_or(true);\n-  let max_bytes = opts.maxBytes.unwrap_or(950*1024) as usize;\n-  let t_total = Instant::now();\n-  #[cfg(test)]\n-  LAST_DIFF_DEBUG.with(|cell| {\n-    *cell.borrow_mut() = None;\n-  });\n-\n-  let head_ref = opts.headRef.trim();\n-  if head_ref.is_empty() {\n-    return Ok(Vec::new());\n-  }\n-\n-  let base_ref_input = opts\n-    .baseRef\n-    .as_ref()\n-    .map(|s| s.trim().to_string())\n-    .filter(|s| !s.is_empty());\n-  #[cfg(test)]\n-  let base_ref_for_debug = base_ref_input.clone();\n-\n-  #[cfg(debug_assertions)]\n-  println!(\n-    \"[native.refs] start headRef={} baseRef={:?} originPathOverride={:?} repoFullName={:?}\",\n-    head_ref,\n-    base_ref_input,\n-    opts.originPathOverride,\n-    opts.repoFullName\n-  );\n+    let include = opts.includeContents.unwrap_or(true);\n+    let max_bytes = opts.maxBytes.unwrap_or(950 * 1024) as usize;\n+    let t_total = Instant::now();\n+    #[cfg(test)]\n+    LAST_DIFF_DEBUG.with(|cell| {\n+        *cell.borrow_mut() = None;\n+    });\n+\n+    let head_ref = opts.headRef.trim();\n+    if head_ref.is_empty() {\n+        return Ok(Vec::new());\n+    }\n \n-  let t_repo_path = Instant::now();\n-  let repo_path = if let Some(p) = &opts.originPathOverride { std::path::PathBuf::from(p) } else {\n-    let url = resolve_repo_url(opts.repoFullName.as_deref(), opts.repoUrl.as_deref())?;\n-    ensure_repo(&url)?\n-  };\n-  let _d_repo_path = t_repo_path.elapsed();\n-  let cwd = repo_path.to_string_lossy().to_string();\n-\n-  // If a specific repo path is provided, assume the caller ensures freshness.\n-  // Avoid synchronous fetch here to reduce latency.\n-  let _d_fetch = if opts.originPathOverride.is_some() {\n-    Duration::from_millis(0)\n-  } else {\n-    let t_fetch = Instant::now();\n-    let _ = crate::repo::cache::swr_fetch_origin_all_path(\n-      std::path::Path::new(&cwd),\n-      crate::repo::cache::fetch_window_ms(),\n+    let base_ref_input = opts\n+        .baseRef\n+        .as_ref()\n+        .map(|s| s.trim().to_string())\n+        .filter(|s| !s.is_empty());\n+    #[cfg(test)]\n+    let base_ref_for_debug = base_ref_input.clone();\n+\n+    #[cfg(debug_assertions)]\n+    println!(\n+        \"[native.refs] start headRef={} baseRef={:?} originPathOverride={:?} repoFullName={:?}\",\n+        head_ref, base_ref_input, opts.originPathOverride, opts.repoFullName\n     );\n-    t_fetch.elapsed()\n-  };\n-\n-  let t_open = Instant::now();\n-  let repo = gix::open(&cwd)?;\n-  let _d_open = t_open.elapsed();\n-  let t_head = Instant::now();\n-  let head_oid = match oid_from_rev_parse(&repo, head_ref) {\n-    Ok(oid) => oid,\n-    Err(_) => {\n-      let _d_head = t_head.elapsed();\n-      #[cfg(debug_assertions)]\n-      println!(\n+\n+    let t_repo_path = Instant::now();\n+    let repo_path = if let Some(p) = &opts.originPathOverride {\n+        std::path::PathBuf::from(p)\n+    } else {\n+        let url = resolve_repo_url(opts.repoFullName.as_deref(), opts.repoUrl.as_deref())?;\n+        ensure_repo(&url)?\n+    };\n+    let _d_repo_path = t_repo_path.elapsed();\n+    let cwd = repo_path.to_string_lossy().to_string();\n+\n+    // If a specific repo path is provided, assume the caller ensures freshness.\n+    // Avoid synchronous fetch here to reduce latency.\n+    let _d_fetch = if opts.originPathOverride.is_some() {\n+        Duration::from_millis(0)\n+    } else {\n+        let t_fetch = Instant::now();\n+        let _ = crate::repo::cache::swr_fetch_origin_all_path(\n+            std::path::Path::new(&cwd),\n+            crate::repo::cache::fetch_window_ms(),\n+        );\n+        t_fetch.elapsed()\n+    };\n+\n+    let t_open = Instant::now();\n+    let repo = gix::open(&cwd)?;\n+    let _d_open = t_open.elapsed();\n+    let t_head = Instant::now();\n+    let head_oid = match oid_from_rev_parse(&repo, head_ref) {\n+        Ok(oid) => oid,\n+        Err(_) => {\n+            let _d_head = t_head.elapsed();\n+            #[cfg(debug_assertions)]\n+            println!(\n         \"[cmux_native_git] git_diff timings: total={}ms resolve_head={}ms (failed to resolve); cwd={}\",\n         t_total.elapsed().as_millis(),\n         _d_head.as_millis(),\n         cwd,\n       );\n-      return Ok(Vec::new());\n-    }\n-  };\n-  let _d_head = t_head.elapsed();\n-\n-  let t_base = Instant::now();\n-  let mut resolved_base_oid = match base_ref_input {\n-    Some(ref spec) => match oid_from_rev_parse(&repo, spec) {\n-      Ok(oid) => oid,\n-      Err(_) => {\n-        let _d_base = t_base.elapsed();\n-        #[cfg(debug_assertions)]\n-        println!(\n+            return Ok(Vec::new());\n+        }\n+    };\n+    let _d_head = t_head.elapsed();\n+\n+    let t_base = Instant::now();\n+    let mut resolved_base_oid = match base_ref_input {\n+        Some(ref spec) => match oid_from_rev_parse(&repo, spec) {\n+            Ok(oid) => oid,\n+            Err(_) => {\n+                let _d_base = t_base.elapsed();\n+                #[cfg(debug_assertions)]\n+                println!(\n           \"[cmux_native_git] git_diff timings: total={}ms resolve_head={}ms resolve_base={}ms (failed to resolve); cwd={}\",\n           t_total.elapsed().as_millis(),\n           _d_head.as_millis(),\n           _d_base.as_millis(),\n           cwd,\n         );\n-        return Ok(Vec::new());\n-      }\n-    },\n-    None => resolve_default_base(&repo, head_oid),\n-  };\n-  let _d_base = t_base.elapsed();\n-  if let Some(ref known_base) = opts.lastKnownBaseSha {\n-    if let Some(candidate) = parse_oid(known_base) {\n-      if repo.find_object(candidate).is_ok() && is_ancestor(&repo, candidate, head_oid) {\n-        resolved_base_oid = candidate;\n-      }\n-    }\n-  }\n-  let t_merge_base = Instant::now();\n-  // Compute merge-base; prefer BFS (pure gix) to avoid shelling out\n-  let mut compare_base_oid = crate::merge_base::merge_base(\n-    &cwd,\n-    &repo,\n-    resolved_base_oid,\n-    head_oid,\n-    crate::merge_base::MergeBaseStrategy::Bfs,\n-  )\n-  .unwrap_or(resolved_base_oid);\n-  #[cfg(test)]\n-  let mut merge_commit_for_debug: Option<String> = None;\n-  if let Some(ref known_merge) = opts.lastKnownMergeCommitSha {\n-    if let Some(merge_oid) = parse_oid(known_merge) {\n-      if let Ok(obj) = repo.find_object(merge_oid) {\n-        if let Ok(commit) = obj.try_into_commit() {\n-          if let Some(parent_oid) = commit.parent_ids().next().map(|p| p.detach()) {\n-            if is_ancestor(&repo, parent_oid, head_oid) {\n-              compare_base_oid = parent_oid;\n-              #[cfg(test)]\n-              {\n-                merge_commit_for_debug = Some(merge_oid.to_string());\n-              }\n+                return Ok(Vec::new());\n+            }\n+        },\n+        None => resolve_default_base(&repo, head_oid),\n+    };\n+    let _d_base = t_base.elapsed();\n+    if let Some(ref known_base) = opts.lastKnownBaseSha {\n+        if let Some(candidate) = parse_oid(known_base) {\n+            if repo.find_object(candidate).is_ok() && is_ancestor(&repo, candidate, head_oid) {\n+                resolved_base_oid = candidate;\n             }\n-          }\n         }\n-      }\n     }\n-  } else if base_ref_input.is_none() {\n-    if let Some((merge_commit_oid, parent_oid)) =\n-      find_merge_parent_on_base(&repo, resolved_base_oid, head_oid, 20_000)\n-    {\n-      compare_base_oid = parent_oid;\n-      #[cfg(test)]\n-      {\n-        merge_commit_for_debug = Some(merge_commit_oid.to_string());\n-      }\n-      let _ = merge_commit_oid;\n+    let t_merge_base = Instant::now();\n+    // Compute merge-base; prefer BFS (pure gix) to avoid shelling out\n+    let mut compare_base_oid = crate::merge_base::merge_base(\n+        &cwd,\n+        &repo,\n+        resolved_base_oid,\n+        head_oid,\n+        crate::merge_base::MergeBaseStrategy::Bfs,\n+    )\n+    .unwrap_or(resolved_base_oid);\n+    #[cfg(test)]\n+    let mut merge_commit_for_debug: Option<String> = None;\n+    if let Some(ref known_merge) = opts.lastKnownMergeCommitSha {\n+        if let Some(merge_oid) = parse_oid(known_merge) {\n+            if let Ok(obj) = repo.find_object(merge_oid) {\n+                if let Ok(commit) = obj.try_into_commit() {\n+                    if let Some(parent_oid) = commit.parent_ids().next().map(|p| p.detach()) {\n+                        if is_ancestor(&repo, parent_oid, head_oid) {\n+                            compare_base_oid = parent_oid;\n+                            #[cfg(test)]\n+                            {\n+                                merge_commit_for_debug = Some(merge_oid.to_string());\n+                            }\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+    } else if base_ref_input.is_none() {\n+        if let Some((merge_commit_oid, parent_oid)) =\n+            find_merge_parent_on_base(&repo, resolved_base_oid, head_oid, 20_000)\n+        {\n+            compare_base_oid = parent_oid;\n+            #[cfg(test)]\n+            {\n+                merge_commit_for_debug = Some(merge_commit_oid.to_string());\n+            }\n+            let _ = merge_commit_oid;\n+        }\n     }\n-  }\n-  #[cfg(test)]\n-  LAST_DIFF_DEBUG.with(|cell| {\n-    *cell.borrow_mut() = Some(DiffComputationDebug {\n-      head_oid: head_oid.to_string(),\n-      resolved_base_oid: resolved_base_oid.to_string(),\n-      compare_base_oid: compare_base_oid.to_string(),\n-      base_ref_input: base_ref_for_debug.clone(),\n-      repo_path: cwd.clone(),\n-      merge_commit_oid: merge_commit_for_debug.clone(),\n+    #[cfg(test)]\n+    LAST_DIFF_DEBUG.with(|cell| {\n+        *cell.borrow_mut() = Some(DiffComputationDebug {\n+            head_oid: head_oid.to_string(),\n+            resolved_base_oid: resolved_base_oid.to_string(),\n+            compare_base_oid: compare_base_oid.to_string(),\n+            base_ref_input: base_ref_for_debug.clone(),\n+            repo_path: cwd.clone(),\n+            merge_commit_oid: merge_commit_for_debug.clone(),\n+        });\n     });\n-  });\n-  let _d_merge_base = t_merge_base.elapsed();\n-  #[cfg(debug_assertions)]\n-  println!(\n-    \"[native.refs] MB({}, {})={}\",\n-    resolved_base_oid,\n-    head_oid,\n-    compare_base_oid\n-  );\n+    let _d_merge_base = t_merge_base.elapsed();\n+    #[cfg(debug_assertions)]\n+    println!(\n+        \"[native.refs] MB({}, {})={}\",\n+        resolved_base_oid, head_oid, compare_base_oid\n+    );\n \n-  let t_tree_ids = Instant::now();\n-  let base_commit = repo.find_object(compare_base_oid)?.try_into_commit()?;\n-  let base_tree_id = base_commit.tree_id()?.detach();\n-  let head_commit = repo.find_object(head_oid)?.try_into_commit()?;\n-  let head_tree_id = head_commit.tree_id()?.detach();\n-  let _d_tree_ids = t_tree_ids.elapsed();\n-\n-  let mut base_map: HashMap<String, ObjectId> = HashMap::new();\n-  let mut head_map: HashMap<String, ObjectId> = HashMap::new();\n-  let t_collect_base = Instant::now();\n-  collect_tree_blobs(&repo, base_tree_id, \"\", &mut base_map)?;\n-  let _d_collect_base = t_collect_base.elapsed();\n-  let t_collect_head = Instant::now();\n-  collect_tree_blobs(&repo, head_tree_id, \"\", &mut head_map)?;\n-  let _d_collect_head = t_collect_head.elapsed();\n-\n-  // Utility closures to obtain blob data safely; handle submodules and non-blobs gracefully\n-  let mut out: Vec<DiffEntry> = Vec::new();\n-  let mut _num_added: usize = 0;\n-  let mut _num_modified: usize = 0;\n-  let mut _num_deleted: usize = 0;\n-  let mut _num_binary: usize = 0;\n-  let mut _total_scanned_bytes: usize = 0;\n-  let mut _blob_read_ns: u128 = 0;\n-  let mut _textdiff_ns: u128 = 0;\n-  let mut _textdiff_count: usize = 0;\n-  let mut _max_diff_ns: u128 = 0;\n-  let mut _max_diff_path: Option<String> = None;\n-\n-  let get_blob_bytes = |id: ObjectId| -> Option<Vec<u8>> {\n-    if let Ok(obj) = repo.find_object(id) {\n-      if let Ok(blob) = obj.try_into_blob() {\n-        return Some(blob.data.to_vec());\n-      }\n+    let t_tree_ids = Instant::now();\n+    let base_commit = repo.find_object(compare_base_oid)?.try_into_commit()?;\n+    let base_tree_id = base_commit.tree_id()?.detach();\n+    let head_commit = repo.find_object(head_oid)?.try_into_commit()?;\n+    let head_tree_id = head_commit.tree_id()?.detach();\n+    let _d_tree_ids = t_tree_ids.elapsed();\n+\n+    let mut base_map: HashMap<String, ObjectId> = HashMap::new();\n+    let mut head_map: HashMap<String, ObjectId> = HashMap::new();\n+    let t_collect_base = Instant::now();\n+    collect_tree_blobs(&repo, base_tree_id, \"\", &mut base_map)?;\n+    let _d_collect_base = t_collect_base.elapsed();\n+    let t_collect_head = Instant::now();\n+    collect_tree_blobs(&repo, head_tree_id, \"\", &mut head_map)?;\n+    let _d_collect_head = t_collect_head.elapsed();\n+\n+    // Utility closures to obtain blob data safely; handle submodules and non-blobs gracefully\n+    let mut out: Vec<DiffEntry> = Vec::new();\n+    let mut _num_added: usize = 0;\n+    let mut _num_modified: usize = 0;\n+    let mut _num_deleted: usize = 0;\n+    let mut _num_binary: usize = 0;\n+    let mut _total_scanned_bytes: usize = 0;\n+    let mut _blob_read_ns: u128 = 0;\n+    let mut _textdiff_ns: u128 = 0;\n+    let mut _textdiff_count: usize = 0;\n+    let mut _max_diff_ns: u128 = 0;\n+    let mut _max_diff_path: Option<String> = None;\n+\n+    let get_blob_bytes = |id: ObjectId| -> Option<Vec<u8>> {\n+        if let Ok(obj) = repo.find_object(id) {\n+            if let Ok(blob) = obj.try_into_blob() {\n+                return Some(blob.data.to_vec());\n+            }\n+        }\n+        None\n+    };\n+\n+    // Precompute path partitions\n+    let mut base_only: HashMap<String, ObjectId> = HashMap::new();\n+    let mut head_only: HashMap<String, ObjectId> = HashMap::new();\n+    for (p, oid) in &base_map {\n+        if !head_map.contains_key(p) {\n+            base_only.insert(p.clone(), *oid);\n+        }\n     }\n-    None\n-  };\n-\n-  // Precompute path partitions\n-  let mut base_only: HashMap<String, ObjectId> = HashMap::new();\n-  let mut head_only: HashMap<String, ObjectId> = HashMap::new();\n-  for (p, oid) in &base_map { if !head_map.contains_key(p) { base_only.insert(p.clone(), *oid); } }\n-  for (p, oid) in &head_map { if !base_map.contains_key(p) { head_only.insert(p.clone(), *oid); } }\n-\n-  // Identity-based rename detection: pair deletions and additions with the same blob OID\n-  let mut id_to_old: HashMap<ObjectId, Vec<String>> = HashMap::new();\n-  let mut id_to_new: HashMap<ObjectId, Vec<String>> = HashMap::new();\n-  for (p, oid) in &base_only { id_to_old.entry(*oid).or_default().push(p.clone()); }\n-  for (p, oid) in &head_only { id_to_new.entry(*oid).or_default().push(p.clone()); }\n-\n-  let mut renamed_pairs: Vec<(String, String, ObjectId)> = Vec::new();\n-  for (oid, olds) in id_to_old.iter_mut() {\n-    if let Some(news) = id_to_new.get_mut(oid) {\n-      let n = std::cmp::min(olds.len(), news.len());\n-      for _ in 0..n {\n-        let old_p = olds.pop().unwrap();\n-        let new_p = news.pop().unwrap();\n-        renamed_pairs.push((old_p.clone(), new_p.clone(), *oid));\n-        // Remove matched from base_only/head_only\n-        base_only.remove(&old_p);\n-        head_only.remove(&new_p);\n-      }\n+    for (p, oid) in &head_map {\n+        if !base_map.contains_key(p) {\n+            head_only.insert(p.clone(), *oid);\n+        }\n     }\n-  }\n-\n-  // Emit renames (content identical by OID)\n-  for (old_path, new_path, oid) in renamed_pairs {\n-    let t_bl = Instant::now();\n-    let new_data = get_blob_bytes(oid);\n-    _blob_read_ns += t_bl.elapsed().as_nanos();\n-    // New content may be missing (e.g., submodule) -> treat as binary\n-    let bin = match &new_data {\n-      Some(buf) => is_binary(buf),\n-      None => true,\n-    };\n-    let mut e = DiffEntry{ filePath: new_path.clone(), oldPath: Some(old_path.clone()), status: \"renamed\".into(), additions: 0, deletions: 0, isBinary: bin, ..Default::default() };\n-    if let Some(buf) = &new_data {\n-      e.newSize = Some(buf.len() as i32);\n-      e.oldSize = Some(buf.len() as i32);\n+\n+    // Identity-based rename detection: pair deletions and additions with the same blob OID\n+    let mut id_to_old: HashMap<ObjectId, Vec<String>> = HashMap::new();\n+    let mut id_to_new: HashMap<ObjectId, Vec<String>> = HashMap::new();\n+    for (p, oid) in &base_only {\n+        id_to_old.entry(*oid).or_default().push(p.clone());\n     }\n-    if include && !bin {\n-      e.contentOmitted = Some(true);\n-    } else { e.contentOmitted = Some(false); }\n-    out.push(e);\n-  }\n-\n-  // Handle modifications where the path exists in both\n-  let t_loop_add_mod = Instant::now();\n-  for (path, new_id) in &head_map {\n-    if let Some(old_id) = base_map.get(path) {\n-      if old_id == new_id { continue; }\n-      let t_bl1 = Instant::now();\n-      let old_data = get_blob_bytes(*old_id);\n-      let new_data = get_blob_bytes(*new_id);\n-      _blob_read_ns += t_bl1.elapsed().as_nanos();\n-      let bin = match (&old_data, &new_data) {\n-        (Some(a), Some(b)) => is_binary(a) || is_binary(b),\n-        _ => true,\n-      };\n-      let mut e = DiffEntry{ filePath: path.clone(), status: \"modified\".into(), additions: 0, deletions: 0, isBinary: bin, ..Default::default() };\n-      if include && !bin {\n-        let old_str = String::from_utf8_lossy(old_data.as_ref().unwrap()).into_owned();\n-        let new_str = String::from_utf8_lossy(new_data.as_ref().unwrap()).into_owned();\n-        let old_sz = old_str.as_bytes().len();\n-        let new_sz = new_str.as_bytes().len();\n-        e.oldSize = Some(old_sz as i32);\n-        e.newSize = Some(new_sz as i32);\n-        if old_sz + new_sz <= max_bytes {\n-          let t_diff = Instant::now();\n-          // Use changes grouped by operations; count per-line inserts/deletes only.\n-          let diff = TextDiff::from_lines(&old_str, &new_str);\n-          let mut adds = 0i32; let mut dels = 0i32;\n-          for op in diff.ops() {\n-            for change in diff.iter_changes(op) {\n-              match change.tag() {\n-                similar::ChangeTag::Insert => adds += 1,\n-                similar::ChangeTag::Delete => dels += 1,\n-                _ => {}\n-              }\n+    for (p, oid) in &head_only {\n+        id_to_new.entry(*oid).or_default().push(p.clone());\n+    }\n+\n+    let mut renamed_pairs: Vec<(String, String, ObjectId)> = Vec::new();\n+    for (oid, olds) in id_to_old.iter_mut() {\n+        if let Some(news) = id_to_new.get_mut(oid) {\n+            let n = std::cmp::min(olds.len(), news.len());\n+            for _ in 0..n {\n+                let old_p = olds.pop().unwrap();\n+                let new_p = news.pop().unwrap();\n+                renamed_pairs.push((old_p.clone(), new_p.clone(), *oid));\n+                // Remove matched from base_only/head_only\n+                base_only.remove(&old_p);\n+                head_only.remove(&new_p);\n             }\n-          }\n-          let d_diff = t_diff.elapsed().as_nanos();\n-          _textdiff_ns += d_diff; _textdiff_count += 1; _total_scanned_bytes += old_sz + new_sz;\n-          if d_diff > _max_diff_ns { _max_diff_ns = d_diff; _max_diff_path = Some(path.clone()); }\n-          e.additions = adds; e.deletions = dels;\n-          e.oldContent = Some(old_str);\n-          e.newContent = Some(new_str);\n-          e.contentOmitted = Some(false);\n-        } else { e.contentOmitted = Some(true); }\n-      } else { e.contentOmitted = Some(false); }\n-      // Do not filter out zero-line modifications: mode changes or metadata changes should still show up.\n-      out.push(e);\n-      _num_modified += 1;\n-      if bin { _num_binary += 1; }\n+        }\n     }\n-  }\n-  let _d_loop_add_mod = t_loop_add_mod.elapsed();\n-\n-  // Additions not matched as renames\n-  for (path, new_id) in &head_only {\n-    let t_bl = Instant::now();\n-    let new_data = get_blob_bytes(*new_id);\n-    _blob_read_ns += t_bl.elapsed().as_nanos();\n-    let (bin, new_sz) = match &new_data {\n-      Some(buf) => (is_binary(buf), buf.len()),\n-      None => (true, 0),\n-    };\n-    let mut e = DiffEntry{ filePath: path.clone(), status: \"added\".into(), additions: 0, deletions: 0, isBinary: bin, ..Default::default() };\n-    if include && !bin {\n-      let new_str = String::from_utf8_lossy(new_data.as_ref().unwrap()).into_owned();\n-      e.newSize = Some(new_sz as i32);\n-      e.oldSize = Some(0);\n-      if new_sz <= max_bytes {\n-        e.oldContent = Some(String::new());\n-        e.newContent = Some(new_str.clone());\n-        e.contentOmitted = Some(false);\n-        e.additions = new_str.lines().count() as i32;\n-        _total_scanned_bytes += new_sz;\n-      } else { e.contentOmitted = Some(true); }\n-    } else { e.contentOmitted = Some(false); }\n-    out.push(e);\n-    _num_added += 1;\n-    if bin { _num_binary += 1; }\n-  }\n-\n-  // Deletions not matched as renames\n-  let t_loop_del = Instant::now();\n-  for (path, old_id) in &base_only {\n-    let t_bl = Instant::now();\n-    let old_data = get_blob_bytes(*old_id);\n-    _blob_read_ns += t_bl.elapsed().as_nanos();\n-    let (bin, old_sz) = match &old_data {\n-      Some(buf) => (is_binary(buf), buf.len()),\n-      None => (true, 0),\n-    };\n-    let mut e = DiffEntry{ filePath: path.clone(), status: \"deleted\".into(), additions: 0, deletions: 0, isBinary: bin, ..Default::default() };\n-    if include && !bin {\n-      let old_str = String::from_utf8_lossy(old_data.as_ref().unwrap()).into_owned();\n-      e.oldSize = Some(old_sz as i32);\n-      if old_sz <= max_bytes {\n-        e.oldContent = Some(old_str);\n-        e.newContent = Some(String::new());\n-        e.contentOmitted = Some(false);\n-        e.deletions = e.oldContent.as_ref().unwrap().lines().count() as i32;\n-        _total_scanned_bytes += old_sz;\n-      } else { e.contentOmitted = Some(true); }\n-    } else { e.contentOmitted = Some(false); }\n-    out.push(e);\n-    _num_deleted += 1;\n-    if bin { _num_binary += 1; }\n-  }\n-  let _d_loop_del = t_loop_del.elapsed();\n-\n-  let _d_total = t_total.elapsed();\n-  #[cfg(debug_assertions)]\n-  println!(\n+\n+    // Emit renames (content identical by OID)\n+    for (old_path, new_path, oid) in renamed_pairs {\n+        let t_bl = Instant::now();\n+        let new_data = get_blob_bytes(oid);\n+        _blob_read_ns += t_bl.elapsed().as_nanos();\n+        // New content may be missing (e.g., submodule) -> treat as binary\n+        let bin = match &new_data {\n+            Some(buf) => is_binary(buf),\n+            None => true,\n+        };\n+        let mut e = DiffEntry {\n+            filePath: new_path.clone(),\n+            oldPath: Some(old_path.clone()),\n+            status: \"renamed\".into(),\n+            additions: 0,\n+            deletions: 0,\n+            isBinary: bin,\n+            ..Default::default()\n+        };\n+        if let Some(buf) = &new_data {\n+            e.newSize = Some(buf.len() as i32);\n+            e.oldSize = Some(buf.len() as i32);\n+        }\n+        if include && !bin {\n+            e.contentOmitted = Some(true);\n+        } else {\n+            e.contentOmitted = Some(false);\n+        }\n+        out.push(e);\n+    }\n+\n+    // Handle modifications where the path exists in both\n+    let t_loop_add_mod = Instant::now();\n+    for (path, new_id) in &head_map {\n+        if let Some(old_id) = base_map.get(path) {\n+            if old_id == new_id {\n+                continue;\n+            }\n+            let t_bl1 = Instant::now();\n+            let old_data = get_blob_bytes(*old_id);\n+            let new_data = get_blob_bytes(*new_id);\n+            _blob_read_ns += t_bl1.elapsed().as_nanos();\n+            let bin = match (&old_data, &new_data) {\n+                (Some(a), Some(b)) => is_binary(a) || is_binary(b),\n+                _ => true,\n+            };\n+            let mut e = DiffEntry {\n+                filePath: path.clone(),\n+                status: \"modified\".into(),\n+                additions: 0,\n+                deletions: 0,\n+                isBinary: bin,\n+                ..Default::default()\n+            };\n+            if include && !bin {\n+                let old_str = String::from_utf8_lossy(old_data.as_ref().unwrap()).into_owned();\n+                let new_str = String::from_utf8_lossy(new_data.as_ref().unwrap()).into_owned();\n+                let old_sz = old_str.len();\n+                let new_sz = new_str.len();\n+                e.oldSize = Some(old_sz as i32);\n+                e.newSize = Some(new_sz as i32);\n+                if old_sz + new_sz <= max_bytes {\n+                    let t_diff = Instant::now();\n+                    // Use changes grouped by operations; count per-line inserts/deletes only.\n+                    let diff = TextDiff::from_lines(&old_str, &new_str);\n+                    let mut adds = 0i32;\n+                    let mut dels = 0i32;\n+                    for op in diff.ops() {\n+                        for change in diff.iter_changes(op) {\n+                            match change.tag() {\n+                                similar::ChangeTag::Insert => adds += 1,\n+                                similar::ChangeTag::Delete => dels += 1,\n+                                _ => {}\n+                            }\n+                        }\n+                    }\n+                    let d_diff = t_diff.elapsed().as_nanos();\n+                    _textdiff_ns += d_diff;\n+                    _textdiff_count += 1;\n+                    _total_scanned_bytes += old_sz + new_sz;\n+                    if d_diff > _max_diff_ns {\n+                        _max_diff_ns = d_diff;\n+                        _max_diff_path = Some(path.clone());\n+                    }\n+                    e.additions = adds;\n+                    e.deletions = dels;\n+                    e.oldContent = Some(old_str);\n+                    e.newContent = Some(new_str);\n+                    e.contentOmitted = Some(false);\n+                } else {\n+                    e.contentOmitted = Some(true);\n+                }\n+            } else {\n+                e.contentOmitted = Some(false);\n+            }\n+            // Do not filter out zero-line modifications: mode changes or metadata changes should still show up.\n+            out.push(e);\n+            _num_modified += 1;\n+            if bin {\n+                _num_binary += 1;\n+            }\n+        }\n+    }\n+    let _d_loop_add_mod = t_loop_add_mod.elapsed();\n+\n+    // Additions not matched as renames\n+    for (path, new_id) in &head_only {\n+        let t_bl = Instant::now();\n+        let new_data = get_blob_bytes(*new_id);\n+        _blob_read_ns += t_bl.elapsed().as_nanos();\n+        let (bin, new_sz) = match &new_data {\n+            Some(buf) => (is_binary(buf), buf.len()),\n+            None => (true, 0),\n+        };\n+        let mut e = DiffEntry {\n+            filePath: path.clone(),\n+            status: \"added\".into(),\n+            additions: 0,\n+            deletions: 0,\n+            isBinary: bin,\n+            ..Default::default()\n+        };\n+        if include && !bin {\n+            let new_str = String::from_utf8_lossy(new_data.as_ref().unwrap()).into_owned();\n+            e.newSize = Some(new_sz as i32);\n+            e.oldSize = Some(0);\n+            if new_sz <= max_bytes {\n+                e.oldContent = Some(String::new());\n+                e.newContent = Some(new_str.clone());\n+                e.contentOmitted = Some(false);\n+                e.additions = new_str.lines().count() as i32;\n+                _total_scanned_bytes += new_sz;\n+            } else {\n+                e.contentOmitted = Some(true);\n+            }\n+        } else {\n+            e.contentOmitted = Some(false);\n+        }\n+        out.push(e);\n+        _num_added += 1;\n+        if bin {\n+            _num_binary += 1;\n+        }\n+    }\n+\n+    // Deletions not matched as renames\n+    let t_loop_del = Instant::now();\n+    for (path, old_id) in &base_only {\n+        let t_bl = Instant::now();\n+        let old_data = get_blob_bytes(*old_id);\n+        _blob_read_ns += t_bl.elapsed().as_nanos();\n+        let (bin, old_sz) = match &old_data {\n+            Some(buf) => (is_binary(buf), buf.len()),\n+            None => (true, 0),\n+        };\n+        let mut e = DiffEntry {\n+            filePath: path.clone(),\n+            status: \"deleted\".into(),\n+            additions: 0,\n+            deletions: 0,\n+            isBinary: bin,\n+            ..Default::default()\n+        };\n+        if include && !bin {\n+            let old_str = String::from_utf8_lossy(old_data.as_ref().unwrap()).into_owned();\n+            e.oldSize = Some(old_sz as i32);\n+            if old_sz <= max_bytes {\n+                e.oldContent = Some(old_str);\n+                e.newContent = Some(String::new());\n+                e.contentOmitted = Some(false);\n+                e.deletions = e.oldContent.as_ref().unwrap().lines().count() as i32;\n+                _total_scanned_bytes += old_sz;\n+            } else {\n+                e.contentOmitted = Some(true);\n+            }\n+        } else {\n+            e.contentOmitted = Some(false);\n+        }\n+        out.push(e);\n+        _num_deleted += 1;\n+        if bin {\n+            _num_binary += 1;\n+        }\n+    }\n+    let _d_loop_del = t_loop_del.elapsed();\n+\n+    let _d_total = t_total.elapsed();\n+    #[cfg(debug_assertions)]\n+    println!(\n     \"[cmux_native_git] git_diff timings: total={}ms repo_path={}ms fetch={}ms open_repo={}ms resolve_head={}ms resolve_base={}ms merge_base={}ms tree_ids={}ms collect_base={}ms collect_head={}ms add_mod_loop={}ms del_loop={}ms blob_read={}ms textdiff={}ms textdiff_count={} scanned_bytes={} files: +{} ~{} -{} (binary={}) max_textdiff={{path: {:?}, ms: {}}} cwd={} out_len={}\",\n     _d_total.as_millis(),\n     _d_repo_path.as_millis(),\n@@ -532,105 +613,215 @@ pub fn diff_refs(opts: GitDiffOptions) -> Result<Vec<DiffEntry>> {\n     cwd,\n     out.len(),\n   );\n-  if out.is_empty() {\n-    // Fallback to git CLI diff parsing if our tree comparison produced nothing but there might be changes (e.g., merge edge-cases)\n-    #[cfg(debug_assertions)]\n-    println!(\"[native.refs] tree-diff empty; attempting CLI fallback\");\n-    let r = crate::util::run_git(\n-      &cwd,\n-      &[\"diff\", \"--name-status\", &compare_base_oid.to_string(), &head_oid.to_string()]\n-    );\n-    if let Ok(ns) = r {\n-      #[cfg(debug_assertions)]\n-      println!(\"[native.refs] CLI fallback detected {} lines\", ns.lines().count());\n-      let mut fallback: Vec<DiffEntry> = Vec::new();\n-      for line in ns.lines() {\n-        if line.trim().is_empty() { continue; }\n-        // Format: <status>\\t<path> [\\t<path2>]\n-        let parts: Vec<&str> = line.split('\\t').collect();\n-        if parts.is_empty() { continue; }\n-        let status = parts[0].trim();\n-        match status {\n-          \"A\" => {\n-            if parts.len() >= 2 {\n-              let path = parts[1].to_string();\n-              let mut e = DiffEntry{ filePath: path.clone(), status: \"added\".into(), additions: 0, deletions: 0, isBinary: false, ..Default::default() };\n-              if include {\n-                // new content from head\n-                if let Ok(buf) = crate::util::run_git(&cwd, &[\"show\", &format!(\"{}:{}\", head_oid, path)]) {\n-                  let new_sz = buf.as_bytes().len();\n-                  e.newSize = Some(new_sz as i32);\n-                  e.oldSize = Some(0);\n-                  if new_sz <= max_bytes { e.newContent = Some(buf.clone()); e.oldContent = Some(String::new()); e.additions = buf.lines().count() as i32; e.contentOmitted = Some(false);} else { e.contentOmitted = Some(true); }\n+    if out.is_empty() {\n+        // Fallback to git CLI diff parsing if our tree comparison produced nothing but there might be changes (e.g., merge edge-cases)\n+        #[cfg(debug_assertions)]\n+        println!(\"[native.refs] tree-diff empty; attempting CLI fallback\");\n+        let r = crate::util::run_git(\n+            &cwd,\n+            &[\n+                \"diff\",\n+                \"--name-status\",\n+                &compare_base_oid.to_string(),\n+                &head_oid.to_string(),\n+            ],\n+        );\n+        if let Ok(ns) = r {\n+            #[cfg(debug_assertions)]\n+            println!(\n+                \"[native.refs] CLI fallback detected {} lines\",\n+                ns.lines().count()\n+            );\n+            let mut fallback: Vec<DiffEntry> = Vec::new();\n+            for line in ns.lines() {\n+                if line.trim().is_empty() {\n+                    continue;\n                 }\n-              }\n-              fallback.push(e);\n-            }\n-          }\n-          \"M\" => {\n-            if parts.len() >= 2 {\n-              let path = parts[1].to_string();\n-              let mut e = DiffEntry{ filePath: path.clone(), status: \"modified\".into(), additions: 0, deletions: 0, isBinary: false, ..Default::default() };\n-              if include {\n-                let old_s = crate::util::run_git(&cwd, &[\"show\", &format!(\"{}:{}\", compare_base_oid, path)]).unwrap_or_default();\n-                let new_s = crate::util::run_git(&cwd, &[\"show\", &format!(\"{}:{}\", head_oid, path)]).unwrap_or_default();\n-                let old_sz = old_s.as_bytes().len(); let new_sz = new_s.as_bytes().len();\n-                e.oldSize = Some(old_sz as i32); e.newSize = Some(new_sz as i32);\n-                if old_sz + new_sz <= max_bytes {\n-                  let diff = TextDiff::from_lines(&old_s, &new_s);\n-                  let mut adds=0i32; let mut dels=0i32; for op in diff.ops(){ let tag=op.tag(); for ch in diff.iter_changes(op){ match (tag, ch.tag()) { (similar::DiffTag::Insert, _) => adds+=1, (similar::DiffTag::Delete, _) => dels+=1, _=>{} } } }\n-                  e.additions = adds; e.deletions = dels; e.oldContent = Some(old_s); e.newContent = Some(new_s); e.contentOmitted = Some(false);\n-                } else { e.contentOmitted = Some(true); }\n-              }\n-              fallback.push(e);\n-            }\n-          }\n-          \"D\" => {\n-            if parts.len() >= 2 {\n-              let path = parts[1].to_string();\n-              let mut e = DiffEntry{ filePath: path.clone(), status: \"deleted\".into(), additions: 0, deletions: 0, isBinary: false, ..Default::default() };\n-              if include {\n-                if let Ok(buf) = crate::util::run_git(&cwd, &[\"show\", &format!(\"{}:{}\", compare_base_oid, path)]) {\n-                  let old_sz = buf.as_bytes().len(); e.oldSize = Some(old_sz as i32);\n-                  if old_sz <= max_bytes { e.oldContent = Some(buf.clone()); e.newContent = Some(String::new()); e.deletions = buf.lines().count() as i32; e.contentOmitted = Some(false);} else { e.contentOmitted = Some(true); }\n+                // Format: <status>\\t<path> [\\t<path2>]\n+                let parts: Vec<&str> = line.split('\\t').collect();\n+                if parts.is_empty() {\n+                    continue;\n+                }\n+                let status = parts[0].trim();\n+                match status {\n+                    \"A\" => {\n+                        if parts.len() >= 2 {\n+                            let path = parts[1].to_string();\n+                            let mut e = DiffEntry {\n+                                filePath: path.clone(),\n+                                status: \"added\".into(),\n+                                additions: 0,\n+                                deletions: 0,\n+                                isBinary: false,\n+                                ..Default::default()\n+                            };\n+                            if include {\n+                                // new content from head\n+                                if let Ok(buf) = crate::util::run_git(\n+                                    &cwd,\n+                                    &[\"show\", &format!(\"{}:{}\", head_oid, path)],\n+                                ) {\n+                                    let new_sz = buf.len();\n+                                    e.newSize = Some(new_sz as i32);\n+                                    e.oldSize = Some(0);\n+                                    if new_sz <= max_bytes {\n+                                        e.newContent = Some(buf.clone());\n+                                        e.oldContent = Some(String::new());\n+                                        e.additions = buf.lines().count() as i32;\n+                                        e.contentOmitted = Some(false);\n+                                    } else {\n+                                        e.contentOmitted = Some(true);\n+                                    }\n+                                }\n+                            }\n+                            fallback.push(e);\n+                        }\n+                    }\n+                    \"M\" => {\n+                        if parts.len() >= 2 {\n+                            let path = parts[1].to_string();\n+                            let mut e = DiffEntry {\n+                                filePath: path.clone(),\n+                                status: \"modified\".into(),\n+                                additions: 0,\n+                                deletions: 0,\n+                                isBinary: false,\n+                                ..Default::default()\n+                            };\n+                            if include {\n+                                let old_s = crate::util::run_git(\n+                                    &cwd,\n+                                    &[\"show\", &format!(\"{}:{}\", compare_base_oid, path)],\n+                                )\n+                                .unwrap_or_default();\n+                                let new_s = crate::util::run_git(\n+                                    &cwd,\n+                                    &[\"show\", &format!(\"{}:{}\", head_oid, path)],\n+                                )\n+                                .unwrap_or_default();\n+                                let old_sz = old_s.len();\n+                                let new_sz = new_s.len();\n+                                e.oldSize = Some(old_sz as i32);\n+                                e.newSize = Some(new_sz as i32);\n+                                if old_sz + new_sz <= max_bytes {\n+                                    let diff = TextDiff::from_lines(&old_s, &new_s);\n+                                    let mut adds = 0i32;\n+                                    let mut dels = 0i32;\n+                                    for op in diff.ops() {\n+                                        let tag = op.tag();\n+                                        for ch in diff.iter_changes(op) {\n+                                            match (tag, ch.tag()) {\n+                                                (similar::DiffTag::Insert, _) => adds += 1,\n+                                                (similar::DiffTag::Delete, _) => dels += 1,\n+                                                _ => {}\n+                                            }\n+                                        }\n+                                    }\n+                                    e.additions = adds;\n+                                    e.deletions = dels;\n+                                    e.oldContent = Some(old_s);\n+                                    e.newContent = Some(new_s);\n+                                    e.contentOmitted = Some(false);\n+                                } else {\n+                                    e.contentOmitted = Some(true);\n+                                }\n+                            }\n+                            fallback.push(e);\n+                        }\n+                    }\n+                    \"D\" => {\n+                        if parts.len() >= 2 {\n+                            let path = parts[1].to_string();\n+                            let mut e = DiffEntry {\n+                                filePath: path.clone(),\n+                                status: \"deleted\".into(),\n+                                additions: 0,\n+                                deletions: 0,\n+                                isBinary: false,\n+                                ..Default::default()\n+                            };\n+                            if include {\n+                                if let Ok(buf) = crate::util::run_git(\n+                                    &cwd,\n+                                    &[\"show\", &format!(\"{}:{}\", compare_base_oid, path)],\n+                                ) {\n+                                    let old_sz = buf.len();\n+                                    e.oldSize = Some(old_sz as i32);\n+                                    if old_sz <= max_bytes {\n+                                        e.oldContent = Some(buf.clone());\n+                                        e.newContent = Some(String::new());\n+                                        e.deletions = buf.lines().count() as i32;\n+                                        e.contentOmitted = Some(false);\n+                                    } else {\n+                                        e.contentOmitted = Some(true);\n+                                    }\n+                                }\n+                            }\n+                            fallback.push(e);\n+                        }\n+                    }\n+                    \"R\" | \"R100\" | \"R099\" | \"R098\" | \"R097\" | \"R096\" | \"R095\" | \"R094\" | \"R093\"\n+                    | \"R092\" | \"R091\" | \"R090\" => {\n+                        if parts.len() >= 3 {\n+                            let oldp = parts[1].to_string();\n+                            let newp = parts[2].to_string();\n+                            let mut e = DiffEntry {\n+                                filePath: newp.clone(),\n+                                oldPath: Some(oldp.clone()),\n+                                status: \"renamed\".into(),\n+                                additions: 0,\n+                                deletions: 0,\n+                                isBinary: false,\n+                                ..Default::default()\n+                            };\n+                            if include {\n+                                let new_s = crate::util::run_git(\n+                                    &cwd,\n+                                    &[\"show\", &format!(\"{}:{}\", head_oid, newp)],\n+                                )\n+                                .unwrap_or_default();\n+                                let new_sz = new_s.len();\n+                                e.newSize = Some(new_sz as i32);\n+                                e.oldSize = Some(new_sz as i32);\n+                                if new_sz <= max_bytes {\n+                                    e.oldContent = Some(new_s.clone());\n+                                    e.newContent = Some(new_s);\n+                                    e.contentOmitted = Some(false);\n+                                } else {\n+                                    e.contentOmitted = Some(true);\n+                                }\n+                            }\n+                            fallback.push(e);\n+                        }\n+                    }\n+                    _ => {}\n                 }\n-              }\n-              fallback.push(e);\n             }\n-          }\n-          \"R\" | \"R100\" | \"R099\" | \"R098\" | \"R097\" | \"R096\" | \"R095\" | \"R094\" | \"R093\" | \"R092\" | \"R091\" | \"R090\" => {\n-            if parts.len() >= 3 {\n-              let oldp = parts[1].to_string();\n-              let newp = parts[2].to_string();\n-              let mut e = DiffEntry{ filePath: newp.clone(), oldPath: Some(oldp.clone()), status: \"renamed\".into(), additions: 0, deletions: 0, isBinary: false, ..Default::default() };\n-              if include {\n-                let new_s = crate::util::run_git(&cwd, &[\"show\", &format!(\"{}:{}\", head_oid, newp)]).unwrap_or_default();\n-                let new_sz = new_s.as_bytes().len(); e.newSize = Some(new_sz as i32); e.oldSize = Some(new_sz as i32);\n-                if new_sz <= max_bytes { e.oldContent = Some(new_s.clone()); e.newContent = Some(new_s); e.contentOmitted = Some(false);} else { e.contentOmitted = Some(true); }\n-              }\n-              fallback.push(e);\n+            if !fallback.is_empty() {\n+                #[cfg(debug_assertions)]\n+                println!(\n+                    \"[native.refs] CLI fallback returning {} entries\",\n+                    fallback.len()\n+                );\n+                // Stable sort by filePath (case-insensitive)\n+                fallback.sort_by(|a, b| {\n+                    a.filePath\n+                        .to_lowercase()\n+                        .cmp(&b.filePath.to_lowercase())\n+                        .then_with(|| a.filePath.cmp(&b.filePath))\n+                });\n+                return Ok(fallback);\n             }\n-          }\n-          _ => {}\n         }\n-      }\n-      if !fallback.is_empty() {\n-        #[cfg(debug_assertions)] println!(\"[native.refs] CLI fallback returning {} entries\", fallback.len());\n-        // Stable sort by filePath (case-insensitive)\n-        fallback.sort_by(|a, b| {\n-          a.filePath.to_lowercase().cmp(&b.filePath.to_lowercase())\n-            .then_with(|| a.filePath.cmp(&b.filePath))\n-        });\n-        return Ok(fallback);\n-      }\n     }\n-  }\n \n-  // Stable sort by filePath (case-insensitive)\n-  out.sort_by(|a, b| {\n-    a.filePath.to_lowercase().cmp(&b.filePath.to_lowercase())\n-      .then_with(|| a.filePath.cmp(&b.filePath))\n-  });\n+    // Stable sort by filePath (case-insensitive)\n+    out.sort_by(|a, b| {\n+        a.filePath\n+            .to_lowercase()\n+            .cmp(&b.filePath.to_lowercase())\n+            .then_with(|| a.filePath.cmp(&b.filePath))\n+    });\n \n-  Ok(out)\n+    Ok(out)\n }\ndiff --git a/apps/server/native/core/src/diff/workspace.rs b/apps/server/native/core/src/diff/workspace.rs\nindex ea4bfd673..50857d723 100644\n--- a/apps/server/native/core/src/diff/workspace.rs\n+++ b/apps/server/native/core/src/diff/workspace.rs\n@@ -1,207 +1,326 @@\n+use crate::types::{DiffEntry, GitDiffWorkspaceOptions};\n use anyhow::Result;\n use gix::bstr::ByteSlice;\n-use std::{collections::{HashMap, HashSet}, fs, path::{Path, PathBuf}};\n use gix::{hash::ObjectId, Repository};\n use similar::TextDiff;\n-use crate::types::{DiffEntry, GitDiffWorkspaceOptions};\n+use std::{\n+    collections::{HashMap, HashSet},\n+    fs,\n+    path::{Path, PathBuf},\n+};\n \n-fn is_binary(data: &[u8]) -> bool { data.iter().any(|&b| b == 0) || std::str::from_utf8(data).is_err() }\n+fn is_binary(data: &[u8]) -> bool {\n+    data.contains(&0) || std::str::from_utf8(data).is_err()\n+}\n \n fn default_remote_head(repo: &Repository) -> Option<ObjectId> {\n-  if let Ok(r) = repo.find_reference(\"refs/remotes/origin/HEAD\") {\n-    if let Some(name) = r.target().try_name() {\n-      let s = name.as_bstr().to_str_lossy().into_owned();\n-      if let Ok(rr) = repo.find_reference(&s) { if let Some(id) = rr.target().try_id() { return Some(id.to_owned()); } }\n+    if let Ok(r) = repo.find_reference(\"refs/remotes/origin/HEAD\") {\n+        if let Some(name) = r.target().try_name() {\n+            let s = name.as_bstr().to_str_lossy().into_owned();\n+            if let Ok(rr) = repo.find_reference(&s) {\n+                if let Some(id) = rr.target().try_id() {\n+                    return Some(id.to_owned());\n+                }\n+            }\n+        }\n     }\n-  }\n-  if let Ok(r) = repo.find_reference(\"refs/remotes/origin/main\") { if let Some(id) = r.target().try_id() { return Some(id.to_owned()); } }\n-  None\n+    if let Ok(r) = repo.find_reference(\"refs/remotes/origin/main\") {\n+        if let Some(id) = r.target().try_id() {\n+            return Some(id.to_owned());\n+        }\n+    }\n+    None\n }\n \n fn merge_base_oid(repo: &Repository, a: ObjectId, b: ObjectId) -> ObjectId {\n-  use std::collections::{HashMap, VecDeque};\n-  let mut dist_a: HashMap<ObjectId, usize> = HashMap::new();\n-  let mut qa: VecDeque<(ObjectId, usize)> = VecDeque::new();\n-  qa.push_back((a, 0));\n-  while let Some((id, d)) = qa.pop_front() {\n-    if dist_a.contains_key(&id) { continue; }\n-    dist_a.insert(id, d);\n-    if let Ok(obj) = repo.find_object(id) {\n-      if let Ok(commit) = obj.try_into_commit() {\n-        for p in commit.parent_ids() { qa.push_back((p.detach(), d + 1)); }\n-      }\n-    }\n-  }\n-  let mut best: Option<(ObjectId, usize)> = None;\n-  let mut qb: VecDeque<(ObjectId, usize)> = VecDeque::new();\n-  let mut seen_b: HashMap<ObjectId, usize> = HashMap::new();\n-  qb.push_back((b, 0));\n-  while let Some((id, d)) = qb.pop_front() {\n-    if seen_b.contains_key(&id) { continue; }\n-    seen_b.insert(id, d);\n-    if let Some(da) = dist_a.get(&id) {\n-      let cost = *da + d;\n-      match best {\n-        None => best = Some((id, cost)),\n-        Some((_, c)) if cost < c => best = Some((id, cost)),\n-        _ => {}\n-      }\n+    use std::collections::{HashMap, VecDeque};\n+    let mut dist_a: HashMap<ObjectId, usize> = HashMap::new();\n+    let mut qa: VecDeque<(ObjectId, usize)> = VecDeque::new();\n+    qa.push_back((a, 0));\n+    while let Some((id, d)) = qa.pop_front() {\n+        if dist_a.contains_key(&id) {\n+            continue;\n+        }\n+        dist_a.insert(id, d);\n+        if let Ok(obj) = repo.find_object(id) {\n+            if let Ok(commit) = obj.try_into_commit() {\n+                for p in commit.parent_ids() {\n+                    qa.push_back((p.detach(), d + 1));\n+                }\n+            }\n+        }\n     }\n-    if let Ok(obj) = repo.find_object(id) {\n-      if let Ok(commit) = obj.try_into_commit() {\n-        for p in commit.parent_ids() { qb.push_back((p.detach(), d + 1)); }\n-      }\n+    let mut best: Option<(ObjectId, usize)> = None;\n+    let mut qb: VecDeque<(ObjectId, usize)> = VecDeque::new();\n+    let mut seen_b: HashMap<ObjectId, usize> = HashMap::new();\n+    qb.push_back((b, 0));\n+    while let Some((id, d)) = qb.pop_front() {\n+        if seen_b.contains_key(&id) {\n+            continue;\n+        }\n+        seen_b.insert(id, d);\n+        if let Some(da) = dist_a.get(&id) {\n+            let cost = *da + d;\n+            match best {\n+                None => best = Some((id, cost)),\n+                Some((_, c)) if cost < c => best = Some((id, cost)),\n+                _ => {}\n+            }\n+        }\n+        if let Ok(obj) = repo.find_object(id) {\n+            if let Ok(commit) = obj.try_into_commit() {\n+                for p in commit.parent_ids() {\n+                    qb.push_back((p.detach(), d + 1));\n+                }\n+            }\n+        }\n     }\n-  }\n-  best.map(|(id, _)| id).unwrap_or(a)\n+    best.map(|(id, _)| id).unwrap_or(a)\n }\n \n-fn collect_tree_blobs(repo: &Repository, tree_id: ObjectId, prefix: &str, out: &mut HashMap<String, ObjectId>) -> anyhow::Result<()> {\n-  let obj = repo.find_object(tree_id)?;\n-  let tree = obj.try_into_tree()?;\n-  for entry_res in tree.iter() {\n-    let entry = entry_res?;\n-    let name = entry.filename().to_str_lossy().into_owned();\n-    let full = if prefix.is_empty() { name.clone() } else { format!(\"{}/{}\", prefix, name) };\n-    let mode = entry.mode();\n-    if mode.is_tree() {\n-      let id = entry.oid().to_owned();\n-      collect_tree_blobs(repo, id, &full, out)?;\n-    } else {\n-      let id = entry.oid().to_owned();\n-      out.insert(full, id);\n+fn collect_tree_blobs(\n+    repo: &Repository,\n+    tree_id: ObjectId,\n+    prefix: &str,\n+    out: &mut HashMap<String, ObjectId>,\n+) -> anyhow::Result<()> {\n+    let obj = repo.find_object(tree_id)?;\n+    let tree = obj.try_into_tree()?;\n+    for entry_res in tree.iter() {\n+        let entry = entry_res?;\n+        let name = entry.filename().to_str_lossy().into_owned();\n+        let full = if prefix.is_empty() {\n+            name.clone()\n+        } else {\n+            format!(\"{}/{}\", prefix, name)\n+        };\n+        let mode = entry.mode();\n+        if mode.is_tree() {\n+            let id = entry.oid().to_owned();\n+            collect_tree_blobs(repo, id, &full, out)?;\n+        } else {\n+            let id = entry.oid().to_owned();\n+            out.insert(full, id);\n+        }\n     }\n-  }\n-  Ok(())\n+    Ok(())\n }\n \n fn should_ignore(root: &Path, rel: &str) -> bool {\n-  let gi = root.join(\".gitignore\");\n-  if let Ok(s) = fs::read_to_string(&gi) {\n-    for line in s.lines() {\n-      let rule = line.trim();\n-      if rule.is_empty() || rule.starts_with('#') { continue; }\n-      if rule.ends_with('/') {\n-        let d = &rule[..rule.len()-1];\n-        if rel == d || rel.starts_with(&format!(\"{}/\", d)) { return true; }\n-      } else {\n-        if rel == rule || rel.starts_with(&format!(\"{}/\", rule)) { return true; }\n-      }\n+    let gi = root.join(\".gitignore\");\n+    if let Ok(s) = fs::read_to_string(&gi) {\n+        for line in s.lines() {\n+            let rule = line.trim();\n+            if rule.is_empty() || rule.starts_with('#') {\n+                continue;\n+            }\n+            if let Some(d) = rule.strip_suffix('/') {\n+                if rel == d || rel.starts_with(&format!(\"{}/\", d)) {\n+                    return true;\n+                }\n+            } else if rel == rule || rel.starts_with(&format!(\"{}/\", rule)) {\n+                return true;\n+            }\n+        }\n     }\n-  }\n-  false\n+    false\n }\n \n fn scan_workdir(root: &Path) -> Vec<String> {\n-  let mut out = Vec::new();\n-  fn rec(cur: &Path, base: &Path, out: &mut Vec<String>) {\n-    if let Ok(entries) = fs::read_dir(cur) {\n-      for ent in entries.flatten() {\n-        let p = ent.path();\n-        if p.file_name().map(|s| s == \".git\").unwrap_or(false) { continue; }\n-        let rel = p.strip_prefix(base).unwrap().to_string_lossy().replace('\\\\', \"/\");\n-        if should_ignore(base, &rel) { continue; }\n-        if p.is_dir() { rec(&p, base, out); } else if p.is_file() { out.push(rel); }\n-      }\n+    let mut out = Vec::new();\n+    fn rec(cur: &Path, base: &Path, out: &mut Vec<String>) {\n+        if let Ok(entries) = fs::read_dir(cur) {\n+            for ent in entries.flatten() {\n+                let p = ent.path();\n+                if p.file_name().map(|s| s == \".git\").unwrap_or(false) {\n+                    continue;\n+                }\n+                let rel = p\n+                    .strip_prefix(base)\n+                    .unwrap()\n+                    .to_string_lossy()\n+                    .replace('\\\\', \"/\");\n+                if should_ignore(base, &rel) {\n+                    continue;\n+                }\n+                if p.is_dir() {\n+                    rec(&p, base, out);\n+                } else if p.is_file() {\n+                    out.push(rel);\n+                }\n+            }\n+        }\n     }\n-  }\n-  rec(root, root, &mut out);\n-  out\n+    rec(root, root, &mut out);\n+    out\n }\n \n pub fn diff_workspace(opts: GitDiffWorkspaceOptions) -> Result<Vec<DiffEntry>> {\n-  let cwd = PathBuf::from(&opts.worktreePath);\n-  let include = opts.includeContents.unwrap_or(true);\n-  let max_bytes = opts.maxBytes.unwrap_or(950*1024) as usize;\n-  let _ = crate::repo::cache::swr_fetch_origin_all_path(&cwd, crate::repo::cache::fetch_window_ms());\n-  let repo = gix::open(&cwd)?;\n+    let cwd = PathBuf::from(&opts.worktreePath);\n+    let include = opts.includeContents.unwrap_or(true);\n+    let max_bytes = opts.maxBytes.unwrap_or(950 * 1024) as usize;\n+    let _ =\n+        crate::repo::cache::swr_fetch_origin_all_path(&cwd, crate::repo::cache::fetch_window_ms());\n+    let repo = gix::open(&cwd)?;\n \n-  // Determine base tree for diff. If HEAD is unborn (no commits), fall back to remote default.\n-  let mut base_map: HashMap<String, ObjectId> = HashMap::new();\n-  match repo.head_commit() {\n-    Ok(commit) => {\n-      let head_oid = commit.id;\n-      let base_candidate = default_remote_head(&repo).unwrap_or(head_oid);\n-      let merge_base = merge_base_oid(&repo, base_candidate, head_oid);\n-      let base_commit = repo.find_object(merge_base)?.try_into_commit()?;\n-      let base_tree_id = base_commit.tree_id()?.detach();\n-      collect_tree_blobs(&repo, base_tree_id, \"\", &mut base_map)?;\n-    }\n-    Err(_) => {\n-      // Unborn HEAD: try remote default HEAD tree; otherwise empty base\n-      if let Some(remote_head) = default_remote_head(&repo) {\n-        if let Ok(obj) = repo.find_object(remote_head) {\n-          if let Ok(base_commit) = obj.try_into_commit() {\n-            if let Ok(tree_id) = base_commit.tree_id() {\n-              collect_tree_blobs(&repo, tree_id.detach(), \"\", &mut base_map)?;\n+    // Determine base tree for diff. If HEAD is unborn (no commits), fall back to remote default.\n+    let mut base_map: HashMap<String, ObjectId> = HashMap::new();\n+    match repo.head_commit() {\n+        Ok(commit) => {\n+            let head_oid = commit.id;\n+            let base_candidate = default_remote_head(&repo).unwrap_or(head_oid);\n+            let merge_base = merge_base_oid(&repo, base_candidate, head_oid);\n+            let base_commit = repo.find_object(merge_base)?.try_into_commit()?;\n+            let base_tree_id = base_commit.tree_id()?.detach();\n+            collect_tree_blobs(&repo, base_tree_id, \"\", &mut base_map)?;\n+        }\n+        Err(_) => {\n+            // Unborn HEAD: try remote default HEAD tree; otherwise empty base\n+            if let Some(remote_head) = default_remote_head(&repo) {\n+                if let Ok(obj) = repo.find_object(remote_head) {\n+                    if let Ok(base_commit) = obj.try_into_commit() {\n+                        if let Ok(tree_id) = base_commit.tree_id() {\n+                            collect_tree_blobs(&repo, tree_id.detach(), \"\", &mut base_map)?;\n+                        }\n+                    }\n+                }\n             }\n-          }\n         }\n-      }\n     }\n-  }\n \n-  let workdir = repo.work_dir().unwrap_or_else(|| cwd.as_path());\n-  let files = scan_workdir(workdir);\n+    let workdir = repo.work_dir().unwrap_or(cwd.as_path());\n+    let files = scan_workdir(workdir);\n \n-  let mut out: Vec<DiffEntry> = Vec::new();\n+    let mut out: Vec<DiffEntry> = Vec::new();\n \n-  for rel in &files {\n-    let abs = workdir.join(rel);\n-    let new_data = fs::read(&abs).unwrap_or_default();\n-    match base_map.get(rel) {\n-      None => {\n-        let bin = is_binary(&new_data);\n-        let mut e = DiffEntry{ filePath: rel.clone(), status: \"added\".into(), additions: 0, deletions: 0, isBinary: bin, ..Default::default() };\n-        if include && !bin {\n-          let new_str = String::from_utf8_lossy(&new_data).into_owned();\n-          let new_sz = new_str.as_bytes().len();\n-          e.newSize = Some(new_sz as i32);\n-          e.oldSize = Some(0);\n-          if new_sz <= max_bytes { e.newContent = Some(new_str.clone()); e.oldContent = Some(String::new()); e.contentOmitted = Some(false); e.additions = new_str.lines().count() as i32; } else { e.contentOmitted = Some(true) }\n-        } else { e.contentOmitted = Some(false) }\n-        out.push(e);\n-      }\n-      Some(old_id) => {\n+    for rel in &files {\n+        let abs = workdir.join(rel);\n+        let new_data = fs::read(&abs).unwrap_or_default();\n+        match base_map.get(rel) {\n+            None => {\n+                let bin = is_binary(&new_data);\n+                let mut e = DiffEntry {\n+                    filePath: rel.clone(),\n+                    status: \"added\".into(),\n+                    additions: 0,\n+                    deletions: 0,\n+                    isBinary: bin,\n+                    ..Default::default()\n+                };\n+                if include && !bin {\n+                    let new_str = String::from_utf8_lossy(&new_data).into_owned();\n+                    let new_sz = new_str.len();\n+                    e.newSize = Some(new_sz as i32);\n+                    e.oldSize = Some(0);\n+                    if new_sz <= max_bytes {\n+                        e.newContent = Some(new_str.clone());\n+                        e.oldContent = Some(String::new());\n+                        e.contentOmitted = Some(false);\n+                        e.additions = new_str.lines().count() as i32;\n+                    } else {\n+                        e.contentOmitted = Some(true)\n+                    }\n+                } else {\n+                    e.contentOmitted = Some(false)\n+                }\n+                out.push(e);\n+            }\n+            Some(old_id) => {\n+                let old_blob = repo.find_object(*old_id)?.try_into_blob()?;\n+                let old_data = &old_blob.data;\n+                if new_data == *old_data {\n+                    continue;\n+                }\n+                let bin = is_binary(old_data) || is_binary(&new_data);\n+                let mut e = DiffEntry {\n+                    filePath: rel.clone(),\n+                    status: \"modified\".into(),\n+                    additions: 0,\n+                    deletions: 0,\n+                    isBinary: bin,\n+                    ..Default::default()\n+                };\n+                if include && !bin {\n+                    let old_str = String::from_utf8_lossy(old_data).into_owned();\n+                    let new_str = String::from_utf8_lossy(&new_data).into_owned();\n+                    let old_sz = old_str.len();\n+                    let new_sz = new_str.len();\n+                    if old_sz + new_sz <= max_bytes {\n+                        let diff = TextDiff::from_lines(&old_str, &new_str);\n+                        let mut adds = 0i32;\n+                        let mut dels = 0i32;\n+                        for op in diff.ops() {\n+                            let tag = op.tag();\n+                            for ch in diff.iter_changes(op) {\n+                                match (tag, ch.tag()) {\n+                                    (similar::DiffTag::Insert, _) => adds += 1,\n+                                    (similar::DiffTag::Delete, _) => dels += 1,\n+                                    _ => {}\n+                                }\n+                            }\n+                        }\n+                        e.additions = adds;\n+                        e.deletions = dels;\n+                        e.oldContent = Some(old_str);\n+                        e.newContent = Some(new_str);\n+                        e.contentOmitted = Some(false);\n+                    } else {\n+                        e.contentOmitted = Some(true)\n+                    }\n+                    e.oldSize = Some(old_sz as i32);\n+                    e.newSize = Some(new_sz as i32);\n+                } else {\n+                    e.contentOmitted = Some(false)\n+                }\n+                if include && !e.isBinary && e.additions == 0 && e.deletions == 0 {\n+                    continue;\n+                }\n+                out.push(e);\n+            }\n+        }\n+    }\n+\n+    let file_set: HashSet<&str> = files.iter().map(|s| s.as_str()).collect();\n+    for (rel, old_id) in &base_map {\n+        if file_set.contains(rel.as_str()) {\n+            continue;\n+        }\n         let old_blob = repo.find_object(*old_id)?.try_into_blob()?;\n         let old_data = &old_blob.data;\n-        if new_data == *old_data { continue; }\n-        let bin = is_binary(&old_data) || is_binary(&new_data);\n-        let mut e = DiffEntry{ filePath: rel.clone(), status: \"modified\".into(), additions: 0, deletions: 0, isBinary: bin, ..Default::default() };\n+        let bin = is_binary(old_data);\n+        let mut e = DiffEntry {\n+            filePath: rel.clone(),\n+            status: \"deleted\".into(),\n+            additions: 0,\n+            deletions: 0,\n+            isBinary: bin,\n+            ..Default::default()\n+        };\n         if include && !bin {\n-          let old_str = String::from_utf8_lossy(&old_data).into_owned();\n-          let new_str = String::from_utf8_lossy(&new_data).into_owned();\n-          let old_sz = old_str.as_bytes().len(); let new_sz = new_str.as_bytes().len();\n-          if old_sz + new_sz <= max_bytes { let diff = TextDiff::from_lines(&old_str, &new_str); let mut adds=0i32; let mut dels=0i32; for op in diff.ops(){ let tag=op.tag(); for ch in diff.iter_changes(op){ match (tag, ch.tag()) { (similar::DiffTag::Insert, _) => adds+=1, (similar::DiffTag::Delete, _) => dels+=1, _=>{} } } } e.additions=adds; e.deletions=dels; e.oldContent=Some(old_str); e.newContent=Some(new_str); e.contentOmitted=Some(false);} else { e.contentOmitted=Some(true) }\n-          e.oldSize = Some(old_sz as i32); e.newSize = Some(new_sz as i32);\n-        } else { e.contentOmitted = Some(false) }\n-        if include && !e.isBinary && e.additions==0 && e.deletions==0 { continue; }\n+            let old_str = String::from_utf8_lossy(old_data).into_owned();\n+            let old_sz = old_str.len();\n+            e.oldSize = Some(old_sz as i32);\n+            if old_sz <= max_bytes {\n+                e.oldContent = Some(old_str);\n+                e.newContent = Some(String::new());\n+                e.contentOmitted = Some(false);\n+                e.deletions = e.oldContent.as_ref().unwrap().lines().count() as i32;\n+            } else {\n+                e.contentOmitted = Some(true)\n+            }\n+        } else {\n+            e.contentOmitted = Some(false)\n+        }\n         out.push(e);\n-      }\n     }\n-  }\n-\n-  let file_set: HashSet<&str> = files.iter().map(|s| s.as_str()).collect();\n-  for (rel, old_id) in &base_map {\n-    if file_set.contains(rel.as_str()) { continue; }\n-    let old_blob = repo.find_object(*old_id)?.try_into_blob()?;\n-    let old_data = &old_blob.data;\n-    let bin = is_binary(&old_data);\n-    let mut e = DiffEntry{ filePath: rel.clone(), status: \"deleted\".into(), additions: 0, deletions: 0, isBinary: bin, ..Default::default() };\n-    if include && !bin {\n-      let old_str = String::from_utf8_lossy(&old_data).into_owned();\n-      let old_sz = old_str.as_bytes().len();\n-      e.oldSize = Some(old_sz as i32);\n-      if old_sz <= max_bytes { e.oldContent = Some(old_str); e.newContent = Some(String::new()); e.contentOmitted = Some(false); e.deletions = e.oldContent.as_ref().unwrap().lines().count() as i32; } else { e.contentOmitted = Some(true) }\n-    } else { e.contentOmitted = Some(false) }\n-    out.push(e);\n-  }\n \n-  // Stable sort by filePath (case-insensitive)\n-  out.sort_by(|a, b| {\n-    a.filePath.to_lowercase().cmp(&b.filePath.to_lowercase())\n-      .then_with(|| a.filePath.cmp(&b.filePath))\n-  });\n+    // Stable sort by filePath (case-insensitive)\n+    out.sort_by(|a, b| {\n+        a.filePath\n+            .to_lowercase()\n+            .cmp(&b.filePath.to_lowercase())\n+            .then_with(|| a.filePath.cmp(&b.filePath))\n+    });\n \n-  Ok(out)\n+    Ok(out)\n }\ndiff --git a/apps/server/native/core/src/lib.rs b/apps/server/native/core/src/lib.rs\nindex da06293c7..76306ad88 100644\n--- a/apps/server/native/core/src/lib.rs\n+++ b/apps/server/native/core/src/lib.rs\n@@ -1,11 +1,11 @@\n #![deny(clippy::all)]\n \n-mod types;\n-mod util;\n-mod repo;\n+mod branches;\n mod diff;\n mod merge_base;\n-mod branches;\n+mod repo;\n+mod types;\n+mod util;\n \n use napi::bindgen_prelude::*;\n use napi_derive::napi;\n@@ -13,17 +13,17 @@ use types::{BranchInfo, DiffEntry, GitDiffOptions, GitListRemoteBranchesOptions}\n \n #[napi]\n pub async fn get_time() -> String {\n-  use std::time::{SystemTime, UNIX_EPOCH};\n-  #[cfg(debug_assertions)]\n-  println!(\"[cmux_native_core] get_time invoked\");\n-  let now = SystemTime::now().duration_since(UNIX_EPOCH).unwrap();\n-  now.as_millis().to_string()\n+    use std::time::{SystemTime, UNIX_EPOCH};\n+    #[cfg(debug_assertions)]\n+    println!(\"[cmux_native_core] get_time invoked\");\n+    let now = SystemTime::now().duration_since(UNIX_EPOCH).unwrap();\n+    now.as_millis().to_string()\n }\n \n #[napi]\n pub async fn git_diff(opts: GitDiffOptions) -> Result<Vec<DiffEntry>> {\n-  #[cfg(debug_assertions)]\n-  println!(\n+    #[cfg(debug_assertions)]\n+    println!(\n     \"[cmux_native_git] git_diff headRef={} baseRef={:?} originPathOverride={:?} repoUrl={:?} repoFullName={:?} includeContents={:?} maxBytes={:?}\",\n     opts.headRef,\n     opts.baseRef,\n@@ -33,25 +33,27 @@ pub async fn git_diff(opts: GitDiffOptions) -> Result<Vec<DiffEntry>> {\n     opts.includeContents,\n     opts.maxBytes\n   );\n-  tokio::task::spawn_blocking(move || diff::refs::diff_refs(opts))\n-    .await\n-    .map_err(|e| Error::from_reason(format!(\"Join error: {e}\")))?\n-    .map_err(|e| Error::from_reason(format!(\"{e:#}\")))\n+    tokio::task::spawn_blocking(move || diff::refs::diff_refs(opts))\n+        .await\n+        .map_err(|e| Error::from_reason(format!(\"Join error: {e}\")))?\n+        .map_err(|e| Error::from_reason(format!(\"{e:#}\")))\n }\n \n #[napi]\n-pub async fn git_list_remote_branches(opts: GitListRemoteBranchesOptions) -> Result<Vec<BranchInfo>> {\n-  #[cfg(debug_assertions)]\n-  println!(\n+pub async fn git_list_remote_branches(\n+    opts: GitListRemoteBranchesOptions,\n+) -> Result<Vec<BranchInfo>> {\n+    #[cfg(debug_assertions)]\n+    println!(\n     \"[cmux_native_git] git_list_remote_branches repoFullName={:?} repoUrl={:?} originPathOverride={:?}\",\n     opts.repoFullName,\n     opts.repoUrl,\n     opts.originPathOverride\n   );\n-  tokio::task::spawn_blocking(move || branches::list_remote_branches(opts))\n-    .await\n-    .map_err(|e| Error::from_reason(format!(\"Join error: {e}\")))?\n-    .map_err(|e| Error::from_reason(format!(\"{e:#}\")))\n+    tokio::task::spawn_blocking(move || branches::list_remote_branches(opts))\n+        .await\n+        .map_err(|e| Error::from_reason(format!(\"Join error: {e}\")))?\n+        .map_err(|e| Error::from_reason(format!(\"{e:#}\")))\n }\n \n #[cfg(test)]\ndiff --git a/apps/server/native/core/src/merge_base/bfs.rs b/apps/server/native/core/src/merge_base/bfs.rs\nindex d52ef8d4e..998d91c0f 100644\n--- a/apps/server/native/core/src/merge_base/bfs.rs\n+++ b/apps/server/native/core/src/merge_base/bfs.rs\n@@ -3,142 +3,208 @@ use std::collections::{HashMap, VecDeque};\n // Instant is only used in tests\n \n pub fn merge_base_bfs(repo: &Repository, a: ObjectId, b: ObjectId) -> Option<ObjectId> {\n-  if a == b { return Some(a); }\n-\n-  let mut dist_a: HashMap<ObjectId, usize> = HashMap::new();\n-  let mut dist_b: HashMap<ObjectId, usize> = HashMap::new();\n-  let mut qa: VecDeque<ObjectId> = VecDeque::new();\n-  let mut qb: VecDeque<ObjectId> = VecDeque::new();\n-  qa.push_back(a);\n-  qb.push_back(b);\n-  dist_a.insert(a, 0);\n-  dist_b.insert(b, 0);\n-\n-  let mut best: Option<(ObjectId, usize)> = None; // (id, cost)\n-\n-  fn expand(\n-    from_a: bool,\n-    repo: &Repository,\n-    qa: &mut VecDeque<ObjectId>,\n-    qb: &mut VecDeque<ObjectId>,\n-    dist_a: &mut HashMap<ObjectId, usize>,\n-    dist_b: &mut HashMap<ObjectId, usize>,\n-    best: &mut Option<(ObjectId, usize)>,\n-  ) -> bool {\n-    let (this_q, this_d, other_d) = if from_a {\n-      (qa, dist_a, dist_b)\n-    } else {\n-      (qb, dist_b, dist_a)\n-    };\n-    if let Some(cur) = this_q.pop_front() {\n-      let d = *this_d.get(&cur).unwrap();\n-      if let Some((_, best_cost)) = best.as_ref() {\n-        if d > *best_cost { return false; }\n-      }\n-      if let Ok(obj) = repo.find_object(cur) {\n-        if let Ok(commit) = obj.try_into_commit() {\n-          for p in commit.parent_ids() {\n-            let pid = p.detach();\n-            if !this_d.contains_key(&pid) {\n-              this_d.insert(pid, d + 1);\n-              this_q.push_back(pid);\n-              if let Some(od) = other_d.get(&pid) {\n-                let cost = (d + 1) + *od;\n-                match best {\n-                  None => *best = Some((pid, cost)),\n-                  Some((_, c)) if cost < *c => *best = Some((pid, cost)),\n-                  _ => {}\n+    if a == b {\n+        return Some(a);\n+    }\n+\n+    let mut dist_a: HashMap<ObjectId, usize> = HashMap::new();\n+    let mut dist_b: HashMap<ObjectId, usize> = HashMap::new();\n+    let mut qa: VecDeque<ObjectId> = VecDeque::new();\n+    let mut qb: VecDeque<ObjectId> = VecDeque::new();\n+    qa.push_back(a);\n+    qb.push_back(b);\n+    dist_a.insert(a, 0);\n+    dist_b.insert(b, 0);\n+\n+    let mut best: Option<(ObjectId, usize)> = None; // (id, cost)\n+\n+    fn expand(\n+        from_a: bool,\n+        repo: &Repository,\n+        qa: &mut VecDeque<ObjectId>,\n+        qb: &mut VecDeque<ObjectId>,\n+        dist_a: &mut HashMap<ObjectId, usize>,\n+        dist_b: &mut HashMap<ObjectId, usize>,\n+        best: &mut Option<(ObjectId, usize)>,\n+    ) -> bool {\n+        let (this_q, this_d, other_d) = if from_a {\n+            (qa, dist_a, dist_b)\n+        } else {\n+            (qb, dist_b, dist_a)\n+        };\n+        if let Some(cur) = this_q.pop_front() {\n+            let d = *this_d.get(&cur).unwrap();\n+            if let Some((_, best_cost)) = best.as_ref() {\n+                if d > *best_cost {\n+                    return false;\n                 }\n-              }\n             }\n-          }\n+            if let Ok(obj) = repo.find_object(cur) {\n+                if let Ok(commit) = obj.try_into_commit() {\n+                    for p in commit.parent_ids() {\n+                        let pid = p.detach();\n+                        if let std::collections::hash_map::Entry::Vacant(e) = this_d.entry(pid) {\n+                            e.insert(d + 1);\n+                            this_q.push_back(pid);\n+                            if let Some(od) = other_d.get(&pid) {\n+                                let cost = (d + 1) + *od;\n+                                match best {\n+                                    None => *best = Some((pid, cost)),\n+                                    Some((_, c)) if cost < *c => *best = Some((pid, cost)),\n+                                    _ => {}\n+                                }\n+                            }\n+                        }\n+                    }\n+                }\n+            }\n+            return true;\n         }\n-      }\n-      return true;\n+        false\n     }\n-    false\n-  }\n-\n-  // Alternate expanding the smaller frontier for performance.\n-  loop {\n-    let next_from_a = qa.len() <= qb.len();\n-    let progressed = expand(next_from_a, &repo, &mut qa, &mut qb, &mut dist_a, &mut dist_b, &mut best)\n-      || expand(!next_from_a, &repo, &mut qa, &mut qb, &mut dist_a, &mut dist_b, &mut best);\n-    if !progressed { break; }\n-  }\n-\n-  best.map(|(id, _)| id).or(Some(a))\n+\n+    // Alternate expanding the smaller frontier for performance.\n+    loop {\n+        let next_from_a = qa.len() <= qb.len();\n+        let progressed = expand(\n+            next_from_a,\n+            repo,\n+            &mut qa,\n+            &mut qb,\n+            &mut dist_a,\n+            &mut dist_b,\n+            &mut best,\n+        ) || expand(\n+            !next_from_a,\n+            repo,\n+            &mut qa,\n+            &mut qb,\n+            &mut dist_a,\n+            &mut dist_b,\n+            &mut best,\n+        );\n+        if !progressed {\n+            break;\n+        }\n+    }\n+\n+    best.map(|(id, _)| id).or(Some(a))\n }\n \n #[cfg(test)]\n mod tests {\n-  use super::*;\n-  use std::time::Instant;\n-  use std::{fs, process::Command};\n-  use tempfile::tempdir;\n-\n-  fn run(cwd: &std::path::Path, cmd: &str) {\n-    let status = if cfg!(target_os = \"windows\") {\n-      Command::new(\"cmd\").arg(\"/C\").arg(cmd).current_dir(cwd).status()\n-    } else {\n-      Command::new(\"sh\").arg(\"-c\").arg(cmd).current_dir(cwd).status()\n-    }\n-    .expect(\"spawn\");\n-    assert!(status.success(), \"command failed: {cmd}\");\n-  }\n-\n-  #[test]\n-  fn bench_merge_base_bfs_vs_git_local_repo() {\n-    let tmp = tempdir().unwrap();\n-    let repo_dir = tmp.path().join(\"repo\");\n-    fs::create_dir_all(&repo_dir).unwrap();\n-    run(&repo_dir, \"git init\");\n-    run(&repo_dir, \"git -c user.email=a@b -c user.name=test checkout -b main\");\n-    fs::write(repo_dir.join(\"file.txt\"), \"base\\n\").unwrap();\n-    run(&repo_dir, \"git add .\");\n-    run(&repo_dir, \"git -c user.email=a@b -c user.name=test commit -m base\");\n-    run(&repo_dir, \"git checkout -b feature\");\n-\n-    let n = 60;\n-    for i in 1..=n {\n-      fs::write(repo_dir.join(\"file.txt\"), format!(\"f{}\\n\", i)).unwrap();\n-      run(&repo_dir, \"git add .\");\n-      run(&repo_dir, &format!(\"git -c user.email=a@b -c user.name=test commit -m f{}\", i));\n-    }\n-    run(&repo_dir, \"git checkout main\");\n-    for i in 1..=n {\n-      fs::write(repo_dir.join(\"file.txt\"), format!(\"m{}\\n\", i)).unwrap();\n-      run(&repo_dir, \"git add .\");\n-      run(&repo_dir, &format!(\"git -c user.email=a@b -c user.name=test commit -m m{}\", i));\n+    use super::*;\n+    use std::time::Instant;\n+    use std::{fs, process::Command};\n+    use tempfile::tempdir;\n+\n+    fn run(cwd: &std::path::Path, cmd: &str) {\n+        let status = if cfg!(target_os = \"windows\") {\n+            Command::new(\"cmd\")\n+                .arg(\"/C\")\n+                .arg(cmd)\n+                .current_dir(cwd)\n+                .status()\n+        } else {\n+            Command::new(\"sh\")\n+                .arg(\"-c\")\n+                .arg(cmd)\n+                .current_dir(cwd)\n+                .status()\n+        }\n+        .expect(\"spawn\");\n+        assert!(status.success(), \"command failed: {cmd}\");\n     }\n \n-    let repo = gix::open(&repo_dir).unwrap();\n-    let main_oid = repo.find_reference(\"refs/heads/main\").unwrap().target().try_id().unwrap().to_owned();\n-    let feat_oid = repo.find_reference(\"refs/heads/feature\").unwrap().target().try_id().unwrap().to_owned();\n-\n-    // correctness\n-    let via_git = crate::merge_base::git::merge_base_git(&repo_dir.to_string_lossy(), main_oid, feat_oid).unwrap();\n-    let via_bfs = merge_base_bfs(&repo, main_oid, feat_oid).unwrap();\n-    assert_eq!(via_git, via_bfs, \"merge-base mismatch\");\n-\n-    // quick micro-benchmark\n-    let iters = 20;\n-\n-    let t1 = Instant::now();\n-    let mut last = None;\n-    for _ in 0..iters { last = crate::merge_base::git::merge_base_git(&repo_dir.to_string_lossy(), main_oid, feat_oid); }\n-    let d_git = t1.elapsed();\n-    assert_eq!(last, Some(via_git));\n-\n-    let t2 = Instant::now();\n-    let mut last2 = None;\n-    for _ in 0..iters { last2 = merge_base_bfs(&repo, main_oid, feat_oid); }\n-    let d_bfs = t2.elapsed();\n-    assert_eq!(last2, Some(via_bfs));\n-\n-    println!(\n-      \"merge_base bench: git={}ms total ({} iters), bfs={}ms total ({} iters)\",\n-      d_git.as_millis(), iters, d_bfs.as_millis(), iters\n-    );\n-  }\n+    #[test]\n+    fn bench_merge_base_bfs_vs_git_local_repo() {\n+        let tmp = tempdir().unwrap();\n+        let repo_dir = tmp.path().join(\"repo\");\n+        fs::create_dir_all(&repo_dir).unwrap();\n+        run(&repo_dir, \"git init\");\n+        run(\n+            &repo_dir,\n+            \"git -c user.email=a@b -c user.name=test checkout -b main\",\n+        );\n+        fs::write(repo_dir.join(\"file.txt\"), \"base\\n\").unwrap();\n+        run(&repo_dir, \"git add .\");\n+        run(\n+            &repo_dir,\n+            \"git -c user.email=a@b -c user.name=test commit -m base\",\n+        );\n+        run(&repo_dir, \"git checkout -b feature\");\n+\n+        let n = 60;\n+        for i in 1..=n {\n+            fs::write(repo_dir.join(\"file.txt\"), format!(\"f{}\\n\", i)).unwrap();\n+            run(&repo_dir, \"git add .\");\n+            run(\n+                &repo_dir,\n+                &format!(\"git -c user.email=a@b -c user.name=test commit -m f{}\", i),\n+            );\n+        }\n+        run(&repo_dir, \"git checkout main\");\n+        for i in 1..=n {\n+            fs::write(repo_dir.join(\"file.txt\"), format!(\"m{}\\n\", i)).unwrap();\n+            run(&repo_dir, \"git add .\");\n+            run(\n+                &repo_dir,\n+                &format!(\"git -c user.email=a@b -c user.name=test commit -m m{}\", i),\n+            );\n+        }\n+\n+        let repo = gix::open(&repo_dir).unwrap();\n+        let main_oid = repo\n+            .find_reference(\"refs/heads/main\")\n+            .unwrap()\n+            .target()\n+            .try_id()\n+            .unwrap()\n+            .to_owned();\n+        let feat_oid = repo\n+            .find_reference(\"refs/heads/feature\")\n+            .unwrap()\n+            .target()\n+            .try_id()\n+            .unwrap()\n+            .to_owned();\n+\n+        // correctness\n+        let via_git =\n+            crate::merge_base::git::merge_base_git(&repo_dir.to_string_lossy(), main_oid, feat_oid)\n+                .unwrap();\n+        let via_bfs = merge_base_bfs(&repo, main_oid, feat_oid).unwrap();\n+        assert_eq!(via_git, via_bfs, \"merge-base mismatch\");\n+\n+        // quick micro-benchmark\n+        let iters = 20;\n+\n+        let t1 = Instant::now();\n+        let mut last = None;\n+        for _ in 0..iters {\n+            last = crate::merge_base::git::merge_base_git(\n+                &repo_dir.to_string_lossy(),\n+                main_oid,\n+                feat_oid,\n+            );\n+        }\n+        let d_git = t1.elapsed();\n+        assert_eq!(last, Some(via_git));\n+\n+        let t2 = Instant::now();\n+        let mut last2 = None;\n+        for _ in 0..iters {\n+            last2 = merge_base_bfs(&repo, main_oid, feat_oid);\n+        }\n+        let d_bfs = t2.elapsed();\n+        assert_eq!(last2, Some(via_bfs));\n+\n+        println!(\n+            \"merge_base bench: git={}ms total ({} iters), bfs={}ms total ({} iters)\",\n+            d_git.as_millis(),\n+            iters,\n+            d_bfs.as_millis(),\n+            iters\n+        );\n+    }\n }\ndiff --git a/apps/server/native/core/src/merge_base/git.rs b/apps/server/native/core/src/merge_base/git.rs\nindex 9ec79bc2b..ec6afbc17 100644\n--- a/apps/server/native/core/src/merge_base/git.rs\n+++ b/apps/server/native/core/src/merge_base/git.rs\n@@ -1,13 +1,15 @@\n use gix::hash::ObjectId;\n \n pub fn merge_base_git(repo_path: &str, a: ObjectId, b: ObjectId) -> Option<ObjectId> {\n-  if let Ok(out) = crate::util::run_git(repo_path, &[\"merge-base\", &a.to_string(), &b.to_string()]) {\n-    if let Some(line) = out.lines().next() {\n-      let hex = line.trim();\n-      if let Ok(oid) = ObjectId::from_hex(hex.as_bytes()) {\n-        return Some(oid);\n-      }\n+    if let Ok(out) =\n+        crate::util::run_git(repo_path, &[\"merge-base\", &a.to_string(), &b.to_string()])\n+    {\n+        if let Some(line) = out.lines().next() {\n+            let hex = line.trim();\n+            if let Ok(oid) = ObjectId::from_hex(hex.as_bytes()) {\n+                return Some(oid);\n+            }\n+        }\n     }\n-  }\n-  None\n+    None\n }\ndiff --git a/apps/server/native/core/src/merge_base/mod.rs b/apps/server/native/core/src/merge_base/mod.rs\nindex 716220c7a..2b1c00100 100644\n--- a/apps/server/native/core/src/merge_base/mod.rs\n+++ b/apps/server/native/core/src/merge_base/mod.rs\n@@ -3,67 +3,105 @@ use gix::hash::ObjectId;\n #[allow(dead_code)]\n #[derive(Debug, Clone)]\n pub enum MergeBaseStrategy {\n-  Git,\n-  Bfs,\n+    Git,\n+    Bfs,\n }\n \n-pub fn merge_base(cwd: &str, repo: &gix::Repository, a: ObjectId, b: ObjectId, strat: MergeBaseStrategy) -> Option<ObjectId> {\n-  match strat {\n-    MergeBaseStrategy::Git => git::merge_base_git(cwd, a, b),\n-    MergeBaseStrategy::Bfs => bfs::merge_base_bfs(repo, a, b),\n-  }\n+pub fn merge_base(\n+    cwd: &str,\n+    repo: &gix::Repository,\n+    a: ObjectId,\n+    b: ObjectId,\n+    strat: MergeBaseStrategy,\n+) -> Option<ObjectId> {\n+    match strat {\n+        MergeBaseStrategy::Git => git::merge_base_git(cwd, a, b),\n+        MergeBaseStrategy::Bfs => bfs::merge_base_bfs(repo, a, b),\n+    }\n }\n \n-pub mod git;\n pub mod bfs;\n+pub mod git;\n \n #[cfg(test)]\n mod tests {\n-  use super::*;\n-  use std::{fs, process::Command};\n-  use tempfile::tempdir;\n+    use super::*;\n+    use std::{fs, process::Command};\n+    use tempfile::tempdir;\n \n-  fn run(cwd: &std::path::Path, cmd: &str) {\n-    let status = if cfg!(target_os = \"windows\") {\n-      Command::new(\"cmd\").arg(\"/C\").arg(cmd).current_dir(cwd).status()\n-    } else {\n-      Command::new(\"sh\").arg(\"-c\").arg(cmd).current_dir(cwd).status()\n+    fn run(cwd: &std::path::Path, cmd: &str) {\n+        let status = if cfg!(target_os = \"windows\") {\n+            Command::new(\"cmd\")\n+                .arg(\"/C\")\n+                .arg(cmd)\n+                .current_dir(cwd)\n+                .status()\n+        } else {\n+            Command::new(\"sh\")\n+                .arg(\"-c\")\n+                .arg(cmd)\n+                .current_dir(cwd)\n+                .status()\n+        }\n+        .expect(\"spawn\");\n+        assert!(status.success(), \"command failed: {cmd}\");\n     }\n-    .expect(\"spawn\");\n-    assert!(status.success(), \"command failed: {cmd}\");\n-  }\n \n-  #[test]\n-  fn merge_base_correctness_small_repo() {\n-    let tmp = tempdir().unwrap();\n-    let repo_dir = tmp.path().join(\"repo\");\n-    fs::create_dir_all(&repo_dir).unwrap();\n-    run(&repo_dir, \"git init\");\n-    run(&repo_dir, \"git -c user.email=a@b -c user.name=test checkout -b main\");\n-    fs::write(repo_dir.join(\"file.txt\"), \"base\\n\").unwrap();\n-    run(&repo_dir, \"git add .\");\n-    run(&repo_dir, \"git -c user.email=a@b -c user.name=test commit -m base\");\n-    run(&repo_dir, \"git checkout -b feature\");\n+    #[test]\n+    fn merge_base_correctness_small_repo() {\n+        let tmp = tempdir().unwrap();\n+        let repo_dir = tmp.path().join(\"repo\");\n+        fs::create_dir_all(&repo_dir).unwrap();\n+        run(&repo_dir, \"git init\");\n+        run(\n+            &repo_dir,\n+            \"git -c user.email=a@b -c user.name=test checkout -b main\",\n+        );\n+        fs::write(repo_dir.join(\"file.txt\"), \"base\\n\").unwrap();\n+        run(&repo_dir, \"git add .\");\n+        run(\n+            &repo_dir,\n+            \"git -c user.email=a@b -c user.name=test commit -m base\",\n+        );\n+        run(&repo_dir, \"git checkout -b feature\");\n \n-    let n = 60;\n-    for i in 1..=n {\n-      fs::write(repo_dir.join(\"file.txt\"), format!(\"f{}\\n\", i)).unwrap();\n-      run(&repo_dir, \"git add .\");\n-      run(&repo_dir, &format!(\"git -c user.email=a@b -c user.name=test commit -m f{}\", i));\n-    }\n-    run(&repo_dir, \"git checkout main\");\n-    for i in 1..=n {\n-      fs::write(repo_dir.join(\"file.txt\"), format!(\"m{}\\n\", i)).unwrap();\n-      run(&repo_dir, \"git add .\");\n-      run(&repo_dir, &format!(\"git -c user.email=a@b -c user.name=test commit -m m{}\", i));\n-    }\n+        let n = 60;\n+        for i in 1..=n {\n+            fs::write(repo_dir.join(\"file.txt\"), format!(\"f{}\\n\", i)).unwrap();\n+            run(&repo_dir, \"git add .\");\n+            run(\n+                &repo_dir,\n+                &format!(\"git -c user.email=a@b -c user.name=test commit -m f{}\", i),\n+            );\n+        }\n+        run(&repo_dir, \"git checkout main\");\n+        for i in 1..=n {\n+            fs::write(repo_dir.join(\"file.txt\"), format!(\"m{}\\n\", i)).unwrap();\n+            run(&repo_dir, \"git add .\");\n+            run(\n+                &repo_dir,\n+                &format!(\"git -c user.email=a@b -c user.name=test commit -m m{}\", i),\n+            );\n+        }\n \n-    let repo = gix::open(&repo_dir).unwrap();\n-    let main_oid = repo.find_reference(\"refs/heads/main\").unwrap().target().try_id().unwrap().to_owned();\n-    let feat_oid = repo.find_reference(\"refs/heads/feature\").unwrap().target().try_id().unwrap().to_owned();\n+        let repo = gix::open(&repo_dir).unwrap();\n+        let main_oid = repo\n+            .find_reference(\"refs/heads/main\")\n+            .unwrap()\n+            .target()\n+            .try_id()\n+            .unwrap()\n+            .to_owned();\n+        let feat_oid = repo\n+            .find_reference(\"refs/heads/feature\")\n+            .unwrap()\n+            .target()\n+            .try_id()\n+            .unwrap()\n+            .to_owned();\n \n-    let via_git = git::merge_base_git(&repo_dir.to_string_lossy(), main_oid, feat_oid).unwrap();\n-    let via_bfs = bfs::merge_base_bfs(&repo, main_oid, feat_oid).unwrap();\n-    assert_eq!(via_git, via_bfs, \"merge-base mismatch\");\n-  }\n+        let via_git = git::merge_base_git(&repo_dir.to_string_lossy(), main_oid, feat_oid).unwrap();\n+        let via_bfs = bfs::merge_base_bfs(&repo, main_oid, feat_oid).unwrap();\n+        assert_eq!(via_git, via_bfs, \"merge-base mismatch\");\n+    }\n }\ndiff --git a/apps/server/native/core/src/repo/cache.rs b/apps/server/native/core/src/repo/cache.rs\nindex 9c60d9418..64c89e356 100644\n--- a/apps/server/native/core/src/repo/cache.rs\n+++ b/apps/server/native/core/src/repo/cache.rs\n@@ -1,7 +1,11 @@\n use anyhow::{anyhow, Result};\n use dirs_next::cache_dir;\n-use std::{collections::HashMap, fs, path::PathBuf};\n use std::sync::{Mutex, OnceLock};\n+use std::{\n+    collections::HashMap,\n+    fs,\n+    path::{Path, PathBuf},\n+};\n \n use crate::util::run_git;\n \n@@ -11,249 +15,300 @@ const MAX_CACHE_REPOS: usize = 20;\n pub const DEFAULT_FETCH_WINDOW_MS: u128 = 5_000; // 5s\n \n pub fn fetch_window_ms() -> u128 {\n-  if let Ok(v) = std::env::var(\"CMUX_GIT_FETCH_WINDOW_MS\") {\n-    if let Ok(parsed) = v.parse::<u128>() { return parsed; }\n-  }\n-  DEFAULT_FETCH_WINDOW_MS\n+    if let Ok(v) = std::env::var(\"CMUX_GIT_FETCH_WINDOW_MS\") {\n+        if let Ok(parsed) = v.parse::<u128>() {\n+            return parsed;\n+        }\n+    }\n+    DEFAULT_FETCH_WINDOW_MS\n }\n \n #[derive(Debug, Clone, serde::Serialize, serde::Deserialize)]\n struct CacheIndexEntry {\n-  slug: String,\n-  path: String,\n-  last_access_ms: u128,\n-  #[serde(default)]\n-  last_fetch_ms: Option<u128>,\n+    slug: String,\n+    path: String,\n+    last_access_ms: u128,\n+    #[serde(default)]\n+    last_fetch_ms: Option<u128>,\n }\n \n #[derive(Default, Debug, Clone, serde::Serialize, serde::Deserialize)]\n struct CacheIndex {\n-  entries: Vec<CacheIndexEntry>,\n+    entries: Vec<CacheIndexEntry>,\n }\n \n fn default_cache_root() -> PathBuf {\n-  if let Ok(dir) = std::env::var(\"CMUX_RUST_GIT_CACHE\") { return PathBuf::from(dir); }\n-  if let Some(mut d) = cache_dir() { d.push(\"cmux-git-cache\"); return d; }\n-  std::env::temp_dir().join(\"cmux-git-cache\")\n+    if let Ok(dir) = std::env::var(\"CMUX_RUST_GIT_CACHE\") {\n+        return PathBuf::from(dir);\n+    }\n+    if let Some(mut d) = cache_dir() {\n+        d.push(\"cmux-git-cache\");\n+        return d;\n+    }\n+    std::env::temp_dir().join(\"cmux-git-cache\")\n }\n \n fn slug_from_url(url: &str) -> String {\n-  let clean = url.trim_end_matches(\".git\");\n-  let name = clean.split('/').rev().take(2).collect::<Vec<_>>();\n-  if name.len() == 2 { format!(\"{}__{}\", name[1], name[0]) } else { clean.replace(['/', ':', '@', '\\\\'], \"_\") }\n+    let clean = url.trim_end_matches(\".git\");\n+    let name = clean.split('/').rev().take(2).collect::<Vec<_>>();\n+    if name.len() == 2 {\n+        format!(\"{}__{}\", name[1], name[0])\n+    } else {\n+        clean.replace(['/', ':', '@', '\\\\'], \"_\")\n+    }\n }\n \n pub fn ensure_repo(url: &str) -> Result<PathBuf> {\n-  let root = default_cache_root();\n-  fs::create_dir_all(&root)?;\n-  let path = root.join(slug_from_url(url));\n-  let git_dir = path.join(\".git\");\n-  let head = git_dir.join(\"HEAD\");\n-  if path.exists() && (!git_dir.exists() || !head.exists()) {\n-    let _ = fs::remove_dir_all(&path);\n-  }\n-  if !path.exists() {\n-    fs::create_dir_all(&path)?;\n-    run_git(\n-      root.to_string_lossy().as_ref(),\n-      &[\"clone\", \"--no-single-branch\", url, path.file_name().unwrap().to_str().unwrap()]\n-    )?;\n-    let _ = update_cache_index_with(&root, &path, Some(now_ms()));\n-  } else {\n-    let _ = swr_fetch_origin_all_path_bool(&path, fetch_window_ms());\n-  }\n-  let shallow = path.join(\".git\").join(\"shallow\");\n-  if shallow.exists() {\n-    let _ = run_git(path.to_string_lossy().as_ref(), &[\"fetch\", \"--unshallow\", \"--tags\"]);\n-  }\n+    let root = default_cache_root();\n+    fs::create_dir_all(&root)?;\n+    let path = root.join(slug_from_url(url));\n+    let git_dir = path.join(\".git\");\n+    let head = git_dir.join(\"HEAD\");\n+    if path.exists() && (!git_dir.exists() || !head.exists()) {\n+        let _ = fs::remove_dir_all(&path);\n+    }\n+    if !path.exists() {\n+        fs::create_dir_all(&path)?;\n+        run_git(\n+            root.to_string_lossy().as_ref(),\n+            &[\n+                \"clone\",\n+                \"--no-single-branch\",\n+                url,\n+                path.file_name().unwrap().to_str().unwrap(),\n+            ],\n+        )?;\n+        let _ = update_cache_index_with(&root, &path, Some(now_ms()));\n+    } else {\n+        let _ = swr_fetch_origin_all_path_bool(&path, fetch_window_ms());\n+    }\n+    let shallow = path.join(\".git\").join(\"shallow\");\n+    if shallow.exists() {\n+        let _ = run_git(\n+            path.to_string_lossy().as_ref(),\n+            &[\"fetch\", \"--unshallow\", \"--tags\"],\n+        );\n+    }\n \n-  update_cache_index(&root, &path)?;\n-  enforce_cache_limit(&root)?;\n-  Ok(path)\n+    update_cache_index(&root, &path)?;\n+    enforce_cache_limit(&root)?;\n+    Ok(path)\n }\n \n pub fn resolve_repo_url(repo_full_name: Option<&str>, repo_url: Option<&str>) -> Result<String> {\n-  if let Some(u) = repo_url { return Ok(u.to_string()); }\n-  if let Some(full) = repo_full_name { return Ok(format!(\"https://github.com/{}.git\", full)); }\n-  Err(anyhow!(\"repoUrl or repoFullName required\"))\n+    if let Some(u) = repo_url {\n+        return Ok(u.to_string());\n+    }\n+    if let Some(full) = repo_full_name {\n+        return Ok(format!(\"https://github.com/{}.git\", full));\n+    }\n+    Err(anyhow!(\"repoUrl or repoFullName required\"))\n }\n \n-fn load_index(root: &PathBuf) -> CacheIndex {\n-  let idx_path = root.join(\"cache-index.json\");\n-  if let Ok(data) = fs::read(&idx_path) {\n-    if let Ok(idx) = serde_json::from_slice::<CacheIndex>(&data) {\n-      return idx;\n+fn load_index(root: &Path) -> CacheIndex {\n+    let idx_path = root.join(\"cache-index.json\");\n+    if let Ok(data) = fs::read(&idx_path) {\n+        if let Ok(idx) = serde_json::from_slice::<CacheIndex>(&data) {\n+            return idx;\n+        }\n     }\n-  }\n-  CacheIndex::default()\n+    CacheIndex::default()\n }\n \n-fn save_index(root: &PathBuf, idx: &CacheIndex) -> Result<()> {\n-  let idx_path = root.join(\"cache-index.json\");\n-  let data = serde_json::to_vec_pretty(idx)?;\n-  fs::write(idx_path, data)?;\n-  Ok(())\n+fn save_index(root: &Path, idx: &CacheIndex) -> Result<()> {\n+    let idx_path = root.join(\"cache-index.json\");\n+    let data = serde_json::to_vec_pretty(idx)?;\n+    fs::write(idx_path, data)?;\n+    Ok(())\n }\n \n-fn update_cache_index(root: &PathBuf, repo_path: &PathBuf) -> Result<()> {\n-  let mut idx = load_index(root);\n-  let slug = repo_path\n-    .file_name()\n-    .and_then(|s| s.to_str())\n-    .unwrap_or(\"\")\n-    .to_string();\n-  let now = std::time::SystemTime::now()\n-    .duration_since(std::time::UNIX_EPOCH)\n-    .unwrap()\n-    .as_millis();\n+fn update_cache_index(root: &Path, repo_path: &Path) -> Result<()> {\n+    let mut idx = load_index(root);\n+    let slug = repo_path\n+        .file_name()\n+        .and_then(|s| s.to_str())\n+        .unwrap_or(\"\")\n+        .to_string();\n+    let now = std::time::SystemTime::now()\n+        .duration_since(std::time::UNIX_EPOCH)\n+        .unwrap()\n+        .as_millis();\n \n-  if let Some(e) = idx.entries.iter_mut().find(|e| e.slug == slug) {\n-    e.last_access_ms = now;\n-    e.path = repo_path.to_string_lossy().to_string();\n-  } else {\n-    idx.entries.push(CacheIndexEntry {\n-      slug,\n-      path: repo_path.to_string_lossy().to_string(),\n-      last_access_ms: now,\n-      last_fetch_ms: None,\n-    });\n-  }\n-  idx.entries.sort_by(|a, b| b.last_access_ms.cmp(&a.last_access_ms));\n-  idx.entries.dedup_by(|a, b| a.slug == b.slug);\n-  save_index(root, &idx)?;\n-  Ok(())\n+    if let Some(e) = idx.entries.iter_mut().find(|e| e.slug == slug) {\n+        e.last_access_ms = now;\n+        e.path = repo_path.to_string_lossy().to_string();\n+    } else {\n+        idx.entries.push(CacheIndexEntry {\n+            slug,\n+            path: repo_path.to_string_lossy().to_string(),\n+            last_access_ms: now,\n+            last_fetch_ms: None,\n+        });\n+    }\n+    idx.entries\n+        .sort_by(|a, b| b.last_access_ms.cmp(&a.last_access_ms));\n+    idx.entries.dedup_by(|a, b| a.slug == b.slug);\n+    save_index(root, &idx)?;\n+    Ok(())\n }\n \n fn now_ms() -> u128 {\n-  std::time::SystemTime::now()\n-    .duration_since(std::time::UNIX_EPOCH)\n-    .unwrap()\n-    .as_millis()\n+    std::time::SystemTime::now()\n+        .duration_since(std::time::UNIX_EPOCH)\n+        .unwrap()\n+        .as_millis()\n }\n \n-fn update_cache_index_with(root: &PathBuf, repo_path: &PathBuf, last_fetch_ms: Option<u128>) -> Result<()> {\n-  let mut idx = load_index(root);\n-  let pstr = repo_path.to_string_lossy().to_string();\n-  let now = now_ms();\n-  if let Some(e) = idx.entries.iter_mut().find(|e| e.path == pstr) {\n-    e.last_access_ms = now;\n-    if let Some(f) = last_fetch_ms { e.last_fetch_ms = Some(f); }\n-  } else {\n-    let slug = repo_path\n-      .file_name()\n-      .and_then(|s| s.to_str())\n-      .unwrap_or(\"\")\n-      .to_string();\n-    idx.entries.push(CacheIndexEntry {\n-      slug,\n-      path: pstr,\n-      last_access_ms: now,\n-      last_fetch_ms,\n-    });\n-  }\n-  idx.entries.sort_by(|a, b| b.last_access_ms.cmp(&a.last_access_ms));\n-  idx.entries.dedup_by(|a, b| a.slug == b.slug);\n-  save_index(root, &idx)?;\n-  Ok(())\n+fn update_cache_index_with(\n+    root: &Path,\n+    repo_path: &Path,\n+    last_fetch_ms: Option<u128>,\n+) -> Result<()> {\n+    let mut idx = load_index(root);\n+    let pstr = repo_path.to_string_lossy().to_string();\n+    let now = now_ms();\n+    if let Some(e) = idx.entries.iter_mut().find(|e| e.path == pstr) {\n+        e.last_access_ms = now;\n+        if let Some(f) = last_fetch_ms {\n+            e.last_fetch_ms = Some(f);\n+        }\n+    } else {\n+        let slug = repo_path\n+            .file_name()\n+            .and_then(|s| s.to_str())\n+            .unwrap_or(\"\")\n+            .to_string();\n+        idx.entries.push(CacheIndexEntry {\n+            slug,\n+            path: pstr,\n+            last_access_ms: now,\n+            last_fetch_ms,\n+        });\n+    }\n+    idx.entries\n+        .sort_by(|a, b| b.last_access_ms.cmp(&a.last_access_ms));\n+    idx.entries.dedup_by(|a, b| a.slug == b.slug);\n+    save_index(root, &idx)?;\n+    Ok(())\n }\n \n-fn get_cache_last_fetch(root: &PathBuf, repo_path: &PathBuf) -> Option<u128> {\n-  let idx = load_index(root);\n-  let pstr = repo_path.to_string_lossy().to_string();\n-  idx.entries.into_iter().find(|e| e.path == pstr).and_then(|e| e.last_fetch_ms)\n+fn get_cache_last_fetch(root: &Path, repo_path: &Path) -> Option<u128> {\n+    let idx = load_index(root);\n+    let pstr = repo_path.to_string_lossy().to_string();\n+    idx.entries\n+        .into_iter()\n+        .find(|e| e.path == pstr)\n+        .and_then(|e| e.last_fetch_ms)\n }\n \n static SWR_FETCH_MAP: OnceLock<Mutex<HashMap<String, u128>>> = OnceLock::new();\n \n fn swr_map() -> &'static Mutex<HashMap<String, u128>> {\n-  SWR_FETCH_MAP.get_or_init(|| Mutex::new(HashMap::new()))\n+    SWR_FETCH_MAP.get_or_init(|| Mutex::new(HashMap::new()))\n }\n \n-fn get_map_last_fetch(repo_path: &PathBuf) -> Option<u128> {\n-  let pstr = repo_path.to_string_lossy().to_string();\n-  swr_map().lock().ok().and_then(|m| m.get(&pstr).copied())\n+fn get_map_last_fetch(repo_path: &Path) -> Option<u128> {\n+    let pstr = repo_path.to_string_lossy().to_string();\n+    swr_map().lock().ok().and_then(|m| m.get(&pstr).copied())\n }\n \n-fn set_map_last_fetch(repo_path: &PathBuf, t: u128) {\n-  let pstr = repo_path.to_string_lossy().to_string();\n-  if let Ok(mut m) = swr_map().lock() { m.insert(pstr, t); }\n+fn set_map_last_fetch(repo_path: &Path, t: u128) {\n+    let pstr = repo_path.to_string_lossy().to_string();\n+    if let Ok(mut m) = swr_map().lock() {\n+        m.insert(pstr, t);\n+    }\n }\n \n pub fn swr_fetch_origin_all_path_bool(path: &std::path::Path, window_ms: u128) -> Result<bool> {\n-  let cwd = path.to_string_lossy().to_string();\n-  let root = default_cache_root();\n-  let now = now_ms();\n+    let cwd = path.to_string_lossy().to_string();\n+    let root = default_cache_root();\n+    let now = now_ms();\n \n-  let last_fetch_idx = get_cache_last_fetch(&root, &PathBuf::from(&cwd));\n-  let last_fetch_map = get_map_last_fetch(&PathBuf::from(&cwd));\n-  let last_fetch = last_fetch_idx.or(last_fetch_map);\n+    let last_fetch_idx = get_cache_last_fetch(&root, &PathBuf::from(&cwd));\n+    let last_fetch_map = get_map_last_fetch(&PathBuf::from(&cwd));\n+    let last_fetch = last_fetch_idx.or(last_fetch_map);\n \n-  if let Some(t) = last_fetch {\n-    if now.saturating_sub(t) <= window_ms {\n-      let cwd_bg = cwd.clone();\n-      let root_bg = root.clone();\n-      std::thread::spawn(move || {\n-        let _ = run_git(&cwd_bg, &[\"fetch\", \"--all\", \"--tags\", \"--prune\"]);\n-        let _ = update_cache_index_with(&root_bg, &PathBuf::from(&cwd_bg), Some(now_ms()));\n-        set_map_last_fetch(&PathBuf::from(&cwd_bg), now_ms());\n-      });\n-      return Ok(false);\n+    if let Some(t) = last_fetch {\n+        if now.saturating_sub(t) <= window_ms {\n+            let cwd_bg = cwd.clone();\n+            let root_bg = root.clone();\n+            std::thread::spawn(move || {\n+                let _ = run_git(&cwd_bg, &[\"fetch\", \"--all\", \"--tags\", \"--prune\"]);\n+                let _ = update_cache_index_with(&root_bg, &PathBuf::from(&cwd_bg), Some(now_ms()));\n+                set_map_last_fetch(&PathBuf::from(&cwd_bg), now_ms());\n+            });\n+            return Ok(false);\n+        }\n     }\n-  }\n \n-  let _ = run_git(&cwd, &[\"fetch\", \"--all\", \"--tags\", \"--prune\"]);\n-  let now2 = now_ms();\n-  let _ = update_cache_index_with(&root, &PathBuf::from(&cwd), Some(now2));\n-  set_map_last_fetch(&PathBuf::from(&cwd), now2);\n-  Ok(true)\n+    let _ = run_git(&cwd, &[\"fetch\", \"--all\", \"--tags\", \"--prune\"]);\n+    let now2 = now_ms();\n+    let _ = update_cache_index_with(&root, &PathBuf::from(&cwd), Some(now2));\n+    set_map_last_fetch(&PathBuf::from(&cwd), now2);\n+    Ok(true)\n }\n \n pub fn swr_fetch_origin_all_path(path: &std::path::Path, window_ms: u128) -> Result<()> {\n-  let _ = swr_fetch_origin_all_path_bool(path, window_ms)?;\n-  Ok(())\n+    let _ = swr_fetch_origin_all_path_bool(path, window_ms)?;\n+    Ok(())\n }\n #[allow(dead_code)]\n pub fn fetch_origin_all_path(path: &std::path::Path) -> Result<()> {\n-  let cwd = path.to_string_lossy().to_string();\n-  let _ = run_git(&cwd, &[\"fetch\", \"--all\", \"--tags\", \"--prune\"]);\n-  Ok(())\n+    let cwd = path.to_string_lossy().to_string();\n+    let _ = run_git(&cwd, &[\"fetch\", \"--all\", \"--tags\", \"--prune\"]);\n+    Ok(())\n }\n \n-fn enforce_cache_limit(root: &PathBuf) -> Result<()> {\n-  let mut idx = load_index(root);\n-  if idx.entries.len() <= MAX_CACHE_REPOS { return Ok(()); }\n-  idx.entries.sort_by(|a, b| b.last_access_ms.cmp(&a.last_access_ms));\n-  let survivors = idx.entries[..MAX_CACHE_REPOS].to_vec();\n-  let victims = idx.entries[MAX_CACHE_REPOS..].to_vec();\n-  for v in &victims {\n-    let p = PathBuf::from(&v.path);\n-    let _ = fs::remove_dir_all(&p);\n-  }\n-  idx.entries = survivors;\n-  save_index(root, &idx)?;\n-  Ok(())\n+fn enforce_cache_limit(root: &Path) -> Result<()> {\n+    let mut idx = load_index(root);\n+    if idx.entries.len() <= MAX_CACHE_REPOS {\n+        return Ok(());\n+    }\n+    idx.entries\n+        .sort_by(|a, b| b.last_access_ms.cmp(&a.last_access_ms));\n+    let survivors = idx.entries[..MAX_CACHE_REPOS].to_vec();\n+    let victims = idx.entries[MAX_CACHE_REPOS..].to_vec();\n+    for v in &victims {\n+        let p = PathBuf::from(&v.path);\n+        let _ = fs::remove_dir_all(&p);\n+    }\n+    idx.entries = survivors;\n+    save_index(root, &idx)?;\n+    Ok(())\n }\n \n #[cfg(test)]\n mod tests {\n-  use super::*;\n-  use tempfile::tempdir;\n+    use super::*;\n+    use tempfile::tempdir;\n \n-  #[test]\n-  fn swr_fetch_skips_within_window_and_backgrounds() {\n-    let tmp = tempdir().unwrap();\n-    let repo_dir = tmp.path().join(\"repo\");\n-    std::fs::create_dir_all(&repo_dir).unwrap();\n-    let status = if cfg!(target_os = \"windows\") {\n-      std::process::Command::new(\"cmd\").arg(\"/C\").arg(\"git init\").current_dir(&repo_dir).status()\n-    } else {\n-      std::process::Command::new(\"sh\").arg(\"-c\").arg(\"git init\").current_dir(&repo_dir).status()\n-    }.expect(\"spawn\");\n-    assert!(status.success());\n+    #[test]\n+    fn swr_fetch_skips_within_window_and_backgrounds() {\n+        let tmp = tempdir().unwrap();\n+        let repo_dir = tmp.path().join(\"repo\");\n+        std::fs::create_dir_all(&repo_dir).unwrap();\n+        let status = if cfg!(target_os = \"windows\") {\n+            std::process::Command::new(\"cmd\")\n+                .arg(\"/C\")\n+                .arg(\"git init\")\n+                .current_dir(&repo_dir)\n+                .status()\n+        } else {\n+            std::process::Command::new(\"sh\")\n+                .arg(\"-c\")\n+                .arg(\"git init\")\n+                .current_dir(&repo_dir)\n+                .status()\n+        }\n+        .expect(\"spawn\");\n+        assert!(status.success());\n \n-    let first = swr_fetch_origin_all_path_bool(&repo_dir, 5_000).expect(\"swr fetch 1\");\n-    let second = swr_fetch_origin_all_path_bool(&repo_dir, 5_000).expect(\"swr fetch 2\");\n-    assert!(first, \"first call should be synchronous fetch\");\n-    assert!(!second, \"second call within window should skip and background\");\n-  }\n+        let first = swr_fetch_origin_all_path_bool(&repo_dir, 5_000).expect(\"swr fetch 1\");\n+        let second = swr_fetch_origin_all_path_bool(&repo_dir, 5_000).expect(\"swr fetch 2\");\n+        assert!(first, \"first call should be synchronous fetch\");\n+        assert!(\n+            !second,\n+            \"second call within window should skip and background\"\n+        );\n+    }\n }\ndiff --git a/apps/server/native/core/src/repo/mod.rs b/apps/server/native/core/src/repo/mod.rs\nindex d5087324f..a5c08fdb0 100644\n--- a/apps/server/native/core/src/repo/mod.rs\n+++ b/apps/server/native/core/src/repo/mod.rs\n@@ -1,2 +1 @@\n pub mod cache;\n-\ndiff --git a/apps/server/native/core/src/tests.rs b/apps/server/native/core/src/tests.rs\nindex dabecd712..f6a0587ab 100644\n--- a/apps/server/native/core/src/tests.rs\n+++ b/apps/server/native/core/src/tests.rs\n@@ -1,38 +1,50 @@\n-use std::{\n-  cell::RefCell,\n-  collections::HashMap,\n-  fs,\n-  process::Command,\n-  sync::{Mutex, OnceLock},\n+use crate::{\n+    diff::refs,\n+    repo::cache::{ensure_repo, resolve_repo_url},\n+    types::{GitDiffOptions, GitDiffWorkspaceOptions},\n+    util::run_git,\n };\n #[cfg_attr(not(feature = \"fuzz-tests\"), allow(unused_imports))]\n use rayon::{prelude::*, ThreadPoolBuilder};\n-use tempfile::{tempdir, TempDir};\n-use std::path::{Path, PathBuf};\n use serde::Deserialize;\n-use crate::{\n-  diff::refs,\n-  repo::cache::{ensure_repo, resolve_repo_url},\n-  types::{GitDiffOptions, GitDiffWorkspaceOptions},\n-  util::run_git,\n+use std::path::{Path, PathBuf};\n+use std::{\n+    cell::RefCell,\n+    collections::HashMap,\n+    fs,\n+    process::Command,\n+    sync::{Mutex, OnceLock},\n };\n+use tempfile::{tempdir, TempDir};\n \n fn run(cwd: &std::path::Path, cmd: &str) {\n-  let status = if cfg!(target_os = \"windows\") {\n-    Command::new(\"cmd\").arg(\"/C\").arg(cmd).current_dir(cwd).status()\n-  } else {\n-    Command::new(\"sh\").arg(\"-c\").arg(cmd).current_dir(cwd).status()\n-  }\n-  .expect(\"spawn\");\n-  assert!(status.success(), \"command failed: {cmd}\");\n+    let status = if cfg!(target_os = \"windows\") {\n+        Command::new(\"cmd\")\n+            .arg(\"/C\")\n+            .arg(cmd)\n+            .current_dir(cwd)\n+            .status()\n+    } else {\n+        Command::new(\"sh\")\n+            .arg(\"-c\")\n+            .arg(cmd)\n+            .current_dir(cwd)\n+            .status()\n+    }\n+    .expect(\"spawn\");\n+    assert!(status.success(), \"command failed: {cmd}\");\n }\n \n fn find_git_root(mut p: PathBuf) -> PathBuf {\n-  loop {\n-    if p.join(\".git\").exists() { return p; }\n-    if !p.pop() { break; }\n-  }\n-  panic!(\".git not found from test cwd\");\n+    loop {\n+        if p.join(\".git\").exists() {\n+            return p;\n+        }\n+        if !p.pop() {\n+            break;\n+        }\n+    }\n+    panic!(\".git not found from test cwd\");\n }\n \n #[cfg_attr(not(feature = \"fuzz-tests\"), allow(dead_code))]\n@@ -41,36 +53,36 @@ const LARGE_MAX_BYTES: i32 = 64 * 1024 * 1024;\n #[derive(Debug, Deserialize)]\n #[serde(rename_all = \"camelCase\")]\n struct GroundTruthFile {\n-  #[allow(dead_code)]\n-  generated_at: String,\n-  repos: HashMap<String, Vec<PullRequestRecord>>,\n+    #[allow(dead_code)]\n+    generated_at: String,\n+    repos: HashMap<String, Vec<PullRequestRecord>>,\n }\n \n #[derive(Debug, Deserialize)]\n #[serde(rename_all = \"camelCase\")]\n #[cfg_attr(not(feature = \"fuzz-tests\"), allow(dead_code))]\n struct PullRequestRecord {\n-  repo: String,\n-  number: u64,\n-  #[allow(dead_code)]\n-  is_merged: bool,\n-  merge_commit_sha: Option<String>,\n-  last_commit_sha: String,\n-  #[allow(dead_code)]\n-  base_sha: String,\n-  additions: i64,\n-  deletions: i64,\n-  changed_files: i64,\n+    repo: String,\n+    number: u64,\n+    #[allow(dead_code)]\n+    is_merged: bool,\n+    merge_commit_sha: Option<String>,\n+    last_commit_sha: String,\n+    #[allow(dead_code)]\n+    base_sha: String,\n+    additions: i64,\n+    deletions: i64,\n+    changed_files: i64,\n }\n \n #[derive(Clone, Debug)]\n #[cfg_attr(not(feature = \"fuzz-tests\"), allow(dead_code))]\n struct CachedDiff {\n-  additions: i64,\n-  deletions: i64,\n-  changed_files: usize,\n-  debug: refs::DiffComputationDebug,\n-  base_repo_path: PathBuf,\n+    additions: i64,\n+    deletions: i64,\n+    changed_files: usize,\n+    debug: refs::DiffComputationDebug,\n+    base_repo_path: PathBuf,\n }\n \n static GROUND_TRUTH: OnceLock<GroundTruthFile> = OnceLock::new();\n@@ -79,9 +91,9 @@ static PULL_FETCH_CACHE: OnceLock<Mutex<HashMap<String, bool>>> = OnceLock::new(\n static DIFF_CACHE: OnceLock<Mutex<HashMap<String, CachedDiff>>> = OnceLock::new();\n \n struct ThreadRepoClone {\n-  _tempdir: TempDir,\n-  path: PathBuf,\n-  source: PathBuf,\n+    _tempdir: TempDir,\n+    path: PathBuf,\n+    source: PathBuf,\n }\n \n thread_local! {\n@@ -89,271 +101,315 @@ thread_local! {\n }\n \n fn ground_truth() -> &'static GroundTruthFile {\n-  GROUND_TRUTH.get_or_init(|| {\n-    let manifest_dir = PathBuf::from(env!(\"CARGO_MANIFEST_DIR\"));\n-    let repo_root = find_git_root(manifest_dir);\n-    let path = match std::env::var(\"PR_GROUND_TRUTH_PATH\") {\n-      Ok(value) => {\n-        let override_path = PathBuf::from(value);\n-        if override_path.is_absolute() {\n-          override_path\n-        } else {\n-          repo_root.join(override_path)\n-        }\n-      }\n-      Err(_) => repo_root.join(\"data/github/pr-ground-truth.json\"),\n-    };\n-    let json = fs::read_to_string(&path)\n-      .unwrap_or_else(|err| panic!(\"failed to read ground truth file {}: {err}\", path.display()));\n-    serde_json::from_str(&json)\n-      .unwrap_or_else(|err| panic!(\"failed to parse ground truth file {}: {err}\", path.display()))\n-  })\n+    GROUND_TRUTH.get_or_init(|| {\n+        let manifest_dir = PathBuf::from(env!(\"CARGO_MANIFEST_DIR\"));\n+        let repo_root = find_git_root(manifest_dir);\n+        let path = match std::env::var(\"PR_GROUND_TRUTH_PATH\") {\n+            Ok(value) => {\n+                let override_path = PathBuf::from(value);\n+                if override_path.is_absolute() {\n+                    override_path\n+                } else {\n+                    repo_root.join(override_path)\n+                }\n+            }\n+            Err(_) => repo_root.join(\"data/github/pr-ground-truth.json\"),\n+        };\n+        let json = fs::read_to_string(&path).unwrap_or_else(|err| {\n+            panic!(\"failed to read ground truth file {}: {err}\", path.display())\n+        });\n+        serde_json::from_str(&json).unwrap_or_else(|err| {\n+            panic!(\n+                \"failed to parse ground truth file {}: {err}\",\n+                path.display()\n+            )\n+        })\n+    })\n }\n \n fn ensure_repo_with_pull_refs(repo_slug: &str) -> PathBuf {\n-  let url = resolve_repo_url(Some(repo_slug), None).expect(\"resolve repo url\");\n-  let repo_path = ensure_repo(&url).expect(\"ensure repo path\");\n-  let repo_path_str = repo_path.to_string_lossy().to_string();\n-\n-  let cache = PULL_FETCH_CACHE.get_or_init(|| Mutex::new(HashMap::new()));\n-  let already_fetched = {\n-    let map = cache.lock().expect(\"pull fetch cache lock\");\n-    map.get(repo_slug).copied().unwrap_or(false)\n-  };\n-\n-  if !already_fetched {\n-    run_git(&repo_path_str, &[\"fetch\", \"origin\", \"+refs/pull/*/head:refs/cmux-tests/pull/*\"])\n-      .unwrap_or_else(|err| panic!(\"failed to fetch pull refs for {repo_slug}: {err}\"));\n-    let mut map = cache.lock().expect(\"pull fetch cache lock\");\n-    map.insert(repo_slug.to_string(), true);\n-  }\n-\n-  repo_path\n+    let url = resolve_repo_url(Some(repo_slug), None).expect(\"resolve repo url\");\n+    let repo_path = ensure_repo(&url).expect(\"ensure repo path\");\n+    let repo_path_str = repo_path.to_string_lossy().to_string();\n+\n+    let cache = PULL_FETCH_CACHE.get_or_init(|| Mutex::new(HashMap::new()));\n+    let already_fetched = {\n+        let map = cache.lock().expect(\"pull fetch cache lock\");\n+        map.get(repo_slug).copied().unwrap_or(false)\n+    };\n+\n+    if !already_fetched {\n+        run_git(\n+            &repo_path_str,\n+            &[\n+                \"fetch\",\n+                \"origin\",\n+                \"+refs/pull/*/head:refs/cmux-tests/pull/*\",\n+            ],\n+        )\n+        .unwrap_or_else(|err| panic!(\"failed to fetch pull refs for {repo_slug}: {err}\"));\n+        let mut map = cache.lock().expect(\"pull fetch cache lock\");\n+        map.insert(repo_slug.to_string(), true);\n+    }\n+\n+    repo_path\n }\n \n fn canonicalize_path(path: &Path) -> PathBuf {\n-  path.canonicalize().unwrap_or_else(|_| path.to_path_buf())\n+    path.canonicalize().unwrap_or_else(|_| path.to_path_buf())\n }\n \n fn create_thread_repo_clone(repo_slug: &str, base_repo: &Path) -> ThreadRepoClone {\n-  let tempdir = tempfile::tempdir().expect(\"create tempdir for repo clone\");\n-  let clone_path = tempdir.path().join(\"repo\");\n-  let cwd = tempdir.path().to_string_lossy().to_string();\n-  let base = base_repo.to_string_lossy().to_string();\n-  let dest = clone_path.to_string_lossy().to_string();\n-  run_git(&cwd, &[\"clone\", \"--local\", \"--no-hardlinks\", &base, &dest])\n-    .unwrap_or_else(|err| panic!(\"failed to clone local repo for {repo_slug}: {err}\"));\n-  ThreadRepoClone { _tempdir: tempdir, path: clone_path, source: canonicalize_path(base_repo) }\n+    let tempdir = tempfile::tempdir().expect(\"create tempdir for repo clone\");\n+    let clone_path = tempdir.path().join(\"repo\");\n+    let cwd = tempdir.path().to_string_lossy().to_string();\n+    let base = base_repo.to_string_lossy().to_string();\n+    let dest = clone_path.to_string_lossy().to_string();\n+    run_git(&cwd, &[\"clone\", \"--local\", \"--no-hardlinks\", &base, &dest])\n+        .unwrap_or_else(|err| panic!(\"failed to clone local repo for {repo_slug}: {err}\"));\n+    ThreadRepoClone {\n+        _tempdir: tempdir,\n+        path: clone_path,\n+        source: canonicalize_path(base_repo),\n+    }\n }\n \n fn repo_clone_for_thread(repo_slug: &str, base_repo: &Path) -> PathBuf {\n-  let base_canon = canonicalize_path(base_repo);\n-  THREAD_REPO_CLONES.with(|cell| {\n-    let mut map = cell.borrow_mut();\n-    let needs_new = match map.get(repo_slug) {\n-      Some(existing) => existing.source != base_canon,\n-      None => true,\n-    };\n-    if needs_new {\n-      map.insert(repo_slug.to_string(), create_thread_repo_clone(repo_slug, &base_canon));\n-    }\n-    map.get(repo_slug).unwrap().path.clone()\n-  })\n+    let base_canon = canonicalize_path(base_repo);\n+    THREAD_REPO_CLONES.with(|cell| {\n+        let mut map = cell.borrow_mut();\n+        let needs_new = match map.get(repo_slug) {\n+            Some(existing) => existing.source != base_canon,\n+            None => true,\n+        };\n+        if needs_new {\n+            map.insert(\n+                repo_slug.to_string(),\n+                create_thread_repo_clone(repo_slug, &base_canon),\n+            );\n+        }\n+        map.get(repo_slug).unwrap().path.clone()\n+    })\n }\n \n #[cfg_attr(not(feature = \"fuzz-tests\"), allow(dead_code))]\n fn reset_thread_repo_clone(repo_slug: &str) {\n-  THREAD_REPO_CLONES.with(|cell| {\n-    cell.borrow_mut().remove(repo_slug);\n-  });\n+    THREAD_REPO_CLONES.with(|cell| {\n+        cell.borrow_mut().remove(repo_slug);\n+    });\n }\n \n fn compute_diff_for_pr(pr: &PullRequestRecord) -> CachedDiff {\n-  let cache_key = format!(\"{}#{}\", pr.repo, pr.number);\n-  let cache = DIFF_CACHE.get_or_init(|| Mutex::new(HashMap::new()));\n-  if let Some(entry) = cache.lock().expect(\"diff cache lock\").get(&cache_key).cloned() {\n-    return entry;\n-  }\n-\n-  let base_repo_path = canonicalize_path(&ensure_repo_with_pull_refs(&pr.repo));\n-  let repo_clone = repo_clone_for_thread(&pr.repo, &base_repo_path);\n-  let repo_path_str = repo_clone.to_string_lossy().to_string();\n-  let diff = crate::diff::refs::diff_refs(GitDiffOptions {\n-    headRef: pr.last_commit_sha.clone(),\n-    baseRef: None,\n-    repoFullName: Some(pr.repo.clone()),\n-    repoUrl: None,\n-    teamSlugOrId: None,\n-    originPathOverride: Some(repo_path_str.clone()),\n-    includeContents: Some(true),\n-    maxBytes: Some(LARGE_MAX_BYTES),\n-    lastKnownBaseSha: None,\n-    lastKnownMergeCommitSha: None,\n-  })\n-  .unwrap_or_else(|err| panic!(\"diff_refs failed for {}#{}: {err}\", pr.repo, pr.number));\n-\n-  let debug = refs::last_diff_debug()\n-    .unwrap_or_else(|| panic!(\"missing diff debug for {}#{}\", pr.repo, pr.number));\n-\n-  let additions: i64 = diff.iter().map(|entry| entry.additions as i64).sum();\n-  let deletions: i64 = diff.iter().map(|entry| entry.deletions as i64).sum();\n-  let changed_files = diff.len();\n-\n-  let cached = CachedDiff { additions, deletions, changed_files, debug, base_repo_path: base_repo_path.clone() };\n-  cache\n-    .lock()\n-    .expect(\"diff cache lock\")\n-    .insert(cache_key, cached.clone());\n-  cached\n+    let cache_key = format!(\"{}#{}\", pr.repo, pr.number);\n+    let cache = DIFF_CACHE.get_or_init(|| Mutex::new(HashMap::new()));\n+    if let Some(entry) = cache\n+        .lock()\n+        .expect(\"diff cache lock\")\n+        .get(&cache_key)\n+        .cloned()\n+    {\n+        return entry;\n+    }\n+\n+    let base_repo_path = canonicalize_path(&ensure_repo_with_pull_refs(&pr.repo));\n+    let repo_clone = repo_clone_for_thread(&pr.repo, &base_repo_path);\n+    let repo_path_str = repo_clone.to_string_lossy().to_string();\n+    let diff = crate::diff::refs::diff_refs(GitDiffOptions {\n+        headRef: pr.last_commit_sha.clone(),\n+        baseRef: None,\n+        repoFullName: Some(pr.repo.clone()),\n+        repoUrl: None,\n+        teamSlugOrId: None,\n+        originPathOverride: Some(repo_path_str.clone()),\n+        includeContents: Some(true),\n+        maxBytes: Some(LARGE_MAX_BYTES),\n+        lastKnownBaseSha: None,\n+        lastKnownMergeCommitSha: None,\n+    })\n+    .unwrap_or_else(|err| panic!(\"diff_refs failed for {}#{}: {err}\", pr.repo, pr.number));\n+\n+    let debug = refs::last_diff_debug()\n+        .unwrap_or_else(|| panic!(\"missing diff debug for {}#{}\", pr.repo, pr.number));\n+\n+    let additions: i64 = diff.iter().map(|entry| entry.additions as i64).sum();\n+    let deletions: i64 = diff.iter().map(|entry| entry.deletions as i64).sum();\n+    let changed_files = diff.len();\n+\n+    let cached = CachedDiff {\n+        additions,\n+        deletions,\n+        changed_files,\n+        debug,\n+        base_repo_path: base_repo_path.clone(),\n+    };\n+    cache\n+        .lock()\n+        .expect(\"diff cache lock\")\n+        .insert(cache_key, cached.clone());\n+    cached\n }\n \n fn commit_parents(repo_path: &Path, commit: &str) -> Option<Vec<String>> {\n-  let repo_str = repo_path.to_string_lossy().to_string();\n-  match run_git(&repo_str, &[\"rev-list\", \"--parents\", \"-n\", \"1\", commit]) {\n-    Ok(output) => Some(\n-      output\n-        .split_whitespace()\n-        .skip(1)\n-        .map(|s| s.to_string())\n-        .collect(),\n-    ),\n-    Err(err) => {\n-      eprintln!(\"commit {} not found in {}: {}\", commit, repo_str, err);\n-      None\n+    let repo_str = repo_path.to_string_lossy().to_string();\n+    match run_git(&repo_str, &[\"rev-list\", \"--parents\", \"-n\", \"1\", commit]) {\n+        Ok(output) => Some(\n+            output\n+                .split_whitespace()\n+                .skip(1)\n+                .map(|s| s.to_string())\n+                .collect(),\n+        ),\n+        Err(err) => {\n+            eprintln!(\"commit {} not found in {}: {}\", commit, repo_str, err);\n+            None\n+        }\n     }\n-  }\n }\n \n fn ensure_merge_commit(base_repo: &Path, pr_number: u64, merge_sha: &str) -> bool {\n-  let repo_str = base_repo.to_string_lossy().to_string();\n-  if run_git(&repo_str, &[\"cat-file\", \"-e\", &format!(\"{merge_sha}^{{commit}}\")]).is_ok() {\n-    return true;\n-  }\n-  if run_git(&repo_str, &[\"fetch\", \"origin\", merge_sha]).is_ok() {\n-    if run_git(&repo_str, &[\"cat-file\", \"-e\", &format!(\"{merge_sha}^{{commit}}\")]).is_ok() {\n-      return true;\n+    let repo_str = base_repo.to_string_lossy().to_string();\n+    if run_git(\n+        &repo_str,\n+        &[\"cat-file\", \"-e\", &format!(\"{merge_sha}^{{commit}}\")],\n+    )\n+    .is_ok()\n+    {\n+        return true;\n+    }\n+    if run_git(&repo_str, &[\"fetch\", \"origin\", merge_sha]).is_ok()\n+        && run_git(\n+            &repo_str,\n+            &[\"cat-file\", \"-e\", &format!(\"{merge_sha}^{{commit}}\")],\n+        )\n+        .is_ok()\n+    {\n+        return true;\n     }\n-  }\n-  let merge_spec = format!(\"refs/pull/{}/merge:refs/cmux-tests/merge/{}\", pr_number, pr_number);\n-  run_git(&repo_str, &[\"fetch\", \"origin\", &merge_spec]).is_ok()\n+    let merge_spec = format!(\n+        \"refs/pull/{}/merge:refs/cmux-tests/merge/{}\",\n+        pr_number, pr_number\n+    );\n+    run_git(&repo_str, &[\"fetch\", \"origin\", &merge_spec]).is_ok()\n }\n \n #[cfg_attr(not(feature = \"fuzz-tests\"), allow(dead_code))]\n #[derive(Default, Clone, Debug)]\n struct MergeStats {\n-  total_with_merge: usize,\n-  matches: usize,\n-  fallback_matches: usize,\n-  matches_second_parent: usize,\n-  compare_equal_head: usize,\n-  mismatches: usize,\n-  single_parent: usize,\n-  missing_commits: usize,\n-  missing_after_fetch: usize,\n-  fetch_attempts: usize,\n-  fetch_success: usize,\n-  fallback_used: usize,\n-  no_merge_commit: usize,\n-  unmatched_with_merge_oid: usize,\n+    total_with_merge: usize,\n+    matches: usize,\n+    fallback_matches: usize,\n+    matches_second_parent: usize,\n+    compare_equal_head: usize,\n+    mismatches: usize,\n+    single_parent: usize,\n+    missing_commits: usize,\n+    missing_after_fetch: usize,\n+    fetch_attempts: usize,\n+    fetch_success: usize,\n+    fallback_used: usize,\n+    no_merge_commit: usize,\n+    unmatched_with_merge_oid: usize,\n }\n \n #[cfg_attr(not(feature = \"fuzz-tests\"), allow(dead_code))]\n impl MergeStats {\n-  fn accumulate(&mut self, other: &MergeStats) {\n-    self.total_with_merge += other.total_with_merge;\n-    self.matches += other.matches;\n-    self.fallback_matches += other.fallback_matches;\n-    self.matches_second_parent += other.matches_second_parent;\n-    self.compare_equal_head += other.compare_equal_head;\n-    self.mismatches += other.mismatches;\n-    self.single_parent += other.single_parent;\n-    self.missing_commits += other.missing_commits;\n-    self.missing_after_fetch += other.missing_after_fetch;\n-    self.fetch_attempts += other.fetch_attempts;\n-    self.fetch_success += other.fetch_success;\n-    self.fallback_used += other.fallback_used;\n-    self.no_merge_commit += other.no_merge_commit;\n-    self.unmatched_with_merge_oid += other.unmatched_with_merge_oid;\n-  }\n+    fn accumulate(&mut self, other: &MergeStats) {\n+        self.total_with_merge += other.total_with_merge;\n+        self.matches += other.matches;\n+        self.fallback_matches += other.fallback_matches;\n+        self.matches_second_parent += other.matches_second_parent;\n+        self.compare_equal_head += other.compare_equal_head;\n+        self.mismatches += other.mismatches;\n+        self.single_parent += other.single_parent;\n+        self.missing_commits += other.missing_commits;\n+        self.missing_after_fetch += other.missing_after_fetch;\n+        self.fetch_attempts += other.fetch_attempts;\n+        self.fetch_success += other.fetch_success;\n+        self.fallback_used += other.fallback_used;\n+        self.no_merge_commit += other.no_merge_commit;\n+        self.unmatched_with_merge_oid += other.unmatched_with_merge_oid;\n+    }\n }\n \n #[cfg_attr(not(feature = \"fuzz-tests\"), allow(dead_code))]\n #[derive(Clone, Debug)]\n struct MergeMismatch {\n-  repo: String,\n-  number: u64,\n-  compare_base: String,\n-  base_parent: String,\n-  head_parent: String,\n-  merge_commit: Option<String>,\n-  reason: &'static str,\n+    repo: String,\n+    number: u64,\n+    compare_base: String,\n+    base_parent: String,\n+    head_parent: String,\n+    merge_commit: Option<String>,\n+    reason: &'static str,\n }\n \n #[cfg_attr(not(feature = \"fuzz-tests\"), allow(dead_code))]\n fn evaluate_merge_pr(pr: &PullRequestRecord) -> (MergeStats, Option<MergeMismatch>) {\n-  let mut stats = MergeStats::default();\n-  if pr.merge_commit_sha.is_none() {\n-    stats.no_merge_commit = 1;\n-    // Warm the diff cache for subsequent tests\n-    let _ = compute_diff_for_pr(pr);\n-    return (stats, None);\n-  }\n-\n-  let merge_sha = pr.merge_commit_sha.as_ref().unwrap();\n-  let cached = compute_diff_for_pr(pr);\n-  stats.total_with_merge = 1;\n-  if cached.debug.merge_commit_oid.is_some() {\n-    stats.fallback_used = 1;\n-  }\n-\n-  let compare_oid = cached.debug.compare_base_oid.clone();\n-  let head_oid = cached.debug.head_oid.clone();\n-  let clone_path = PathBuf::from(&cached.debug.repo_path);\n-  let base_path = cached.base_repo_path.clone();\n-\n-  let mut parents = commit_parents(&clone_path, merge_sha)\n-    .or_else(|| commit_parents(&base_path, merge_sha));\n-  let mut fetch_attempted = false;\n-  if parents.is_none() {\n-    fetch_attempted = true;\n-    stats.fetch_attempts = 1;\n-    if ensure_merge_commit(&base_path, pr.number, merge_sha) {\n-      stats.fetch_success = 1;\n-      reset_thread_repo_clone(&pr.repo);\n-      parents = commit_parents(&base_path, merge_sha);\n+    let mut stats = MergeStats::default();\n+    if pr.merge_commit_sha.is_none() {\n+        stats.no_merge_commit = 1;\n+        // Warm the diff cache for subsequent tests\n+        let _ = compute_diff_for_pr(pr);\n+        return (stats, None);\n     }\n-  }\n-\n-  match parents {\n-    None => {\n-      stats.missing_commits = 1;\n-      if fetch_attempted { stats.missing_after_fetch = 1; }\n-      (\n-        stats,\n-        Some(MergeMismatch {\n-          repo: pr.repo.clone(),\n-          number: pr.number,\n-          compare_base: compare_oid,\n-          base_parent: String::new(),\n-          head_parent: String::new(),\n-          merge_commit: Some(merge_sha.clone()),\n-          reason: \"missing merge commit\",\n-        }),\n-      )\n+\n+    let merge_sha = pr.merge_commit_sha.as_ref().unwrap();\n+    let cached = compute_diff_for_pr(pr);\n+    stats.total_with_merge = 1;\n+    if cached.debug.merge_commit_oid.is_some() {\n+        stats.fallback_used = 1;\n     }\n-    Some(list) => {\n-      if list.len() < 2 {\n-        stats.single_parent = 1;\n-        return (stats, None);\n-      }\n-      let base_parent = &list[0];\n-      let head_parent = &list[1];\n-      if *base_parent == compare_oid {\n-        stats.matches = 1;\n-        if cached.debug.merge_commit_oid.is_some() {\n-          stats.fallback_matches = 1;\n+\n+    let compare_oid = cached.debug.compare_base_oid.clone();\n+    let head_oid = cached.debug.head_oid.clone();\n+    let clone_path = PathBuf::from(&cached.debug.repo_path);\n+    let base_path = cached.base_repo_path.clone();\n+\n+    let mut parents =\n+        commit_parents(&clone_path, merge_sha).or_else(|| commit_parents(&base_path, merge_sha));\n+    let mut fetch_attempted = false;\n+    if parents.is_none() {\n+        fetch_attempted = true;\n+        stats.fetch_attempts = 1;\n+        if ensure_merge_commit(&base_path, pr.number, merge_sha) {\n+            stats.fetch_success = 1;\n+            reset_thread_repo_clone(&pr.repo);\n+            parents = commit_parents(&base_path, merge_sha);\n         }\n-        println!(\n+    }\n+\n+    match parents {\n+        None => {\n+            stats.missing_commits = 1;\n+            if fetch_attempted {\n+                stats.missing_after_fetch = 1;\n+            }\n+            (\n+                stats,\n+                Some(MergeMismatch {\n+                    repo: pr.repo.clone(),\n+                    number: pr.number,\n+                    compare_base: compare_oid,\n+                    base_parent: String::new(),\n+                    head_parent: String::new(),\n+                    merge_commit: Some(merge_sha.clone()),\n+                    reason: \"missing merge commit\",\n+                }),\n+            )\n+        }\n+        Some(list) => {\n+            if list.len() < 2 {\n+                stats.single_parent = 1;\n+                return (stats, None);\n+            }\n+            let base_parent = &list[0];\n+            let head_parent = &list[1];\n+            if *base_parent == compare_oid {\n+                stats.matches = 1;\n+                if cached.debug.merge_commit_oid.is_some() {\n+                    stats.fallback_matches = 1;\n+                }\n+                println!(\n           \"[evaluate] match {}#{} compare={} base_parent={} head_parent={} merge_commit={:?}\",\n           pr.repo,\n           pr.number,\n@@ -362,339 +418,465 @@ fn evaluate_merge_pr(pr: &PullRequestRecord) -> (MergeStats, Option<MergeMismatc\n           head_parent,\n           pr.merge_commit_sha,\n         );\n-        (stats, None)\n-      } else if *head_parent == compare_oid {\n-        stats.matches_second_parent = 1;\n-        (stats, None)\n-      } else if head_oid == compare_oid {\n-        stats.compare_equal_head = 1;\n-        stats.mismatches = 1;\n-        (\n-          stats,\n-          Some(MergeMismatch {\n-            repo: pr.repo.clone(),\n-            number: pr.number,\n-            compare_base: compare_oid,\n-            base_parent: base_parent.clone(),\n-            head_parent: head_parent.clone(),\n-            merge_commit: Some(merge_sha.clone()),\n-            reason: \"compare equals head\",\n-          }),\n-        )\n-      } else {\n-        stats.mismatches = 1;\n-        if cached.debug.merge_commit_oid.is_some() {\n-          stats.unmatched_with_merge_oid = 1;\n+                (stats, None)\n+            } else if *head_parent == compare_oid {\n+                stats.matches_second_parent = 1;\n+                (stats, None)\n+            } else if head_oid == compare_oid {\n+                stats.compare_equal_head = 1;\n+                stats.mismatches = 1;\n+                (\n+                    stats,\n+                    Some(MergeMismatch {\n+                        repo: pr.repo.clone(),\n+                        number: pr.number,\n+                        compare_base: compare_oid,\n+                        base_parent: base_parent.clone(),\n+                        head_parent: head_parent.clone(),\n+                        merge_commit: Some(merge_sha.clone()),\n+                        reason: \"compare equals head\",\n+                    }),\n+                )\n+            } else {\n+                stats.mismatches = 1;\n+                if cached.debug.merge_commit_oid.is_some() {\n+                    stats.unmatched_with_merge_oid = 1;\n+                }\n+                (\n+                    stats,\n+                    Some(MergeMismatch {\n+                        repo: pr.repo.clone(),\n+                        number: pr.number,\n+                        compare_base: compare_oid,\n+                        base_parent: base_parent.clone(),\n+                        head_parent: head_parent.clone(),\n+                        merge_commit: pr.merge_commit_sha.clone(),\n+                        reason: \"compare differs from merge first parent\",\n+                    }),\n+                )\n+            }\n         }\n-        (\n-          stats,\n-          Some(MergeMismatch {\n-            repo: pr.repo.clone(),\n-            number: pr.number,\n-            compare_base: compare_oid,\n-            base_parent: base_parent.clone(),\n-            head_parent: head_parent.clone(),\n-            merge_commit: pr.merge_commit_sha.clone(),\n-            reason: \"compare differs from merge first parent\",\n-          }),\n-        )\n-      }\n     }\n-  }\n }\n \n #[test]\n fn workspace_diff_basic() {\n-  let tmp = tempdir().unwrap();\n-  let work = tmp.path().join(\"work\");\n-  fs::create_dir_all(&work).unwrap();\n-  run(&work, \"git init\");\n-  run(&work, \"git -c user.email=a@b -c user.name=test checkout -b main\");\n-  fs::write(work.join(\"a.txt\"), b\"a1\\n\").unwrap();\n-  run(&work, \"git add .\");\n-  run(&work, \"git -c user.email=a@b -c user.name=test commit -m init\");\n-\n-  fs::write(work.join(\"a.txt\"), b\"a1\\na2\\n\").unwrap();\n-  fs::create_dir_all(work.join(\"src\")).unwrap();\n-  fs::write(work.join(\"src/new.txt\"), b\"x\\ny\\n\").unwrap();\n-\n-  let out = crate::diff::workspace::diff_workspace(GitDiffWorkspaceOptions{\n-    worktreePath: work.to_string_lossy().to_string(),\n-    includeContents: Some(true),\n-    maxBytes: Some(1024*1024),\n-  }).unwrap();\n-\n-  let mut has_a = false;\n-  let mut has_new = false;\n-  for e in &out {\n-    if e.filePath == \"a.txt\" { has_a = true; }\n-    if e.filePath == \"src/new.txt\" { has_new = true; }\n-  }\n-  assert!(has_a && has_new, \"expected modified and untracked files\");\n+    let tmp = tempdir().unwrap();\n+    let work = tmp.path().join(\"work\");\n+    fs::create_dir_all(&work).unwrap();\n+    run(&work, \"git init\");\n+    run(\n+        &work,\n+        \"git -c user.email=a@b -c user.name=test checkout -b main\",\n+    );\n+    fs::write(work.join(\"a.txt\"), b\"a1\\n\").unwrap();\n+    run(&work, \"git add .\");\n+    run(\n+        &work,\n+        \"git -c user.email=a@b -c user.name=test commit -m init\",\n+    );\n+\n+    fs::write(work.join(\"a.txt\"), b\"a1\\na2\\n\").unwrap();\n+    fs::create_dir_all(work.join(\"src\")).unwrap();\n+    fs::write(work.join(\"src/new.txt\"), b\"x\\ny\\n\").unwrap();\n+\n+    let out = crate::diff::workspace::diff_workspace(GitDiffWorkspaceOptions {\n+        worktreePath: work.to_string_lossy().to_string(),\n+        includeContents: Some(true),\n+        maxBytes: Some(1024 * 1024),\n+    })\n+    .unwrap();\n+\n+    let mut has_a = false;\n+    let mut has_new = false;\n+    for e in &out {\n+        if e.filePath == \"a.txt\" {\n+            has_a = true;\n+        }\n+        if e.filePath == \"src/new.txt\" {\n+            has_new = true;\n+        }\n+    }\n+    assert!(has_a && has_new, \"expected modified and untracked files\");\n }\n \n #[test]\n fn workspace_diff_unborn_head_uses_remote_default() {\n-  let tmp = tempdir().unwrap();\n-  let root = tmp.path();\n-\n-  // Create bare origin with a main branch and one file\n-  let origin_path = root.join(\"origin.git\");\n-  fs::create_dir_all(&origin_path).unwrap();\n-  run(&root, &format!(\"git init --bare {}\", origin_path.file_name().unwrap().to_str().unwrap()));\n-\n-  // Seed repo to populate origin/main\n-  let seed = root.join(\"seed\");\n-  fs::create_dir_all(&seed).unwrap();\n-  run(&seed, \"git init\");\n-  run(&seed, \"git -c user.email=a@b -c user.name=test checkout -b main\");\n-  fs::write(seed.join(\"a.txt\"), b\"one\\n\").unwrap();\n-  run(&seed, \"git add .\");\n-  run(&seed, \"git -c user.email=a@b -c user.name=test commit -m init\");\n-\n-  // Point origin HEAD to main and push\n-  let origin_url = origin_path.to_string_lossy().to_string();\n-  run(&seed, &format!(\"git remote add origin {}\", origin_url));\n-  // Ensure origin default branch is main\n-  run(&origin_path, \"git symbolic-ref HEAD refs/heads/main\");\n-  run(&seed, \"git push -u origin main\");\n-\n-  // Create work repo with unborn HEAD, add remote, fetch only\n-  let work = root.join(\"work\");\n-  fs::create_dir_all(&work).unwrap();\n-  run(&work, \"git init\");\n-  run(&work, &format!(\"git remote add origin {}\", origin_url));\n-  run(&work, \"git fetch origin\");\n-\n-  // Modify file relative to remote default without any local commit\n-  fs::write(work.join(\"a.txt\"), b\"one\\ntwo\\n\").unwrap();\n-\n-  let out = crate::diff::workspace::diff_workspace(GitDiffWorkspaceOptions{\n-    worktreePath: work.to_string_lossy().to_string(),\n-    includeContents: Some(true),\n-    maxBytes: Some(1024*1024),\n-  }).expect(\"diff workspace unborn\");\n-\n-  // Expect a diff against remote default: a.txt should be modified\n-  if !out.iter().any(|e| e.filePath == \"a.txt\") {\n-    eprintln!(\"entries: {:?}\", out.iter().map(|e| format!(\"{}:{}\", e.status, e.filePath)).collect::<Vec<_>>());\n-  }\n-  let row = out.iter().find(|e| e.filePath == \"a.txt\").expect(\"has a.txt\");\n-  assert_eq!(row.status, \"modified\");\n-  assert_eq!(row.contentOmitted, Some(false));\n-  assert!(row.oldContent.as_deref() == Some(\"one\\n\"));\n-  assert!(row.newContent.as_deref() == Some(\"one\\ntwo\\n\"));\n-  assert!(row.additions >= 1);\n+    let tmp = tempdir().unwrap();\n+    let root = tmp.path();\n+\n+    // Create bare origin with a main branch and one file\n+    let origin_path = root.join(\"origin.git\");\n+    fs::create_dir_all(&origin_path).unwrap();\n+    run(\n+        root,\n+        &format!(\n+            \"git init --bare {}\",\n+            origin_path.file_name().unwrap().to_str().unwrap()\n+        ),\n+    );\n+\n+    // Seed repo to populate origin/main\n+    let seed = root.join(\"seed\");\n+    fs::create_dir_all(&seed).unwrap();\n+    run(&seed, \"git init\");\n+    run(\n+        &seed,\n+        \"git -c user.email=a@b -c user.name=test checkout -b main\",\n+    );\n+    fs::write(seed.join(\"a.txt\"), b\"one\\n\").unwrap();\n+    run(&seed, \"git add .\");\n+    run(\n+        &seed,\n+        \"git -c user.email=a@b -c user.name=test commit -m init\",\n+    );\n+\n+    // Point origin HEAD to main and push\n+    let origin_url = origin_path.to_string_lossy().to_string();\n+    run(&seed, &format!(\"git remote add origin {}\", origin_url));\n+    // Ensure origin default branch is main\n+    run(&origin_path, \"git symbolic-ref HEAD refs/heads/main\");\n+    run(&seed, \"git push -u origin main\");\n+\n+    // Create work repo with unborn HEAD, add remote, fetch only\n+    let work = root.join(\"work\");\n+    fs::create_dir_all(&work).unwrap();\n+    run(&work, \"git init\");\n+    run(&work, &format!(\"git remote add origin {}\", origin_url));\n+    run(&work, \"git fetch origin\");\n+\n+    // Modify file relative to remote default without any local commit\n+    fs::write(work.join(\"a.txt\"), b\"one\\ntwo\\n\").unwrap();\n+\n+    let out = crate::diff::workspace::diff_workspace(GitDiffWorkspaceOptions {\n+        worktreePath: work.to_string_lossy().to_string(),\n+        includeContents: Some(true),\n+        maxBytes: Some(1024 * 1024),\n+    })\n+    .expect(\"diff workspace unborn\");\n+\n+    // Expect a diff against remote default: a.txt should be modified\n+    if !out.iter().any(|e| e.filePath == \"a.txt\") {\n+        eprintln!(\n+            \"entries: {:?}\",\n+            out.iter()\n+                .map(|e| format!(\"{}:{}\", e.status, e.filePath))\n+                .collect::<Vec<_>>()\n+        );\n+    }\n+    let row = out\n+        .iter()\n+        .find(|e| e.filePath == \"a.txt\")\n+        .expect(\"has a.txt\");\n+    assert_eq!(row.status, \"modified\");\n+    assert_eq!(row.contentOmitted, Some(false));\n+    assert!(row.oldContent.as_deref() == Some(\"one\\n\"));\n+    assert!(row.newContent.as_deref() == Some(\"one\\ntwo\\n\"));\n+    assert!(row.additions >= 1);\n }\n \n #[test]\n fn refs_diff_basic_on_local_repo() {\n-  let tmp = tempdir().unwrap();\n-  let work = tmp.path().join(\"repo\");\n-  std::fs::create_dir_all(&work).unwrap();\n-  run(&work, \"git init\");\n-  run(&work, \"git -c user.email=a@b -c user.name=test checkout -b main\");\n-  std::fs::write(work.join(\"a.txt\"), b\"a1\\n\").unwrap();\n-  run(&work, \"git add .\");\n-  run(&work, \"git -c user.email=a@b -c user.name=test commit -m init\");\n-  run(&work, \"git checkout -b feature\");\n-  std::fs::write(work.join(\"b.txt\"), b\"b\\n\").unwrap();\n-  run(&work, \"git add .\");\n-  run(&work, \"git -c user.email=a@b -c user.name=test commit -m change\");\n-\n-  let out = crate::diff::refs::diff_refs(GitDiffOptions{\n-    baseRef: Some(\"main\".into()),\n-    headRef: \"feature\".into(),\n-    repoFullName: None,\n-    repoUrl: None,\n-    teamSlugOrId: None,\n-    originPathOverride: Some(work.to_string_lossy().to_string()),\n-    includeContents: Some(true),\n-    maxBytes: Some(1024*1024),\n-    lastKnownBaseSha: None,\n-    lastKnownMergeCommitSha: None,\n-  }).unwrap();\n-\n-  assert!(out.iter().any(|e| e.filePath == \"b.txt\"));\n+    let tmp = tempdir().unwrap();\n+    let work = tmp.path().join(\"repo\");\n+    std::fs::create_dir_all(&work).unwrap();\n+    run(&work, \"git init\");\n+    run(\n+        &work,\n+        \"git -c user.email=a@b -c user.name=test checkout -b main\",\n+    );\n+    std::fs::write(work.join(\"a.txt\"), b\"a1\\n\").unwrap();\n+    run(&work, \"git add .\");\n+    run(\n+        &work,\n+        \"git -c user.email=a@b -c user.name=test commit -m init\",\n+    );\n+    run(&work, \"git checkout -b feature\");\n+    std::fs::write(work.join(\"b.txt\"), b\"b\\n\").unwrap();\n+    run(&work, \"git add .\");\n+    run(\n+        &work,\n+        \"git -c user.email=a@b -c user.name=test commit -m change\",\n+    );\n+\n+    let out = crate::diff::refs::diff_refs(GitDiffOptions {\n+        baseRef: Some(\"main\".into()),\n+        headRef: \"feature\".into(),\n+        repoFullName: None,\n+        repoUrl: None,\n+        teamSlugOrId: None,\n+        originPathOverride: Some(work.to_string_lossy().to_string()),\n+        includeContents: Some(true),\n+        maxBytes: Some(1024 * 1024),\n+        lastKnownBaseSha: None,\n+        lastKnownMergeCommitSha: None,\n+    })\n+    .unwrap();\n+\n+    assert!(out.iter().any(|e| e.filePath == \"b.txt\"));\n }\n \n #[test]\n fn refs_merge_base_after_merge_is_branch_tip() {\n-  let tmp = tempdir().unwrap();\n-  let work = tmp.path().join(\"repo\");\n-  fs::create_dir_all(&work).unwrap();\n-\n-  run(&work, \"git init\");\n-  run(&work, \"git -c user.email=a@b -c user.name=test checkout -b main\");\n-  std::fs::write(work.join(\"file.txt\"), b\"base\\n\").unwrap();\n-  run(&work, \"git add .\");\n-  run(&work, \"git -c user.email=a@b -c user.name=test commit -m base\");\n-\n-  run(&work, \"git checkout -b feature\");\n-  std::fs::write(work.join(\"feat.txt\"), b\"feat\\n\").unwrap();\n-  run(&work, \"git add .\");\n-  run(&work, \"git -c user.email=a@b -c user.name=test commit -m feature-change\");\n-\n-  run(&work, \"git checkout main\");\n-  run(&work, \"git -c user.email=a@b -c user.name=test merge --no-ff feature -m merge-feature\");\n-\n-  std::fs::write(work.join(\"main.txt\"), b\"main\\n\").unwrap();\n-  run(&work, \"git add .\");\n-  run(&work, \"git -c user.email=a@b -c user.name=test commit -m main-after-merge\");\n-\n-  let out = crate::diff::refs::diff_refs(GitDiffOptions{\n-    baseRef: Some(\"main\".into()),\n-    headRef: \"feature\".into(),\n-    repoFullName: None,\n-    repoUrl: None,\n-    teamSlugOrId: None,\n-    originPathOverride: Some(work.to_string_lossy().to_string()),\n-    includeContents: Some(true),\n-    maxBytes: Some(1024*1024),\n-    lastKnownBaseSha: None,\n-    lastKnownMergeCommitSha: None,\n-  }).unwrap();\n-  assert_eq!(out.len(), 0, \"Expected no differences after merge, got: {:?}\", out);\n+    let tmp = tempdir().unwrap();\n+    let work = tmp.path().join(\"repo\");\n+    fs::create_dir_all(&work).unwrap();\n+\n+    run(&work, \"git init\");\n+    run(\n+        &work,\n+        \"git -c user.email=a@b -c user.name=test checkout -b main\",\n+    );\n+    std::fs::write(work.join(\"file.txt\"), b\"base\\n\").unwrap();\n+    run(&work, \"git add .\");\n+    run(\n+        &work,\n+        \"git -c user.email=a@b -c user.name=test commit -m base\",\n+    );\n+\n+    run(&work, \"git checkout -b feature\");\n+    std::fs::write(work.join(\"feat.txt\"), b\"feat\\n\").unwrap();\n+    run(&work, \"git add .\");\n+    run(\n+        &work,\n+        \"git -c user.email=a@b -c user.name=test commit -m feature-change\",\n+    );\n+\n+    run(&work, \"git checkout main\");\n+    run(\n+        &work,\n+        \"git -c user.email=a@b -c user.name=test merge --no-ff feature -m merge-feature\",\n+    );\n+\n+    std::fs::write(work.join(\"main.txt\"), b\"main\\n\").unwrap();\n+    run(&work, \"git add .\");\n+    run(\n+        &work,\n+        \"git -c user.email=a@b -c user.name=test commit -m main-after-merge\",\n+    );\n+\n+    let out = crate::diff::refs::diff_refs(GitDiffOptions {\n+        baseRef: Some(\"main\".into()),\n+        headRef: \"feature\".into(),\n+        repoFullName: None,\n+        repoUrl: None,\n+        teamSlugOrId: None,\n+        originPathOverride: Some(work.to_string_lossy().to_string()),\n+        includeContents: Some(true),\n+        maxBytes: Some(1024 * 1024),\n+        lastKnownBaseSha: None,\n+        lastKnownMergeCommitSha: None,\n+    })\n+    .unwrap();\n+    assert_eq!(\n+        out.len(),\n+        0,\n+        \"Expected no differences after merge, got: {:?}\",\n+        out\n+    );\n }\n \n #[test]\n fn refs_diff_numstat_matches_known_pairs() {\n-  // Ensure we run against the repo root so refs are available\n-  let manifest_dir = PathBuf::from(env!(\"CARGO_MANIFEST_DIR\"));\n-  let repo_root = find_git_root(manifest_dir);\n-  // Proactively fetch to make sure remote-only commits are present locally\n-  run(&repo_root, \"git fetch --all --tags --prune\");\n-\n-  let cases = vec![\n-    (\"63f3bf66676b5bc7d495f6aaacabe75895ff2045\", \"0ae5f5b2098b4d7c5f3185943251fba8ee791575\", 6, 30),\n-    (\"7a985028c3ecc57f110d91191a4d000c39f0a63e\", \"5f7d671ca484360df34e363511a0dd60ebe25c79\", 294, 255),\n-    (\"4a886e5e769857b9af000224a33460f96fa66545\", \"08db1fe57536b2832a75b8eff5c1955e735157e6\", 512, 232),\n-    (\"2f5f387feee44af6d540da544a0501678dcc2538\", \"2b292770f68d8c097420bd70fd446ca22a88ec62\", 3, 3),\n-  ];\n-\n-  for (from, to, exp_adds, exp_dels) in cases {\n-    let out = crate::diff::refs::diff_refs(GitDiffOptions{\n-      baseRef: Some(from.into()),\n-      headRef: to.into(),\n-      repoFullName: None,\n-      repoUrl: None,\n-      teamSlugOrId: None,\n-      originPathOverride: Some(repo_root.to_string_lossy().to_string()),\n-      includeContents: Some(true),\n-      maxBytes: Some(10*1024*1024),\n-      lastKnownBaseSha: None,\n-      lastKnownMergeCommitSha: None,\n-    }).expect(\"diff refs\");\n-    let adds: i32 = out.iter().map(|e| e.additions).sum();\n-    let dels: i32 = out.iter().map(|e| e.deletions).sum();\n-    assert_eq!((adds, dels), (exp_adds, exp_dels), \"mismatch for {}..{} entries={}\", from, to, out.len());\n-  }\n+    // Ensure we run against the repo root so refs are available\n+    let manifest_dir = PathBuf::from(env!(\"CARGO_MANIFEST_DIR\"));\n+    let repo_root = find_git_root(manifest_dir);\n+    // Proactively fetch to make sure remote-only commits are present locally\n+    run(&repo_root, \"git fetch --all --tags --prune\");\n+\n+    let cases = vec![\n+        (\n+            \"63f3bf66676b5bc7d495f6aaacabe75895ff2045\",\n+            \"0ae5f5b2098b4d7c5f3185943251fba8ee791575\",\n+            6,\n+            30,\n+        ),\n+        (\n+            \"7a985028c3ecc57f110d91191a4d000c39f0a63e\",\n+            \"5f7d671ca484360df34e363511a0dd60ebe25c79\",\n+            294,\n+            255,\n+        ),\n+        (\n+            \"4a886e5e769857b9af000224a33460f96fa66545\",\n+            \"08db1fe57536b2832a75b8eff5c1955e735157e6\",\n+            512,\n+            232,\n+        ),\n+        (\n+            \"2f5f387feee44af6d540da544a0501678dcc2538\",\n+            \"2b292770f68d8c097420bd70fd446ca22a88ec62\",\n+            3,\n+            3,\n+        ),\n+    ];\n+\n+    for (from, to, exp_adds, exp_dels) in cases {\n+        let out = crate::diff::refs::diff_refs(GitDiffOptions {\n+            baseRef: Some(from.into()),\n+            headRef: to.into(),\n+            repoFullName: None,\n+            repoUrl: None,\n+            teamSlugOrId: None,\n+            originPathOverride: Some(repo_root.to_string_lossy().to_string()),\n+            includeContents: Some(true),\n+            maxBytes: Some(10 * 1024 * 1024),\n+            lastKnownBaseSha: None,\n+            lastKnownMergeCommitSha: None,\n+        })\n+        .expect(\"diff refs\");\n+        let adds: i32 = out.iter().map(|e| e.additions).sum();\n+        let dels: i32 = out.iter().map(|e| e.deletions).sum();\n+        assert_eq!(\n+            (adds, dels),\n+            (exp_adds, exp_dels),\n+            \"mismatch for {}..{} entries={}\",\n+            from,\n+            to,\n+            out.len()\n+        );\n+    }\n }\n \n #[test]\n fn refs_diff_handles_binary_files() {\n-  let tmp = tempdir().unwrap();\n-  let work = tmp.path().join(\"repo\");\n-  std::fs::create_dir_all(&work).unwrap();\n-  run(&work, \"git init\");\n-  run(&work, \"git -c user.email=a@b -c user.name=test checkout -b main\");\n-\n-  // Commit an initial binary file with NUL bytes\n-  let bin1: Vec<u8> = vec![0, 159, 146, 150, 0, 1, 2, 3, 4, 5];\n-  std::fs::write(work.join(\"bin.dat\"), &bin1).unwrap();\n-  run(&work, \"git add .\");\n-  run(&work, \"git -c user.email=a@b -c user.name=test commit -m init\");\n-  let c1 = String::from_utf8(Command::new(if cfg!(target_os = \"windows\") {\"cmd\"} else {\"sh\"})\n-    .arg(if cfg!(target_os = \"windows\") {\"/C\"} else {\"-c\"})\n-    .arg(\"git rev-parse HEAD\")\n-    .current_dir(&work)\n-    .output().unwrap().stdout).unwrap();\n-  let c1 = c1.trim().to_string();\n-\n-  // Modify the binary file\n-  let mut bin2 = bin1.clone();\n-  bin2.extend_from_slice(&[6,7,8,9,0]);\n-  std::fs::write(work.join(\"bin.dat\"), &bin2).unwrap();\n-  run(&work, \"git add .\");\n-  run(&work, \"git -c user.email=a@b -c user.name=test commit -m update\");\n-  let c2 = String::from_utf8(Command::new(if cfg!(target_os = \"windows\") {\"cmd\"} else {\"sh\"})\n-    .arg(if cfg!(target_os = \"windows\") {\"/C\"} else {\"-c\"})\n-    .arg(\"git rev-parse HEAD\")\n-    .current_dir(&work)\n-    .output().unwrap().stdout).unwrap();\n-  let c2 = c2.trim().to_string();\n-\n-  let out = crate::diff::refs::diff_refs(GitDiffOptions{\n-    baseRef: Some(c1.clone()),\n-    headRef: c2.clone(),\n-    repoFullName: None,\n-    repoUrl: None,\n-    teamSlugOrId: None,\n-    originPathOverride: Some(work.to_string_lossy().to_string()),\n-    includeContents: Some(true),\n-    maxBytes: Some(1024*1024),\n-    lastKnownBaseSha: None,\n-    lastKnownMergeCommitSha: None,\n-  }).expect(\"diff refs binary\");\n-\n-  let bin_entry = out.iter().find(|e| e.filePath == \"bin.dat\").expect(\"binary entry\");\n-  assert!(bin_entry.isBinary, \"binary file should be detected\");\n-  assert_eq!(bin_entry.additions, 0);\n-  assert_eq!(bin_entry.deletions, 0);\n+    let tmp = tempdir().unwrap();\n+    let work = tmp.path().join(\"repo\");\n+    std::fs::create_dir_all(&work).unwrap();\n+    run(&work, \"git init\");\n+    run(\n+        &work,\n+        \"git -c user.email=a@b -c user.name=test checkout -b main\",\n+    );\n+\n+    // Commit an initial binary file with NUL bytes\n+    let bin1: Vec<u8> = vec![0, 159, 146, 150, 0, 1, 2, 3, 4, 5];\n+    std::fs::write(work.join(\"bin.dat\"), &bin1).unwrap();\n+    run(&work, \"git add .\");\n+    run(\n+        &work,\n+        \"git -c user.email=a@b -c user.name=test commit -m init\",\n+    );\n+    let c1 = String::from_utf8(\n+        Command::new(if cfg!(target_os = \"windows\") {\n+            \"cmd\"\n+        } else {\n+            \"sh\"\n+        })\n+        .arg(if cfg!(target_os = \"windows\") {\n+            \"/C\"\n+        } else {\n+            \"-c\"\n+        })\n+        .arg(\"git rev-parse HEAD\")\n+        .current_dir(&work)\n+        .output()\n+        .unwrap()\n+        .stdout,\n+    )\n+    .unwrap();\n+    let c1 = c1.trim().to_string();\n+\n+    // Modify the binary file\n+    let mut bin2 = bin1.clone();\n+    bin2.extend_from_slice(&[6, 7, 8, 9, 0]);\n+    std::fs::write(work.join(\"bin.dat\"), &bin2).unwrap();\n+    run(&work, \"git add .\");\n+    run(\n+        &work,\n+        \"git -c user.email=a@b -c user.name=test commit -m update\",\n+    );\n+    let c2 = String::from_utf8(\n+        Command::new(if cfg!(target_os = \"windows\") {\n+            \"cmd\"\n+        } else {\n+            \"sh\"\n+        })\n+        .arg(if cfg!(target_os = \"windows\") {\n+            \"/C\"\n+        } else {\n+            \"-c\"\n+        })\n+        .arg(\"git rev-parse HEAD\")\n+        .current_dir(&work)\n+        .output()\n+        .unwrap()\n+        .stdout,\n+    )\n+    .unwrap();\n+    let c2 = c2.trim().to_string();\n+\n+    let out = crate::diff::refs::diff_refs(GitDiffOptions {\n+        baseRef: Some(c1.clone()),\n+        headRef: c2.clone(),\n+        repoFullName: None,\n+        repoUrl: None,\n+        teamSlugOrId: None,\n+        originPathOverride: Some(work.to_string_lossy().to_string()),\n+        includeContents: Some(true),\n+        maxBytes: Some(1024 * 1024),\n+        lastKnownBaseSha: None,\n+        lastKnownMergeCommitSha: None,\n+    })\n+    .expect(\"diff refs binary\");\n+\n+    let bin_entry = out\n+        .iter()\n+        .find(|e| e.filePath == \"bin.dat\")\n+        .expect(\"binary entry\");\n+    assert!(bin_entry.isBinary, \"binary file should be detected\");\n+    assert_eq!(bin_entry.additions, 0);\n+    assert_eq!(bin_entry.deletions, 0);\n }\n \n #[cfg(feature = \"fuzz-tests\")]\n #[test]\n #[ignore]\n fn fuzz_merge_commit_inference_matches_github() {\n-  let truth = ground_truth();\n-  // Warm repositories sequentially before spawning worker threads\n-  for repo_slug in truth.repos.keys() {\n-    let base = ensure_repo_with_pull_refs(repo_slug);\n-    let _ = canonicalize_path(&base);\n-  }\n-\n-  let tasks: Vec<&PullRequestRecord> = truth\n-    .repos\n-    .values()\n-    .flat_map(|prs| prs.iter())\n-    .collect();\n-\n-  let thread_count = std::thread::available_parallelism()\n-    .map(|n| n.get())\n-    .unwrap_or(4);\n-  let pool = ThreadPoolBuilder::new()\n-    .num_threads(thread_count)\n-    .build()\n-    .expect(\"build rayon pool\");\n-\n-  let aggregated = pool.install(|| {\n-    tasks\n-      .par_iter()\n-      .map(|pr| evaluate_merge_pr(pr))\n-      .fold(\n-        || (MergeStats::default(), Vec::new()),\n-        |mut acc, (stats, mismatch)| {\n-          acc.0.accumulate(&stats);\n-          if let Some(m) = mismatch {\n-            acc.1.push(m);\n-          }\n-          acc\n-        },\n-      )\n-      .reduce(\n-        || (MergeStats::default(), Vec::new()),\n-        |mut acc, item| {\n-          acc.0.accumulate(&item.0);\n-          acc.1.extend(item.1);\n-          acc\n-        },\n-      )\n-  });\n-\n-  let aggregated_stats = &aggregated.0;\n-\n-  println!(\n+    let truth = ground_truth();\n+    // Warm repositories sequentially before spawning worker threads\n+    for repo_slug in truth.repos.keys() {\n+        let base = ensure_repo_with_pull_refs(repo_slug);\n+        let _ = canonicalize_path(&base);\n+    }\n+\n+    let tasks: Vec<&PullRequestRecord> = truth.repos.values().flat_map(|prs| prs.iter()).collect();\n+\n+    let thread_count = std::thread::available_parallelism()\n+        .map(|n| n.get())\n+        .unwrap_or(4);\n+    let pool = ThreadPoolBuilder::new()\n+        .num_threads(thread_count)\n+        .build()\n+        .expect(\"build rayon pool\");\n+\n+    let aggregated = pool.install(|| {\n+        tasks\n+            .par_iter()\n+            .map(|pr| evaluate_merge_pr(pr))\n+            .fold(\n+                || (MergeStats::default(), Vec::new()),\n+                |mut acc, (stats, mismatch)| {\n+                    acc.0.accumulate(&stats);\n+                    if let Some(m) = mismatch {\n+                        acc.1.push(m);\n+                    }\n+                    acc\n+                },\n+            )\n+            .reduce(\n+                || (MergeStats::default(), Vec::new()),\n+                |mut acc, item| {\n+                    acc.0.accumulate(&item.0);\n+                    acc.1.extend(item.1);\n+                    acc\n+                },\n+            )\n+    });\n+\n+    let aggregated_stats = &aggregated.0;\n+\n+    println!(\n     \"[merge-summary] total_with_merge={} matches={} (fallback={}) matches_second_parent={} compare_equal_head={} mismatches={} single_parent={} missing_commits={} (after_fetch={}) fetch_attempts={} fetch_success={} fallback_used={} no_merge_commit={}\",\n     aggregated_stats.total_with_merge,\n     aggregated_stats.matches,\n@@ -711,75 +893,90 @@ fn fuzz_merge_commit_inference_matches_github() {\n     aggregated_stats.no_merge_commit,\n   );\n \n-  if !aggregated.1.is_empty() {\n-    println!(\n-      \"[merge-summary] unmatched_with_merge_oid={} entries (showing up to 10):\",\n-      aggregated_stats.unmatched_with_merge_oid\n-    );\n-    for m in aggregated.1.iter().take(10) {\n-      println!(\n-        \"  - {}#{} compare={} base_parent={} head_parent={} merge_commit={:?} reason={}\",\n-        m.repo,\n-        m.number,\n-        m.compare_base,\n-        m.base_parent,\n-        m.head_parent,\n-        m.merge_commit,\n-        m.reason,\n-      );\n+    if !aggregated.1.is_empty() {\n+        println!(\n+            \"[merge-summary] unmatched_with_merge_oid={} entries (showing up to 10):\",\n+            aggregated_stats.unmatched_with_merge_oid\n+        );\n+        for m in aggregated.1.iter().take(10) {\n+            println!(\n+                \"  - {}#{} compare={} base_parent={} head_parent={} merge_commit={:?} reason={}\",\n+                m.repo,\n+                m.number,\n+                m.compare_base,\n+                m.base_parent,\n+                m.head_parent,\n+                m.merge_commit,\n+                m.reason,\n+            );\n+        }\n     }\n-  }\n \n-  assert_eq!(aggregated_stats.compare_equal_head, 0, \"compare_base matched head for some PRs\");\n+    assert_eq!(\n+        aggregated_stats.compare_equal_head, 0,\n+        \"compare_base matched head for some PRs\"\n+    );\n }\n \n #[test]\n #[ignore]\n fn debug_single_pr() {\n-  let truth = ground_truth();\n-  let target_repo = std::env::var(\"DEBUG_PR_REPO\").unwrap_or_else(|_| \"manaflow-ai/cmux\".to_string());\n-  let target_number: u64 = std::env::var(\"DEBUG_PR_NUMBER\")\n-    .ok()\n-    .and_then(|v| v.parse().ok())\n-    .unwrap_or(186);\n-  for pr in truth.repos.get(&target_repo).into_iter().flat_map(|prs| prs.iter()) {\n-    if pr.number == target_number {\n-      let cached = compute_diff_for_pr(pr);\n-      println!(\"debug={:?}\", cached.debug);\n-      println!(\"base_repo={:?}\", cached.base_repo_path);\n-      if let Some(merge_sha) = &pr.merge_commit_sha {\n-        ensure_merge_commit(&cached.base_repo_path, pr.number, merge_sha);\n-        let parents = commit_parents(&cached.base_repo_path, merge_sha);\n-        println!(\"parents={:?}\", parents);\n-      }\n-      return;\n+    let truth = ground_truth();\n+    let target_repo =\n+        std::env::var(\"DEBUG_PR_REPO\").unwrap_or_else(|_| \"manaflow-ai/cmux\".to_string());\n+    let target_number: u64 = std::env::var(\"DEBUG_PR_NUMBER\")\n+        .ok()\n+        .and_then(|v| v.parse().ok())\n+        .unwrap_or(186);\n+    for pr in truth\n+        .repos\n+        .get(&target_repo)\n+        .into_iter()\n+        .flat_map(|prs| prs.iter())\n+    {\n+        if pr.number == target_number {\n+            let cached = compute_diff_for_pr(pr);\n+            println!(\"debug={:?}\", cached.debug);\n+            println!(\"base_repo={:?}\", cached.base_repo_path);\n+            if let Some(merge_sha) = &pr.merge_commit_sha {\n+                ensure_merge_commit(&cached.base_repo_path, pr.number, merge_sha);\n+                let parents = commit_parents(&cached.base_repo_path, merge_sha);\n+                println!(\"parents={:?}\", parents);\n+            }\n+            return;\n+        }\n     }\n-  }\n-  panic!(\"PR not found\");\n+    panic!(\"PR not found\");\n }\n \n #[cfg(feature = \"fuzz-tests\")]\n #[test]\n #[ignore]\n fn fuzz_diff_stats_match_github_ground_truth() {\n-  let truth = ground_truth();\n-  let target_repo_filter = std::env::var(\"DIFF_STATS_REPO\").ok();\n-  let target_number_filter: Option<u64> = std::env::var(\"DIFF_STATS_PR\").ok().and_then(|v| v.parse().ok());\n-  let mut checked = 0usize;\n-  let mut matched = 0usize;\n-  let mut mismatched_entries: Vec<(String, u64)> = Vec::new();\n-  for prs in truth.repos.values() {\n-    for pr in prs {\n-      if let Some(repo_filter) = &target_repo_filter {\n-        if &pr.repo != repo_filter { continue; }\n-      }\n-      if let Some(num_filter) = target_number_filter {\n-        if pr.number != num_filter { continue; }\n-      }\n-      let (stats, mismatch) = evaluate_merge_pr(pr);\n-      if stats.matches == 0 {\n-        if let Some(m) = mismatch {\n-          println!(\n+    let truth = ground_truth();\n+    let target_repo_filter = std::env::var(\"DIFF_STATS_REPO\").ok();\n+    let target_number_filter: Option<u64> = std::env::var(\"DIFF_STATS_PR\")\n+        .ok()\n+        .and_then(|v| v.parse().ok());\n+    let mut checked = 0usize;\n+    let mut matched = 0usize;\n+    let mut mismatched_entries: Vec<(String, u64)> = Vec::new();\n+    for prs in truth.repos.values() {\n+        for pr in prs {\n+            if let Some(repo_filter) = &target_repo_filter {\n+                if &pr.repo != repo_filter {\n+                    continue;\n+                }\n+            }\n+            if let Some(num_filter) = target_number_filter {\n+                if pr.number != num_filter {\n+                    continue;\n+                }\n+            }\n+            let (stats, mismatch) = evaluate_merge_pr(pr);\n+            if stats.matches == 0 {\n+                if let Some(m) = mismatch {\n+                    println!(\n             \"[diff-stats] skipping {}#{} due to merge mismatch: compare={} expected={} head_parent={} reason={}\",\n             m.repo,\n             m.number,\n@@ -788,11 +985,11 @@ fn fuzz_diff_stats_match_github_ground_truth() {\n             m.head_parent,\n             m.reason,\n           );\n-        }\n-        continue;\n-      }\n-      checked += 1;\n-      println!(\n+                }\n+                continue;\n+            }\n+            checked += 1;\n+            println!(\n         \"[diff-stats] checking {}#{} (additions_gt={} deletions_gt={} files_gt={} merge_match={} second_parent_match={})\",\n         pr.repo,\n         pr.number,\n@@ -802,62 +999,50 @@ fn fuzz_diff_stats_match_github_ground_truth() {\n         stats.matches,\n         stats.matches_second_parent,\n       );\n-      let cached = compute_diff_for_pr(pr);\n-      let mut mismatched = false;\n-      if cached.additions != pr.additions {\n-        mismatched = true;\n-        println!(\n-          \"[diff-stats] additions mismatch for {}#{} ours={} github={}\",\n-          pr.repo,\n-          pr.number,\n-          cached.additions,\n-          pr.additions,\n-        );\n-      }\n-      if cached.deletions != pr.deletions {\n-        mismatched = true;\n-        println!(\n-          \"[diff-stats] deletions mismatch for {}#{} ours={} github={}\",\n-          pr.repo,\n-          pr.number,\n-          cached.deletions,\n-          pr.deletions,\n-        );\n-      }\n-      if cached.changed_files as i64 != pr.changed_files {\n-        mismatched = true;\n-        println!(\n-          \"[diff-stats] changed_files mismatch for {}#{} ours={} github={}\",\n-          pr.repo,\n-          pr.number,\n-          cached.changed_files,\n-          pr.changed_files,\n-        );\n-      }\n-      if mismatched {\n-        mismatched_entries.push((pr.repo.clone(), pr.number));\n-        println!(\n-          \"[diff-stats] mismatch detail compare={} head={} merge_commit={:?}\",\n-          cached.debug.compare_base_oid,\n-          cached.debug.head_oid,\n-          pr.merge_commit_sha,\n-        );\n-      }\n-      else {\n-        matched += 1;\n-      }\n+            let cached = compute_diff_for_pr(pr);\n+            let mut mismatched = false;\n+            if cached.additions != pr.additions {\n+                mismatched = true;\n+                println!(\n+                    \"[diff-stats] additions mismatch for {}#{} ours={} github={}\",\n+                    pr.repo, pr.number, cached.additions, pr.additions,\n+                );\n+            }\n+            if cached.deletions != pr.deletions {\n+                mismatched = true;\n+                println!(\n+                    \"[diff-stats] deletions mismatch for {}#{} ours={} github={}\",\n+                    pr.repo, pr.number, cached.deletions, pr.deletions,\n+                );\n+            }\n+            if cached.changed_files as i64 != pr.changed_files {\n+                mismatched = true;\n+                println!(\n+                    \"[diff-stats] changed_files mismatch for {}#{} ours={} github={}\",\n+                    pr.repo, pr.number, cached.changed_files, pr.changed_files,\n+                );\n+            }\n+            if mismatched {\n+                mismatched_entries.push((pr.repo.clone(), pr.number));\n+                println!(\n+                    \"[diff-stats] mismatch detail compare={} head={} merge_commit={:?}\",\n+                    cached.debug.compare_base_oid, cached.debug.head_oid, pr.merge_commit_sha,\n+                );\n+            } else {\n+                matched += 1;\n+            }\n+        }\n     }\n-  }\n-  println!(\n-    \"[diff-stats-summary] checked={} matched={} mismatched={}\",\n-    checked,\n-    matched,\n-    mismatched_entries.len(),\n-  );\n-  if !mismatched_entries.is_empty() {\n-    for (repo, number) in mismatched_entries.iter().take(20) {\n-      println!(\"  - {}#{}\", repo, number);\n+    println!(\n+        \"[diff-stats-summary] checked={} matched={} mismatched={}\",\n+        checked,\n+        matched,\n+        mismatched_entries.len(),\n+    );\n+    if !mismatched_entries.is_empty() {\n+        for (repo, number) in mismatched_entries.iter().take(20) {\n+            println!(\"  - {}#{}\", repo, number);\n+        }\n     }\n-  }\n-  assert!(checked > 0, \"no PRs with verified merge bases\");\n+    assert!(checked > 0, \"no PRs with verified merge bases\");\n }\ndiff --git a/apps/server/native/core/src/types.rs b/apps/server/native/core/src/types.rs\nindex fd867c84d..b52818a11 100644\n--- a/apps/server/native/core/src/types.rs\n+++ b/apps/server/native/core/src/types.rs\n@@ -4,59 +4,59 @@ use napi_derive::napi;\n #[napi(object)]\n #[derive(Default, Debug, Clone)]\n pub struct DiffEntry {\n-  pub filePath: String,\n-  pub oldPath: Option<String>,\n-  pub status: String,\n-  pub additions: i32,\n-  pub deletions: i32,\n-  pub isBinary: bool,\n-  pub contentOmitted: Option<bool>,\n-  pub oldContent: Option<String>,\n-  pub newContent: Option<String>,\n-  pub oldSize: Option<i32>,\n-  pub newSize: Option<i32>,\n-  pub patchSize: Option<i32>,\n-  pub patch: Option<String>,\n+    pub filePath: String,\n+    pub oldPath: Option<String>,\n+    pub status: String,\n+    pub additions: i32,\n+    pub deletions: i32,\n+    pub isBinary: bool,\n+    pub contentOmitted: Option<bool>,\n+    pub oldContent: Option<String>,\n+    pub newContent: Option<String>,\n+    pub oldSize: Option<i32>,\n+    pub newSize: Option<i32>,\n+    pub patchSize: Option<i32>,\n+    pub patch: Option<String>,\n }\n \n #[napi(object)]\n #[derive(Default, Debug, Clone)]\n pub struct BranchInfo {\n-  pub name: String,\n-  pub lastCommitSha: Option<String>,\n-  pub lastActivityAt: Option<i64>,\n-  pub isDefault: Option<bool>,\n-  pub lastKnownBaseSha: Option<String>,\n-  pub lastKnownMergeCommitSha: Option<String>,\n+    pub name: String,\n+    pub lastCommitSha: Option<String>,\n+    pub lastActivityAt: Option<i64>,\n+    pub isDefault: Option<bool>,\n+    pub lastKnownBaseSha: Option<String>,\n+    pub lastKnownMergeCommitSha: Option<String>,\n }\n \n #[napi(object)]\n #[derive(Default, Debug, Clone)]\n pub struct GitListRemoteBranchesOptions {\n-  pub repoFullName: Option<String>,\n-  pub repoUrl: Option<String>,\n-  pub originPathOverride: Option<String>,\n+    pub repoFullName: Option<String>,\n+    pub repoUrl: Option<String>,\n+    pub originPathOverride: Option<String>,\n }\n \n #[cfg(test)]\n #[derive(Default, Debug, Clone)]\n pub struct GitDiffWorkspaceOptions {\n-  pub worktreePath: String,\n-  pub includeContents: Option<bool>,\n-  pub maxBytes: Option<i32>,\n+    pub worktreePath: String,\n+    pub includeContents: Option<bool>,\n+    pub maxBytes: Option<i32>,\n }\n \n #[napi(object)]\n #[derive(Default, Debug, Clone)]\n pub struct GitDiffOptions {\n-  pub headRef: String,\n-  pub baseRef: Option<String>,\n-  pub repoFullName: Option<String>,\n-  pub repoUrl: Option<String>,\n-  pub teamSlugOrId: Option<String>,\n-  pub originPathOverride: Option<String>,\n-  pub includeContents: Option<bool>,\n-  pub maxBytes: Option<i32>,\n-  pub lastKnownBaseSha: Option<String>,\n-  pub lastKnownMergeCommitSha: Option<String>,\n+    pub headRef: String,\n+    pub baseRef: Option<String>,\n+    pub repoFullName: Option<String>,\n+    pub repoUrl: Option<String>,\n+    pub teamSlugOrId: Option<String>,\n+    pub originPathOverride: Option<String>,\n+    pub includeContents: Option<bool>,\n+    pub maxBytes: Option<i32>,\n+    pub lastKnownBaseSha: Option<String>,\n+    pub lastKnownMergeCommitSha: Option<String>,\n }\ndiff --git a/apps/server/native/core/src/util.rs b/apps/server/native/core/src/util.rs\nindex 5df72ca50..c8cc6b397 100644\n--- a/apps/server/native/core/src/util.rs\n+++ b/apps/server/native/core/src/util.rs\n@@ -2,13 +2,13 @@ use anyhow::{anyhow, Result};\n use std::process::{Command, Stdio};\n \n pub fn run_git(cwd: &str, args: &[&str]) -> Result<String> {\n-  let mut cmd = Command::new(\"git\");\n-  cmd.current_dir(cwd).args(args).stdin(Stdio::null());\n-  let output = cmd.output()?;\n-  if output.status.success() {\n-    Ok(String::from_utf8_lossy(&output.stdout).into_owned())\n-  } else {\n-    let err = String::from_utf8_lossy(&output.stderr);\n-    Err(anyhow!(\"git {:?} failed: {}\", args, err))\n-  }\n+    let mut cmd = Command::new(\"git\");\n+    cmd.current_dir(cwd).args(args).stdin(Stdio::null());\n+    let output = cmd.output()?;\n+    if output.status.success() {\n+        Ok(String::from_utf8_lossy(&output.stdout).into_owned())\n+    } else {\n+        let err = String::from_utf8_lossy(&output.stderr);\n+        Err(anyhow!(\"git {:?} failed: {}\", args, err))\n+    }\n }\ndiff --git a/crates/cmux-proxy/tests/proxy.rs b/crates/cmux-proxy/tests/proxy.rs\nindex fe1305e05..255482aa8 100644\n--- a/crates/cmux-proxy/tests/proxy.rs\n+++ b/crates/cmux-proxy/tests/proxy.rs\n@@ -333,12 +333,7 @@ async fn test_http_proxy_routes_by_header() {\n         .expect(\"resp custom timeout\")\n         .unwrap();\n     assert_eq!(resp_custom.status(), StatusCode::OK);\n-    let body_custom = resp_custom\n-        .into_body()\n-        .collect()\n-        .await\n-        .unwrap()\n-        .to_bytes();\n+    let body_custom = resp_custom.into_body().collect().await.unwrap().to_bytes();\n     let s_custom = String::from_utf8(body_custom.to_vec()).unwrap();\n     assert!(\n         s_custom.contains(\"ok:GET:/hello\"),\ndiff --git a/crates/cmux-xterm/src/session.rs b/crates/cmux-xterm/src/session.rs\nindex 99441b217..dc11ff22b 100644\n--- a/crates/cmux-xterm/src/session.rs\n+++ b/crates/cmux-xterm/src/session.rs\n@@ -2,7 +2,10 @@ use std::{\n     collections::VecDeque,\n     io::{Read, Write},\n     process::{Command, Stdio},\n-    sync::{atomic::{AtomicU64, Ordering}, Arc, Mutex},\n+    sync::{\n+        atomic::{AtomicU64, Ordering},\n+        Arc, Mutex,\n+    },\n     time::SystemTime,\n };\n \n@@ -309,28 +312,25 @@ impl Session {\n             }\n         }\n \n-        let _ = send_task.abort();\n+        send_task.abort();\n     }\n \n     async fn handle_control(&self, ctrl: ControlMsg) {\n-        match ctrl.typ.as_str() {\n-            \"resize\" => {\n-                if let (Some(cols), Some(rows)) = (ctrl.cols, ctrl.rows) {\n-                    let size = PtySize {\n-                        rows,\n-                        cols,\n-                        pixel_width: 0,\n-                        pixel_height: 0,\n-                    };\n-                    if let Some(master) = &self.master {\n-                        // Try to resize via master pty if available\n-                        if let Ok(m) = master.lock() {\n-                            let _ = m.resize(size);\n-                        }\n+        if ctrl.typ.as_str() == \"resize\" {\n+            if let (Some(cols), Some(rows)) = (ctrl.cols, ctrl.rows) {\n+                let size = PtySize {\n+                    rows,\n+                    cols,\n+                    pixel_width: 0,\n+                    pixel_height: 0,\n+                };\n+                if let Some(master) = &self.master {\n+                    // Try to resize via master pty if available\n+                    if let Ok(m) = master.lock() {\n+                        let _ = m.resize(size);\n                     }\n                 }\n             }\n-            _ => {}\n         }\n     }\n }\ndiff --git a/crates/cmux-xterm/tests/list_tabs_order.rs b/crates/cmux-xterm/tests/list_tabs_order.rs\nindex db342a0c2..427a4c18f 100644\n--- a/crates/cmux-xterm/tests/list_tabs_order.rs\n+++ b/crates/cmux-xterm/tests/list_tabs_order.rs\n@@ -56,5 +56,5 @@ async fn list_tabs_is_ordered_by_creation_time() {\n             .await;\n     }\n \n-    let _ = server.abort();\n+    server.abort();\n }\ndiff --git a/crates/cmux-xterm/tests/ws_integration.rs b/crates/cmux-xterm/tests/ws_integration.rs\nindex 7c528727e..2c8936589 100644\n--- a/crates/cmux-xterm/tests/ws_integration.rs\n+++ b/crates/cmux-xterm/tests/ws_integration.rs\n@@ -96,5 +96,5 @@ async fn ws_echo_cat() {\n         .unwrap();\n     assert!(resp.status().is_success() || resp.status().as_u16() == 204);\n \n-    let _ = server.abort();\n+    server.abort();\n }\ndiff --git a/crates/cmux-xterm/tests/ws_reconnect.rs b/crates/cmux-xterm/tests/ws_reconnect.rs\nindex fee353103..e74e403c5 100644\n--- a/crates/cmux-xterm/tests/ws_reconnect.rs\n+++ b/crates/cmux-xterm/tests/ws_reconnect.rs\n@@ -143,5 +143,5 @@ async fn ws_reconnect_and_reattach() {\n         .unwrap();\n     assert!(resp.status().is_success() || resp.status().as_u16() == 204);\n \n-    let _ = server.abort();\n+    server.abort();\n }\ndiff --git a/packages/shared/src/morph-snapshots.json b/packages/shared/src/morph-snapshots.json\nindex 497b90ad4..0be107e3c 100644\n--- a/packages/shared/src/morph-snapshots.json\n+++ b/packages/shared/src/morph-snapshots.json\n@@ -1,6 +1,6 @@\n {\n   \"schemaVersion\": 1,\n-  \"updatedAt\": \"2025-12-02T23:02:45Z\",\n+  \"updatedAt\": \"2025-12-03T08:43:44Z\",\n   \"presets\": [\n     {\n       \"presetId\": \"4vcpu_16gb_48gb\",\n@@ -68,6 +68,11 @@\n           \"version\": 12,\n           \"snapshotId\": \"snapshot_xrlir8y6\",\n           \"capturedAt\": \"2025-12-02T23:03:02Z\"\n+        },\n+        {\n+          \"version\": 13,\n+          \"snapshotId\": \"snapshot_6b7swr45\",\n+          \"capturedAt\": \"2025-12-03T08:44:36Z\"\n         }\n       ],\n       \"description\": \"Great default for day-to-day work. Balanced CPU, memory, and storage.\"\n@@ -138,6 +143,11 @@\n           \"version\": 12,\n           \"snapshotId\": \"snapshot_tst7w0q1\",\n           \"capturedAt\": \"2025-12-02T23:02:45Z\"\n+        },\n+        {\n+          \"version\": 13,\n+          \"snapshotId\": \"snapshot_zil2h2rg\",\n+          \"capturedAt\": \"2025-12-03T08:43:44Z\"\n         }\n       ],\n       \"description\": \"Extra headroom for larger codebases or heavier workloads.\"\n","comments":[{"type":"issue_comment","id":3605510262,"prNumber":1129,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7aaa0vnhesveqb4b2sz0xjgd7wjx1c?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7aaa0vnhesveqb4b2sz0xjgd7wjx1c/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1129?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n⏳ Preview is starting for commit `073b9b6`. Workspace and dev browser links are ready; screenshots will be attached here when the preview job finishes.\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"267fb7630d902833bfd046463bcee2bdadd3bfb1","createdAt":"2025-12-03T07:46:17Z","updatedAt":"2025-12-03T07:48:07Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1129#issuecomment-3605510262"},{"type":"issue_comment","id":3605515721,"prNumber":1129,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn73knshhpv1sk3jp1pryz3zcn7wkve1?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn73knshhpv1sk3jp1pryz3zcn7wkve1/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1129?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n⏳ Preview is starting for commit `5d233dd`. Workspace and dev browser links are ready; screenshots will be attached here when the preview job finishes.\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"267fb7630d902833bfd046463bcee2bdadd3bfb1","createdAt":"2025-12-03T07:48:06Z","updatedAt":"2025-12-03T07:59:37Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1129#issuecomment-3605515721"},{"type":"issue_comment","id":3605547489,"prNumber":1129,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn717c2q0p9jsf28pcrpnct3vd7wj12h?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn717c2q0p9jsf28pcrpnct3vd7wj12h/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1129?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 7 screenshots for commit `84b989b` (2025-12-03 07:59:34.984 UTC).\n\n**New Contact page with contact information for reaching the cmux team**\n\n![contact-full-ci-cd-parallel-0.png](https://adorable-wombat-701.convex.cloud/api/storage/3730f716-3bde-4a7f-80fa-72458d889002)\n\n**New End User License Agreement (EULA) page for cmux software**\n\n![eula-full-ci-cd-parallel-0.png](https://adorable-wombat-701.convex.cloud/api/storage/23df0532-fa92-4d6d-a232-88e97b42ae30)\n\n**Close-up of homepage footer showing the four new footer links (Privacy, Terms, EULA, Contact)**\n\n![homepage-footer-ci-cd-parallel-0.png](https://adorable-wombat-701.convex.cloud/api/storage/250d7f48-747f-4ac7-8dc0-207f9490d651)\n\n**Full homepage showing updated footer with new Privacy, Terms, EULA, and Contact links**\n\n![homepage-full-ci-cd-parallel-0.png](https://adorable-wombat-701.convex.cloud/api/storage/71502ee1-2d84-4fbd-9b34-de287d1a31da)\n\n**Preview page showing updated background gradient using SVG radial gradient instead of CSS**\n\n![preview-page-background-ci-cd-parallel-0.png](https://adorable-wombat-701.convex.cloud/api/storage/c40314ff-b613-472d-a337-6a45a3c7aa33)\n\n**New Privacy Policy page with comprehensive privacy information for cmux**\n\n![privacy-policy-full-ci-cd-parallel-0.png](https://adorable-wombat-701.convex.cloud/api/storage/32e11093-922d-4797-a0e4-7fe80587e8dc)\n\n**New Terms of Service page with legal terms for using cmux**\n\n![terms-of-service-full-ci-cd-parallel-0.png](https://adorable-wombat-701.convex.cloud/api/storage/e09fa5a0-83ab-4c41-b6e6-d45a9f5b9fa3)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"267fb7630d902833bfd046463bcee2bdadd3bfb1","createdAt":"2025-12-03T07:59:36Z","updatedAt":"2025-12-03T08:26:53Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1129#issuecomment-3605547489"},{"type":"issue_comment","id":3605633217,"prNumber":1129,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn7117pjk3c157ahq6p0dzgtz57wjvyz?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn7117pjk3c157ahq6p0dzgtz57wjvyz/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1129?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 7 screenshots for commit `50134ee` (2025-12-03 08:26:51.195 UTC).\n\n**New contact page displaying email contact information (austin@manaflow.com)**\n\n![contact-page-ci-cd-parallel-0.png](https://adorable-wombat-701.convex.cloud/api/storage/cf85a0e0-dca5-4728-a287-5f4e222ae799)\n\n**New EULA (End User License Agreement) page with legal terms**\n\n![eula-page-ci-cd-parallel-0.png](https://adorable-wombat-701.convex.cloud/api/storage/57e45247-9d91-4d4e-97bc-3fe6d9812752)\n\n**Close-up of landing page footer showing new links: Privacy, Terms, EULA, and Contact**\n\n![landing-page-footer-ci-cd-parallel-0.png](https://adorable-wombat-701.convex.cloud/api/storage/5d766301-42a4-4092-a437-e6051256d59a)\n\n**Full landing page with updated footer containing new Privacy, Terms, EULA, and Contact links**\n\n![landing-page-full-ci-cd-parallel-0.png](https://adorable-wombat-701.convex.cloud/api/storage/1517e0b0-ea42-4900-9dec-c5e1299bd1a2)\n\n**Preview landing page showing updated SVG gradient background (changed from CSS radial-gradient to SVG ellipse)**\n\n![preview-landing-page-ci-cd-parallel-0.png](https://adorable-wombat-701.convex.cloud/api/storage/b4f7378f-b86c-4371-8f85-ecf8b348f139)\n\n**New privacy policy page detailing data collection and usage policies**\n\n![privacy-policy-page-ci-cd-parallel-0.png](https://adorable-wombat-701.convex.cloud/api/storage/4b834183-8ea4-415c-bf5e-41f544996f48)\n\n**New terms of service page outlining service usage terms and conditions**\n\n![terms-of-service-page-ci-cd-parallel-0.png](https://adorable-wombat-701.convex.cloud/api/storage/2df275e0-86da-435d-b20c-3ffe498e1242)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"267fb7630d902833bfd046463bcee2bdadd3bfb1","createdAt":"2025-12-03T08:26:52Z","updatedAt":"2025-12-03T08:35:27Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1129#issuecomment-3605633217"},{"type":"issue_comment","id":3605668687,"prNumber":1129,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn73xhgyj6ftwcc5qcpva0k1zh7wkdbj?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn73xhgyj6ftwcc5qcpva0k1zh7wkdbj/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1129?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 8 screenshots for commit `4c67fba` (2025-12-03 08:35:23.467 UTC).\n\n**New contact page with email address austin@manaflow.com**\n\n![contact-page-ci-cd-parallel-0.png](https://adorable-wombat-701.convex.cloud/api/storage/4d0d0c1c-1eda-48f2-be27-176cc50a0b91)\n\n**New EULA (End User License Agreement) page with full agreement text**\n\n![eula-page-ci-cd-parallel-0.png](https://adorable-wombat-701.convex.cloud/api/storage/db391596-1645-4625-951d-7819c85b2b91)\n\n**Close-up of homepage footer displaying new legal and contact links**\n\n![homepage-footer-ci-cd-parallel-0.png](https://adorable-wombat-701.convex.cloud/api/storage/be91eb5b-804b-4475-8b3e-3d863023373e)\n\n**Full homepage showing updated footer with new Privacy, Terms, EULA, and Contact links**\n\n![homepage-full-ci-cd-parallel-0.png](https://adorable-wombat-701.convex.cloud/api/storage/e4a3537c-66bd-47d4-8765-4e412db750a1)\n\n**Full preview page showing the updated background with SVG radial gradient**\n\n![preview-page-ci-cd-parallel-0.png](https://adorable-wombat-701.convex.cloud/api/storage/2640a123-8c48-4409-b095-6066d9fe861b)\n\n**Top section of preview page highlighting the new SVG-based radial gradient background (changed from CSS radial-gradient)**\n\n![preview-page-gradient-top-ci-cd-parallel-0.png](https://adorable-wombat-701.convex.cloud/api/storage/406ff0b1-1109-4ce7-b47f-32ae3e1be2ca)\n\n**New privacy policy page with full legal text and terms**\n\n![privacy-policy-page-ci-cd-parallel-0.png](https://adorable-wombat-701.convex.cloud/api/storage/cd7aed45-37bd-4db3-a18e-681a8c5337fc)\n\n**New terms of service page with complete legal documentation**\n\n![terms-of-service-page-ci-cd-parallel-0.png](https://adorable-wombat-701.convex.cloud/api/storage/ef5f0d1b-2b5d-4cf2-bc0d-c0dce722b13c)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"267fb7630d902833bfd046463bcee2bdadd3bfb1","createdAt":"2025-12-03T08:35:26Z","updatedAt":"2025-12-03T08:59:50Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1129#issuecomment-3605668687"},{"type":"issue_comment","id":3605763088,"prNumber":1129,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn76n5p89jb1q4sv6fdqm54j5h7wkw3r?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn76n5p89jb1q4sv6fdqm54j5h7wkw3r/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1129?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 7 screenshots for commit `267fb76` (2025-12-03 08:59:46.899 UTC).\n\n**New Contact page - full page screenshot**\n\n![contact-ci-cd-parallel-0.png](https://famous-camel-162.convex.cloud/api/storage/6b1eaffa-e2a9-46a3-9e8c-7c6556c06c74)\n\n**New EULA (End User License Agreement) page - full page screenshot**\n\n![eula-ci-cd-parallel-0.png](https://famous-camel-162.convex.cloud/api/storage/cb958940-3bc7-4f1e-9c13-c54b0622f195)\n\n**Full homepage showing updated footer with new legal page links (Privacy, Terms, EULA, Contact)**\n\n![homepage-footer-ci-cd-parallel-0.png](https://famous-camel-162.convex.cloud/api/storage/9fe84853-7c47-4d07-bde6-fa65d2d352a9)\n\n**Close-up view of the homepage footer showing the new legal links layout**\n\n![homepage-footer-detail-ci-cd-parallel-0.png](https://famous-camel-162.convex.cloud/api/storage/f215150c-2117-4856-8fa8-a1e8cfe81fe4)\n\n**Preview configuration page showing framework preset selection UI**\n\n![preview-configure-ci-cd-parallel-0.png](https://famous-camel-162.convex.cloud/api/storage/ce1fcbb6-b785-49fc-98a1-f4920839d5f7)\n\n**New Privacy Policy page - full page screenshot**\n\n![privacy-policy-ci-cd-parallel-0.png](https://famous-camel-162.convex.cloud/api/storage/85e86bfe-bbba-44d8-ba65-09e2cd9abee0)\n\n**New Terms of Service page - full page screenshot**\n\n![terms-of-service-ci-cd-parallel-0.png](https://famous-camel-162.convex.cloud/api/storage/d38fd67c-860a-4fcf-af1f-cf1c1c253d1b)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"267fb7630d902833bfd046463bcee2bdadd3bfb1","createdAt":"2025-12-03T08:59:49Z","updatedAt":"2025-12-03T08:59:49Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1129#issuecomment-3605763088"}]}
{"number":1128,"title":"Change cmux note to below comment","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1128","headRef":"cmux/change-cmux-note-to-below-comment-qvbrb","headSha":"a2fa54faca2f685adee78f282156a3b718c635e6","baseRef":"main","baseSha":"0d35a37d612eada0e162733976573677ceadf5f6","createdAt":"2025-12-03T07:39:31Z","updatedAt":"2025-12-03T07:48:19Z","diff":"diff --git a/packages/convex/convex/github_pr_comments.ts b/packages/convex/convex/github_pr_comments.ts\nindex a0eb0e08a..f396f017b 100644\n--- a/packages/convex/convex/github_pr_comments.ts\n+++ b/packages/convex/convex/github_pr_comments.ts\n@@ -25,7 +25,7 @@ type PreviewRunDoc = Doc<\"previewRuns\">;\n type ScreenshotSetDoc = Doc<\"taskRunScreenshotSets\">;\n \n const COLLAPSE_MARKER = \"<!-- cmux-preview-collapsed -->\";\n-const COLLAPSE_SUMMARY = \"Older cmux preview screenshots (latest comment is above)\";\n+const COLLAPSE_SUMMARY = \"Older cmux preview screenshots (latest comment is below)\";\n const MAX_COMMENTS_TO_COLLAPSE = 20;\n const MAX_PREVIOUS_SCREENSHOT_SETS = 5;\n const NON_UI_CHANGE_PATTERNS = [\n","comments":[{"type":"issue_comment","id":3605516352,"prNumber":1128,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7fcvr314wp7jft3a06xtf9gs7wjctq?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7fcvr314wp7jft3a06xtf9gs7wjctq/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1128?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 2 screenshots for commit `a2fa54f` (2025-12-03 07:48:18.644 UTC).\n\n**Focused view of the Crown Evaluator section showing the updated auto-PR feature label and description text**\n\n![settings-crown-evaluator-section-cmux-change-cmux-note-to-below-comment-qvbrb.png](https://famous-camel-162.convex.cloud/api/storage/2c6403b7-d389-4e4c-982b-a2b9acd98f28)\n\n**Full settings page showing the updated auto-PR toggle text: 'Auto-create pull request with the best diff' with description 'After all agents finish, automatically create a pull request with the winning agent's solution.'**\n\n![settings-page-full-cmux-change-cmux-note-to-below-comment-qvbrb.png](https://famous-camel-162.convex.cloud/api/storage/a8f3b4a9-fb7a-4a72-960f-a95045617d35)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"a2fa54faca2f685adee78f282156a3b718c635e6","createdAt":"2025-12-03T07:48:19Z","updatedAt":"2025-12-03T07:48:19Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1128#issuecomment-3605516352"}]}
{"number":1126,"title":"Update legal documents for cmux SaaS","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1126","headRef":"legal-0","headSha":"dae1bad1d30ad576fe1031d11b3236bee5b3788f","baseRef":"main","baseSha":"89a742b84557c00e57ab28b9eab6c4d0b1cfed06","createdAt":"2025-12-03T06:18:38Z","updatedAt":"2025-12-03T06:38:18Z","diff":"diff --git a/apps/www/app/contact/page.tsx b/apps/www/app/contact/page.tsx\nnew file mode 100644\nindex 000000000..752a64900\n--- /dev/null\n+++ b/apps/www/app/contact/page.tsx\n@@ -0,0 +1,22 @@\n+export default function ContactPage() {\n+  return (\n+    <div className=\"flex min-h-screen items-center justify-center bg-neutral-50 dark:bg-neutral-950\">\n+      <div className=\"max-w-md px-4 text-center\">\n+        <h1 className=\"text-2xl font-bold text-neutral-900 dark:text-neutral-100\">\n+          Contact Us\n+        </h1>\n+        <p className=\"mt-4 text-neutral-600 dark:text-neutral-400\">\n+          Have questions or feedback? We'd love to hear from you.\n+        </p>\n+        <p className=\"mt-6\">\n+          <a\n+            href=\"mailto:austin@manaflow.com\"\n+            className=\"text-lg font-medium text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300\"\n+          >\n+            austin@manaflow.com\n+          </a>\n+        </p>\n+      </div>\n+    </div>\n+  );\n+}\ndiff --git a/apps/www/app/eula/page.tsx b/apps/www/app/eula/page.tsx\nnew file mode 100644\nindex 000000000..8c793f91c\n--- /dev/null\n+++ b/apps/www/app/eula/page.tsx\n@@ -0,0 +1,12 @@\n+import { EulaScreen } from \"@/app/privacy-policy/legal\";\n+\n+export default function EulaPage() {\n+  return (\n+    <EulaScreen\n+      appUrl=\"https://cmux.dev\"\n+      company=\"Manaflow\"\n+      contactEmail=\"austin@manaflow.com\"\n+      lastUpdated=\"12/2/2025\"\n+    />\n+  );\n+}\ndiff --git a/apps/www/app/page.tsx b/apps/www/app/page.tsx\nindex 29c883dbb..129c13432 100644\n--- a/apps/www/app/page.tsx\n+++ b/apps/www/app/page.tsx\n@@ -545,10 +545,7 @@ export default async function LandingPage() {\n             <Terminal className=\"h-4 w-4 text-neutral-600\" aria-hidden />\n             <span className=\"font-mono\">cmux by manaflow</span>\n           </div>\n-          <div className=\"flex items-center gap-6\">\n-            {/* <a className=\"transition hover:text-white\" href=\"/tutorial\">\n-              Tutorial\n-            </a> */}\n+          <div className=\"flex flex-wrap items-center justify-center gap-x-6 gap-y-2\">\n             <a\n               className=\"transition hover:text-white\"\n               href=\"https://github.com/manaflow-ai/cmux\"\n@@ -573,6 +570,18 @@ export default async function LandingPage() {\n             >\n               Discord\n             </a>\n+            <Link className=\"transition hover:text-white\" href=\"/privacy-policy\">\n+              Privacy\n+            </Link>\n+            <Link className=\"transition hover:text-white\" href=\"/terms-of-service\">\n+              Terms\n+            </Link>\n+            <Link className=\"transition hover:text-white\" href=\"/eula\">\n+              EULA\n+            </Link>\n+            <Link className=\"transition hover:text-white\" href=\"/contact\">\n+              Contact\n+            </Link>\n           </div>\n         </div>\n       </footer>\ndiff --git a/apps/www/app/privacy-policy/legal.tsx b/apps/www/app/privacy-policy/legal.tsx\nnew file mode 100644\nindex 000000000..00dfa2c1e\n--- /dev/null\n+++ b/apps/www/app/privacy-policy/legal.tsx\n@@ -0,0 +1,1829 @@\n+function H1({ children }: { children: React.ReactNode }) {\n+  return <h1 className=\"text-xl font-bold\">{children}</h1>;\n+}\n+\n+function Paragraph({ children }: { children: React.ReactNode }) {\n+  return <p>{children}</p>;\n+}\n+\n+export const PrivacyPolicyScreen = ({\n+  appUrl,\n+  lastUpdated,\n+  company,\n+  contactEmail,\n+}: {\n+  appUrl: string;\n+  lastUpdated: string;\n+  company: string;\n+  contactEmail: string;\n+}) => {\n+  return (\n+    <div className=\"h-screen overflow-auto\">\n+      <div className=\"px-4\">\n+        {/* only show title on web since mobile has navigator title */}\n+        <H1>Privacy Policy</H1>\n+        <Paragraph>{company} PRIVACY POLICY</Paragraph>\n+        <Paragraph>\n+          {company} (the \"Company\") is committed to maintaining robust privacy\n+          protections for its users. Our Privacy Policy (\"Privacy Policy\") is\n+          designed to help you understand how we collect, use and safeguard the\n+          information you provide to us and to assist you in making informed\n+          decisions when using our Service.\n+        </Paragraph>\n+        <Paragraph>\n+          For purposes of this Agreement, \"Site\" refers to the Company's\n+          website, which can be accessed at {appUrl}.\n+        </Paragraph>\n+        <Paragraph>\n+          \"Service\" refers to the Company's services accessed via the Site, in\n+          which users can run AI-powered coding agents (such as Claude Code,\n+          Codex CLI, Gemini CLI, and others) in parallel across multiple tasks,\n+          with isolated development environments provided via containerized\n+          sandboxes. The terms \"we,\" \"us,\" and \"our\" refer to the Company.\n+          \"You\" refers to you, as a user of our Site or our Service. By\n+          accessing our Site or our Service, you accept our Privacy Policy and\n+          Terms of Use (found here: {appUrl}/terms-of-service), and you consent\n+          to our collection, storage, use and disclosure of your Personal\n+          Information as described in this Privacy Policy.\n+        </Paragraph>\n+        <Paragraph>I. INFORMATION WE COLLECT</Paragraph>\n+        <Paragraph>\n+          We collect \"Non-Personal Information\" and \"Personal Information.\"\n+          Non-Personal Information includes information that cannot be used to\n+          personally identify you, such as anonymous usage data, general\n+          demographic information we may collect, referring/exit pages and URLs,\n+          platform types, preferences you submit and preferences that are\n+          generated based on the data you submit and number of clicks. Personal\n+          Information includes your email address, name, and account\n+          information, which you submit to us through the registration process\n+          at the Site.\n+        </Paragraph>\n+        <Paragraph>1. Information collected via Technology</Paragraph>\n+        <Paragraph>\n+          To activate the Service you do not need to submit any Personal\n+          Information other than your email address. However, in an effort to\n+          improve the quality of the Service, we track information provided to\n+          us by your browser or by our software application when you view or use\n+          the Service, such as the website you came from (known as the\n+          \"referring URL\"), the type of browser you use, the device from which\n+          you connected to the Service, the time and date of access, and other\n+          information that does not personally identify you. We track this\n+          information using cookies and similar technologies. The Company may\n+          collect the following information via technology:\n+        </Paragraph>\n+        <Paragraph>- IP address and approximate location (city, country)</Paragraph>\n+        <Paragraph>- Operating system and browser information</Paragraph>\n+        <Paragraph>- Page views and click data</Paragraph>\n+        <Paragraph>- Session recordings and interaction data (via PostHog)</Paragraph>\n+        <Paragraph>- User ID and usage patterns</Paragraph>\n+        <Paragraph>\n+          The Company may use both persistent and session cookies; persistent\n+          cookies remain on your computer after you close your session and until\n+          you delete them, while session cookies expire when you close your\n+          browser.\n+        </Paragraph>\n+        <Paragraph>2. Information you provide by registering for an account</Paragraph>\n+        <Paragraph>\n+          In addition to the information provided automatically by your browser\n+          when you visit the Site, to become a subscriber to the Service you\n+          will need to create a personal profile. You can create a profile by\n+          registering with the Service using Google, GitHub, or Facebook OAuth,\n+          or by entering your email address and creating a password. By\n+          registering, you are authorizing us to collect, store and use your\n+          email address and account information in accordance with this Privacy\n+          Policy.\n+        </Paragraph>\n+        <Paragraph>3. Information related to your use of the Service</Paragraph>\n+        <Paragraph>\n+          When you use the Service, we may collect and process the following\n+          types of data:\n+        </Paragraph>\n+        <Paragraph>\n+          - Source code and files you provide to the AI coding agents\n+        </Paragraph>\n+        <Paragraph>\n+          - Prompts, instructions, and conversations with AI agents\n+        </Paragraph>\n+        <Paragraph>\n+          - Container and sandbox session data\n+        </Paragraph>\n+        <Paragraph>\n+          - API keys and credentials you configure for third-party services\n+          (stored securely and used only to facilitate your use of the Service)\n+        </Paragraph>\n+        <Paragraph>\n+          - Git repository information and code changes\n+        </Paragraph>\n+        <Paragraph>4. Children's Privacy</Paragraph>\n+        <Paragraph>\n+          The Site and the Service are not directed to anyone under the age of\n+          13. The Site does not knowingly collect or solicit information from\n+          anyone under the age of 13, or allow anyone under the age of 13 to\n+          sign up for the Service. In the event that we learn that we have\n+          gathered personal information from anyone under the age of 13 without\n+          the consent of a parent or guardian, we will delete that information\n+          as soon as possible. If you believe we have collected such\n+          information, please contact us at {contactEmail}.\n+        </Paragraph>\n+        <Paragraph>II. THIRD-PARTY SERVICES</Paragraph>\n+        <Paragraph>\n+          The Service integrates with and relies on various third-party services\n+          to provide its functionality. By using the Service, you acknowledge\n+          that your data may be processed by these third parties in accordance\n+          with their respective privacy policies:\n+        </Paragraph>\n+        <Paragraph>AI Service Providers:</Paragraph>\n+        <Paragraph>\n+          - Anthropic (Claude) - for AI coding assistance\n+        </Paragraph>\n+        <Paragraph>\n+          - OpenAI - for AI coding assistance\n+        </Paragraph>\n+        <Paragraph>\n+          - Google (Gemini) - for AI coding assistance\n+        </Paragraph>\n+        <Paragraph>\n+          - Other AI providers as made available through the Service\n+        </Paragraph>\n+        <Paragraph>\n+          When you use AI coding agents through our Service, your prompts, code,\n+          and related data may be sent to these providers. Please review each\n+          provider's privacy policy for details on how they handle your data.\n+        </Paragraph>\n+        <Paragraph>Sandbox and Infrastructure Providers:</Paragraph>\n+        <Paragraph>\n+          - Morph (morph.so) - containerized development environments\n+        </Paragraph>\n+        <Paragraph>\n+          - Freestyle (freestyle.sh) - containerized development environments\n+        </Paragraph>\n+        <Paragraph>\n+          - Amazon Web Services (AWS) - cloud infrastructure\n+        </Paragraph>\n+        <Paragraph>\n+          - Vercel - hosting and deployment\n+        </Paragraph>\n+        <Paragraph>\n+          - Convex (convex.dev) - database and backend services\n+        </Paragraph>\n+        <Paragraph>\n+          - Cloudflare - content delivery and security\n+        </Paragraph>\n+        <Paragraph>Analytics, Monitoring, and Session Recording:</Paragraph>\n+        <Paragraph>\n+          - PostHog - analytics, session replay, and heat mapping. PostHog may\n+          collect: IP address, city, country, email address, operating system,\n+          page views, clicks, usage data, and User ID.\n+        </Paragraph>\n+        <Paragraph>\n+          - Sentry - error tracking and performance monitoring. Sentry may\n+          collect: error logs, stack traces, device information, and usage data.\n+        </Paragraph>\n+        <Paragraph>Authentication Providers:</Paragraph>\n+        <Paragraph>\n+          - Google OAuth - for account authentication\n+        </Paragraph>\n+        <Paragraph>\n+          - GitHub OAuth - for account authentication\n+        </Paragraph>\n+        <Paragraph>\n+          - Facebook OAuth - for account authentication\n+        </Paragraph>\n+        <Paragraph>\n+          Each of these services has its own privacy policy governing the\n+          collection and use of your data. We encourage you to review the\n+          privacy policies of these third-party services.\n+        </Paragraph>\n+        <Paragraph>III. HOW WE USE AND SHARE INFORMATION</Paragraph>\n+        <Paragraph>\n+          Personal Information: Except as otherwise stated in this Privacy\n+          Policy, we do not sell, trade, rent or otherwise share for marketing\n+          purposes your Personal Information with third parties without your\n+          consent. We do share Personal Information with vendors who are\n+          performing services for the Company, such as the servers for our email\n+          communications who are provided access to user’s email address for\n+          purposes of sending emails from us. Those vendors use your Personal\n+          Information only at our direction and in accordance with our Privacy\n+          Policy. In general, the Personal Information you provide to us is used\n+          to help us communicate with you. For example, we use Personal\n+          Information to contact users in response to questions, solicit\n+          feedback from users, provide technical support, and inform users about\n+          promotional offers. We may share Personal Information with outside\n+          parties if we have a good-faith belief that access, use, preservation\n+          or disclosure of the information is reasonably necessary to meet any\n+          applicable legal process or enforceable governmental request; to\n+          enforce applicable Terms of Service, including investigation of\n+          potential violations; address fraud, security or technical concerns;\n+          or to protect against harm to the rights, property, or safety of our\n+          users or the public as required or permitted by law.\n+        </Paragraph>\n+        <Paragraph>Non-Personal Information</Paragraph>\n+        <Paragraph>\n+          In general, we use Non-Personal Information to help us improve the\n+          Service and customize the user experience. We also aggregate\n+          Non-Personal Information in order to track trends and analyze use\n+          patterns on the Site. This Privacy Policy does not limit in any way\n+          our use or disclosure of Non-Personal Information and we reserve the\n+          right to use and disclose such Non-Personal Information to our\n+          partners, advertisers and other third parties at our discretion. In\n+          the event we undergo a business transaction such as a merger,\n+          acquisition by another company, or sale of all or a portion of our\n+          assets, your Personal Information may be among the assets transferred.\n+          You acknowledge and consent that such transfers may occur and are\n+          permitted by this Privacy Policy, and that any acquirer of our assets\n+          may continue to process your Personal Information as set forth in this\n+          Privacy Policy. If our information practices change at any time in the\n+          future, we will post the policy changes to the Site so that you may\n+          opt out of the new information practices. We suggest that you check\n+          the Site periodically if you are concerned about how your information\n+          is used.\n+        </Paragraph>\n+        <Paragraph>IV. HOW WE PROTECT INFORMATION</Paragraph>\n+        <Paragraph>\n+          We implement security measures designed to protect your information\n+          from unauthorized access. Your account is protected by your account\n+          password and we urge you to take steps to keep your personal\n+          information safe by not disclosing your password and by logging out of\n+          your account after each use. We further protect your information from\n+          potential security breaches by implementing certain technological\n+          security measures including encryption, firewalls and secure socket\n+          layer technology. However, these measures do not guarantee that your\n+          information will not be accessed, disclosed, altered or destroyed by\n+          breach of such firewalls and secure server software. By using our\n+          Service, you acknowledge that you understand and agree to assume these\n+          risks.\n+        </Paragraph>\n+        <Paragraph>\n+          V. YOUR RIGHTS REGARDING THE USE OF YOUR PERSONAL INFORMATION\n+        </Paragraph>\n+        <Paragraph>\n+          You have the right at any time to prevent us from contacting you for\n+          marketing purposes. When we send a promotional communication to a\n+          user, the user can opt out of further promotional communications by\n+          following the unsubscribe instructions provided in each promotional\n+          e-mail. You can also indicate that you do not wish to receive\n+          marketing communications from us in the Settings section of the Site.\n+          Please note that notwithstanding the promotional preferences you\n+          indicate by either unsubscribing or opting out in the Settings section\n+          of the Site, we may continue to send you administrative emails\n+          including, for example, periodic updates to our Privacy Policy.\n+        </Paragraph>\n+        <Paragraph>\n+          Depending on your location, you may have additional rights under\n+          applicable data protection laws (such as GDPR or CCPA), including:\n+        </Paragraph>\n+        <Paragraph>\n+          - Right to Access: You may request a copy of the personal data we hold\n+          about you.\n+        </Paragraph>\n+        <Paragraph>\n+          - Right to Rectification: You may request that we correct any\n+          inaccurate or incomplete personal data.\n+        </Paragraph>\n+        <Paragraph>\n+          - Right to Erasure: You may request that we delete your personal data,\n+          subject to certain exceptions.\n+        </Paragraph>\n+        <Paragraph>\n+          - Right to Data Portability: You may request a copy of your data in a\n+          structured, commonly used, machine-readable format.\n+        </Paragraph>\n+        <Paragraph>\n+          - Right to Restrict Processing: You may request that we limit the\n+          processing of your personal data in certain circumstances.\n+        </Paragraph>\n+        <Paragraph>\n+          - Right to Object: You may object to the processing of your personal\n+          data for certain purposes.\n+        </Paragraph>\n+        <Paragraph>\n+          To exercise any of these rights, please contact us at {contactEmail}.\n+          We will respond to your request within the timeframe required by\n+          applicable law.\n+        </Paragraph>\n+        <Paragraph>VI. LINKS TO OTHER WEBSITES</Paragraph>\n+        <Paragraph>\n+          As part of the Service, we may provide links to or compatibility with\n+          other websites or applications. However, we are not responsible for\n+          the privacy practices employed by those websites or the information or\n+          content they contain. This Privacy Policy applies solely to\n+          information collected by us through the Site and the Service.\n+          Therefore, this Privacy Policy does not apply to your use of a third\n+          party website accessed by selecting a link on our Site or via our\n+          Service. To the extent that you access or use the Service through or\n+          on another website or application, then the privacy policy of that\n+          other website or application will apply to your access or use of that\n+          site or application. We encourage our users to read the privacy\n+          statements of other websites before proceeding to use them.\n+        </Paragraph>\n+        <Paragraph>VII. CHANGES TO OUR PRIVACY POLICY</Paragraph>\n+        <Paragraph>\n+          The Company reserves the right to change this policy and our Terms of\n+          Service at any time. We will notify you of significant changes to our\n+          Privacy Policy by sending a notice to the primary email address\n+          specified in your account or by placing a prominent notice on our\n+          site. Significant changes will go into effect 30 days following such\n+          notification. Non-material changes or clarifications will take effect\n+          immediately. You should periodically check the Site and this privacy\n+          page for updates.\n+        </Paragraph>\n+        <Paragraph>VIII. CONTACT US</Paragraph>\n+        <Paragraph>\n+          If you have any questions regarding this Privacy Policy or the\n+          practices of this Site, please contact us by sending an email to\n+          {contactEmail}. Last Updated: This Privacy Policy was last updated on{\" \"}\n+          {lastUpdated}.\n+        </Paragraph>\n+        <Paragraph>IX. DATA RETENTION</Paragraph>\n+        <Paragraph>\n+          We retain your personal information for as long as your account is\n+          active or as needed to provide you with the Service. We may also\n+          retain and use your information as necessary to comply with legal\n+          obligations, resolve disputes, and enforce our agreements.\n+        </Paragraph>\n+        <Paragraph>\n+          Container and sandbox session data is typically deleted shortly after\n+          your session ends. Code and files processed by AI agents are not\n+          retained by us beyond the immediate processing required, though\n+          third-party AI providers may have their own retention policies.\n+        </Paragraph>\n+        <Paragraph>\n+          You may request deletion of your account and associated data at any\n+          time by contacting us at {contactEmail}.\n+        </Paragraph>\n+      </div>\n+    </div>\n+  );\n+};\n+\n+export const TermsOfServiceScreen = ({\n+  appUrl,\n+  company,\n+  contactEmail,\n+}: {\n+  appUrl: string;\n+  company: string;\n+  contactEmail: string;\n+}) => {\n+  return (\n+    <div className=\"h-screen overflow-auto\">\n+      <div className=\"px-4\">\n+        {/* only show title on web since mobile has navigator title */}\n+        <H1>Terms of Service</H1>\n+\n+        <Paragraph>Version 1.0</Paragraph>\n+\n+        <Paragraph>Last revised on: 12/2, 2025</Paragraph>\n+\n+        <Paragraph>\n+          The website located at {appUrl} (the “Site”) is a copyrighted work\n+          belonging to {company} (“Company”, “us”, “our”, and “we”). Certain\n+          features of the Site may be subject to additional guidelines, terms,\n+          or rules, which will be posted on the Site in connection with such\n+          features. All such additional terms, guidelines, and rules are\n+          incorporated by reference into these Terms.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          These Terms of Use (these “Terms”) set forth the legally binding terms\n+          and conditions that govern your use of the Site. By accessing or using\n+          the Site, you are accepting these Terms (on behalf of yourself or the\n+          entity that you represent), and you represent and warrant that you\n+          have the right, authority, and capacity to enter into these Terms (on\n+          behalf of yourself or the entity that you represent). you may not\n+          access or use the Site or accept the Terms if you are not at least 18\n+          years old. If you do not agree with all of the provisions of these\n+          Terms, do not access and/or use the Site.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          PLEASE BE AWARE THAT SECTION 10.2 CONTAINS PROVISIONS GOVERNING HOW TO\n+          RESOLVE DISPUTES BETWEEN YOU AND COMPANY. AMONG OTHER THINGS, SECTION\n+          10.2 INCLUDES AN AGREEMENT TO ARBITRATE WHICH REQUIRES, WITH LIMITED\n+          EXCEPTIONS, THAT ALL DISPUTES BETWEEN YOU AND US SHALL BE RESOLVED BY\n+          BINDING AND FINAL ARBITRATION. SECTION 10.2 ALSO CONTAINS A CLASS\n+          ACTION AND JURY TRIAL WAIVER. PLEASE READ SECTION 10.2 CAREFULLY.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          UNLESS YOU OPT OUT OF THE AGREEMENT TO ARBITRATE WITHIN 30 DAYS: (1)\n+          YOU WILL ONLY BE PERMITTED TO PURSUE DISPUTES OR CLAIMS AND SEEK\n+          RELIEF AGAINST US ON AN INDIVIDUAL BASIS, NOT AS A PLAINTIFF OR CLASS\n+          MEMBER IN ANY CLASS OR REPRESENTATIVE ACTION OR PROCEEDING AND YOU\n+          WAIVE YOUR RIGHT TO PARTICIPATE IN A CLASS ACTION LAWSUIT OR\n+          CLASS-WIDE ARBITRATION; AND (2) YOU ARE WAIVING YOUR RIGHT TO PURSUE\n+          DISPUTES OR CLAIMS AND SEEK RELIEF IN A COURT OF LAW AND TO HAVE A\n+          JURY TRIAL.\n+        </Paragraph>\n+\n+        <Paragraph>Accounts</Paragraph>\n+\n+        <Paragraph>\n+          Account Creation. In order to use certain features of the Site, you\n+          must register for an account (“Account”) and provide certain\n+          information about yourself as prompted by the account registration\n+          form. You represent and warrant that: (a) all required registration\n+          information you submit is truthful and accurate; (b) you will maintain\n+          the accuracy of such information. You may delete your Account at any\n+          time, for any reason, by following the instructions on the Site.\n+          Company may suspend or terminate your Account in accordance with\n+          Section 8.{\" \"}\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Account Responsibilities. You are responsible for maintaining the\n+          confidentiality of your Account login information and are fully\n+          responsible for all activities that occur under your Account. You\n+          agree to immediately notify Company of any unauthorized use, or\n+          suspected unauthorized use of your Account or any other breach of\n+          security. Company cannot and will not be liable for any loss or damage\n+          arising from your failure to comply with the above requirements.\n+        </Paragraph>\n+\n+        <Paragraph>Access to the Site </Paragraph>\n+\n+        <Paragraph>\n+          License. Subject to these Terms, Company grants you a\n+          non-transferable, non-exclusive, revocable, limited license to use and\n+          access the Site for your personal or internal business purposes,\n+          including commercial use in connection with your software development\n+          activities.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Certain Restrictions. The rights granted to you in these Terms are\n+          subject to the following restrictions: (a) you shall not license,\n+          sell, rent, lease, transfer, assign, distribute, host, or otherwise\n+          commercially exploit the Site, whether in whole or in part, or any\n+          content displayed on the Site; (b) you shall not modify, make\n+          derivative works of, disassemble, reverse compile or reverse engineer\n+          any part of the Site; (c) you shall not access the Site in order to\n+          build a similar or competitive website, product, or service; and (d)\n+          except as expressly stated herein, no part of the Site may be copied,\n+          reproduced, distributed, republished, downloaded, displayed, posted or\n+          transmitted in any form or by any means. Unless otherwise indicated,\n+          any future release, update, or other addition to functionality of the\n+          Site shall be subject to these Terms. All copyright and other\n+          proprietary notices on the Site (or on any content displayed on the\n+          Site) must be retained on all copies thereof.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Modification. Company reserves the right, at any time, to modify,\n+          suspend, or discontinue the Site (in whole or in part) with or without\n+          notice to you. You agree that Company will not be liable to you or to\n+          any third party for any modification, suspension, or discontinuation\n+          of the Site or any part thereof.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          No Support or Maintenance. You acknowledge and agree that Company will\n+          have no obligation to provide you with any support or maintenance in\n+          connection with the Site.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Ownership. Excluding any User Content that you may provide (defined\n+          below), you acknowledge that all the intellectual property rights,\n+          including copyrights, patents, trade marks, and trade secrets, in the\n+          Site and its content are owned by Company or Company’s suppliers.\n+          Neither these Terms (nor your access to the Site) transfers to you or\n+          any third party any rights, title or interest in or to such\n+          intellectual property rights, except for the limited access rights\n+          expressly set forth in Section 2.1. Company and its suppliers reserve\n+          all rights not granted in these Terms. There are no implied licenses\n+          granted under these Terms.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Feedback. If you provide Company with any feedback or suggestions\n+          regarding the Site (“Feedback”), you hereby assign to Company all\n+          rights in such Feedback and agree that Company shall have the right to\n+          use and fully exploit such Feedback and related information in any\n+          manner it deems appropriate. Company will treat any Feedback you\n+          provide to Company as non-confidential and non-proprietary. You agree\n+          that you will not submit to Company any information or ideas that you\n+          consider to be confidential or proprietary.\n+        </Paragraph>\n+\n+        <Paragraph>User Content</Paragraph>\n+\n+        <Paragraph>\n+          User Content. “User Content” means any and all information and content\n+          that a user submits to, or uses with, the Site (e.g., content in the\n+          user’s profile or postings). You are solely responsible for your User\n+          Content. You assume all risks associated with use of your User\n+          Content, including any reliance on its accuracy, completeness or\n+          usefulness by others, or any disclosure of your User Content that\n+          personally identifies you or any third party. You hereby represent and\n+          warrant that your User Content does not violate our Acceptable Use\n+          Policy (defined in Section 3.3). You may not represent or imply to\n+          others that your User Content is in any way provided, sponsored or\n+          endorsed by Company. Since you alone are responsible for your User\n+          Content, you may expose yourself to liability if, for example, your\n+          User Content violates the Acceptable Use Policy. Company is not\n+          obligated to backup any User Content, and your User Content may be\n+          deleted at any time without prior notice. You are solely responsible\n+          for creating and maintaining your own backup copies of your User\n+          Content if you desire.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          License. You hereby grant (and you represent and warrant that you have\n+          the right to grant) to Company an irrevocable, nonexclusive,\n+          royalty-free and fully paid, worldwide license to reproduce,\n+          distribute, publicly display and perform, prepare derivative works of,\n+          incorporate into other works, and otherwise use and exploit your User\n+          Content, and to grant sublicenses of the foregoing rights, solely for\n+          the purposes of including your User Content in the Site. You hereby\n+          irrevocably waive (and agree to cause to be waived) any claims and\n+          assertions of moral rights or attribution with respect to your User\n+          Content.\n+        </Paragraph>\n+\n+        <Paragraph>AI Services and Generated Content</Paragraph>\n+\n+        <Paragraph>\n+          The Service provides access to AI-powered coding agents from various\n+          third-party providers including Anthropic (Claude), OpenAI, Google\n+          (Gemini), and others. By using these AI features, you acknowledge and\n+          agree to the following:\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Third-Party AI Terms. Your use of AI coding agents is subject to the\n+          terms and conditions of the respective AI providers. You are\n+          responsible for reviewing and complying with these third-party terms.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Ownership of AI Output. You retain ownership of any code or content\n+          you create using AI assistance through the Service, subject to any\n+          applicable third-party AI provider terms. Company does not claim\n+          ownership of AI-generated output created at your direction.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          AI Accuracy Disclaimer. AI-generated code and suggestions may contain\n+          errors, security vulnerabilities, or inaccuracies. You are solely\n+          responsible for reviewing, testing, and validating any AI-generated\n+          code before use. Company makes no warranties regarding the accuracy,\n+          reliability, security, or fitness for purpose of AI-generated content.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Data Sharing with AI Providers. When you use AI coding agents, your\n+          prompts, code, and related data may be transmitted to third-party AI\n+          providers. Please review our Privacy Policy and each provider's\n+          privacy policy for details.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Acceptable Use Policy. The following terms constitute our \"Acceptable\n+          Use Policy\":\n+        </Paragraph>\n+\n+        <Paragraph>\n+          You agree not to use the Site to collect, upload, transmit, display,\n+          or distribute any User Content (i) that violates any third-party\n+          right, including any copyright, trademark, patent, trade secret, moral\n+          right, privacy right, right of publicity, or any other intellectual\n+          property or proprietary right, (ii) that is unlawful, harassing,\n+          abusive, tortious, threatening, harmful, invasive of another’s\n+          privacy, vulgar, defamatory, false, intentionally misleading, trade\n+          libelous, pornographic, obscene, patently offensive, promotes racism,\n+          bigotry, hatred, or physical harm of any kind against any group or\n+          individual or is otherwise objectionable, (iii) that is harmful to\n+          minors in any way, or (iv) that is in violation of any law,\n+          regulation, or obligations or restrictions imposed by any third party.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          In addition, you agree not to: (i) upload, transmit, or distribute to\n+          or through the Site any computer viruses, worms, or any software\n+          intended to damage or alter a computer system or data; (ii) send\n+          through the Site unsolicited or unauthorized advertising, promotional\n+          materials, junk mail, spam, chain letters, pyramid schemes, or any\n+          other form of duplicative or unsolicited messages, whether commercial\n+          or otherwise; (iii) use the Site to harvest, collect, gather or\n+          assemble information or data regarding other users, including e-mail\n+          addresses, without their consent; (iv) interfere with, disrupt, or\n+          create an undue burden on servers or networks connected to the Site,\n+          or violate the regulations, policies or procedures of such networks;\n+          (v) attempt to gain unauthorized access to the Site (or to other\n+          computer systems or networks connected to or used together with the\n+          Site), whether through password mining or any other means; (vi) harass\n+          or interfere with any other user’s use and enjoyment of the Site; or\n+          (vi) use software or automated agents or scripts to produce multiple\n+          accounts on the Site, or to generate automated searches, requests, or\n+          queries to (or to strip, scrape, or mine data from) the Site\n+          (provided, however, that we conditionally grant to the operators of\n+          public search engines revocable permission to use spiders to copy\n+          materials from the Site for the sole purpose of and solely to the\n+          extent necessary for creating publicly available searchable indices of\n+          the materials, but not caches or archives of such materials, subject\n+          to the parameters set forth in our robots.txt file).\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Enforcement. We reserve the right (but have no obligation) to review,\n+          refuse and/or remove any User Content in our sole discretion, and to\n+          investigate and/or take appropriate action against you in our sole\n+          discretion if you violate the Acceptable Use Policy or any other\n+          provision of these Terms or otherwise create liability for us or any\n+          other person. Such action may include removing or modifying your User\n+          Content, terminating your Account in accordance with Section 8, and/or\n+          reporting you to law enforcement authorities.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Indemnification. You agree to indemnify and hold Company (and its\n+          officers, employees, and agents) harmless, including costs and\n+          attorneys’ fees, from any claim or demand made by any third party due\n+          to or arising out of (a) your use of the Site, (b) your violation of\n+          these Terms, (c) your violation of applicable laws or regulations or\n+          (d) your User Content. Company reserves the right, at your expense, to\n+          assume the exclusive defense and control of any matter for which you\n+          are required to indemnify us, and you agree to cooperate with our\n+          defense of these claims. You agree not to settle any matter without\n+          the prior written consent of Company. Company will use reasonable\n+          efforts to notify you of any such claim, action or proceeding upon\n+          becoming aware of it.\n+        </Paragraph>\n+\n+        <Paragraph>Third-Party Links & Ads; Other Users</Paragraph>\n+\n+        <Paragraph>\n+          Third-Party Links & Ads. The Site may contain links to third-party\n+          websites and services, and/or display advertisements for third parties\n+          (collectively, “Third-Party Links & Ads”). Such Third-Party Links &\n+          Ads are not under the control of Company, and Company is not\n+          responsible for any Third-Party Links & Ads. Company provides access\n+          to these Third-Party Links & Ads only as a convenience to you, and\n+          does not review, approve, monitor, endorse, warrant, or make any\n+          representations with respect to Third-Party Links & Ads. You use all\n+          Third-Party Links & Ads at your own risk, and should apply a suitable\n+          level of caution and discretion in doing so. When you click on any of\n+          the Third-Party Links & Ads, the applicable third party’s terms and\n+          policies apply, including the third party’s privacy and data gathering\n+          practices. You should make whatever investigation you feel necessary\n+          or appropriate before proceeding with any transaction in connection\n+          with such Third-Party Links & Ads.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Other Users. Each Site user is solely responsible for any and all of\n+          its own User Content. Since we do not control User Content, you\n+          acknowledge and agree that we are not responsible for any User\n+          Content, whether provided by you or by others. We make no guarantees\n+          regarding the accuracy, currency, suitability, appropriateness, or\n+          quality of any User Content. Your interactions with other Site users\n+          are solely between you and such users. You agree that Company will not\n+          be responsible for any loss or damage incurred as the result of any\n+          such interactions. If there is a dispute between you and any Site\n+          user, we are under no obligation to become involved.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Release. You hereby release and forever discharge Company (and our\n+          officers, employees, agents, successors, and assigns) from, and hereby\n+          waive and relinquish, each and every past, present and future dispute,\n+          claim, controversy, demand, right, obligation, liability, action and\n+          cause of action of every kind and nature (including personal injuries,\n+          death, and property damage), that has arisen or arises directly or\n+          indirectly out of, or that relates directly or indirectly to, the Site\n+          (including any interactions with, or act or omission of, other Site\n+          users or any Third-Party Links & Ads). IF YOU ARE A CALIFORNIA\n+          RESIDENT, YOU HEREBY WAIVE CALIFORNIA CIVIL CODE SECTION 1542 IN\n+          CONNECTION WITH THE FOREGOING, WHICH STATES: “A GENERAL RELEASE DOES\n+          NOT EXTEND TO CLAIMS WHICH THE CREDITOR OR RELEASING PARTY DOES NOT\n+          KNOW OR SUSPECT TO EXIST IN HIS OR HER FAVOR AT THE TIME OF EXECUTING\n+          THE RELEASE, WHICH IF KNOWN BY HIM OR HER MUST HAVE MATERIALLY\n+          AFFECTED HIS OR HER SETTLEMENT WITH THE DEBTOR OR RELEASED PARTY.”\n+        </Paragraph>\n+\n+        <Paragraph>Subscription and Billing</Paragraph>\n+\n+        <Paragraph>\n+          Free and Paid Tiers. The Service offers both free and paid\n+          subscription tiers. Free tier users have access to limited features\n+          and usage quotas. Paid subscriptions provide additional features,\n+          higher usage limits, and priority support as described on our pricing\n+          page.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Billing. If you subscribe to a paid tier, you agree to pay all\n+          applicable fees. Fees are billed in advance on a monthly or annual\n+          basis depending on your selected plan. All fees are non-refundable\n+          except as required by law or as explicitly stated in these Terms.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Automatic Renewal. Paid subscriptions automatically renew at the end\n+          of each billing period unless you cancel before the renewal date. You\n+          may cancel your subscription at any time through your account\n+          settings.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Price Changes. Company reserves the right to modify pricing at any\n+          time. Price changes will be communicated to you in advance and will\n+          take effect at the start of your next billing period.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Usage Limits. Both free and paid tiers are subject to fair use limits\n+          on compute resources, API calls, storage, and other service\n+          capabilities. Exceeding these limits may result in throttling,\n+          suspension, or requirement to upgrade to a higher tier.\n+        </Paragraph>\n+\n+        <Paragraph>Disclaimers </Paragraph>\n+\n+        <Paragraph>\n+          THE SITE IS PROVIDED ON AN \"AS-IS\" AND \"AS AVAILABLE\" BASIS, AND\n+          COMPANY (AND OUR SUPPLIERS) EXPRESSLY DISCLAIM ANY AND ALL WARRANTIES\n+          AND CONDITIONS OF ANY KIND, WHETHER EXPRESS, IMPLIED, OR STATUTORY,\n+          INCLUDING ALL WARRANTIES OR CONDITIONS OF MERCHANTABILITY, FITNESS FOR\n+          A PARTICULAR PURPOSE, TITLE, QUIET ENJOYMENT, ACCURACY, OR\n+          NON-INFRINGEMENT. WE (AND OUR SUPPLIERS) MAKE NO WARRANTY THAT THE\n+          SITE WILL MEET YOUR REQUIREMENTS, WILL BE AVAILABLE ON AN\n+          UNINTERRUPTED, TIMELY, SECURE, OR ERROR-FREE BASIS, OR WILL BE\n+          ACCURATE, RELIABLE, FREE OF VIRUSES OR OTHER HARMFUL CODE, COMPLETE,\n+          LEGAL, OR SAFE. IF APPLICABLE LAW REQUIRES ANY WARRANTIES WITH RESPECT\n+          TO THE SITE, ALL SUCH WARRANTIES ARE LIMITED IN DURATION TO 90 DAYS\n+          FROM THE DATE OF FIRST USE.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          SOME JURISDICTIONS DO NOT ALLOW THE EXCLUSION OF IMPLIED WARRANTIES,\n+          SO THE ABOVE EXCLUSION MAY NOT APPLY TO YOU. SOME JURISDICTIONS DO NOT\n+          ALLOW LIMITATIONS ON HOW LONG AN IMPLIED WARRANTY LASTS, SO THE ABOVE\n+          LIMITATION MAY NOT APPLY TO YOU.\n+        </Paragraph>\n+\n+        <Paragraph>Limitation on Liability</Paragraph>\n+\n+        <Paragraph>\n+          TO THE MAXIMUM EXTENT PERMITTED BY LAW, IN NO EVENT SHALL COMPANY (OR\n+          OUR SUPPLIERS) BE LIABLE TO YOU OR ANY THIRD PARTY FOR ANY LOST\n+          PROFITS, LOST DATA, COSTS OF PROCUREMENT OF SUBSTITUTE PRODUCTS, OR\n+          ANY INDIRECT, CONSEQUENTIAL, EXEMPLARY, INCIDENTAL, SPECIAL OR\n+          PUNITIVE DAMAGES ARISING FROM OR RELATING TO THESE TERMS OR YOUR USE\n+          OF, OR INABILITY TO USE, THE SITE, EVEN IF COMPANY HAS BEEN ADVISED OF\n+          THE POSSIBILITY OF SUCH DAMAGES. ACCESS TO, AND USE OF, THE SITE IS AT\n+          YOUR OWN DISCRETION AND RISK, AND YOU WILL BE SOLELY RESPONSIBLE FOR\n+          ANY DAMAGE TO YOUR DEVICE OR COMPUTER SYSTEM, OR LOSS OF DATA\n+          RESULTING THEREFROM.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          TO THE MAXIMUM EXTENT PERMITTED BY LAW, NOTWITHSTANDING ANYTHING TO\n+          THE CONTRARY CONTAINED HEREIN, OUR LIABILITY TO YOU FOR ANY DAMAGES\n+          ARISING FROM OR RELATED TO THESE TERMS (FOR ANY CAUSE WHATSOEVER AND\n+          REGARDLESS OF THE FORM OF THE ACTION), WILL AT ALL TIMES BE LIMITED TO\n+          A MAXIMUM OF FIFTY US DOLLARS. THE EXISTENCE OF MORE THAN ONE CLAIM\n+          WILL NOT ENLARGE THIS LIMIT. YOU AGREE THAT OUR SUPPLIERS WILL HAVE NO\n+          LIABILITY OF ANY KIND ARISING FROM OR RELATING TO THESE TERMS.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          SOME JURISDICTIONS DO NOT ALLOW THE LIMITATION OR EXCLUSION OF\n+          LIABILITY FOR INCIDENTAL OR CONSEQUENTIAL DAMAGES, SO THE ABOVE\n+          LIMITATION OR EXCLUSION MAY NOT APPLY TO YOU.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Term and Termination. Subject to this Section, these Terms will remain\n+          in full force and effect while you use the Site. We may suspend or\n+          terminate your rights to use the Site (including your Account) at any\n+          time for any reason at our sole discretion, including for any use of\n+          the Site in violation of these Terms. Upon termination of your rights\n+          under these Terms, your Account and right to access and use the Site\n+          will terminate immediately. You understand that any termination of\n+          your Account may involve deletion of your User Content associated with\n+          your Account from our live databases. Company will not have any\n+          liability whatsoever to you for any termination of your rights under\n+          these Terms, including for termination of your Account or deletion of\n+          your User Content. Even after your rights under these Terms are\n+          terminated, the following provisions of these Terms will remain in\n+          effect: Sections 2.2 through 2.6, Section 3 and Sections 4 through 10.\n+        </Paragraph>\n+\n+        <Paragraph>Copyright Policy. </Paragraph>\n+\n+        <Paragraph>\n+          Company respects the intellectual property of others and asks that\n+          users of our Site do the same. In connection with our Site, we have\n+          adopted and implemented a policy respecting copyright law that\n+          provides for the removal of any infringing materials and for the\n+          termination, in appropriate circumstances, of users of our online Site\n+          who are repeat infringers of intellectual property rights, including\n+          copyrights. If you believe that one of our users is, through the use\n+          of our Site, unlawfully infringing the copyright(s) in a work, and\n+          wish to have the allegedly infringing material removed, the following\n+          information in the form of a written notification (pursuant to 17\n+          U.S.C. § 512(c)) must be provided to our designated Copyright Agent:\n+        </Paragraph>\n+\n+        <Paragraph>your physical or electronic signature;</Paragraph>\n+\n+        <Paragraph>\n+          identification of the copyrighted work(s) that you claim to have been\n+          infringed;\n+        </Paragraph>\n+\n+        <Paragraph>\n+          identification of the material on our services that you claim is\n+          infringing and that you request us to remove;\n+        </Paragraph>\n+\n+        <Paragraph>\n+          sufficient information to permit us to locate such material;\n+        </Paragraph>\n+\n+        <Paragraph>\n+          your address, telephone number, and e-mail address;\n+        </Paragraph>\n+\n+        <Paragraph>\n+          a statement that you have a good faith belief that use of the\n+          objectionable material is not authorized by the copyright owner, its\n+          agent, or under the law; and\n+        </Paragraph>\n+\n+        <Paragraph>\n+          a statement that the information in the notification is accurate, and\n+          under penalty of perjury, that you are either the owner of the\n+          copyright that has allegedly been infringed or that you are authorized\n+          to act on behalf of the copyright owner.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Please note that, pursuant to 17 U.S.C. § 512(f), any\n+          misrepresentation of material fact (falsities) in a written\n+          notification automatically subjects the complaining party to liability\n+          for any damages, costs and attorney’s fees incurred by us in\n+          connection with the written notification and allegation of copyright\n+          infringement.\n+        </Paragraph>\n+        {/* \n+      <Paragraph>\n+        *Please fill in the following fields once you have registered with the Copyright Office and\n+        delete the yellow highlighted text:*\n+      </Paragraph>\n+\n+      <Paragraph>The designated Copyright Agent for Company is: _________ </Paragraph>\n+\n+      <Paragraph>Designated Agent: _________</Paragraph>\n+\n+      <Paragraph>Address of Agent: _________</Paragraph>\n+\n+      <Paragraph>Telephone: _________</Paragraph>\n+\n+      <Paragraph>Fax: _________</Paragraph>\n+\n+      <Paragraph>Email: _________</Paragraph>\n+\n+      <Paragraph> </Paragraph> */}\n+\n+        <Paragraph>General</Paragraph>\n+\n+        <Paragraph>\n+          Changes. These Terms are subject to occasional revision, and if we\n+          make any substantial changes, we may notify you by sending you an\n+          e-mail to the last e-mail address you provided to us (if any), and/or\n+          by prominently posting notice of the changes on our Site. You are\n+          responsible for providing us with your most current e-mail address. In\n+          the event that the last e-mail address that you have provided us is\n+          not valid, or for any reason is not capable of delivering to you the\n+          notice described above, our dispatch of the e-mail containing such\n+          notice will nonetheless constitute effective notice of the changes\n+          described in the notice. Continued use of our Site following notice of\n+          such changes shall indicate your acknowledgement of such changes and\n+          agreement to be bound by the terms and conditions of such changes.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Dispute Resolution. Please read the following arbitration agreement in\n+          this Section (the “Arbitration Agreement”) carefully. It requires you\n+          to arbitrate disputes with Company, its parent companies,\n+          subsidiaries, affiliates, successors and assigns and all of their\n+          respective officers, directors, employees, agents, and representatives\n+          (collectively, the “Company Parties”) and limits the manner in which\n+          you can seek relief from the Company Parties.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Applicability of Arbitration Agreement. You agree that any dispute\n+          between you and any of the Company Parties relating in any way to the\n+          Site, the services offered on the Site (the “Services”) or these Terms\n+          will be resolved by binding arbitration, rather than in court, except\n+          that (1) you and the Company Parties may assert individualized claims\n+          in small claims court if the claims qualify, remain in such court and\n+          advance solely on an individual, non-class basis; and (2) you or the\n+          Company Parties may seek equitable relief in court for infringement or\n+          other misuse of intellectual property rights (such as trademarks,\n+          trade dress, domain names, trade secrets, copyrights, and\n+          patents).This Arbitration Agreement shall survive the expiration or\n+          termination of these Terms and shall apply, without limitation, to all\n+          claims that arose or were asserted before you agreed to these Terms\n+          (in accordance with the preamble) or any prior version of these\n+          Terms.This Arbitration Agreement does not preclude you from bringing\n+          issues to the attention of federal, state or local agencies. Such\n+          agencies can, if the law allows, seek relief against the Company\n+          Parties on your behalf. For purposes of this Arbitration Agreement,\n+          “Dispute” will also include disputes that arose or involve facts\n+          occurring before the existence of this or any prior versions of the\n+          Agreement as well as claims that may arise after the termination of\n+          these Terms.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Informal Dispute Resolution. There might be instances when a Dispute\n+          arises between you and Company. If that occurs, Company is committed\n+          to working with you to reach a reasonable resolution. You and Company\n+          agree that good faith informal efforts to resolve Disputes can result\n+          in a prompt, low‐cost and mutually beneficial outcome. You and Company\n+          therefore agree that before either party commences arbitration against\n+          the other (or initiates an action in small claims court if a party so\n+          elects), we will personally meet and confer telephonically or via\n+          videoconference, in a good faith effort to resolve informally any\n+          Dispute covered by this Arbitration Agreement (“Informal Dispute\n+          Resolution Conference”). If you are represented by counsel, your\n+          counsel may participate in the conference, but you will also\n+          participate in the conference.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          The party initiating a Dispute must give notice to the other party in\n+          writing of its intent to initiate an Informal Dispute Resolution\n+          Conference (“Notice”), which shall occur within 45 days after the\n+          other party receives such Notice, unless an extension is mutually\n+          agreed upon by the parties. Notice to Company that you intend to\n+          initiate an Informal Dispute Resolution Conference should be sent by\n+          email to:\n+          {contactEmail}, or by regular mail to 9 Tamizar, Irvine, California\n+          92620. The Notice must include: (1) your name, telephone number,\n+          mailing address, e‐mail address associated with your account (if you\n+          have one); (2) the name, telephone number, mailing address and e‐mail\n+          address of your counsel, if any; and (3) a description of your\n+          Dispute.{\" \"}\n+        </Paragraph>\n+\n+        <Paragraph>\n+          The Informal Dispute Resolution Conference shall be individualized\n+          such that a separate conference must be held each time either party\n+          initiates a Dispute, even if the same law firm or group of law firms\n+          represents multiple users in similar cases, unless all parties agree;\n+          multiple individuals initiating a Dispute cannot participate in the\n+          same Informal Dispute Resolution Conference unless all parties agree.\n+          In the time between a party receiving the Notice and the Informal\n+          Dispute Resolution Conference, nothing in this Arbitration Agreement\n+          shall prohibit the parties from engaging in informal communications to\n+          resolve the initiating party’s Dispute. Engaging in the Informal\n+          Dispute Resolution Conference is a condition precedent and requirement\n+          that must be fulfilled before commencing arbitration. The statute of\n+          limitations and any filing fee deadlines shall be tolled while the\n+          parties engage in the Informal Dispute Resolution Conference process\n+          required by this section.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          {\" \"}\n+          Arbitration Rules and Forum.These Terms evidence a transaction\n+          involving interstate commerce; and notwithstanding any other provision\n+          herein with respect to the applicable substantive law, the Federal\n+          Arbitration Act, 9 U.S.C. § 1 et seq., will govern the interpretation\n+          and enforcement of this Arbitration Agreement and any arbitration\n+          proceedings. If the Informal Dispute Resolution Process described\n+          above does not resolve satisfactorily within 60 days after receipt of\n+          your Notice, you and Company agree that either party shall have the\n+          right to finally resolve the Dispute through binding arbitration. The\n+          Federal Arbitration Act governs the interpretation and enforcement of\n+          this Arbitration Agreement. The arbitration will be conducted by JAMS,\n+          an established alternative dispute resolution provider. Disputes\n+          involving claims and counterclaims with an amount in controversy under\n+          $250,000, not inclusive of attorneys’ fees and interest, shall be\n+          subject to JAMS’ most current version of the Streamlined Arbitration\n+          Rules and procedures available\n+          athttp://www.jamsadr.com/rules-streamlined-arbitration/; all other\n+          claims shall be subject to JAMS’s most current version of the\n+          Comprehensive Arbitration Rules and Procedures, available\n+          athttp://www.jamsadr.com/rules-comprehensive-arbitration/. JAMS’s\n+          rules are also available atwww.jamsadr.com or by calling JAMS at\n+          800-352-5267. A party who wishes to initiate arbitration must provide\n+          the other party with a request for arbitration (the “Request”). The\n+          Request must include: (1) the name, telephone number, mailing address,\n+          e‐mail address of the party seeking arbitration and the account\n+          username (if applicable) as well as the email address associated with\n+          any applicable account; (2) a statement of the legal claims being\n+          asserted and the factual bases of those claims; (3) a description of\n+          the remedy sought and an accurate, good‐faith calculation of the\n+          amount in controversy in United States Dollars; (4) a statement\n+          certifying completion of the Informal Dispute Resolution process as\n+          described above; and (5) evidence that the requesting party has paid\n+          any necessary filing fees in connection with such arbitration.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          If the party requesting arbitration is represented by counsel, the\n+          Request shall also include counsel’s name, telephone number, mailing\n+          address, and email address. Such counsel must also sign the Request.\n+          By signing the Request, counsel certifies to the best of counsel’s\n+          knowledge, information, and belief, formed after an inquiry reasonable\n+          under the circumstances, that: (1) the Request is not being presented\n+          for any improper purpose, such as to harass, cause unnecessary delay,\n+          or needlessly increase the cost of dispute resolution; (2) the claims,\n+          defenses and other legal contentions are warranted by existing law or\n+          by a nonfrivolous argument for extending, modifying, or reversing\n+          existing law or for establishing new law; and (3) the factual and\n+          damages contentions have evidentiary support or, if specifically so\n+          identified, will likely have evidentiary support after a reasonable\n+          opportunity for further investigation or discovery.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Unless you and Company otherwise agree, or the Batch Arbitration\n+          process discussed in Subsection 10.2(h) is triggered, the arbitration\n+          will be conducted in the county where you reside. Subject to the JAMS\n+          Rules, the arbitrator may direct a limited and reasonable exchange of\n+          information between the parties, consistent with the expedited nature\n+          of the arbitration. If the JAMS is not available to arbitrate, the\n+          parties will select an alternative arbitral forum. Your responsibility\n+          to pay any JAMS fees and costs will be solely as set forth in the\n+          applicable JAMS Rules.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          You and Company agree that all materials and documents exchanged\n+          during the arbitration proceedings shall be kept confidential and\n+          shall not be shared with anyone except the parties’ attorneys,\n+          accountants, or business advisors, and then subject to the condition\n+          that they agree to keep all materials and documents exchanged during\n+          the arbitration proceedings confidential.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Authority of Arbitrator. The arbitrator shall have exclusive authority\n+          to resolve all disputes subject to arbitration hereunder including,\n+          without limitation, any dispute related to the interpretation,\n+          applicability, enforceability or formation of this Arbitration\n+          Agreement or any portion of the Arbitration Agreement, except for the\n+          following: (1) all Disputes arising out of or relating to the\n+          subsection entitled “Waiver of Class or Other Non-Individualized\n+          Relief,” including any claim that all or part of the subsection\n+          entitled “Waiver of Class or Other Non-Individualized Relief” is\n+          unenforceable, illegal, void or voidable, or that such subsection\n+          entitled “Waiver of Class or Other Non-Individualized Relief” has been\n+          breached, shall be decided by a court of competent jurisdiction and\n+          not by an arbitrator; (2) except as expressly contemplated in the\n+          subsection entitled “Batch Arbitration,” all Disputes about the\n+          payment of arbitration fees shall be decided only by a court of\n+          competent jurisdiction and not by an arbitrator; (3) all Disputes\n+          about whether either party has satisfied any condition precedent to\n+          arbitration shall be decided only by a court of competent jurisdiction\n+          and not by an arbitrator; and (4) all Disputes about which version of\n+          the Arbitration Agreement applies shall be decided only by a court of\n+          competent jurisdiction and not by an arbitrator. The arbitration\n+          proceeding will not be consolidated with any other matters or joined\n+          with any other cases or parties, except as expressly provided in the\n+          subsection entitled “Batch Arbitration.” The arbitrator shall have the\n+          authority to grant motions dispositive of all or part of any claim or\n+          dispute. The arbitrator shall have the authority to award monetary\n+          damages and to grant any non-monetary remedy or relief available to an\n+          individual party under applicable law, the arbitral forum’s rules, and\n+          these Terms (including the Arbitration Agreement). The arbitrator\n+          shall issue a written award and statement of decision describing the\n+          essential findings and conclusions on which any award (or decision not\n+          to render an award) is based, including the calculation of any damages\n+          awarded. The arbitrator shall follow the applicable law. The award of\n+          the arbitrator is final and binding upon you and us. Judgment on the\n+          arbitration award may be entered in any court having jurisdiction.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          {\" \"}\n+          Waiver of Jury Trial.EXCEPT AS SPECIFIED in section 10.2(a) YOU AND\n+          THE COMPANY PARTIES HEREBY WAIVE ANY CONSTITUTIONAL AND STATUTORY\n+          RIGHTS TO SUE IN COURT AND HAVE A TRIAL IN FRONT OF A JUDGE OR A JURY.\n+          You and the Company Parties are instead electing that all covered\n+          claims and disputes shall be resolved exclusively by arbitration under\n+          this Arbitration Agreement, except as specified in Section 10.2(a)\n+          above. An arbitrator can award on an individual basis the same damages\n+          and relief as a court and must follow these Terms as a court would.\n+          However, there is no judge or jury in arbitration, and court review of\n+          an arbitration award is subject to very limited review.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Waiver of Class or Other Non-Individualized Relief. YOU AND COMPANY\n+          AGREE THAT, EXCEPT AS SPECIFIED IN SUBSECTION 10.2(h) EACH OF US MAY\n+          BRING CLAIMS AGAINST THE OTHER ONLY ON AN INDIVIDUAL BASIS AND NOT ON\n+          A CLASS, REPRESENTATIVE, OR COLLECTIVE BASIS, AND THE PARTIES HEREBY\n+          WAIVE ALL RIGHTS TO HAVE ANY DISPUTE BE BROUGHT, HEARD, ADMINISTERED,\n+          RESOLVED, OR ARBITRATED ON A CLASS, COLLECTIVE, REPRESENTATIVE, OR\n+          MASS ACTION BASIS. ONLY INDIVIDUAL RELIEF IS AVAILABLE, AND DISPUTES\n+          OF MORE THAN ONE CUSTOMER OR USER CANNOT BE ARBITRATED OR CONSOLIDATED\n+          WITH THOSE OF ANY OTHER CUSTOMER OR USER. Subject to this Arbitration\n+          Agreement, the arbitrator may award declaratory or injunctive relief\n+          only in favor of the individual party seeking relief and only to the\n+          extent necessary to provide relief warranted by the party’s individual\n+          claim. Nothing in this paragraph is intended to, nor shall it, affect\n+          the terms and conditions under the Subsection 10.2(h) entitled “Batch\n+          Arbitration.” Notwithstanding anything to the contrary in this\n+          Arbitration Agreement, if a court decides by means of a final\n+          decision, not subject to any further appeal or recourse, that the\n+          limitations of this subsection, “Waiver of Class or Other\n+          Non-Individualized Relief,” are invalid or unenforceable as to a\n+          particular claim or request for relief (such as a request for public\n+          injunctive relief), you and Company agree that that particular claim\n+          or request for relief (and only that particular claim or request for\n+          relief) shall be severed from the arbitration and may be litigated in\n+          the state or federal courts located in the State of California. All\n+          other Disputes shall be arbitrated or litigated in small claims court.\n+          This subsection does not prevent you or Company from participating in\n+          a class-wide settlement of claims.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Attorneys’ Fees and Costs. The parties shall bear their own attorneys’\n+          fees and costs in arbitration unless the arbitrator finds that either\n+          the substance of the Dispute or the relief sought in the Request was\n+          frivolous or was brought for an improper purpose (as measured by the\n+          standards set forth in Federal Rule of Civil Procedure 11(b)). If you\n+          or Company need to invoke the authority of a court of competent\n+          jurisdiction to compel arbitration, then the party that obtains an\n+          order compelling arbitration in such action shall have the right to\n+          collect from the other party its reasonable costs, necessary\n+          disbursements, and reasonable attorneys’ fees incurred in securing an\n+          order compelling arbitration. The prevailing party in any court action\n+          relating to whether either party has satisfied any condition precedent\n+          to arbitration, including the Informal Dispute Resolution Process, is\n+          entitled to recover their reasonable costs, necessary disbursements,\n+          and reasonable attorneys’ fees and costs.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Batch Arbitration. To increase the efficiency of administration and\n+          resolution of arbitrations, you and Company agree that in the event\n+          that there are 100 or more individual Requests of a substantially\n+          similar nature filed against Company by or with the assistance of the\n+          same law firm, group of law firms, or organizations, within a 30 day\n+          period (or as soon as possible thereafter), the JAMS shall (1)\n+          administer the arbitration demands in batches of 100 Requests per\n+          batch (plus, to the extent there are less than 100 Requests left over\n+          after the batching described above, a final batch consisting of the\n+          remaining Requests); (2) appoint one arbitrator for each batch; and\n+          (3) provide for the resolution of each batch as a single consolidated\n+          arbitration with one set of filing and administrative fees due per\n+          side per batch, one procedural calendar, one hearing (if any) in a\n+          place to be determined by the arbitrator, and one final award (“Batch\n+          Arbitration”).\n+        </Paragraph>\n+\n+        <Paragraph>\n+          All parties agree that Requests are of a “substantially similar\n+          nature” if they arise out of or relate to the same event or factual\n+          scenario and raise the same or similar legal issues and seek the same\n+          or similar relief. To the extent the parties disagree on the\n+          application of the Batch Arbitration process, the disagreeing party\n+          shall advise the JAMS, and the JAMS shall appoint a sole standing\n+          arbitrator to determine the applicability of the Batch Arbitration\n+          process (“Administrative Arbitrator”). In an effort to expedite\n+          resolution of any such dispute by the Administrative Arbitrator, the\n+          parties agree the Administrative Arbitrator may set forth such\n+          procedures as are necessary to resolve any disputes promptly. The\n+          Administrative Arbitrator’s fees shall be paid by Company.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          You and Company agree to cooperate in good faith with the JAMS to\n+          implement the Batch Arbitration process including the payment of\n+          single filing and administrative fees for batches of Requests, as well\n+          as any steps to minimize the time and costs of arbitration, which may\n+          include: (1) the appointment of a discovery special master to assist\n+          the arbitrator in the resolution of discovery disputes; and (2) the\n+          adoption of an expedited calendar of the arbitration proceedings.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          This Batch Arbitration provision shall in no way be interpreted as\n+          authorizing a class, collective and/or mass arbitration or action of\n+          any kind, or arbitration involving joint or consolidated claims under\n+          any circumstances, except as expressly set forth in this provision.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          30-Day Right to Opt Out. You have the right to opt out of the\n+          provisions of this Arbitration Agreement by sending a timely written\n+          notice of your decision to opt out to the following address: 9\n+          Tamizar, Irvine, California 92620, or email to {contactEmail}, within\n+          30 days after first becoming subject to this Arbitration Agreement.\n+          Your notice must include your name and address and a clear statement\n+          that you want to opt out of this Arbitration Agreement. If you opt out\n+          of this Arbitration Agreement, all other parts of these Terms will\n+          continue to apply to you. Opting out of this Arbitration Agreement has\n+          no effect on any other arbitration agreements that you may currently\n+          have with us, or may enter into in the future with us.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Invalidity, Expiration. Except as provided in the subsection entitled\n+          “Waiver of Class or Other Non-Individualized Relief”, if any part or\n+          parts of this Arbitration Agreement are found under the law to be\n+          invalid or unenforceable, then such specific part or parts shall be of\n+          no force and effect and shall be severed and the remainder of the\n+          Arbitration Agreement shall continue in full force and effect. You\n+          further agree that any Dispute that you have with Company as detailed\n+          in this Arbitration Agreement must be initiated via arbitration within\n+          the applicable statute of limitation for that claim or controversy, or\n+          it will be forever time barred. Likewise, you agree that all\n+          applicable statutes of limitation will apply to such arbitration in\n+          the same manner as those statutes of limitation would apply in the\n+          applicable court of competent jurisdiction.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Modification.Notwithstanding any provision in these Terms to the\n+          contrary, we agree that if Company makes any future material change to\n+          this Arbitration Agreement, you may reject that change within 30 days\n+          of such change becoming effective by writing Company at the following\n+          address: 9 Tamizar, Irvine, California 92620, or email to\n+          {contactEmail}. Unless you reject the change within 30 days of such\n+          change becoming effective by writing to Company in accordance with the\n+          foregoing, your continued use of the Site and/or Services, including\n+          the acceptance of products and services offered on the Site following\n+          the posting of changes to this Arbitration Agreement constitutes your\n+          acceptance of any such changes. Changes to this Arbitration Agreement\n+          do not provide you with a new opportunity to opt out of the\n+          Arbitration Agreement if you have previously agreed to a version of\n+          these Terms and did not validly opt out of arbitration. If you reject\n+          any change or update to this Arbitration Agreement, and you were bound\n+          by an existing agreement to arbitrate Disputes arising out of or\n+          relating in any way to your access to or use of the Services or of the\n+          Site, any communications you receive, any products sold or distributed\n+          through the Site, the Services, or these Terms, the provisions of this\n+          Arbitration Agreement as of the date you first accepted these Terms\n+          (or accepted any subsequent changes to these Terms) remain in full\n+          force and effect. Company will continue to honor any valid opt outs of\n+          the Arbitration Agreement that you made to a prior version of these\n+          Terms.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Export. The Site may be subject to U.S. export control laws and may be\n+          subject to export or import regulations in other countries. You agree\n+          not to export, reexport, or transfer, directly or indirectly, any U.S.\n+          technical data acquired from Company, or any products utilizing such\n+          data, in violation of the United States export laws or\n+          regulations.{\" \"}\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Disclosures. Company is located at the address in Section 10.8. If you\n+          are a California resident, you may report complaints to the Complaint\n+          Assistance Unit of the Division of Consumer Product of the California\n+          Department of Consumer Affairs by contacting them in writing at 400 R\n+          Street, Sacramento, CA 95814, or by telephone at (800) 952-5210.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Electronic Communications. The communications between you and Company\n+          use electronic means, whether you use the Site or send us emails, or\n+          whether Company posts notices on the Site or communicates with you via\n+          email. For contractual purposes, you (a) consent to receive\n+          communications from Company in an electronic form; and (b) agree that\n+          all terms and conditions, agreements, notices, disclosures, and other\n+          communications that Company provides to you electronically satisfy any\n+          legal requirement that such communications would satisfy if it were be\n+          in a hardcopy writing. The foregoing does not affect your non-waivable\n+          rights.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Entire Terms. These Terms constitute the entire agreement between you\n+          and us regarding the use of the Site. Our failure to exercise or\n+          enforce any right or provision of these Terms shall not operate as a\n+          waiver of such right or provision. The section titles in these Terms\n+          are for convenience only and have no legal or contractual effect. The\n+          word “including” means “including without limitation”. If any\n+          provision of these Terms is, for any reason, held to be invalid or\n+          unenforceable, the other provisions of these Terms will be unimpaired\n+          and the invalid or unenforceable provision will be deemed modified so\n+          that it is valid and enforceable to the maximum extent permitted by\n+          law. Your relationship to Company is that of an independent\n+          contractor, and neither party is an agent or partner of the other.\n+          These Terms, and your rights and obligations herein, may not be\n+          assigned, subcontracted, delegated, or otherwise transferred by you\n+          without Company’s prior written consent, and any attempted assignment,\n+          subcontract, delegation, or transfer in violation of the foregoing\n+          will be null and void. Company may freely assign these Terms. The\n+          terms and conditions set forth in these Terms shall be binding upon\n+          assignees.{\" \"}\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Copyright/Trademark Information. Copyright © 2023 {company}. All\n+          rights reserved. All trademarks, logos and service marks (“Marks”)\n+          displayed on the Site are our property or the property of other third\n+          parties. You are not permitted to use these Marks without our prior\n+          written consent or the consent of such third party which may own the\n+          Marks.\n+        </Paragraph>\n+\n+        <Paragraph>* * *</Paragraph>\n+\n+        <Paragraph>\n+          Information about Digital Millennium Copyright Act (“DMCA”) Safe\n+          Harbor:\n+        </Paragraph>\n+\n+        <Paragraph>\n+          The Copyright Policy section (Section 9 above) has been included\n+          because you indicated that {appUrl} includes user content. We\n+          recommend you take advantage of the DMCA safe harbor.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          The DMCA provides certain “safe harbor” provisions that insulate\n+          online service providers (OSP) from liability for copyright\n+          infringement for infringing activities of its end users. In addition\n+          to meeting the requirements for each safe harbor exemption, an OSP\n+          must comply with the following to qualify for the safe harbor\n+          protection under the DMCA:\n+        </Paragraph>\n+\n+        <Paragraph>\n+          (a) Give notice to its users of its policies regarding copyright\n+          infringement and the consequences of repeated infringing activity.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          (b) Follow proper notice and takedown procedures. Once a copyright\n+          owner provides proper notice of allegedly infringing material to the\n+          OSP, or the OSP discovers such material itself, the OSP must remove,\n+          or disable access to, the material; provide notice thereafter to the\n+          individual responsible for such material; provide such individual with\n+          an opportunity to provide proper “counter-notice;” and comply with\n+          applicable procedures thereafter.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          (c) Designate an agent to receive notices of infringement from\n+          copyright owners (and provide the Copyright Office with contact\n+          information for such agent and make such information available on its\n+          website).\n+        </Paragraph>\n+\n+        <Paragraph>\n+          See: http://www.copyright.gov/onlinesp/ for the applicable forms and\n+          more information.\n+        </Paragraph>\n+      </div>\n+    </div>\n+  );\n+};\n+\n+export const EulaScreen = ({\n+  appUrl,\n+  lastUpdated,\n+  company,\n+  contactEmail,\n+}: {\n+  appUrl: string;\n+  lastUpdated: string;\n+  company: string;\n+  contactEmail: string;\n+}) => {\n+  return (\n+    <div className=\"h-screen overflow-auto\">\n+      <div className=\"px-4\">\n+        <H1>End-User License Agreement</H1>\n+\n+        <Paragraph>Our EULA was last updated on {lastUpdated}</Paragraph>\n+\n+        <Paragraph>\n+          Please read this End-User License Agreement carefully before clicking\n+          the \"I Agree\" button, downloading or using cmux.\n+        </Paragraph>\n+\n+        <Paragraph>Interpretation and Definitions</Paragraph>\n+\n+        <Paragraph>Interpretation</Paragraph>\n+\n+        <Paragraph>\n+          The words of which the initial letter is capitalized have meanings\n+          defined under the following conditions. The following definitions\n+          shall have the same meaning regardless of whether they appear in\n+          singular or in plural.\n+        </Paragraph>\n+\n+        <Paragraph>Definitions</Paragraph>\n+\n+        <Paragraph>\n+          For the purposes of this End-User License Agreement:\n+        </Paragraph>\n+\n+        <Paragraph>\n+          \"Agreement\" means this End-User License Agreement that forms the\n+          entire agreement between You and the Company regarding the use of the\n+          Application.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          \"Application\" means the software program and web service provided by\n+          the Company, known as cmux, which enables users to run AI-powered\n+          coding agents in parallel across multiple tasks with isolated\n+          development environments.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          \"Company\" (referred to as either \"the Company\", \"We\", \"Us\" or \"Our\" in\n+          this Agreement) refers to {company}.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          \"Content\" refers to content such as text, code, images, or other\n+          information that can be posted, uploaded, linked to or otherwise made\n+          available by You, regardless of the form of that content.\n+        </Paragraph>\n+\n+        <Paragraph>\"Country\" refers to: United States</Paragraph>\n+\n+        <Paragraph>\n+          \"Device\" means any device that can access the Application such as a\n+          computer, a cellphone or a digital tablet.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          \"Third-Party Services\" means any services or content (including data,\n+          information, applications and other products services) provided by a\n+          third-party that may be displayed, included or made available by the\n+          Application, including AI service providers such as Anthropic, OpenAI,\n+          Google, and sandbox providers.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          \"You\" means the individual accessing or using the Application or the\n+          company, or other legal entity on behalf of which such individual is\n+          accessing or using the Application, as applicable.\n+        </Paragraph>\n+\n+        <Paragraph>Acknowledgment</Paragraph>\n+\n+        <Paragraph>\n+          By clicking the \"I Agree\" button, downloading or using the\n+          Application, You are agreeing to be bound by the terms and conditions\n+          of this Agreement. If You do not agree to the terms of this Agreement,\n+          do not click on the \"I Agree\" button, do not download or do not use\n+          the Application.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          This Agreement is a legal document between You and the Company and it\n+          governs your use of the Application made available to You by the\n+          Company.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          The Application is licensed, not sold, to You by the Company for use\n+          strictly in accordance with the terms of this Agreement.\n+        </Paragraph>\n+\n+        <Paragraph>License</Paragraph>\n+\n+        <Paragraph>Scope of License</Paragraph>\n+\n+        <Paragraph>\n+          The Company grants You a revocable, non-exclusive, non-transferable,\n+          limited license to download, install and use the Application strictly\n+          in accordance with the terms of this Agreement.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          The license that is granted to You by the Company is for your personal\n+          or internal business purposes, including commercial use in connection\n+          with your software development activities, strictly in accordance with\n+          the terms of this Agreement.\n+        </Paragraph>\n+\n+        <Paragraph>License Restrictions</Paragraph>\n+\n+        <Paragraph>\n+          You agree not to, and You will not permit others to:\n+        </Paragraph>\n+\n+        <Paragraph>\n+          - License, sell, rent, lease, assign, distribute, transmit, host,\n+          outsource, disclose or otherwise commercially exploit the Application\n+          or make the Application available to any third party.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          - Remove, alter or obscure any proprietary notice (including any\n+          notice of copyright or trademark) of the Company or its affiliates,\n+          partners, suppliers or the licensors of the Application.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          - Use the Application to generate code intended for unlawful purposes.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          - Attempt to circumvent any security measures or usage limits of the\n+          Application or its integrated AI services.\n+        </Paragraph>\n+\n+        <Paragraph>Intellectual Property</Paragraph>\n+\n+        <Paragraph>\n+          The Application, including without limitation all copyrights, patents,\n+          trademarks, trade secrets and other intellectual property rights are,\n+          and shall remain, the sole and exclusive property of the Company.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          You retain ownership of any code or content you create using the\n+          Application, subject to any applicable third-party AI provider terms.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          The Company shall not be obligated to indemnify or defend You with\n+          respect to any third party claim arising out of or relating to the\n+          Application.\n+        </Paragraph>\n+\n+        <Paragraph>Modifications to the Application</Paragraph>\n+\n+        <Paragraph>\n+          The Company reserves the right to modify, suspend or discontinue,\n+          temporarily or permanently, the Application or any service to which it\n+          connects, with or without notice and without liability to You.\n+        </Paragraph>\n+\n+        <Paragraph>Updates to the Application</Paragraph>\n+\n+        <Paragraph>\n+          The Company may from time to time provide enhancements or improvements\n+          to the features/functionality of the Application, which may include\n+          patches, bug fixes, updates, upgrades and other modifications.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Updates may modify or delete certain features and/or functionalities\n+          of the Application. You agree that the Company has no obligation to\n+          (i) provide any Updates, or (ii) continue to provide or enable any\n+          particular features and/or functionalities of the Application to You.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          You further agree that all updates or any other modifications will be\n+          (i) deemed to constitute an integral part of the Application, and (ii)\n+          subject to the terms and conditions of this Agreement.\n+        </Paragraph>\n+\n+        <Paragraph>Maintenance and Support</Paragraph>\n+\n+        <Paragraph>\n+          The Company does not provide any maintenance or support for the\n+          download and use of the Application unless you are subscribed to a\n+          paid tier that includes support.\n+        </Paragraph>\n+\n+        <Paragraph>Third-Party Services</Paragraph>\n+\n+        <Paragraph>\n+          The Application may display, include or make available third-party\n+          content (including data, information, applications and other products\n+          services) or provide links to third-party websites or services,\n+          including AI coding agents from providers such as Anthropic, OpenAI,\n+          and Google.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          You acknowledge and agree that the Company shall not be responsible\n+          for any Third-party Services, including their accuracy, completeness,\n+          timeliness, validity, copyright compliance, legality, decency, quality\n+          or any other aspect thereof. The Company does not assume and shall not\n+          have any liability or responsibility to You or any other person or\n+          entity for any Third-party Services.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          You must comply with applicable Third parties' Terms of agreement when\n+          using the Application. Third-party Services and links thereto are\n+          provided solely as a convenience to You and You access and use them\n+          entirely at your own risk and subject to such third parties' Terms and\n+          conditions.\n+        </Paragraph>\n+\n+        <Paragraph>Term and Termination</Paragraph>\n+\n+        <Paragraph>\n+          This Agreement shall remain in effect until terminated by You or the\n+          Company. The Company may, in its sole discretion, at any time and for\n+          any or no reason, suspend or terminate this Agreement with or without\n+          prior notice.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          This Agreement will terminate immediately, without prior notice from\n+          the Company, in the event that you fail to comply with any provision\n+          of this Agreement. You may also terminate this Agreement by deleting\n+          the Application and all copies thereof from your Device.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Upon termination of this Agreement, You shall cease all use of the\n+          Application and delete all copies of the Application from your Device.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Termination of this Agreement will not limit any of the Company's\n+          rights or remedies at law or in equity in case of breach by You\n+          (during the term of this Agreement) of any of your obligations under\n+          the present Agreement.\n+        </Paragraph>\n+\n+        <Paragraph>Indemnification</Paragraph>\n+\n+        <Paragraph>\n+          You agree to indemnify and hold the Company and its parents,\n+          subsidiaries, affiliates, officers, employees, agents, partners and\n+          licensors (if any) harmless from any claim or demand, including\n+          reasonable attorneys' fees, due to or arising out of your: (a) use of\n+          the Application; (b) violation of this Agreement or any law or\n+          regulation; or (c) violation of any right of a third party.\n+        </Paragraph>\n+\n+        <Paragraph>No Warranties</Paragraph>\n+\n+        <Paragraph>\n+          The Application is provided to You \"AS IS\" and \"AS AVAILABLE\" and with\n+          all faults and defects without warranty of any kind. To the maximum\n+          extent permitted under applicable law, the Company, on its own behalf\n+          and on behalf of its affiliates and its and their respective licensors\n+          and service providers, expressly disclaims all warranties, whether\n+          express, implied, statutory or otherwise, with respect to the\n+          Application, including all implied warranties of merchantability,\n+          fitness for a particular purpose, title and non-infringement.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Without limiting the foregoing, the Company provides no warranty or\n+          undertaking, and makes no representation of any kind that the\n+          Application will meet your requirements, achieve any intended results,\n+          be compatible or work with any other software, applications, systems\n+          or services, operate without interruption, meet any performance or\n+          reliability standards or be error free or that any errors or defects\n+          can or will be corrected.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          AI-GENERATED CODE AND SUGGESTIONS MAY CONTAIN ERRORS, SECURITY\n+          VULNERABILITIES, OR INACCURACIES. YOU ARE SOLELY RESPONSIBLE FOR\n+          REVIEWING, TESTING, AND VALIDATING ANY AI-GENERATED CODE BEFORE USE.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Some jurisdictions do not allow the exclusion of certain types of\n+          warranties or limitations on applicable statutory rights of a\n+          consumer, so some or all of the above exclusions and limitations may\n+          not apply to You. But in such a case the exclusions and limitations\n+          set forth in this section shall be applied to the greatest extent\n+          enforceable under applicable law.\n+        </Paragraph>\n+\n+        <Paragraph>Limitation of Liability</Paragraph>\n+\n+        <Paragraph>\n+          Notwithstanding any damages that You might incur, the entire liability\n+          of the Company and any of its suppliers under any provision of this\n+          Agreement and your exclusive remedy for all of the foregoing shall be\n+          limited to the amount actually paid by You for the Application or\n+          through the Application or 100 USD if You haven't purchased anything\n+          through the Application.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          To the maximum extent permitted by applicable law, in no event shall\n+          the Company or its suppliers be liable for any special, incidental,\n+          indirect, or consequential damages whatsoever (including, but not\n+          limited to, damages for loss of profits, loss of data or other\n+          information, for business interruption, for personal injury, loss of\n+          privacy arising out of or in any way related to the use of or\n+          inability to use the Application, third-party software and/or\n+          third-party hardware used with the Application, or otherwise in\n+          connection with any provision of this Agreement), even if the Company\n+          or any supplier has been advised of the possibility of such damages\n+          and even if the remedy fails of its essential purpose.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          Some states/jurisdictions do not allow the exclusion or limitation of\n+          incidental or consequential damages, so the above limitation or\n+          exclusion may not apply to You.\n+        </Paragraph>\n+\n+        <Paragraph>Severability and Waiver</Paragraph>\n+\n+        <Paragraph>Severability</Paragraph>\n+\n+        <Paragraph>\n+          If any provision of this Agreement is held to be unenforceable or\n+          invalid, such provision will be changed and interpreted to accomplish\n+          the objectives of such provision to the greatest extent possible under\n+          applicable law and the remaining provisions will continue in full\n+          force and effect.\n+        </Paragraph>\n+\n+        <Paragraph>Waiver</Paragraph>\n+\n+        <Paragraph>\n+          Except as provided herein, the failure to exercise a right or to\n+          require performance of an obligation under this Agreement shall not\n+          effect a party's ability to exercise such right or require such\n+          performance at any time thereafter nor shall the waiver of a breach\n+          constitute a waiver of any subsequent breach.\n+        </Paragraph>\n+\n+        <Paragraph>Product Claims</Paragraph>\n+\n+        <Paragraph>\n+          The Company does not make any warranties concerning the Application.\n+          To the extent You have any claim arising from or relating to your use\n+          of the Application, the Company is responsible for addressing any such\n+          claims, which may include, but not limited to: (i) any product\n+          liability claims; (ii) any claim that the Application fails to conform\n+          to any applicable legal or regulatory requirement; and (iii) any claim\n+          arising under consumer protection, or similar legislation.\n+        </Paragraph>\n+\n+        <Paragraph>United States Legal Compliance</Paragraph>\n+\n+        <Paragraph>\n+          You represent and warrant that (i) You are not located in a country\n+          that is subject to the United States government embargo, or that has\n+          been designated by the United States government as a \"terrorist\n+          supporting\" country, and (ii) You are not listed on any United States\n+          government list of prohibited or restricted parties.\n+        </Paragraph>\n+\n+        <Paragraph>Changes to this Agreement</Paragraph>\n+\n+        <Paragraph>\n+          The Company reserves the right, at its sole discretion, to modify or\n+          replace this Agreement at any time. If a revision is material we will\n+          provide at least 30 days' notice prior to any new terms taking effect.\n+          What constitutes a material change will be determined at the sole\n+          discretion of the Company.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          By continuing to access or use the Application after any revisions\n+          become effective, You agree to be bound by the revised terms. If You\n+          do not agree to the new terms, You are no longer authorized to use the\n+          Application.\n+        </Paragraph>\n+\n+        <Paragraph>Governing Law</Paragraph>\n+\n+        <Paragraph>\n+          The laws of the Country, excluding its conflicts of law rules, shall\n+          govern this Agreement and your use of the Application. Your use of the\n+          Application may also be subject to other local, state, national, or\n+          international laws.\n+        </Paragraph>\n+\n+        <Paragraph>Entire Agreement</Paragraph>\n+\n+        <Paragraph>\n+          The Agreement constitutes the entire agreement between You and the\n+          Company regarding your use of the Application and supersedes all prior\n+          and contemporaneous written or oral agreements between You and the\n+          Company.\n+        </Paragraph>\n+\n+        <Paragraph>\n+          You may be subject to additional terms and conditions that apply when\n+          You use or purchase other Company's services, which the Company will\n+          provide to You at the time of such use or purchase.\n+        </Paragraph>\n+\n+        <Paragraph>Contact Us</Paragraph>\n+\n+        <Paragraph>\n+          If you have any questions about this Agreement, You can contact Us:\n+        </Paragraph>\n+\n+        <Paragraph>\n+          - By visiting this page on our website: {appUrl}/contact\n+        </Paragraph>\n+\n+        <Paragraph>- By sending us an email: {contactEmail}</Paragraph>\n+      </div>\n+    </div>\n+  );\n+};\ndiff --git a/apps/www/app/privacy-policy/page.tsx b/apps/www/app/privacy-policy/page.tsx\nnew file mode 100644\nindex 000000000..cb01ed3ef\n--- /dev/null\n+++ b/apps/www/app/privacy-policy/page.tsx\n@@ -0,0 +1,12 @@\n+import { PrivacyPolicyScreen } from \"./legal\";\n+\n+export default function PrivacyPolicyPage() {\n+  return (\n+    <PrivacyPolicyScreen\n+      appUrl=\"https://cmux.dev\"\n+      company=\"Manaflow\"\n+      contactEmail=\"austin@manaflow.com\"\n+      lastUpdated=\"12/2/2025\"\n+    />\n+  );\n+}\ndiff --git a/apps/www/app/terms-of-service/page.tsx b/apps/www/app/terms-of-service/page.tsx\nnew file mode 100644\nindex 000000000..a56984039\n--- /dev/null\n+++ b/apps/www/app/terms-of-service/page.tsx\n@@ -0,0 +1,11 @@\n+import { TermsOfServiceScreen } from \"@/app/privacy-policy/legal\";\n+\n+export default function TermsOfServicePage() {\n+  return (\n+    <TermsOfServiceScreen\n+      appUrl=\"https://cmux.dev\"\n+      company=\"Manaflow\"\n+      contactEmail=\"austin@manaflow.com\"\n+    />\n+  );\n+}\n","comments":[{"type":"issue_comment","id":3605288450,"prNumber":1126,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn75q868z6sw96xfwbw05fen257wkzv5?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn75q868z6sw96xfwbw05fen257wkzv5/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1126?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 8 screenshots for commit `a51904a` (2025-12-03 06:24:34.118 UTC).\n\n**Full-page screenshot of the Contact Us page showing centered layout with heading, description text, and contact email link (austin@manaflow.com)**\n\n![contact-page-fullpage-legal-0.png](https://adorable-wombat-701.convex.cloud/api/storage/8300b85e-42ff-4dfd-948f-61b0f87ce3f2)\n\n**Viewport screenshot of the Contact Us page displaying the centered contact information form**\n\n![contact-page-viewport-legal-0.png](https://adorable-wombat-701.convex.cloud/api/storage/d9217673-0966-4f32-aaa5-61d3ee6e8f33)\n\n**Full-page screenshot of the End-User License Agreement page showing complete EULA including definitions, license terms, intellectual property rights, warranties disclaimer, and liability limitations**\n\n![eula-page-fullpage-legal-0.png](https://adorable-wombat-701.convex.cloud/api/storage/7dad0ef4-605f-41c0-aa3f-419acacc046e)\n\n**Viewport screenshot of the EULA page displaying the top section with heading and interpretation/definitions section**\n\n![eula-page-viewport-legal-0.png](https://adorable-wombat-701.convex.cloud/api/storage/2a42e2be-a0c7-484e-895e-eae9fccba799)\n\n**Full-page screenshot of the Privacy Policy page showing comprehensive privacy policy for cmux/Manaflow, including sections on information collection, third-party services, data protection, and user rights**\n\n![privacy-policy-page-fullpage-legal-0.png](https://adorable-wombat-701.convex.cloud/api/storage/254e991a-3c27-4775-b229-a34962513e2d)\n\n**Viewport screenshot of the Privacy Policy page showing the top section with heading and initial policy content**\n\n![privacy-policy-page-viewport-legal-0.png](https://adorable-wombat-701.convex.cloud/api/storage/0a8ebc94-47b4-4aff-9452-05dc737be493)\n\n**Full-page screenshot of the Terms of Service page displaying detailed terms including account management, acceptable use policy, AI services disclaimer, arbitration agreement, and billing information**\n\n![terms-of-service-page-fullpage-legal-0.png](https://adorable-wombat-701.convex.cloud/api/storage/b708fd25-6212-4e2d-9057-3020b697e514)\n\n**Viewport screenshot of the Terms of Service page showing the initial sections including version information and introductory terms**\n\n![terms-of-service-page-viewport-legal-0.png](https://adorable-wombat-701.convex.cloud/api/storage/d9ffcbeb-6a16-4349-a3ac-9fbe0c7fe5c7)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"dae1bad1d30ad576fe1031d11b3236bee5b3788f","createdAt":"2025-12-03T06:24:36Z","updatedAt":"2025-12-03T06:34:47Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1126#issuecomment-3605288450"},{"type":"issue_comment","id":3605291765,"prNumber":1126,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn70swzf4ykfgqr6z9ef4zx0v57wjpwb?src=preview.new) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn70swzf4ykfgqr6z9ef4zx0v57wjpwb/browser?src=preview.new) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1126?src=preview.new)\n\nCaptured 4 screenshots for commit `a51904a` (2025-12-03 06:25:54.452 UTC).\n\n**Contact page showing heading 'Contact Us' with email contact information (austin@manaflow.com) on a centered layout with light/dark mode support**\n\n![contact-page-full.png](https://famous-camel-162.convex.cloud/api/storage/bb5df60a-d2ff-4fb2-831a-5a76161f3acc)\n\n**End-User License Agreement (EULA) page containing license terms, definitions, scope of license, restrictions, intellectual property rights, third-party services, termination terms, warranties, and liability limitations for the cmux application**\n\n![eula-page-full.png](https://famous-camel-162.convex.cloud/api/storage/4be46dfc-5d7e-4342-b1e6-474fe985b44b)\n\n**Privacy Policy page showing comprehensive privacy policy for Manaflow/cmux including sections on information collection, third-party services, data usage, protection measures, user rights, and data retention policies**\n\n![privacy-policy-page-full.png](https://famous-camel-162.convex.cloud/api/storage/fe1e6b71-b9b6-4dcb-aded-29dfcd782ddd)\n\n**Terms of Service page displaying detailed terms including account management, access rights, user content policies, AI services terms, subscription billing, disclaimers, liability limitations, and arbitration agreements**\n\n![terms-of-service-page-full.png](https://famous-camel-162.convex.cloud/api/storage/f6d27df1-7fd4-4ca9-94fc-0ed6e6d10e7e)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"dae1bad1d30ad576fe1031d11b3236bee5b3788f","createdAt":"2025-12-03T06:25:55Z","updatedAt":"2025-12-03T06:34:48Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1126#issuecomment-3605291765"},{"type":"issue_comment","id":3605312156,"prNumber":1126,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn72jqah0vjst5p50r1sd3x0457wjb0s?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn72jqah0vjst5p50r1sd3x0457wjb0s/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1126?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 6 screenshots for commit `dae1bad` (2025-12-03 06:34:45.851 UTC).\n\n**Full-page screenshot of the new Contact page displaying contact information with email austin@manaflow.com**\n\n![contact-page-legal-0.png](https://adorable-wombat-701.convex.cloud/api/storage/69450843-39b7-485d-a3c2-6fe4347f9c78)\n\n**Full-page screenshot of the new EULA (End User License Agreement) page with complete legal text**\n\n![eula-page-legal-0.png](https://adorable-wombat-701.convex.cloud/api/storage/be947eb0-81e6-4aae-a607-5e496c7ca88b)\n\n**Close-up screenshot of the homepage footer showing the new legal links: Privacy, Terms, EULA, and Contact**\n\n![homepage-footer-legal-0.png](https://adorable-wombat-701.convex.cloud/api/storage/b507467a-cc5a-4b65-ac47-eae58bbce588)\n\n**Full-page screenshot of the homepage showing the entire landing page with all content**\n\n![homepage-full-legal-0.png](https://adorable-wombat-701.convex.cloud/api/storage/6f668962-0667-423c-b078-4e90866cc543)\n\n**Full-page screenshot of the new Privacy Policy page showing data collection and usage policies**\n\n![privacy-policy-page-legal-0.png](https://adorable-wombat-701.convex.cloud/api/storage/670255d0-83a1-433f-a5ff-2fa7e5c2878f)\n\n**Full-page screenshot of the new Terms of Service page with complete terms and conditions**\n\n![terms-of-service-page-legal-0.png](https://adorable-wombat-701.convex.cloud/api/storage/a9b99aa5-8a69-46a4-81f1-8237bf217381)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"dae1bad1d30ad576fe1031d11b3236bee5b3788f","createdAt":"2025-12-03T06:34:46Z","updatedAt":"2025-12-03T06:34:46Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1126#issuecomment-3605312156"},{"type":"issue_comment","id":3605320471,"prNumber":1126,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn70we85vjsysghew97c2bzkw57wkbgm?src=preview.new) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn70we85vjsysghew97c2bzkw57wkbgm/browser?src=preview.new) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1126?src=preview.new)\n\n\n\nCaptured 5 screenshots for commit `dae1bad` (2025-12-03 06:38:15.975 UTC).\n\n**Contact page with company email and contact information**\n\n![contact-page-legal-0.png](https://famous-camel-162.convex.cloud/api/storage/e3a86330-a4b3-4eaa-93de-0330f26bd4d0)\n\n**End-User License Agreement (EULA) page with licensing terms**\n\n![eula-page-legal-0.png](https://famous-camel-162.convex.cloud/api/storage/77e2bd2e-e454-4033-92a1-224f27d87059)\n\n**Full homepage showing new legal links in footer (Privacy, Terms, EULA, Contact)**\n\n![homepage-full-legal-0.png](https://famous-camel-162.convex.cloud/api/storage/64a9843d-3a3e-453d-a817-199660f9482d)\n\n**Privacy Policy page with comprehensive privacy information for cmux**\n\n![privacy-policy-page-legal-0.png](https://famous-camel-162.convex.cloud/api/storage/c2f80d94-15ac-4499-983a-e7d4358f922d)\n\n**Terms of Service page with full legal terms and conditions**\n\n![terms-of-service-page-legal-0.png](https://famous-camel-162.convex.cloud/api/storage/8c75b0db-0ac9-40e9-a749-39698e4a1413)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"dae1bad1d30ad576fe1031d11b3236bee5b3788f","createdAt":"2025-12-03T06:38:18Z","updatedAt":"2025-12-03T06:38:18Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1126#issuecomment-3605320471"}]}
{"number":1125,"title":"feat: allow team members to view each other's tasks/runs","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1125","headRef":"cmux/team-wide-task-access","headSha":"5a93a079055fd59d829dbe12be8c38e9d7f4433b","baseRef":"main","baseSha":"89a742b84557c00e57ab28b9eab6c4d0b1cfed06","createdAt":"2025-12-03T05:48:43Z","updatedAt":"2025-12-03T07:20:00Z","diff":"diff --git a/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.tsx b/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.tsx\nindex fe9fc6183..47bce4292 100644\n--- a/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.tsx\n+++ b/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.tsx\n@@ -126,10 +126,19 @@ function TaskDetailPage() {\n     return () => window.removeEventListener(\"keydown\", handleKeyDown);\n   }, [flatRuns, taskId, navigate, teamSlugOrId]);\n \n-  if (!task || !taskRuns) {\n+  // Distinguish between loading (undefined) and not found (null)\n+  if (task === undefined || taskRuns === undefined) {\n     return <div className=\"p-8\">Loading...</div>;\n   }\n \n+  if (task === null) {\n+    return (\n+      <div className=\"p-8 text-neutral-500 dark:text-neutral-400\">\n+        Task not found or you don't have access to it.\n+      </div>\n+    );\n+  }\n+\n   return (\n     <div className=\"flex flex-col grow min-h-0 min-w-0\">\n       {WITH_HEADER && (\ndiff --git a/packages/convex/_shared/team.ts b/packages/convex/_shared/team.ts\nindex 10aedcb8e..cab39dbe7 100644\n--- a/packages/convex/_shared/team.ts\n+++ b/packages/convex/_shared/team.ts\n@@ -11,52 +11,47 @@ type AnyCtx = QueryCtx | MutationCtx;\n \n // Resolve a teamSlugOrId to a canonical team UUID string.\n // Falls back to the input if no team is found (for backwards compatibility).\n+// Always enforces team membership when an authenticated user is present.\n export async function getTeamId(\n   ctx: AnyCtx,\n   teamSlugOrId: string\n ): Promise<string> {\n-  if (isUuid(teamSlugOrId)) {\n-    return teamSlugOrId;\n-  }\n+  const identity = await ctx.auth.getUserIdentity();\n+  const userId = identity?.subject;\n \n-  const [team, identity] = await Promise.all([\n-    ctx.db\n+  let teamId: string;\n+\n+  if (isUuid(teamSlugOrId)) {\n+    // UUID provided directly - use as-is but still enforce membership below\n+    teamId = teamSlugOrId;\n+  } else {\n+    // Slug provided - resolve to teamId\n+    const team = await ctx.db\n       .query(\"teams\")\n       .withIndex(\"by_slug\", (q) => q.eq(\"slug\", teamSlugOrId))\n-      .first(),\n-    ctx.auth.getUserIdentity(),\n-  ]);\n-  const userId = identity?.subject;\n-  if (team) {\n-    const teamId = team.teamId;\n-    if (userId) {\n-      const membership = await ctx.db\n-        .query(\"teamMemberships\")\n-        .withIndex(\"by_team_user\", (q) =>\n-          q.eq(\"teamId\", teamId).eq(\"userId\", userId)\n-        )\n-        .first();\n-      if (!membership) {\n-        throw new Error(\"Forbidden: Not a member of this team\");\n-      }\n+      .first();\n+    if (team) {\n+      teamId = team.teamId;\n+    } else {\n+      // Back-compat: allow legacy string teamIds (e.g., \"default\")\n+      teamId = teamSlugOrId;\n     }\n-    return team.teamId;\n   }\n \n-  // Back-compat: allow legacy string teamIds (e.g., \"default\").\n-  // When identity is available, ensure membership if such a team exists in memberships.\n+  // Always enforce membership when user is authenticated\n   if (userId) {\n     const membership = await ctx.db\n       .query(\"teamMemberships\")\n       .withIndex(\"by_team_user\", (q) =>\n-        q.eq(\"teamId\", teamSlugOrId).eq(\"userId\", userId)\n+        q.eq(\"teamId\", teamId).eq(\"userId\", userId)\n       )\n       .first();\n     if (!membership) {\n       throw new Error(\"Forbidden: Not a member of this team\");\n     }\n   }\n-  return teamSlugOrId;\n+\n+  return teamId;\n }\n \n // Resolve a teamSlugOrId to a team UUID without enforcing membership.\ndiff --git a/packages/convex/convex/crown.ts b/packages/convex/convex/crown.ts\nindex c8727de3f..8991970e8 100644\n--- a/packages/convex/convex/crown.ts\n+++ b/packages/convex/convex/crown.ts\n@@ -193,13 +193,11 @@ export const getCrownedRun = authQuery({\n     taskId: v.id(\"tasks\"),\n   },\n   handler: async (ctx, args) => {\n-    const userId = ctx.identity.subject;\n     const teamId = await getTeamId(ctx, args.teamSlugOrId);\n     const crownedRun = await ctx.db\n       .query(\"taskRuns\")\n       .withIndex(\"by_task\", (q) => q.eq(\"taskId\", args.taskId))\n       .filter((q) => q.eq(q.field(\"teamId\"), teamId))\n-      .filter((q) => q.eq(q.field(\"userId\"), userId))\n       .filter((q) => q.eq(q.field(\"isCrowned\"), true))\n       .first();\n \n@@ -222,13 +220,11 @@ export const getCrownEvaluation = authQuery({\n       return null;\n     }\n \n-    const userId = ctx.identity.subject;\n     const teamId = await getTeamId(ctx, args.teamSlugOrId);\n     const evaluation = await ctx.db\n       .query(\"crownEvaluations\")\n       .withIndex(\"by_task\", (q) => q.eq(\"taskId\", args.taskId as Id<\"tasks\">))\n       .filter((q) => q.eq(q.field(\"teamId\"), teamId))\n-      .filter((q) => q.eq(q.field(\"userId\"), userId))\n       .first();\n \n     return evaluation;\ndiff --git a/packages/convex/convex/previewConfigs.ts b/packages/convex/convex/previewConfigs.ts\nindex b684970de..0420d1941 100644\n--- a/packages/convex/convex/previewConfigs.ts\n+++ b/packages/convex/convex/previewConfigs.ts\n@@ -1,5 +1,5 @@\n import { v } from \"convex/values\";\n-import { resolveTeamIdLoose } from \"../_shared/team\";\n+import { getTeamId } from \"../_shared/team\";\n import { authMutation, authQuery } from \"./users/utils\";\n import { internalQuery } from \"./_generated/server\";\n \n@@ -16,7 +16,7 @@ export const listByTeam = authQuery({\n     teamSlugOrId: v.string(),\n   },\n   handler: async (ctx, args) => {\n-    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const teamId = await getTeamId(ctx, args.teamSlugOrId);\n     const configs = await ctx.db\n       .query(\"previewConfigs\")\n       .withIndex(\"by_team\", (q) => q.eq(\"teamId\", teamId))\n@@ -32,7 +32,7 @@ export const get = authQuery({\n     previewConfigId: v.id(\"previewConfigs\"),\n   },\n   handler: async (ctx, args) => {\n-    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const teamId = await getTeamId(ctx, args.teamSlugOrId);\n     const config = await ctx.db.get(args.previewConfigId);\n     if (!config || config.teamId !== teamId) {\n       return null;\n@@ -47,7 +47,7 @@ export const getByRepo = authQuery({\n     repoFullName: v.string(),\n   },\n   handler: async (ctx, args) => {\n-    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const teamId = await getTeamId(ctx, args.teamSlugOrId);\n     const repoFullName = normalizeRepoFullName(args.repoFullName);\n     const config = await ctx.db\n       .query(\"previewConfigs\")\n@@ -65,7 +65,7 @@ export const remove = authMutation({\n     previewConfigId: v.id(\"previewConfigs\"),\n   },\n   handler: async (ctx, args) => {\n-    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const teamId = await getTeamId(ctx, args.teamSlugOrId);\n     const config = await ctx.db.get(args.previewConfigId);\n     if (!config || config.teamId !== teamId) {\n       throw new Error(\"Preview config not found\");\n@@ -95,7 +95,7 @@ export const upsert = authMutation({\n     if (!userId) {\n       throw new Error(\"Authentication required\");\n     }\n-    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const teamId = await getTeamId(ctx, args.teamSlugOrId);\n     const repoFullName = normalizeRepoFullName(args.repoFullName);\n     const now = Date.now();\n \ndiff --git a/packages/convex/convex/previewRuns.ts b/packages/convex/convex/previewRuns.ts\nindex f89b12955..f49480904 100644\n--- a/packages/convex/convex/previewRuns.ts\n+++ b/packages/convex/convex/previewRuns.ts\n@@ -1,5 +1,5 @@\n import { v } from \"convex/values\";\n-import { resolveTeamIdLoose } from \"../_shared/team\";\n+import { getTeamId } from \"../_shared/team\";\n import { internal } from \"./_generated/api\";\n import type { Id } from \"./_generated/dataModel\";\n import { authMutation, authQuery } from \"./users/utils\";\n@@ -416,7 +416,7 @@ export const listByConfig = authQuery({\n     limit: v.optional(v.number()),\n   },\n   handler: async (ctx, args) => {\n-    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const teamId = await getTeamId(ctx, args.teamSlugOrId);\n     const config = await ctx.db.get(args.previewConfigId);\n     if (!config || config.teamId !== teamId) {\n       throw new Error(\"Preview configuration not found\");\n@@ -440,7 +440,7 @@ export const listByTeam = authQuery({\n     limit: v.optional(v.number()),\n   },\n   handler: async (ctx, args) => {\n-    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const teamId = await getTeamId(ctx, args.teamSlugOrId);\n     const take = Math.max(1, Math.min(args.limit ?? 50, 100));\n     const runs = await ctx.db\n       .query(\"previewRuns\")\n@@ -508,7 +508,7 @@ export const createManual = authMutation({\n     headRef: v.optional(v.string()),\n   },\n   handler: async (ctx, args) => {\n-    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const teamId = await getTeamId(ctx, args.teamSlugOrId);\n     const repoFullName = normalizeRepoFullName(args.repoFullName);\n \n     // Find the preview config for this repo\ndiff --git a/packages/convex/convex/schema.ts b/packages/convex/convex/schema.ts\nindex 6501a278f..8b5b43981 100644\n--- a/packages/convex/convex/schema.ts\n+++ b/packages/convex/convex/schema.ts\n@@ -164,7 +164,8 @@ const convexSchema = defineSchema({\n     .index(\"by_user\", [\"userId\", \"createdAt\"])\n     .index(\"by_team_user\", [\"teamId\", \"userId\"])\n     .index(\"by_pinned\", [\"pinned\", \"teamId\", \"userId\"])\n-    .index(\"by_team_user_preview\", [\"teamId\", \"userId\", \"isPreview\"]),\n+    .index(\"by_team_user_preview\", [\"teamId\", \"userId\", \"isPreview\"])\n+    .index(\"by_team_preview\", [\"teamId\", \"isPreview\"]),\n \n   taskRuns: defineTable({\n     taskId: v.id(\"tasks\"),\ndiff --git a/packages/convex/convex/taskRuns.ts b/packages/convex/convex/taskRuns.ts\nindex 8a607bd94..6c27ab94f 100644\n--- a/packages/convex/convex/taskRuns.ts\n+++ b/packages/convex/convex/taskRuns.ts\n@@ -1,7 +1,7 @@\n import { v } from \"convex/values\";\n import { SignJWT } from \"jose\";\n import { env } from \"../_shared/convex-env\";\n-import { resolveTeamIdLoose } from \"../_shared/team\";\n+import { getTeamId, resolveTeamIdLoose } from \"../_shared/team\";\n import type { Doc, Id } from \"./_generated/dataModel\";\n import {\n   internalMutation,\n@@ -206,16 +206,13 @@ async function collectRunSubtreeIds(\n async function fetchTaskRunsForTask(\n   ctx: QueryCtx,\n   teamId: string,\n-  userId: string,\n   taskId: Id<\"tasks\">,\n   includeArchived = true,\n ): Promise<TaskRunWithChildren[]> {\n   const runs = await ctx.db\n     .query(\"taskRuns\")\n     .withIndex(\"by_task\", (q) => q.eq(\"taskId\", taskId))\n-    .filter(\n-      (q) => q.eq(q.field(\"teamId\"), teamId) && q.eq(q.field(\"userId\"), userId),\n-    )\n+    .filter((q) => q.eq(q.field(\"teamId\"), teamId))\n     .collect();\n \n   const environmentSummaries = new Map<\n@@ -372,24 +369,19 @@ export const getByTask = authQuery({\n       return [];\n     }\n \n-    const userId = ctx.identity.subject;\n-    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const teamId = await getTeamId(ctx, args.teamSlugOrId);\n     return await fetchTaskRunsForTask(\n       ctx,\n       teamId,\n-      userId,\n       args.taskId as Id<\"tasks\">,\n       args.includeArchived ?? true,\n     );\n   },\n });\n \n-const SYSTEM_BRANCH_USER_ID = \"__system__\";\n-\n async function fetchBranchMetadataForRepo(\n   ctx: QueryCtx,\n   teamId: string,\n-  userId: string,\n   repo: string,\n ): Promise<Doc<\"branches\">[]> {\n   const rows = await ctx.db\n@@ -398,12 +390,9 @@ async function fetchBranchMetadataForRepo(\n     .filter((q) => q.eq(q.field(\"teamId\"), teamId))\n     .collect();\n \n-  const relevant = rows.filter(\n-    (row) => row.userId === userId || row.userId === SYSTEM_BRANCH_USER_ID,\n-  );\n-\n+  // Deduplicate by branch name, preferring rows with known SHA info or recent activity\n   const byName = new Map<string, Doc<\"branches\">>();\n-  for (const row of relevant) {\n+  for (const row of rows) {\n     const existing = byName.get(row.name);\n     if (!existing) {\n       byName.set(row.name, row);\n@@ -478,15 +467,14 @@ export const getRunDiffContext = authQuery({\n     runId: v.id(\"taskRuns\"),\n   },\n   handler: async (ctx, args) => {\n-    const userId = ctx.identity.subject;\n-    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const teamId = await getTeamId(ctx, args.teamSlugOrId);\n \n     const [taskDoc, taskRuns] = await Promise.all([\n       ctx.db.get(args.taskId),\n-      fetchTaskRunsForTask(ctx, teamId, userId, args.taskId, true),\n+      fetchTaskRunsForTask(ctx, teamId, args.taskId, true),\n     ]);\n \n-    if (!taskDoc || taskDoc.teamId !== teamId || taskDoc.userId !== userId) {\n+    if (!taskDoc || taskDoc.teamId !== teamId) {\n       return {\n         task: null,\n         taskRuns,\n@@ -520,7 +508,6 @@ export const getRunDiffContext = authQuery({\n         const metadata = await fetchBranchMetadataForRepo(\n           ctx,\n           teamId,\n-          userId,\n           trimmedProjectFullName,\n         );\n         if (metadata.length > 0) {\n@@ -604,10 +591,9 @@ export const updateSummary = authMutation({\n export const get = authQuery({\n   args: { teamSlugOrId: v.string(), id: v.id(\"taskRuns\") },\n   handler: async (ctx, args) => {\n-    const userId = ctx.identity.subject;\n-    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const teamId = await getTeamId(ctx, args.teamSlugOrId);\n     const doc = await ctx.db.get(args.id);\n-    if (!doc || doc.teamId !== teamId || doc.userId !== userId) {\n+    if (!doc || doc.teamId !== teamId) {\n       return null;\n     }\n     // Rewrite morph URLs in networking field\n@@ -898,8 +884,7 @@ export const updateVSCodePorts = authMutation({\n export const getByContainerName = authQuery({\n   args: { teamSlugOrId: v.string(), containerName: v.string() },\n   handler: async (ctx, args) => {\n-    const userId = ctx.identity.subject;\n-    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const teamId = await getTeamId(ctx, args.teamSlugOrId);\n     const run =\n       (await ctx.db\n         .query(\"taskRuns\")\n@@ -907,7 +892,6 @@ export const getByContainerName = authQuery({\n           q.eq(\"vscode.containerName\", args.containerName),\n         )\n         .filter((q) => q.eq(q.field(\"teamId\"), teamId))\n-        .filter((q) => q.eq(q.field(\"userId\"), userId))\n         .first()) ?? null;\n \n     if (!run) {\ndiff --git a/packages/convex/convex/tasks.ts b/packages/convex/convex/tasks.ts\nindex 769f65250..8fb4be292 100644\n--- a/packages/convex/convex/tasks.ts\n+++ b/packages/convex/convex/tasks.ts\n@@ -1,5 +1,5 @@\n import { v } from \"convex/values\";\n-import { resolveTeamIdLoose } from \"../_shared/team\";\n+import { getTeamId, resolveTeamIdLoose } from \"../_shared/team\";\n import { api } from \"./_generated/api\";\n import type { Id } from \"./_generated/dataModel\";\n import { internalMutation, internalQuery } from \"./_generated/server\";\n@@ -47,15 +47,14 @@ export const getPreviewTasks = authQuery({\n     limit: v.optional(v.number()),\n   },\n   handler: async (ctx, args) => {\n-    const userId = ctx.identity.subject;\n-    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const teamId = await getTeamId(ctx, args.teamSlugOrId);\n     const take = Math.max(1, Math.min(args.limit ?? 50, 100));\n \n-    // Get preview tasks using the dedicated index\n+    // Get preview tasks using the dedicated index (team-wide, not user-specific)\n     const tasks = await ctx.db\n       .query(\"tasks\")\n-      .withIndex(\"by_team_user_preview\", (idx) =>\n-        idx.eq(\"teamId\", teamId).eq(\"userId\", userId).eq(\"isPreview\", true),\n+      .withIndex(\"by_team_preview\", (idx) =>\n+        idx.eq(\"teamId\", teamId).eq(\"isPreview\", true),\n       )\n       .filter((q) => q.neq(q.field(\"isArchived\"), true))\n       .collect();\n@@ -301,10 +300,9 @@ export const getById = authQuery({\n       return null;\n     }\n \n-    const userId = ctx.identity.subject;\n-    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const teamId = await getTeamId(ctx, args.teamSlugOrId);\n     const task = await ctx.db.get(args.id as Id<\"tasks\">);\n-    if (!task || task.teamId !== teamId || task.userId !== userId) return null;\n+    if (!task || task.teamId !== teamId) return null;\n \n     if (task.images && task.images.length > 0) {\n       const imagesWithUrls = await Promise.all(\n@@ -329,13 +327,11 @@ export const getById = authQuery({\n export const getVersions = authQuery({\n   args: { teamSlugOrId: v.string(), taskId: v.id(\"tasks\") },\n   handler: async (ctx, args) => {\n-    const userId = ctx.identity.subject;\n-    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const teamId = await getTeamId(ctx, args.teamSlugOrId);\n     return await ctx.db\n       .query(\"taskVersions\")\n       .withIndex(\"by_task\", (q) => q.eq(\"taskId\", args.taskId))\n       .filter((q) => q.eq(q.field(\"teamId\"), teamId))\n-      .filter((q) => q.eq(q.field(\"userId\"), userId))\n       .collect();\n   },\n });\n","comments":[{"type":"issue_comment","id":3605404674,"prNumber":1125,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn76vmhbrm0zn8ja9pcz8d585x7wkzjg?src=preview.new) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn76vmhbrm0zn8ja9pcz8d585x7wkzjg/browser?src=preview.new) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1125?src=preview.new)\n\nCaptured 3 screenshots for commit `5a93a07` (2025-12-03 07:09:12.003 UTC).\n\n**Dashboard view showing the main interface with pull request list and preview tasks in the sidebar**\n\n![dashboard-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/6b43b39d-f5fe-4927-9cf9-d12a67ee52e1)\n\n**Previews section showing team-wide preview tasks list (now accessible to all team members)**\n\n![previews-section-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/9cb2e500-addb-456a-8219-4c722e7b98f1)\n\n**Task detail page for PR #1125 showing the improved error handling UI (displays 'Task not found or you don't have access to it' message)**\n\n![task-detail-page-full.png](https://adorable-wombat-701.convex.cloud/api/storage/986324b1-5b08-4b8c-b23b-e39122f42c93)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"5a93a079055fd59d829dbe12be8c38e9d7f4433b","createdAt":"2025-12-03T07:09:14Z","updatedAt":"2025-12-03T07:11:22Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1125#issuecomment-3605404674"},{"type":"issue_comment","id":3605410988,"prNumber":1125,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn793t860avb879w2fprp017rs7wkg49?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn793t860avb879w2fprp017rs7wkg49/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1125?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"5a93a079055fd59d829dbe12be8c38e9d7f4433b","createdAt":"2025-12-03T07:11:21Z","updatedAt":"2025-12-03T07:11:21Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1125#issuecomment-3605410988"}]}
{"number":1124,"title":"reuse preview config component for step by step re 6k4tq","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1124","headRef":"cmux/reuse-preview-config-component-for-step-by-step-re-6k4tq","headSha":"ee59b001372a0c8064a9fc107b740757b6da311c","baseRef":"main","baseSha":"e2dc99b44665d773405f1e69426e6b38945f0b51","createdAt":"2025-12-03T05:40:10Z","updatedAt":"2025-12-03T07:14:06Z","diff":"diff --git a/apps/www/app/globals.css b/apps/www/app/globals.css\nindex c803fc83b..fa69307d7 100644\n--- a/apps/www/app/globals.css\n+++ b/apps/www/app/globals.css\n@@ -263,3 +263,38 @@ body {\n .repo-scroll-area::-webkit-scrollbar-track {\n   background: transparent;\n }\n+\n+/* Preview configure transition animations */\n+@keyframes slide-to-sidebar {\n+  0% {\n+    width: 100%;\n+    max-width: 42rem;\n+    margin-left: auto;\n+    margin-right: auto;\n+  }\n+  100% {\n+    width: 420px;\n+    max-width: 420px;\n+    margin-left: 0;\n+    margin-right: 0;\n+  }\n+}\n+\n+@keyframes fade-in-panel {\n+  0% {\n+    opacity: 0;\n+  }\n+  100% {\n+    opacity: 1;\n+  }\n+}\n+\n+.preview-setup-transitioning {\n+  animation: slide-to-sidebar 600ms cubic-bezier(0.4, 0, 0.2, 1) forwards;\n+}\n+\n+.preview-panel-entering {\n+  animation: fade-in-panel 500ms cubic-bezier(0.4, 0, 0.2, 1) forwards;\n+  animation-delay: 200ms;\n+  opacity: 0;\n+}\ndiff --git a/apps/www/components/preview/preview-configure-client.tsx b/apps/www/components/preview/preview-configure-client.tsx\nindex 709785876..d432e52c8 100644\n--- a/apps/www/components/preview/preview-configure-client.tsx\n+++ b/apps/www/components/preview/preview-configure-client.tsx\n@@ -44,7 +44,18 @@ type SandboxInstance = {\n \n type EnvVar = { name: string; value: string; isSecret: boolean };\n \n-type WizardStep = 1 | 2;\n+// All configuration steps in order (shown in workspace config sidebar)\n+const ALL_CONFIG_STEPS = [\n+  \"scripts\",      // maintenance + dev scripts\n+  \"env-vars\",     // environment variables\n+  \"run-scripts\",  // run scripts in terminal\n+  \"browser-setup\", // browser configuration\n+] as const;\n+\n+type ConfigStep = (typeof ALL_CONFIG_STEPS)[number];\n+\n+// Phase tracking for the layout transition\n+type LayoutPhase = \"initial-setup\" | \"transitioning\" | \"workspace-config\";\n \n type PreviewTeamOption = {\n   id: string;\n@@ -400,14 +411,7 @@ export function PreviewConfigureClient({\n     initialMaintenanceScript ?? initialFrameworkConfig.maintenanceScript;\n   const initialDevScriptValue =\n     initialDevScript ?? initialFrameworkConfig.devScript;\n-  const initialMaintenanceNone =\n-    initialMaintenanceScriptValue.trim().length === 0;\n-  const initialDevNone = initialDevScriptValue.trim().length === 0;\n   const initialEnvComplete = initialHasEnvValues;\n-  const initialMaintenanceComplete =\n-    initialMaintenanceNone || initialMaintenanceScriptValue.trim().length > 0;\n-  const initialDevComplete =\n-    initialDevNone || initialDevScriptValue.trim().length > 0;\n \n   const [instance, setInstance] = useState<SandboxInstance | null>(null);\n   const [isProvisioning, setIsProvisioning] = useState(false);\n@@ -418,7 +422,23 @@ export function PreviewConfigureClient({\n     [initialTeamSlugOrId, teams]\n   );\n \n-  const [currentStep, setCurrentStep] = useState<WizardStep>(1);\n+  // Layout phase for animation - always start with initial-setup to avoid hydration mismatch\n+  const [layoutPhase, setLayoutPhase] = useState<LayoutPhase>(\"initial-setup\");\n+\n+  // Sync layoutPhase with URL after hydration (runs once on mount)\n+  useEffect(() => {\n+    const url = new URL(window.location.href);\n+    const stepParam = url.searchParams.get(\"step\");\n+    if (stepParam === \"workspace\") {\n+      setLayoutPhase(\"workspace-config\");\n+    }\n+  }, []);\n+  // Current config step (starts at run-scripts when entering workspace config)\n+  const [currentConfigStep, setCurrentConfigStep] = useState<ConfigStep>(\"run-scripts\");\n+  // Track which steps have been completed (scripts and env-vars are pre-completed from initial setup)\n+  const [completedSteps, setCompletedSteps] = useState<Set<ConfigStep>>(\n+    () => new Set([\"scripts\", \"env-vars\"] as ConfigStep[])\n+  );\n \n   const [envVars, setEnvVars] = useState<EnvVar[]>(initialEnvVars);\n   const [hasTouchedEnvVars, setHasTouchedEnvVars] = useState(false);\n@@ -432,29 +452,9 @@ export function PreviewConfigureClient({\n   const [hasUserEditedScripts, setHasUserEditedScripts] = useState(false);\n   const [hasCompletedSetup, setHasCompletedSetup] = useState(false);\n   const [isWaitingForWorkspace, setIsWaitingForWorkspace] = useState(false);\n-  const [isEnvOpen, setIsEnvOpen] = useState(false);\n-  const [isBuildOpen, setIsBuildOpen] = useState(false);\n   const [envNone, setEnvNone] = useState(false);\n-  const [maintenanceNone, setMaintenanceNone] = useState(\n-    () => initialMaintenanceNone\n-  );\n-  const [devNone, setDevNone] = useState(() => initialDevNone);\n-  const [runConfirmed, setRunConfirmed] = useState(false);\n-  const [browserConfirmed, setBrowserConfirmed] = useState(false);\n   const [commandsCopied, setCommandsCopied] = useState(false);\n-  const [isEnvSectionOpen, setIsEnvSectionOpen] = useState(\n-    () => !initialEnvComplete\n-  );\n-  const [isMaintenanceSectionOpen, setIsMaintenanceSectionOpen] = useState(\n-    () => !initialMaintenanceComplete\n-  );\n-  const [isDevSectionOpen, setIsDevSectionOpen] = useState(\n-    () => !initialDevComplete\n-  );\n-  const [isRunSectionOpen, setIsRunSectionOpen] = useState(true);\n-  const [isBrowserSetupSectionOpen, setIsBrowserSetupSectionOpen] =\n-    useState(true);\n-\n+  const [, setIsEnvSectionOpen] = useState(() => !initialEnvComplete);\n   const [areEnvValuesHidden, setAreEnvValuesHidden] = useState(true);\n   const [activeEnvValueIndex, setActiveEnvValueIndex] = useState<number | null>(\n     null\n@@ -486,6 +486,22 @@ export function PreviewConfigureClient({\n     };\n   }, []);\n \n+  // Handle browser back/forward navigation\n+  useEffect(() => {\n+    const handlePopState = () => {\n+      const url = new URL(window.location.href);\n+      const stepParam = url.searchParams.get(\"step\");\n+      if (stepParam === \"workspace\") {\n+        setLayoutPhase(\"workspace-config\");\n+      } else {\n+        setLayoutPhase(\"initial-setup\");\n+      }\n+    };\n+\n+    window.addEventListener(\"popstate\", handlePopState);\n+    return () => window.removeEventListener(\"popstate\", handlePopState);\n+  }, []);\n+\n   const vscodePersistKey = instance?.instanceId\n     ? `preview-${instance.instanceId}:vscode`\n     : \"vscode\";\n@@ -539,11 +555,7 @@ export function PreviewConfigureClient({\n       envVars.some((r) => r.name.trim().length > 0 || r.value.trim().length > 0),\n     [envVars, hasTouchedEnvVars, initialEnvPrefilled]\n   );\n-  const maintenanceScriptValue = maintenanceScript.trim();\n-  const devScriptValue = devScript.trim();\n   const envDone = envNone || hasEnvValues;\n-  const maintenanceDone = maintenanceNone || maintenanceScriptValue.length > 0;\n-  const devDone = devNone || devScriptValue.length > 0;\n \n   // Collapse env section when entering configure step if it's already satisfied\n   useEffect(() => {\n@@ -574,15 +586,6 @@ export function PreviewConfigureClient({\n     startAtConfigureEnvironment,\n   ]);\n \n-  const handleEnterConfigureEnvironment = useCallback(() => {\n-    if (isWorkspaceReady) {\n-      setHasCompletedSetup(true);\n-      setIsWaitingForWorkspace(false);\n-      return;\n-    }\n-    setIsWaitingForWorkspace(true);\n-  }, [isWorkspaceReady]);\n-\n   const browserPlaceholder = useMemo(\n     () =>\n       resolvedVncUrl\n@@ -742,58 +745,21 @@ export function PreviewConfigureClient({\n         const presetConfig = getFrameworkPresetConfig(preset, initialPackageManager);\n         setMaintenanceScript(presetConfig.maintenanceScript);\n         setDevScript(presetConfig.devScript);\n-        // Update none states based on whether the preset has scripts\n-        setMaintenanceNone(presetConfig.maintenanceScript.trim().length === 0);\n-        setDevNone(presetConfig.devScript.trim().length === 0);\n       }\n     },\n     [hasUserEditedScripts, initialPackageManager]\n   );\n \n   const handleMaintenanceScriptChange = useCallback((value: string) => {\n-    setMaintenanceNone(false);\n     setMaintenanceScript(value);\n     setHasUserEditedScripts(true);\n   }, []);\n \n   const handleDevScriptChange = useCallback((value: string) => {\n-    setDevNone(false);\n     setDevScript(value);\n     setHasUserEditedScripts(true);\n   }, []);\n \n-  const handleToggleEnvNone = useCallback(\n-    (value: boolean) => {\n-      setHasTouchedEnvVars(true);\n-      setEnvNone(value);\n-      setActiveEnvValueIndex(null);\n-      if (value) {\n-        setAreEnvValuesHidden(true);\n-        setEnvVars([{ name: \"\", value: \"\", isSecret: true }]);\n-        setIsEnvOpen(false);\n-      } else {\n-        setIsEnvOpen(true);\n-      }\n-    },\n-    []\n-  );\n-\n-  const handleToggleMaintenanceNone = useCallback((value: boolean) => {\n-    setMaintenanceNone(value);\n-    setHasUserEditedScripts(true);\n-    if (value) {\n-      setMaintenanceScript(\"\");\n-    }\n-  }, []);\n-\n-  const handleToggleDevNone = useCallback((value: boolean) => {\n-    setDevNone(value);\n-    setHasUserEditedScripts(true);\n-    if (value) {\n-      setDevScript(\"\");\n-    }\n-  }, []);\n-\n   const handleCopyCommands = useCallback(async () => {\n     const combined = [maintenanceScript.trim(), devScript.trim()]\n       .filter(Boolean)\n@@ -816,9 +782,6 @@ export function PreviewConfigureClient({\n     }\n   }, [devScript, maintenanceScript]);\n \n-  useEffect(() => {\n-    setRunConfirmed(false);\n-  }, [maintenanceScriptValue, devScriptValue, maintenanceNone, devNone]);\n \n   const handleSaveConfiguration = async () => {\n     if (!resolvedTeamSlugOrId) {\n@@ -908,24 +871,72 @@ export function PreviewConfigureClient({\n     }\n   };\n \n-  const handleNextStep = () => {\n-    if (currentStep === 1) {\n-      setIsEnvOpen(false);\n-      setIsBuildOpen(false);\n-    }\n-    if (currentStep < 2) {\n-      setCurrentStep((currentStep + 1) as WizardStep);\n-    }\n-  };\n+  // Handle transitioning from initial setup to workspace configuration\n+  const handleStartWorkspaceConfig = useCallback(() => {\n+    setLayoutPhase(\"transitioning\");\n+    // Add search param to track that we're in workspace config phase\n+    const url = new URL(window.location.href);\n+    url.searchParams.set(\"step\", \"workspace\");\n+    window.history.pushState({}, \"\", url.toString());\n+    // After animation completes, set to workspace-config\n+    setTimeout(() => {\n+      setLayoutPhase(\"workspace-config\");\n+    }, 650); // Match CSS transition duration (600ms + buffer)\n+  }, []);\n+\n+  // Handle going back to initial setup from workspace config\n+  const handleBackToInitialSetup = useCallback(() => {\n+    // Remove the step param from URL\n+    const url = new URL(window.location.href);\n+    url.searchParams.delete(\"step\");\n+    window.history.pushState({}, \"\", url.toString());\n+    // Transition back to initial setup\n+    setLayoutPhase(\"initial-setup\");\n+    setCurrentConfigStep(\"run-scripts\");\n+  }, []);\n+\n+  // Handle next step within workspace configuration\n+  const handleNextConfigStep = useCallback(() => {\n+    const currentIndex = ALL_CONFIG_STEPS.indexOf(currentConfigStep);\n+\n+    // Mark current step as completed\n+    setCompletedSteps((prev) => new Set([...prev, currentConfigStep]));\n \n-  const handlePrevStep = () => {\n-    if (currentStep > 1) {\n-      setCurrentStep((currentStep - 1) as WizardStep);\n+    // Move to next step if not at end\n+    if (currentIndex < ALL_CONFIG_STEPS.length - 1) {\n+      setCurrentConfigStep(ALL_CONFIG_STEPS[currentIndex + 1]);\n     }\n-  };\n+  }, [currentConfigStep]);\n+\n+  // Helper to check if a step is visible (completed or current)\n+  const isStepVisible = useCallback((step: ConfigStep) => {\n+    return completedSteps.has(step) || step === currentConfigStep;\n+  }, [completedSteps, currentConfigStep]);\n+\n+  // Helper to check if a step is the current one\n+  const isCurrentStep = useCallback((step: ConfigStep) => {\n+    return step === currentConfigStep;\n+  }, [currentConfigStep]);\n+\n+  // Helper to check if a step is completed (for collapsing)\n+  const isStepCompleted = useCallback((step: ConfigStep) => {\n+    return completedSteps.has(step);\n+  }, [completedSteps]);\n+\n+  // Navigate to a specific step (for going back to completed steps)\n+  const handleGoToStep = useCallback((step: ConfigStep) => {\n+    // Remove from completed set when going back to a step\n+    setCompletedSteps((prev) => {\n+      const next = new Set(prev);\n+      next.delete(step);\n+      return next;\n+    });\n+    setCurrentConfigStep(step);\n+  }, []);\n \n   // Pre-create iframes during setup so they're ready when user clicks Next\n-  useEffect(() => {\n+  // Using useLayoutEffect so iframes are created before the mount effect runs\n+  useLayoutEffect(() => {\n     if (!instance || !persistentIframeManager) return;\n \n     // Pre-create VS Code iframe during setup\n@@ -955,11 +966,15 @@ export function PreviewConfigureClient({\n \n   // Mount iframes to their targets when visible\n   useLayoutEffect(() => {\n-    if (!instance || !persistentIframeManager || !hasCompletedSetup) return;\n+    if (!instance || !persistentIframeManager) return;\n+    // Only mount when in workspace-config layout\n+    if (layoutPhase === \"initial-setup\") return;\n \n     const cleanupFunctions: Array<() => void> = [];\n \n-    if (instance.vscodeUrl && currentStep === 1) {\n+    // Show VSCode for steps before browser-setup\n+    const showVscode = currentConfigStep !== \"browser-setup\";\n+    if (instance.vscodeUrl && showVscode) {\n       const target = document.querySelector(\n         `[data-iframe-target=\"${vscodePersistKey}\"]`\n       ) as HTMLElement | null;\n@@ -970,7 +985,8 @@ export function PreviewConfigureClient({\n       }\n     }\n \n-    if (resolvedVncUrl && currentStep === 2) {\n+    // Show browser for browser-setup step\n+    if (resolvedVncUrl && currentConfigStep === \"browser-setup\") {\n       const target = document.querySelector(\n         `[data-iframe-target=\"${browserPersistKey}\"]`\n       ) as HTMLElement | null;\n@@ -990,30 +1006,32 @@ export function PreviewConfigureClient({\n     browserPersistKey,\n     instance,\n     persistentIframeManager,\n-    currentStep,\n-    hasCompletedSetup,\n+    currentConfigStep,\n+    layoutPhase,\n     resolvedVncUrl,\n     vscodePersistKey,\n   ]);\n \n-  // Control iframe visibility based on current step and setup state\n+  // Control iframe visibility based on current step and layout phase\n   useEffect(() => {\n     if (!persistentIframeManager) {\n       return;\n     }\n \n-    // Hide iframes during setup screen, show based on step after setup\n-    const workspaceVisible =\n-      hasCompletedSetup && currentStep === 1 && Boolean(instance?.vscodeUrl);\n-    const browserVisible =\n-      hasCompletedSetup && currentStep === 2 && Boolean(resolvedVncUrl);\n+    // Only show iframes when in workspace-config layout\n+    const inWorkspaceConfig = layoutPhase === \"workspace-config\";\n+    // Show VSCode for steps before browser-setup\n+    const showVscode = currentConfigStep !== \"browser-setup\";\n+    const workspaceVisible = inWorkspaceConfig && showVscode && Boolean(instance?.vscodeUrl);\n+    // Show browser for browser-setup step\n+    const browserVisible = inWorkspaceConfig && currentConfigStep === \"browser-setup\" && Boolean(resolvedVncUrl);\n \n     persistentIframeManager.setVisibility(vscodePersistKey, workspaceVisible);\n     persistentIframeManager.setVisibility(browserPersistKey, browserVisible);\n   }, [\n     browserPersistKey,\n-    currentStep,\n-    hasCompletedSetup,\n+    currentConfigStep,\n+    layoutPhase,\n     persistentIframeManager,\n     resolvedVncUrl,\n     instance?.vscodeUrl,\n@@ -1041,467 +1059,130 @@ export function PreviewConfigureClient({\n     );\n   }\n \n-  // Show setup screen while provisioning OR until user clicks Next\n-  if (!hasCompletedSetup) {\n-    const shouldShowWorkspaceLoader =\n-      (startAtConfigureEnvironment || isWaitingForWorkspace) && !isWorkspaceReady;\n-\n-    if (shouldShowWorkspaceLoader) {\n-      const loaderTitle = startAtConfigureEnvironment\n-        ? \"Resuming your VS Code workspace...\"\n-        : \"Starting your VS Code workspace...\";\n-      const loaderDescription = startAtConfigureEnvironment\n-        ? \"We'll show the configuration form once your environment is ready.\"\n-        : \"We'll open the configuration as soon as the sandbox is ready.\";\n-\n-      return (\n-        <div className=\"flex min-h-dvh items-center justify-center bg-white dark:bg-black font-sans\">\n-          <div className=\"text-center px-6\">\n-            <Loader2 className=\"mx-auto h-8 w-8 animate-spin text-neutral-400\" />\n-            <h1 className=\"mt-4 text-lg font-medium text-neutral-900 dark:text-neutral-100\">\n-              {loaderTitle}\n-            </h1>\n-            <p className=\"mt-2 text-sm text-neutral-500 dark:text-neutral-400\">\n-              {loaderDescription}\n-            </p>\n-          </div>\n-        </div>\n-      );\n-    }\n+  const renderPreviewPanel = () => {\n+    // Show browser only for browser-setup step, VSCode for others\n+    const showBrowser = currentConfigStep === \"browser-setup\";\n+    const placeholder = showBrowser ? browserPlaceholder : workspacePlaceholder;\n+    const iframeKey = showBrowser ? browserPersistKey : vscodePersistKey;\n \n     return (\n-      <div className=\"min-h-dvh bg-white dark:bg-black font-sans\">\n-        {/* Main Content */}\n-        <div className=\"max-w-2xl mx-auto px-6 py-10\">\n-          <div className=\"mb-3\">\n-            <Link\n-              href=\"/preview\"\n-              className=\"inline-flex items-center gap-1.5 text-xs text-neutral-500 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-neutral-100\"\n-            >\n-              <ArrowLeft className=\"h-3 w-3\" />\n-              Go to preview.new\n-            </Link>\n-          </div>\n-\n-          {/* Importing Header */}\n-          <div className=\"mb-8\">\n-            <h1 className=\"text-2xl font-semibold text-neutral-900 dark:text-neutral-100 mb-1\">\n-              Configure Project\n-            </h1>\n-            <div className=\"flex items-center gap-2 text-sm text-neutral-600 dark:text-neutral-400 pt-2\">\n-              <svg\n-                className=\"h-4 w-4 shrink-0 text-white\"\n-                viewBox=\"0 0 24 24\"\n-                fill=\"currentColor\"\n-              >\n-                <path d=\"M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z\" />\n-              </svg>\n-              <span className=\"font-sans\">{repo}</span>\n+      <div className=\"h-full flex flex-col overflow-hidden relative\">\n+        {placeholder ? (\n+          <div className=\"absolute inset-0 flex flex-col items-center justify-center gap-2 px-4 text-center text-neutral-500 dark:text-neutral-400\">\n+            <div className=\"text-sm font-medium text-neutral-600 dark:text-neutral-200\">\n+              {placeholder.title}\n             </div>\n-          </div>\n-\n-          <div className=\"space-y-6\">\n-            {/* Framework Preset */}\n-            <FrameworkPresetSelect\n-              value={frameworkPreset}\n-              onValueChange={handleFrameworkPresetChange}\n-            />\n-\n-            {/* Maintenance and Dev Scripts - Collapsible */}\n-            <details\n-              className=\"group\"\n-              open={isBuildOpen}\n-              onToggle={(e) => setIsBuildOpen(e.currentTarget.open)}\n-            >\n-              <summary className=\"flex items-center gap-2 cursor-pointer text-base font-semibold text-neutral-900 dark:text-neutral-100 list-none\">\n-                <ChevronDown className=\"h-4 w-4 text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\" />\n-                Maintenance and Dev Scripts\n-              </summary>\n-              <div className=\"mt-4 pl-6 space-y-4\">\n-                <div>\n-                  <label className=\"block text-xs text-neutral-500 dark:text-neutral-400 mb-1.5\">\n-                    Maintenance Script\n-                  </label>\n-                  <textarea\n-                    value={maintenanceScript ?? \"\"}\n-                    onChange={(e) =>\n-                      handleMaintenanceScriptChange(e.target.value)\n-                    }\n-                    placeholder={\n-                      \"npm install, bun install, pip install -r requirements.txt\"\n-                    }\n-                    rows={2}\n-                    className=\"w-full rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-3 py-2 text-xs font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 resize-none\"\n-                  />\n-                  <p className=\"text-xs text-neutral-400 mt-1\">\n-                    Runs after git pull to install dependencies (e.g. npm\n-                    install, bun install, pip install -r requirements.txt)\n-                  </p>\n-                </div>\n-                <div>\n-                  <label className=\"block text-xs text-neutral-500 dark:text-neutral-400 mb-1.5\">\n-                    Dev Script\n-                  </label>\n-                  <textarea\n-                    value={devScript ?? \"\"}\n-                    onChange={(e) => handleDevScriptChange(e.target.value)}\n-                    placeholder={\n-                      \"npm run dev, bun dev, python manage.py runserver\"\n-                    }\n-                    rows={2}\n-                    className=\"w-full rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-3 py-2 text-xs font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 resize-none\"\n-                  />\n-                  <p className=\"text-xs text-neutral-400 mt-1\">\n-                    Starts the development server (e.g. npm run dev, bun dev,\n-                    python manage.py runserver)\n-                  </p>\n-                </div>\n-              </div>\n-            </details>\n-\n-            {/* Environment Variables - Collapsible */}\n-            <details\n-              className=\"group\"\n-              open={isEnvOpen}\n-              onToggle={(e) => setIsEnvOpen(e.currentTarget.open)}\n-            >\n-              <summary className=\"flex items-center gap-2 cursor-pointer text-base font-semibold text-neutral-900 dark:text-neutral-100 list-none\">\n-                <ChevronDown className=\"h-4 w-4 text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\" />\n-                <span>Environment Variables</span>\n-                <div className=\"ml-auto flex items-center gap-2\">\n-                  <button\n-                    type=\"button\"\n-                    onClick={(e) => {\n-                      e.preventDefault();\n-                      setActiveEnvValueIndex(null);\n-                      setAreEnvValuesHidden((previous) => !previous);\n-                    }}\n-                    className=\"text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-300 transition p-0.5\"\n-                    aria-label={\n-                      areEnvValuesHidden ? \"Reveal values\" : \"Hide values\"\n-                    }\n-                  >\n-                    {areEnvValuesHidden ? (\n-                      <EyeOff className=\"h-4 w-4\" />\n-                    ) : (\n-                      <Eye className=\"h-4 w-4\" />\n-                    )}\n-                  </button>\n-                </div>\n-              </summary>\n-\n-              <div\n-                className=\"mt-4 space-y-2 pl-6\"\n-                onPasteCapture={(e) => {\n-                  const text = e.clipboardData?.getData(\"text\") ?? \"\";\n-                  if (text && (/\\n/.test(text) || /(=|:)\\s*\\S/.test(text))) {\n-                    e.preventDefault();\n-                    const items = parseEnvBlock(text);\n-                    if (items.length > 0) {\n-                      setEnvNone(false);\n-                      updateEnvVars((prev) => {\n-                        const map = new Map(\n-                          prev\n-                            .filter(\n-                              (r) =>\n-                                r.name.trim().length > 0 ||\n-                                r.value.trim().length > 0\n-                            )\n-                            .map((r) => [r.name, r] as const)\n-                        );\n-                        for (const it of items) {\n-                          if (!it.name) continue;\n-                          const existing = map.get(it.name);\n-                          if (existing) {\n-                            map.set(it.name, { ...existing, value: it.value });\n-                          } else {\n-                            map.set(it.name, {\n-                              name: it.name,\n-                              value: it.value,\n-                              isSecret: true,\n-                            });\n-                          }\n-                        }\n-                        const next = Array.from(map.values());\n-                        next.push({ name: \"\", value: \"\", isSecret: true });\n-                        setPendingFocusIndex(next.length - 1);\n-                        return next;\n-                      });\n-                    }\n-                  }\n-                }}\n-              >\n-                <div\n-                  className=\"grid gap-2 text-xs text-neutral-500 dark:text-neutral-500 items-center pr-10 mb-1\"\n-                  style={{\n-                    gridTemplateColumns: \"minmax(0, 1fr) minmax(0, 1.5fr) 40px\",\n-                  }}\n-                >\n-                  <span>Name</span>\n-                  <span>Value</span>\n-                  <span />\n-                </div>\n-\n-                {envVars.map((row, idx) => {\n-                  const rowKey = idx;\n-                  const isEditingValue = activeEnvValueIndex === idx;\n-                  const shouldMaskValue =\n-                    areEnvValuesHidden &&\n-                    row.value.trim().length > 0 &&\n-                    !isEditingValue;\n-                  return (\n-                    <div\n-                      key={rowKey}\n-                      className=\"grid gap-2 items-center pr-10 min-h-9\"\n-                      style={{\n-                        gridTemplateColumns:\n-                          \"minmax(0, 1fr) minmax(0, 1.5fr) 40px\",\n-                      }}\n-                    >\n-                      <input\n-                        type=\"text\"\n-                        value={row.name}\n-                        disabled={envNone}\n-                        ref={(el) => {\n-                          keyInputRefs.current[idx] = el;\n-                        }}\n-                        onChange={(e) => {\n-                          const v = e.target.value;\n-                          setEnvNone(false);\n-                          updateEnvVars((prev) => {\n-                            const next = [...prev];\n-                            const current = next[idx];\n-                            if (current) {\n-                              next[idx] = { ...current, name: v };\n-                            }\n-                            return next;\n-                          });\n-                        }}\n-                        placeholder=\"EXAMPLE_NAME\"\n-                        className=\"w-full min-w-0 h-9 rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-3 text-sm font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 disabled:opacity-60 disabled:cursor-not-allowed\"\n-                      />\n-                      <input\n-                        type={shouldMaskValue ? \"password\" : \"text\"}\n-                        value={shouldMaskValue ? MASKED_ENV_VALUE : row.value}\n-                        disabled={envNone}\n-                        onChange={\n-                          shouldMaskValue\n-                            ? undefined\n-                            : (e) => {\n-                                const v = e.target.value;\n-                                setEnvNone(false);\n-                                updateEnvVars((prev) => {\n-                                  const next = [...prev];\n-                                  const current = next[idx];\n-                                  if (current) {\n-                                    next[idx] = { ...current, value: v };\n-                                  }\n-                                  return next;\n-                                });\n-                              }\n-                        }\n-                        onFocus={() => setActiveEnvValueIndex(idx)}\n-                        onBlur={() =>\n-                          setActiveEnvValueIndex((current) =>\n-                            current === idx ? null : current\n-                          )\n-                        }\n-                        readOnly={shouldMaskValue}\n-                        placeholder=\"I9JU23NF394R6HH\"\n-                        className=\"w-full min-w-0 h-9 rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-3 text-sm font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 disabled:opacity-60 disabled:cursor-not-allowed\"\n-                      />\n-                      <button\n-                        type=\"button\"\n-                        disabled={envNone || envVars.length <= 1}\n-                        onClick={() => {\n-                          updateEnvVars((prev) => {\n-                            const next = prev.filter((_, i) => i !== idx);\n-                            return next.length > 0\n-                              ? next\n-                              : [{ name: \"\", value: \"\", isSecret: true }];\n-                          });\n-                        }}\n-                        className={clsx(\n-                          \"h-9 w-9 rounded-md border border-neutral-200 dark:border-neutral-800 text-neutral-500 dark:text-neutral-400 grid place-items-center\",\n-                          envNone || envVars.length <= 1\n-                            ? \"opacity-60 cursor-not-allowed\"\n-                            : \"hover:bg-neutral-50 dark:hover:bg-neutral-900\"\n-                        )}\n-                        aria-label=\"Remove variable\"\n-                      >\n-                        <Minus className=\"w-4 h-4\" />\n-                      </button>\n-                    </div>\n-                  );\n-                })}\n-\n-                <div className=\"mt-1\">\n-                  <button\n-                    type=\"button\"\n-                    onClick={() =>\n-                      updateEnvVars((prev) => [\n-                        ...prev,\n-                        { name: \"\", value: \"\", isSecret: true },\n-                      ])\n-                    }\n-                    disabled={envNone}\n-                    className=\"inline-flex items-center gap-2 h-9 rounded-md border border-neutral-200 dark:border-neutral-800 px-3 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-neutral-50 dark:hover:bg-neutral-900 transition disabled:opacity-60 disabled:cursor-not-allowed\"\n-                  >\n-                    <Plus className=\"w-4 h-4\" /> Add variable\n-                  </button>\n-                </div>\n-              </div>\n-\n-              <p className=\"text-xs text-neutral-400 dark:text-neutral-400 pl-6 mt-4\">\n-                Tip: Paste a .env file to auto-fill\n+            {placeholder.description ? (\n+              <p className=\"text-xs text-neutral-500 dark:text-neutral-400\">\n+                {placeholder.description}\n               </p>\n-            </details>\n-          </div>\n-\n-          {/* Next Button */}\n-          <div className=\"mt-10 pt-6 border-t border-neutral-200 dark:border-neutral-800\">\n-            <div className=\"flex items-center justify-end gap-4\">\n-              <button\n-                type=\"button\"\n-                onClick={handleEnterConfigureEnvironment}\n-                className={clsx(\n-                  \"inline-flex items-center gap-2 rounded-md px-5 py-2.5 text-sm font-semibold transition\",\n-                  \"bg-neutral-900 dark:bg-neutral-100 text-white dark:text-neutral-900 hover:bg-neutral-800 dark:hover:bg-neutral-200 cursor-pointer\",\n-                  !isWorkspaceReady && \"opacity-80\"\n-                )}\n-              >\n-                Next\n-                <ArrowRight className=\"w-4 h-4\" />\n-              </button>\n-            </div>\n+            ) : null}\n           </div>\n-        </div>\n+        ) : null}\n+        <div\n+          className={clsx(\n+            \"absolute inset-0\",\n+            placeholder ? \"opacity-0\" : \"opacity-100\"\n+          )}\n+          data-iframe-target={iframeKey}\n+        />\n       </div>\n     );\n-  }\n+  };\n \n-  const renderStep1Content = () => (\n-    <div className=\"space-y-5\">\n-      {/* Workspace Info */}\n-      <p className=\"text-[11px] text-neutral-500 dark:text-neutral-400 leading-relaxed\">\n-        Your workspace root at{\" \"}\n-        <code className=\"px-1 py-0.5 rounded bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-700 dark:text-neutral-300\">\n-          /root/workspace\n-        </code>{\" \"}\n-        maps directly to your repo root.\n-      </p>\n-\n-      {/* Maintenance Script */}\n+  // Shared render function for scripts section\n+  const renderScriptsSection = (options?: { compact?: boolean; defaultOpen?: boolean; showStepBadge?: boolean; stepNumber?: number; isDone?: boolean }) => {\n+    const { compact = false, defaultOpen = true, showStepBadge = false, stepNumber = 1, isDone = false } = options ?? {};\n+    const iconSize = compact ? \"h-3.5 w-3.5\" : \"h-4 w-4\";\n+    const titleSize = compact ? \"text-[13px]\" : \"text-base\";\n+    const contentPadding = compact ? \"mt-3 pl-5\" : \"mt-4 pl-6\";\n+\n+    return (\n       <details\n         className=\"group\"\n-        open={isMaintenanceSectionOpen}\n-        onToggle={(e) => setIsMaintenanceSectionOpen(e.currentTarget.open)}\n+        open={defaultOpen}\n       >\n-        <summary className=\"flex items-center gap-2 cursor-pointer list-none\">\n-          <ChevronDown className=\"h-3.5 w-3.5 text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\" />\n-          <StepBadge step={1} done={maintenanceDone} />\n-          <span className=\"text-[13px] font-medium text-neutral-900 dark:text-neutral-100\">\n-            Maintenance script\n-          </span>\n+        <summary className={clsx(\n+          \"flex items-center gap-2 cursor-pointer font-semibold text-neutral-900 dark:text-neutral-100 list-none\",\n+          titleSize\n+        )}>\n+          <ChevronDown className={clsx(iconSize, \"text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\")} />\n+          {showStepBadge && <StepBadge step={stepNumber} done={isDone} />}\n+          Maintenance and Dev Scripts\n         </summary>\n-        <div className=\"mt-3 ml-6 space-y-2\">\n-          <p className=\"text-[11px] text-neutral-500 dark:text-neutral-400\">\n-            Runs after git pull to install dependencies.\n-          </p>\n-          <textarea\n-            value={maintenanceScript ?? \"\"}\n-            onChange={(e) => handleMaintenanceScriptChange(e.target.value)}\n-            placeholder={\n-              \"npm install, bun install, pip install -r requirements.txt\"\n-            }\n-            disabled={maintenanceNone}\n-            rows={2}\n-            className=\"w-full min-w-0 rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-2.5 py-1.5 text-[12px] font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 disabled:opacity-60 disabled:cursor-not-allowed resize-none\"\n-          />\n-          <div className=\"flex items-center justify-end\">\n-            <label className=\"flex items-center gap-1.5 text-[10px] text-neutral-400 cursor-pointer hover:text-neutral-600 dark:hover:text-neutral-300\">\n-              <input\n-                type=\"checkbox\"\n-                checked={maintenanceNone}\n-                onChange={(e) => handleToggleMaintenanceNone(e.target.checked)}\n-                className=\"h-3.5 w-3.5 rounded border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-950 text-emerald-500 focus:ring-2 focus:ring-emerald-500/40\"\n-              />\n-              None\n+        <div className={clsx(contentPadding, \"space-y-4\")}>\n+          <div>\n+            <label className=\"block text-xs text-neutral-500 dark:text-neutral-400 mb-1.5\">\n+              Maintenance Script\n             </label>\n+            <textarea\n+              value={maintenanceScript ?? \"\"}\n+              onChange={(e) => handleMaintenanceScriptChange(e.target.value)}\n+              placeholder=\"npm install, bun install, pip install -r requirements.txt\"\n+              rows={2}\n+              className=\"w-full rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-3 py-2 text-xs font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 resize-none\"\n+            />\n+            <p className=\"text-xs text-neutral-400 mt-1\">\n+              Runs after git pull to install dependencies\n+            </p>\n           </div>\n-        </div>\n-      </details>\n-\n-      {/* Dev Script */}\n-      <details\n-        className=\"group\"\n-        open={isDevSectionOpen}\n-        onToggle={(e) => setIsDevSectionOpen(e.currentTarget.open)}\n-      >\n-        <summary className=\"flex items-center gap-2 cursor-pointer list-none\">\n-          <ChevronDown className=\"h-3.5 w-3.5 text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\" />\n-          <StepBadge step={2} done={devDone} />\n-          <span className=\"text-[13px] font-medium text-neutral-900 dark:text-neutral-100\">\n-            Dev script\n-          </span>\n-        </summary>\n-        <div className=\"mt-3 ml-6 space-y-2\">\n-          <p className=\"text-[11px] text-neutral-500 dark:text-neutral-400\">\n-            Starts the development server.\n-          </p>\n-          <textarea\n-            value={devScript ?? \"\"}\n-            onChange={(e) => handleDevScriptChange(e.target.value)}\n-            placeholder={\"npm run dev, bun dev, python manage.py runserver\"}\n-            disabled={devNone}\n-            rows={2}\n-            className=\"w-full min-w-0 rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-2.5 py-1.5 text-[12px] font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 disabled:opacity-60 disabled:cursor-not-allowed resize-none\"\n-          />\n-          <div className=\"flex items-center justify-end\">\n-            <label className=\"flex items-center gap-1.5 text-[10px] text-neutral-400 cursor-pointer hover:text-neutral-600 dark:hover:text-neutral-300\">\n-              <input\n-                type=\"checkbox\"\n-                checked={devNone}\n-                onChange={(e) => handleToggleDevNone(e.target.checked)}\n-                className=\"h-3.5 w-3.5 rounded border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-950 text-emerald-500 focus:ring-2 focus:ring-emerald-500/40\"\n-              />\n-              None\n+          <div>\n+            <label className=\"block text-xs text-neutral-500 dark:text-neutral-400 mb-1.5\">\n+              Dev Script\n             </label>\n+            <textarea\n+              value={devScript ?? \"\"}\n+              onChange={(e) => handleDevScriptChange(e.target.value)}\n+              placeholder=\"npm run dev, bun dev, python manage.py runserver\"\n+              rows={2}\n+              className=\"w-full rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-3 py-2 text-xs font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 resize-none\"\n+            />\n+            <p className=\"text-xs text-neutral-400 mt-1\">\n+              Starts the development server\n+            </p>\n           </div>\n         </div>\n       </details>\n+    );\n+  };\n \n-      {/* Environment Variables */}\n+  // Shared render function for environment variables section\n+  const renderEnvVarsSection = (options?: { compact?: boolean; defaultOpen?: boolean; showStepBadge?: boolean; stepNumber?: number; isDone?: boolean }) => {\n+    const { compact = false, defaultOpen = true, showStepBadge = false, stepNumber = 2, isDone = false } = options ?? {};\n+    const iconSize = compact ? \"h-3.5 w-3.5\" : \"h-4 w-4\";\n+    const titleSize = compact ? \"text-[13px]\" : \"text-base\";\n+    const contentPadding = compact ? \"mt-3 pl-5\" : \"mt-4 pl-6\";\n+\n+    return (\n       <details\n         className=\"group\"\n-        open={isEnvSectionOpen}\n+        open={defaultOpen}\n         onToggle={(e) => setIsEnvSectionOpen(e.currentTarget.open)}\n       >\n-        <summary className=\"flex items-center gap-2 cursor-pointer list-none\">\n-          <ChevronDown className=\"h-3.5 w-3.5 text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\" />\n-          <StepBadge step={3} done={envDone} />\n-          <span className=\"text-[13px] font-medium text-neutral-900 dark:text-neutral-100\">\n-            Environment variables\n-          </span>\n-          <button\n-            type=\"button\"\n-            onClick={(e) => {\n-              e.preventDefault();\n-              setActiveEnvValueIndex(null);\n-              setAreEnvValuesHidden((prev) => !prev);\n-            }}\n-            className=\"ml-auto text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-300 p-0.5\"\n-            aria-label={areEnvValuesHidden ? \"Reveal values\" : \"Hide values\"}\n-          >\n-            {areEnvValuesHidden ? (\n-              <EyeOff className=\"h-3.5 w-3.5\" />\n-            ) : (\n-              <Eye className=\"h-3.5 w-3.5\" />\n-            )}\n-          </button>\n+        <summary className={clsx(\n+          \"flex items-center gap-2 cursor-pointer font-semibold text-neutral-900 dark:text-neutral-100 list-none\",\n+          titleSize\n+        )}>\n+          <ChevronDown className={clsx(iconSize, \"text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\")} />\n+          {showStepBadge && <StepBadge step={stepNumber} done={isDone} />}\n+          <span>Environment Variables</span>\n+          <div className=\"ml-auto flex items-center gap-2\">\n+            <button\n+              type=\"button\"\n+              onClick={(e) => {\n+                e.preventDefault();\n+                setActiveEnvValueIndex(null);\n+                setAreEnvValuesHidden((prev) => !prev);\n+              }}\n+              className=\"text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-300 transition p-0.5\"\n+              aria-label={areEnvValuesHidden ? \"Reveal values\" : \"Hide values\"}\n+            >\n+              {areEnvValuesHidden ? <EyeOff className={iconSize} /> : <Eye className={iconSize} />}\n+            </button>\n+          </div>\n         </summary>\n         <div\n-          className=\"mt-3 ml-6 space-y-2\"\n+          className={clsx(contentPadding, \"space-y-2\")}\n           onPasteCapture={(e) => {\n             const text = e.clipboardData?.getData(\"text\") ?? \"\";\n             if (text && (/\\n/.test(text) || /(=|:)\\s*\\S/.test(text))) {\n@@ -1512,23 +1193,14 @@ export function PreviewConfigureClient({\n                 updateEnvVars((prev) => {\n                   const map = new Map(\n                     prev\n-                      .filter(\n-                        (r) =>\n-                          r.name.trim().length > 0 || r.value.trim().length > 0\n-                      )\n+                      .filter((r) => r.name.trim().length > 0 || r.value.trim().length > 0)\n                       .map((r) => [r.name, r] as const)\n                   );\n                   for (const it of items) {\n                     if (!it.name) continue;\n                     const existing = map.get(it.name);\n-                    if (existing)\n-                      map.set(it.name, { ...existing, value: it.value });\n-                    else\n-                      map.set(it.name, {\n-                        name: it.name,\n-                        value: it.value,\n-                        isSecret: true,\n-                      });\n+                    if (existing) map.set(it.name, { ...existing, value: it.value });\n+                    else map.set(it.name, { name: it.name, value: it.value, isSecret: true });\n                   }\n                   const next = Array.from(map.values());\n                   next.push({ name: \"\", value: \"\", isSecret: true });\n@@ -1540,361 +1212,272 @@ export function PreviewConfigureClient({\n           }}\n         >\n           <div\n-            className=\"grid gap-2 text-[10px] text-neutral-500 items-center min-h-7\"\n-            style={{\n-              gridTemplateColumns: \"minmax(0, 1fr) minmax(0, 1.5fr) 28px\",\n-            }}\n+            className=\"grid gap-2 text-xs text-neutral-500 items-center mb-1\"\n+            style={{ gridTemplateColumns: \"minmax(0, 1fr) minmax(0, 1.5fr) 40px\" }}\n           >\n-            <span>Key</span>\n+            <span>Name</span>\n             <span>Value</span>\n             <span />\n           </div>\n           {envVars.map((row, idx) => {\n             const isEditingValue = activeEnvValueIndex === idx;\n-            const shouldMaskValue =\n-              areEnvValuesHidden &&\n-              row.value.trim().length > 0 &&\n-              !isEditingValue;\n+            const shouldMaskValue = areEnvValuesHidden && row.value.trim().length > 0 && !isEditingValue;\n             return (\n               <div\n                 key={idx}\n-                className=\"grid gap-2 items-center min-h-7\"\n-                style={{\n-                  gridTemplateColumns: \"minmax(0, 1fr) minmax(0, 1.5fr) 28px\",\n-                }}\n+                className=\"grid gap-2 items-center min-h-9\"\n+                style={{ gridTemplateColumns: \"minmax(0, 1fr) minmax(0, 1.5fr) 40px\" }}\n               >\n                 <input\n                   type=\"text\"\n                   value={row.name}\n                   disabled={envNone}\n-                  ref={(el) => {\n-                    keyInputRefs.current[idx] = el;\n-                  }}\n+                  ref={(el) => { keyInputRefs.current[idx] = el; }}\n                   onChange={(e) => {\n                     setEnvNone(false);\n                     updateEnvVars((prev) => {\n                       const next = [...prev];\n-                      if (next[idx])\n-                        next[idx] = { ...next[idx], name: e.target.value };\n+                      if (next[idx]) next[idx] = { ...next[idx], name: e.target.value };\n                       return next;\n                     });\n                   }}\n                   placeholder=\"EXAMPLE_NAME\"\n-                  className=\"w-full min-w-0 h-7 rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-2.5 text-[12px] font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 disabled:opacity-60 disabled:cursor-not-allowed\"\n+                  className=\"w-full min-w-0 h-9 rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-3 text-sm font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 disabled:opacity-60 disabled:cursor-not-allowed\"\n                 />\n                 <input\n-                  type=\"text\"\n+                  type={shouldMaskValue ? \"password\" : \"text\"}\n                   value={shouldMaskValue ? MASKED_ENV_VALUE : row.value}\n                   disabled={envNone}\n-                  onChange={\n-                    shouldMaskValue\n-                      ? undefined\n-                      : (e) => {\n-                          setEnvNone(false);\n-                          updateEnvVars((prev) => {\n-                            const next = [...prev];\n-                            if (next[idx])\n-                              next[idx] = {\n-                                ...next[idx],\n-                                value: e.target.value,\n-                              };\n-                            return next;\n-                          });\n-                        }\n-                  }\n+                  onChange={shouldMaskValue ? undefined : (e) => {\n+                    setEnvNone(false);\n+                    updateEnvVars((prev) => {\n+                      const next = [...prev];\n+                      if (next[idx]) next[idx] = { ...next[idx], value: e.target.value };\n+                      return next;\n+                    });\n+                  }}\n                   onFocus={() => setActiveEnvValueIndex(idx)}\n-                  onBlur={() =>\n-                    setActiveEnvValueIndex((current) =>\n-                      current === idx ? null : current\n-                    )\n-                  }\n+                  onBlur={() => setActiveEnvValueIndex((current) => current === idx ? null : current)}\n                   readOnly={shouldMaskValue}\n                   placeholder=\"I9JU23NF394R6HH\"\n-                  className=\"w-full min-w-0 h-7 rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-2.5 text-[12px] font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 disabled:opacity-60 disabled:cursor-not-allowed\"\n+                  className=\"w-full min-w-0 h-9 rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-3 text-sm font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 disabled:opacity-60 disabled:cursor-not-allowed\"\n                 />\n                 <button\n                   type=\"button\"\n                   disabled={envNone || envVars.length <= 1}\n-                  onClick={() =>\n-                    updateEnvVars((prev) => {\n-                      const next = prev.filter((_, i) => i !== idx);\n-                      return next.length > 0\n-                        ? next\n-                        : [{ name: \"\", value: \"\", isSecret: true }];\n-                    })\n-                  }\n+                  onClick={() => updateEnvVars((prev) => {\n+                    const next = prev.filter((_, i) => i !== idx);\n+                    return next.length > 0 ? next : [{ name: \"\", value: \"\", isSecret: true }];\n+                  })}\n                   className={clsx(\n-                    \"h-7 w-7 rounded border border-neutral-200 dark:border-neutral-800 text-neutral-400 grid place-items-center\",\n+                    \"h-9 w-9 rounded-md border border-neutral-200 dark:border-neutral-800 text-neutral-500 dark:text-neutral-400 grid place-items-center\",\n                     envNone || envVars.length <= 1\n-                      ? \"opacity-50 cursor-not-allowed\"\n-                      : \"hover:border-neutral-300 dark:hover:border-neutral-700 hover:text-neutral-600 dark:hover:text-neutral-200\"\n+                      ? \"opacity-60 cursor-not-allowed\"\n+                      : \"hover:bg-neutral-50 dark:hover:bg-neutral-900\"\n                   )}\n-                  aria-label=\"Remove\"\n+                  aria-label=\"Remove variable\"\n                 >\n-                  <Minus className=\"w-3 h-3\" />\n+                  <Minus className=\"w-4 h-4\" />\n                 </button>\n               </div>\n             );\n           })}\n-          <div className=\"flex items-center justify-between pt-1\">\n+          <div className=\"mt-1\">\n             <button\n               type=\"button\"\n+              onClick={() => updateEnvVars((prev) => [...prev, { name: \"\", value: \"\", isSecret: true }])}\n               disabled={envNone}\n-              onClick={() =>\n-                updateEnvVars((prev) => [\n-                  ...prev,\n-                  { name: \"\", value: \"\", isSecret: true },\n-                ])\n-              }\n-              className=\"inline-flex items-center gap-1 text-[11px] text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-300 disabled:opacity-50\"\n+              className=\"inline-flex items-center gap-2 h-9 rounded-md border border-neutral-200 dark:border-neutral-800 px-3 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-neutral-50 dark:hover:bg-neutral-900 transition disabled:opacity-60 disabled:cursor-not-allowed\"\n             >\n-              <Plus className=\"w-3 h-3\" /> Add variable\n+              <Plus className=\"w-4 h-4\" /> Add variable\n             </button>\n-            <label className=\"flex items-center gap-1.5 text-[10px] text-neutral-400 cursor-pointer hover:text-neutral-600 dark:hover:text-neutral-300\">\n-              <input\n-                type=\"checkbox\"\n-                checked={envNone}\n-                onChange={(e) => handleToggleEnvNone(e.target.checked)}\n-                className=\"h-3.5 w-3.5 rounded border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-950 text-emerald-500 focus:ring-2 focus:ring-emerald-500/40\"\n-              />\n-              None\n-            </label>\n           </div>\n-          <p className=\"text-[10px] text-neutral-400\">\n-            Tip: Paste .env to auto-fill\n-          </p>\n         </div>\n-      </details>\n-\n-      {/* Run Scripts */}\n-      <details\n-        className=\"group\"\n-        open={isRunSectionOpen}\n-        onToggle={(e) => setIsRunSectionOpen(e.currentTarget.open)}\n-      >\n-        <summary className=\"flex items-center gap-2 cursor-pointer list-none\">\n-          <ChevronDown className=\"h-3.5 w-3.5 text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\" />\n-          <StepBadge step={4} done={runConfirmed} />\n-          <span className=\"text-[13px] font-medium text-neutral-900 dark:text-neutral-100\">\n-            Run scripts in VS Code terminal\n-          </span>\n-        </summary>\n-        <div className=\"mt-3 ml-6 space-y-3\">\n-          <p className=\"text-[11px] text-neutral-500 dark:text-neutral-400\">\n-            Open terminal (\n-            <kbd className=\"px-1 py-0.5 rounded bg-neutral-100 dark:bg-neutral-800 text-[10px] font-sans\">\n-              Ctrl+Shift+`\n-            </kbd>{\" \"}\n-            or{\" \"}\n-            <kbd className=\"px-1 py-0.5 rounded bg-neutral-100 dark:bg-neutral-800 text-[10px] font-sans\">\n-              Cmd+J\n-            </kbd>\n-            ) and paste:\n-          </p>\n-          <div className=\"rounded-md border border-neutral-200 dark:border-neutral-800 bg-neutral-50 dark:bg-neutral-900 overflow-hidden\">\n-            <div className=\"flex items-center justify-between px-3 py-1.5 border-b border-neutral-200 dark:border-neutral-800 bg-neutral-100 dark:bg-neutral-800/50\">\n-              <span className=\"text-[10px] uppercase tracking-wide text-neutral-500\">\n-                Commands\n-              </span>\n-              {(maintenanceScriptValue || devScriptValue) && (\n-                <button\n-                  type=\"button\"\n-                  onClick={handleCopyCommands}\n-                  className={clsx(\n-                    \"p-0.5\",\n-                    commandsCopied\n-                      ? \"text-emerald-500\"\n-                      : \"text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-300\"\n-                  )}\n-                >\n-                  {commandsCopied ? (\n-                    <Check className=\"h-3 w-3\" />\n-                  ) : (\n-                    <Copy className=\"h-3 w-3\" />\n-                  )}\n-                </button>\n-              )}\n-            </div>\n-            <pre className=\"px-3 py-2 text-[11px] font-mono text-neutral-900 dark:text-neutral-100 overflow-x-auto whitespace-pre-wrap break-all select-all\">\n-              {maintenanceScriptValue || devScriptValue ? (\n-                [maintenanceScript.trim(), devScript.trim()]\n-                  .filter(Boolean)\n-                  .join(\" && \")\n-              ) : (\n-                <span className=\"text-neutral-400 italic\">\n-                  Enter scripts above to see commands\n-                </span>\n-              )}\n-            </pre>\n-          </div>\n-          <label className=\"flex items-center gap-1.5 text-[11px] text-neutral-500 dark:text-neutral-400 cursor-pointer hover:text-neutral-700 dark:hover:text-neutral-300\">\n-            <input\n-              type=\"checkbox\"\n-              checked={runConfirmed}\n-              onChange={(e) => setRunConfirmed(e.target.checked)}\n-              className=\"h-3.5 w-3.5 rounded border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-950 text-emerald-500 focus:ring-2 focus:ring-emerald-500/40\"\n-            />\n-            Proceed once dev script is running\n-          </label>\n-        </div>\n-      </details>\n-    </div>\n-  );\n-\n-  const renderStep2Content = () => (\n-    <div className=\"space-y-5\">\n-      {/* Browser Setup Info */}\n-      <details\n-        className=\"group\"\n-        open={isBrowserSetupSectionOpen}\n-        onToggle={(e) => setIsBrowserSetupSectionOpen(e.currentTarget.open)}\n-      >\n-        <summary className=\"flex items-center gap-2 cursor-pointer list-none\">\n-          <ChevronDown className=\"h-3.5 w-3.5 text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\" />\n-          <StepBadge step={5} done={browserConfirmed} />\n-          <span className=\"text-[13px] font-medium text-neutral-900 dark:text-neutral-100\">\n-            Configure browser\n-          </span>\n-        </summary>\n-        <div className=\"mt-3 ml-6 space-y-3\">\n-          <p className=\"text-[11px] text-neutral-500 dark:text-neutral-400\">\n-            Use the browser on the right to set up authentication:\n-          </p>\n-          <ul className=\"space-y-2 text-[11px] text-neutral-600 dark:text-neutral-400\">\n-            <li className=\"flex items-start gap-2\">\n-              <span className=\"flex h-4 w-4 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-500 dark:text-neutral-400 flex-shrink-0 mt-0.5\">\n-                1\n-              </span>\n-              <span>Sign in to any dashboards or SaaS tools</span>\n-            </li>\n-            <li className=\"flex items-start gap-2\">\n-              <span className=\"flex h-4 w-4 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-500 dark:text-neutral-400 flex-shrink-0 mt-0.5\">\n-                2\n-              </span>\n-              <span>Dismiss cookie banners, popups, or MFA prompts</span>\n-            </li>\n-            <li className=\"flex items-start gap-2\">\n-              <span className=\"flex h-4 w-4 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-500 dark:text-neutral-400 flex-shrink-0 mt-0.5\">\n-                3\n-              </span>\n-              <span>\n-                Navigate to your dev server URL (e.g., localhost:3000)\n-              </span>\n-            </li>\n-          </ul>\n-          <label className=\"flex items-center gap-1.5 text-[11px] text-neutral-500 dark:text-neutral-400 cursor-pointer hover:text-neutral-700 dark:hover:text-neutral-300 pt-1\">\n-            <input\n-              type=\"checkbox\"\n-              checked={browserConfirmed}\n-              onChange={(e) => setBrowserConfirmed(e.target.checked)}\n-              className=\"h-3.5 w-3.5 rounded border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-950 text-emerald-500 focus:ring-2 focus:ring-emerald-500/40\"\n-            />\n-            Browser is set up properly\n-          </label>\n-        </div>\n-      </details>\n-\n-      {/* Note about terminal */}\n-      <div className=\"rounded-md border border-amber-200 dark:border-amber-900/50 bg-amber-50 dark:bg-amber-950/20 px-3 py-2.5\">\n-        <p className=\"text-[11px] text-amber-800 dark:text-amber-200\">\n-          <strong>Note:</strong> Running terminals will be stopped on save. The\n-          maintenance and dev scripts run automatically on each preview.\n+        <p className={clsx(\"text-xs text-neutral-400 mt-4\", compact ? \"pl-5\" : \"pl-6\")}>\n+          Tip: Paste a .env file to auto-fill\n         </p>\n-      </div>\n-    </div>\n-  );\n-\n-  const renderPreviewPanel = () => {\n-    const isVscodeStep = currentStep === 1;\n-    const placeholder = isVscodeStep\n-      ? workspacePlaceholder\n-      : browserPlaceholder;\n-    const iframeKey = isVscodeStep ? vscodePersistKey : browserPersistKey;\n+      </details>\n+    );\n+  };\n \n+  // Render the initial setup content (framework, scripts, env vars - all shown at once)\n+  const renderInitialSetupContent = () => {\n     return (\n-      <div className=\"h-full flex flex-col overflow-hidden relative\">\n-        {placeholder ? (\n-          <div className=\"absolute inset-0 flex flex-col items-center justify-center gap-2 px-4 text-center text-neutral-500 dark:text-neutral-400\">\n-            <div className=\"text-sm font-medium text-neutral-600 dark:text-neutral-200\">\n-              {placeholder.title}\n-            </div>\n-            {placeholder.description ? (\n-              <p className=\"text-xs text-neutral-500 dark:text-neutral-400\">\n-                {placeholder.description}\n-              </p>\n-            ) : null}\n-          </div>\n-        ) : null}\n-        <div\n-          className={clsx(\n-            \"absolute inset-0\",\n-            placeholder ? \"opacity-0\" : \"opacity-100\"\n-          )}\n-          data-iframe-target={iframeKey}\n+      <div className=\"space-y-6\">\n+        {/* Framework Preset */}\n+        <FrameworkPresetSelect\n+          value={frameworkPreset}\n+          onValueChange={handleFrameworkPresetChange}\n         />\n+\n+        {/* Maintenance and Dev Scripts - Always expanded on initial setup */}\n+        {renderScriptsSection({ defaultOpen: true })}\n+\n+        {/* Environment Variables - Always expanded on initial setup */}\n+        {renderEnvVarsSection({ defaultOpen: true })}\n       </div>\n     );\n   };\n \n-  return (\n-    <div className=\"flex h-screen overflow-hidden bg-neutral-50 dark:bg-neutral-950 font-sans text-[15px] leading-6\">\n-      {/* Left: Configuration Form */}\n-      <div className=\"w-[420px] flex flex-col overflow-hidden border-r border-neutral-200 dark:border-neutral-800 bg-white dark:bg-black\">\n-        <div className=\"flex-shrink-0 px-5 pt-4 pb-2\">\n-          <Link\n-            href=\"/preview\"\n-            className=\"inline-flex items-center gap-1 text-[11px] text-neutral-500 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-neutral-100 mb-3\"\n-          >\n-            <ArrowLeft className=\"h-3 w-3\" />\n-            Go to preview.new\n-          </Link>\n-          <h1 className=\"text-base font-semibold text-neutral-900 dark:text-neutral-100 tracking-tight\">\n-            Configure environment\n-          </h1>\n-        </div>\n-\n-        <div className=\"flex-1 overflow-y-auto px-5 pb-5\">\n-          {currentStep === 1 ? renderStep1Content() : renderStep2Content()}\n-        </div>\n+  // Render all config steps in sidebar (completed ones collapsed, current one expanded, future ones hidden)\n+  const renderWorkspaceStepContent = () => {\n+    return (\n+      <div className=\"space-y-4\">\n+        {/* Step 1: Scripts (completed from initial setup - collapsed) */}\n+        {isStepVisible(\"scripts\") && (\n+          <div>\n+            {renderScriptsSection({ compact: true, defaultOpen: !isStepCompleted(\"scripts\"), showStepBadge: true, stepNumber: 1, isDone: isStepCompleted(\"scripts\") })}\n+          </div>\n+        )}\n \n-        <div className=\"flex-shrink-0 border-t border-neutral-200 dark:border-neutral-800 p-6 bg-white dark:bg-black\">\n-          {errorMessage && (\n-            <div className=\"rounded-md bg-red-50 dark:bg-red-950/20 border border-red-200 dark:border-red-900/50 p-3 mb-4\">\n-              <p className=\"text-sm text-red-600 dark:text-red-400\">\n-                {errorMessage}\n-              </p>\n-            </div>\n-          )}\n+        {/* Step 2: Environment Variables (completed from initial setup - collapsed) */}\n+        {isStepVisible(\"env-vars\") && (\n+          <div>\n+            {renderEnvVarsSection({ compact: true, defaultOpen: !isStepCompleted(\"env-vars\"), showStepBadge: true, stepNumber: 2, isDone: isStepCompleted(\"env-vars\") })}\n+          </div>\n+        )}\n \n-          <div className=\"flex items-center justify-between gap-3\">\n-            {currentStep > 1 ? (\n+        {/* Step 3: Run Scripts */}\n+        {isStepVisible(\"run-scripts\") && (\n+          <div>\n+            <details\n+              className=\"group\"\n+              open={isCurrentStep(\"run-scripts\")}\n+            >\n+              <summary\n+                className={clsx(\n+                  \"flex items-center gap-2 list-none\",\n+                  isSaving ? \"cursor-not-allowed opacity-60\" : \"cursor-pointer\"\n+                )}\n+                onClick={(e) => {\n+                  if (isSaving) return;\n+                  if (isStepCompleted(\"run-scripts\") && !isCurrentStep(\"run-scripts\")) {\n+                    e.preventDefault();\n+                    handleGoToStep(\"run-scripts\");\n+                  }\n+                }}\n+              >\n+                <ChevronDown className=\"h-3.5 w-3.5 text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\" />\n+                <StepBadge step={3} done={isStepCompleted(\"run-scripts\") && !isCurrentStep(\"run-scripts\")} />\n+                <span className=\"text-[13px] font-medium text-neutral-900 dark:text-neutral-100\">\n+                  Run scripts in VS Code terminal\n+                </span>\n+              </summary>\n+              <div className=\"mt-3 ml-6 space-y-3\">\n+                <p className=\"text-[11px] text-neutral-500 dark:text-neutral-400\">\n+                  Setup VS Code development environment. Open terminal (\n+                  <kbd className=\"px-1 py-0.5 rounded bg-neutral-100 dark:bg-neutral-800 text-[10px] font-sans\">\n+                    Ctrl+Shift+`\n+                  </kbd>{\" \"}\n+                  or{\" \"}\n+                  <kbd className=\"px-1 py-0.5 rounded bg-neutral-100 dark:bg-neutral-800 text-[10px] font-sans\">\n+                    Cmd+J\n+                  </kbd>\n+                  ) and paste:\n+                </p>\n+                <div className=\"rounded-md border border-neutral-200 dark:border-neutral-800 bg-neutral-50 dark:bg-neutral-900 overflow-hidden\">\n+                  <div className=\"flex items-center justify-between px-3 py-1.5 border-b border-neutral-200 dark:border-neutral-800 bg-neutral-100 dark:bg-neutral-800/50\">\n+                    <span className=\"text-[10px] uppercase tracking-wide text-neutral-500\">\n+                      Commands\n+                    </span>\n+                    {(maintenanceScript.trim() || devScript.trim()) && (\n+                      <button\n+                        type=\"button\"\n+                        onClick={handleCopyCommands}\n+                        className={clsx(\n+                          \"p-0.5\",\n+                          commandsCopied\n+                            ? \"text-emerald-500\"\n+                            : \"text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-300\"\n+                        )}\n+                      >\n+                        {commandsCopied ? <Check className=\"h-3 w-3\" /> : <Copy className=\"h-3 w-3\" />}\n+                      </button>\n+                    )}\n+                  </div>\n+                  <pre className=\"px-3 py-2 text-[11px] font-mono text-neutral-900 dark:text-neutral-100 overflow-x-auto whitespace-pre-wrap break-all select-all\">\n+                    {maintenanceScript.trim() || devScript.trim() ? (\n+                      [maintenanceScript.trim(), devScript.trim()].filter(Boolean).join(\" && \")\n+                    ) : (\n+                      <span className=\"text-neutral-400 italic\">No scripts configured</span>\n+                    )}\n+                  </pre>\n+                </div>\n+                <p className=\"text-[11px] text-neutral-500 dark:text-neutral-400\">\n+                  Proceed once dev script is running.\n+                </p>\n+              </div>\n+            </details>\n+            {/* Continue button outside chevron */}\n+            {isCurrentStep(\"run-scripts\") && (\n               <button\n                 type=\"button\"\n-                onClick={handlePrevStep}\n-                className=\"inline-flex items-center gap-2 rounded-md border border-neutral-200 dark:border-neutral-800 px-4 py-2 text-sm font-medium text-neutral-700 dark:text-neutral-300 hover:bg-neutral-50 dark:hover:bg-neutral-900 transition\"\n+                onClick={handleNextConfigStep}\n+                className=\"w-full mt-4 inline-flex items-center justify-center gap-2 rounded-md bg-neutral-900 dark:bg-neutral-100 text-white dark:text-neutral-900 px-4 py-2 text-sm font-semibold hover:bg-neutral-800 dark:hover:bg-neutral-200 transition cursor-pointer\"\n               >\n-                <ArrowLeft className=\"w-4 h-4\" />\n-                Back\n+                Continue\n+                <ArrowRight className=\"w-4 h-4\" />\n               </button>\n-            ) : (\n-              <div />\n             )}\n+          </div>\n+        )}\n \n-            {currentStep < 2 ? (\n-              <button\n-                type=\"button\"\n-                onClick={handleNextStep}\n-                className=\"inline-flex items-center gap-2 rounded-md bg-neutral-900 dark:bg-neutral-100 text-white dark:text-neutral-900 px-4 py-2 text-sm font-semibold hover:bg-neutral-800 dark:hover:bg-neutral-200 transition cursor-pointer\"\n+        {/* Step 4: Browser Setup */}\n+        {isStepVisible(\"browser-setup\") && (\n+          <div>\n+            <details\n+              className=\"group\"\n+              open={isCurrentStep(\"browser-setup\")}\n+            >\n+              <summary\n+                className={clsx(\n+                  \"flex items-center gap-2 list-none\",\n+                  isSaving ? \"cursor-not-allowed opacity-60\" : \"cursor-pointer\"\n+                )}\n+                onClick={(e) => {\n+                  if (isSaving) return;\n+                  if (isStepCompleted(\"browser-setup\") && !isCurrentStep(\"browser-setup\")) {\n+                    e.preventDefault();\n+                    handleGoToStep(\"browser-setup\");\n+                  }\n+                }}\n               >\n-                Next\n-                <ArrowRight className=\"w-4 h-4\" />\n-              </button>\n-            ) : (\n+                <ChevronDown className=\"h-3.5 w-3.5 text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\" />\n+                <StepBadge step={4} done={isStepCompleted(\"browser-setup\") && !isCurrentStep(\"browser-setup\")} />\n+                <span className=\"text-[13px] font-medium text-neutral-900 dark:text-neutral-100\">\n+                  Configure browser\n+                </span>\n+              </summary>\n+              <div className=\"mt-3 ml-6 space-y-3\">\n+                <p className=\"text-[11px] text-neutral-500 dark:text-neutral-400\">\n+                  Use the browser on the right to set up authentication:\n+                </p>\n+                <ul className=\"space-y-2 text-[11px] text-neutral-600 dark:text-neutral-400\">\n+                  <li className=\"flex items-start gap-2\">\n+                    <span className=\"flex h-4 w-4 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-500 dark:text-neutral-400 flex-shrink-0 mt-0.5\">1</span>\n+                    <span>Sign in to any dashboards or SaaS tools</span>\n+                  </li>\n+                  <li className=\"flex items-start gap-2\">\n+                    <span className=\"flex h-4 w-4 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-500 dark:text-neutral-400 flex-shrink-0 mt-0.5\">2</span>\n+                    <span>Dismiss cookie banners, popups, or MFA prompts</span>\n+                  </li>\n+                  <li className=\"flex items-start gap-2\">\n+                    <span className=\"flex h-4 w-4 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-500 dark:text-neutral-400 flex-shrink-0 mt-0.5\">3</span>\n+                    <span>Navigate to your dev server URL (e.g., localhost:3000)</span>\n+                  </li>\n+                </ul>\n+                <p className=\"text-[11px] text-neutral-500 dark:text-neutral-400\">\n+                  Proceed once browser is set up properly.\n+                </p>\n+              </div>\n+            </details>\n+            {/* Save button outside chevron */}\n+            {isCurrentStep(\"browser-setup\") && (\n               <button\n                 type=\"button\"\n                 onClick={handleSaveConfiguration}\n                 disabled={isSaving}\n-                className=\"inline-flex items-center justify-center rounded-md bg-neutral-900 dark:bg-neutral-100 text-white dark:text-neutral-900 px-4 py-2 text-sm font-semibold hover:bg-neutral-800 dark:hover:bg-neutral-200 transition disabled:opacity-50 disabled:cursor-not-allowed\"\n+                className=\"w-full mt-4 inline-flex items-center justify-center rounded-md bg-neutral-900 dark:bg-neutral-100 text-white dark:text-neutral-900 px-4 py-2 text-sm font-semibold hover:bg-neutral-800 dark:hover:bg-neutral-200 transition disabled:opacity-50 disabled:cursor-not-allowed\"\n               >\n                 {isSaving ? (\n                   <>\n@@ -1907,8 +1490,195 @@ export function PreviewConfigureClient({\n               </button>\n             )}\n           </div>\n+        )}\n+      </div>\n+    );\n+  };\n+\n+  // Initial setup panel (full page, shows framework, scripts, env vars)\n+  const renderInitialSetupPanel = () => (\n+    <div className=\"min-h-dvh bg-white dark:bg-black font-sans\">\n+      <div className=\"max-w-2xl mx-auto px-6 py-10\">\n+        {/* Back to preview.new link */}\n+        <div className=\"mb-3\">\n+          <Link\n+            href=\"/preview\"\n+            className=\"inline-flex items-center gap-1.5 text-xs text-neutral-500 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-neutral-100\"\n+          >\n+            <ArrowLeft className=\"h-3 w-3\" />\n+            Go to preview.new\n+          </Link>\n+        </div>\n+\n+        {/* Header */}\n+        <div className=\"mb-8\">\n+          <h1 className=\"text-2xl font-semibold text-neutral-900 dark:text-neutral-100 mb-1\">\n+            Configure workspace\n+          </h1>\n+          <div className=\"flex items-center gap-2 text-sm text-neutral-600 dark:text-neutral-400 pt-2\">\n+            <svg className=\"h-4 w-4 shrink-0\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n+              <path d=\"M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z\" />\n+            </svg>\n+            <span className=\"font-sans\">{repo}</span>\n+          </div>\n+        </div>\n+\n+        {/* Content */}\n+        {renderInitialSetupContent()}\n+\n+        {/* Error Message */}\n+        {errorMessage && (\n+          <div className=\"rounded-md bg-red-50 dark:bg-red-950/20 border border-red-200 dark:border-red-900/50 p-3 mt-6\">\n+            <p className=\"text-sm text-red-600 dark:text-red-400\">{errorMessage}</p>\n+          </div>\n+        )}\n+\n+        {/* Footer Button */}\n+        <div className=\"mt-8 pt-6 border-t border-neutral-200 dark:border-neutral-800\">\n+          <button\n+            type=\"button\"\n+            onClick={handleStartWorkspaceConfig}\n+            className={clsx(\n+              \"w-full inline-flex items-center justify-center gap-2 rounded-md px-5 py-2.5 text-sm font-semibold transition\",\n+              \"bg-neutral-900 dark:bg-neutral-100 text-white dark:text-neutral-900 hover:bg-neutral-800 dark:hover:bg-neutral-200 cursor-pointer\",\n+              !isWorkspaceReady && \"opacity-80\"\n+            )}\n+          >\n+            Continue\n+            <ArrowRight className=\"w-4 h-4\" />\n+          </button>\n+        </div>\n+      </div>\n+    </div>\n+  );\n+\n+  // Workspace config panel (sidebar, shows steps one at a time)\n+  const renderWorkspaceConfigPanel = () => (\n+    <div className=\"w-[420px] h-full flex flex-col overflow-hidden border-r border-neutral-200 dark:border-neutral-800 bg-white dark:bg-black\">\n+      <div className=\"flex-shrink-0 px-5 pt-4 pb-2\">\n+        <button\n+          type=\"button\"\n+          onClick={handleBackToInitialSetup}\n+          disabled={isSaving}\n+          className={clsx(\n+            \"inline-flex items-center gap-1 text-[11px] text-neutral-500 dark:text-neutral-400 mb-3\",\n+            isSaving\n+              ? \"opacity-50 cursor-not-allowed\"\n+              : \"hover:text-neutral-900 dark:hover:text-neutral-100\"\n+          )}\n+        >\n+          <ArrowLeft className=\"h-3 w-3\" />\n+          Back to project setup\n+        </button>\n+        <h1 className=\"text-base font-semibold text-neutral-900 dark:text-neutral-100 tracking-tight\">\n+          Configure workspace\n+        </h1>\n+        <div className=\"flex items-center gap-2 text-sm text-neutral-600 dark:text-neutral-400 pt-1\">\n+          <svg className=\"h-4 w-4 shrink-0\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n+            <path d=\"M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z\" />\n+          </svg>\n+          <span className=\"font-sans text-xs\">{repo}</span>\n+        </div>\n+        <p className=\"text-[11px] text-neutral-500 dark:text-neutral-400 leading-relaxed pt-3\">\n+          Your workspace root at{\" \"}\n+          <code className=\"px-1 py-0.5 rounded bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-700 dark:text-neutral-300\">\n+            /root/workspace\n+          </code>{\" \"}\n+          maps directly to your repo root.\n+        </p>\n+      </div>\n+\n+      <div className=\"flex-1 overflow-y-auto px-5 pb-5\">\n+        {renderWorkspaceStepContent()}\n+\n+        {errorMessage && (\n+          <div className=\"rounded-md bg-red-50 dark:bg-red-950/20 border border-red-200 dark:border-red-900/50 p-3 mt-4\">\n+            <p className=\"text-sm text-red-600 dark:text-red-400\">{errorMessage}</p>\n+          </div>\n+        )}\n+      </div>\n+    </div>\n+  );\n+\n+  // Initial setup layout (full page)\n+  if (layoutPhase === \"initial-setup\") {\n+    return renderInitialSetupPanel();\n+  }\n+\n+  // Show loading state if VSCode isn't ready (for both transitioning and workspace-config)\n+  if (!isWorkspaceReady) {\n+    return (\n+      <div className=\"flex min-h-dvh items-center justify-center bg-white dark:bg-black font-sans\">\n+        <div className=\"text-center px-6\">\n+          <Loader2 className=\"mx-auto h-8 w-8 animate-spin text-neutral-400\" />\n+          <h1 className=\"mt-4 text-lg font-medium text-neutral-900 dark:text-neutral-100\">\n+            Starting your VS Code workspace...\n+          </h1>\n+          <p className=\"mt-2 text-sm text-neutral-500 dark:text-neutral-400\">\n+            We&apos;ll show the configuration once your environment is ready.\n+          </p>\n+        </div>\n+      </div>\n+    );\n+  }\n+\n+  // Transitioning layout - animate the final sidebar from center position\n+  if (layoutPhase === \"transitioning\") {\n+    return (\n+      <div className=\"flex h-screen overflow-hidden bg-neutral-50 dark:bg-neutral-950 font-sans text-[15px] leading-6\">\n+        {/* Sidebar content animating from center */}\n+        <div className=\"preview-setup-transitioning h-full flex flex-col overflow-hidden border-r border-neutral-200 dark:border-neutral-800 bg-white dark:bg-black\">\n+          <div className=\"flex-shrink-0 px-5 pt-4 pb-2\">\n+            <button\n+              type=\"button\"\n+              onClick={handleBackToInitialSetup}\n+              disabled={isSaving}\n+              className={clsx(\n+                \"inline-flex items-center gap-1 text-[11px] text-neutral-500 dark:text-neutral-400 mb-3\",\n+                isSaving\n+                  ? \"opacity-50 cursor-not-allowed\"\n+                  : \"hover:text-neutral-900 dark:hover:text-neutral-100\"\n+              )}\n+            >\n+              <ArrowLeft className=\"h-3 w-3\" />\n+              Back to project setup\n+            </button>\n+            <h1 className=\"text-base font-semibold text-neutral-900 dark:text-neutral-100 tracking-tight\">\n+              Configure workspace\n+            </h1>\n+            <div className=\"flex items-center gap-2 text-sm text-neutral-600 dark:text-neutral-400 pt-1\">\n+              <svg className=\"h-4 w-4 shrink-0\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n+                <path d=\"M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z\" />\n+              </svg>\n+              <span className=\"font-sans text-xs\">{repo}</span>\n+            </div>\n+            <p className=\"text-[11px] text-neutral-500 dark:text-neutral-400 leading-relaxed pt-3\">\n+              Your workspace root at{\" \"}\n+              <code className=\"px-1 py-0.5 rounded bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-700 dark:text-neutral-300\">\n+                /root/workspace\n+              </code>{\" \"}\n+              maps directly to your repo root.\n+            </p>\n+          </div>\n+\n+          <div className=\"flex-1 overflow-y-auto px-5 pb-5\">\n+            {renderWorkspaceStepContent()}\n+          </div>\n+        </div>\n+\n+        {/* Preview panel fading in */}\n+        <div className=\"preview-panel-entering flex-1 flex flex-col bg-neutral-950 overflow-hidden\">\n+          {renderPreviewPanel()}\n         </div>\n       </div>\n+    );\n+  }\n+\n+  // Workspace config layout (split with sidebar + preview)\n+  return (\n+    <div className=\"flex h-screen overflow-hidden bg-neutral-50 dark:bg-neutral-950 font-sans text-[15px] leading-6\">\n+      {/* Left: Configuration Form */}\n+      {renderWorkspaceConfigPanel()}\n \n       {/* Right: Preview Panel */}\n       <div className=\"flex-1 flex flex-col bg-neutral-950 overflow-hidden\">\n","comments":[{"type":"issue_comment","id":3605197044,"prNumber":1124,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn77rd83m1f0r74wjsjqt37j7h7wjatx?src=preview.new) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn77rd83m1f0r74wjsjqt37j7h7wjatx/browser?src=preview.new) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1124?src=preview.new)\n\nCaptured 10 screenshots for commit `7721808` (2025-12-03 05:47:48.132 UTC).\n\n**Initial setup page - full page view showing the Configure workspace form with Framework Preset dropdown, Maintenance and Dev Scripts sections, and Environment Variables section all expanded**\n\n![01-initial-setup-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/dea8a84a-80a1-47be-a121-1565841550bc)\n\n**Initial setup page - viewport view showing the top portion of the configuration form including the framework preset selector with icon**\n\n![02-initial-setup-viewport.png](https://adorable-wombat-701.convex.cloud/api/storage/6d2a959a-605f-46f8-875d-55a2739b3386)\n\n**Framework preset selector UI component showing the 'Other' preset selected with icon and description text 'Autofills install and dev scripts'**\n\n![03-framework-preset-dropdown.png](https://adorable-wombat-701.convex.cloud/api/storage/ab3705c8-646b-4d62-8627-cf7bcc7c102c)\n\n**Configuration form with the scripts section in a different state**\n\n![04-scripts-section-collapsed.png](https://adorable-wombat-701.convex.cloud/api/storage/c3042f79-7761-4ffa-8b70-8c873d51b222)\n\n**Error state shown when attempting to provision sandbox: 'Failed to hydrate sandbox' with Retry button**\n\n![05-error-state.png](https://adorable-wombat-701.convex.cloud/api/storage/29cdf159-bc56-4672-9dfa-b9efd2464dc5)\n\n**Loading state when transitioning to workspace configuration view: 'Starting your VS Code workspace...' with descriptive text about showing configuration once environment is ready**\n\n![06-workspace-config-loading.png](https://adorable-wombat-701.convex.cloud/api/storage/22affa26-cd96-4ee4-b8e0-f23cdd185bb0)\n\n**Environment Variables section with filled values showing name/value input fields for database configuration**\n\n![07-env-vars-filled.png](https://adorable-wombat-701.convex.cloud/api/storage/8fd368bb-a7e8-4f1c-b8aa-fce6b245ded7)\n\n**Environment Variables section showing the hide/reveal values functionality**\n\n![08-env-vars-hidden.png](https://adorable-wombat-701.convex.cloud/api/storage/8e42ac36-9a86-4a03-917a-66219487f5b7)\n\n**Complete configuration form - full page view with all sections visible and interactive elements**\n\n![09-all-fields-filled-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/23c57569-e13c-43df-9865-86fdd4b5bf79)\n\n**Bottom section of the form showing the Continue button that transitions to the workspace configuration step-by-step flow**\n\n![10-initial-setup-continue-button.png](https://adorable-wombat-701.convex.cloud/api/storage/043b4e88-c4e4-42d5-85ba-80cae9d59ed6)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"ee59b001372a0c8064a9fc107b740757b6da311c","createdAt":"2025-12-03T05:47:48Z","updatedAt":"2025-12-03T06:00:44Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1124#issuecomment-3605197044"},{"type":"issue_comment","id":3605228268,"prNumber":1124,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn70f4jdfw4qp0xr2pr4dznj9s7wkc2n?src=preview.new) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn70f4jdfw4qp0xr2pr4dznj9s7wkc2n/browser?src=preview.new) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1124?src=preview.new)\n\nCaptured 16 screenshots for commit `b7fdfc8` (2025-12-03 06:00:42.224 UTC).\n\n**Back navigation - Returned to initial setup page from workspace config showing the transition works bidirectionally**\n\n![back-to-initial-setup.png](https://adorable-wombat-701.convex.cloud/api/storage/9122f8a3-1cfa-4c22-a492-85a39f1aee10)\n\n**Initial setup page - full page centered layout with framework preset, maintenance/dev scripts, and environment variables sections**\n\n![configure-initial-setup-full.png](https://adorable-wombat-701.convex.cloud/api/storage/6e2b8e70-68b5-42c1-959d-8197670f5063)\n\n**Initial setup page - viewport view showing the centered form with all configuration options visible at once**\n\n![configure-initial-setup-viewport.png](https://adorable-wombat-701.convex.cloud/api/storage/d4fe25cb-5faf-4894-93f6-65854777a560)\n\n**Environment variables with reveal/hide values toggle - showing values in plain text**\n\n![environment-variables-revealed.png](https://adorable-wombat-701.convex.cloud/api/storage/40cb7729-cea8-43bb-a31a-258baa797069)\n\n**Environment variables section showing name/value input fields with add/remove buttons**\n\n![environment-variables-section.png](https://adorable-wombat-701.convex.cloud/api/storage/c8f5559c-9bfc-4482-854d-0bfc3a65403e)\n\n**Environment variables populated with DATABASE_URL example data**\n\n![environment-variables-with-data.png](https://adorable-wombat-701.convex.cloud/api/storage/09c56651-d13a-40fc-8fa5-c7ccfab0c36f)\n\n**Framework preset dropdown expanded showing options: Next.js, Vite, Remix, Nuxt, SvelteKit, Angular, Create React App, Vue, and Other**\n\n![framework-preset-dropdown-open.png](https://adorable-wombat-701.convex.cloud/api/storage/29f9fa72-9570-48c2-8e3f-b88189344709)\n\n**Framework preset selector component showing Next.js selected**\n\n![framework-preset-selector.png](https://adorable-wombat-701.convex.cloud/api/storage/3f40bab2-851f-487d-9af0-807984ba8283)\n\n**Preview dashboard main page showing repository configuration options**\n\n![preview-dashboard-page.png](https://adorable-wombat-701.convex.cloud/api/storage/b66c7c7c-b1be-4529-b5d4-7fb95f6b42c6)\n\n**Sidebar detail - Step 3 showing instructions to run scripts in VS Code terminal with copy button for commands**\n\n![sidebar-step3-run-scripts.png](https://adorable-wombat-701.convex.cloud/api/storage/c7687abc-05f1-4d41-9cce-c8def267c7e5)\n\n**Sidebar detail - Step 4 browser configuration instructions with numbered steps and Save configuration button**\n\n![sidebar-step4-browser-config.png](https://adorable-wombat-701.convex.cloud/api/storage/48472ea4-79a7-4950-b9c3-e560038f87ef)\n\n**Sidebar showing collapsed Maintenance/Dev Scripts and Environment Variables sections from initial setup**\n\n![sidebar-with-collapsed-sections.png](https://adorable-wombat-701.convex.cloud/api/storage/2cb21a09-ed99-46fd-bd0b-948e180f7d9d)\n\n**Step 4 - Browser setup with right panel switched from VS Code to noVNC browser session for authentication setup**\n\n![step4-browser-setup-full.png](https://adorable-wombat-701.convex.cloud/api/storage/0b0a6ce0-7d69-4da1-8c56-3482b4d7f0f8)\n\n**Step 4 viewport - Browser configuration step showing instructions and embedded noVNC browser preview**\n\n![step4-browser-setup-viewport.png](https://adorable-wombat-701.convex.cloud/api/storage/5a1b12df-c117-4cb3-9d63-89d68d83404e)\n\n**NEW LAYOUT - Workspace configuration split view with left sidebar (420px) showing step-by-step config and right panel showing embedded VS Code**\n\n![workspace-config-layout-full.png](https://adorable-wombat-701.convex.cloud/api/storage/513ac8d9-479f-47be-bd3e-9a99af9bde7d)\n\n**NEW LAYOUT - Workspace config viewport showing the sidebar with collapsed previous steps and current step (Run scripts in VS Code terminal) expanded**\n\n![workspace-config-layout-viewport.png](https://adorable-wombat-701.convex.cloud/api/storage/0f73f001-a9dd-4b3e-8cfc-09eaec785fe8)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"ee59b001372a0c8064a9fc107b740757b6da311c","createdAt":"2025-12-03T06:00:43Z","updatedAt":"2025-12-03T06:01:01Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1124#issuecomment-3605228268"},{"type":"issue_comment","id":3605229107,"prNumber":1124,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7e9af1atffk9qxwg5cb4et757wjp6t?src=preview.new) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7e9af1atffk9qxwg5cb4et757wjp6t/browser?src=preview.new) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1124?src=preview.new)\n\nCaptured 21 screenshots for commit `b7fdfc8` (2025-12-03 06:00:57.810 UTC).\n\n**Initial setup page - full view showing framework preset, maintenance scripts, dev scripts, and environment variables all in one page**\n\n![01-initial-setup-full-page.png](https://famous-camel-162.convex.cloud/api/storage/80af2566-f62c-49b9-985a-91a601d6980e)\n\n**Initial setup page - viewport view**\n\n![02-initial-setup-viewport.png](https://famous-camel-162.convex.cloud/api/storage/826b1914-42a0-4e99-9788-fe828991c469)\n\n**Framework preset selector dropdown component**\n\n![03-framework-preset-selector.png](https://famous-camel-162.convex.cloud/api/storage/105a3714-4e17-48d0-b03b-7c668afa409e)\n\n**Maintenance and Dev Scripts section expanded in initial setup**\n\n![04-scripts-section-expanded.png](https://famous-camel-162.convex.cloud/api/storage/95643aee-f6af-4a89-a82d-656ba3e9e872)\n\n**Environment Variables section expanded in initial setup**\n\n![05-env-vars-section-expanded.png](https://famous-camel-162.convex.cloud/api/storage/49908176-c811-4459-9c15-3fce0b1c7acc)\n\n**Workspace config phase - full page showing sidebar with step-by-step configuration and VS Code workspace on the right (Step 3: Run scripts)**\n\n![06-workspace-config-step3-full-page.png](https://famous-camel-162.convex.cloud/api/storage/4e63655a-afa3-4054-9c59-510e67a0ce95)\n\n**Workspace config phase - viewport showing split layout with sidebar and VS Code**\n\n![07-workspace-config-step3-viewport.png](https://famous-camel-162.convex.cloud/api/storage/cf25e466-6790-4e02-8ee4-4873a278fb81)\n\n**Step 1 (Scripts) in collapsed state showing step badge and checkmark**\n\n![08-step1-scripts-collapsed.png](https://famous-camel-162.convex.cloud/api/storage/b6d64102-f503-4321-992f-9f3aadd952ad)\n\n**Step 2 (Environment Variables) in collapsed state showing step badge and checkmark**\n\n![09-step2-envvars-collapsed.png](https://famous-camel-162.convex.cloud/api/storage/608728de-20b2-46da-b685-b976dd0eda9f)\n\n**Step 3 (Run scripts in VS Code terminal) expanded showing command to copy and terminal instructions**\n\n![10-step3-run-scripts-expanded.png](https://famous-camel-162.convex.cloud/api/storage/717e3034-7754-4ecb-854f-4f40383d0969)\n\n**Step 1 (Scripts) expanded in workspace config showing reused component from initial setup with compact styling**\n\n![11-step1-scripts-expanded.png](https://famous-camel-162.convex.cloud/api/storage/1c9f9379-01f0-4562-8612-ce4abfc7a59b)\n\n**Step 2 (Environment Variables) expanded in workspace config showing reused component with compact styling**\n\n![12-step2-envvars-expanded.png](https://famous-camel-162.convex.cloud/api/storage/7940cc2e-e242-4481-95a6-5c38e4e5545b)\n\n**All configuration sections expanded simultaneously in workspace config sidebar**\n\n![13-all-sections-expanded-full-page.png](https://famous-camel-162.convex.cloud/api/storage/25072534-b4c8-469a-861e-43883c5469ed)\n\n**Step 4 (Configure browser) - full page showing sidebar with browser setup instructions and noVNC browser preview on the right**\n\n![14-browser-setup-step4-full-page.png](https://famous-camel-162.convex.cloud/api/storage/e335a296-c287-4358-8526-468490911e27)\n\n**Step 4 (Configure browser) - viewport showing split layout with sidebar and browser preview**\n\n![15-browser-setup-step4-viewport.png](https://famous-camel-162.convex.cloud/api/storage/bc59ca9e-03ca-4ed5-823e-6ef6d79bb773)\n\n**Step 4 browser configuration section expanded showing authentication setup instructions**\n\n![16-step4-configure-browser-expanded.png](https://famous-camel-162.convex.cloud/api/storage/4f7e3921-b461-43b3-ab9c-73a4293af20b)\n\n**Back to initial setup page after clicking 'Back to project setup' button, demonstrating reverse navigation**\n\n![17-back-to-initial-setup-full-page.png](https://famous-camel-162.convex.cloud/api/storage/e7496468-d87d-4c08-9b54-b5f834033c51)\n\n**Back to initial setup viewport view**\n\n![18-back-to-initial-setup-viewport.png](https://famous-camel-162.convex.cloud/api/storage/f3bf1b55-9043-418f-b1bc-df031326de18)\n\n**Initial setup with scripts section collapsed, showing collapsible behavior**\n\n![19-scripts-section-collapsed.png](https://famous-camel-162.convex.cloud/api/storage/88683696-5cc8-4eea-8afa-83656b80b0e5)\n\n**Initial setup with both scripts and environment variables sections collapsed**\n\n![20-both-sections-collapsed.png](https://famous-camel-162.convex.cloud/api/storage/ad816aa4-1135-4d35-9a3c-492b94f307be)\n\n**Framework preset dropdown menu open showing all available presets (Next.js, Vite, Remix, Nuxt, etc.)**\n\n![21-framework-preset-dropdown-open.png](https://famous-camel-162.convex.cloud/api/storage/2279dd5e-5c86-4a93-86c6-e9b68a527b95)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"ee59b001372a0c8064a9fc107b740757b6da311c","createdAt":"2025-12-03T06:01:00Z","updatedAt":"2025-12-03T06:19:27Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1124#issuecomment-3605229107"},{"type":"issue_comment","id":3605275595,"prNumber":1124,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn70w6nfpkncjmkrc5fa1eghhx7wkh5f?src=preview.new) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn70w6nfpkncjmkrc5fa1eghhx7wkh5f/browser?src=preview.new) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1124?src=preview.new)\n\nCaptured 16 screenshots for commit `382d2b4` (2025-12-03 06:19:25.464 UTC).\n\n**Initial setup page - full view showing framework preset, maintenance/dev scripts, and environment variables sections all expanded**\n\n![01-initial-setup-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/eae19c86-f2c7-44a7-8d7b-1134186e4804)\n\n**Framework preset selector dropdown showing 'Next.js' selected with autofill description**\n\n![02-framework-preset-selector.png](https://adorable-wombat-701.convex.cloud/api/storage/3148a518-4e40-4be8-8c18-2afe5011c337)\n\n**Maintenance and Dev Scripts section with collapsible disclosure triangle, showing textareas for both scripts**\n\n![03-maintenance-dev-scripts-section.png](https://adorable-wombat-701.convex.cloud/api/storage/7c6c1b7b-31e3-41c9-9e1c-a520bf2c040f)\n\n**Environment Variables section with reveal/hide values button, name/value input fields, and paste .env hint**\n\n![04-environment-variables-section.png](https://adorable-wombat-701.convex.cloud/api/storage/725e02d7-44d3-40f7-8270-739ef4d3baff)\n\n**Workspace configuration step 3 - split layout with sidebar on left showing step-by-step config and VS Code workspace on right**\n\n![05-workspace-config-step3-run-scripts-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/22ab38ec-eceb-4e65-8baa-f5b6ed41776d)\n\n**Sidebar in workspace config mode showing back button, configure workspace header, and repo info**\n\n![06-workspace-config-sidebar-left.png](https://adorable-wombat-701.convex.cloud/api/storage/16127fbd-ef77-42ae-a22a-581732327685)\n\n**Step 3 'Run scripts in VS Code terminal' expanded showing commands to paste with copy button and keyboard shortcuts**\n\n![07-step3-run-scripts-section.png](https://adorable-wombat-701.convex.cloud/api/storage/ae9f8d11-5267-488b-bed1-509524cddbe2)\n\n**Step 1 'Maintenance and Dev Scripts' collapsed with checkmark badge indicating completion**\n\n![08-step1-scripts-collapsed.png](https://adorable-wombat-701.convex.cloud/api/storage/7ef786de-2d5e-4ed7-a1fd-3cff4a57e868)\n\n**Step 2 'Environment Variables' collapsed with checkmark badge and reveal values button**\n\n![09-step2-env-vars-collapsed.png](https://adorable-wombat-701.convex.cloud/api/storage/bab9e819-522c-4203-afb3-1e555e8d9ed7)\n\n**Workspace configuration step 4 - split layout showing sidebar on left and browser (noVNC) on right for browser setup**\n\n![10-workspace-config-step4-browser-setup-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/ad74cadf-dab2-4cc5-b9b1-1b44e6fc3975)\n\n**Step 4 'Configure browser' section showing numbered authentication setup instructions**\n\n![11-step4-browser-setup-section.png](https://adorable-wombat-701.convex.cloud/api/storage/4df95212-59c5-44da-a4c7-43590b76d45d)\n\n**Save configuration button at the final step of workspace setup**\n\n![12-save-configuration-button.png](https://adorable-wombat-701.convex.cloud/api/storage/b4cad8e1-1977-4d72-a84f-b0df054da8fc)\n\n**Back navigation to initial setup page showing all configuration sections re-expanded**\n\n![13-back-to-initial-setup.png](https://adorable-wombat-701.convex.cloud/api/storage/992fc3e9-7026-470b-a84a-adcbbbd8b520)\n\n**Initial setup with Maintenance and Dev Scripts section collapsed**\n\n![14-scripts-section-collapsed.png](https://adorable-wombat-701.convex.cloud/api/storage/ab2731c0-924b-4676-aa3c-bd57bd735f22)\n\n**Initial setup with both scripts and environment variables sections collapsed**\n\n![15-both-sections-collapsed.png](https://adorable-wombat-701.convex.cloud/api/storage/1159faf1-f1be-4225-95f3-cdc78909f3af)\n\n**Framework preset dropdown menu opened showing all available framework options (Next.js, Vite, Remix, etc.)**\n\n![16-framework-preset-dropdown-open.png](https://adorable-wombat-701.convex.cloud/api/storage/6db608a9-f278-444e-ae6a-bcb327c35220)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"ee59b001372a0c8064a9fc107b740757b6da311c","createdAt":"2025-12-03T06:19:26Z","updatedAt":"2025-12-03T06:33:33Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1124#issuecomment-3605275595"},{"type":"issue_comment","id":3605309424,"prNumber":1124,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn7a6ndbz6jjmz1tt2738mp3ch7wjbx1?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn7a6ndbz6jjmz1tt2738mp3ch7wjbx1/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1124?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 9 screenshots for commit `888b8ab` (2025-12-03 06:33:31.703 UTC).\n\n**Initial setup page showing framework preset selection, maintenance/dev scripts configuration, and environment variables section in a centered full-page layout**\n\n![01-initial-setup-page.png](https://adorable-wombat-701.convex.cloud/api/storage/5422c214-9996-4254-985a-4f72b436a82e)\n\n**Framework preset dropdown expanded showing options: Other, Next.js, Vite, Remix, Nuxt, SvelteKit, Angular, Create React App, and Vue**\n\n![02-framework-preset-dropdown.png](https://adorable-wombat-701.convex.cloud/api/storage/bc9c38dc-fe83-4d53-b779-dd16979d4699)\n\n**Workspace configuration view after transition showing sidebar on left with step 3 (Run scripts in VS Code terminal) and VS Code workspace embedded on the right side**\n\n![03-workspace-config-step-1-run-scripts.png](https://adorable-wombat-701.convex.cloud/api/storage/2e182f20-b127-48c2-859d-337d39024afb)\n\n**Workspace configuration with all sections expanded in the sidebar, showing the maintenance/dev scripts section and environment variables section alongside the VS Code workspace**\n\n![04-workspace-config-expanded-sections.png](https://adorable-wombat-701.convex.cloud/api/storage/d683d713-998b-4062-abb6-0cc7446d9d2f)\n\n**Step 4 of workspace configuration showing browser setup instructions in the left sidebar with noVNC browser preview embedded on the right side**\n\n![05-workspace-config-step-2-browser-setup.png](https://adorable-wombat-701.convex.cloud/api/storage/a51461ea-8cdd-4f51-bcd2-1751b25695e8)\n\n**Returned to initial setup page showing the full-page centered layout with all configuration sections expanded**\n\n![06-back-to-initial-setup.png](https://adorable-wombat-701.convex.cloud/api/storage/e9b6a377-d02d-4a50-af13-9a0a20c1ad1c)\n\n**Environment variables section with values visible and 'Hide values' button showing the eye icon toggle feature**\n\n![07-env-vars-visible.png](https://adorable-wombat-701.convex.cloud/api/storage/4493b34d-6ad8-4b21-aab6-afc10769686e)\n\n**Environment variables section with values masked/hidden and 'Reveal values' button showing the security feature for sensitive data**\n\n![08-env-vars-hidden.png](https://adorable-wombat-701.convex.cloud/api/storage/b9a1ea6e-33c3-4c76-b358-5ef8158fdb65)\n\n**Compact view of initial setup page with both Maintenance/Dev Scripts and Environment Variables sections collapsed, showing only the section headers and framework preset**\n\n![09-sections-collapsed.png](https://adorable-wombat-701.convex.cloud/api/storage/9c94d345-b329-4da4-a8c3-accf3c3fad23)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"ee59b001372a0c8064a9fc107b740757b6da311c","createdAt":"2025-12-03T06:33:33Z","updatedAt":"2025-12-03T06:55:20Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1124#issuecomment-3605309424"},{"type":"issue_comment","id":3605338245,"prNumber":1124,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7eydy8rts0ahebz6cfshbq0n7wjk66?src=preview.new) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7eydy8rts0ahebz6cfshbq0n7wjk66/browser?src=preview.new) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1124?src=preview.new)\n\nCaptured 7 screenshots for commit `888b8ab` (2025-12-03 06:45:13.662 UTC).\n\n**Initial setup page showing the full workspace configuration form with Framework Preset dropdown, Maintenance/Dev Scripts sections, and Environment Variables section all displayed at once**\n\n![1-initial-setup-full-page.png](https://famous-camel-162.convex.cloud/api/storage/9a98dfe8-2f89-4d7e-ba04-3655a1f19030)\n\n**Navigation back to initial setup page demonstrating the back navigation functionality from workspace config to project setup**\n\n![10-back-to-initial-setup.png](https://famous-camel-162.convex.cloud/api/storage/926351a6-013d-4206-ae95-a770860d9d49)\n\n**Sidebar showing completed steps with checkmark badges (steps 1-2) collapsed and current step (step 3) expanded with step number badge**\n\n![11-sidebar-with-collapsed-steps.png](https://famous-camel-162.convex.cloud/api/storage/cf8e667a-4521-4646-9319-779561114b00)\n\n**Workspace configuration split view after clicking Continue - shows the new animated transition to a sidebar layout with step-by-step configuration on the left and VS Code workspace iframe on the right**\n\n![5-workspace-config-split-view-full-page.png](https://famous-camel-162.convex.cloud/api/storage/cd455a42-f08f-4baf-a229-b6b669301f39)\n\n**Step 3 (Run scripts in VS Code terminal) showing the collapsible step configuration in the sidebar with VS Code editor visible in the main panel**\n\n![7-workspace-config-viewport.png](https://famous-camel-162.convex.cloud/api/storage/5a10ec9c-2c00-45f9-bd69-4ae307214e55)\n\n**Step 4 (Configure browser) showing the browser setup instructions in the sidebar with noVNC browser preview replacing the VS Code panel on the right**\n\n![8-browser-setup-step-full-page.png](https://famous-camel-162.convex.cloud/api/storage/38f6a778-669f-4c73-811b-83491230bcd4)\n\n**Browser setup step viewport showing the step-by-step instructions and the embedded browser preview with noVNC controls**\n\n![9-browser-setup-viewport.png](https://famous-camel-162.convex.cloud/api/storage/35b20b14-a8b0-4e49-bf27-9a4f06508ca8)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"ee59b001372a0c8064a9fc107b740757b6da311c","createdAt":"2025-12-03T06:45:16Z","updatedAt":"2025-12-03T06:55:21Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1124#issuecomment-3605338245"},{"type":"issue_comment","id":3605365118,"prNumber":1124,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn78gqhz8vq2r8dbyb5e7wzjen7wjka8?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn78gqhz8vq2r8dbyb5e7wzjen7wjka8/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1124?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 9 screenshots for commit `ee59b00` (2025-12-03 06:55:18.067 UTC).\n\n**Initial setup page - Full view showing framework preset, maintenance scripts, dev scripts, and environment variables sections all expanded**\n\n![01-initial-setup-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/9b232eb6-3088-4554-8fa9-75219e85d6a0)\n\n**Workspace configuration layout - Step 3 (Run scripts in VS Code terminal) with left sidebar showing config steps and VS Code workspace embedded on the right**\n\n![02-workspace-config-step3-run-scripts-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/0b641bed-574d-4761-82b3-fd6b2732451a)\n\n**Workspace config sidebar - Step 1 (Maintenance and Dev Scripts) section expanded, showing script input fields with step badge**\n\n![03-sidebar-step1-scripts-expanded.png](https://adorable-wombat-701.convex.cloud/api/storage/358c0dec-ee26-456b-a2a2-8225ef2d2d5a)\n\n**Workspace config sidebar - Step 2 (Environment Variables) section expanded, showing name/value input fields with reveal values button**\n\n![04-sidebar-step2-envvars-expanded.png](https://adorable-wombat-701.convex.cloud/api/storage/54a57f69-9c61-4b44-8fec-a212b1c3546e)\n\n**Workspace configuration layout - Step 4 (Configure browser) with VNC browser session embedded on the right instead of VS Code**\n\n![05-workspace-config-step4-browser-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/5521dea4-16b9-486a-a95e-e8702c0ded73)\n\n**Framework preset dropdown menu open, showing options: Other, Next.js, Vite (selected), Remix, Nuxt, SvelteKit, Angular, Create React App, Vue**\n\n![06-framework-preset-dropdown.png](https://adorable-wombat-701.convex.cloud/api/storage/3aa664ca-c5a0-4a98-8536-afc6ed005f68)\n\n**Initial setup page with Maintenance and Dev Scripts section collapsed, Environment Variables section still expanded**\n\n![07-initial-setup-sections-collapsed.png](https://adorable-wombat-701.convex.cloud/api/storage/d7a27ead-b124-465d-9c3c-b9d7fbc718f3)\n\n**Initial setup page with Maintenance and Dev Scripts collapsed, Environment Variables partially visible**\n\n![08-initial-setup-all-sections-collapsed.png](https://adorable-wombat-701.convex.cloud/api/storage/41518ab4-9098-4fcc-a209-0e8cb38a96d6)\n\n**Initial setup page in compact view - both Maintenance/Dev Scripts and Environment Variables sections collapsed**\n\n![09-initial-setup-compact-view.png](https://adorable-wombat-701.convex.cloud/api/storage/5022c92d-c013-43a4-ad17-61e1dfb5bb79)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"ee59b001372a0c8064a9fc107b740757b6da311c","createdAt":"2025-12-03T06:55:19Z","updatedAt":"2025-12-03T06:56:42Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1124#issuecomment-3605365118"},{"type":"issue_comment","id":3605369355,"prNumber":1124,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn73bk2vcqma0y0nm618am5tx17wjwrf?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn73bk2vcqma0y0nm618am5tx17wjwrf/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1124?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 21 screenshots for commit `ee59b00` (2025-12-03 06:56:40.263 UTC).\n\n**Full page view of the initial setup screen showing framework preset selector, maintenance/dev scripts, and environment variables sections all expanded**\n\n![01-initial-setup-full-page.png](https://famous-camel-162.convex.cloud/api/storage/330d59e9-de98-463e-a6d4-a1d571497b4e)\n\n**Header section showing 'Configure workspace' title**\n\n![02-initial-setup-header.png](https://famous-camel-162.convex.cloud/api/storage/8733e153-847b-4700-9c85-859a09bfcf76)\n\n**Framework preset selector showing 'Vite' selected with autofill hint**\n\n![03-framework-preset-select.png](https://famous-camel-162.convex.cloud/api/storage/2c878414-07a2-46ad-816a-ba3eeb61d48a)\n\n**Maintenance and Dev Scripts section expanded showing script input fields**\n\n![04-scripts-section-expanded.png](https://famous-camel-162.convex.cloud/api/storage/4c392058-9bd7-4be9-8cfc-46cdf18633af)\n\n**Environment Variables section expanded with name/value input fields and reveal/hide toggle**\n\n![05-env-vars-section-expanded.png](https://famous-camel-162.convex.cloud/api/storage/017f34cf-6f10-46a0-af77-06d9fef44a84)\n\n**Full page view of workspace configuration showing sidebar with step-by-step wizard (step 3 active) and VS Code iframe embedded on the right**\n\n![06-workspace-config-step3-full-page.png](https://famous-camel-162.convex.cloud/api/storage/e6517fb1-194c-4128-9dc8-b0a7ed1ca67d)\n\n**Back to project setup button in the sidebar**\n\n![07-sidebar-back-button.png](https://famous-camel-162.convex.cloud/api/storage/767aa6b4-b584-4f44-9bb8-508f4edb8439)\n\n**Sidebar header showing Configure workspace title and repository name**\n\n![08-sidebar-header.png](https://famous-camel-162.convex.cloud/api/storage/494c475c-6fae-424b-acd5-be81cceb56a1)\n\n**Step 1 (Maintenance and Dev Scripts) in collapsed state with checkmark badge**\n\n![09-step1-scripts-collapsed.png](https://famous-camel-162.convex.cloud/api/storage/bccc7af4-180e-45bc-94bf-77a3def45816)\n\n**Step 2 (Environment Variables) in collapsed state with checkmark badge**\n\n![10-step2-envvars-collapsed.png](https://famous-camel-162.convex.cloud/api/storage/90e57824-11b9-4d79-919b-a43dfcdf16c1)\n\n**Step 3 (Run scripts in VS Code terminal) expanded showing instructions and command block**\n\n![11-step3-run-scripts-expanded.png](https://famous-camel-162.convex.cloud/api/storage/9bc44cf5-bd16-4f37-9312-62963d10311d)\n\n**Command block in step 3 showing combined maintenance and dev scripts with copy button**\n\n![12-step3-commands-block.png](https://famous-camel-162.convex.cloud/api/storage/9c88db8b-9dee-4f33-8fc1-e695d3f225f1)\n\n**Full page view of workspace configuration at step 4 showing sidebar and browser VNC iframe on the right**\n\n![13-workspace-config-step4-full-page.png](https://famous-camel-162.convex.cloud/api/storage/61dfb080-6b98-4c28-82eb-70d675daf1ef)\n\n**Step 4 (Configure browser) expanded showing browser setup instructions**\n\n![14-step4-browser-setup-expanded.png](https://famous-camel-162.convex.cloud/api/storage/191dc959-3d69-4c53-8350-e7a986631f2b)\n\n**Step 3 (Run scripts) in collapsed state after moving to step 4**\n\n![15-step3-run-scripts-collapsed.png](https://famous-camel-162.convex.cloud/api/storage/f4efebf5-a4ce-4297-9193-7a5b86166ef6)\n\n**Save configuration button shown at the end of step 4**\n\n![16-save-configuration-button.png](https://famous-camel-162.convex.cloud/api/storage/cdb540a9-5e16-4d3c-bd82-96b551fc7a78)\n\n**Step 1 scripts section re-expanded in sidebar showing compact form with script input fields**\n\n![17-step1-scripts-expanded-sidebar.png](https://famous-camel-162.convex.cloud/api/storage/aa3f1ee7-6849-4fc0-be2e-76ecf56e2a96)\n\n**Step 2 environment variables section re-expanded in sidebar showing compact form with env var inputs**\n\n![18-step2-envvars-expanded-sidebar.png](https://famous-camel-162.convex.cloud/api/storage/80c2281a-e9ba-4007-9f0f-f6d44469c786)\n\n**Full page view showing multiple steps expanded simultaneously in the sidebar demonstrating component reuse**\n\n![19-multiple-sections-expanded.png](https://famous-camel-162.convex.cloud/api/storage/6853f198-8c7e-4383-9f27-05856250d888)\n\n**Full page view after clicking back button, returning to the initial setup layout**\n\n![20-back-to-initial-setup.png](https://famous-camel-162.convex.cloud/api/storage/a6c469ed-ad11-4329-8d4f-88976a037a54)\n\n**Framework preset dropdown menu open showing all available options (Other, Next.js, Vite, Remix, Nuxt, SvelteKit, Angular, Create React App, Vue)**\n\n![21-framework-preset-dropdown-open.png](https://famous-camel-162.convex.cloud/api/storage/a6c04dc1-7867-46e6-b359-e401c4acb224)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"ee59b001372a0c8064a9fc107b740757b6da311c","createdAt":"2025-12-03T06:56:41Z","updatedAt":"2025-12-03T06:56:41Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1124#issuecomment-3605369355"}]}
{"number":1122,"title":"Show subtle loading state for Add Account","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1122","headRef":"cmux/show-subtle-loading-state-for-add-account-e5gnt","headSha":"04c8f755159633c6396afb4a8c35472ff13be30c","baseRef":"main","baseSha":"b591b989bc47ca8d3ee83e547c2fec5d74e4ae1a","createdAt":"2025-12-03T04:51:00Z","updatedAt":"2025-12-03T05:27:08Z","diff":"diff --git a/apps/www/components/preview/preview-dashboard.tsx b/apps/www/components/preview/preview-dashboard.tsx\nindex d9004533c..da07882c9 100644\n--- a/apps/www/components/preview/preview-dashboard.tsx\n+++ b/apps/www/components/preview/preview-dashboard.tsx\n@@ -775,13 +775,17 @@ function PreviewDashboardInner({\n     <div className=\"flex flex-1 flex-col overflow-hidden rounded-lg border border-white/10\">\n       <div className=\"flex border-b border-white/10 shrink-0\">\n         <div className=\"relative border-r border-white/10\">\n-          <svg\n-            className=\"pointer-events-none absolute left-4 top-1/2 -translate-y-1/2 h-4 w-4\"\n-            viewBox=\"0 0 24 24\"\n-            fill=\"white\"\n-          >\n-            <path d=\"M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z\" />\n-          </svg>\n+          {isInstallingApp ? (\n+            <Loader2 className=\"pointer-events-none absolute left-4 top-1/2 -translate-y-1/2 h-4 w-4 animate-spin text-white\" />\n+          ) : (\n+            <svg\n+              className=\"pointer-events-none absolute left-4 top-1/2 -translate-y-1/2 h-4 w-4\"\n+              viewBox=\"0 0 24 24\"\n+              fill=\"white\"\n+            >\n+              <path d=\"M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z\" />\n+            </svg>\n+          )}\n           <select\n             value={selectedInstallationId ?? \"\"}\n             onChange={(e) => {\n@@ -792,7 +796,8 @@ function PreviewDashboardInner({\n               }\n               setSelectedInstallationId(Number(value));\n             }}\n-            className=\"h-10 appearance-none bg-transparent py-2 pl-11 pr-8 text-sm text-white focus:outline-none\"\n+            disabled={isInstallingApp}\n+            className=\"h-10 appearance-none bg-transparent py-2 pl-11 pr-8 text-sm text-white focus:outline-none disabled:cursor-not-allowed disabled:opacity-50\"\n           >\n             {activeConnections.map((conn) => (\n               <option key={conn.installationId} value={conn.installationId}>\n","comments":[{"type":"issue_comment","id":3605088427,"prNumber":1122,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn70n46q3vsty7qgrv7p6pd13n7wjm9z?src=preview.new) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn70n46q3vsty7qgrv7p6pd13n7wjm9z/browser?src=preview.new) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1122?src=preview.new)\n\nCaptured 10 screenshots for commit `04c8f75` (2025-12-03 04:56:12.112 UTC).\n\n**Account dropdown expanded showing the 'Add account' option available for selection**\n\n![account-dropdown-expanded.png](https://adorable-wombat-701.convex.cloud/api/storage/358bcf0e-e868-4769-bd98-1a5ca8bd86d9)\n\n**Detailed view of the loading spinner animation in the account dropdown during the add account action**\n\n![account-dropdown-loading-spinner-closeup.png](https://adorable-wombat-701.convex.cloud/api/storage/c4df09da-24bf-41e7-b82e-6c739c5b8ebe)\n\n**Full page view showing the loading state with spinner when adding a new GitHub account**\n\n![account-dropdown-loading-spinner-final.png](https://adorable-wombat-701.convex.cloud/api/storage/8e759fef-1a6a-4b01-ab3c-1c5da58878ea)\n\n![account-dropdown-loading-state.png](https://adorable-wombat-701.convex.cloud/api/storage/a003bbad-fb7e-4a9d-a4da-ca16b6c323be)\n\n**Account dropdown in normal state showing the GitHub icon next to the account name**\n\n![account-dropdown-normal-state.png](https://adorable-wombat-701.convex.cloud/api/storage/287c88ca-ba5c-44ac-81c6-c56a1a8a0eaf)\n\n**Close-up of the account dropdown showing the loading spinner replacing the GitHub icon when 'Add account' is being processed**\n\n![dropdown-loading-state-closeup.png](https://adorable-wombat-701.convex.cloud/api/storage/d8dec65f-c444-4213-b293-4a50f004867e)\n\n**Close-up of the account dropdown with GitHub icon in the default/normal state**\n\n![dropdown-with-github-icon.png](https://adorable-wombat-701.convex.cloud/api/storage/d149f981-1f9a-4f73-bd4c-a1974ac1094f)\n\n![dropdown-with-loading-spinner.png](https://adorable-wombat-701.convex.cloud/api/storage/b4a179d2-296d-47c7-ad8c-41a4639e5cb0)\n\n**Full page view of the preview dashboard showing the repository selection interface in default state**\n\n![preview-page-default-state.png](https://adorable-wombat-701.convex.cloud/api/storage/0d5aecc6-9428-49c8-9cdf-c94d86f8d203)\n\n**Repository selection section showing the account dropdown and repository search interface**\n\n![repository-selection-section.png](https://adorable-wombat-701.convex.cloud/api/storage/7d07a7f7-566f-4206-956b-c5659205fd07)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"04c8f755159633c6396afb4a8c35472ff13be30c","createdAt":"2025-12-03T04:56:13Z","updatedAt":"2025-12-03T04:57:01Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1122#issuecomment-3605088427"},{"type":"issue_comment","id":3605089784,"prNumber":1122,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn71sjxnchaarwyqheq0nfhz8d7wkm3g?src=preview.new) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn71sjxnchaarwyqheq0nfhz8d7wkm3g/browser?src=preview.new) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1122?src=preview.new)\n\n\n\nCaptured 10 screenshots for commit `04c8f75` (2025-12-03 04:57:00.124 UTC).\n\n**Full page view of the preview dashboard in normal state**\n\n![01-preview-dashboard-full-page.png](https://famous-camel-162.convex.cloud/api/storage/befdcc9e-ffc5-40d7-a1b6-6508281e33af)\n\n**GitHub account dropdown showing normal state with GitHub icon**\n\n![02-github-account-dropdown-normal-state.png](https://famous-camel-162.convex.cloud/api/storage/7f82044d-34f1-4ebe-936b-fb230d2a166b)\n\n**Choose repository section with both team and account dropdowns in normal state**\n\n![03-choose-repository-section.png](https://famous-camel-162.convex.cloud/api/storage/47f25aad-01e5-4e8f-8423-78c15c14762c)\n\n**GitHub account dropdown expanded showing 'Add account' option**\n\n![04-github-account-dropdown-expanded.png](https://famous-camel-162.convex.cloud/api/storage/66198b2a-4d4f-4581-9482-81f1ea3d1b0c)\n\n**Choose repository section with GitHub account dropdown expanded**\n\n![05-choose-repository-section-dropdown-open.png](https://famous-camel-162.convex.cloud/api/storage/6de31209-a4a4-4480-9a86-56f7e8cdc500)\n\n**GitHub account dropdown showing loading state with spinning loader icon (UI change)**\n\n![06-github-account-dropdown-loading-state.png](https://famous-camel-162.convex.cloud/api/storage/7ad4c78b-87f3-44cd-9569-8bfd44ade6d7)\n\n**Choose repository section showing the loading state when adding account (UI change)**\n\n![07-choose-repository-section-loading-state.png](https://famous-camel-162.convex.cloud/api/storage/d7dc1df6-6fba-4109-a222-f019e0f1ac08)\n\n**Full page view of preview dashboard with loading state active (UI change)**\n\n![08-preview-dashboard-full-page-loading-state.png](https://famous-camel-162.convex.cloud/api/storage/b67043c5-5ba7-4bf2-b966-fb7b6d40832c)\n\n**GitHub account dropdown restored to normal state for comparison**\n\n![09-github-account-dropdown-normal-state-restored.png](https://famous-camel-162.convex.cloud/api/storage/44f943ce-24ad-405b-a4c0-bd2bb0181285)\n\n**Choose repository section in normal state for comparison**\n\n![10-choose-repository-section-normal-state.png](https://famous-camel-162.convex.cloud/api/storage/19c96a10-1997-480c-b546-fadc532009ec)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"04c8f755159633c6396afb4a8c35472ff13be30c","createdAt":"2025-12-03T04:57:01Z","updatedAt":"2025-12-03T04:57:01Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1122#issuecomment-3605089784"}]}
{"number":1121,"title":"feat(preview): detect package manager and verify scripts exist","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1121","headRef":"detect-package-manager","headSha":"bd3604c8560fbeb862243a4c707ace81bd49310b","baseRef":"main","baseSha":"e216206076e08f15dc38937c8f254975b2d89530","createdAt":"2025-12-03T04:18:21Z","updatedAt":"2025-12-03T05:29:26Z","diff":"diff --git a/.github/workflows/checks.yml b/.github/workflows/checks.yml\nindex 95f65b9e5..f04add166 100644\n--- a/.github/workflows/checks.yml\n+++ b/.github/workflows/checks.yml\n@@ -35,6 +35,7 @@ jobs:\n       - name: Checks and tests (parallel on one runner)\n         shell: bash\n         env:\n+          GITHUB_TOKEN: ${{ github.token }}\n           STACK_SECRET_SERVER_KEY: ${{ secrets.STACK_SECRET_SERVER_KEY }}\n           STACK_SUPER_SECRET_ADMIN_KEY: ${{ secrets.STACK_SUPER_SECRET_ADMIN_KEY }}\n           STACK_DATA_VAULT_SECRET: ${{ secrets.STACK_DATA_VAULT_SECRET }}\ndiff --git a/apps/www/app/(preview)/preview/configure/page.tsx b/apps/www/app/(preview)/preview/configure/page.tsx\nindex 7111e97ac..6f2e934e7 100644\n--- a/apps/www/app/(preview)/preview/configure/page.tsx\n+++ b/apps/www/app/(preview)/preview/configure/page.tsx\n@@ -11,7 +11,7 @@ import {\n   getTeamSlugOrId,\n   type StackTeam,\n } from \"@/lib/team-utils\";\n-import { detectFrameworkPreset } from \"@/lib/github/framework-detection\";\n+import { detectFrameworkAndPackageManager } from \"@/lib/github/framework-detection\";\n import { env } from \"@/lib/utils/www-env\";\n import { typedZid } from \"@cmux/shared/utils/typed-zid\";\n \n@@ -150,11 +150,13 @@ export default async function PreviewConfigurePage({ searchParams }: PageProps)\n     console.error(\"Failed to fetch GitHub access token\", error);\n   }\n \n-  const detectedFrameworkPreset = await detectFrameworkPreset(repo, githubAccessToken);\n+  const detectionResult = await detectFrameworkAndPackageManager(repo, githubAccessToken);\n \n   let initialEnvVarsContent: string | null = null;\n-  let initialMaintenanceScript: string | null = null;\n-  let initialDevScript: string | null = null;\n+  // Use detected scripts from package.json, can be overridden by environment\n+  // Keep empty string if no dev script found (don't convert to null which would trigger preset fallback)\n+  let initialMaintenanceScript: string | null = detectionResult.maintenanceScript;\n+  let initialDevScript: string | null = detectionResult.devScript;\n \n   if (environmentId) {\n     try {\n@@ -195,7 +197,8 @@ export default async function PreviewConfigurePage({ searchParams }: PageProps)\n       teams={clientTeams}\n       repo={repo}\n       installationId={installationId}\n-      initialFrameworkPreset={detectedFrameworkPreset}\n+      initialFrameworkPreset={detectionResult.framework}\n+      initialPackageManager={detectionResult.packageManager}\n       initialEnvVarsContent={initialEnvVarsContent}\n       initialMaintenanceScript={initialMaintenanceScript}\n       initialDevScript={initialDevScript}\ndiff --git a/apps/www/components/preview/framework-preset-select.tsx b/apps/www/components/preview/framework-preset-select.tsx\nindex 13a0ba70d..cfa3d2b3a 100644\n--- a/apps/www/components/preview/framework-preset-select.tsx\n+++ b/apps/www/components/preview/framework-preset-select.tsx\n@@ -20,6 +20,7 @@ import {\n   ViteLogo,\n   VueLogo,\n } from \"@/components/icons/framework-logos\";\n+import type { PackageManager } from \"@/lib/github/framework-detection\";\n \n export type FrameworkPreset =\n   | \"other\"\n@@ -50,63 +51,86 @@ type FrameworkPresetConfig = {\n   icon: FrameworkIconKey;\n };\n \n-export const FRAMEWORK_PRESETS: Record<FrameworkPreset, FrameworkPresetConfig> =\n-  {\n-    other: {\n-      name: \"Other\",\n+// Script templates use \"start\" for frameworks that traditionally use npm start\n+type FrameworkScriptTemplate = {\n+  name: string;\n+  devScriptName: \"dev\" | \"start\";\n+  icon: FrameworkIconKey;\n+};\n+\n+const FRAMEWORK_SCRIPT_TEMPLATES: Record<FrameworkPreset, FrameworkScriptTemplate> = {\n+  other: { name: \"Other\", devScriptName: \"dev\", icon: \"other\" },\n+  next: { name: \"Next.js\", devScriptName: \"dev\", icon: \"next\" },\n+  vite: { name: \"Vite\", devScriptName: \"dev\", icon: \"vite\" },\n+  remix: { name: \"Remix\", devScriptName: \"dev\", icon: \"remix\" },\n+  nuxt: { name: \"Nuxt\", devScriptName: \"dev\", icon: \"nuxt\" },\n+  sveltekit: { name: \"SvelteKit\", devScriptName: \"dev\", icon: \"svelte\" },\n+  angular: { name: \"Angular\", devScriptName: \"start\", icon: \"angular\" },\n+  cra: { name: \"Create React App\", devScriptName: \"start\", icon: \"react\" },\n+  vue: { name: \"Vue\", devScriptName: \"dev\", icon: \"vue\" },\n+};\n+\n+function getInstallCommand(pm: PackageManager): string {\n+  switch (pm) {\n+    case \"bun\":\n+      return \"bun install\";\n+    case \"pnpm\":\n+      return \"pnpm install\";\n+    case \"yarn\":\n+      return \"yarn install\";\n+    case \"npm\":\n+    default:\n+      return \"npm install\";\n+  }\n+}\n+\n+function getRunCommand(pm: PackageManager, scriptName: string): string {\n+  switch (pm) {\n+    case \"bun\":\n+      return `bun run ${scriptName}`;\n+    case \"pnpm\":\n+      return `pnpm run ${scriptName}`;\n+    case \"yarn\":\n+      return `yarn ${scriptName}`;\n+    case \"npm\":\n+    default:\n+      return `npm run ${scriptName}`;\n+  }\n+}\n+\n+export function getFrameworkPresetConfig(\n+  preset: FrameworkPreset,\n+  packageManager: PackageManager = \"npm\"\n+): FrameworkPresetConfig {\n+  const template = FRAMEWORK_SCRIPT_TEMPLATES[preset];\n+  if (preset === \"other\") {\n+    return {\n+      name: template.name,\n       maintenanceScript: \"\",\n       devScript: \"\",\n-      icon: \"other\",\n-    },\n-    next: {\n-      name: \"Next.js\",\n-      maintenanceScript: \"npm install\",\n-      devScript: \"npm run dev\",\n-      icon: \"next\",\n-    },\n-    vite: {\n-      name: \"Vite\",\n-      maintenanceScript: \"npm install\",\n-      devScript: \"npm run dev\",\n-      icon: \"vite\",\n-    },\n-    remix: {\n-      name: \"Remix\",\n-      maintenanceScript: \"npm install\",\n-      devScript: \"npm run dev\",\n-      icon: \"remix\",\n-    },\n-    nuxt: {\n-      name: \"Nuxt\",\n-      maintenanceScript: \"npm install\",\n-      devScript: \"npm run dev\",\n-      icon: \"nuxt\",\n-    },\n-    sveltekit: {\n-      name: \"SvelteKit\",\n-      maintenanceScript: \"npm install\",\n-      devScript: \"npm run dev\",\n-      icon: \"svelte\",\n-    },\n-    angular: {\n-      name: \"Angular\",\n-      maintenanceScript: \"npm install\",\n-      devScript: \"npm start\",\n-      icon: \"angular\",\n-    },\n-    cra: {\n-      name: \"Create React App\",\n-      maintenanceScript: \"npm install\",\n-      devScript: \"npm start\",\n-      icon: \"react\",\n-    },\n-    vue: {\n-      name: \"Vue\",\n-      maintenanceScript: \"npm install\",\n-      devScript: \"npm run dev\",\n-      icon: \"vue\",\n-    },\n+      icon: template.icon,\n+    };\n+  }\n+  return {\n+    name: template.name,\n+    maintenanceScript: getInstallCommand(packageManager),\n+    devScript: getRunCommand(packageManager, template.devScriptName),\n+    icon: template.icon,\n   };\n+}\n+\n+// Default presets using npm for backward compatibility\n+export const FRAMEWORK_PRESETS: Record<FrameworkPreset, FrameworkPresetConfig> = {\n+  other: getFrameworkPresetConfig(\"other\", \"npm\"),\n+  next: getFrameworkPresetConfig(\"next\", \"npm\"),\n+  vite: getFrameworkPresetConfig(\"vite\", \"npm\"),\n+  remix: getFrameworkPresetConfig(\"remix\", \"npm\"),\n+  nuxt: getFrameworkPresetConfig(\"nuxt\", \"npm\"),\n+  sveltekit: getFrameworkPresetConfig(\"sveltekit\", \"npm\"),\n+  angular: getFrameworkPresetConfig(\"angular\", \"npm\"),\n+  cra: getFrameworkPresetConfig(\"cra\", \"npm\"),\n+  vue: getFrameworkPresetConfig(\"vue\", \"npm\"),\n+};\n \n const FRAMEWORK_ICON_META: Record<\n   FrameworkIconKey,\n@@ -263,9 +287,6 @@ const SelectItem = forwardRef<\n         <div className=\"font-medium text-neutral-900 dark:text-neutral-100\">\n           {config.name}\n         </div>\n-        <div className=\"text-xs text-neutral-500 dark:text-neutral-400\">\n-          Default: {config.devScript || \"Custom\"}\n-        </div>\n       </div>\n       <SelectPrimitive.ItemIndicator className=\"absolute right-3\">\n         <Check className=\"h-4 w-4 text-neutral-900 dark:text-neutral-100\" />\ndiff --git a/apps/www/components/preview/preview-configure-client.tsx b/apps/www/components/preview/preview-configure-client.tsx\nindex aa24b2331..709785876 100644\n--- a/apps/www/components/preview/preview-configure-client.tsx\n+++ b/apps/www/components/preview/preview-configure-client.tsx\n@@ -25,9 +25,10 @@ import { formatEnvVarsContent } from \"@cmux/shared/utils/format-env-vars-content\n import clsx from \"clsx\";\n import {\n   FrameworkPresetSelect,\n-  FRAMEWORK_PRESETS,\n+  getFrameworkPresetConfig,\n   type FrameworkPreset,\n } from \"./framework-preset-select\";\n+import type { PackageManager } from \"@/lib/github/framework-detection\";\n \n const MASKED_ENV_VALUE = \"••••••••••••••••\";\n \n@@ -59,6 +60,7 @@ type PreviewConfigureClientProps = {\n   repo: string;\n   installationId: string | null;\n   initialFrameworkPreset?: FrameworkPreset;\n+  initialPackageManager?: PackageManager;\n   initialEnvVarsContent?: string | null;\n   initialMaintenanceScript?: string | null;\n   initialDevScript?: string | null;\n@@ -364,6 +366,7 @@ export function PreviewConfigureClient({\n   repo,\n   installationId: _installationId,\n   initialFrameworkPreset = \"other\",\n+  initialPackageManager = \"npm\",\n   initialEnvVarsContent,\n   initialMaintenanceScript,\n   initialDevScript,\n@@ -389,8 +392,10 @@ export function PreviewConfigureClient({\n       initialEnvVars.some((r) => r.name.trim().length > 0 || r.value.trim().length > 0),\n     [initialEnvPrefilled, initialEnvVars]\n   );\n-  const initialFrameworkConfig =\n-    FRAMEWORK_PRESETS[initialFrameworkPreset] ?? FRAMEWORK_PRESETS.other;\n+  const initialFrameworkConfig = getFrameworkPresetConfig(\n+    initialFrameworkPreset,\n+    initialPackageManager\n+  );\n   const initialMaintenanceScriptValue =\n     initialMaintenanceScript ?? initialFrameworkConfig.maintenanceScript;\n   const initialDevScriptValue =\n@@ -734,7 +739,7 @@ export function PreviewConfigureClient({\n       setFrameworkPreset(preset);\n       // Only auto-fill if user hasn't manually edited the scripts\n       if (!hasUserEditedScripts) {\n-        const presetConfig = FRAMEWORK_PRESETS[preset];\n+        const presetConfig = getFrameworkPresetConfig(preset, initialPackageManager);\n         setMaintenanceScript(presetConfig.maintenanceScript);\n         setDevScript(presetConfig.devScript);\n         // Update none states based on whether the preset has scripts\n@@ -742,7 +747,7 @@ export function PreviewConfigureClient({\n         setDevNone(presetConfig.devScript.trim().length === 0);\n       }\n     },\n-    [hasUserEditedScripts]\n+    [hasUserEditedScripts, initialPackageManager]\n   );\n \n   const handleMaintenanceScriptChange = useCallback((value: string) => {\ndiff --git a/apps/www/lib/github/framework-detection.test.ts b/apps/www/lib/github/framework-detection.test.ts\nnew file mode 100644\nindex 000000000..48f886dc5\n--- /dev/null\n+++ b/apps/www/lib/github/framework-detection.test.ts\n@@ -0,0 +1,35 @@\n+import { describe, expect, it } from \"vitest\";\n+import { detectFrameworkAndPackageManager } from \"./framework-detection\";\n+\n+// These tests make real GitHub API calls and require authentication.\n+// They are skipped in CI unless GITHUB_TOKEN is provided.\n+// Run locally with: GITHUB_TOKEN=$(gh auth token) bun test framework-detection\n+const GITHUB_TOKEN = process.env.GITHUB_TOKEN;\n+const shouldSkip = !GITHUB_TOKEN;\n+\n+describe.skipIf(shouldSkip)(\"detectFrameworkAndPackageManager\", () => {\n+  it(\"detects stack-auth/stack-auth as pnpm with dev script\", async () => {\n+    const result = await detectFrameworkAndPackageManager(\"stack-auth/stack-auth\", GITHUB_TOKEN);\n+\n+    expect(result.packageManager).toBe(\"pnpm\");\n+    expect(result.maintenanceScript).toBe(\"pnpm install\");\n+    expect(result.devScript).toBe(\"pnpm run dev\");\n+  }, 30000);\n+\n+  it(\"detects manaflow-ai/cmux as bun (no dev script in package.json)\", async () => {\n+    const result = await detectFrameworkAndPackageManager(\"manaflow-ai/cmux\", GITHUB_TOKEN);\n+\n+    expect(result.packageManager).toBe(\"bun\");\n+    expect(result.maintenanceScript).toBe(\"bun install\");\n+    // cmux uses ./scripts/dev.sh, not a package.json script\n+    expect(result.devScript).toBe(\"\");\n+  }, 30000);\n+\n+  it(\"detects calcom/cal.com as yarn with dev script\", async () => {\n+    const result = await detectFrameworkAndPackageManager(\"calcom/cal.com\", GITHUB_TOKEN);\n+\n+    expect(result.packageManager).toBe(\"yarn\");\n+    expect(result.maintenanceScript).toBe(\"yarn install\");\n+    expect(result.devScript).toBe(\"yarn dev\");\n+  }, 30000);\n+});\ndiff --git a/apps/www/lib/github/framework-detection.ts b/apps/www/lib/github/framework-detection.ts\nindex 0b3237e3d..ade16c823 100644\n--- a/apps/www/lib/github/framework-detection.ts\n+++ b/apps/www/lib/github/framework-detection.ts\n@@ -1,6 +1,15 @@\n import { type FrameworkPreset } from \"@/components/preview/preview-configure-client\";\n import { createGitHubClient } from \"@/lib/github/octokit\";\n \n+export type PackageManager = \"npm\" | \"yarn\" | \"pnpm\" | \"bun\";\n+\n+export type FrameworkDetectionResult = {\n+  framework: FrameworkPreset;\n+  packageManager: PackageManager;\n+  maintenanceScript: string;\n+  devScript: string;\n+};\n+\n type PackageJson = {\n   dependencies?: Record<string, string>;\n   devDependencies?: Record<string, string>;\n@@ -39,6 +48,7 @@ type DetectionContext = {\n   packageJsons: PackageJsonWithPath[];\n   fileExistsCache: Map<string, boolean>;\n   fileContentCache: Map<string, string | null>;\n+  detectedPackageManager: PackageManager | null;\n };\n \n type FrameworkMatch = {\n@@ -47,6 +57,15 @@ type FrameworkMatch = {\n \n const MAX_PACKAGE_JSON_FILES = 20;\n const MIN_PACKAGE_JSONS_BEFORE_FALLBACK = 3;\n+\n+// Package manager lock files in priority order (more specific first)\n+const PACKAGE_MANAGER_LOCK_FILES: Array<{ file: string; manager: PackageManager }> = [\n+  { file: \"bun.lockb\", manager: \"bun\" },\n+  { file: \"bun.lock\", manager: \"bun\" },\n+  { file: \"pnpm-lock.yaml\", manager: \"pnpm\" },\n+  { file: \"yarn.lock\", manager: \"yarn\" },\n+  { file: \"package-lock.json\", manager: \"npm\" },\n+];\n const FALLBACK_PACKAGE_JSON_PATHS = [\n   \"app/package.json\",\n   \"apps/web/package.json\",\n@@ -183,13 +202,13 @@ const FRAMEWORK_DEFINITIONS: FrameworkDefinition[] = [\n   },\n ];\n \n-export async function detectFrameworkPreset(\n+export async function detectFrameworkAndPackageManager(\n   repoFullName: string,\n   accessToken?: string\n-): Promise<FrameworkPreset> {\n+): Promise<FrameworkDetectionResult> {\n   const [owner, name] = repoFullName.split(\"/\");\n   if (!owner || !name) {\n-    return \"other\";\n+    return { framework: \"other\", packageManager: \"npm\", maintenanceScript: \"\", devScript: \"\" };\n   }\n \n   const octokit = createGitHubClient(accessToken, { useTokenRotation: true });\n@@ -204,11 +223,63 @@ export async function detectFrameworkPreset(\n   }\n \n   const resolvedMatches = applySupersedes(matches);\n-  if (resolvedMatches.length === 0) {\n-    return \"other\";\n+  const framework = resolvedMatches[0]?.definition.preset ?? \"other\";\n+  const packageManager = context.detectedPackageManager ?? \"npm\";\n+\n+  // Detect scripts from root package.json\n+  const { maintenanceScript, devScript } = detectScripts(context.packageJsons, packageManager);\n+\n+  return { framework, packageManager, maintenanceScript, devScript };\n+}\n+\n+function getInstallCommand(pm: PackageManager): string {\n+  switch (pm) {\n+    case \"bun\":\n+      return \"bun install\";\n+    case \"pnpm\":\n+      return \"pnpm install\";\n+    case \"yarn\":\n+      return \"yarn install\";\n+    case \"npm\":\n+    default:\n+      return \"npm install\";\n   }\n+}\n \n-  return resolvedMatches[0]?.definition.preset ?? \"other\";\n+function getRunCommand(pm: PackageManager, scriptName: string): string {\n+  switch (pm) {\n+    case \"bun\":\n+      return `bun run ${scriptName}`;\n+    case \"pnpm\":\n+      return `pnpm run ${scriptName}`;\n+    case \"yarn\":\n+      return `yarn ${scriptName}`;\n+    case \"npm\":\n+    default:\n+      return `npm run ${scriptName}`;\n+  }\n+}\n+\n+function detectScripts(\n+  packageJsons: PackageJsonWithPath[],\n+  packageManager: PackageManager\n+): { maintenanceScript: string; devScript: string } {\n+  // Prefer root package.json, then first available\n+  const rootPkg = packageJsons.find((p) => p.path === \"package.json\");\n+  const pkg = rootPkg ?? packageJsons[0];\n+\n+  if (!pkg) {\n+    return { maintenanceScript: \"\", devScript: \"\" };\n+  }\n+\n+  const scripts = pkg.json.scripts ?? {};\n+  const maintenanceScript = getInstallCommand(packageManager);\n+\n+  // Check for dev script in priority order\n+  const devScriptName = [\"dev\", \"start\", \"serve\", \"develop\"].find((name) => name in scripts);\n+  const devScript = devScriptName ? getRunCommand(packageManager, devScriptName) : \"\";\n+\n+  return { maintenanceScript, devScript };\n }\n \n async function buildDetectionContext(\n@@ -226,6 +297,15 @@ async function buildDetectionContext(\n     !treeSnapshot || treeSnapshot.truncated\n   );\n \n+  // Detect package manager from lock files\n+  const detectedPackageManager = await detectPackageManager(\n+    octokit,\n+    owner,\n+    name,\n+    treeSnapshot?.normalizedFilePaths ?? null,\n+    treeSnapshot?.truncated ?? false\n+  );\n+\n   return {\n     owner,\n     name,\n@@ -235,9 +315,90 @@ async function buildDetectionContext(\n     packageJsons,\n     fileExistsCache: new Map<string, boolean>(),\n     fileContentCache: new Map<string, string | null>(),\n+    detectedPackageManager,\n   };\n }\n \n+async function detectPackageManager(\n+  octokit: ReturnType<typeof createGitHubClient>,\n+  owner: string,\n+  name: string,\n+  normalizedFilePaths: Set<string> | null,\n+  treeTruncated: boolean\n+): Promise<PackageManager | null> {\n+  // Fast path: check tree snapshot (0 API requests)\n+  for (const { file, manager } of PACKAGE_MANAGER_LOCK_FILES) {\n+    if (normalizedFilePaths?.has(file.toLowerCase())) {\n+      return manager;\n+    }\n+  }\n+\n+  // If tree available and NOT truncated, we already checked everything\n+  if (normalizedFilePaths && !treeTruncated) {\n+    return null;\n+  }\n+\n+  // Slow path: single GraphQL request to check all lock files\n+  // Used when tree is unavailable OR truncated (lock files may be missing from snapshot)\n+  return detectPackageManagerViaGraphQL(octokit, owner, name);\n+}\n+\n+async function detectPackageManagerViaGraphQL(\n+  octokit: ReturnType<typeof createGitHubClient>,\n+  owner: string,\n+  name: string\n+): Promise<PackageManager | null> {\n+  // Build aliases for each lock file: bunLockb, bunLock, pnpmLock, etc.\n+  const aliasMap: Array<{ alias: string; file: string; manager: PackageManager }> =\n+    PACKAGE_MANAGER_LOCK_FILES.map(({ file, manager }, i) => ({\n+      alias: `file${i}`,\n+      file,\n+      manager,\n+    }));\n+\n+  // Build GraphQL query with aliases\n+  const objectQueries = aliasMap\n+    .map(({ alias, file }) => `${alias}: object(expression: \"HEAD:${file}\") { oid }`)\n+    .join(\"\\n      \");\n+\n+  const query = `\n+    query($owner: String!, $name: String!) {\n+      repository(owner: $owner, name: $name) {\n+        ${objectQueries}\n+      }\n+    }\n+  `;\n+\n+  try {\n+    const result = await octokit.graphql<{\n+      repository: Record<string, { oid: string } | null> | null;\n+    }>(query, { owner, name });\n+\n+    if (!result.repository) {\n+      return null;\n+    }\n+\n+    // Return first match in priority order\n+    for (const { alias, manager } of aliasMap) {\n+      if (result.repository[alias]?.oid) {\n+        return manager;\n+      }\n+    }\n+\n+    return null;\n+  } catch (error) {\n+    console.error(\"GraphQL lock file detection failed, falling back to REST\", error);\n+    // Fallback to parallel REST if GraphQL fails\n+    const results = await Promise.all(\n+      PACKAGE_MANAGER_LOCK_FILES.map(async ({ file, manager }) => {\n+        const exists = await repoFileExists(octokit, owner, name, file);\n+        return exists ? manager : null;\n+      })\n+    );\n+    return results.find((r): r is PackageManager => r !== null) ?? null;\n+  }\n+}\n+\n async function fetchRepoTree(\n   octokit: ReturnType<typeof createGitHubClient>,\n   owner: string,\n@@ -299,13 +460,14 @@ async function loadPackageJsons(\n   const sortedPaths = prioritizePackageJsonPaths([...new Set(packageJsonPaths)]).slice(0, MAX_PACKAGE_JSON_FILES);\n   const seenPaths = new Set(sortedPaths);\n \n-  const packages: PackageJsonWithPath[] = [];\n-  for (const path of sortedPaths) {\n-    const pkg = await fetchPackageJson(octokit, owner, name, path);\n-    if (pkg) {\n-      packages.push({ path, json: pkg });\n-    }\n-  }\n+  // Parallel fetch all package.json files\n+  const results = await Promise.all(\n+    sortedPaths.map(async (path) => {\n+      const pkg = await fetchPackageJson(octokit, owner, name, path);\n+      return pkg ? { path, json: pkg } : null;\n+    })\n+  );\n+  const packages = results.filter((r): r is PackageJsonWithPath => r !== null);\n \n   // If nothing could be fetched, still try the root package.json once more as a fallback.\n   if (packages.length === 0 && !seenPaths.has(\"package.json\")) {\n@@ -319,18 +481,18 @@ async function loadPackageJsons(\n     packages.length === 0 || (includeFallbackCandidates && packages.length < MIN_PACKAGE_JSONS_BEFORE_FALLBACK);\n \n   if (shouldTryFallbackCandidates) {\n-    for (const candidate of FALLBACK_PACKAGE_JSON_PATHS) {\n-      if (packages.length >= MAX_PACKAGE_JSON_FILES) {\n-        break;\n-      }\n-      if (seenPaths.has(candidate)) {\n-        continue;\n-      }\n-      const pkg = await fetchPackageJson(octokit, owner, name, candidate);\n-      if (pkg) {\n-        packages.push({ path: candidate, json: pkg });\n-      }\n-    }\n+    // Parallel fetch fallback candidates\n+    const candidatesToTry = FALLBACK_PACKAGE_JSON_PATHS\n+      .filter((c) => !seenPaths.has(c))\n+      .slice(0, MAX_PACKAGE_JSON_FILES - packages.length);\n+\n+    const fallbackResults = await Promise.all(\n+      candidatesToTry.map(async (path) => {\n+        const pkg = await fetchPackageJson(octokit, owner, name, path);\n+        return pkg ? { path, json: pkg } : null;\n+      })\n+    );\n+    packages.push(...fallbackResults.filter((r): r is PackageJsonWithPath => r !== null));\n   }\n \n   return packages;\n","comments":[{"type":"issue_comment","id":3605051111,"prNumber":1121,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn73hp3ytvx61dpx876rmcqfc17wjvfq?src=preview.new) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn73hp3ytvx61dpx876rmcqfc17wjvfq/browser?src=preview.new) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1121?src=preview.new)\n\nCaptured 11 screenshots for commit `a1acedf` (2025-12-03 04:33:21.259 UTC).\n\n**Initial configure page for facebook/react repository showing Framework Preset selector**\n\n![01-configure-page-initial.png](https://adorable-wombat-701.convex.cloud/api/storage/3d77d174-a101-419e-be0e-7f9225bf4227)\n\n**Framework Preset dropdown expanded showing all available framework options with icons**\n\n![02-framework-preset-dropdown-open.png](https://adorable-wombat-701.convex.cloud/api/storage/c5a77c08-f462-4ae0-b4aa-cfdf97e3a0d5)\n\n**Maintenance and Dev Scripts section expanded for facebook/react, showing 'yarn install' detected automatically**\n\n![03-maintenance-scripts-expanded-yarn.png](https://adorable-wombat-701.convex.cloud/api/storage/db3123f6-c753-4f4f-93c5-93717cb9ddb7)\n\n**Close-up of maintenance script field showing 'yarn install' for yarn-based repository**\n\n![04-maintenance-script-field-yarn-install.png](https://adorable-wombat-701.convex.cloud/api/storage/0acf4e7e-01fc-4b97-822d-7df2fd0c3e6d)\n\n**Initial configure page for vercel/next.js repository with Next.js framework preset auto-detected**\n\n![05-nextjs-repo-initial.png](https://adorable-wombat-701.convex.cloud/api/storage/faebd66a-1a58-4c33-89eb-17cdba91ac58)\n\n**Scripts section for vercel/next.js showing 'pnpm install' and 'pnpm run dev' automatically detected**\n\n![06-nextjs-repo-pnpm-detected.png](https://adorable-wombat-701.convex.cloud/api/storage/ecfd78ea-7837-414c-980e-01e009bf7f47)\n\n**Close-up of maintenance script field showing 'pnpm install' for pnpm-based repository**\n\n![07-maintenance-script-pnpm-install.png](https://adorable-wombat-701.convex.cloud/api/storage/ea6e4b2b-9c59-484e-a516-ff1a8dc9ea9d)\n\n**Scripts section for oven-sh/bun repository showing 'bun install' and 'bun run dev' automatically detected**\n\n![08-bun-repo-bun-detected.png](https://adorable-wombat-701.convex.cloud/api/storage/c55564f1-1017-4b42-87cd-520185042374)\n\n**Close-up of maintenance script field showing 'bun install' for bun-based repository**\n\n![09-maintenance-script-bun-install.png](https://adorable-wombat-701.convex.cloud/api/storage/3e8face7-216d-4e8e-8038-3b2c28bdc01a)\n\n**Demonstration that changing framework preset (Remix to Next.js) preserves the detected package manager (bun)**\n\n![10-framework-change-preserves-package-manager.png](https://adorable-wombat-701.convex.cloud/api/storage/0e759572-97d4-428e-99f8-b0c967272eeb)\n\n**Framework preset dropdown with framework icons and options fully visible**\n\n![11-framework-preset-dropdown-with-icons.png](https://adorable-wombat-701.convex.cloud/api/storage/71c1f25d-0cbe-4ceb-9aa3-28335a26b174)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"bd3604c8560fbeb862243a4c707ace81bd49310b","createdAt":"2025-12-03T04:33:22Z","updatedAt":"2025-12-03T04:46:36Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1121#issuecomment-3605051111"},{"type":"issue_comment","id":3605072203,"prNumber":1121,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn782fedh969dfp9m968q7hkkx7wjtgy?src=preview.new) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn782fedh969dfp9m968q7hkkx7wjtgy/browser?src=preview.new) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1121?src=preview.new)\n\nCaptured 8 screenshots for commit `48486c7` (2025-12-03 04:46:33.153 UTC).\n\n**Initial configure page view with test repository showing 'Other' framework preset**\n\n![01-configure-page-initial-view.png](https://adorable-wombat-701.convex.cloud/api/storage/9ff8fea8-d960-4829-a5ed-bf000f726917)\n\n**Configure page with vercel/next.js repository - framework automatically detected as 'Next.js'**\n\n![02-configure-page-nextjs-detected.png](https://adorable-wombat-701.convex.cloud/api/storage/64f952a8-7950-4089-bebe-819456173cea)\n\n**Full page view with expanded sections showing auto-filled scripts using detected pnpm package manager**\n\n![03-configure-page-sections-expanded.png](https://adorable-wombat-701.convex.cloud/api/storage/b768f42c-7867-4a85-8145-82ae3bbc676c)\n\n**Close-up of Framework Preset selector showing 'Next.js' with 'Autofills install and dev scripts' subtitle**\n\n![04-framework-preset-selector-closeup.png](https://adorable-wombat-701.convex.cloud/api/storage/f72ee629-21a9-4556-9817-dfabfe249f85)\n\n**Maintenance and Dev Scripts section showing 'pnpm install' and 'pnpm run dev' auto-filled for Next.js**\n\n![05-maintenance-and-dev-scripts-with-pnpm.png](https://adorable-wombat-701.convex.cloud/api/storage/18bec446-9b85-4f04-b4f5-3f2054c9d469)\n\n**Configure page with vuejs/core repository - Vite framework detected with pnpm package manager**\n\n![06-vuejs-vite-detected-with-pnpm.png](https://adorable-wombat-701.convex.cloud/api/storage/c132a4ec-953e-48c6-a757-8a8be266fff6)\n\n**Configure page with facebook/create-react-app - CRA framework detected with npm package manager**\n\n![07-create-react-app-with-npm.png](https://adorable-wombat-701.convex.cloud/api/storage/40dfa605-cf6d-48ca-95de-03c7c77ee3eb)\n\n**Close-up showing 'npm install' and 'npm run start' for Create React App with npm detection**\n\n![08-scripts-closeup-npm-start.png](https://adorable-wombat-701.convex.cloud/api/storage/6292f80f-e2f1-4980-9055-92483bc95fde)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"bd3604c8560fbeb862243a4c707ace81bd49310b","createdAt":"2025-12-03T04:46:35Z","updatedAt":"2025-12-03T04:53:19Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1121#issuecomment-3605072203"},{"type":"issue_comment","id":3605083454,"prNumber":1121,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn73n1aw58kx8kbkqxf7gbf67n7wkt5v?src=preview.new) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn73n1aw58kx8kbkqxf7gbf67n7wkt5v/browser?src=preview.new) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1121?src=preview.new)\n\nCaptured 9 screenshots for commit `e68c166` (2025-12-03 04:53:17.569 UTC).\n\n**Initial configure project page showing Next.js framework preset detected for austinywang/landing repository with pnpm package manager**\n\n![01-configure-project-initial.png](https://famous-camel-162.convex.cloud/api/storage/a3a5c044-a50c-4e2c-8013-040b60207f20)\n\n**Framework preset dropdown menu showing all available options: Other, Next.js, Vite, Remix, Nuxt, SvelteKit, Angular, Create React App, and Vue**\n\n![02-framework-preset-dropdown-open.png](https://famous-camel-162.convex.cloud/api/storage/86249d37-1cc0-4094-8539-f0b4c7e36181)\n\n**Configure page after selecting Vite preset, with Maintenance and Dev Scripts section expanded showing 'pnpm install' and 'pnpm run dev' commands**\n\n![03-vite-preset-with-pnpm-scripts.png](https://famous-camel-162.convex.cloud/api/storage/b7a1f644-2a95-438c-8ea4-69557bbae2bc)\n\n**Close-up of the Maintenance and Dev Scripts section showing pnpm-based commands automatically generated**\n\n![04-maintenance-dev-scripts-pnpm-detail.png](https://famous-camel-162.convex.cloud/api/storage/c30f65d2-f20e-4360-9f08-b901d444cf9e)\n\n**Configure environment view (Step 2) showing the combined command 'pnpm install && pnpm run dev' in the Run scripts section with VS Code workspace visible**\n\n![05-configure-environment-pnpm-commands.png](https://famous-camel-162.convex.cloud/api/storage/87d05149-5047-4645-b5f9-d9449cf95a9c)\n\n**Focused view of the 'Run scripts in VS Code terminal' section displaying the pnpm command that users should paste in the terminal**\n\n![06-run-scripts-section-pnpm-detail.png](https://famous-camel-162.convex.cloud/api/storage/cc36aaaf-b44e-446b-974d-3d01a3774946)\n\n**Configure page for facebook/react repository showing 'yarn install' detected as the maintenance script, demonstrating yarn package manager detection**\n\n![07-react-repo-yarn-detected.png](https://famous-camel-162.convex.cloud/api/storage/469dd4f3-4c42-4e87-9408-595f99590113)\n\n**Close-up of maintenance script showing 'yarn install' command for the React repository**\n\n![08-yarn-install-script-detail.png](https://famous-camel-162.convex.cloud/api/storage/08ac42cf-40ac-41b2-9625-77547ddfe5b2)\n\n**Configure page for vercel/next.js repository showing 'pnpm install' and 'pnpm run dev' scripts, demonstrating pnpm detection for the Next.js repository itself**\n\n![09-nextjs-repo-pnpm-detected.png](https://famous-camel-162.convex.cloud/api/storage/5598ed7c-804a-4847-a495-46e1d326bfba)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"bd3604c8560fbeb862243a4c707ace81bd49310b","createdAt":"2025-12-03T04:53:18Z","updatedAt":"2025-12-03T05:10:59Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1121#issuecomment-3605083454"},{"type":"issue_comment","id":3605115057,"prNumber":1121,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn72kwfes0qeyh0tsmsm50pyk97wk2n2?src=preview.new) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn72kwfes0qeyh0tsmsm50pyk97wk2n2/browser?src=preview.new) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1121?src=preview.new)\n\nCaptured 9 screenshots for commit `bd3604c` (2025-12-03 05:10:57.143 UTC).\n\n**Full page showing cmux repository with 'bun install' maintenance script and empty dev script field - demonstrating the fix to preserve empty devScript instead of falling back to preset defaults**\n\n![cmux-bun-install-empty-dev.png](https://adorable-wombat-701.convex.cloud/api/storage/7b7a1f13-589f-4772-87f3-30a561321bf6)\n\n**Initial configure page for manaflow-ai/cmux repository showing auto-detected Next.js framework preset with 'Autofills install and dev scripts' description**\n\n![configure-page-initial.png](https://adorable-wombat-701.convex.cloud/api/storage/b8bd4a69-3132-4051-9afe-d11084a0d243)\n\n**Framework preset dropdown menu showing all available framework options (Other, Next.js, Vite, Remix, Nuxt, SvelteKit, Angular, Create React App, Vue) with Next.js selected**\n\n![framework-preset-dropdown-open.png](https://adorable-wombat-701.convex.cloud/api/storage/d53cf608-f5d8-4fa6-8f03-bddf91d6b796)\n\n**Close-up of the framework preset selector component showing Next.js with subtitle text 'Autofills install and dev scripts'**\n\n![framework-preset-selector-closeup.png](https://adorable-wombat-701.convex.cloud/api/storage/cce00d9e-2628-490c-8c28-25b32df2fd35)\n\n**Maintenance and Dev Scripts section expanded showing 'bun install' auto-filled in the maintenance script field - demonstrating package manager detection working with Bun**\n\n![maintenance-dev-scripts-expanded.png](https://adorable-wombat-701.convex.cloud/api/storage/3056a3ce-7061-4821-908c-6544d7991e1e)\n\n**Close-up of maintenance script field showing 'bun install' - system detected bun.lockb file and automatically selected Bun package manager**\n\n![maintenance-script-bun-install.png](https://adorable-wombat-701.convex.cloud/api/storage/8e21e0d1-7e6e-4c4a-a935-8984396d7d98)\n\n**Configure page for austinywang/nuxt-app repository showing auto-detected Nuxt framework preset**\n\n![nuxt-app-initial.png](https://adorable-wombat-701.convex.cloud/api/storage/3001ba2c-375f-450e-9d31-3c1e7d266595)\n\n**Nuxt app with maintenance and dev scripts expanded showing 'npm install' and 'npm run dev' - demonstrating package manager detection working with npm**\n\n![nuxt-app-npm-detected.png](https://adorable-wombat-701.convex.cloud/api/storage/e927f242-c7b3-4c7a-a916-8927c7cfa6a1)\n\n**Framework preset dropdown for Nuxt app showing Nuxt selected among all framework options**\n\n![nuxt-framework-dropdown-open.png](https://adorable-wombat-701.convex.cloud/api/storage/1672c35c-2c82-4d57-bcf8-bf8f994809e9)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"bd3604c8560fbeb862243a4c707ace81bd49310b","createdAt":"2025-12-03T05:10:58Z","updatedAt":"2025-12-03T05:12:03Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1121#issuecomment-3605115057"},{"type":"issue_comment","id":3605116995,"prNumber":1121,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7fm0qwmzna2fechtc9672hyd7wjky4?src=preview.new) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7fm0qwmzna2fechtc9672hyd7wjky4/browser?src=preview.new) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1121?src=preview.new)\n\n\n\nCaptured 4 screenshots for commit `bd3604c` (2025-12-03 05:12:01.920 UTC).\n\n**Bun package manager example with key changes summary, showing detection from bun.lockb and the list of PR features including automatic detection and correct command generation**\n\n![bun-example-and-key-changes.png](https://famous-camel-162.convex.cloud/api/storage/cf0a5a3c-f69f-4da3-a46d-08348f6b7471)\n\n**NPM package manager example showing detection from package-lock.json and generated commands: npm install and npm run dev**\n\n![npm-example.png](https://famous-camel-162.convex.cloud/api/storage/95771881-b176-471a-adf9-76d7e68594c7)\n\n**Full-page overview showing all four package manager detection examples (npm, yarn, pnpm, bun) with their respective install and dev script commands**\n\n![package-manager-detection-overview.png](https://famous-camel-162.convex.cloud/api/storage/17cafad6-d6f8-4eb7-8895-24ab1d5f58b3)\n\n**Yarn and PNPM examples showing detection from yarn.lock and pnpm-lock.yaml, with their respective commands (yarn install/dev and pnpm install/run dev)**\n\n![yarn-pnpm-examples.png](https://famous-camel-162.convex.cloud/api/storage/49935bd9-d253-4afb-87af-d8025b1a31ee)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"bd3604c8560fbeb862243a4c707ace81bd49310b","createdAt":"2025-12-03T05:12:02Z","updatedAt":"2025-12-03T05:12:02Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1121#issuecomment-3605116995"}]}
{"number":1118,"title":"feat(sandbox): working backlog fixes - neovim/emacs + auto-scroll","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1118","headRef":"working-backlog-fixes","headSha":"e50b6d29732ae49442226ecd29283f0552580807","baseRef":"main","baseSha":"4104173a4d043e6ebeb286561981ba16eef5d917","createdAt":"2025-12-03T01:28:22Z","updatedAt":"2025-12-04T02:59:01Z","diff":"diff --git a/packages/sandbox/.beads/.gitignore b/packages/sandbox/.beads/.gitignore\nnew file mode 100644\nindex 000000000..f438450fc\n--- /dev/null\n+++ b/packages/sandbox/.beads/.gitignore\n@@ -0,0 +1,29 @@\n+# SQLite databases\n+*.db\n+*.db?*\n+*.db-journal\n+*.db-wal\n+*.db-shm\n+\n+# Daemon runtime files\n+daemon.lock\n+daemon.log\n+daemon.pid\n+bd.sock\n+\n+# Legacy database files\n+db.sqlite\n+bd.db\n+\n+# Merge artifacts (temporary files from 3-way merge)\n+beads.base.jsonl\n+beads.base.meta.json\n+beads.left.jsonl\n+beads.left.meta.json\n+beads.right.jsonl\n+beads.right.meta.json\n+\n+# Keep JSONL exports and config (source of truth for git)\n+!issues.jsonl\n+!metadata.json\n+!config.json\ndiff --git a/packages/sandbox/.beads/BD_GUIDE.md b/packages/sandbox/.beads/BD_GUIDE.md\nnew file mode 100644\nindex 000000000..a641e9afd\n--- /dev/null\n+++ b/packages/sandbox/.beads/BD_GUIDE.md\n@@ -0,0 +1,305 @@\n+<!-- Auto-generated by bd v0.28.0 - DO NOT EDIT MANUALLY -->\n+<!-- Run 'bd onboard --output .beads/BD_GUIDE.md' to regenerate -->\n+\n+# BD (Beads) Guide for AI Agents\n+\n+This file contains canonical bd (beads) workflow instructions for AI agents.\n+It is auto-generated and version-stamped to track bd upgrades.\n+\n+> **For project-specific instructions**, see AGENTS.md in the repository root.\n+> This file only covers bd tool usage, not project-specific workflows.\n+\n+---\n+\n+## Issue Tracking with bd (beads)\n+\n+**IMPORTANT**: This project uses **bd (beads)** for ALL issue tracking. Do NOT use markdown TODOs, task lists, or other tracking methods.\n+\n+### Why bd?\n+\n+- Dependency-aware: Track blockers and relationships between issues\n+- Git-friendly: Auto-syncs to JSONL for version control\n+- Agent-optimized: JSON output, ready work detection, discovered-from links\n+- Prevents duplicate tracking systems and confusion\n+\n+### Quick Start\n+\n+**Check for ready work:**\n+```bash\n+bd ready --json\n+```\n+\n+**Create new issues:**\n+```bash\n+bd create \"Issue title\" -t bug|feature|task -p 0-4 --json\n+bd create \"Issue title\" -p 1 --deps discovered-from:bd-123 --json\n+bd create \"Subtask\" --parent <epic-id> --json  # Hierarchical subtask (gets ID like epic-id.1)\n+```\n+\n+**Claim and update:**\n+```bash\n+bd update bd-42 --status in_progress --json\n+bd update bd-42 --priority 1 --json\n+```\n+\n+**Complete work:**\n+```bash\n+bd close bd-42 --reason \"Completed\" --json\n+```\n+\n+### Issue Types\n+\n+- `bug` - Something broken\n+- `feature` - New functionality\n+- `task` - Work item (tests, docs, refactoring)\n+- `epic` - Large feature with subtasks\n+- `chore` - Maintenance (dependencies, tooling)\n+\n+### Priorities\n+\n+- `0` - Critical (security, data loss, broken builds)\n+- `1` - High (major features, important bugs)\n+- `2` - Medium (default, nice-to-have)\n+- `3` - Low (polish, optimization)\n+- `4` - Backlog (future ideas)\n+\n+### Workflow for AI Agents\n+\n+1. **Check ready work**: `bd ready` shows unblocked issues\n+2. **Claim your task**: `bd update <id> --status in_progress`\n+3. **Work on it**: Implement, test, document\n+4. **Discover new work?** Create linked issue:\n+   - `bd create \"Found bug\" -p 1 --deps discovered-from:<parent-id>`\n+5. **Complete**: `bd close <id> --reason \"Done\"`\n+6. **Commit together**: Always commit the `.beads/issues.jsonl` file together with the code changes so issue state stays in sync with code state\n+\n+### Auto-Sync\n+\n+bd automatically syncs with git:\n+- Exports to `.beads/issues.jsonl` after changes (5s debounce)\n+- Imports from JSONL when newer (e.g., after `git pull`)\n+- No manual export/import needed!\n+\n+### GitHub Copilot Integration\n+\n+If using GitHub Copilot, also create `.github/copilot-instructions.md` for automatic instruction loading.\n+Run `bd onboard` to get the content, or see step 2 of the onboard instructions.\n+\n+### MCP Server (Recommended)\n+\n+If using Claude or MCP-compatible clients, install the beads MCP server:\n+\n+```bash\n+pip install beads-mcp\n+```\n+\n+Add to MCP config (e.g., `~/.config/claude/config.json`):\n+```json\n+{\n+  \"beads\": {\n+    \"command\": \"beads-mcp\",\n+    \"args\": []\n+  }\n+}\n+```\n+\n+Then use `mcp__beads__*` functions instead of CLI commands.\n+\n+### Managing AI-Generated Planning Documents\n+\n+AI assistants often create planning and design documents during development:\n+- PLAN.md, IMPLEMENTATION.md, ARCHITECTURE.md\n+- DESIGN.md, CODEBASE_SUMMARY.md, INTEGRATION_PLAN.md\n+- TESTING_GUIDE.md, TECHNICAL_DESIGN.md, and similar files\n+\n+**Best Practice: Use a dedicated directory for these ephemeral files**\n+\n+**Recommended approach:**\n+- Create a `history/` directory in the project root\n+- Store ALL AI-generated planning/design docs in `history/`\n+- Keep the repository root clean and focused on permanent project files\n+- Only access `history/` when explicitly asked to review past planning\n+\n+**Example .gitignore entry (optional):**\n+```\n+# AI planning documents (ephemeral)\n+history/\n+```\n+\n+**Benefits:**\n+- ✅ Clean repository root\n+- ✅ Clear separation between ephemeral and permanent documentation\n+- ✅ Easy to exclude from version control if desired\n+- ✅ Preserves planning history for archeological research\n+- ✅ Reduces noise when browsing the project\n+\n+### CLI Help\n+\n+Run `bd <command> --help` to see all available flags for any command.\n+For example: `bd create --help` shows `--parent`, `--deps`, `--assignee`, etc.\n+\n+### Important Rules\n+\n+- ✅ Use bd for ALL task tracking\n+- ✅ Always use `--json` flag for programmatic use\n+- ✅ Link discovered work with `discovered-from` dependencies\n+- ✅ Check `bd ready` before asking \"what should I work on?\"\n+- ✅ Store AI planning docs in `history/` directory\n+- ✅ Run `bd <cmd> --help` to discover available flags\n+- ❌ Do NOT create markdown TODO lists\n+- ❌ Do NOT use external issue trackers\n+- ❌ Do NOT duplicate tracking systems\n+- ❌ Do NOT clutter repo root with planning documents\n+\n+For more details, see README.md and QUICKSTART.md.\n+\n+---\n+\n+# GitHub Copilot Instructions for Beads\n+\n+## Project Overview\n+\n+**beads** (command: `bd`) is a Git-backed issue tracker designed for AI-supervised coding workflows. We dogfood our own tool for all task tracking.\n+\n+**Key Features:**\n+- Dependency-aware issue tracking\n+- Auto-sync with Git via JSONL\n+- AI-optimized CLI with JSON output\n+- Built-in daemon for background operations\n+- MCP server integration for Claude and other AI assistants\n+\n+## Tech Stack\n+\n+- **Language**: Go 1.21+\n+- **Storage**: SQLite (internal/storage/sqlite/)\n+- **CLI Framework**: Cobra\n+- **Testing**: Go standard testing + table-driven tests\n+- **CI/CD**: GitHub Actions\n+- **MCP Server**: Python (integrations/beads-mcp/)\n+\n+## Coding Guidelines\n+\n+### Testing\n+- Always write tests for new features\n+- Use `BEADS_DB=/tmp/test.db` to avoid polluting production database\n+- Run `go test -short ./...` before committing\n+- Never create test issues in production DB (use temporary DB)\n+\n+### Code Style\n+- Run `golangci-lint run ./...` before committing\n+- Follow existing patterns in `cmd/bd/` for new commands\n+- Add `--json` flag to all commands for programmatic use\n+- Update docs when changing behavior\n+\n+### Git Workflow\n+- Always commit `.beads/issues.jsonl` with code changes\n+- Run `bd sync` at end of work sessions\n+- Install git hooks: `bd hooks install` (ensures DB ↔ JSONL consistency)\n+\n+## Issue Tracking with bd\n+\n+**CRITICAL**: This project uses **bd** for ALL task tracking. Do NOT create markdown TODO lists.\n+\n+### Essential Commands\n+\n+```bash\n+# Find work\n+bd ready --json                    # Unblocked issues\n+bd stale --days 30 --json          # Forgotten issues\n+\n+# Create and manage\n+bd create \"Title\" -t bug|feature|task -p 0-4 --json\n+bd create \"Subtask\" --parent <epic-id> --json  # Hierarchical subtask\n+bd update <id> --status in_progress --json\n+bd close <id> --reason \"Done\" --json\n+\n+# Search\n+bd list --status open --priority 1 --json\n+bd show <id> --json\n+\n+# Sync (CRITICAL at end of session!)\n+bd sync  # Force immediate export/commit/push\n+```\n+\n+### Workflow\n+\n+1. **Check ready work**: `bd ready --json`\n+2. **Claim task**: `bd update <id> --status in_progress`\n+3. **Work on it**: Implement, test, document\n+4. **Discover new work?** `bd create \"Found bug\" -p 1 --deps discovered-from:<parent-id> --json`\n+5. **Complete**: `bd close <id> --reason \"Done\" --json`\n+6. **Sync**: `bd sync` (flushes changes to git immediately)\n+\n+### Priorities\n+\n+- `0` - Critical (security, data loss, broken builds)\n+- `1` - High (major features, important bugs)\n+- `2` - Medium (default, nice-to-have)\n+- `3` - Low (polish, optimization)\n+- `4` - Backlog (future ideas)\n+\n+## Project Structure\n+\n+```\n+beads/\n+├── cmd/bd/              # CLI commands (add new commands here)\n+├── internal/\n+│   ├── types/           # Core data types\n+│   └── storage/         # Storage layer\n+│       └── sqlite/      # SQLite implementation\n+├── integrations/\n+│   └── beads-mcp/       # MCP server (Python)\n+├── examples/            # Integration examples\n+├── docs/                # Documentation\n+└── .beads/\n+    ├── beads.db         # SQLite database (DO NOT COMMIT)\n+    └── issues.jsonl     # Git-synced issue storage\n+```\n+\n+## Available Resources\n+\n+### MCP Server (Recommended)\n+Use the beads MCP server for native function calls instead of shell commands:\n+- Install: `pip install beads-mcp`\n+- Functions: `mcp__beads__ready()`, `mcp__beads__create()`, etc.\n+- See `integrations/beads-mcp/README.md`\n+\n+### Scripts\n+- `./scripts/bump-version.sh <version> --commit` - Update all version files atomically\n+- `./scripts/release.sh <version>` - Complete release workflow\n+- `./scripts/update-homebrew.sh <version>` - Update Homebrew formula\n+\n+### Key Documentation\n+- **AGENTS.md** - Comprehensive AI agent guide (detailed workflows, advanced features)\n+- **AGENT_INSTRUCTIONS.md** - Development procedures, testing, releases\n+- **README.md** - User-facing documentation\n+- **docs/CLI_REFERENCE.md** - Complete command reference\n+\n+## CLI Help\n+\n+Run `bd <command> --help` to see all available flags for any command.\n+For example: `bd create --help` shows `--parent`, `--deps`, `--assignee`, etc.\n+\n+## Important Rules\n+\n+- ✅ Use bd for ALL task tracking\n+- ✅ Always use `--json` flag for programmatic use\n+- ✅ Run `bd sync` at end of sessions\n+- ✅ Test with `BEADS_DB=/tmp/test.db`\n+- ✅ Run `bd <cmd> --help` to discover available flags\n+- ❌ Do NOT create markdown TODO lists\n+- ❌ Do NOT create test issues in production DB\n+- ❌ Do NOT commit `.beads/beads.db` (JSONL only)\n+\n+---\n+\n+**For detailed workflows and advanced features, see [AGENTS.md](../AGENTS.md)**\n+\n+---\n+\n+**Generated by bd v0.28.0**\n+\n+To regenerate this file after upgrading bd:\n+```bash\n+bd onboard --output .beads/BD_GUIDE.md\n+```\ndiff --git a/packages/sandbox/.beads/README.md b/packages/sandbox/.beads/README.md\nnew file mode 100644\nindex 000000000..50f281f03\n--- /dev/null\n+++ b/packages/sandbox/.beads/README.md\n@@ -0,0 +1,81 @@\n+# Beads - AI-Native Issue Tracking\n+\n+Welcome to Beads! This repository uses **Beads** for issue tracking - a modern, AI-native tool designed to live directly in your codebase alongside your code.\n+\n+## What is Beads?\n+\n+Beads is issue tracking that lives in your repo, making it perfect for AI coding agents and developers who want their issues close to their code. No web UI required - everything works through the CLI and integrates seamlessly with git.\n+\n+**Learn more:** [github.com/steveyegge/beads](https://github.com/steveyegge/beads)\n+\n+## Quick Start\n+\n+### Essential Commands\n+\n+```bash\n+# Create new issues\n+bd create \"Add user authentication\"\n+\n+# View all issues\n+bd list\n+\n+# View issue details\n+bd show <issue-id>\n+\n+# Update issue status\n+bd update <issue-id> --status in_progress\n+bd update <issue-id> --status done\n+\n+# Sync with git remote\n+bd sync\n+```\n+\n+### Working with Issues\n+\n+Issues in Beads are:\n+- **Git-native**: Stored in `.beads/issues.jsonl` and synced like code\n+- **AI-friendly**: CLI-first design works perfectly with AI coding agents\n+- **Branch-aware**: Issues can follow your branch workflow\n+- **Always in sync**: Auto-syncs with your commits\n+\n+## Why Beads?\n+\n+✨ **AI-Native Design**\n+- Built specifically for AI-assisted development workflows\n+- CLI-first interface works seamlessly with AI coding agents\n+- No context switching to web UIs\n+\n+🚀 **Developer Focused**\n+- Issues live in your repo, right next to your code\n+- Works offline, syncs when you push\n+- Fast, lightweight, and stays out of your way\n+\n+🔧 **Git Integration**\n+- Automatic sync with git commits\n+- Branch-aware issue tracking\n+- Intelligent JSONL merge resolution\n+\n+## Get Started with Beads\n+\n+Try Beads in your own projects:\n+\n+```bash\n+# Install Beads\n+curl -sSL https://raw.githubusercontent.com/steveyegge/beads/main/scripts/install.sh | bash\n+\n+# Initialize in your repo\n+bd init\n+\n+# Create your first issue\n+bd create \"Try out Beads\"\n+```\n+\n+## Learn More\n+\n+- **Documentation**: [github.com/steveyegge/beads/docs](https://github.com/steveyegge/beads/tree/main/docs)\n+- **Quick Start Guide**: Run `bd quickstart`\n+- **Examples**: [github.com/steveyegge/beads/examples](https://github.com/steveyegge/beads/tree/main/examples)\n+\n+---\n+\n+*Beads: Issue tracking that moves at the speed of thought* ⚡\ndiff --git a/packages/sandbox/.beads/config.yaml b/packages/sandbox/.beads/config.yaml\nnew file mode 100644\nindex 000000000..f2427856e\n--- /dev/null\n+++ b/packages/sandbox/.beads/config.yaml\n@@ -0,0 +1,62 @@\n+# Beads Configuration File\n+# This file configures default behavior for all bd commands in this repository\n+# All settings can also be set via environment variables (BD_* prefix)\n+# or overridden with command-line flags\n+\n+# Issue prefix for this repository (used by bd init)\n+# If not set, bd init will auto-detect from directory name\n+# Example: issue-prefix: \"myproject\" creates issues like \"myproject-1\", \"myproject-2\", etc.\n+# issue-prefix: \"\"\n+\n+# Use no-db mode: load from JSONL, no SQLite, write back after each command\n+# When true, bd will use .beads/issues.jsonl as the source of truth\n+# instead of SQLite database\n+# no-db: false\n+\n+# Disable daemon for RPC communication (forces direct database access)\n+# no-daemon: false\n+\n+# Disable auto-flush of database to JSONL after mutations\n+# no-auto-flush: false\n+\n+# Disable auto-import from JSONL when it's newer than database\n+# no-auto-import: false\n+\n+# Enable JSON output by default\n+# json: false\n+\n+# Default actor for audit trails (overridden by BD_ACTOR or --actor)\n+# actor: \"\"\n+\n+# Path to database (overridden by BEADS_DB or --db)\n+# db: \"\"\n+\n+# Auto-start daemon if not running (can also use BEADS_AUTO_START_DAEMON)\n+# auto-start-daemon: true\n+\n+# Debounce interval for auto-flush (can also use BEADS_FLUSH_DEBOUNCE)\n+# flush-debounce: \"5s\"\n+\n+# Git branch for beads commits (bd sync will commit to this branch)\n+# IMPORTANT: Set this for team projects so all clones use the same sync branch.\n+# This setting persists across clones (unlike database config which is gitignored).\n+# Can also use BEADS_SYNC_BRANCH env var for local override.\n+# If not set, bd sync will require you to run 'bd config set sync.branch <branch>'.\n+# sync-branch: \"beads-sync\"\n+\n+# Multi-repo configuration (experimental - bd-307)\n+# Allows hydrating from multiple repositories and routing writes to the correct JSONL\n+# repos:\n+#   primary: \".\"  # Primary repo (where this database lives)\n+#   additional:   # Additional repos to hydrate from (read-only)\n+#     - ~/beads-planning  # Personal planning repo\n+#     - ~/work-planning   # Work planning repo\n+\n+# Integration settings (access with 'bd config get/set')\n+# These are stored in the database, not in this file:\n+# - jira.url\n+# - jira.project\n+# - linear.url\n+# - linear.api-key\n+# - github.org\n+# - github.repo\ndiff --git a/packages/sandbox/.beads/issues.jsonl b/packages/sandbox/.beads/issues.jsonl\nnew file mode 100644\nindex 000000000..c333baed8\n--- /dev/null\n+++ b/packages/sandbox/.beads/issues.jsonl\n@@ -0,0 +1,29 @@\n+{\"id\":\"sandbox-03i\",\"title\":\"Handle 'too many open files' error when user opens too many sandboxes\",\"description\":\"\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"bug\",\"created_at\":\"2025-12-02T21:37:29.675991-08:00\",\"updated_at\":\"2025-12-02T21:37:29.675991-08:00\"}\n+{\"id\":\"sandbox-1af\",\"title\":\"Implement cmux prune command for interactive cleanup of unused sandboxes\",\"description\":\"\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"feature\",\"created_at\":\"2025-12-02T15:28:30.679424-08:00\",\"updated_at\":\"2025-12-02T15:28:30.679424-08:00\"}\n+{\"id\":\"sandbox-1fx\",\"title\":\"Terminal shows stray # artifacts before prompts\",\"description\":\"## Problem\\nTerminal shows stray `#` characters appearing on their own lines before the actual shell prompt:\\n```\\n#\\nroot@sandbox-15:/workspace (main)#\\n#\\nroot@sandbox-15:/workspace (main)#\\n```\\n\\n## Hypotheses\\n\\n1. **Shell prompt carriage return issue**: The shell writes `#` first, then uses `\\\\r` to overwrite with full prompt, but our terminal isn't clearing the line properly on `\\\\r`\\n\\n2. **Terminal resize timing**: When terminal connects, resize signal causes shell to redraw prompt before size is properly set, leaving partial renders\\n\\n3. **vcs_info (git) in zsh prompt**: The `precmd() { vcs_info }` hook runs before each prompt. If it outputs anything or has timing issues with the async git status, could cause double renders\\n\\n4. **Line wrapping + resize**: Long prompt wrapping then getting redrawn at different width could leave the trailing `#` character as an artifact\\n\\n5. **Connection timing**: Terminal connects while shell is mid-prompt-output, causing partial characters to be captured\\n\\n## Relevant files\\n- `src/mux/terminal.rs` - Virtual terminal emulator\\n- `src/mux/grid.rs` - Grid resize handling\\n- `src/bubblewrap.rs:419` - zsh PROMPT definition with vcs_info\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"bug\",\"created_at\":\"2025-12-03T18:37:04.803472-08:00\",\"updated_at\":\"2025-12-03T18:40:33.119309-08:00\"}\n+{\"id\":\"sandbox-2s8\",\"title\":\"Make zsh default shell and copy user's zshrc, plugins, and history into container\",\"description\":\"\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"feature\",\"created_at\":\"2025-12-02T15:28:19.053185-08:00\",\"updated_at\":\"2025-12-02T16:17:08.574616-08:00\",\"closed_at\":\"2025-12-02T16:17:08.574616-08:00\"}\n+{\"id\":\"sandbox-3tz\",\"title\":\"Refactor virtual terminal using zellij strategy for performance and edge cases\",\"description\":\"\",\"status\":\"open\",\"priority\":3,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T15:28:34.279873-08:00\",\"updated_at\":\"2025-12-02T15:28:34.279873-08:00\"}\n+{\"id\":\"sandbox-5dx\",\"title\":\"Dogfooding: Add command palette action for merging feature branches\",\"description\":\"\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"feature\",\"created_at\":\"2025-12-02T15:28:42.184904-08:00\",\"updated_at\":\"2025-12-02T15:28:42.184904-08:00\"}\n+{\"id\":\"sandbox-5jp\",\"title\":\"Fix Alt+Shift+X keybinding not triggering DeleteSandbox\",\"description\":\"When pressing Alt+Shift+X, it just types instead of triggering the delete sandbox command. The keybinding is defined with KeyCode::Char('X') (uppercase) but macOS terminals may report shift+letter differently.\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"bug\",\"created_at\":\"2025-12-02T17:19:46.268812-08:00\",\"updated_at\":\"2025-12-02T17:48:54.829342-08:00\",\"closed_at\":\"2025-12-02T17:48:54.829342-08:00\"}\n+{\"id\":\"sandbox-5xq\",\"title\":\"Support TUI pointer control in terminal (OSC22, xterm-style cursor sequences)\",\"description\":\"\",\"status\":\"open\",\"priority\":3,\"issue_type\":\"feature\",\"created_at\":\"2025-12-02T15:28:32.576193-08:00\",\"updated_at\":\"2025-12-02T15:28:32.576193-08:00\"}\n+{\"id\":\"sandbox-80u\",\"title\":\"Implement text highlighting and copy to clipboard in virtual terminal\",\"description\":\"\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"feature\",\"created_at\":\"2025-12-02T15:28:23.487953-08:00\",\"updated_at\":\"2025-12-02T15:28:23.487953-08:00\"}\n+{\"id\":\"sandbox-9a2\",\"title\":\"Instrument and optimize sandbox creation time (parallelize bottlenecks)\",\"description\":\"\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T15:28:40.510054-08:00\",\"updated_at\":\"2025-12-02T15:28:40.510054-08:00\"}\n+{\"id\":\"sandbox-a97\",\"title\":\"Support option+backspace (delete word) and cmd+backspace (delete to line start) in terminal\",\"description\":\"\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"feature\",\"created_at\":\"2025-12-02T15:28:26.847678-08:00\",\"updated_at\":\"2025-12-02T15:39:02.101918-08:00\",\"closed_at\":\"2025-12-02T15:39:02.101918-08:00\"}\n+{\"id\":\"sandbox-b7d\",\"title\":\"Sync user's neovim/lazyvim config to sandbox\",\"description\":\"## Problem\\nSupport syncing user's nvim configuration (including lazyvim) to sandboxes without slowing down initial creation time.\\n\\n## Analysis\\n\\n### Lazyvim directory structure:\\n- ~/.config/nvim - Config files, lua scripts, lazy-lock.json (~100KB-1MB)\\n- ~/.local/share/nvim - Plugins installed by lazy.nvim (~500MB-2GB!)\\n- ~/.local/state/nvim - State files (~small)\\n- ~/.cache/nvim - Compiled lua, treesitter parsers (~100MB+)\\n\\n### Options considered:\\n\\n**1. Background sync after sandbox ready**\\n- Start sandbox without nvim configs, sync in background\\n- Con: User might try nvim before sync completes\\n\\n**2. Volume mount from host**\\n- Mount ~/.config/nvim as read-only volume\\n- Con: Security concerns, sandbox isolation breaks\\n\\n**3. Pre-baked image with nvim distributions**\\n- Include lazyvim/nvchad in Docker image\\n- Con: Large image, not personalized, version mismatches\\n\\n**4. Smart differential sync**\\n- Cache tarball locally, only re-create if changed\\n- Con: First run still slow\\n\\n**5. Config-only sync (RECOMMENDED)**\\n- Only sync ~/.config/nvim (~1MB, fast)\\n- Let lazy.nvim download plugins on first nvim launch\\n- Pro: Small sync, always fresh plugins, personalized config\\n- Con: First nvim launch triggers plugin install (~1-2min)\\n\\n**6. Hybrid with shared plugin volume**\\n- Sync config, share plugin volume across sandboxes\\n- Pro: Fast after first sandbox ever\\n- Con: Complex, plugin conflicts possible\\n\\n## Recommendation\\nStart with option 5 (config-only sync):\\n1. Add ~/.config/nvim to sync_files detection\\n2. Upload during sandbox creation (adds \\u003c1s)\\n3. First nvim launch triggers lazy.nvim plugin sync\\n\\nFuture enhancement: Create shared nvim plugin cache volume.\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"feature\",\"created_at\":\"2025-12-02T17:19:51.204711-08:00\",\"updated_at\":\"2025-12-02T17:20:19.542345-08:00\"}\n+{\"id\":\"sandbox-dit\",\"title\":\"Configure git diff to always use less pager even for small diffs\",\"description\":\"\",\"status\":\"closed\",\"priority\":3,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T15:28:38.675495-08:00\",\"updated_at\":\"2025-12-02T16:49:12.05496-08:00\",\"closed_at\":\"2025-12-02T16:49:12.05496-08:00\"}\n+{\"id\":\"sandbox-edx\",\"title\":\"Race condition: rapid sandbox creation causes state tearing\",\"description\":\"When creating many sandboxes very quickly, there's 'tearing' of the state - the 'Creating sandbox' placeholder is not always correctly associated with the actual sandbox being created. This suggests a race condition in how placeholders are matched to completed sandboxes.\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"bug\",\"created_at\":\"2025-12-02T18:12:02.199172-08:00\",\"updated_at\":\"2025-12-02T18:32:38.76567-08:00\",\"closed_at\":\"2025-12-02T18:32:38.76567-08:00\"}\n+{\"id\":\"sandbox-hre\",\"title\":\"Fix remaining escape sequence TODOs from docs/escape-sequence-todos.md\",\"description\":\"\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T15:28:35.721736-08:00\",\"updated_at\":\"2025-12-02T16:38:11.260382-08:00\",\"closed_at\":\"2025-12-02T16:38:11.260382-08:00\"}\n+{\"id\":\"sandbox-ic9\",\"title\":\"Set up SSH access to sandboxes\",\"description\":\"\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T21:10:42.153335-08:00\",\"updated_at\":\"2025-12-02T21:10:42.153335-08:00\"}\n+{\"id\":\"sandbox-o5t\",\"title\":\"Make links navigatable via command+click in sandbox terminal\",\"description\":\"\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"feature\",\"created_at\":\"2025-12-02T15:28:29.18654-08:00\",\"updated_at\":\"2025-12-02T15:28:29.18654-08:00\"}\n+{\"id\":\"sandbox-oad\",\"title\":\"Auto-scroll to cursor when user is typing if not already in view\",\"description\":\"\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"feature\",\"created_at\":\"2025-12-02T15:28:37.338372-08:00\",\"updated_at\":\"2025-12-02T16:47:10.561283-08:00\",\"closed_at\":\"2025-12-02T16:47:10.561283-08:00\"}\n+{\"id\":\"sandbox-p8w\",\"title\":\"Implement session persistence and reattachment (tmux-like behavior)\",\"description\":\"Currently PTY sessions are killed when WebSocket disconnects. Need to:\\n1. Decouple PTY process lifecycle from client connections\\n2. Create persistent session registry that survives disconnects\\n3. Support reattaching to existing sessions with scrollback preserved\\n4. Keep TUI apps (vim, git diff, less) alive when client disconnects\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"feature\",\"created_at\":\"2025-12-02T22:11:39.143236-08:00\",\"updated_at\":\"2025-12-02T22:11:39.143236-08:00\"}\n+{\"id\":\"sandbox-qcr\",\"title\":\"Fix Alt+B Open Browser - cmux browser doesn't accept --base-url flag\",\"description\":\"Code spawns 'cmux browser $id --base-url $base_url' but the CLI only accepts the ID argument, not --base-url. Error: unexpected argument '--base-url' found\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"bug\",\"created_at\":\"2025-12-02T17:19:48.755945-08:00\",\"updated_at\":\"2025-12-02T17:19:48.755945-08:00\"}\n+{\"id\":\"sandbox-qem\",\"title\":\"Handle open commands inside sandboxes and propagate to host machine\",\"description\":\"\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"feature\",\"created_at\":\"2025-12-02T15:28:27.700385-08:00\",\"updated_at\":\"2025-12-02T15:39:03.311959-08:00\",\"closed_at\":\"2025-12-02T15:39:03.311959-08:00\"}\n+{\"id\":\"sandbox-rpn\",\"title\":\"Implement better mouse scrolling behavior with momentum (like chat scroll area)\",\"description\":\"\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"feature\",\"created_at\":\"2025-12-02T15:28:20.420206-08:00\",\"updated_at\":\"2025-12-02T15:28:20.420206-08:00\"}\n+{\"id\":\"sandbox-ssw\",\"title\":\"Preinstall emacs and neovim in Docker container (vim/zsh already done)\",\"description\":\"\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"feature\",\"created_at\":\"2025-12-02T15:28:16.814211-08:00\",\"updated_at\":\"2025-12-02T15:58:11.308243-08:00\",\"closed_at\":\"2025-12-02T15:58:11.308243-08:00\"}\n+{\"id\":\"sandbox-t33\",\"title\":\"Fix Alt+E Open Editor - SSH URI uses sandbox_id not actual host\",\"description\":\"Alt+E tries vscode-remote://ssh-remote+root@{sandbox_id}/workspace but sandbox_id is a UUID, not an SSH hostname. Need to use proper connection method - either container IP, port forwarding, or web-based editor.\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"bug\",\"created_at\":\"2025-12-02T17:19:47.617841-08:00\",\"updated_at\":\"2025-12-02T17:19:47.617841-08:00\",\"dependencies\":[{\"issue_id\":\"sandbox-t33\",\"depends_on_id\":\"sandbox-ic9\",\"type\":\"blocks\",\"created_at\":\"2025-12-02T21:10:48.728812-08:00\",\"created_by\":\"daemon\"}]}\n+{\"id\":\"sandbox-ubb\",\"title\":\"Add command palette actions for opening sandbox browser (alt+b) and editor (alt+e)\",\"description\":\"\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"feature\",\"created_at\":\"2025-12-02T15:28:21.761978-08:00\",\"updated_at\":\"2025-12-02T16:44:05.75665-08:00\",\"closed_at\":\"2025-12-02T16:44:05.75665-08:00\"}\n+{\"id\":\"sandbox-v2g\",\"title\":\"Alternate screen buffer content persists after app exit (git diff/less)\",\"description\":\"After running git diff and it exits, the previous content stays on screen instead of being restored. This suggests alternate screen buffer (DECSET 1049) restore isn't working correctly.\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"bug\",\"created_at\":\"2025-12-02T17:19:49.997267-08:00\",\"updated_at\":\"2025-12-02T17:19:49.997267-08:00\"}\n+{\"id\":\"sandbox-wf5\",\"title\":\"Command palette option to copy entire scrollback to clipboard\",\"description\":\"\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"feature\",\"created_at\":\"2025-12-02T21:09:59.95193-08:00\",\"updated_at\":\"2025-12-02T21:09:59.95193-08:00\"}\n+{\"id\":\"sandbox-xrq\",\"title\":\"Add keyboard shortcut to delete sandbox (alt+shift+w is currently CloseTab)\",\"description\":\"\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"feature\",\"created_at\":\"2025-12-02T15:28:25.430463-08:00\",\"updated_at\":\"2025-12-02T16:19:33.257153-08:00\",\"closed_at\":\"2025-12-02T16:19:33.257153-08:00\"}\n+{\"id\":\"sandbox-xyz\",\"title\":\"Add better logging for sandbox lifecycle (creation, cleanup, FD usage)\",\"description\":\"\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-02T21:57:23.496291-08:00\",\"updated_at\":\"2025-12-02T21:57:37.966722-08:00\",\"closed_at\":\"2025-12-02T21:57:37.966722-08:00\"}\ndiff --git a/packages/sandbox/.beads/metadata.json b/packages/sandbox/.beads/metadata.json\nnew file mode 100644\nindex 000000000..881801f99\n--- /dev/null\n+++ b/packages/sandbox/.beads/metadata.json\n@@ -0,0 +1,5 @@\n+{\n+  \"database\": \"beads.db\",\n+  \"jsonl_export\": \"issues.jsonl\",\n+  \"last_bd_version\": \"0.28.0\"\n+}\n\\ No newline at end of file\ndiff --git a/packages/sandbox/.claude/settings.json b/packages/sandbox/.claude/settings.json\nnew file mode 100644\nindex 000000000..0724cebfd\n--- /dev/null\n+++ b/packages/sandbox/.claude/settings.json\n@@ -0,0 +1,35 @@\n+{\n+  \"$schema\": \"https://json.schemastore.org/claude-code-settings.json\",\n+  \"alwaysThinkingEnabled\": true,\n+  \"feedbackSurveyState\": {\n+    \"lastShownTime\": 1754013974739\n+  },\n+  \"hooks\": {\n+    \"PreCompact\": [\n+      {\n+        \"hooks\": [\n+          {\n+            \"command\": \"bd prime\",\n+            \"type\": \"command\"\n+          }\n+        ],\n+        \"matcher\": \"\"\n+      }\n+    ],\n+    \"SessionStart\": [\n+      {\n+        \"hooks\": [\n+          {\n+            \"command\": \"bd prime\",\n+            \"type\": \"command\"\n+          }\n+        ],\n+        \"matcher\": \"\"\n+      }\n+    ]\n+  },\n+  \"includeCoAuthoredBy\": false,\n+  \"permissions\": {\n+    \"defaultMode\": \"default\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/packages/sandbox/.gitattributes b/packages/sandbox/.gitattributes\nnew file mode 100644\nindex 000000000..807d5983d\n--- /dev/null\n+++ b/packages/sandbox/.gitattributes\n@@ -0,0 +1,3 @@\n+\n+# Use bd merge for beads JSONL files\n+.beads/issues.jsonl merge=beads\ndiff --git a/packages/sandbox/Dockerfile b/packages/sandbox/Dockerfile\nindex 06447cdd1..433865734 100644\n--- a/packages/sandbox/Dockerfile\n+++ b/packages/sandbox/Dockerfile\n@@ -136,6 +136,8 @@ RUN --mount=type=cache,target=/var/cache/apt,sharing=locked \\\n   zsh-autosuggestions \\\n   zsh-syntax-highlighting \\\n   vim \\\n+  neovim \\\n+  emacs-nox \\\n   tini \\\n   python3 \\\n   python3-venv \\\ndiff --git a/packages/sandbox/src/api.rs b/packages/sandbox/src/api.rs\nindex 6d3844ec0..2f3ab9c4f 100644\n--- a/packages/sandbox/src/api.rs\n+++ b/packages/sandbox/src/api.rs\n@@ -483,6 +483,7 @@ mod tests {\n                 sandbox_ip: \"10.0.0.2\".to_string(),\n                 cidr: 30,\n             },\n+            correlation_id: None,\n         }\n     }\n \ndiff --git a/packages/sandbox/src/bubblewrap.rs b/packages/sandbox/src/bubblewrap.rs\nindex 8ad2b7d9f..8652c7b01 100644\n--- a/packages/sandbox/src/bubblewrap.rs\n+++ b/packages/sandbox/src/bubblewrap.rs\n@@ -60,6 +60,8 @@ struct SandboxHandle {\n     network: SandboxNetwork,\n     created_at: DateTime<Utc>,\n     lease: IpLease,\n+    /// Correlation ID for matching placeholders to created sandboxes (from tab_id)\n+    correlation_id: Option<String>,\n }\n \n #[derive(Clone)]\n@@ -475,8 +477,8 @@ fi\n         fs::create_dir_all(&root_home).await?;\n \n         let gitconfig = root_home.join(\".gitconfig\");\n-        // Only set safe.directory - don't override user's pager preferences\n-        // Users can enable delta via command palette (EnableDeltaPager)\n+        // Only set safe.directory - user's gitconfig is synced from host\n+        // Users can enable delta via command palette (EnableDeltaPager) for better diff viewing\n         let content = r#\"[safe]\n \tdirectory = *\n \"#;\n@@ -1119,6 +1121,7 @@ impl SandboxService for BubblewrapService {\n             network,\n             created_at: Utc::now(),\n             lease,\n+            correlation_id: request.tab_id.clone(),\n         };\n \n         let entry = SandboxEntry {\n@@ -2076,6 +2079,7 @@ impl SandboxHandle {\n             workspace: self.workspace.to_string_lossy().to_string(),\n             status,\n             network: self.network.clone(),\n+            correlation_id: self.correlation_id.clone(),\n         }\n     }\n }\ndiff --git a/packages/sandbox/src/models.rs b/packages/sandbox/src/models.rs\nindex ad5372303..a2eb8ed65 100644\n--- a/packages/sandbox/src/models.rs\n+++ b/packages/sandbox/src/models.rs\n@@ -28,6 +28,8 @@ pub struct CreateSandboxRequest {\n \n #[derive(Clone, Debug, Deserialize, Serialize, ToSchema, PartialEq, Eq)]\n pub enum SandboxStatus {\n+    /// Placeholder - creation in progress (client-only, never sent by server)\n+    Creating,\n     Running,\n     Exited,\n     Failed,\n@@ -52,6 +54,11 @@ pub struct SandboxSummary {\n     pub workspace: String,\n     pub status: SandboxStatus,\n     pub network: SandboxNetwork,\n+    /// Correlation ID (tab_id) for matching placeholders to created sandboxes.\n+    /// Set by client when creating a placeholder; used to update in-place when\n+    /// the server responds with the real sandbox.\n+    #[serde(default)]\n+    pub correlation_id: Option<String>,\n }\n \n #[derive(Clone, Debug, Deserialize, Serialize, ToSchema)]\ndiff --git a/packages/sandbox/src/mux/commands.rs b/packages/sandbox/src/mux/commands.rs\nindex ca4850600..63129dfea 100644\n--- a/packages/sandbox/src/mux/commands.rs\n+++ b/packages/sandbox/src/mux/commands.rs\n@@ -489,7 +489,9 @@ impl MuxCommand {\n \n             // Sandbox management - use Alt\n             MuxCommand::NewSandbox => Some((KeyModifiers::ALT, KeyCode::Char('n'))),\n-            MuxCommand::DeleteSandbox => None, // No default keybinding, access via command palette\n+            MuxCommand::DeleteSandbox => {\n+                Some((KeyModifiers::ALT | KeyModifiers::SHIFT, KeyCode::Char('X')))\n+            }\n             MuxCommand::RefreshSandboxes => Some((KeyModifiers::ALT, KeyCode::Char('R'))), // Alt+Shift+R\n \n             // Session - use Alt\n@@ -629,6 +631,12 @@ impl MuxCommand {\n                 KeyCode::Char('D') => return Some(MuxCommand::SplitHorizontal),\n                 _ => {}\n             }\n+\n+            // Alt+X (uppercase, meaning Alt+Shift+X) for delete sandbox\n+            // Handle this specially because macOS may report Alt+Shift+X as just Alt with 'X'\n+            if keycode == KeyCode::Char('X') {\n+                return Some(MuxCommand::DeleteSandbox);\n+            }\n         }\n \n         for cmd in Self::all() {\ndiff --git a/packages/sandbox/src/mux/events.rs b/packages/sandbox/src/mux/events.rs\nindex 828cbb53d..67e3c3c01 100644\n--- a/packages/sandbox/src/mux/events.rs\n+++ b/packages/sandbox/src/mux/events.rs\n@@ -17,8 +17,11 @@ pub enum MuxEvent {\n     SandboxesRefreshed(Vec<SandboxSummary>),\n     /// Failed to refresh sandboxes.\n     SandboxRefreshFailed(String),\n-    /// A sandbox was created.\n-    SandboxCreated(SandboxSummary),\n+    /// A sandbox was created (includes tab_id for correlation with placeholder).\n+    SandboxCreated {\n+        sandbox: SandboxSummary,\n+        tab_id: Option<String>,\n+    },\n     /// Attach tab metadata to a sandbox (used to keep CMUX_TAB_ID aligned with UI tab).\n     SandboxTabMapped { sandbox_id: String, tab_id: String },\n     /// A sandbox was deleted.\ndiff --git a/packages/sandbox/src/mux/runner.rs b/packages/sandbox/src/mux/runner.rs\nindex 0b933e6f3..1239c8919 100644\n--- a/packages/sandbox/src/mux/runner.rs\n+++ b/packages/sandbox/src/mux/runner.rs\n@@ -188,7 +188,7 @@ async fn run_app<B: ratatui::backend::Backend + std::io::Write>(\n             Some(event) = event_rx.recv() => {\n                 match &event {\n                     MuxEvent::ConnectToSandbox { sandbox_id } => {\n-                        app.pending_connect = Some(sandbox_id.clone());\n+                        app.pending_connects.push_back(sandbox_id.clone());\n                         try_consume_pending_connection(&mut app, &terminal_manager);\n                     }\n                     MuxEvent::CreateSandboxWithWorkspace {\n@@ -200,10 +200,6 @@ async fn run_app<B: ratatui::backend::Backend + std::io::Write>(\n                         let workspace_path = workspace_path.clone();\n                         let tab_id_value =\n                             tab_id.clone().unwrap_or_else(|| TabId::new().to_string());\n-                        if let Ok(uuid) = uuid::Uuid::parse_str(&tab_id_value) {\n-                            app.pending_creation_tab_ids\n-                                .push_back(TabId::from_uuid(uuid));\n-                        }\n                         tokio::spawn(async move {\n                             if let Err(error) = create_sandbox_with_workspace(\n                                 base_url,\n@@ -221,11 +217,12 @@ async fn run_app<B: ratatui::backend::Backend + std::io::Write>(\n                         });\n                     }\n                     MuxEvent::ConnectActivePaneToSandbox => {\n+                        // Use selected sandbox, or fall back to first item in pending queue\n                         let target = app\n                             .selected_sandbox_id_string()\n-                            .or_else(|| app.pending_connect.clone());\n+                            .or_else(|| app.pending_connects.front().cloned());\n                         if let Some(sandbox_id) = target {\n-                            app.pending_connect = Some(sandbox_id);\n+                            app.pending_connects.push_back(sandbox_id);\n                             try_consume_pending_connection(&mut app, &terminal_manager);\n                         }\n                     }\n@@ -294,7 +291,7 @@ async fn run_app<B: ratatui::backend::Backend + std::io::Write>(\n                         handle_onboard_event(&mut app, onboard_event.clone(), &event_tx_for_handler);\n                     }\n                     MuxEvent::SendTerminalInput { pane_id, input } => {\n-                        if let Ok(manager) = terminal_manager.try_lock() {\n+                        if let Ok(mut manager) = terminal_manager.try_lock() {\n                             if !manager.send_input(*pane_id, input.clone()) {\n                                 tracing::warn!(\"Failed to send terminal input to pane {:?}\", pane_id);\n                             }\n@@ -353,79 +350,109 @@ fn fallback_terminal_size() -> (u16, u16) {\n     (fallback_rows, fallback_cols)\n }\n \n-fn connect_active_pane_to_sandbox(\n-    app: &MuxApp<'_>,\n+/// Process all pending sandbox connections from the queue.\n+/// This connects terminals for ALL user-created sandboxes, not just the selected one.\n+fn try_consume_pending_connection(\n+    app: &mut MuxApp<'_>,\n     terminal_manager: &crate::mux::terminal::SharedTerminalManager,\n-    sandbox_id: &str,\n ) {\n-    let Some(pane_id) = app.active_pane_id() else {\n-        return;\n-    };\n-\n-    if let Ok(guard) = terminal_manager.try_lock() {\n-        if guard.is_connected(pane_id) {\n-            return;\n+    // Process all pending connections in the queue\n+    while let Some(sandbox_id) = app.pending_connects.pop_front() {\n+        // Verify the sandbox exists in sidebar\n+        let sandbox_exists = app\n+            .sidebar\n+            .sandboxes\n+            .iter()\n+            .any(|s| s.id.to_string() == sandbox_id);\n+        if !sandbox_exists {\n+            continue;\n         }\n-    }\n-\n-    let (rows, cols) = preferred_size_for_pane(app, pane_id).unwrap_or_else(fallback_terminal_size);\n-    let manager = terminal_manager.clone();\n-    let event_tx = app.event_tx.clone();\n-    let sandbox_id = sandbox_id.to_string();\n-    let tab_id = app.workspace_manager.active_tab_id();\n \n-    tokio::spawn(async move {\n-        if let Err(e) = connect_to_sandbox(manager, pane_id, sandbox_id, tab_id, cols, rows).await {\n-            let _ = event_tx.send(MuxEvent::Error(format!(\n-                \"Failed to connect to sandbox: {}\",\n-                e\n-            )));\n-        }\n-    });\n+        // Connect terminal for this specific sandbox's workspace\n+        connect_sandbox_terminal(app, terminal_manager, &sandbox_id);\n+    }\n }\n \n-fn try_consume_pending_connection(\n+/// Connect a terminal for a SPECIFIC sandbox (not necessarily the currently selected one).\n+/// This gets the pane from the sandbox's own workspace and connects the terminal there.\n+fn connect_sandbox_terminal(\n     app: &mut MuxApp<'_>,\n     terminal_manager: &crate::mux::terminal::SharedTerminalManager,\n+    sandbox_id: &str,\n ) {\n-    let Some(sandbox_id) = app.pending_connect.clone() else {\n-        return;\n-    };\n+    use crate::mux::layout::{PaneContent, SandboxId};\n \n-    if !app.select_sandbox(&sandbox_id) {\n+    // Parse the sandbox ID\n+    let Ok(sandbox_uuid) = uuid::Uuid::parse_str(sandbox_id) else {\n         return;\n-    }\n+    };\n+    let sandbox_layout_id = SandboxId::from_uuid(sandbox_uuid);\n \n-    app.sidebar.select_by_id(&sandbox_id);\n+    // Get the pane_id from this sandbox's workspace (not the active workspace!)\n+    let pane_id = app\n+        .workspace_manager\n+        .get_workspace(sandbox_layout_id)\n+        .and_then(|ws| ws.active_tab())\n+        .and_then(|tab| tab.active_pane);\n \n-    let Some(pane_id) = app.active_pane_id() else {\n+    let Some(pane_id) = pane_id else {\n         return;\n     };\n \n-    if let Some(tab) = app.active_tab_mut() {\n-        if let Some(pane) = tab.layout.find_pane_mut(pane_id) {\n-            if let PaneContent::Terminal {\n-                sandbox_id: pane_sandbox,\n-                ..\n-            } = &mut pane.content\n-            {\n-                *pane_sandbox = Some(sandbox_id.clone());\n+    // Update the pane's sandbox_id in the workspace\n+    if let Some(ws) = app.workspace_manager.get_workspace_mut(sandbox_layout_id) {\n+        if let Some(tab) = ws.active_tab_mut() {\n+            if let Some(pane) = tab.layout.find_pane_mut(pane_id) {\n+                if let PaneContent::Terminal {\n+                    sandbox_id: pane_sandbox,\n+                    ..\n+                } = &mut pane.content\n+                {\n+                    *pane_sandbox = Some(sandbox_id.to_string());\n+                }\n             }\n         }\n     }\n \n+    // Check if already connected\n     let already_connected = terminal_manager\n         .try_lock()\n         .map(|guard| guard.is_connected(pane_id))\n         .unwrap_or(false);\n \n     if already_connected {\n-        app.pending_connect = None;\n         return;\n     }\n \n-    connect_active_pane_to_sandbox(app, terminal_manager, &sandbox_id);\n-    app.pending_connect = None;\n+    // Get dimensions for the pane\n+    let (rows, cols) = app\n+        .workspace_manager\n+        .get_workspace(sandbox_layout_id)\n+        .and_then(|ws| ws.active_tab())\n+        .and_then(|tab| tab.layout.find_pane(pane_id))\n+        .and_then(pane_content_dimensions)\n+        .unwrap_or_else(fallback_terminal_size);\n+\n+    // Spawn terminal connection\n+    let manager = terminal_manager.clone();\n+    let event_tx = app.event_tx.clone();\n+    let sandbox_id_owned = sandbox_id.to_string();\n+    let tab_id = app\n+        .workspace_manager\n+        .get_workspace(sandbox_layout_id)\n+        .and_then(|ws| ws.active_tab())\n+        .map(|tab| tab.id);\n+\n+    tokio::spawn(async move {\n+        if let Err(e) =\n+            connect_to_sandbox(manager, pane_id, sandbox_id_owned, tab_id, cols, rows).await\n+        {\n+            let _ = event_tx.send(MuxEvent::Error(format!(\n+                \"Failed to connect to sandbox: {}\",\n+                e\n+            )));\n+        }\n+    });\n }\n \n fn pane_content_dimensions(pane: &crate::mux::layout::Pane) -> Option<(u16, u16)> {\n@@ -440,15 +467,6 @@ fn pane_content_dimensions(pane: &crate::mux::layout::Pane) -> Option<(u16, u16)\n     Some((rows, cols))\n }\n \n-fn preferred_size_for_pane(\n-    app: &MuxApp<'_>,\n-    pane_id: crate::mux::layout::PaneId,\n-) -> Option<(u16, u16)> {\n-    let tab = app.active_tab()?;\n-    let pane = tab.layout.find_pane(pane_id)?;\n-    pane_content_dimensions(pane)\n-}\n-\n fn sync_terminal_sizes(\n     app: &MuxApp<'_>,\n     terminal_manager: &crate::mux::terminal::SharedTerminalManager,\n@@ -744,6 +762,21 @@ fn handle_input(\n                 if cmd == MuxCommand::Quit {\n                     return true;\n                 }\n+                // Handle DeleteSandbox specially - needs to remove from sidebar immediately\n+                // and spawn async deletion task (same as Backspace in sidebar)\n+                if cmd == MuxCommand::DeleteSandbox {\n+                    if let Some((sandbox_id, sandbox_name)) = remove_selected_sandbox(app) {\n+                        let base_url = app.base_url.clone();\n+                        let event_tx = app.event_tx.clone();\n+\n+                        app.set_status(format!(\"Deleting sandbox: {}\", sandbox_name));\n+\n+                        tokio::spawn(async move {\n+                            delete_sidebar_sandbox(base_url, sandbox_id, event_tx).await;\n+                        });\n+                    }\n+                    return false;\n+                }\n                 app.execute_command(cmd);\n                 return false;\n             }\n@@ -795,7 +828,7 @@ fn handle_input(\n                         if let Some(pane_id) = app.active_pane_id() {\n                             let input = key_to_terminal_input(key.modifiers, key.code);\n                             if !input.is_empty() {\n-                                if let Ok(guard) = terminal_manager.try_lock() {\n+                                if let Ok(mut guard) = terminal_manager.try_lock() {\n                                     guard.send_input(pane_id, input);\n                                 }\n                             }\n@@ -940,7 +973,7 @@ fn handle_input(\n                                 }\n                             }\n \n-                            if let Ok(guard) = terminal_manager.try_lock() {\n+                            if let Ok(mut guard) = terminal_manager.try_lock() {\n                                 let (mouse_mode, sgr_mode) = guard\n                                     .get_buffer(pane_id)\n                                     .map(|b| (b.mouse_tracking(), b.sgr_mouse_mode()))\n@@ -992,7 +1025,7 @@ fn handle_input(\n         Event::Paste(text) => {\n             // Forward paste to active terminal\n             if let Some(pane_id) = app.active_pane_id() {\n-                if let Ok(guard) = terminal_manager.try_lock() {\n+                if let Ok(mut guard) = terminal_manager.try_lock() {\n                     guard.send_input(pane_id, text.into_bytes());\n                 }\n             }\n@@ -1066,12 +1099,17 @@ fn remove_selected_sandbox(app: &mut MuxApp<'_>) -> Option<(String, String)> {\n         return None;\n     }\n \n-    let current_index = app\n-        .sidebar\n-        .selected_index\n-        .min(app.sidebar.sandboxes.len().saturating_sub(1));\n+    // Get the current selected sandbox by ID\n+    let selected_id = app.sidebar.selected_id?;\n+    let current_index = app.sidebar.selected_index();\n \n-    let sandbox = app.sidebar.sandboxes.remove(current_index);\n+    // Find and remove the sandbox from the list\n+    let sandbox_pos = app\n+        .sidebar\n+        .sandboxes\n+        .iter()\n+        .position(|s| s.id == selected_id)?;\n+    let sandbox = app.sidebar.sandboxes.remove(sandbox_pos);\n     let sandbox_id = sandbox.id.to_string();\n     let sandbox_name = sandbox.name.clone();\n     let sandbox_uuid = SandboxId::from_uuid(sandbox.id);\n@@ -1079,29 +1117,23 @@ fn remove_selected_sandbox(app: &mut MuxApp<'_>) -> Option<(String, String)> {\n     app.workspace_manager.remove_sandbox(sandbox_uuid);\n     app.focus = FocusArea::Sidebar;\n \n-    if let Some(pending) = &app.pending_connect {\n-        if pending == &sandbox_id {\n-            app.pending_connect = None;\n-        }\n-    }\n+    // Remove the deleted sandbox from pending_connects queue\n+    app.pending_connects.retain(|id| id != &sandbox_id);\n \n     if app.sidebar.sandboxes.is_empty() {\n-        app.sidebar.selected_index = 0;\n+        app.sidebar.selected_id = None;\n         app.workspace_manager.active_sandbox_id = None;\n         return Some((sandbox_id, sandbox_name));\n     }\n \n-    let next_index = if current_index < app.sidebar.sandboxes.len() {\n-        current_index\n-    } else {\n-        app.sidebar.sandboxes.len() - 1\n-    };\n-\n-    app.sidebar.selected_index = next_index;\n+    // Select the next sandbox (stay at same position, or last if we removed the last)\n+    let next_index = current_index.min(app.sidebar.sandboxes.len() - 1);\n+    let next_sandbox = &app.sidebar.sandboxes[next_index];\n+    let next_id = next_sandbox.id;\n+    let next_id_str = next_id.to_string();\n \n-    let next_selected_id = app.sidebar.sandboxes[next_index].id.to_string();\n-    let _ = app.select_sandbox(&next_selected_id);\n-    app.sidebar.select_by_id(&next_selected_id);\n+    app.sidebar.select_by_id(next_id);\n+    let _ = app.select_sandbox(&next_id_str);\n \n     Some((sandbox_id, sandbox_name))\n }\n@@ -1243,7 +1275,10 @@ async fn create_sandbox_with_workspace(\n         }\n     }\n \n-    let _ = event_tx.send(MuxEvent::SandboxCreated(summary.clone()));\n+    let _ = event_tx.send(MuxEvent::SandboxCreated {\n+        sandbox: summary.clone(),\n+        tab_id: Some(tab_id.clone()),\n+    });\n     let _ = event_tx.send(MuxEvent::StatusMessage {\n         message: format!(\"Created sandbox: {}\", sandbox_id),\n     });\ndiff --git a/packages/sandbox/src/mux/sidebar.rs b/packages/sandbox/src/mux/sidebar.rs\nindex 4beda1402..6e81901df 100644\n--- a/packages/sandbox/src/mux/sidebar.rs\n+++ b/packages/sandbox/src/mux/sidebar.rs\n@@ -1,10 +1,17 @@\n use crate::models::{SandboxStatus, SandboxSummary};\n+use uuid::Uuid;\n \n /// State for the sidebar showing sandbox list.\n+///\n+/// ARCHITECTURE: Selection is tracked by ID, not index.\n+/// This means when the server sends a new sandbox list, the selection\n+/// automatically \"follows\" the selected sandbox even if its position changes.\n #[derive(Debug)]\n pub struct Sidebar {\n+    /// Server-authoritative list of sandboxes (plus local placeholders)\n     pub sandboxes: Vec<SandboxSummary>,\n-    pub selected_index: usize,\n+    /// ID of the currently selected sandbox (None = nothing selected)\n+    pub selected_id: Option<Uuid>,\n     pub scroll_offset: usize,\n     pub is_loading: bool,\n     pub last_error: Option<String>,\n@@ -22,7 +29,7 @@ impl Sidebar {\n     pub fn new() -> Self {\n         Self {\n             sandboxes: Vec::new(),\n-            selected_index: 0,\n+            selected_id: None,\n             scroll_offset: 0,\n             is_loading: false,\n             last_error: None,\n@@ -31,15 +38,30 @@ impl Sidebar {\n         }\n     }\n \n-    /// Set the list of sandboxes.\n+    /// Get the visual index of the selected sandbox (for rendering).\n+    /// Returns 0 if nothing selected or selection not found.\n+    pub fn selected_index(&self) -> usize {\n+        self.selected_id\n+            .and_then(|id| self.sandboxes.iter().position(|s| s.id == id))\n+            .unwrap_or(0)\n+    }\n+\n+    /// Set the list of sandboxes from server.\n+    /// Selection is preserved by ID - if the selected sandbox is still in the list,\n+    /// it stays selected regardless of position changes.\n     pub fn set_sandboxes(&mut self, sandboxes: Vec<SandboxSummary>) {\n         self.sandboxes = sandboxes;\n         self.is_loading = false;\n         self.last_error = None;\n \n-        // Ensure selection is still valid\n-        if !self.sandboxes.is_empty() && self.selected_index >= self.sandboxes.len() {\n-            self.selected_index = self.sandboxes.len() - 1;\n+        // If selection no longer exists in list, clear it or select first\n+        if let Some(id) = self.selected_id {\n+            if !self.sandboxes.iter().any(|s| s.id == id) {\n+                self.selected_id = self.sandboxes.first().map(|s| s.id);\n+            }\n+        } else if !self.sandboxes.is_empty() {\n+            // Nothing was selected, select first\n+            self.selected_id = self.sandboxes.first().map(|s| s.id);\n         }\n     }\n \n@@ -51,27 +73,34 @@ impl Sidebar {\n \n     /// Get the currently selected sandbox.\n     pub fn selected_sandbox(&self) -> Option<&SandboxSummary> {\n-        self.sandboxes.get(self.selected_index)\n+        self.selected_id\n+            .and_then(|id| self.sandboxes.iter().find(|s| s.id == id))\n     }\n \n     /// Select the next sandbox in the list.\n     pub fn select_next(&mut self) {\n-        if !self.sandboxes.is_empty() {\n-            self.selected_index = (self.selected_index + 1) % self.sandboxes.len();\n-            self.ensure_visible();\n+        if self.sandboxes.is_empty() {\n+            return;\n         }\n+        let current_idx = self.selected_index();\n+        let next_idx = (current_idx + 1) % self.sandboxes.len();\n+        self.selected_id = self.sandboxes.get(next_idx).map(|s| s.id);\n+        self.ensure_visible();\n     }\n \n     /// Select the previous sandbox in the list.\n     pub fn select_previous(&mut self) {\n-        if !self.sandboxes.is_empty() {\n-            self.selected_index = if self.selected_index == 0 {\n-                self.sandboxes.len() - 1\n-            } else {\n-                self.selected_index - 1\n-            };\n-            self.ensure_visible();\n+        if self.sandboxes.is_empty() {\n+            return;\n         }\n+        let current_idx = self.selected_index();\n+        let prev_idx = if current_idx == 0 {\n+            self.sandboxes.len() - 1\n+        } else {\n+            current_idx - 1\n+        };\n+        self.selected_id = self.sandboxes.get(prev_idx).map(|s| s.id);\n+        self.ensure_visible();\n     }\n \n     /// Ensure the selected item is visible.\n@@ -84,21 +113,26 @@ impl Sidebar {\n         self.visible = !self.visible;\n     }\n \n-    /// Select a sandbox by its ID string.\n-    pub fn select_by_id(&mut self, id_str: &str) {\n-        if let Some(idx) = self\n-            .sandboxes\n-            .iter()\n-            .position(|s| s.id.to_string() == id_str)\n-        {\n-            self.selected_index = idx;\n+    /// Select a sandbox by its ID.\n+    pub fn select_by_id(&mut self, id: Uuid) {\n+        // Only select if the sandbox exists in the list\n+        if self.sandboxes.iter().any(|s| s.id == id) {\n+            self.selected_id = Some(id);\n             self.ensure_visible();\n         }\n     }\n \n+    /// Select a sandbox by its ID string (convenience method).\n+    pub fn select_by_id_str(&mut self, id_str: &str) {\n+        if let Ok(id) = Uuid::parse_str(id_str) {\n+            self.select_by_id(id);\n+        }\n+    }\n+\n     /// Get status icon for a sandbox.\n     pub fn status_icon(status: &SandboxStatus) -> &'static str {\n         match status {\n+            SandboxStatus::Creating => \"◌\",\n             SandboxStatus::Running => \"●\",\n             SandboxStatus::Exited => \"○\",\n             SandboxStatus::Failed => \"✗\",\n@@ -109,6 +143,7 @@ impl Sidebar {\n     /// Get status color for a sandbox.\n     pub fn status_color(status: &SandboxStatus) -> ratatui::style::Color {\n         match status {\n+            SandboxStatus::Creating => ratatui::style::Color::Cyan,\n             SandboxStatus::Running => ratatui::style::Color::Green,\n             SandboxStatus::Exited => ratatui::style::Color::DarkGray,\n             SandboxStatus::Failed => ratatui::style::Color::Red,\n@@ -116,6 +151,11 @@ impl Sidebar {\n         }\n     }\n \n+    /// Check if this sandbox is a placeholder (creation in progress).\n+    pub fn is_placeholder(sandbox: &SandboxSummary) -> bool {\n+        sandbox.status == SandboxStatus::Creating\n+    }\n+\n     /// Format the sandbox name for display, truncating if needed.\n     pub fn format_name(sandbox: &SandboxSummary, max_width: usize) -> String {\n         let name = &sandbox.name;\n@@ -138,7 +178,6 @@ impl Sidebar {\n mod tests {\n     use super::*;\n     use chrono::Utc;\n-    use uuid::Uuid;\n \n     fn create_test_sandbox(name: &str, status: SandboxStatus) -> SandboxSummary {\n         SandboxSummary {\n@@ -155,32 +194,63 @@ mod tests {\n                 sandbox_ip: \"10.0.0.2\".to_string(),\n                 cidr: 24,\n             },\n+            correlation_id: None,\n         }\n     }\n \n     #[test]\n     fn sidebar_selection_works() {\n         let mut sidebar = Sidebar::new();\n-        sidebar.set_sandboxes(vec![\n+        let sandboxes = vec![\n             create_test_sandbox(\"sandbox1\", SandboxStatus::Running),\n             create_test_sandbox(\"sandbox2\", SandboxStatus::Running),\n             create_test_sandbox(\"sandbox3\", SandboxStatus::Running),\n-        ]);\n+        ];\n+        let id0 = sandboxes[0].id;\n+        let id2 = sandboxes[2].id;\n+        sidebar.set_sandboxes(sandboxes);\n+\n+        assert_eq!(sidebar.selected_index(), 0);\n+        assert_eq!(sidebar.selected_id, Some(id0));\n \n-        assert_eq!(sidebar.selected_index, 0);\n         sidebar.select_next();\n-        assert_eq!(sidebar.selected_index, 1);\n+        assert_eq!(sidebar.selected_index(), 1);\n+\n         sidebar.select_next();\n-        assert_eq!(sidebar.selected_index, 2);\n+        assert_eq!(sidebar.selected_index(), 2);\n+        assert_eq!(sidebar.selected_id, Some(id2));\n+\n         sidebar.select_next();\n-        assert_eq!(sidebar.selected_index, 0); // Wrap around\n+        assert_eq!(sidebar.selected_index(), 0); // Wrap around\n+        assert_eq!(sidebar.selected_id, Some(id0));\n \n         sidebar.select_previous();\n-        assert_eq!(sidebar.selected_index, 2); // Wrap around backwards\n+        assert_eq!(sidebar.selected_index(), 2); // Wrap around backwards\n+    }\n+\n+    #[test]\n+    fn selection_preserved_on_reorder() {\n+        let mut sidebar = Sidebar::new();\n+        let s1 = create_test_sandbox(\"sandbox1\", SandboxStatus::Running);\n+        let s2 = create_test_sandbox(\"sandbox2\", SandboxStatus::Running);\n+        let s3 = create_test_sandbox(\"sandbox3\", SandboxStatus::Running);\n+        let id2 = s2.id;\n+\n+        sidebar.set_sandboxes(vec![s1.clone(), s2.clone(), s3.clone()]);\n+        sidebar.select_by_id(id2);\n+        assert_eq!(sidebar.selected_index(), 1);\n+\n+        // Server sends list in different order\n+        sidebar.set_sandboxes(vec![s3.clone(), s2.clone(), s1.clone()]);\n+\n+        // Selection should follow the ID, not the index\n+        assert_eq!(sidebar.selected_id, Some(id2));\n+        assert_eq!(sidebar.selected_index(), 1); // s2 is now at index 1\n     }\n \n     #[test]\n     fn status_icons_are_correct() {\n+        assert_eq!(Sidebar::status_icon(&SandboxStatus::Creating), \"◌\");\n         assert_eq!(Sidebar::status_icon(&SandboxStatus::Running), \"●\");\n         assert_eq!(Sidebar::status_icon(&SandboxStatus::Exited), \"○\");\n         assert_eq!(Sidebar::status_icon(&SandboxStatus::Failed), \"✗\");\ndiff --git a/packages/sandbox/src/mux/state.rs b/packages/sandbox/src/mux/state.rs\nindex 0f0f9a3c3..975e25640 100644\n--- a/packages/sandbox/src/mux/state.rs\n+++ b/packages/sandbox/src/mux/state.rs\n@@ -1,4 +1,4 @@\n-use std::collections::{HashSet, VecDeque};\n+use std::collections::HashSet;\n use std::path::PathBuf;\n \n use chrono::{DateTime, Utc};\n@@ -165,8 +165,6 @@ pub struct MuxApp<'a> {\n     pub show_help: bool,\n     // Notifications overlay/state\n     pub notifications: NotificationsState,\n-    // Pending tab IDs for sandboxes being created (kept in request order)\n-    pub pending_creation_tab_ids: VecDeque<crate::mux::layout::TabId>,\n \n     // Event channel\n     pub event_tx: mpsc::UnboundedSender<MuxEvent>,\n@@ -187,11 +185,8 @@ pub struct MuxApp<'a> {\n     // Terminal manager for handling sandbox connections\n     pub terminal_manager: Option<SharedTerminalManager>,\n \n-    // Sandbox we need to connect to once available\n-    pub pending_connect: Option<String>,\n-\n-    // Locally created placeholder sandboxes awaiting server confirmation\n-    pub pending_placeholder_sandboxes: VecDeque<SandboxId>,\n+    // Queue of sandboxes that need terminal connections\n+    pub pending_connects: std::collections::VecDeque<String>,\n \n     // Flag to indicate we need to create a sandbox on startup\n     pub needs_initial_sandbox: bool,\n@@ -211,6 +206,13 @@ pub struct MuxApp<'a> {\n \n     /// Sandboxes that have delta pager enabled\n     pub delta_enabled_sandboxes: HashSet<SandboxId>,\n+\n+    /// Tab IDs of all pending sandbox creations - ALL will get terminal connections.\n+    pub pending_creation_tab_ids: HashSet<String>,\n+\n+    /// The tab_id of the most recently initiated sandbox creation.\n+    /// Only this sandbox will steal focus/selection when it completes.\n+    pub most_recent_creation_tab_id: Option<String>,\n }\n \n impl<'a> MuxApp<'a> {\n@@ -227,7 +229,6 @@ impl<'a> MuxApp<'a> {\n             zoomed_pane: None,\n             show_help: false,\n             notifications: NotificationsState::new(),\n-            pending_creation_tab_ids: VecDeque::new(),\n             event_tx,\n             base_url,\n             workspace_path,\n@@ -235,14 +236,15 @@ impl<'a> MuxApp<'a> {\n             renaming_tab: false,\n             rename_input: None,\n             terminal_manager: None,\n-            pending_connect: None,\n-            pending_placeholder_sandboxes: VecDeque::new(),\n+            pending_connects: std::collections::VecDeque::new(),\n             needs_initial_sandbox: false,\n             last_terminal_views: std::collections::HashMap::new(),\n             cursor_blink: true,\n             cursor_color: None,\n             onboard: None,\n             delta_enabled_sandboxes: HashSet::new(),\n+            pending_creation_tab_ids: HashSet::new(),\n+            most_recent_creation_tab_id: None,\n         }\n     }\n \n@@ -367,7 +369,7 @@ impl<'a> MuxApp<'a> {\n                 let sandbox_id = SandboxId::from_uuid(uuid);\n                 if self.workspace_manager.has_sandbox(sandbox_id) {\n                     self.workspace_manager.select_sandbox(sandbox_id);\n-                    self.sidebar.select_by_id(sandbox_id_str);\n+                    self.sidebar.select_by_id(uuid);\n                     sandbox_selected = true;\n                 }\n             }\n@@ -383,7 +385,7 @@ impl<'a> MuxApp<'a> {\n                         .select_tab_in_workspace_for_active(tab_id);\n                 } else if self.workspace_manager.select_tab_in_any_workspace(tab_id) {\n                     if let Some(active_id) = self.workspace_manager.active_sandbox_id {\n-                        self.sidebar.select_by_id(&active_id.to_string());\n+                        self.sidebar.select_by_id(active_id.0);\n                     }\n                     sandbox_selected = true;\n                     tab_selected = true;\n@@ -580,8 +582,7 @@ impl<'a> MuxApp<'a> {\n             MuxCommand::NextSandbox => {\n                 if let Some(sandbox_id) = self.workspace_manager.next_sandbox() {\n                     // Also update sidebar selection to match\n-                    let sandbox_id_str = sandbox_id.to_string();\n-                    self.sidebar.select_by_id(&sandbox_id_str);\n+                    self.sidebar.select_by_id(sandbox_id.0);\n                     if let Some(ws) = self.workspace_manager.active_workspace() {\n                         self.set_status(format!(\"Switched to: {}\", ws.name));\n                     }\n@@ -590,8 +591,7 @@ impl<'a> MuxApp<'a> {\n             MuxCommand::PrevSandbox => {\n                 if let Some(sandbox_id) = self.workspace_manager.prev_sandbox() {\n                     // Also update sidebar selection to match\n-                    let sandbox_id_str = sandbox_id.to_string();\n-                    self.sidebar.select_by_id(&sandbox_id_str);\n+                    self.sidebar.select_by_id(sandbox_id.0);\n                     if let Some(ws) = self.workspace_manager.active_workspace() {\n                         self.set_status(format!(\"Switched to: {}\", ws.name));\n                     }\n@@ -601,12 +601,15 @@ impl<'a> MuxApp<'a> {\n             // Sandbox management\n             MuxCommand::NewSandbox => {\n                 self.set_status(\"Creating new sandbox...\");\n-                let tab_id = self.workspace_manager.active_tab_id().unwrap_or_default();\n+                // Generate a UNIQUE correlation ID for each creation request\n+                // Using active_tab_id() was wrong because it's the SAME for all rapid Alt+N presses\n+                // which caused HashMap overwrites and broken placeholder correlation\n+                let correlation_id = crate::mux::layout::TabId::new();\n                 let _ = self.event_tx.send(MuxEvent::CreateSandboxWithWorkspace {\n                     workspace_path: self.workspace_path.clone(),\n-                    tab_id: Some(tab_id.to_string()),\n+                    tab_id: Some(correlation_id.to_string()),\n                 });\n-                self.add_placeholder_sandbox(\"Creating sandbox\", Some(tab_id));\n+                self.add_placeholder_sandbox(\"Creating sandbox\", Some(correlation_id));\n             }\n             MuxCommand::DeleteSandbox => {\n                 if let Some(sandbox) = self.sidebar.selected_sandbox() {\n@@ -753,39 +756,80 @@ impl<'a> MuxApp<'a> {\n             }\n             MuxEvent::SandboxesRefreshed(sandboxes) => {\n                 let had_active = self.selected_sandbox_id().is_some();\n-                // Update sidebar\n-                self.sidebar.set_sandboxes(sandboxes.clone());\n-                // Sync workspace manager with sandboxes\n-                for sandbox in &sandboxes {\n-                    let sandbox_id_str = sandbox.id.to_string();\n-                    self.add_sandbox(&sandbox_id_str, &sandbox.name);\n-                }\n-                // Re-append pending placeholders so they stay visible during creation\n-                for placeholder_id in self.pending_placeholder_sandboxes.iter().copied() {\n-                    if self\n+\n+                // SIMPLIFIED: Server is source of truth for sandbox list.\n+                // Just merge server sandboxes with local placeholders.\n+                // Selection is preserved by ID (not index) - handled automatically by Sidebar.\n+                use std::collections::HashSet;\n+\n+                // Build new list: server sandboxes first (server order), then local placeholders\n+                let server_ids: HashSet<_> = sandboxes.iter().map(|s| s.id).collect();\n+\n+                // Build a map from correlation_id -> server sandbox UUID for selection transfer\n+                let server_by_correlation: std::collections::HashMap<_, _> = sandboxes\n+                    .iter()\n+                    .filter_map(|s| s.correlation_id.as_ref().map(|cid| (cid.clone(), s.id)))\n+                    .collect();\n+\n+                // If currently selected sandbox is a placeholder being replaced by server,\n+                // transfer selection to the server sandbox\n+                if let Some(selected_id) = self.sidebar.selected_id {\n+                    if let Some(selected_placeholder) = self\n                         .sidebar\n                         .sandboxes\n                         .iter()\n-                        .any(|sandbox| sandbox.id == placeholder_id.0)\n+                        .find(|s| s.id == selected_id && s.status == SandboxStatus::Creating)\n                     {\n-                        continue;\n-                    }\n-                    if let Some(summary) = self.placeholder_summary(placeholder_id) {\n-                        self.sidebar.sandboxes.push(summary);\n+                        if let Some(cid) = &selected_placeholder.correlation_id {\n+                            if let Some(&server_sandbox_id) = server_by_correlation.get(cid) {\n+                                // Transfer selection to the server sandbox that replaced the placeholder\n+                                self.sidebar.selected_id = Some(server_sandbox_id);\n+                            }\n+                        }\n                     }\n                 }\n-                // Ensure selection stays in sync with available sandboxes\n-                if let Some(active_id) = self.selected_sandbox_id_string() {\n-                    self.sidebar.select_by_id(&active_id);\n-                } else if let Some(first) = sandboxes.first() {\n-                    let id_str = first.id.to_string();\n-                    self.sidebar.select_by_id(&id_str);\n-                    self.pending_connect.get_or_insert(id_str);\n+\n+                // Collect correlation_ids from server sandboxes - if server has a sandbox\n+                // with a matching correlation_id, that placeholder has been \"resolved\"\n+                let server_correlation_ids: HashSet<_> =\n+                    server_by_correlation.keys().cloned().collect();\n+\n+                // Keep local placeholders (Creating status) only if:\n+                // 1. Their ID isn't in server list (always true for client-generated IDs)\n+                // 2. Their correlation_id isn't in server list (meaning server hasn't created it yet)\n+                let local_placeholders: Vec<_> = self\n+                    .sidebar\n+                    .sandboxes\n+                    .iter()\n+                    .filter(|s| {\n+                        s.status == SandboxStatus::Creating\n+                            && !server_ids.contains(&s.id)\n+                            && s.correlation_id\n+                                .as_ref()\n+                                .map(|cid| !server_correlation_ids.contains(cid))\n+                                .unwrap_or(false) // No correlation_id = can't match, drop it\n+                    })\n+                    .cloned()\n+                    .collect();\n+\n+                // Server sandboxes + pending placeholders\n+                let mut new_list = sandboxes.clone();\n+                new_list.extend(local_placeholders);\n+\n+                // set_sandboxes preserves selection by ID automatically\n+                self.sidebar.set_sandboxes(new_list);\n+\n+                // Sync workspace manager with server sandboxes\n+                for sandbox in &sandboxes {\n+                    let sandbox_id_str = sandbox.id.to_string();\n+                    self.add_sandbox(&sandbox_id_str, &sandbox.name);\n                 }\n \n-                if !had_active {\n-                    if let Some(active_id) = self.selected_sandbox_id_string() {\n-                        self.pending_connect.get_or_insert(active_id);\n+                // Only add to pending_connects on first load (when we had no active sandbox)\n+                if !had_active && self.pending_connects.is_empty() {\n+                    if let Some(first) = self.sidebar.sandboxes.first() {\n+                        let first_id = first.id.to_string();\n+                        self.pending_connects.push_back(first_id);\n                     }\n                 }\n             }\n@@ -793,29 +837,96 @@ impl<'a> MuxApp<'a> {\n                 self.sidebar.set_error(error.clone());\n                 self.set_status(format!(\"Error: {}\", error));\n             }\n-            MuxEvent::SandboxCreated(sandbox) => {\n-                // Drop one placeholder entry to keep the list responsive\n-                if let Some(placeholder_id) = self.pending_placeholder_sandboxes.pop_front() {\n-                    self.remove_local_sandbox(placeholder_id);\n-                }\n-                // Add the new sandbox to workspace manager\n+            MuxEvent::SandboxCreated { sandbox, tab_id } => {\n                 let sandbox_id_str = sandbox.id.to_string();\n-                // Keep sidebar in sync immediately without waiting for refresh\n-                self.sidebar\n-                    .sandboxes\n-                    .retain(|existing| existing.id != sandbox.id);\n-                self.sidebar.sandboxes.push(sandbox.clone());\n-                self.sidebar.select_by_id(&sandbox_id_str);\n-                self.add_sandbox(&sandbox_id_str, &sandbox.name);\n-                if let Some(tab_id) = self.pending_creation_tab_ids.pop_front() {\n-                    let _ = self.workspace_manager.set_active_tab_id_for_sandbox(\n-                        crate::mux::layout::SandboxId::from_uuid(sandbox.id),\n-                        tab_id,\n-                    );\n+\n+                // Find placeholder by correlation_id directly in the sandbox list\n+                // This is the single source of truth - no separate HashMap\n+                let mut updated_in_place = false;\n+\n+                if let Some(tab_id_str) = &tab_id {\n+                    // Find placeholder with matching correlation_id\n+                    let placeholder_pos = self.sidebar.sandboxes.iter().position(|s| {\n+                        s.status == SandboxStatus::Creating\n+                            && s.correlation_id.as_ref() == Some(tab_id_str)\n+                    });\n+\n+                    if let Some(pos) = placeholder_pos {\n+                        let placeholder_uuid = self.sidebar.sandboxes[pos].id;\n+                        let was_selected = self.sidebar.selected_id == Some(placeholder_uuid);\n+\n+                        // Update the placeholder entry in-place\n+                        let entry = &mut self.sidebar.sandboxes[pos];\n+                        let old_id = entry.id;\n+                        entry.id = sandbox.id;\n+                        entry.index = sandbox.index;\n+                        entry.name = sandbox.name.clone();\n+                        entry.created_at = sandbox.created_at;\n+                        entry.workspace = sandbox.workspace.clone();\n+                        entry.status = sandbox.status.clone();\n+                        entry.network = sandbox.network.clone();\n+                        entry.correlation_id = None; // Clear correlation after matching\n+                        updated_in_place = true;\n+\n+                        // Update selection to follow the new ID\n+                        if was_selected {\n+                            self.sidebar.selected_id = Some(sandbox.id);\n+                        }\n+\n+                        // Update workspace_manager\n+                        self.workspace_manager\n+                            .remove_sandbox(SandboxId::from_uuid(old_id));\n+                        self.add_sandbox(&sandbox_id_str, &sandbox.name);\n+                        if was_selected {\n+                            self.workspace_manager\n+                                .select_sandbox(SandboxId::from_uuid(sandbox.id));\n+                        }\n+                    }\n                 }\n-                self.workspace_manager\n-                    .select_sandbox(crate::mux::layout::SandboxId::from_uuid(sandbox.id));\n-                self.pending_connect = Some(sandbox_id_str.clone());\n+\n+                // If no placeholder found, just add the sandbox\n+                if !updated_in_place {\n+                    // Remove duplicate if exists\n+                    self.sidebar\n+                        .sandboxes\n+                        .retain(|existing| existing.id != sandbox.id);\n+                    self.sidebar.sandboxes.push(sandbox.clone());\n+                    self.add_sandbox(&sandbox_id_str, &sandbox.name);\n+                }\n+\n+                // Map tab_id to sandbox in workspace manager\n+                if let Some(tab_id_str) = &tab_id {\n+                    if let Ok(tab_uuid) = Uuid::parse_str(tab_id_str) {\n+                        let tab_id = crate::mux::layout::TabId::from_uuid(tab_uuid);\n+                        let _ = self.workspace_manager.set_active_tab_id_for_sandbox(\n+                            crate::mux::layout::SandboxId::from_uuid(sandbox.id),\n+                            tab_id,\n+                        );\n+                    }\n+                }\n+\n+                // Check if this sandbox was user-initiated (tab_id in pending_creation_tab_ids)\n+                let is_user_initiated = tab_id\n+                    .as_ref()\n+                    .is_some_and(|id| self.pending_creation_tab_ids.remove(id));\n+\n+                if is_user_initiated {\n+                    // Add to pending_connects queue - ALL user-initiated sandboxes get terminals\n+                    self.pending_connects.push_back(sandbox_id_str.clone());\n+                }\n+\n+                // Only select the MOST RECENT creation (prevents focus jumping)\n+                let is_most_recent = tab_id\n+                    .as_ref()\n+                    .is_some_and(|id| self.most_recent_creation_tab_id.as_ref() == Some(id));\n+                if is_most_recent {\n+                    self.most_recent_creation_tab_id = None;\n+                    // Select the newly created sandbox\n+                    self.sidebar.select_by_id(sandbox.id);\n+                    self.workspace_manager\n+                        .select_sandbox(SandboxId::from_uuid(sandbox.id));\n+                }\n+\n                 self.set_status(format!(\"Created sandbox: {}\", sandbox.name));\n             }\n             MuxEvent::SandboxTabMapped { sandbox_id, tab_id } => {\n@@ -864,8 +975,8 @@ impl<'a> MuxApp<'a> {\n                 self.set_status(message);\n             }\n             MuxEvent::ConnectToSandbox { sandbox_id } => {\n-                // Select the sandbox and update workspace\n-                self.select_sandbox(&sandbox_id);\n+                // DON'T select here - selection was already done SYNC in add_placeholder_sandbox\n+                // The runner handles pending_connect for terminal connection\n                 self.set_status(format!(\"Connecting to sandbox: {}\", sandbox_id));\n             }\n             MuxEvent::ConnectActivePaneToSandbox => {\n@@ -890,6 +1001,8 @@ impl<'a> MuxApp<'a> {\n     }\n \n     /// Add a local placeholder sandbox for immediate UI feedback while creation runs.\n+    /// The tab_id is stored as correlation_id on the sandbox itself to match placeholders\n+    /// with created sandboxes even when sandbox creation completes out-of-order.\n     pub fn add_placeholder_sandbox(\n         &mut self,\n         name: impl Into<String>,\n@@ -897,13 +1010,15 @@ impl<'a> MuxApp<'a> {\n     ) {\n         let sandbox_id = SandboxId::new();\n         let name = name.into();\n+        let tab_id_str = tab_id.map(|t| t.to_string());\n+\n         let summary = SandboxSummary {\n             id: sandbox_id.0,\n             index: self.sidebar.sandboxes.len(),\n             name: name.clone(),\n             created_at: Utc::now(),\n             workspace: \"/workspace\".to_string(),\n-            status: SandboxStatus::Unknown,\n+            status: SandboxStatus::Creating, // Creating status = placeholder\n             network: SandboxNetwork {\n                 host_interface: \"pending\".to_string(),\n                 sandbox_interface: \"pending\".to_string(),\n@@ -911,26 +1026,34 @@ impl<'a> MuxApp<'a> {\n                 sandbox_ip: \"0.0.0.0\".to_string(),\n                 cidr: 24,\n             },\n+            correlation_id: tab_id_str.clone(), // Stored on sandbox itself - single source of truth\n         };\n \n         self.sidebar.sandboxes.push(summary);\n-        let id_str = sandbox_id.to_string();\n-        self.sidebar.select_by_id(&id_str);\n         self.workspace_manager.add_sandbox(sandbox_id, name.clone());\n+\n+        // IMMEDIATELY select the new placeholder - this is SYNC feedback for user's key press\n+        // With ID-based selection, just set the selected_id directly\n+        self.sidebar.select_by_id(sandbox_id.0);\n+        self.workspace_manager.select_sandbox(sandbox_id);\n+\n         if let Some(tab_id) = tab_id {\n             let _ = self\n                 .workspace_manager\n                 .set_active_tab_id_for_sandbox(sandbox_id, tab_id);\n         }\n-        self.workspace_manager.select_sandbox(sandbox_id);\n-        self.pending_placeholder_sandboxes.push_back(sandbox_id);\n-    }\n \n-    fn remove_local_sandbox(&mut self, sandbox_id: SandboxId) {\n-        self.remove_sandbox_by_id_string(&sandbox_id.to_string());\n+        // Track ALL pending creations for terminal connections + the most recent for selection\n+        if let Some(ref tid) = tab_id_str {\n+            self.pending_creation_tab_ids.insert(tid.clone());\n+            self.most_recent_creation_tab_id = Some(tid.clone());\n+        }\n     }\n-\n     fn remove_sandbox_by_id_string(&mut self, id: &str) {\n+        let removed_uuid = Uuid::parse_str(id).ok();\n+        let was_selected = removed_uuid == self.sidebar.selected_id;\n+\n+        // Find the index of the removed sandbox (for selecting neighbor if needed)\n         let removed_index = self\n             .sidebar\n             .sandboxes\n@@ -945,52 +1068,28 @@ impl<'a> MuxApp<'a> {\n             .sandboxes\n             .retain(|sandbox| sandbox.id.to_string() != id);\n \n-        if let Some(pending) = &self.pending_connect {\n-            if pending == id {\n-                self.pending_connect = None;\n-            }\n-        }\n+        // Remove deleted sandbox from pending_connects queue\n+        self.pending_connects.retain(|pending| pending != id);\n \n         if self.sidebar.sandboxes.is_empty() {\n-            self.sidebar.selected_index = 0;\n+            // List is now empty - clear selection\n+            self.sidebar.selected_id = None;\n             self.workspace_manager.active_sandbox_id = None;\n-        } else if let Some(idx) = removed_index {\n-            let next_index = if idx < self.sidebar.sandboxes.len() {\n-                idx\n-            } else {\n-                self.sidebar.sandboxes.len() - 1\n-            };\n-\n-            self.sidebar.selected_index = next_index;\n-\n-            let next_id = self.sidebar.sandboxes[next_index].id.to_string();\n-            let _ = self.select_sandbox(&next_id);\n-            self.sidebar.select_by_id(&next_id);\n+        } else if was_selected {\n+            // We removed the currently selected item - select a neighbor\n+            if let Some(removed_idx) = removed_index {\n+                let next_index = if removed_idx < self.sidebar.sandboxes.len() {\n+                    removed_idx\n+                } else {\n+                    self.sidebar.sandboxes.len() - 1\n+                };\n+                let next_sandbox = &self.sidebar.sandboxes[next_index];\n+                let next_id = next_sandbox.id;\n+                self.sidebar.select_by_id(next_id);\n+                let _ = self.select_sandbox(&next_id.to_string());\n+            }\n         }\n-    }\n-\n-    fn placeholder_summary(&self, sandbox_id: SandboxId) -> Option<SandboxSummary> {\n-        let name = self\n-            .workspace_manager\n-            .get_workspace(sandbox_id)\n-            .map(|ws| ws.name.clone())\n-            .unwrap_or_else(|| \"Creating sandbox\".to_string());\n-\n-        Some(SandboxSummary {\n-            id: sandbox_id.0,\n-            index: self.sidebar.sandboxes.len(),\n-            name,\n-            created_at: Utc::now(),\n-            workspace: \"/workspace\".to_string(),\n-            status: SandboxStatus::Unknown,\n-            network: SandboxNetwork {\n-                host_interface: \"pending\".to_string(),\n-                sandbox_interface: \"pending\".to_string(),\n-                host_ip: \"0.0.0.0\".to_string(),\n-                sandbox_ip: \"0.0.0.0\".to_string(),\n-                cidr: 24,\n-            },\n-        })\n+        // If we didn't remove the selected item, selection is preserved by ID automatically\n     }\n }\n \n@@ -1006,13 +1105,21 @@ mod tests {\n         let (tx, _rx) = tokio::sync::mpsc::unbounded_channel();\n         let mut app = MuxApp::new(\"http://localhost\".to_string(), tx, PathBuf::from(\".\"));\n         let sandbox = sample_sandbox(\"demo\");\n+        let tab_id = Uuid::new_v4().to_string();\n \n-        app.handle_event(MuxEvent::SandboxCreated(sandbox.clone()));\n+        // Simulate user-initiated creation by setting the trackers\n+        app.pending_creation_tab_ids.insert(tab_id.clone());\n+        app.most_recent_creation_tab_id = Some(tab_id.clone());\n+\n+        app.handle_event(MuxEvent::SandboxCreated {\n+            sandbox: sandbox.clone(),\n+            tab_id: Some(tab_id),\n+        });\n \n         assert_eq!(\n-            app.pending_connect,\n-            Some(sandbox.id.to_string()),\n-            \"pending_connect should point at the new sandbox\"\n+            app.pending_connects.back(),\n+            Some(&sandbox.id.to_string()),\n+            \"pending_connects should contain the new sandbox\"\n         );\n         assert_eq!(\n             app.selected_sandbox_id_string(),\n@@ -1024,6 +1131,30 @@ mod tests {\n         );\n     }\n \n+    #[test]\n+    fn sandbox_created_without_matching_tab_id_does_not_steal_focus() {\n+        let (tx, _rx) = tokio::sync::mpsc::unbounded_channel();\n+        let mut app = MuxApp::new(\"http://localhost\".to_string(), tx, PathBuf::from(\".\"));\n+        let sandbox = sample_sandbox(\"demo\");\n+\n+        // Create with a different tab_id than what was initiated\n+        let initiated_tab_id = Uuid::new_v4().to_string();\n+        app.pending_creation_tab_ids\n+            .insert(initiated_tab_id.clone());\n+        app.most_recent_creation_tab_id = Some(initiated_tab_id);\n+\n+        app.handle_event(MuxEvent::SandboxCreated {\n+            sandbox: sandbox.clone(),\n+            tab_id: Some(Uuid::new_v4().to_string()), // Different tab_id\n+        });\n+\n+        // Should NOT add to pending_connects since this wasn't user-initiated\n+        assert!(\n+            app.pending_connects.is_empty(),\n+            \"pending_connects should be empty for non-matching tab_id\"\n+        );\n+    }\n+\n     #[test]\n     fn refresh_without_selection_queues_connect() {\n         let (tx, _rx) = tokio::sync::mpsc::unbounded_channel();\n@@ -1032,7 +1163,7 @@ mod tests {\n \n         app.handle_event(MuxEvent::SandboxesRefreshed(vec![sandbox.clone()]));\n \n-        assert_eq!(app.pending_connect, Some(sandbox.id.to_string()));\n+        assert_eq!(app.pending_connects.back(), Some(&sandbox.id.to_string()));\n         assert_eq!(\n             app.sidebar.selected_sandbox().map(|s| s.id),\n             Some(sandbox.id)\n@@ -1089,6 +1220,7 @@ mod tests {\n                 sandbox_ip: \"10.0.0.2\".to_string(),\n                 cidr: 24,\n             },\n+            correlation_id: None,\n         }\n     }\n }\ndiff --git a/packages/sandbox/src/mux/terminal.rs b/packages/sandbox/src/mux/terminal.rs\nindex b84cc9000..ba3eb786c 100644\n--- a/packages/sandbox/src/mux/terminal.rs\n+++ b/packages/sandbox/src/mux/terminal.rs\n@@ -3399,8 +3399,16 @@ impl TerminalManager {\n         self.sessions.contains_key(&pane_id)\n     }\n \n-    /// Send input to a terminal session via the multiplexed connection\n-    pub fn send_input(&self, pane_id: PaneId, data: Vec<u8>) -> bool {\n+    /// Send input to a terminal session via the multiplexed connection.\n+    /// Also scrolls to bottom so the user sees where they're typing.\n+    pub fn send_input(&mut self, pane_id: PaneId, data: Vec<u8>) -> bool {\n+        // Auto-scroll to bottom when user types - they want to see the cursor\n+        if let Some(buffer) = self.buffers.get_mut(&pane_id) {\n+            if buffer.scroll_offset() > 0 {\n+                buffer.scroll_to_bottom();\n+            }\n+        }\n+\n         let session = match self.sessions.get(&pane_id) {\n             Some(s) => s,\n             None => return false,\n@@ -3647,7 +3655,11 @@ pub async fn establish_mux_connection(manager: SharedTerminalManager) -> anyhow:\n \n                             match server_msg {\n                                 MuxServerMessage::SandboxCreated(summary) => {\n-                                    let _ = event_tx_clone.send(MuxEvent::SandboxCreated(summary));\n+                                    // No tab_id for server-broadcast events (created by other clients)\n+                                    let _ = event_tx_clone.send(MuxEvent::SandboxCreated {\n+                                        sandbox: summary,\n+                                        tab_id: None,\n+                                    });\n                                 }\n                                 MuxServerMessage::SandboxList { sandboxes } => {\n                                     let _ = event_tx_clone.send(MuxEvent::SandboxesRefreshed(sandboxes));\ndiff --git a/packages/sandbox/src/mux/ui.rs b/packages/sandbox/src/mux/ui.rs\nindex 2c4653e82..f9360cfe9 100644\n--- a/packages/sandbox/src/mux/ui.rs\n+++ b/packages/sandbox/src/mux/ui.rs\n@@ -125,7 +125,7 @@ fn render_sidebar(f: &mut Frame, app: &MuxApp, area: Rect) {\n \n     let mut lines: Vec<Line<'_>> = Vec::new();\n     for (idx, sandbox) in app.sidebar.sandboxes.iter().enumerate() {\n-        let is_selected = idx == app.sidebar.selected_index;\n+        let is_selected = idx == app.sidebar.selected_index();\n \n         let status_icon = Sidebar::status_icon(&sandbox.status);\n         let status_color = Sidebar::status_color(&sandbox.status);\ndiff --git a/packages/sandbox/tests/cli_e2e.rs b/packages/sandbox/tests/cli_e2e.rs\nindex 7ee9838f4..220c9b435 100644\n--- a/packages/sandbox/tests/cli_e2e.rs\n+++ b/packages/sandbox/tests/cli_e2e.rs\n@@ -72,6 +72,7 @@ impl SandboxService for MockService {\n                 sandbox_ip: \"10.201.0.2\".into(),\n                 cidr: 30,\n             },\n+            correlation_id: None,\n         };\n         let mut guard = self.sandboxes.lock().await;\n         guard.push(summary.clone());\n","comments":[{"type":"issue_comment","id":3604986782,"prNumber":1118,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn7f235h4penkpf7gnn6hqemen7wj29r?src=preview.new) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn7f235h4penkpf7gnn6hqemen7wj29r/browser?src=preview.new) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1118?src=preview.new)\n\nCaptured 9 screenshots for commit `a9a9866` (2025-12-03 03:56:20.670 UTC).\n\n**Full page view of the configure environment page with VS Code embedded iframe**\n\n![configure-environment-page-full-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/ad244a30-d4ca-44b2-b970-dea2e2bf476a)\n\n**Configure environment page showing the left sidebar with collapsible script sections**\n\n![configure-environment-page-viewport-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/84285189-30b5-4bcf-9c89-e4758ea17054)\n\n**Configure environment page showing maintenance and dev script sections with numbered step badges**\n\n![configure-scripts-sections-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/5b53b1fc-ed3f-485d-8d7d-356a8a5e4e5a)\n\n**Dev script section expanded showing the development server script configuration**\n\n![dev-script-expanded-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/26ecc1e6-cb76-4c12-b82b-d81456bb5c08)\n\n**Maintenance script section expanded showing the script input field and 'None' checkbox**\n\n![maintenance-script-expanded-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/c419f5e0-a6d9-48c4-98bf-cf01f2d4d327)\n\n**Viewport view showing the new SVG-based radial gradient background on preview page**\n\n![preview-page-background-gradient-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/49bfc81f-3b7d-494d-aea4-da02b0542c7b)\n\n**Preview.new page after reload showing team selection, repository search, and configured repositories section**\n\n![preview-page-full-reloaded-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/23207db8-d0f5-46b0-8bff-89efca9b5575)\n\n**Full preview.new landing page showing the updated background gradient (SVG instead of CSS)**\n\n![preview-page-full-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/34d2de80-c8fc-4c3a-abba-cff461218c2f)\n\n**Header section of preview page with title 'Screenshot previews for GitHub PRs'**\n\n![preview-page-header-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/892cc615-79b3-4bde-8355-187fdbdda5a0)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"e50b6d29732ae49442226ecd29283f0552580807","createdAt":"2025-12-03T03:56:21Z","updatedAt":"2025-12-03T04:25:08Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1118#issuecomment-3604986782"},{"type":"issue_comment","id":3605037226,"prNumber":1118,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn77jhb67bth2dtsw9pwcf86a57wk819?src=preview.new) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn77jhb67bth2dtsw9pwcf86a57wk819/browser?src=preview.new) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1118?src=preview.new)\n\nCaptured 6 screenshots for commit `622a7f5` (2025-12-03 04:25:06.531 UTC).\n\n**Framework Preset dropdown menu expanded showing all available framework options (Next.js, Vite, Remix, Nuxt, SvelteKit, Angular, Create React App, Vue, Other)**\n\n![preview-configure-framework-dropdown-open.png](https://adorable-wombat-701.convex.cloud/api/storage/5f8b90a0-f6f9-4e8a-a0bf-60fe01dafaf2)\n\n**Preview configuration page with new Framework Preset selector dropdown (Next.js selected)**\n\n![preview-configure-page-with-framework-preset.png](https://adorable-wombat-701.convex.cloud/api/storage/fd85f2a4-dc33-4026-892a-0ccb109a7a3e)\n\n**Preview configuration page with Vite framework preset selected, showing how the selection updates**\n\n![preview-configure-vite-selected.png](https://adorable-wombat-701.convex.cloud/api/storage/2af40f82-ac2c-42dd-a448-07843995bed9)\n\n**Preview page final state showing the complete UI with all sections visible**\n\n![preview-page-final-view.png](https://adorable-wombat-701.convex.cloud/api/storage/1e16d3c8-062a-4700-bafd-4eef3f572e18)\n\n**Preview page main view showing updated background gradient (SVG-based radial gradient instead of CSS gradient)**\n\n![preview-page-main-view.png](https://adorable-wombat-701.convex.cloud/api/storage/f7d7c700-4520-4942-b12a-a014aa0649ec)\n\n**Preview page with popup_complete state (shown after OAuth installation completes)**\n\n![preview-popup-complete-view.png](https://adorable-wombat-701.convex.cloud/api/storage/1312a694-7737-41fb-9afa-40af3ef1648b)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"e50b6d29732ae49442226ecd29283f0552580807","createdAt":"2025-12-03T04:25:07Z","updatedAt":"2025-12-03T09:37:42Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1118#issuecomment-3605037226"},{"type":"issue_comment","id":3605927086,"prNumber":1118,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn76j91jt1bxb15f21g0d9aa6s7wk338?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn76j91jt1bxb15f21g0d9aa6s7wk338/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1118?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 8 screenshots for commit `5866b08` (2025-12-03 09:37:40.730 UTC).\n\n**Close-up of the preview page hero heading with updated styling**\n\n![preview-hero-section-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/12aa00f8-0848-4aa6-97fc-0036adb04104)\n\n**Bottom section of preview page showing the 'From the creators of' section with cmux branding**\n\n![preview-page-bottom-section-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/dbb7e21d-f715-4db3-b04b-e15874d5323b)\n\n**Error state showing runtime error dialog \\(authentication issue encountered during testing\\)**\n\n![preview-page-error-state-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/9f059066-d306-43ca-a474-04ab9b86419e)\n\n**Hero section of preview page showing the new SVG radial gradient background effect that replaced the CSS gradient**\n\n![preview-page-hero-with-gradient-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/2d6865c2-1352-41c2-820c-69e54088fc8d)\n\n**Middle section of preview page showing feature descriptions and configured repositories section**\n\n![preview-page-middle-section-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/6b25701b-e224-47e9-819b-86cacb859448)\n\n**Full preview page showing unauthenticated view with new radial gradient background, hero section, repository input, and provider selection buttons**\n\n![preview-page-unauthenticated-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/abcf9137-c943-41d5-885a-30a386b73086)\n\n**Git provider selection buttons \\(GitHub, GitLab, Bitbucket\\) with updated styling**\n\n![preview-provider-selection-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/68f9c959-e2e0-405e-a741-2ff9e6f67101)\n\n**Repository URL input field with updated styling**\n\n![preview-repo-input-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/cb7c663f-1334-4dff-bdec-f59e71b57731)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"e50b6d29732ae49442226ecd29283f0552580807","createdAt":"2025-12-03T09:37:41Z","updatedAt":"2025-12-03T11:13:19Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1118#issuecomment-3605927086"},{"type":"issue_comment","id":3606350693,"prNumber":1118,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn78kkpsf4h3a4e09ayyhqksm17wkemj?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn78kkpsf4h3a4e09ayyhqksm17wkemj/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1118?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 7 screenshots for commit `587530f` (2025-12-03 11:13:17.869 UTC).\n\n**Bottom section of the page showing configured repositories and cmux promotional content**\n\n![bottom-section-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/86ad8a50-fa02-4d20-973f-f72683d6883a)\n\n**Repository selection section with team and account dropdowns**\n\n![choose-repository-section-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/0ffcacda-802e-49e7-a37b-a72d6553255d)\n\n**Section header showing configured repositories list**\n\n![configured-repositories-section-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/e3f099ee-fbfa-4a96-b80e-966cd3ee7856)\n\n**Header section showing 'Screenshot previews for GitHub PRs' title and description**\n\n![header-section-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/1172635b-9b51-4c1d-816d-83871d5d1035)\n\n**Full-page screenshot of the preview dashboard showing the complete layout with updated styling and gradient background**\n\n![preview-page-full-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/2ad1c0ed-e69f-46d7-90a6-6b2494c961b4)\n\n**Viewport screenshot of the preview dashboard showing the main UI elements**\n\n![preview-page-viewport-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/246a5530-ac73-4cda-a906-f0ce96e2a37c)\n\n**Information section explaining preview.new features with updated styling**\n\n![what-is-preview-section-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/2960a5f9-d748-4593-84de-111ca94cac25)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"e50b6d29732ae49442226ecd29283f0552580807","createdAt":"2025-12-03T11:13:18Z","updatedAt":"2025-12-04T02:43:19Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1118#issuecomment-3606350693"},{"type":"issue_comment","id":3606403991,"prNumber":1118,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn79qkn600shcf5rsbgc5a20gd7wj9k8?src=preview.new) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn79qkn600shcf5rsbgc5a20gd7wj9k8/browser?src=preview.new) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1118?src=preview.new)\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\nCaptured 1 screenshot for commit `587530f` (2025-12-03 11:26:28.370 UTC).\n\n**404 error page - the preview configure page requires authentication and query parameters to display properly**\n\n![preview-configure-page-fullpage-working-backlog-fixes.png](https://famous-camel-162.convex.cloud/api/storage/015328d9-8710-4f4c-89c6-2e17e2f0d555)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"e50b6d29732ae49442226ecd29283f0552580807","createdAt":"2025-12-03T11:26:30Z","updatedAt":"2025-12-04T02:43:20Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1118#issuecomment-3606403991"},{"type":"issue_comment","id":3609787292,"prNumber":1118,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn73py54sxrqtxdj2gc2nqdxnn7wnq72?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn73py54sxrqtxdj2gc2nqdxnn7wnq72/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1118?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 5 screenshots for commit `b14e109` (2025-12-04 02:43:17.199 UTC).\n\n**Client dashboard loading screen \\(requires authentication to view full UI\\)**\n\n![client-dashboard-loading.png](https://adorable-wombat-701.convex.cloud/api/storage/143ef839-1b4a-490b-8c95-f485252cf31d)\n\n**Preview dashboard showing the configured repositories section with edit and delete buttons visible**\n\n![preview-dashboard-configured-repos.png](https://adorable-wombat-701.convex.cloud/api/storage/9dfe8574-7f92-477d-bd04-90e67dda9be8)\n\n**Close-up of the AlertDialog delete confirmation dialog showing the improved UI with proper shadcn/ui AlertDialog component styling**\n\n![preview-dashboard-delete-dialog-element.png](https://adorable-wombat-701.convex.cloud/api/storage/273867c5-01ac-4b51-8bd6-aa9475ecfcc6)\n\n**Preview dashboard with the new AlertDialog component displayed when deleting a repository configuration - showing the modal overlay with delete confirmation**\n\n![preview-dashboard-delete-dialog.png](https://adorable-wombat-701.convex.cloud/api/storage/c3f86fb8-f7a7-4531-b047-ab5e70987671)\n\n**Full page view of the preview dashboard showing the main layout with repository selection, configured repositories, and feature descriptions**\n\n![preview-dashboard-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/9141c3b2-856f-4255-853f-454cc1387bde)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"e50b6d29732ae49442226ecd29283f0552580807","createdAt":"2025-12-04T02:43:18Z","updatedAt":"2025-12-04T02:57:05Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1118#issuecomment-3609787292"},{"type":"issue_comment","id":3609815702,"prNumber":1118,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is below)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn79r00rf1y7j9vnw0rn5d3mss7wm6kf?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn79r00rf1y7j9vnw0rn5d3mss7wm6kf/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1118?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\nCaptured 5 screenshots for commit `c8e081b` (2025-12-04 02:57:02.102 UTC).\n\n**Screenshot of the configured repositories section showing the repository cards with action buttons**\n\n![preview-dashboard-configured-repos-section-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/6cb42a9c-90f5-4343-a9cf-1717dab8dee9)\n\n**Close-up screenshot of the AlertDialog element showing the delete confirmation UI with Cancel and Delete buttons**\n\n![preview-dashboard-delete-dialog-element-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/7355c352-520e-499a-acc7-9f7d86845ac1)\n\n**Full-page screenshot showing the new AlertDialog component when deleting a repository configuration**\n\n![preview-dashboard-delete-dialog-fullpage-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/0ef997d1-b1b2-409e-863f-3c98faf29f3a)\n\n**Viewport screenshot of the AlertDialog delete confirmation modal with backdrop overlay**\n\n![preview-dashboard-delete-dialog-viewport-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/7c2a0a9e-f1d1-4575-85fe-eb55f835ba02)\n\n**Full-page screenshot of the preview dashboard showing the initial state with configured repositories**\n\n![preview-dashboard-initial-working-backlog-fixes.png](https://adorable-wombat-701.convex.cloud/api/storage/a83c4115-95fa-4bf1-84f8-4814ada82c55)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_\n\n</details>","commitSha":"e50b6d29732ae49442226ecd29283f0552580807","createdAt":"2025-12-04T02:57:05Z","updatedAt":"2025-12-04T02:58:50Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1118#issuecomment-3609815702"},{"type":"issue_comment","id":3609819592,"prNumber":1118,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7a87bey48p4c1ksm6wcefbhd7wmjaj?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=workspace) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7a87bey48p4c1ksm6wcefbhd7wmjaj/browser?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=dev_browser) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1118?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=diff_heatmap)\n\n\n\nCaptured 5 screenshots for commit `c8e081b` (2025-12-04 02:58:48.504 UTC).\n\n**Main cmux application with sidebar hidden after using Ctrl+Shift+S keyboard shortcut - demonstrates the improved keyboard shortcut handler using capture phase**\n\n![main-app-sidebar-hidden-after-toggle-working-backlog-fixes.png](https://famous-camel-162.convex.cloud/api/storage/3c740a92-f487-4ae4-9dc9-81caba391d7d)\n\n**Main cmux application with sidebar visible showing workspaces, pull requests, and previews**\n\n![main-app-with-sidebar-visible-working-backlog-fixes.png](https://famous-camel-162.convex.cloud/api/storage/5593d830-36b3-4515-8a3e-5750d48609ad)\n\n**Preview dashboard page showing configured repositories with delete buttons before triggering the modal**\n\n![preview-dashboard-before-delete-working-backlog-fixes.png](https://famous-camel-162.convex.cloud/api/storage/9df58c07-44ea-4794-944d-51af1d93b9a7)\n\n**Preview dashboard delete configuration modal - full page view showing the modal using the new AlertDialog component with no backdrop blur for better accessibility**\n\n![preview-dashboard-delete-modal-open-working-backlog-fixes.png](https://famous-camel-162.convex.cloud/api/storage/36ea1ab8-dd6c-4200-93de-eedd243c53b0)\n\n**Preview dashboard delete configuration modal - viewport view showing the new AlertDialog component without backdrop blur**\n\n![preview-dashboard-delete-modal-working-backlog-fixes.png](https://famous-camel-162.convex.cloud/api/storage/dd43c343-4db4-4971-a660-c19e56bbcb45)\n\n---\n\n_Generated by [cmux](https://cmux.sh?utm_source=github&utm_medium=pr_comment&utm_campaign=cmux_bot&utm_content=preview_signature) preview system_","commitSha":"e50b6d29732ae49442226ecd29283f0552580807","createdAt":"2025-12-04T02:58:49Z","updatedAt":"2025-12-04T02:58:49Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1118#issuecomment-3609819592"}]}
{"number":1117,"title":"feat(sandbox): backlog fixes - editors, shortcuts, escape sequences, auto-scroll","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1117","headRef":"stacked-backlog-fixes","headSha":"15ee20bbf13dc5e13f9e685053d59d0195d485fe","baseRef":"main","baseSha":"c455f3a13dfff2343970a6a8e5a95da2cf346d3d","createdAt":"2025-12-03T01:06:20Z","updatedAt":"2025-12-03T01:27:37Z","diff":"diff --git a/packages/sandbox/Dockerfile b/packages/sandbox/Dockerfile\nindex 06447cdd1..433865734 100644\n--- a/packages/sandbox/Dockerfile\n+++ b/packages/sandbox/Dockerfile\n@@ -136,6 +136,8 @@ RUN --mount=type=cache,target=/var/cache/apt,sharing=locked \\\n   zsh-autosuggestions \\\n   zsh-syntax-highlighting \\\n   vim \\\n+  neovim \\\n+  emacs-nox \\\n   tini \\\n   python3 \\\n   python3-venv \\\ndiff --git a/packages/sandbox/docs/escape-sequence-todos.md b/packages/sandbox/docs/escape-sequence-todos.md\nindex 3e2a2f586..18a5625d2 100644\n--- a/packages/sandbox/docs/escape-sequence-todos.md\n+++ b/packages/sandbox/docs/escape-sequence-todos.md\n@@ -45,18 +45,18 @@ See `src/mux/terminal.rs` for the current implementation. Key supported sequence\n   - `OSC 112 ST`\n   - Also implemented OSC 12 (set/query cursor color)\n \n-- [ ] **CSI ? 1004 h/l** - Focus Reporting\n+- [x] **CSI ? 1004 h/l** - Focus Reporting\n   - `CSI ? 1004 h` = enable focus events\n   - `CSI ? 1004 l` = disable focus events\n   - When enabled, send `CSI I` on focus in, `CSI O` on focus out\n   - Used by vim/neovim to detect when terminal gains/loses focus\n \n-- [ ] **OSC 7** - Current Working Directory\n+- [x] **OSC 7** - Current Working Directory\n   - Format: `OSC 7 ; file://hostname/path ST`\n   - Shells emit this after each command\n   - Store in terminal state for UI display / tab titles\n \n-- [ ] **CSI ? 1034 h/l** - Meta Sends Escape\n+- [x] **CSI ? 1034 h/l** - Meta Sends Escape\n   - Controls whether Alt+key sends ESC+key or sets high bit\n   - Most terminals default to ESC prefix mode\n \ndiff --git a/packages/sandbox/src/bubblewrap.rs b/packages/sandbox/src/bubblewrap.rs\nindex 8ad2b7d9f..4971284f8 100644\n--- a/packages/sandbox/src/bubblewrap.rs\n+++ b/packages/sandbox/src/bubblewrap.rs\n@@ -475,10 +475,13 @@ fi\n         fs::create_dir_all(&root_home).await?;\n \n         let gitconfig = root_home.join(\".gitconfig\");\n-        // Only set safe.directory - don't override user's pager preferences\n+        // Set safe.directory and configure pager to always show for diffs\n         // Users can enable delta via command palette (EnableDeltaPager)\n+        // Using 'less -R' without -F ensures pager is used even for small diffs\n         let content = r#\"[safe]\n \tdirectory = *\n+[core]\n+\tpager = less -R\n \"#;\n         fs::write(&gitconfig, content).await?;\n         Ok(())\ndiff --git a/packages/sandbox/src/mux/commands.rs b/packages/sandbox/src/mux/commands.rs\nindex ca4850600..585b151f0 100644\n--- a/packages/sandbox/src/mux/commands.rs\n+++ b/packages/sandbox/src/mux/commands.rs\n@@ -58,6 +58,8 @@ pub enum MuxCommand {\n     NewSandbox,\n     DeleteSandbox,\n     RefreshSandboxes,\n+    OpenSandboxBrowser,\n+    OpenSandboxEditor,\n \n     // Session management\n     NewSession,\n@@ -140,6 +142,8 @@ impl MuxCommand {\n             MuxCommand::NewSandbox,\n             MuxCommand::DeleteSandbox,\n             MuxCommand::RefreshSandboxes,\n+            MuxCommand::OpenSandboxBrowser,\n+            MuxCommand::OpenSandboxEditor,\n             // Session management\n             MuxCommand::NewSession,\n             MuxCommand::AttachSandbox,\n@@ -207,6 +211,8 @@ impl MuxCommand {\n             MuxCommand::NewSandbox => \"New Sandbox\",\n             MuxCommand::DeleteSandbox => \"Delete Sandbox\",\n             MuxCommand::RefreshSandboxes => \"Refresh Sandboxes\",\n+            MuxCommand::OpenSandboxBrowser => \"Open Sandbox Browser\",\n+            MuxCommand::OpenSandboxEditor => \"Open Sandbox Editor\",\n             MuxCommand::NewSession => \"New Session\",\n             MuxCommand::AttachSandbox => \"Attach to Sandbox\",\n             MuxCommand::DetachSandbox => \"Detach from Sandbox\",\n@@ -241,6 +247,8 @@ impl MuxCommand {\n             MuxCommand::NewTab => &[\"create tab\", \"add tab\", \"open tab\"],\n             MuxCommand::NewSandbox => &[\"create sandbox\", \"add sandbox\"],\n             MuxCommand::DeleteSandbox => &[\"remove sandbox\", \"destroy sandbox\", \"kill sandbox\"],\n+            MuxCommand::OpenSandboxBrowser => &[\"web\", \"http\", \"chrome\", \"firefox\", \"safari\"],\n+            MuxCommand::OpenSandboxEditor => &[\"code\", \"vscode\", \"ide\", \"edit files\"],\n             MuxCommand::OpenCommandPalette => &[\"search\", \"find command\", \"quick open\"],\n             MuxCommand::ToggleHelp => {\n                 &[\"shortcuts\", \"keybindings\", \"keyboard shortcuts\", \"hotkeys\"]\n@@ -305,6 +313,8 @@ impl MuxCommand {\n             MuxCommand::NewSandbox => \"Create a new sandbox\",\n             MuxCommand::DeleteSandbox => \"Delete the selected sandbox\",\n             MuxCommand::RefreshSandboxes => \"Refresh the sandbox list\",\n+            MuxCommand::OpenSandboxBrowser => \"Open browser connected to sandbox network\",\n+            MuxCommand::OpenSandboxEditor => \"Open VS Code editor for sandbox files\",\n             MuxCommand::NewSession => \"Create a new sandbox session\",\n             MuxCommand::AttachSandbox => \"Attach to an existing sandbox\",\n             MuxCommand::DetachSandbox => \"Detach from the current sandbox\",\n@@ -370,9 +380,11 @@ impl MuxCommand {\n             | MuxCommand::NextSandbox\n             | MuxCommand::PrevSandbox => \"Sidebar\",\n \n-            MuxCommand::NewSandbox | MuxCommand::DeleteSandbox | MuxCommand::RefreshSandboxes => {\n-                \"Sandbox\"\n-            }\n+            MuxCommand::NewSandbox\n+            | MuxCommand::DeleteSandbox\n+            | MuxCommand::RefreshSandboxes\n+            | MuxCommand::OpenSandboxBrowser\n+            | MuxCommand::OpenSandboxEditor => \"Sandbox\",\n \n             MuxCommand::NewSession | MuxCommand::AttachSandbox | MuxCommand::DetachSandbox => {\n                 \"Session\"\n@@ -489,8 +501,12 @@ impl MuxCommand {\n \n             // Sandbox management - use Alt\n             MuxCommand::NewSandbox => Some((KeyModifiers::ALT, KeyCode::Char('n'))),\n-            MuxCommand::DeleteSandbox => None, // No default keybinding, access via command palette\n+            MuxCommand::DeleteSandbox => {\n+                Some((KeyModifiers::ALT | KeyModifiers::SHIFT, KeyCode::Char('X')))\n+            }\n             MuxCommand::RefreshSandboxes => Some((KeyModifiers::ALT, KeyCode::Char('R'))), // Alt+Shift+R\n+            MuxCommand::OpenSandboxBrowser => Some((KeyModifiers::ALT, KeyCode::Char('b'))),\n+            MuxCommand::OpenSandboxEditor => Some((KeyModifiers::ALT, KeyCode::Char('e'))),\n \n             // Session - use Alt\n             MuxCommand::NewSession => None, // Access via command palette\ndiff --git a/packages/sandbox/src/mux/events.rs b/packages/sandbox/src/mux/events.rs\nindex 828cbb53d..68d060298 100644\n--- a/packages/sandbox/src/mux/events.rs\n+++ b/packages/sandbox/src/mux/events.rs\n@@ -56,4 +56,8 @@ pub enum MuxEvent {\n         sandbox_id: String,\n         command: Vec<String>,\n     },\n+    /// Open browser connected to sandbox network\n+    OpenSandboxBrowser { sandbox_id: String },\n+    /// Open VS Code editor for sandbox files\n+    OpenSandboxEditor { sandbox_id: String },\n }\ndiff --git a/packages/sandbox/src/mux/runner.rs b/packages/sandbox/src/mux/runner.rs\nindex 0b933e6f3..90b3da298 100644\n--- a/packages/sandbox/src/mux/runner.rs\n+++ b/packages/sandbox/src/mux/runner.rs\n@@ -294,7 +294,7 @@ async fn run_app<B: ratatui::backend::Backend + std::io::Write>(\n                         handle_onboard_event(&mut app, onboard_event.clone(), &event_tx_for_handler);\n                     }\n                     MuxEvent::SendTerminalInput { pane_id, input } => {\n-                        if let Ok(manager) = terminal_manager.try_lock() {\n+                        if let Ok(mut manager) = terminal_manager.try_lock() {\n                             if !manager.send_input(*pane_id, input.clone()) {\n                                 tracing::warn!(\"Failed to send terminal input to pane {:?}\", pane_id);\n                             }\n@@ -322,6 +322,43 @@ async fn run_app<B: ratatui::backend::Backend + std::io::Write>(\n                             }\n                         });\n                     }\n+                    MuxEvent::OpenSandboxBrowser { sandbox_id } => {\n+                        // Launch browser in background process\n+                        // Use `cmux browser <id>` to handle proxy setup\n+                        let sandbox_id = sandbox_id.clone();\n+                        let base_url = app.base_url.clone();\n+                        tokio::spawn(async move {\n+                            let result = tokio::process::Command::new(\"cmux\")\n+                                .arg(\"browser\")\n+                                .arg(&sandbox_id)\n+                                .arg(\"--base-url\")\n+                                .arg(&base_url)\n+                                .spawn();\n+                            if let Err(e) = result {\n+                                tracing::warn!(\"Failed to launch browser for sandbox {}: {}\", sandbox_id, e);\n+                            }\n+                        });\n+                    }\n+                    MuxEvent::OpenSandboxEditor { sandbox_id } => {\n+                        // Open VS Code connected to sandbox via Remote SSH or similar\n+                        // For now, try to open vscode:// URI with the sandbox\n+                        let sandbox_id = sandbox_id.clone();\n+                        let base_url = app.base_url.clone();\n+                        tokio::spawn(async move {\n+                            // Try opening VS Code via code command\n+                            let result = tokio::process::Command::new(\"code\")\n+                                .arg(\"--folder-uri\")\n+                                .arg(format!(\"vscode-remote://ssh-remote+root@{}/workspace\", sandbox_id))\n+                                .spawn();\n+                            if let Err(e) = result {\n+                                // Fallback: try opening the browser-based editor\n+                                tracing::warn!(\"VS Code not available, trying web editor: {}\", e);\n+                                let _ = tokio::process::Command::new(\"open\")\n+                                    .arg(format!(\"{}/sandboxes/{}/editor\", base_url.trim_end_matches('/'), sandbox_id))\n+                                    .spawn();\n+                            }\n+                        });\n+                    }\n                     _ => {}\n                 }\n                 app.handle_event(event);\n@@ -795,7 +832,7 @@ fn handle_input(\n                         if let Some(pane_id) = app.active_pane_id() {\n                             let input = key_to_terminal_input(key.modifiers, key.code);\n                             if !input.is_empty() {\n-                                if let Ok(guard) = terminal_manager.try_lock() {\n+                                if let Ok(mut guard) = terminal_manager.try_lock() {\n                                     guard.send_input(pane_id, input);\n                                 }\n                             }\n@@ -940,7 +977,7 @@ fn handle_input(\n                                 }\n                             }\n \n-                            if let Ok(guard) = terminal_manager.try_lock() {\n+                            if let Ok(mut guard) = terminal_manager.try_lock() {\n                                 let (mouse_mode, sgr_mode) = guard\n                                     .get_buffer(pane_id)\n                                     .map(|b| (b.mouse_tracking(), b.sgr_mouse_mode()))\n@@ -992,7 +1029,7 @@ fn handle_input(\n         Event::Paste(text) => {\n             // Forward paste to active terminal\n             if let Some(pane_id) = app.active_pane_id() {\n-                if let Ok(guard) = terminal_manager.try_lock() {\n+                if let Ok(mut guard) = terminal_manager.try_lock() {\n                     guard.send_input(pane_id, text.into_bytes());\n                 }\n             }\ndiff --git a/packages/sandbox/src/mux/state.rs b/packages/sandbox/src/mux/state.rs\nindex 0f0f9a3c3..9d3d5c03e 100644\n--- a/packages/sandbox/src/mux/state.rs\n+++ b/packages/sandbox/src/mux/state.rs\n@@ -618,6 +618,26 @@ impl<'a> MuxApp<'a> {\n             MuxCommand::RefreshSandboxes => {\n                 self.set_status(\"Refreshing sandboxes...\");\n             }\n+            MuxCommand::OpenSandboxBrowser => {\n+                if let Some(sandbox_id) = self.selected_sandbox_id_string() {\n+                    self.set_status(\"Opening browser...\");\n+                    let _ = self.event_tx.send(MuxEvent::OpenSandboxBrowser {\n+                        sandbox_id: sandbox_id.to_string(),\n+                    });\n+                } else {\n+                    self.set_status(\"No sandbox selected\");\n+                }\n+            }\n+            MuxCommand::OpenSandboxEditor => {\n+                if let Some(sandbox_id) = self.selected_sandbox_id_string() {\n+                    self.set_status(\"Opening editor...\");\n+                    let _ = self.event_tx.send(MuxEvent::OpenSandboxEditor {\n+                        sandbox_id: sandbox_id.to_string(),\n+                    });\n+                } else {\n+                    self.set_status(\"No sandbox selected\");\n+                }\n+            }\n \n             // Session\n             MuxCommand::NewSession => {\n@@ -886,6 +906,12 @@ impl<'a> MuxApp<'a> {\n             MuxEvent::ExecInSandbox { .. } => {\n                 // Exec requests are handled in the runner\n             }\n+            MuxEvent::OpenSandboxBrowser { .. } => {\n+                // Browser opening is handled in the runner\n+            }\n+            MuxEvent::OpenSandboxEditor { .. } => {\n+                // Editor opening is handled in the runner\n+            }\n         }\n     }\n \ndiff --git a/packages/sandbox/src/mux/terminal.rs b/packages/sandbox/src/mux/terminal.rs\nindex b84cc9000..9ecbf4365 100644\n--- a/packages/sandbox/src/mux/terminal.rs\n+++ b/packages/sandbox/src/mux/terminal.rs\n@@ -150,6 +150,36 @@ fn linear_rgb_to_u8_x11(r: f64, g: f64, b: f64) -> (u8, u8, u8) {\n     )\n }\n \n+/// URL-decode a percent-encoded string (e.g., from OSC 7 file:// URIs)\n+/// Converts %XX sequences to their corresponding bytes\n+fn url_decode(s: &str) -> String {\n+    let mut result = Vec::with_capacity(s.len());\n+    let bytes = s.as_bytes();\n+    let mut i = 0;\n+    while i < bytes.len() {\n+        if bytes[i] == b'%' && i + 2 < bytes.len() {\n+            if let (Some(hi), Some(lo)) = (hex_digit(bytes[i + 1]), hex_digit(bytes[i + 2])) {\n+                result.push((hi << 4) | lo);\n+                i += 3;\n+                continue;\n+            }\n+        }\n+        result.push(bytes[i]);\n+        i += 1;\n+    }\n+    String::from_utf8_lossy(&result).into_owned()\n+}\n+\n+/// Convert ASCII hex digit to value (0-15)\n+fn hex_digit(b: u8) -> Option<u8> {\n+    match b {\n+        b'0'..=b'9' => Some(b - b'0'),\n+        b'A'..=b'F' => Some(b - b'A' + 10),\n+        b'a'..=b'f' => Some(b - b'a' + 10),\n+        _ => None,\n+    }\n+}\n+\n /// Convert CIE xyY to XYZ\n /// Handles out-of-gamut coordinates by mapping to white\n #[allow(clippy::many_single_char_names)]\n@@ -747,6 +777,15 @@ pub struct VirtualTerminal {\n     /// LNM - Line Feed/New Line Mode (ANSI mode 20)\n     /// When set, LF/VT/FF also perform CR (carriage return)\n     newline_mode: bool,\n+    /// Focus reporting mode (mode 1004)\n+    /// When enabled, terminal sends CSI I on focus in and CSI O on focus out\n+    pub focus_reporting: bool,\n+    /// Meta sends escape mode (mode 1034)\n+    /// When enabled, Alt+key sends ESC+key instead of setting high bit\n+    pub meta_sends_escape: bool,\n+    /// Current working directory (OSC 7)\n+    /// Shells emit this after each command to track the current directory\n+    pub current_working_directory: Option<String>,\n     /// Cursor style (DECSCUSR) - 0=default, 1=blinking block, 2=steady block,\n     /// 3=blinking underline, 4=steady underline, 5=blinking bar, 6=steady bar\n     cursor_style: u8,\n@@ -834,7 +873,10 @@ impl VirtualTerminal {\n             enable_left_right_margins: false,\n             reverse_wraparound: false,\n             newline_mode: true, // LNM mode 20 - set by default in xterm\n-            cursor_style: 0,    // Default cursor style (blinking block)\n+            focus_reporting: false,\n+            meta_sends_escape: true, // Default mode - Alt+key sends ESC+key\n+            current_working_directory: None,\n+            cursor_style: 0, // Default cursor style (blinking block)\n             dcs_handler: DcsHandler::None,\n             dcs_data: Vec::new(),\n         }\n@@ -1771,6 +1813,28 @@ impl Perform for VirtualTerminal {\n                         }\n                     }\n                 }\n+                // OSC 7 - Current working directory\n+                // Format: OSC 7 ; file://hostname/path ST\n+                \"7\" => {\n+                    if params.len() > 1 {\n+                        if let Ok(uri) = std::str::from_utf8(params[1]) {\n+                            // Parse file:// URI to extract path\n+                            // Format: file://hostname/path or file:///path\n+                            if let Some(path) = uri.strip_prefix(\"file://\") {\n+                                // Skip hostname (everything up to first / after //)\n+                                if let Some(slash_idx) = path.find('/') {\n+                                    let decoded_path = &path[slash_idx..];\n+                                    // URL-decode the path (handle %XX sequences)\n+                                    let path_str = url_decode(decoded_path);\n+                                    self.current_working_directory = Some(path_str);\n+                                }\n+                            } else {\n+                                // Not a file:// URI, store as-is (could be just a path)\n+                                self.current_working_directory = Some(uri.to_string());\n+                            }\n+                        }\n+                    }\n+                }\n                 // OSC 4 - Query/Set indexed color (256-color palette)\n                 // Format: OSC 4 ; index ; colorspec ST or OSC 4 ; index ; ? ST\n                 \"4\" => {\n@@ -2467,6 +2531,16 @@ impl Perform for VirtualTerminal {\n                                 // SGR extended mouse mode\n                                 self.sgr_mouse_mode = enable;\n                             }\n+                            1004 => {\n+                                // Focus reporting mode\n+                                // When enabled, send CSI I on focus in, CSI O on focus out\n+                                self.focus_reporting = enable;\n+                            }\n+                            1034 => {\n+                                // Meta sends escape mode\n+                                // When enabled, Alt+key sends ESC+key instead of setting high bit\n+                                self.meta_sends_escape = enable;\n+                            }\n                             45 => {\n                                 // Reverse wraparound mode\n                                 self.reverse_wraparound = enable;\n@@ -3399,8 +3473,16 @@ impl TerminalManager {\n         self.sessions.contains_key(&pane_id)\n     }\n \n-    /// Send input to a terminal session via the multiplexed connection\n-    pub fn send_input(&self, pane_id: PaneId, data: Vec<u8>) -> bool {\n+    /// Send input to a terminal session via the multiplexed connection.\n+    /// Also scrolls to bottom so the user sees where they're typing.\n+    pub fn send_input(&mut self, pane_id: PaneId, data: Vec<u8>) -> bool {\n+        // Auto-scroll to bottom when user types - they want to see the cursor\n+        if let Some(buffer) = self.buffers.get_mut(&pane_id) {\n+            if buffer.scroll_offset() > 0 {\n+                buffer.scroll_to_bottom();\n+            }\n+        }\n+\n         let session = match self.sessions.get(&pane_id) {\n             Some(s) => s,\n             None => return false,\n","comments":[{"type":"issue_comment","id":3604608977,"prNumber":1117,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7c3k9nw61gfy8pxv8n1exwp17wjxn4?src=preview.new) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7c3k9nw61gfy8pxv8n1exwp17wjxn4/browser?src=preview.new) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1117?src=preview.new)\n\n\n\nCaptured 5 screenshots for commit `15ee20b` (2025-12-03 01:11:40.760 UTC).\n\n**Full page screenshot with all sections expanded including Environment Variables**\n\n![preview-configure-all-expanded-fullpage-stacked-backlog-fixes.png](https://famous-camel-162.convex.cloud/api/storage/28942390-f587-4b09-9c40-4eb1a0560921)\n\n**Full page screenshot with Maintenance and Dev Scripts section expanded**\n\n![preview-configure-expanded-fullpage-stacked-backlog-fixes.png](https://famous-camel-162.convex.cloud/api/storage/ddc30c1f-7475-45f8-9e7e-ac060b86efb1)\n\n**Close-up viewport screenshot highlighting the new sans-serif font rendering**\n\n![preview-configure-font-change-viewport-stacked-backlog-fixes.png](https://famous-camel-162.convex.cloud/api/storage/9ab28168-dc58-4889-8abd-a5ec7bc7d510)\n\n**Full page screenshot of preview configure page showing font change from mono to sans**\n\n![preview-configure-page-fullpage-stacked-backlog-fixes.png](https://famous-camel-162.convex.cloud/api/storage/47d810b4-97b2-4098-8013-c16c6369f7d4)\n\n**Viewport screenshot of preview configure page with new sans-serif font**\n\n![preview-configure-page-viewport-stacked-backlog-fixes.png](https://famous-camel-162.convex.cloud/api/storage/355e4824-1bff-4fb2-8861-6f404291bd6e)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"15ee20bbf13dc5e13f9e685053d59d0195d485fe","createdAt":"2025-12-03T01:11:41Z","updatedAt":"2025-12-03T01:11:41Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1117#issuecomment-3604608977"}]}
{"number":1106,"title":"Show preview env confirmation with test PR CTA","state":"open","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1106","headRef":"cmux/show-preview-env-confirmation-with-test-pr-cta-91iw1","headSha":"3096c16920f511fc3b8e880c147707c0543fba97","baseRef":"main","baseSha":"b9ab5a5545043419155dd329d01535c8025ca5f0","createdAt":"2025-12-02T21:42:22Z","updatedAt":"2025-12-02T23:57:35Z","diff":"diff --git a/apps/www/app/(preview)/preview/configure/success/page.tsx b/apps/www/app/(preview)/preview/configure/success/page.tsx\nnew file mode 100644\nindex 000000000..5b0bbb3be\n--- /dev/null\n+++ b/apps/www/app/(preview)/preview/configure/success/page.tsx\n@@ -0,0 +1,95 @@\n+import { notFound, redirect } from \"next/navigation\";\n+import { PreviewConfigureSuccessClient } from \"@/components/preview/preview-configure-success-client\";\n+import { getConvex } from \"@/lib/utils/get-convex\";\n+import { stackServerApp } from \"@/lib/utils/stack\";\n+import { api } from \"@cmux/convex/api\";\n+import {\n+  getTeamSlugOrId,\n+  type StackTeam,\n+} from \"@/lib/team-utils\";\n+import { typedZid } from \"@cmux/shared/utils/typed-zid\";\n+\n+type PageProps = {\n+  searchParams?: Promise<SearchParams>;\n+};\n+\n+type SearchParams = Record<string, string | string[] | undefined>;\n+\n+function getSearchValue(\n+  search: SearchParams | undefined,\n+  key: string\n+): string | null {\n+  if (!search) {\n+    return null;\n+  }\n+  const value = search[key];\n+  return Array.isArray(value) ? value[0] ?? null : value ?? null;\n+}\n+\n+export default async function PreviewConfigureSuccessPage({ searchParams }: PageProps) {\n+  const resolvedSearch = await searchParams;\n+\n+  const user = await stackServerApp.getUser();\n+\n+  if (!user) {\n+    return redirect(\"/handler/sign-in?after_auth_return_to=/preview\");\n+  }\n+\n+  const [auth, teamsResult] = await Promise.all([\n+    user.getAuthJson(),\n+    user.listTeams(),\n+  ]);\n+  const teams: StackTeam[] = teamsResult;\n+  const { accessToken } = auth;\n+\n+  if (teams.length === 0) {\n+    notFound();\n+  }\n+\n+  if (!accessToken) {\n+    throw new Error(\"Missing Stack access token\");\n+  }\n+\n+  const previewConfigId = getSearchValue(resolvedSearch, \"previewConfigId\");\n+  const teamSlugOrId = getSearchValue(resolvedSearch, \"team\");\n+\n+  if (!previewConfigId || !teamSlugOrId) {\n+    return redirect(\"/preview\");\n+  }\n+\n+  // Verify team access\n+  const selectedTeam = teams.find(\n+    (team) => getTeamSlugOrId(team) === teamSlugOrId\n+  );\n+\n+  if (!selectedTeam) {\n+    return redirect(\"/preview\");\n+  }\n+\n+  const convex = getConvex({ accessToken });\n+\n+  // Fetch the preview config to get repo information\n+  let previewConfig;\n+  try {\n+    previewConfig = await convex.query(api.previewConfigs.get, {\n+      teamSlugOrId,\n+      previewConfigId: typedZid(\"previewConfigs\").parse(previewConfigId),\n+    });\n+  } catch (error) {\n+    console.error(\"Failed to fetch preview config\", error);\n+    return redirect(\"/preview\");\n+  }\n+\n+  if (!previewConfig) {\n+    return redirect(\"/preview\");\n+  }\n+\n+  return (\n+    <PreviewConfigureSuccessClient\n+      repoFullName={previewConfig.repoFullName}\n+      previewConfigId={previewConfigId}\n+      teamSlugOrId={teamSlugOrId}\n+      repoDefaultBranch={previewConfig.repoDefaultBranch ?? \"main\"}\n+    />\n+  );\n+}\ndiff --git a/apps/www/components/preview/preview-configure-client.tsx b/apps/www/components/preview/preview-configure-client.tsx\nindex ddb88f8dc..5b2c23423 100644\n--- a/apps/www/components/preview/preview-configure-client.tsx\n+++ b/apps/www/components/preview/preview-configure-client.tsx\n@@ -892,7 +892,9 @@ export function PreviewConfigureClient({\n         throw new Error(await previewResponse.text());\n       }\n \n-      window.location.href = \"/preview\";\n+      const previewData = await previewResponse.json();\n+      const successUrl = `/preview/configure/success?previewConfigId=${encodeURIComponent(previewData.id)}&team=${encodeURIComponent(resolvedTeamSlugOrId)}`;\n+      window.location.href = successUrl;\n     } catch (error) {\n       const message =\n         error instanceof Error ? error.message : \"Failed to save configuration\";\ndiff --git a/apps/www/components/preview/preview-configure-success-client.tsx b/apps/www/components/preview/preview-configure-success-client.tsx\nnew file mode 100644\nindex 000000000..b97a76823\n--- /dev/null\n+++ b/apps/www/components/preview/preview-configure-success-client.tsx\n@@ -0,0 +1,195 @@\n+\"use client\";\n+\n+import { useState } from \"react\";\n+import Link from \"next/link\";\n+import {\n+  CheckCircle2,\n+  Github,\n+  ExternalLink,\n+  Clock,\n+  GitPullRequest,\n+  Loader2,\n+  ArrowRight,\n+} from \"lucide-react\";\n+import clsx from \"clsx\";\n+\n+type PreviewConfigureSuccessClientProps = {\n+  repoFullName: string;\n+  previewConfigId: string;\n+  teamSlugOrId: string;\n+  repoDefaultBranch: string;\n+};\n+\n+export function PreviewConfigureSuccessClient({\n+  repoFullName,\n+  previewConfigId,\n+  teamSlugOrId,\n+  repoDefaultBranch,\n+}: PreviewConfigureSuccessClientProps) {\n+  const [isCreatingPR, setIsCreatingPR] = useState(false);\n+  const [createdPRUrl, setCreatedPRUrl] = useState<string | null>(null);\n+  const [errorMessage, setErrorMessage] = useState<string | null>(null);\n+\n+  const handleCreateTestPR = async () => {\n+    setIsCreatingPR(true);\n+    setErrorMessage(null);\n+\n+    try {\n+      const response = await fetch(\"/api/preview/test-pr\", {\n+        method: \"POST\",\n+        headers: { \"Content-Type\": \"application/json\" },\n+        body: JSON.stringify({\n+          teamSlugOrId,\n+          previewConfigId,\n+          repoFullName,\n+          baseBranch: repoDefaultBranch,\n+        }),\n+      });\n+\n+      if (!response.ok) {\n+        const text = await response.text();\n+        throw new Error(text || \"Failed to create test PR\");\n+      }\n+\n+      const data = await response.json();\n+      setCreatedPRUrl(data.prUrl);\n+    } catch (error) {\n+      const message = error instanceof Error ? error.message : \"Failed to create test PR\";\n+      setErrorMessage(message);\n+      console.error(\"Failed to create test PR:\", error);\n+    } finally {\n+      setIsCreatingPR(false);\n+    }\n+  };\n+\n+  return (\n+    <div className=\"min-h-dvh bg-white dark:bg-black flex items-center justify-center px-6 font-sans\">\n+      <div className=\"max-w-lg w-full\">\n+        <div className=\"text-center mb-8\">\n+          <div className=\"mx-auto mb-6 grid place-items-center\">\n+            <div className=\"h-16 w-16 rounded-full bg-emerald-50 dark:bg-emerald-950/50 ring-8 ring-emerald-50/50 dark:ring-emerald-950/30 grid place-items-center\">\n+              <CheckCircle2 className=\"h-8 w-8 text-emerald-600 dark:text-emerald-400\" />\n+            </div>\n+          </div>\n+          <h1 className=\"text-2xl font-semibold text-neutral-900 dark:text-neutral-100\">\n+            Preview Environment Configured\n+          </h1>\n+          <div className=\"mt-3 flex items-center justify-center gap-2 text-sm text-neutral-600 dark:text-neutral-400\">\n+            <Github className=\"h-4 w-4\" />\n+            <span>{repoFullName}</span>\n+          </div>\n+        </div>\n+\n+        <div className=\"rounded-xl border border-neutral-200 dark:border-neutral-800 bg-neutral-50 dark:bg-neutral-900/50 p-6 mb-6\">\n+          <h2 className=\"text-sm font-semibold text-neutral-900 dark:text-neutral-100 mb-4\">\n+            What happens next?\n+          </h2>\n+          <ul className=\"space-y-4 text-sm text-neutral-600 dark:text-neutral-400\">\n+            <li className=\"flex items-start gap-3\">\n+              <GitPullRequest className=\"h-5 w-5 text-neutral-400 flex-shrink-0 mt-0.5\" />\n+              <div>\n+                <span className=\"font-medium text-neutral-900 dark:text-neutral-100\">\n+                  Open a pull request\n+                </span>\n+                <p className=\"mt-0.5\">\n+                  When you open a PR to the <code className=\"px-1 py-0.5 rounded bg-neutral-200 dark:bg-neutral-800 text-xs\">{repoDefaultBranch}</code> branch, a preview environment will automatically spin up.\n+                </p>\n+              </div>\n+            </li>\n+            <li className=\"flex items-start gap-3\">\n+              <Clock className=\"h-5 w-5 text-neutral-400 flex-shrink-0 mt-0.5\" />\n+              <div>\n+                <span className=\"font-medium text-neutral-900 dark:text-neutral-100\">\n+                  Preview takes 2-5 minutes\n+                </span>\n+                <p className=\"mt-0.5\">\n+                  The job runs your maintenance script, starts the dev server, and captures browser screenshots.\n+                </p>\n+              </div>\n+            </li>\n+          </ul>\n+        </div>\n+\n+        {/* Test PR Section */}\n+        <div className=\"rounded-xl border border-neutral-200 dark:border-neutral-800 bg-neutral-50 dark:bg-neutral-900/50 p-6 mb-6\">\n+          <h2 className=\"text-sm font-semibold text-neutral-900 dark:text-neutral-100 mb-2\">\n+            Test your configuration\n+          </h2>\n+          <p className=\"text-sm text-neutral-600 dark:text-neutral-400 mb-4\">\n+            Create a test PR to verify everything works. This will create a new branch with a small test change and open a pull request.\n+          </p>\n+\n+          {errorMessage && (\n+            <div className=\"rounded-md bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-900/50 p-3 mb-4\">\n+              <p className=\"text-sm text-red-600 dark:text-red-400\">{errorMessage}</p>\n+            </div>\n+          )}\n+\n+          {createdPRUrl ? (\n+            <div className=\"space-y-3\">\n+              <div className=\"rounded-md bg-emerald-50 dark:bg-emerald-950/30 border border-emerald-200 dark:border-emerald-900/50 p-3\">\n+                <p className=\"text-sm text-emerald-700 dark:text-emerald-300 font-medium\">\n+                  Test PR created successfully!\n+                </p>\n+              </div>\n+              <a\n+                href={createdPRUrl}\n+                target=\"_blank\"\n+                rel=\"noopener noreferrer\"\n+                className=\"inline-flex w-full items-center justify-center gap-2 rounded-md bg-neutral-900 dark:bg-neutral-100 text-white dark:text-neutral-900 px-4 py-2.5 text-sm font-semibold hover:bg-neutral-800 dark:hover:bg-neutral-200 transition\"\n+              >\n+                View Pull Request\n+                <ExternalLink className=\"h-4 w-4\" />\n+              </a>\n+            </div>\n+          ) : (\n+            <button\n+              type=\"button\"\n+              onClick={handleCreateTestPR}\n+              disabled={isCreatingPR}\n+              className={clsx(\n+                \"inline-flex w-full items-center justify-center gap-2 rounded-md px-4 py-2.5 text-sm font-semibold transition\",\n+                isCreatingPR\n+                  ? \"bg-neutral-200 dark:bg-neutral-800 text-neutral-500 cursor-not-allowed\"\n+                  : \"bg-neutral-900 dark:bg-neutral-100 text-white dark:text-neutral-900 hover:bg-neutral-800 dark:hover:bg-neutral-200\"\n+              )}\n+            >\n+              {isCreatingPR ? (\n+                <>\n+                  <Loader2 className=\"h-4 w-4 animate-spin\" />\n+                  Creating test PR...\n+                </>\n+              ) : (\n+                <>\n+                  <GitPullRequest className=\"h-4 w-4\" />\n+                  Create Test PR\n+                </>\n+              )}\n+            </button>\n+          )}\n+        </div>\n+\n+        {/* Actions */}\n+        <div className=\"flex flex-col gap-3\">\n+          <Link\n+            href=\"/preview\"\n+            className=\"inline-flex w-full items-center justify-center gap-2 rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 text-neutral-900 dark:text-neutral-100 px-4 py-2.5 text-sm font-medium hover:bg-neutral-50 dark:hover:bg-neutral-900 transition\"\n+          >\n+            Go to Dashboard\n+            <ArrowRight className=\"h-4 w-4\" />\n+          </Link>\n+          <a\n+            href={`https://github.com/${repoFullName}`}\n+            target=\"_blank\"\n+            rel=\"noopener noreferrer\"\n+            className=\"inline-flex w-full items-center justify-center gap-2 text-sm text-neutral-500 dark:text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-300 transition\"\n+          >\n+            <Github className=\"h-4 w-4\" />\n+            View repository on GitHub\n+            <ExternalLink className=\"h-3 w-3\" />\n+          </a>\n+        </div>\n+      </div>\n+    </div>\n+  );\n+}\ndiff --git a/apps/www/lib/routes/preview.route.ts b/apps/www/lib/routes/preview.route.ts\nindex a6ad48eae..00e57bdb0 100644\n--- a/apps/www/lib/routes/preview.route.ts\n+++ b/apps/www/lib/routes/preview.route.ts\n@@ -1,11 +1,13 @@\n import { getAccessTokenFromRequest } from \"@/lib/utils/auth\";\n import { getConvex } from \"@/lib/utils/get-convex\";\n import { verifyTeamAccess } from \"@/lib/utils/team-verification\";\n+import { stackServerAppJs } from \"@/lib/utils/stack\";\n import { api } from \"@cmux/convex/api\";\n import type { Doc } from \"@cmux/convex/dataModel\";\n import { typedZid } from \"@cmux/shared/utils/typed-zid\";\n import { OpenAPIHono, createRoute, z } from \"@hono/zod-openapi\";\n import { HTTPException } from \"hono/http-exception\";\n+import { Octokit } from \"octokit\";\n \n export const previewRouter = new OpenAPIHono();\n \n@@ -287,3 +289,422 @@ previewRouter.openapi(\n     return c.json({ runs: runs.map(formatPreviewRun) });\n   },\n );\n+\n+// Test PR creation endpoint\n+const CreateTestPRBody = z\n+  .object({\n+    teamSlugOrId: z.string(),\n+    previewConfigId: z.string(),\n+    repoFullName: z.string(),\n+    baseBranch: z.string().optional(),\n+  })\n+  .openapi(\"CreateTestPRBody\");\n+\n+const CreateTestPRResponse = z\n+  .object({\n+    success: z.boolean(),\n+    prUrl: z.string().optional(),\n+    prNumber: z.number().optional(),\n+    error: z.string().optional(),\n+  })\n+  .openapi(\"CreateTestPRResponse\");\n+\n+previewRouter.openapi(\n+  createRoute({\n+    method: \"post\",\n+    path: \"/preview/test-pr\",\n+    tags: [\"Preview\"],\n+    summary: \"Create a test PR to verify preview configuration\",\n+    request: {\n+      body: {\n+        content: {\n+          \"application/json\": {\n+            schema: CreateTestPRBody,\n+          },\n+        },\n+        required: true,\n+      },\n+    },\n+    responses: {\n+      200: {\n+        description: \"Test PR created\",\n+        content: {\n+          \"application/json\": {\n+            schema: CreateTestPRResponse,\n+          },\n+        },\n+      },\n+      401: { description: \"Unauthorized\" },\n+      400: { description: \"Bad request\" },\n+      500: { description: \"Internal server error\" },\n+    },\n+  }),\n+  async (c) => {\n+    const user = await stackServerAppJs.getUser({ tokenStore: c.req.raw });\n+    if (!user) {\n+      return c.json({ success: false, error: \"Unauthorized\" }, 401);\n+    }\n+\n+    const [{ accessToken }, githubAccount] = await Promise.all([\n+      user.getAuthJson(),\n+      user.getConnectedAccount(\"github\"),\n+    ]);\n+\n+    if (!accessToken) {\n+      return c.json({ success: false, error: \"Unauthorized\" }, 401);\n+    }\n+\n+    if (!githubAccount) {\n+      return c.json(\n+        { success: false, error: \"GitHub account is not connected\" },\n+        401,\n+      );\n+    }\n+\n+    const { accessToken: githubAccessToken } = await githubAccount.getAccessToken();\n+    if (!githubAccessToken) {\n+      return c.json(\n+        { success: false, error: \"GitHub access token unavailable\" },\n+        401,\n+      );\n+    }\n+\n+    const body = c.req.valid(\"json\");\n+    const { teamSlugOrId, repoFullName, baseBranch = \"main\" } = body;\n+\n+    await verifyTeamAccess({ req: c.req.raw, teamSlugOrId });\n+\n+    const [owner, repo] = repoFullName.split(\"/\");\n+    if (!owner || !repo) {\n+      return c.json(\n+        { success: false, error: \"Invalid repository name\" },\n+        400,\n+      );\n+    }\n+\n+    const octokit = new Octokit({\n+      auth: githubAccessToken,\n+      request: { timeout: 30_000 },\n+    });\n+\n+    try {\n+      // Get the SHA of the base branch\n+      const { data: baseBranchData } = await octokit.rest.repos.getBranch({\n+        owner,\n+        repo,\n+        branch: baseBranch,\n+      });\n+      const baseSha = baseBranchData.commit.sha;\n+\n+      // Create a unique branch name\n+      const timestamp = Date.now();\n+      const testBranchName = `cmux-test-preview-${timestamp}`;\n+\n+      // Create the test branch\n+      await octokit.rest.git.createRef({\n+        owner,\n+        repo,\n+        ref: `refs/heads/${testBranchName}`,\n+        sha: baseSha,\n+      });\n+\n+      // Create a test HTML page in public/ so it's accessible as a page\n+      const testFileName = \"public/cmux-test-preview.html\";\n+      const testFileContent = `<!DOCTYPE html>\n+<html lang=\"en\">\n+<head>\n+  <meta charset=\"UTF-8\">\n+  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n+  <title>Preview Test - cmux</title>\n+  <style>\n+    * {\n+      margin: 0;\n+      padding: 0;\n+      box-sizing: border-box;\n+    }\n+    body {\n+      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n+      min-height: 100vh;\n+      background: #0a0a0f;\n+      padding: 48px 24px;\n+      color: #fff;\n+    }\n+    .container {\n+      max-width: 720px;\n+      margin: 0 auto;\n+    }\n+    .header {\n+      text-align: center;\n+      margin-bottom: 48px;\n+    }\n+    .badge {\n+      display: inline-flex;\n+      align-items: center;\n+      gap: 6px;\n+      background: rgba(16, 185, 129, 0.15);\n+      border: 1px solid rgba(16, 185, 129, 0.3);\n+      color: #10b981;\n+      font-size: 12px;\n+      font-weight: 600;\n+      padding: 6px 12px;\n+      border-radius: 9999px;\n+      margin-bottom: 16px;\n+      text-transform: uppercase;\n+      letter-spacing: 0.05em;\n+    }\n+    .badge::before {\n+      content: '';\n+      width: 6px;\n+      height: 6px;\n+      background: #10b981;\n+      border-radius: 50%;\n+      animation: pulse 2s infinite;\n+    }\n+    @keyframes pulse {\n+      0%, 100% { opacity: 1; }\n+      50% { opacity: 0.4; }\n+    }\n+    h1 {\n+      font-size: 32px;\n+      font-weight: 700;\n+      margin-bottom: 12px;\n+    }\n+    .subtitle {\n+      font-size: 16px;\n+      color: #71717a;\n+      line-height: 1.5;\n+    }\n+    .card {\n+      background: rgba(255, 255, 255, 0.03);\n+      border: 1px solid rgba(255, 255, 255, 0.08);\n+      border-radius: 12px;\n+      padding: 24px;\n+      margin-bottom: 24px;\n+    }\n+    .card-title {\n+      font-size: 14px;\n+      font-weight: 600;\n+      color: #fff;\n+      margin-bottom: 16px;\n+    }\n+    .check-list {\n+      list-style: none;\n+    }\n+    .check-list li {\n+      display: flex;\n+      align-items: flex-start;\n+      gap: 12px;\n+      padding: 12px 0;\n+      border-bottom: 1px solid rgba(255, 255, 255, 0.06);\n+      font-size: 14px;\n+      color: #a1a1aa;\n+    }\n+    .check-list li:last-child {\n+      border-bottom: none;\n+    }\n+    .check-icon {\n+      width: 20px;\n+      height: 20px;\n+      background: rgba(16, 185, 129, 0.15);\n+      border-radius: 50%;\n+      display: flex;\n+      align-items: center;\n+      justify-content: center;\n+      flex-shrink: 0;\n+      margin-top: 1px;\n+    }\n+    .check-icon svg {\n+      width: 12px;\n+      height: 12px;\n+      color: #10b981;\n+    }\n+    .check-text strong {\n+      color: #fff;\n+      font-weight: 500;\n+    }\n+    .promo-card {\n+      background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.02) 100%);\n+      border: 1px solid rgba(16, 185, 129, 0.2);\n+    }\n+    .promo-header {\n+      display: flex;\n+      align-items: center;\n+      gap: 8px;\n+      margin-bottom: 12px;\n+    }\n+    .promo-label {\n+      font-size: 12px;\n+      color: #71717a;\n+    }\n+    .promo-logo {\n+      font-size: 16px;\n+      font-weight: 700;\n+      color: #fff;\n+    }\n+    .promo-logo span {\n+      color: #10b981;\n+    }\n+    .promo-text {\n+      font-size: 14px;\n+      color: #a1a1aa;\n+      line-height: 1.5;\n+      margin-bottom: 16px;\n+    }\n+    .promo-buttons {\n+      display: flex;\n+      gap: 12px;\n+      flex-wrap: wrap;\n+    }\n+    .btn {\n+      display: inline-flex;\n+      align-items: center;\n+      gap: 8px;\n+      padding: 10px 16px;\n+      border-radius: 8px;\n+      font-size: 14px;\n+      font-weight: 500;\n+      text-decoration: none;\n+      transition: all 0.2s;\n+    }\n+    .btn-primary {\n+      background: #fff;\n+      color: #000;\n+    }\n+    .btn-primary:hover {\n+      background: #e4e4e7;\n+    }\n+    .btn-secondary {\n+      background: rgba(255, 255, 255, 0.08);\n+      color: #fff;\n+      border: 1px solid rgba(255, 255, 255, 0.1);\n+    }\n+    .btn-secondary:hover {\n+      background: rgba(255, 255, 255, 0.12);\n+    }\n+    .btn svg {\n+      width: 16px;\n+      height: 16px;\n+    }\n+  </style>\n+</head>\n+<body>\n+  <div class=\"container\">\n+    <div class=\"header\">\n+      <span class=\"badge\">Test Successful</span>\n+      <h1>Preview Environment Verified</h1>\n+      <p class=\"subtitle\">Your cmux preview configuration is working correctly. This page was automatically generated to verify the setup.</p>\n+    </div>\n+\n+    <div class=\"card\">\n+      <div class=\"card-title\">What was tested</div>\n+      <ul class=\"check-list\">\n+        <li>\n+          <div class=\"check-icon\">\n+            <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"3\">\n+              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M5 13l4 4L19 7\" />\n+            </svg>\n+          </div>\n+          <div class=\"check-text\"><strong>GitHub webhook received</strong> - PR events are being sent to cmux</div>\n+        </li>\n+        <li>\n+          <div class=\"check-icon\">\n+            <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"3\">\n+              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M5 13l4 4L19 7\" />\n+            </svg>\n+          </div>\n+          <div class=\"check-text\"><strong>Dev server started</strong> - Your application is running in the preview environment</div>\n+        </li>\n+        <li>\n+          <div class=\"check-icon\">\n+            <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"3\">\n+              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M5 13l4 4L19 7\" />\n+            </svg>\n+          </div>\n+          <div class=\"check-text\"><strong>Screenshot captured</strong> - The agent can browse and screenshot your UI</div>\n+        </li>\n+      </ul>\n+    </div>\n+\n+    <div class=\"card promo-card\">\n+      <div class=\"promo-header\">\n+        <span class=\"promo-label\">From the creators of</span>\n+        <span class=\"promo-logo\">c<span>mux</span>.dev</span>\n+      </div>\n+      <p class=\"promo-text\">Get AI-powered screenshot previews for every pull request. cmux boots your dev server, captures screenshots of UI changes, and posts them directly to your PR.</p>\n+      <div class=\"promo-buttons\">\n+        <a href=\"https://github.com/manaflow-ai/cmux\" class=\"btn btn-secondary\" target=\"_blank\">\n+          <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n+            <path d=\"M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z\"/>\n+          </svg>\n+          Star on GitHub\n+        </a>\n+        <a href=\"https://cmux.dev\" class=\"btn btn-primary\" target=\"_blank\">\n+          Explore cmux\n+          <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"2\">\n+            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M13 7l5 5m0 0l-5 5m5-5H6\" />\n+          </svg>\n+        </a>\n+      </div>\n+    </div>\n+  </div>\n+</body>\n+</html>\n+`;\n+\n+      await octokit.rest.repos.createOrUpdateFileContents({\n+        owner,\n+        repo,\n+        path: testFileName,\n+        message: \"test: add cmux preview test page\",\n+        content: Buffer.from(testFileContent).toString(\"base64\"),\n+        branch: testBranchName,\n+      });\n+\n+      // Create the pull request\n+      const { data: pr } = await octokit.rest.pulls.create({\n+        owner,\n+        repo,\n+        title: \"Test cmux Preview Configuration\",\n+        head: testBranchName,\n+        base: baseBranch,\n+        body: `## Test Preview Configuration\n+\n+This PR was automatically created by cmux to test your preview configuration.\n+\n+### What this PR adds\n+\n+A test HTML page at \\`public/cmux-test-preview.html\\` that will be accessible at \\`/cmux-test-preview.html\\` in your preview environment.\n+\n+### What to expect\n+\n+A preview environment will be created for this PR. This typically takes **2-5 minutes**.\n+\n+Once complete, you'll see a comment on this PR with a screenshot of the test page and a link to the preview environment.\n+\n+### After testing\n+\n+- If the preview works correctly, you can close this PR\n+- The test branch \\`${testBranchName}\\` will be automatically deleted when the PR is closed\n+\n+---\n+\n+*Created by [cmux](https://cmux.sh)*\n+`,\n+        draft: false,\n+      });\n+\n+      return c.json({\n+        success: true,\n+        prUrl: pr.html_url,\n+        prNumber: pr.number,\n+      });\n+    } catch (error) {\n+      const message = error instanceof Error ? error.message : String(error);\n+      console.error(\"Failed to create test PR:\", error);\n+      return c.json(\n+        { success: false, error: message },\n+        500,\n+      );\n+    }\n+  },\n+);\ndiff --git a/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts b/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts\nindex f99506014..39449e814 100644\n--- a/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts\n+++ b/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts\n@@ -1,8 +1,8 @@\n // This file is auto-generated by @hey-api/openapi-ts\n \n-import { type Options, getApiHealth, postApiAuthAnonymousSignUp, getApiUsers, postApiUsers, deleteApiUsersById, getApiUsersById, patchApiUsersById, getApiBooks, postApiBooks, getApiBooksById, postApiBooksByIdBorrow, postApiBooksByIdReturn, postApiDevServerStart, getApiIntegrationsGithubRepos, getApiIntegrationsGithubPrs, postApiIntegrationsGithubPrsBackfill, postApiIntegrationsGithubPrsBackfillRepo, getApiIntegrationsGithubPrsCode, postApiIntegrationsGithubPrsOpen, postApiIntegrationsGithubPrsMerge, postApiIntegrationsGithubPrsClose, postApiIntegrationsGithubPrsMergeSimple, getApiIntegrationsGithubPrsRaw, getApiIntegrationsGithubPrsFiles, getApiIntegrationsGithubPrsFileContents, postApiIntegrationsGithubPrsFileContentsBatch, postApiIntegrationsGithubInstallState, getApiIntegrationsGithubOauthToken, postApiMorphTaskRunsByTaskRunIdResume, postApiMorphTaskRunsByTaskRunIdIsPaused, postApiMorphSetupInstance, getApiEnvironments, postApiEnvironments, deleteApiEnvironmentsById, getApiEnvironmentsById, patchApiEnvironmentsById, getApiEnvironmentsByIdVars, patchApiEnvironmentsByIdPorts, getApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivate, postApiSandboxesStart, postApiSandboxesByIdEnv, postApiSandboxesByIdStop, getApiSandboxesByIdStatus, postApiSandboxesByIdPublishDevcontainer, postApiTeams, postApiBranchesGenerate, postApiCodeReviewStart, getApiWorkspaceConfigs, postApiWorkspaceConfigs, getApiPreviewConfigs, postApiPreviewConfigs, deleteApiPreviewConfigsByPreviewConfigId, getApiPreviewConfigsByPreviewConfigIdRuns } from '../sdk.gen.js';\n+import { type Options, getApiHealth, postApiAuthAnonymousSignUp, getApiUsers, postApiUsers, deleteApiUsersById, getApiUsersById, patchApiUsersById, getApiBooks, postApiBooks, getApiBooksById, postApiBooksByIdBorrow, postApiBooksByIdReturn, postApiDevServerStart, getApiIntegrationsGithubRepos, getApiIntegrationsGithubPrs, postApiIntegrationsGithubPrsBackfill, postApiIntegrationsGithubPrsBackfillRepo, getApiIntegrationsGithubPrsCode, postApiIntegrationsGithubPrsOpen, postApiIntegrationsGithubPrsMerge, postApiIntegrationsGithubPrsClose, postApiIntegrationsGithubPrsMergeSimple, getApiIntegrationsGithubPrsRaw, getApiIntegrationsGithubPrsFiles, getApiIntegrationsGithubPrsFileContents, postApiIntegrationsGithubPrsFileContentsBatch, postApiIntegrationsGithubInstallState, getApiIntegrationsGithubOauthToken, postApiMorphTaskRunsByTaskRunIdResume, postApiMorphTaskRunsByTaskRunIdIsPaused, postApiMorphSetupInstance, getApiEnvironments, postApiEnvironments, deleteApiEnvironmentsById, getApiEnvironmentsById, patchApiEnvironmentsById, getApiEnvironmentsByIdVars, patchApiEnvironmentsByIdPorts, getApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivate, postApiSandboxesStart, postApiSandboxesByIdEnv, postApiSandboxesByIdStop, getApiSandboxesByIdStatus, postApiSandboxesByIdPublishDevcontainer, postApiTeams, postApiBranchesGenerate, postApiCodeReviewStart, getApiWorkspaceConfigs, postApiWorkspaceConfigs, getApiPreviewConfigs, postApiPreviewConfigs, deleteApiPreviewConfigsByPreviewConfigId, getApiPreviewConfigsByPreviewConfigIdRuns, postApiPreviewTestPr } from '../sdk.gen.js';\n import { queryOptions, type UseMutationOptions, type DefaultError, infiniteQueryOptions, type InfiniteData } from '@tanstack/react-query';\n-import type { GetApiHealthData, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponse, GetApiUsersData, GetApiUsersResponse, PostApiUsersData, PostApiUsersError, PostApiUsersResponse, DeleteApiUsersByIdData, DeleteApiUsersByIdError, DeleteApiUsersByIdResponse, GetApiUsersByIdData, PatchApiUsersByIdData, PatchApiUsersByIdError, PatchApiUsersByIdResponse, GetApiBooksData, PostApiBooksData, PostApiBooksError, PostApiBooksResponse, GetApiBooksByIdData, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowError, PostApiBooksByIdBorrowResponse, PostApiBooksByIdReturnData, PostApiBooksByIdReturnError, PostApiBooksByIdReturnResponse, PostApiDevServerStartData, PostApiDevServerStartError, PostApiDevServerStartResponse, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponse, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponse, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillRepoData, GetApiIntegrationsGithubPrsCodeData, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponse, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponse, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponse, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponse, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFileContentsData, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponse, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponse, GetApiIntegrationsGithubOauthTokenData, PostApiMorphTaskRunsByTaskRunIdResumeData, PostApiMorphTaskRunsByTaskRunIdResumeResponse, PostApiMorphTaskRunsByTaskRunIdIsPausedData, PostApiMorphTaskRunsByTaskRunIdIsPausedResponse, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponse, GetApiEnvironmentsData, PostApiEnvironmentsData, PostApiEnvironmentsResponse, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdData, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdVarsData, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponse, GetApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponse, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponse, PostApiSandboxesStartData, PostApiSandboxesStartResponse, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponse, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponse, GetApiSandboxesByIdStatusData, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponse, PostApiTeamsData, PostApiTeamsError, PostApiTeamsResponse, PostApiBranchesGenerateData, PostApiBranchesGenerateResponse, PostApiCodeReviewStartData, PostApiCodeReviewStartResponse, GetApiWorkspaceConfigsData, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponse, GetApiPreviewConfigsData, PostApiPreviewConfigsData, PostApiPreviewConfigsResponse, DeleteApiPreviewConfigsByPreviewConfigIdData, DeleteApiPreviewConfigsByPreviewConfigIdResponse, GetApiPreviewConfigsByPreviewConfigIdRunsData } from '../types.gen.js';\n+import type { GetApiHealthData, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponse, GetApiUsersData, GetApiUsersResponse, PostApiUsersData, PostApiUsersError, PostApiUsersResponse, DeleteApiUsersByIdData, DeleteApiUsersByIdError, DeleteApiUsersByIdResponse, GetApiUsersByIdData, PatchApiUsersByIdData, PatchApiUsersByIdError, PatchApiUsersByIdResponse, GetApiBooksData, PostApiBooksData, PostApiBooksError, PostApiBooksResponse, GetApiBooksByIdData, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowError, PostApiBooksByIdBorrowResponse, PostApiBooksByIdReturnData, PostApiBooksByIdReturnError, PostApiBooksByIdReturnResponse, PostApiDevServerStartData, PostApiDevServerStartError, PostApiDevServerStartResponse, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponse, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponse, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillRepoData, GetApiIntegrationsGithubPrsCodeData, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponse, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponse, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponse, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponse, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFileContentsData, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponse, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponse, GetApiIntegrationsGithubOauthTokenData, PostApiMorphTaskRunsByTaskRunIdResumeData, PostApiMorphTaskRunsByTaskRunIdResumeResponse, PostApiMorphTaskRunsByTaskRunIdIsPausedData, PostApiMorphTaskRunsByTaskRunIdIsPausedResponse, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponse, GetApiEnvironmentsData, PostApiEnvironmentsData, PostApiEnvironmentsResponse, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdData, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdVarsData, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponse, GetApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponse, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponse, PostApiSandboxesStartData, PostApiSandboxesStartResponse, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponse, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponse, GetApiSandboxesByIdStatusData, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponse, PostApiTeamsData, PostApiTeamsError, PostApiTeamsResponse, PostApiBranchesGenerateData, PostApiBranchesGenerateResponse, PostApiCodeReviewStartData, PostApiCodeReviewStartResponse, GetApiWorkspaceConfigsData, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponse, GetApiPreviewConfigsData, PostApiPreviewConfigsData, PostApiPreviewConfigsResponse, DeleteApiPreviewConfigsByPreviewConfigIdData, DeleteApiPreviewConfigsByPreviewConfigIdResponse, GetApiPreviewConfigsByPreviewConfigIdRunsData, PostApiPreviewTestPrData, PostApiPreviewTestPrResponse } from '../types.gen.js';\n import { client as _heyApiClient } from '../client.gen.js';\n \n export type QueryKey<TOptions extends Options> = [\n@@ -1152,4 +1152,21 @@ export const getApiPreviewConfigsByPreviewConfigIdRunsOptions = (options: Option\n         },\n         queryKey: getApiPreviewConfigsByPreviewConfigIdRunsQueryKey(options)\n     });\n+};\n+\n+/**\n+ * Create a test PR to verify preview configuration\n+ */\n+export const postApiPreviewTestPrMutation = (options?: Partial<Options<PostApiPreviewTestPrData>>): UseMutationOptions<PostApiPreviewTestPrResponse, DefaultError, Options<PostApiPreviewTestPrData>> => {\n+    const mutationOptions: UseMutationOptions<PostApiPreviewTestPrResponse, DefaultError, Options<PostApiPreviewTestPrData>> = {\n+        mutationFn: async (fnOptions) => {\n+            const { data } = await postApiPreviewTestPr({\n+                ...options,\n+                ...fnOptions,\n+                throwOnError: true\n+            });\n+            return data;\n+        }\n+    };\n+    return mutationOptions;\n };\n\\ No newline at end of file\ndiff --git a/packages/www-openapi-client/src/client/sdk.gen.ts b/packages/www-openapi-client/src/client/sdk.gen.ts\nindex 834397a27..2ffbb2a94 100644\n--- a/packages/www-openapi-client/src/client/sdk.gen.ts\n+++ b/packages/www-openapi-client/src/client/sdk.gen.ts\n@@ -1,7 +1,7 @@\n // This file is auto-generated by @hey-api/openapi-ts\n \n import type { Options as ClientOptions, TDataShape, Client } from './client/index.js';\n-import type { GetApiHealthData, GetApiHealthResponses, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponses, PostApiAuthAnonymousSignUpErrors, GetApiUsersData, GetApiUsersResponses, PostApiUsersData, PostApiUsersResponses, PostApiUsersErrors, DeleteApiUsersByIdData, DeleteApiUsersByIdResponses, DeleteApiUsersByIdErrors, GetApiUsersByIdData, GetApiUsersByIdResponses, GetApiUsersByIdErrors, PatchApiUsersByIdData, PatchApiUsersByIdResponses, PatchApiUsersByIdErrors, GetApiBooksData, GetApiBooksResponses, PostApiBooksData, PostApiBooksResponses, PostApiBooksErrors, GetApiBooksByIdData, GetApiBooksByIdResponses, GetApiBooksByIdErrors, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowResponses, PostApiBooksByIdBorrowErrors, PostApiBooksByIdReturnData, PostApiBooksByIdReturnResponses, PostApiBooksByIdReturnErrors, PostApiDevServerStartData, PostApiDevServerStartResponses, PostApiDevServerStartErrors, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponses, GetApiIntegrationsGithubReposErrors, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponses, GetApiIntegrationsGithubPrsErrors, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillResponses, PostApiIntegrationsGithubPrsBackfillErrors, PostApiIntegrationsGithubPrsBackfillRepoData, PostApiIntegrationsGithubPrsBackfillRepoResponses, PostApiIntegrationsGithubPrsBackfillRepoErrors, GetApiIntegrationsGithubPrsCodeData, GetApiIntegrationsGithubPrsCodeResponses, GetApiIntegrationsGithubPrsCodeErrors, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponses, PostApiIntegrationsGithubPrsOpenErrors, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponses, PostApiIntegrationsGithubPrsMergeErrors, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponses, PostApiIntegrationsGithubPrsCloseErrors, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponses, PostApiIntegrationsGithubPrsMergeSimpleErrors, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsRawResponses, GetApiIntegrationsGithubPrsRawErrors, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFilesResponses, GetApiIntegrationsGithubPrsFilesErrors, GetApiIntegrationsGithubPrsFileContentsData, GetApiIntegrationsGithubPrsFileContentsResponses, GetApiIntegrationsGithubPrsFileContentsErrors, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponses, PostApiIntegrationsGithubPrsFileContentsBatchErrors, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponses, PostApiIntegrationsGithubInstallStateErrors, GetApiIntegrationsGithubOauthTokenData, GetApiIntegrationsGithubOauthTokenResponses, GetApiIntegrationsGithubOauthTokenErrors, PostApiMorphTaskRunsByTaskRunIdResumeData, PostApiMorphTaskRunsByTaskRunIdResumeResponses, PostApiMorphTaskRunsByTaskRunIdResumeErrors, PostApiMorphTaskRunsByTaskRunIdIsPausedData, PostApiMorphTaskRunsByTaskRunIdIsPausedResponses, PostApiMorphTaskRunsByTaskRunIdIsPausedErrors, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponses, PostApiMorphSetupInstanceErrors, GetApiIframePreflightData, GetApiIframePreflightResponses, GetApiIframePreflightErrors, GetApiEnvironmentsData, GetApiEnvironmentsResponses, GetApiEnvironmentsErrors, PostApiEnvironmentsData, PostApiEnvironmentsResponses, PostApiEnvironmentsErrors, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponses, DeleteApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdData, GetApiEnvironmentsByIdResponses, GetApiEnvironmentsByIdErrors, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponses, PatchApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdVarsData, GetApiEnvironmentsByIdVarsResponses, GetApiEnvironmentsByIdVarsErrors, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponses, PatchApiEnvironmentsByIdPortsErrors, GetApiEnvironmentsByIdSnapshotsData, GetApiEnvironmentsByIdSnapshotsResponses, GetApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponses, PostApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponses, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateErrors, PostApiSandboxesStartData, PostApiSandboxesStartResponses, PostApiSandboxesStartErrors, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponses, PostApiSandboxesByIdEnvErrors, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponses, PostApiSandboxesByIdStopErrors, GetApiSandboxesByIdStatusData, GetApiSandboxesByIdStatusResponses, GetApiSandboxesByIdStatusErrors, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponses, PostApiSandboxesByIdPublishDevcontainerErrors, PostApiTeamsData, PostApiTeamsResponses, PostApiTeamsErrors, PostApiBranchesGenerateData, PostApiBranchesGenerateResponses, PostApiBranchesGenerateErrors, PostApiCodeReviewStartData, PostApiCodeReviewStartResponses, PostApiCodeReviewStartErrors, GetApiWorkspaceConfigsData, GetApiWorkspaceConfigsResponses, GetApiWorkspaceConfigsErrors, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponses, PostApiWorkspaceConfigsErrors, GetApiPreviewConfigsData, GetApiPreviewConfigsResponses, GetApiPreviewConfigsErrors, PostApiPreviewConfigsData, PostApiPreviewConfigsResponses, PostApiPreviewConfigsErrors, DeleteApiPreviewConfigsByPreviewConfigIdData, DeleteApiPreviewConfigsByPreviewConfigIdResponses, DeleteApiPreviewConfigsByPreviewConfigIdErrors, GetApiPreviewConfigsByPreviewConfigIdRunsData, GetApiPreviewConfigsByPreviewConfigIdRunsResponses, GetApiPreviewConfigsByPreviewConfigIdRunsErrors } from './types.gen.js';\n+import type { GetApiHealthData, GetApiHealthResponses, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponses, PostApiAuthAnonymousSignUpErrors, GetApiUsersData, GetApiUsersResponses, PostApiUsersData, PostApiUsersResponses, PostApiUsersErrors, DeleteApiUsersByIdData, DeleteApiUsersByIdResponses, DeleteApiUsersByIdErrors, GetApiUsersByIdData, GetApiUsersByIdResponses, GetApiUsersByIdErrors, PatchApiUsersByIdData, PatchApiUsersByIdResponses, PatchApiUsersByIdErrors, GetApiBooksData, GetApiBooksResponses, PostApiBooksData, PostApiBooksResponses, PostApiBooksErrors, GetApiBooksByIdData, GetApiBooksByIdResponses, GetApiBooksByIdErrors, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowResponses, PostApiBooksByIdBorrowErrors, PostApiBooksByIdReturnData, PostApiBooksByIdReturnResponses, PostApiBooksByIdReturnErrors, PostApiDevServerStartData, PostApiDevServerStartResponses, PostApiDevServerStartErrors, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponses, GetApiIntegrationsGithubReposErrors, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponses, GetApiIntegrationsGithubPrsErrors, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillResponses, PostApiIntegrationsGithubPrsBackfillErrors, PostApiIntegrationsGithubPrsBackfillRepoData, PostApiIntegrationsGithubPrsBackfillRepoResponses, PostApiIntegrationsGithubPrsBackfillRepoErrors, GetApiIntegrationsGithubPrsCodeData, GetApiIntegrationsGithubPrsCodeResponses, GetApiIntegrationsGithubPrsCodeErrors, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponses, PostApiIntegrationsGithubPrsOpenErrors, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponses, PostApiIntegrationsGithubPrsMergeErrors, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponses, PostApiIntegrationsGithubPrsCloseErrors, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponses, PostApiIntegrationsGithubPrsMergeSimpleErrors, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsRawResponses, GetApiIntegrationsGithubPrsRawErrors, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFilesResponses, GetApiIntegrationsGithubPrsFilesErrors, GetApiIntegrationsGithubPrsFileContentsData, GetApiIntegrationsGithubPrsFileContentsResponses, GetApiIntegrationsGithubPrsFileContentsErrors, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponses, PostApiIntegrationsGithubPrsFileContentsBatchErrors, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponses, PostApiIntegrationsGithubInstallStateErrors, GetApiIntegrationsGithubOauthTokenData, GetApiIntegrationsGithubOauthTokenResponses, GetApiIntegrationsGithubOauthTokenErrors, PostApiMorphTaskRunsByTaskRunIdResumeData, PostApiMorphTaskRunsByTaskRunIdResumeResponses, PostApiMorphTaskRunsByTaskRunIdResumeErrors, PostApiMorphTaskRunsByTaskRunIdIsPausedData, PostApiMorphTaskRunsByTaskRunIdIsPausedResponses, PostApiMorphTaskRunsByTaskRunIdIsPausedErrors, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponses, PostApiMorphSetupInstanceErrors, GetApiIframePreflightData, GetApiIframePreflightResponses, GetApiIframePreflightErrors, GetApiEnvironmentsData, GetApiEnvironmentsResponses, GetApiEnvironmentsErrors, PostApiEnvironmentsData, PostApiEnvironmentsResponses, PostApiEnvironmentsErrors, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponses, DeleteApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdData, GetApiEnvironmentsByIdResponses, GetApiEnvironmentsByIdErrors, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponses, PatchApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdVarsData, GetApiEnvironmentsByIdVarsResponses, GetApiEnvironmentsByIdVarsErrors, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponses, PatchApiEnvironmentsByIdPortsErrors, GetApiEnvironmentsByIdSnapshotsData, GetApiEnvironmentsByIdSnapshotsResponses, GetApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponses, PostApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponses, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateErrors, PostApiSandboxesStartData, PostApiSandboxesStartResponses, PostApiSandboxesStartErrors, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponses, PostApiSandboxesByIdEnvErrors, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponses, PostApiSandboxesByIdStopErrors, GetApiSandboxesByIdStatusData, GetApiSandboxesByIdStatusResponses, GetApiSandboxesByIdStatusErrors, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponses, PostApiSandboxesByIdPublishDevcontainerErrors, PostApiTeamsData, PostApiTeamsResponses, PostApiTeamsErrors, PostApiBranchesGenerateData, PostApiBranchesGenerateResponses, PostApiBranchesGenerateErrors, PostApiCodeReviewStartData, PostApiCodeReviewStartResponses, PostApiCodeReviewStartErrors, GetApiWorkspaceConfigsData, GetApiWorkspaceConfigsResponses, GetApiWorkspaceConfigsErrors, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponses, PostApiWorkspaceConfigsErrors, GetApiPreviewConfigsData, GetApiPreviewConfigsResponses, GetApiPreviewConfigsErrors, PostApiPreviewConfigsData, PostApiPreviewConfigsResponses, PostApiPreviewConfigsErrors, DeleteApiPreviewConfigsByPreviewConfigIdData, DeleteApiPreviewConfigsByPreviewConfigIdResponses, DeleteApiPreviewConfigsByPreviewConfigIdErrors, GetApiPreviewConfigsByPreviewConfigIdRunsData, GetApiPreviewConfigsByPreviewConfigIdRunsResponses, GetApiPreviewConfigsByPreviewConfigIdRunsErrors, PostApiPreviewTestPrData, PostApiPreviewTestPrResponses, PostApiPreviewTestPrErrors } from './types.gen.js';\n import { client as _heyApiClient } from './client.gen.js';\n \n export type Options<TData extends TDataShape = TDataShape, ThrowOnError extends boolean = boolean> = ClientOptions<TData, ThrowOnError> & {\n@@ -689,4 +689,18 @@ export const getApiPreviewConfigsByPreviewConfigIdRuns = <ThrowOnError extends b\n         url: '/api/preview/configs/{previewConfigId}/runs',\n         ...options\n     });\n+};\n+\n+/**\n+ * Create a test PR to verify preview configuration\n+ */\n+export const postApiPreviewTestPr = <ThrowOnError extends boolean = false>(options: Options<PostApiPreviewTestPrData, ThrowOnError>) => {\n+    return (options.client ?? _heyApiClient).post<PostApiPreviewTestPrResponses, PostApiPreviewTestPrErrors, ThrowOnError>({\n+        url: '/api/preview/test-pr',\n+        ...options,\n+        headers: {\n+            'Content-Type': 'application/json',\n+            ...options.headers\n+        }\n+    });\n };\n\\ No newline at end of file\ndiff --git a/packages/www-openapi-client/src/client/types.gen.ts b/packages/www-openapi-client/src/client/types.gen.ts\nindex a3ebfedf9..e4697dae3 100644\n--- a/packages/www-openapi-client/src/client/types.gen.ts\n+++ b/packages/www-openapi-client/src/client/types.gen.ts\n@@ -689,6 +689,20 @@ export type PreviewRunsResponse = {\n     runs: Array<PreviewRun>;\n };\n \n+export type CreateTestPrResponse = {\n+    success: boolean;\n+    prUrl?: string;\n+    prNumber?: number;\n+    error?: string;\n+};\n+\n+export type CreateTestPrBody = {\n+    teamSlugOrId: string;\n+    previewConfigId: string;\n+    repoFullName: string;\n+    baseBranch?: string;\n+};\n+\n export type GetApiHealthData = {\n     body?: never;\n     path?: never;\n@@ -2565,6 +2579,37 @@ export type GetApiPreviewConfigsByPreviewConfigIdRunsResponses = {\n \n export type GetApiPreviewConfigsByPreviewConfigIdRunsResponse = GetApiPreviewConfigsByPreviewConfigIdRunsResponses[keyof GetApiPreviewConfigsByPreviewConfigIdRunsResponses];\n \n+export type PostApiPreviewTestPrData = {\n+    body: CreateTestPrBody;\n+    path?: never;\n+    query?: never;\n+    url: '/api/preview/test-pr';\n+};\n+\n+export type PostApiPreviewTestPrErrors = {\n+    /**\n+     * Bad request\n+     */\n+    400: unknown;\n+    /**\n+     * Unauthorized\n+     */\n+    401: unknown;\n+    /**\n+     * Internal server error\n+     */\n+    500: unknown;\n+};\n+\n+export type PostApiPreviewTestPrResponses = {\n+    /**\n+     * Test PR created\n+     */\n+    200: CreateTestPrResponse;\n+};\n+\n+export type PostApiPreviewTestPrResponse = PostApiPreviewTestPrResponses[keyof PostApiPreviewTestPrResponses];\n+\n export type ClientOptions = {\n     baseUrl: `${string}://${string}` | (string & {});\n };\n\\ No newline at end of file\n","comments":[{"type":"issue_comment","id":3604157200,"prNumber":1106,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\nCaptured 7 screenshots for commit `d3bdec4` (2025-12-02 22:05:31.869 UTC).\n\n**Framework Preset dropdown expanded showing all available framework options (Other, Next.js, Vite, Remix, Nuxt, SvelteKit, Angular, Create React App, Vue)**\n\n![framework-preset-dropdown-open.png](https://famous-camel-162.convex.cloud/api/storage/3ee3ea09-98b1-449e-9dbb-9e0020b01c5d)\n\n**Complete preview configuration page with Framework Preset selected and all configuration sections visible**\n\n![preview-configure-all-sections-expanded.png](https://famous-camel-162.convex.cloud/api/storage/2ad9e3a0-930d-454d-9a61-60d6ceda46bc)\n\n**Preview configuration page - All sections expanded showing maintenance script, dev script, and environment variables input fields**\n\n![preview-configure-expanded-sections.png](https://famous-camel-162.convex.cloud/api/storage/1e9b0772-4385-4905-ab16-a8115b00868b)\n\n**Preview configuration page - Initial collapsed view showing Framework Preset selector and collapsible sections for Maintenance/Dev Scripts and Environment Variables**\n\n![preview-configure-initial-view.png](https://famous-camel-162.convex.cloud/api/storage/71b22205-93e0-40bd-af4b-df26f58095fa)\n\n**NEW: Preview Environment Success page showing confirmation message with 'What happens next?' section and the new 'Test your configuration' feature with 'Create Test PR' button**\n\n![preview-configure-success-page.png](https://famous-camel-162.convex.cloud/api/storage/8c5d3dc1-2b32-43d4-b42f-f886b7a38b77)\n\n**Success page after test PR creation showing green success message 'Test PR created successfully!' with 'View Pull Request' button to navigate to the created GitHub PR**\n\n![preview-success-with-pr-created.png](https://famous-camel-162.convex.cloud/api/storage/4e04d259-754c-47de-98be-41cfc66153c6)\n\n**Closeup of the new 'Test your configuration' section with blue background highlighting the 'Create Test PR' button that allows users to verify their preview setup**\n\n![test-pr-section-highlight.png](https://famous-camel-162.convex.cloud/api/storage/8feee32f-b341-42d8-869d-ab825a546af8)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"3096c16920f511fc3b8e880c147707c0543fba97","createdAt":"2025-12-02T22:05:34Z","updatedAt":"2025-12-02T22:47:02Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1106#issuecomment-3604157200"},{"type":"issue_comment","id":3604263347,"prNumber":1106,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7akhwgbg3yy77wqwp4jfx0es7whxff?src=preview.new) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/austin-dev/task/kn7akhwgbg3yy77wqwp4jfx0es7whxff/browser?src=preview.new) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1106?src=preview.new)\n\nCaptured 4 screenshots for commit `c09f00b` (2025-12-02 22:47:00.043 UTC).\n\n**Full page view of the Preview Environment Configured success page showing the new 'Test your configuration' section with 'Create Test PR' button**\n\n![preview-success-page-full.png](https://famous-camel-162.convex.cloud/api/storage/18844f21-b64f-4dc9-809b-71180c9b19ef)\n\n**The 'Create Test PR' button in loading state showing spinner and 'Creating test PR...' text**\n\n![test-pr-loading-state.png](https://famous-camel-162.convex.cloud/api/storage/70620ef5-ac28-47b1-ad38-490d1d1756c7)\n\n**Focused view of the new 'Test your configuration' section with the green 'Create Test PR' button in default state**\n\n![test-pr-section-focused.png](https://famous-camel-162.convex.cloud/api/storage/a89949a9-b1fe-4a07-ac43-165af90d31c9)\n\n**Success state after PR creation showing green success message and 'View Pull Request' button**\n\n![test-pr-success-state.png](https://famous-camel-162.convex.cloud/api/storage/02fb59b5-d0fa-4d8a-833e-854b3bed8b6f)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"3096c16920f511fc3b8e880c147707c0543fba97","createdAt":"2025-12-02T22:47:01Z","updatedAt":"2025-12-02T22:50:04Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1106#issuecomment-3604263347"},{"type":"issue_comment","id":3604269870,"prNumber":1106,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn79y3d0h53vmxq8p968wyk4d97wg2j4?src=preview.new) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn79y3d0h53vmxq8p968wyk4d97wg2j4/browser?src=preview.new) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1106?src=preview.new)\n\nCaptured 8 screenshots for commit `c09f00b` (2025-12-02 22:50:02.729 UTC).\n\n**Context screenshot - main preview configuration page showing the overall application UI**\n\n![preview-main-page.png](https://adorable-wombat-701.convex.cloud/api/storage/b1c6dd48-b9d6-404a-80ac-41475bec4ac3)\n\n**Preview environment configured success page - initial state with 'Create Test PR' button (dark mode)**\n\n![success-page-dark-mode.png](https://adorable-wombat-701.convex.cloud/api/storage/be79ba6a-a58b-4805-a7b1-a07ab3f31d1a)\n\n**Preview environment configured success page - initial state with 'Create Test PR' button (light mode)**\n\n![success-page-initial-state.png](https://adorable-wombat-701.convex.cloud/api/storage/ab12a870-2102-497d-b934-f3f707434b56)\n\n**Loading state shown when user clicks 'Create Test PR' button**\n\n![success-page-loading-state.png](https://adorable-wombat-701.convex.cloud/api/storage/51fa9960-f200-408c-b704-684109fe339d)\n\n**Success page after test PR is created with success message and 'View Pull Request' button (dark mode)**\n\n![success-page-pr-created-dark-mode.png](https://adorable-wombat-701.convex.cloud/api/storage/282bef0f-de1e-443e-ad91-639bf1d587ff)\n\n**Success page after test PR is created, showing success message and 'View Pull Request' button (light mode)**\n\n![success-page-pr-created-state.png](https://adorable-wombat-701.convex.cloud/api/storage/905d2b9c-9db4-4ec1-a7f3-3e31fbcf0c1a)\n\n**Close-up of the new 'Test your configuration' section with 'Create Test PR' button**\n\n![test-configuration-section-initial.png](https://adorable-wombat-701.convex.cloud/api/storage/a0e788c9-1fe5-4313-9636-d0acb28e38b0)\n\n**Close-up of the 'Test your configuration' section after PR creation, showing success alert and 'View Pull Request' button**\n\n![test-configuration-section-success.png](https://adorable-wombat-701.convex.cloud/api/storage/e58534fc-19ca-4758-b90e-2224269389ed)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"3096c16920f511fc3b8e880c147707c0543fba97","createdAt":"2025-12-02T22:50:04Z","updatedAt":"2025-12-02T23:24:45Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1106#issuecomment-3604269870"},{"type":"issue_comment","id":3604370946,"prNumber":1106,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n[Open Workspace (1 hr expiry)](https://cmux.sh/manaflow/task/kn7ey62mec56g7cnvhxz65nyrd7whnaj?src=preview.new) · [Open Dev Browser (1 hr expiry)](https://cmux.sh/manaflow/task/kn7ey62mec56g7cnvhxz65nyrd7whnaj/browser?src=preview.new) · [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1106?src=preview.new)\n\nCaptured 6 screenshots for commit `742048f` (2025-12-02 23:24:43.321 UTC).\n\n**Preview configure page - full view of the configuration interface**\n\n![preview-configure-page-full.png](https://adorable-wombat-701.convex.cloud/api/storage/57e67817-855e-4741-a740-ea6b53ec13f4)\n\n**Preview dashboard page showing configured repositories and setup interface**\n\n![preview-dashboard-page.png](https://adorable-wombat-701.convex.cloud/api/storage/f5914d3a-8984-479a-ba63-5af36903790b)\n\n**Success page AFTER changes - Create Test PR button with neutral/black styling (main UI change)**\n\n![success-page-new-button-styling.png](https://adorable-wombat-701.convex.cloud/api/storage/d3d5072c-1895-460e-b0e0-5f7327073ee7)\n\n**Success page BEFORE changes - Create Test PR button with emerald/green styling**\n\n![success-page-old-button-styling.png](https://adorable-wombat-701.convex.cloud/api/storage/67ee5694-4386-4e51-98c4-eb2a1c210d5e)\n\n**Test PR preview page AFTER changes - modern dark design with cmux branding and CTA button**\n\n![test-preview-page-new-design.png](https://adorable-wombat-701.convex.cloud/api/storage/06b2a27d-730c-45f7-b7da-c2a105f1ac7b)\n\n**Test PR preview page BEFORE changes - card-based design with purple gradient background**\n\n![test-preview-page-old-design.png](https://adorable-wombat-701.convex.cloud/api/storage/ce909bbf-27b4-4ad2-b0ef-53e0e874db20)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"3096c16920f511fc3b8e880c147707c0543fba97","createdAt":"2025-12-02T23:24:44Z","updatedAt":"2025-12-02T23:57:36Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1106#issuecomment-3604370946"},{"type":"issue_comment","id":3604438180,"prNumber":1106,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n\n\nCaptured 8 screenshots for commit `3096c16` (2025-12-02 23:57:32.994 UTC).\n\n**Full page view of the preview configure success page in light mode, showing the new 'Test your configuration' section with the 'Create Test PR' button**\n\n![preview-configure-success-full-page.png](https://famous-camel-162.convex.cloud/api/storage/4362d32a-6f29-434e-8323-1006d3b6be68)\n\n**Viewport screenshot of the preview configure success page showing the success header, 'What happens next?' section, and the new 'Test your configuration' section**\n\n![preview-configure-success-viewport.png](https://famous-camel-162.convex.cloud/api/storage/f0c05c09-f700-49b9-95f9-00147464278f)\n\n**Screenshot after attempting to click the 'Create Test PR' button (initial state)**\n\n![preview-success-after-button-click.png](https://famous-camel-162.convex.cloud/api/storage/6fff9aa9-bda7-40d2-b545-f7ac127c5143)\n\n**Error state showing the red error message box when PR creation fails**\n\n![preview-success-error-state.png](https://famous-camel-162.convex.cloud/api/storage/c37dc6ad-2ece-4a6d-be91-a4a60f27fa90)\n\n**Initial state of the preview configure success page in dark mode with the 'Create Test PR' button**\n\n![preview-success-initial-dark-mode.png](https://famous-camel-162.convex.cloud/api/storage/3932424c-e818-40fd-bd48-7b070423704e)\n\n**Success state in dark mode showing the green success message and 'View Pull Request' button with dark theme styling**\n\n![preview-success-pr-created-dark-mode.png](https://famous-camel-162.convex.cloud/api/storage/7e37e9e9-6ef6-40ba-837b-92cfd5a55dbc)\n\n**Full page view of the success state showing the complete flow after a test PR is created**\n\n![preview-success-pr-created-full-page.png](https://famous-camel-162.convex.cloud/api/storage/4d0cb805-5e34-4879-a298-a334642f5a33)\n\n**Success state in light mode showing the green success message 'Test PR created successfully!' and 'View Pull Request' button**\n\n![preview-success-pr-created-state.png](https://famous-camel-162.convex.cloud/api/storage/f83c7e0c-cc61-48b5-acf5-8ddc83fad5fd)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"3096c16920f511fc3b8e880c147707c0543fba97","createdAt":"2025-12-02T23:57:35Z","updatedAt":"2025-12-02T23:57:35Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1106#issuecomment-3604438180"}]}
{"number":1105,"title":"Add vim keybindings, git-delta, command palette synonyms, and improve pane focus","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1105","headRef":"sandbox-ux-improvements","headSha":"5df8460e499190885ebcf1ea11167436e2dbedb8","baseRef":"main","baseSha":"ff5da743649ff957849d5f6339e1c7a8a03636c4","createdAt":"2025-12-02T21:42:02Z","updatedAt":"2025-12-02T22:17:39Z","diff":"diff --git a/packages/sandbox/Dockerfile b/packages/sandbox/Dockerfile\nindex 11e5872cf..06447cdd1 100644\n--- a/packages/sandbox/Dockerfile\n+++ b/packages/sandbox/Dockerfile\n@@ -219,6 +219,19 @@ RUN bun add -g \\\n   fi && \\\n   rm -rf /root/.bun/install/cache\n \n+# Install git-delta for better git diffs\n+RUN arch=\"$(uname -m)\"; \\\n+  case \"$arch\" in \\\n+    x86_64) delta_arch=\"x86_64-unknown-linux-gnu\" ;; \\\n+    aarch64) delta_arch=\"aarch64-unknown-linux-gnu\" ;; \\\n+    *) echo \"Unsupported architecture: ${arch}\" >&2; exit 1 ;; \\\n+  esac; \\\n+  DELTA_VERSION=\"0.18.2\"; \\\n+  curl -fsSL \"https://github.com/dandavison/delta/releases/download/${DELTA_VERSION}/delta-${DELTA_VERSION}-${delta_arch}.tar.gz\" | tar -xz -C /tmp && \\\n+  mv /tmp/delta-${DELTA_VERSION}-${delta_arch}/delta /usr/local/bin/delta && \\\n+  rm -rf /tmp/delta-* && \\\n+  chmod +x /usr/local/bin/delta\n+\n RUN curl -LsSf https://astral.sh/uv/install.sh | sh && \\\n   mv /root/.local/bin/uv /usr/local/bin/uv && \\\n   rm -rf /root/.local\ndiff --git a/packages/sandbox/src/bubblewrap.rs b/packages/sandbox/src/bubblewrap.rs\nindex 6c088006e..4f143713c 100644\n--- a/packages/sandbox/src/bubblewrap.rs\n+++ b/packages/sandbox/src/bubblewrap.rs\n@@ -477,6 +477,20 @@ fi\n         let gitconfig = root_home.join(\".gitconfig\");\n         let content = r#\"[safe]\n \tdirectory = *\n+\n+[core]\n+\tpager = delta\n+\n+[interactive]\n+\tdiffFilter = delta --color-only\n+\n+[delta]\n+\tnavigate = true\n+\tline-numbers = true\n+\tside-by-side = false\n+\n+[merge]\n+\tconflictStyle = zdiff3\n \"#;\n         fs::write(&gitconfig, content).await?;\n         Ok(())\n@@ -853,6 +867,7 @@ fi\n \n         let mut cmd = CommandBuilder::new(&self.nsenter_path);\n         cmd.args(nsenter_args(inner_pid, None, &command));\n+        cmd.env(\"HOME\", \"/root\");\n         cmd.env(\"TERM\", \"xterm-256color\");\n         cmd.env(\"COLORTERM\", \"truecolor\"); // Enable 24-bit RGB color support\n         cmd.env(\"LANG\", \"C.UTF-8\");\n@@ -1386,6 +1401,7 @@ impl SandboxService for BubblewrapService {\n         let mut cmd = CommandBuilder::new(&self.nsenter_path);\n \n         cmd.args(nsenter_args(entry.inner_pid, None, &target_command));\n+        cmd.env(\"HOME\", \"/root\");\n         cmd.env(\"TERM\", \"xterm-256color\");\n         cmd.env(\"COLORTERM\", \"truecolor\"); // Enable 24-bit RGB color support\n         cmd.env(\"LANG\", \"C.UTF-8\");\ndiff --git a/packages/sandbox/src/mux/commands.rs b/packages/sandbox/src/mux/commands.rs\nindex 72309e5f8..fcf250483 100644\n--- a/packages/sandbox/src/mux/commands.rs\n+++ b/packages/sandbox/src/mux/commands.rs\n@@ -216,6 +216,38 @@ impl MuxCommand {\n         }\n     }\n \n+    /// Returns synonyms/alternative search terms for the command.\n+    /// These help users find commands when they use different terminology.\n+    pub fn synonyms(&self) -> &'static [&'static str] {\n+        match self {\n+            MuxCommand::ClosePane => &[\"delete\", \"remove\", \"kill\", \"destroy\", \"close\"],\n+            MuxCommand::CloseTab => &[\"delete\", \"remove\", \"kill\", \"destroy\", \"close\"],\n+            MuxCommand::SplitHorizontal => &[\"divide\", \"new pane\", \"hsplit\"],\n+            MuxCommand::SplitVertical => &[\"divide\", \"new pane\", \"vsplit\"],\n+            MuxCommand::ToggleZoom => &[\"maximize\", \"fullscreen\", \"expand\"],\n+            MuxCommand::FocusLeft => &[\"move left\", \"navigate left\", \"go left\"],\n+            MuxCommand::FocusRight => &[\"move right\", \"navigate right\", \"go right\"],\n+            MuxCommand::FocusUp => &[\"move up\", \"navigate up\", \"go up\"],\n+            MuxCommand::FocusDown => &[\"move down\", \"navigate down\", \"go down\"],\n+            MuxCommand::NewTab => &[\"create tab\", \"add tab\", \"open tab\"],\n+            MuxCommand::NewSandbox => &[\"create sandbox\", \"add sandbox\"],\n+            MuxCommand::DeleteSandbox => &[\"remove sandbox\", \"destroy sandbox\", \"kill sandbox\"],\n+            MuxCommand::OpenCommandPalette => &[\"search\", \"find command\", \"quick open\"],\n+            MuxCommand::ToggleHelp => {\n+                &[\"shortcuts\", \"keybindings\", \"keyboard shortcuts\", \"hotkeys\"]\n+            }\n+            MuxCommand::Quit => &[\"exit\", \"close\", \"terminate\"],\n+            MuxCommand::RenameTab => &[\"edit tab name\", \"change tab name\"],\n+            MuxCommand::ToggleSidebar => &[\"show sidebar\", \"hide sidebar\", \"sidebar\"],\n+            MuxCommand::RefreshSandboxes => &[\"reload\", \"update sandboxes\"],\n+            MuxCommand::ScrollPageUp => &[\"page up\", \"scroll up fast\"],\n+            MuxCommand::ScrollPageDown => &[\"page down\", \"scroll down fast\"],\n+            MuxCommand::ScrollToTop => &[\"beginning\", \"start\", \"top\"],\n+            MuxCommand::ScrollToBottom => &[\"end\", \"bottom\"],\n+            _ => &[],\n+        }\n+    }\n+\n     /// Returns a description of what the command does.\n     pub fn description(&self) -> &'static str {\n         match self {\n@@ -392,7 +424,7 @@ impl MuxCommand {\n             // Pane management - use Alt for pane operations\n             MuxCommand::SplitHorizontal => Some((KeyModifiers::ALT, KeyCode::Char('-'))),\n             MuxCommand::SplitVertical => Some((KeyModifiers::ALT, KeyCode::Char('\\\\'))),\n-            MuxCommand::ClosePane => Some((KeyModifiers::ALT, KeyCode::Char('x'))),\n+            MuxCommand::ClosePane => Some((KeyModifiers::ALT, KeyCode::Char('w'))),\n             MuxCommand::ToggleZoom => Some((KeyModifiers::ALT, KeyCode::Char('z'))),\n \n             // Swap panes\n@@ -421,7 +453,9 @@ impl MuxCommand {\n \n             // Tab management - all Alt-based\n             MuxCommand::NewTab => Some((KeyModifiers::ALT, KeyCode::Char('t'))),\n-            MuxCommand::CloseTab => Some((KeyModifiers::ALT, KeyCode::Char('w'))),\n+            MuxCommand::CloseTab => {\n+                Some((KeyModifiers::ALT | KeyModifiers::SHIFT, KeyCode::Char('W')))\n+            }\n             MuxCommand::RenameTab => Some((KeyModifiers::ALT, KeyCode::Char('r'))),\n             MuxCommand::MoveTabLeft => {\n                 Some((KeyModifiers::ALT | KeyModifiers::SHIFT, KeyCode::Char('[')))\n@@ -493,6 +527,13 @@ impl MuxCommand {\n         let description_match = smart_match(trimmed, self.description());\n         let category_match = smart_match(trimmed, self.category());\n \n+        // Also match against synonyms\n+        let synonym_match = self\n+            .synonyms()\n+            .iter()\n+            .filter_map(|synonym| smart_match(trimmed, synonym))\n+            .max_by_key(|m| m.score);\n+\n         let mut best_score: Option<i64> = None;\n \n         if let Some(m) = &label_match {\n@@ -513,6 +554,14 @@ impl MuxCommand {\n             }\n         }\n \n+        // Synonyms get a bonus slightly below description matches\n+        if let Some(m) = synonym_match {\n+            let weighted = m.score + 80;\n+            if best_score.is_none_or(|s| weighted > s) {\n+                best_score = Some(weighted);\n+            }\n+        }\n+\n         let score = best_score?;\n         let label_indices = label_match.map(|m| m.indices).unwrap_or_default();\n \n@@ -534,6 +583,33 @@ impl MuxCommand {\n             if keycode == KeyCode::Char('}') {\n                 return Some(MuxCommand::NextSandbox);\n             }\n+\n+            // Vim-style pane navigation with Alt+hjkl (in addition to Alt+arrows)\n+            match keycode {\n+                KeyCode::Char('h') => return Some(MuxCommand::FocusLeft),\n+                KeyCode::Char('j') => return Some(MuxCommand::FocusDown),\n+                KeyCode::Char('k') => return Some(MuxCommand::FocusUp),\n+                KeyCode::Char('l') => return Some(MuxCommand::FocusRight),\n+                _ => {}\n+            }\n+\n+            // Alt+Shift+hjkl for swap pane (vim-style, in addition to Alt+Shift+arrows)\n+            if modifiers.contains(KeyModifiers::SHIFT) {\n+                match keycode {\n+                    KeyCode::Char('H') => return Some(MuxCommand::SwapPaneLeft),\n+                    KeyCode::Char('J') => return Some(MuxCommand::SwapPaneDown),\n+                    KeyCode::Char('K') => return Some(MuxCommand::SwapPaneUp),\n+                    KeyCode::Char('L') => return Some(MuxCommand::SwapPaneRight),\n+                    _ => {}\n+                }\n+            }\n+\n+            // Alt+d for vertical split, Alt+D (Alt+Shift+d) for horizontal split\n+            match keycode {\n+                KeyCode::Char('d') => return Some(MuxCommand::SplitVertical),\n+                KeyCode::Char('D') => return Some(MuxCommand::SplitHorizontal),\n+                _ => {}\n+            }\n         }\n \n         for cmd in Self::all() {\n@@ -571,6 +647,10 @@ impl PaletteCommand for MuxCommand {\n     fn is_current(&self) -> bool {\n         false\n     }\n+\n+    fn synonyms(&self) -> &[&str] {\n+        MuxCommand::synonyms(self)\n+    }\n }\n \n /// Format a keybinding as a human-readable string.\n@@ -840,4 +920,54 @@ mod tests {\n         let sidebar_toggle = MuxCommand::from_key(KeyModifiers::ALT, KeyCode::Char('s'));\n         assert_eq!(sidebar_toggle, Some(MuxCommand::ToggleSidebar));\n     }\n+\n+    #[test]\n+    fn vim_style_navigation_works() {\n+        // Alt+hjkl for pane navigation\n+        assert_eq!(\n+            MuxCommand::from_key(KeyModifiers::ALT, KeyCode::Char('h')),\n+            Some(MuxCommand::FocusLeft)\n+        );\n+        assert_eq!(\n+            MuxCommand::from_key(KeyModifiers::ALT, KeyCode::Char('j')),\n+            Some(MuxCommand::FocusDown)\n+        );\n+        assert_eq!(\n+            MuxCommand::from_key(KeyModifiers::ALT, KeyCode::Char('k')),\n+            Some(MuxCommand::FocusUp)\n+        );\n+        assert_eq!(\n+            MuxCommand::from_key(KeyModifiers::ALT, KeyCode::Char('l')),\n+            Some(MuxCommand::FocusRight)\n+        );\n+\n+        // Alt+d for vertical split, Alt+D (shift) for horizontal split\n+        assert_eq!(\n+            MuxCommand::from_key(KeyModifiers::ALT, KeyCode::Char('d')),\n+            Some(MuxCommand::SplitVertical)\n+        );\n+        assert_eq!(\n+            MuxCommand::from_key(KeyModifiers::ALT, KeyCode::Char('D')),\n+            Some(MuxCommand::SplitHorizontal)\n+        );\n+    }\n+\n+    #[test]\n+    fn synonym_matching_works() {\n+        // \"delete\" should match ClosePane and CloseTab via synonyms\n+        assert!(MuxCommand::ClosePane.matches(\"delete\"));\n+        assert!(MuxCommand::CloseTab.matches(\"delete\"));\n+\n+        // \"kill\" should also match\n+        assert!(MuxCommand::ClosePane.matches(\"kill\"));\n+\n+        // \"maximize\" should match ToggleZoom\n+        assert!(MuxCommand::ToggleZoom.matches(\"maximize\"));\n+\n+        // \"exit\" should match Quit\n+        assert!(MuxCommand::Quit.matches(\"exit\"));\n+\n+        // \"shortcuts\" should match ToggleHelp\n+        assert!(MuxCommand::ToggleHelp.matches(\"shortcuts\"));\n+    }\n }\ndiff --git a/packages/sandbox/src/mux/layout.rs b/packages/sandbox/src/mux/layout.rs\nindex ac08bd675..0f3311cef 100644\n--- a/packages/sandbox/src/mux/layout.rs\n+++ b/packages/sandbox/src/mux/layout.rs\n@@ -323,6 +323,36 @@ impl LayoutNode {\n         }\n     }\n \n+    /// Find the sibling pane that would take focus when the given pane is closed.\n+    /// Returns the first pane ID from the sibling subtree in the split.\n+    pub fn find_sibling(&self, id: PaneId) -> Option<PaneId> {\n+        match self {\n+            LayoutNode::Pane(_) => None,\n+            LayoutNode::Split { first, second, .. } => {\n+                let first_contains = first.contains_pane(id);\n+                let second_contains = second.contains_pane(id);\n+\n+                if first_contains && first.pane_count() == 1 {\n+                    // Pane is directly in first, sibling is in second\n+                    // Return the first pane in the sibling (topmost/leftmost)\n+                    second.pane_ids().first().copied()\n+                } else if second_contains && second.pane_count() == 1 {\n+                    // Pane is directly in second, sibling is in first\n+                    // Return the last pane in the sibling (bottommost/rightmost)\n+                    first.pane_ids().last().copied()\n+                } else if first_contains {\n+                    // Recurse into first\n+                    first.find_sibling(id)\n+                } else if second_contains {\n+                    // Recurse into second\n+                    second.find_sibling(id)\n+                } else {\n+                    None\n+                }\n+            }\n+        }\n+    }\n+\n     /// Calculate areas for all panes given a bounding rect.\n     pub fn calculate_areas(&mut self, area: Rect) {\n         match self {\n@@ -547,9 +577,12 @@ impl Tab {\n             return false;\n         };\n \n+        // Find the sibling pane (the one that will take over in the split)\n+        let sibling = self.layout.find_sibling(active_id);\n+\n         if self.layout.remove_pane(active_id) {\n-            // Select a new active pane\n-            self.active_pane = self.layout.pane_ids().first().copied();\n+            // Focus the sibling, or fall back to first available\n+            self.active_pane = sibling.or_else(|| self.layout.pane_ids().first().copied());\n             true\n         } else {\n             false\n@@ -559,15 +592,20 @@ impl Tab {\n     /// Remove a specific pane by ID, updating the active pane if needed.\n     pub fn remove_pane_by_id(&mut self, pane_id: PaneId) -> bool {\n         let was_active = self.active_pane == Some(pane_id);\n+\n+        // Find the sibling pane (the one that will take over in the split)\n+        let sibling = self.layout.find_sibling(pane_id);\n+\n         if !self.layout.remove_pane(pane_id) {\n             return false;\n         }\n \n         if was_active || self.active_pane.is_none() {\n-            self.active_pane = self.layout.pane_ids().first().copied();\n+            // Focus the sibling, or fall back to first available\n+            self.active_pane = sibling.or_else(|| self.layout.pane_ids().first().copied());\n         } else if let Some(active) = self.active_pane {\n             if !self.contains_pane(active) {\n-                self.active_pane = self.layout.pane_ids().first().copied();\n+                self.active_pane = sibling.or_else(|| self.layout.pane_ids().first().copied());\n             }\n         }\n \ndiff --git a/packages/sandbox/src/palette.rs b/packages/sandbox/src/palette.rs\nindex 2da6757aa..fa1995979 100644\n--- a/packages/sandbox/src/palette.rs\n+++ b/packages/sandbox/src/palette.rs\n@@ -36,6 +36,12 @@ pub trait PaletteCommand: Clone + Copy + PartialEq {\n     fn is_current(&self) -> bool {\n         false\n     }\n+\n+    /// Optional synonyms/alternative search terms for the command.\n+    /// These help users find commands when they use different terminology.\n+    fn synonyms(&self) -> &[&str] {\n+        &[]\n+    }\n }\n \n /// Result of fuzzy matching a command.\n@@ -376,11 +382,18 @@ pub fn fuzzy_match<C: PaletteCommand>(command: &C, query: &str) -> Option<Comman\n         .description()\n         .map(|d| normalize_whitespace(d).to_lowercase());\n \n-    // 1. Substring match\n+    // Check if any synonym matches\n+    let synonym_match = command.synonyms().iter().any(|syn| {\n+        let syn_lower = normalize_whitespace(syn).to_lowercase();\n+        syn_lower.contains(&query_lower) || query_lower.contains(&syn_lower)\n+    });\n+\n+    // 1. Substring match (label, description, or synonym)\n     if label_lower.contains(&query_lower)\n         || desc_lower\n             .as_ref()\n             .is_some_and(|d| d.contains(&query_lower))\n+        || synonym_match\n     {\n         let indices: Vec<usize> = label.char_indices().map(|(idx, _)| idx).collect();\n         return Some(CommandMatch {\ndiff --git a/packages/sandbox/todos.md b/packages/sandbox/todos.md\nindex 1b9d6775d..1a7a7cfee 100644\n--- a/packages/sandbox/todos.md\n+++ b/packages/sandbox/todos.md\n@@ -11,16 +11,16 @@ implement better mouse scrolling behavior in the terminal, similar to how we do\n \n add a command pallete action for opening the sandbox's browser that does the same thing as cmux browser <sandbox-id> (auto infer the active sandbox based on the selected one in the sidebar). also, add a command pallete action for opening in the editor. right below open in editor, we should have set default editor command, which should be configurable to a bash command the user provides, eg. (code, cursor, windsurf, vim, emacs, etc.). open in editor should be alt+e.\n \n-for command pallete actions for deleting focused tab/panel, i got confused since i searched for delete instead of close. can we add potential synonyms to all the keyboard shortcuts so they're more easily searchable?\n+[x] for command pallete actions for deleting focused tab/panel, i got confused since i searched for delete instead of close. can we add potential synonyms to all the keyboard shortcuts so they're more easily searchable?\n \n [x] dont write code yet. research codebase and lmk how many websocket connectsion are made when user runs the `cmux` command and makes a bunch of sandboxes/tabs/panes.\n [x] refactor so each `cmux` command only makes one websocket connection by updating the protocol. implement auto-reconnect with state recovery as well.\n \n-for panes focus up/down/right/left, let's do vim style keyboard shortcuts so we should add alt+hjkl in addition to the existing alt+arrows. we should be able to focus to the sidebar as well with alt+h, and focus to the main area with alt+l. (think about how to make this as intuitive as possible). make sure these shortcuts work in sidebar as well as main area.\n+[x] for panes focus up/down/right/left, let's do vim style keyboard shortcuts so we should add alt+hjkl in addition to the existing alt+arrows. we should be able to focus to the sidebar as well with alt+h, and focus to the main area with alt+l. (think about how to make this as intuitive as possible). make sure these shortcuts work in sidebar as well as main area.\n \n implement text highlighting->copy for each of the virtual terminals (shouldn't copy text outside of the highlighted region, we should see the highlight, as well as a status message like \"copied to clipboard\", highlight bg color should be chosen carefully based on the terminal bg color theme)\n \n-handle alt+d/alt+D to split the focused pane horizontally/vertically. (lowercase for horizontal, uppercase for vertical)\n+[x] handle alt+d/alt+D to split the focused pane horizontally/vertically. (lowercase for horizontal, uppercase for vertical)\n \n [x] after running `cmux` and exiting via ctrl+q, and then i open git diff, pressing \"q\" fails to close the less program\n \n@@ -30,9 +30,9 @@ for the emulated terminal, support option+backspace to delete the prev word (ctr\n \n inside sandboxes, we need to handle open commands and propagate it to the host machine. eg open in browser.\n \n-make sure mouse events can be passed through to the virtual terminal for the `cmux` command.\n-change ctrl+s shortcut to alt+s for sidebar\n-inside sandbox virtual terminal, make links command clickable\n+[x] make sure mouse events can be passed through to the virtual terminal for the `cmux` command.\n+[x] change ctrl+s shortcut to alt+s for sidebar\n+inside sandbox virtual terminal, make links navigatable via command + click\n \n [x] add a REST endpoint that will mark a sandbox+tab pair as \"needs attention\". then go through\n \n@@ -41,7 +41,7 @@ first thing we should implement is to replace open-url.sh with the internal cmux\n \n [x] if we're in dmux, can we render [debug build] in bottom left so it's obvious?\n \n-[] add git-delta and set it as the default pager (git config --global core.pager delta\n+[x] add git-delta and set it as the default pager (git config --global core.pager delta\n git config --global interactive.diffFilter 'delta --color-only'\n git config --global delta.navigate true\n git config --global merge.conflictStyle zdiff3)\n@@ -58,6 +58,10 @@ if user is typing something, we should make sure to scroll it into view iff it's\n \n i want git diff to always use less. rn if diffs fit vertical space, there's no less, and it just prints it.\n \n+instrument how long it takes to make a new sandbox, as well as the bottlenecks. then optimize new sandbox creation. (eg by doing more things in parallel).\n+\n+for virtual terminal, implement text highlighting->copy to clipboard.\n+\n ## dogfood blockers\n \n what's the minimum viable useful version of cmux?\n","comments":[{"type":"issue_comment","id":3604118617,"prNumber":1105,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\nCaptured 9 screenshots for commit `8459b67` (2025-12-02 21:51:58.465 UTC).\n\n**Full configuration page with all sections expanded (Maintenance/Dev Scripts and Environment Variables)**\n\n![configure-page-expanded-full-sandbox-ux-improvements.png](https://famous-camel-162.convex.cloud/api/storage/6252a222-73d3-4e55-b3ae-98240e68d8c3)\n\n**Configuration page viewport with expanded sections showing script inputs and environment variable fields**\n\n![configure-page-expanded-viewport-sandbox-ux-improvements.png](https://famous-camel-162.convex.cloud/api/storage/2ce80c83-9b8a-46f2-948f-f89ea928f8e1)\n\n**Full page view of the project configuration page with framework preset selector**\n\n![configure-page-full-sandbox-ux-improvements.png](https://famous-camel-162.convex.cloud/api/storage/f9c613ec-a59e-4ca9-ae2e-4d1db89b6f57)\n\n**Configuration page showing the new framework preset selector (collapsed state)**\n\n![configure-page-viewport-sandbox-ux-improvements.png](https://famous-camel-162.convex.cloud/api/storage/b9d7b219-ce2f-42d1-a739-7f535c5b397c)\n\n**Framework preset selector dropdown opened, displaying framework options with inline SVG logos (Next.js, Vite, Remix, Nuxt, SvelteKit, Angular, React, Vue)**\n\n![framework-selector-dropdown-open-sandbox-ux-improvements.png](https://famous-camel-162.convex.cloud/api/storage/08af817c-4807-4ab2-a902-7dfa6994ccf3)\n\n**Full page view of the preview landing page showing the updated SVG gradient background (replaces CSS radial-gradient)**\n\n![preview-page-full-sandbox-ux-improvements.png](https://famous-camel-162.convex.cloud/api/storage/db8c6d92-9d13-4447-8626-8cd722e13877)\n\n**Bottom section of preview page showing configured repositories and footer content**\n\n![preview-page-scrolled-bottom-sandbox-ux-improvements.png](https://famous-camel-162.convex.cloud/api/storage/2c07b47e-c559-42f8-b036-1cf0dc04b92f)\n\n**Middle section of preview page showing repository selection and configured repositories**\n\n![preview-page-scrolled-middle-sandbox-ux-improvements.png](https://famous-camel-162.convex.cloud/api/storage/659b17dd-3c61-4c20-9034-30094eec9b02)\n\n**Top viewport of preview landing page showing hero section with new SVG gradient background**\n\n![preview-page-viewport-sandbox-ux-improvements.png](https://famous-camel-162.convex.cloud/api/storage/d4060d3d-521b-4195-a73e-ced3fe2ec1a3)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"5df8460e499190885ebcf1ea11167436e2dbedb8","createdAt":"2025-12-02T21:51:59Z","updatedAt":"2025-12-02T22:17:39Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1105#issuecomment-3604118617"},{"type":"issue_comment","id":3604192731,"prNumber":1105,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n\n\nCaptured 7 screenshots for commit `c867a57` (2025-12-02 22:17:36.455 UTC).\n\n**Repository selector dropdown in open state showing the 'Austin is a Bot' option and configured repositories section**\n\n![framework-selector-open-sandbox-ux-improvements.png](https://famous-camel-162.convex.cloud/api/storage/7dc06a17-beea-440b-9bb7-f16cbf21b149)\n\n**Header section with 'Back to cmux' link showing the improved typography and spacing**\n\n![header-area-sandbox-ux-improvements.png](https://famous-camel-162.convex.cloud/api/storage/c7f139ae-6374-4cbf-817e-2cf371c771b5)\n\n**Input area showing the Git repository URL entry field and Continue button with the improved UI styling**\n\n![input-area-sandbox-ux-improvements.png](https://famous-camel-162.convex.cloud/api/storage/be892328-211e-4000-a76c-d75773b08dcd)\n\n**Full preview page showing the complete UI with the new SVG gradient background, repository selector, and configuration options**\n\n![preview-page-complete-sandbox-ux-improvements.png](https://famous-camel-162.convex.cloud/api/storage/acd03438-f7a0-4a09-9993-05276c417261)\n\n**Full-page screenshot of the preview landing page with improved background gradient and layout**\n\n![preview-page-full-sandbox-ux-improvements.png](https://famous-camel-162.convex.cloud/api/storage/5f48a28c-9763-46dc-adb7-f8abe06934d6)\n\n**Viewport screenshot showing the above-the-fold content with the new SVG-based radial gradient background**\n\n![preview-page-viewport-sandbox-ux-improvements.png](https://famous-camel-162.convex.cloud/api/storage/0f877221-a540-4197-8239-55b23bc85cca)\n\n**Close-up of the header area showing the new SVG radial gradient background (blue glow effect) that replaced the CSS gradient**\n\n![svg-background-gradient-sandbox-ux-improvements.png](https://famous-camel-162.convex.cloud/api/storage/bcf3ddca-777d-46f3-93fa-28e20e01caab)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"5df8460e499190885ebcf1ea11167436e2dbedb8","createdAt":"2025-12-02T22:17:38Z","updatedAt":"2025-12-02T22:17:38Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1105#issuecomment-3604192731"}]}
{"number":1102,"title":"Always enable Next and load until sandbox ready","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1102","headRef":"cmux/always-enable-next-and-load-until-sandbox-ready-o9331","headSha":"9eeac2c83815ae53da71f3eee68681fd2995e544","baseRef":"main","baseSha":"0b4c2149ea38be0969c2c2e78623a7ff6e5122e5","createdAt":"2025-12-02T20:55:51Z","updatedAt":"2025-12-02T21:12:38Z","diff":"diff --git a/apps/www/components/preview/preview-configure-client.tsx b/apps/www/components/preview/preview-configure-client.tsx\nindex f11a7826c..ddb88f8dc 100644\n--- a/apps/www/components/preview/preview-configure-client.tsx\n+++ b/apps/www/components/preview/preview-configure-client.tsx\n@@ -426,6 +426,7 @@ export function PreviewConfigureClient({\n   const [devScript, setDevScript] = useState(initialDevScriptValue);\n   const [hasUserEditedScripts, setHasUserEditedScripts] = useState(false);\n   const [hasCompletedSetup, setHasCompletedSetup] = useState(false);\n+  const [isWaitingForWorkspace, setIsWaitingForWorkspace] = useState(false);\n   const [isEnvOpen, setIsEnvOpen] = useState(false);\n   const [isBuildOpen, setIsBuildOpen] = useState(false);\n   const [envNone, setEnvNone] = useState(false);\n@@ -518,13 +519,15 @@ export function PreviewConfigureClient({\n             title: instance?.instanceId\n               ? \"Waiting for VS Code\"\n               : \"VS Code workspace not ready\",\n-            description: instance?.instanceId\n-              ? \"The editor opens automatically once the environment finishes booting.\"\n-              : \"Provisioning the workspace. We'll open VS Code as soon as it's ready.\",\n-          },\n+              description: instance?.instanceId\n+                ? \"The editor opens automatically once the environment finishes booting.\"\n+                : \"Provisioning the workspace. We'll open VS Code as soon as it's ready.\",\n+            },\n     [instance?.instanceId, instance?.vscodeUrl]\n   );\n \n+  const isWorkspaceReady = Boolean(instance?.vscodeUrl);\n+\n   const hasEnvValues = useMemo(\n     () =>\n       (!hasTouchedEnvVars && initialEnvPrefilled) ||\n@@ -550,20 +553,30 @@ export function PreviewConfigureClient({\n     envSectionCollapsedOnEnterRef.current = true;\n   }, [envDone, hasCompletedSetup]);\n \n-  // Auto-enter configuration once VS Code is available when resuming an existing environment\n   useEffect(() => {\n     if (\n-      startAtConfigureEnvironment &&\n-      instance?.vscodeUrl &&\n+      (startAtConfigureEnvironment || isWaitingForWorkspace) &&\n+      isWorkspaceReady &&\n       !hasCompletedSetup\n     ) {\n       setHasCompletedSetup(true);\n+      setIsWaitingForWorkspace(false);\n     }\n-  }, [hasCompletedSetup, instance?.vscodeUrl, startAtConfigureEnvironment]);\n+  }, [\n+    hasCompletedSetup,\n+    isWaitingForWorkspace,\n+    isWorkspaceReady,\n+    startAtConfigureEnvironment,\n+  ]);\n \n   const handleEnterConfigureEnvironment = useCallback(() => {\n-    setHasCompletedSetup(true);\n-  }, []);\n+    if (isWorkspaceReady) {\n+      setHasCompletedSetup(true);\n+      setIsWaitingForWorkspace(false);\n+      return;\n+    }\n+    setIsWaitingForWorkspace(true);\n+  }, [isWorkspaceReady]);\n \n   const browserPlaceholder = useMemo(\n     () =>\n@@ -1025,20 +1038,26 @@ export function PreviewConfigureClient({\n \n   // Show setup screen while provisioning OR until user clicks Next\n   if (!hasCompletedSetup) {\n-    const isWorkspaceReady = Boolean(instance?.vscodeUrl);\n+    const shouldShowWorkspaceLoader =\n+      (startAtConfigureEnvironment || isWaitingForWorkspace) && !isWorkspaceReady;\n+\n+    if (shouldShowWorkspaceLoader) {\n+      const loaderTitle = startAtConfigureEnvironment\n+        ? \"Resuming your VS Code workspace...\"\n+        : \"Starting your VS Code workspace...\";\n+      const loaderDescription = startAtConfigureEnvironment\n+        ? \"We'll show the configuration form once your environment is ready.\"\n+        : \"We'll open the configuration as soon as the sandbox is ready.\";\n \n-    // When editing an existing environment, show loader until VS Code is ready\n-    if (startAtConfigureEnvironment && !isWorkspaceReady) {\n       return (\n         <div className=\"flex min-h-dvh items-center justify-center bg-white dark:bg-black font-sans\">\n           <div className=\"text-center px-6\">\n             <Loader2 className=\"mx-auto h-8 w-8 animate-spin text-neutral-400\" />\n             <h1 className=\"mt-4 text-lg font-medium text-neutral-900 dark:text-neutral-100\">\n-              Resuming your VS Code workspace...\n+              {loaderTitle}\n             </h1>\n             <p className=\"mt-2 text-sm text-neutral-500 dark:text-neutral-400\">\n-              We&apos;ll show the configuration form once your environment is\n-              ready.\n+              {loaderDescription}\n             </p>\n           </div>\n         </div>\n@@ -1339,13 +1358,11 @@ export function PreviewConfigureClient({\n             <div className=\"flex items-center justify-end gap-4\">\n               <button\n                 type=\"button\"\n-                disabled={!isWorkspaceReady}\n                 onClick={handleEnterConfigureEnvironment}\n                 className={clsx(\n                   \"inline-flex items-center gap-2 rounded-md px-5 py-2.5 text-sm font-semibold transition\",\n-                  isWorkspaceReady\n-                    ? \"bg-neutral-900 dark:bg-neutral-100 text-white dark:text-neutral-900 hover:bg-neutral-800 dark:hover:bg-neutral-200 cursor-pointer\"\n-                    : \"bg-neutral-900 dark:bg-neutral-100 text-white dark:text-neutral-900 opacity-50 cursor-not-allowed\"\n+                  \"bg-neutral-900 dark:bg-neutral-100 text-white dark:text-neutral-900 hover:bg-neutral-800 dark:hover:bg-neutral-200 cursor-pointer\",\n+                  !isWorkspaceReady && \"opacity-80\"\n                 )}\n               >\n                 Next\n","comments":[{"type":"issue_comment","id":3603948303,"prNumber":1102,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\nCaptured 9 screenshots for commit `d4ba81c` (2025-12-02 21:02:51.428 UTC).\n\n**Full page view of the Configure Project form showing the initial state with Framework Preset selector and collapsed sections. The 'Next' button is visible at the bottom with 'Provisioning workspace...' status.**\n\n![01-configure-project-initial-state.png](https://adorable-wombat-701.convex.cloud/api/storage/c8383e46-6078-4367-8e8e-6a9517788e76)\n\n**Viewport screenshot of the Configure Project page showing the form with the 'Provisioning workspace...' status indicator and enabled 'Next' button.**\n\n![02-configure-project-provisioning-workspace.png](https://adorable-wombat-701.convex.cloud/api/storage/48685d9e-f7e9-4fe9-b03d-2b1c42977c25)\n\n**Close-up of the 'Next' button showing it is enabled even while the workspace is provisioning - this is the key UI change in this PR.**\n\n![03-next-button-enabled-while-provisioning.png](https://adorable-wombat-701.convex.cloud/api/storage/d9ad8b7f-59d5-4819-b562-8f0d6483e297)\n\n**Full page view of the loading screen that appears after clicking 'Next' before the workspace is ready, displaying 'Starting your VS Code workspace...' message.**\n\n![04-loading-screen-after-clicking-next.png](https://adorable-wombat-701.convex.cloud/api/storage/adcc92be-a831-44a4-8856-1662dd18a962)\n\n**Viewport screenshot showing the loading state with spinner and message 'Starting your VS Code workspace...' and 'We'll open the configuration as soon as the sandbox is ready.' - this is the new loading screen behavior.**\n\n![05-starting-workspace-message.png](https://adorable-wombat-701.convex.cloud/api/storage/e3603926-d6b3-4ff3-b6cb-4c6e820c34ef)\n\n**Full page view with the 'Maintenance and Dev Scripts' section expanded, showing textareas for maintenance script and dev script configuration.**\n\n![06-maintenance-and-dev-scripts-section.png](https://adorable-wombat-701.convex.cloud/api/storage/a535762b-33a5-4084-802b-77a2b96238f9)\n\n**Full page view with both 'Maintenance and Dev Scripts' and 'Environment Variables' sections expanded, showing the complete form with input fields for environment variable key-value pairs.**\n\n![07-environment-variables-section.png](https://adorable-wombat-701.convex.cloud/api/storage/c99b00c6-deac-4097-80e6-b754f159f8c6)\n\n**Viewport screenshot showing an error state that occurred during testing.**\n\n![10-full-form-expanded-view.png](https://adorable-wombat-701.convex.cloud/api/storage/8ad93ddb-2a88-4db9-8e07-19818d165704)\n\n**Final full page screenshot of the Configure Project form in its default state with all sections collapsed and the 'Next' button enabled.**\n\n![11-full-page-complete-view.png](https://adorable-wombat-701.convex.cloud/api/storage/099451af-7baf-4ad2-9451-20f96abd279a)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"9eeac2c83815ae53da71f3eee68681fd2995e544","createdAt":"2025-12-02T21:02:52Z","updatedAt":"2025-12-02T21:12:39Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1102#issuecomment-3603948303"},{"type":"issue_comment","id":3603987321,"prNumber":1102,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n\n\nCaptured 9 screenshots for commit `d4ba81c` (2025-12-02 21:12:37.139 UTC).\n\n**Close-up view of framework icons including the newly added Astro framework with its distinctive icon**\n\n![astro-icon-closeup.png](https://famous-camel-162.convex.cloud/api/storage/d5276692-4a99-4691-9840-023024ae5cc9)\n\n**Framework selector dropdown menu showing all frameworks including the newly added Astro with brand-colored SVG icons**\n\n![framework-dropdown-open.png](https://famous-camel-162.convex.cloud/api/storage/f9cb8a92-59b2-4073-ba4c-24a8b2558a93)\n\n**Full page showing all framework icons with new inline SVG implementation in both grid and compact views**\n\n![framework-icons-overview.png](https://famous-camel-162.convex.cloud/api/storage/10348d7f-e380-487a-9832-4ae501c0a49d)\n\n**Framework selector in closed state showing the selected framework with its SVG icon and brand colors**\n\n![framework-selector-closed.png](https://famous-camel-162.convex.cloud/api/storage/1be13daf-61a5-4349-a643-61478c843813)\n\n**Framework selector dropdown with all options visible, highlighting the Astro framework addition**\n\n![framework-selector-open-with-astro.png](https://famous-camel-162.convex.cloud/api/storage/5c2d6007-0f32-4c6f-8090-90ac13ace4bc)\n\n**Complete comparison of Next button behavior before and after the PR, showing the removal of disabled state and new loading screen**\n\n![next-button-changes-full.png](https://famous-camel-162.convex.cloud/api/storage/60733ac3-453c-4cf1-a7ee-3cb1ea6e489a)\n\n**Side-by-side comparison of Next button states and the new loading screen that appears when clicked before workspace is ready**\n\n![next-button-comparison.png](https://famous-camel-162.convex.cloud/api/storage/86e3697b-a4eb-4b41-abd7-32d482d4ae53)\n\n**Hero section showing the PR title and main UI change categories**\n\n![pr-summary-hero.png](https://famous-camel-162.convex.cloud/api/storage/fe0a2398-f141-4575-a3e8-666d38d37750)\n\n**Complete overview of all UI changes in this PR including framework icons, Next button behavior, Astro support, and loading screen**\n\n![pr-summary-overview.png](https://famous-camel-162.convex.cloud/api/storage/451a6e08-0135-4035-b01d-b50e69845500)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"9eeac2c83815ae53da71f3eee68681fd2995e544","createdAt":"2025-12-02T21:12:38Z","updatedAt":"2025-12-02T21:12:38Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1102#issuecomment-3603987321"}]}
{"number":1099,"title":"Migrate repo query to TanStack useQuery","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1099","headRef":"cmux/migrate-repo-query-to-tan-stack-use-query-gxv3m","headSha":"de87e9f4a81d2d170a4c1a48dbd65bbddd3dd6b5","baseRef":"main","baseSha":"f865673c4835b1e3a252c0c1d446c613119ef416","createdAt":"2025-12-02T03:42:23Z","updatedAt":"2025-12-02T20:44:57Z","diff":"diff --git a/apps/www/components/preview/preview-dashboard.tsx b/apps/www/components/preview/preview-dashboard.tsx\nindex 724cd0ea2..d9004533c 100644\n--- a/apps/www/components/preview/preview-dashboard.tsx\n+++ b/apps/www/components/preview/preview-dashboard.tsx\n@@ -17,6 +17,7 @@ import {\n } from \"lucide-react\";\n import Link from \"next/link\";\n import clsx from \"clsx\";\n+import { QueryClient, QueryClientProvider, useQuery } from \"@tanstack/react-query\";\n import { Button } from \"@/components/ui/button\";\n import CmuxLogo from \"@/components/logo/cmux-logo\";\n import {\n@@ -221,7 +222,25 @@ function openCenteredPopup(\n   return window.open(url, name, features);\n }\n \n-export function PreviewDashboard({\n+// Create a stable QueryClient instance for the preview dashboard\n+const queryClient = new QueryClient({\n+  defaultOptions: {\n+    queries: {\n+      staleTime: 30_000,\n+      refetchOnWindowFocus: false,\n+    },\n+  },\n+});\n+\n+export function PreviewDashboard(props: PreviewDashboardProps) {\n+  return (\n+    <QueryClientProvider client={queryClient}>\n+      <PreviewDashboardInner {...props} />\n+    </QueryClientProvider>\n+  );\n+}\n+\n+function PreviewDashboardInner({\n   selectedTeamSlugOrId,\n   teamOptions,\n   providerConnectionsByTeam,\n@@ -241,8 +260,7 @@ export function PreviewDashboard({\n     number | null\n   >(null);\n   const [repoSearch, setRepoSearch] = useState(\"\");\n-  const [repos, setRepos] = useState<RepoSearchResult[]>([]);\n-  const [isLoadingRepos, setIsLoadingRepos] = useState(false);\n+  const [debouncedRepoSearch, setDebouncedRepoSearch] = useState(\"\");\n   const [navigatingRepo, setNavigatingRepo] = useState<string | null>(null);\n   const [configs, setConfigs] =\n     useState<PreviewConfigListItem[]>(previewConfigs);\n@@ -273,6 +291,51 @@ export function PreviewDashboard({\n     Boolean(selectedTeamSlugOrIdState) &&\n     hasGithubAppInstallation;\n \n+  // Debounce search input\n+  useEffect(() => {\n+    const timeoutId = setTimeout(() => {\n+      setDebouncedRepoSearch(repoSearch.trim());\n+    }, 300);\n+    return () => clearTimeout(timeoutId);\n+  }, [repoSearch]);\n+\n+  // Fetch repos using TanStack Query\n+  const reposQuery = useQuery({\n+    queryKey: [\n+      \"github-repos\",\n+      selectedTeamSlugOrIdState,\n+      selectedInstallationId,\n+      debouncedRepoSearch,\n+    ],\n+    queryFn: async ({ signal }) => {\n+      const params = new URLSearchParams({\n+        team: selectedTeamSlugOrIdState,\n+        installationId: String(selectedInstallationId),\n+      });\n+      if (debouncedRepoSearch) {\n+        params.set(\"search\", debouncedRepoSearch);\n+      }\n+      const response = await fetch(\n+        `/api/integrations/github/repos?${params.toString()}`,\n+        { signal }\n+      );\n+      if (!response.ok) {\n+        throw new Error(await response.text());\n+      }\n+      return response.json() as Promise<{ repos: RepoSearchResult[] }>;\n+    },\n+    enabled: canSearchRepos && selectedInstallationId !== null,\n+    staleTime: 30_000,\n+  });\n+\n+  const repos: RepoSearchResult[] = useMemo(() => {\n+    if (!reposQuery.data?.repos) return [];\n+    // When no search, limit to 5 results\n+    return debouncedRepoSearch ? reposQuery.data.repos : reposQuery.data.repos.slice(0, 5);\n+  }, [reposQuery.data?.repos, debouncedRepoSearch]);\n+\n+  const isLoadingRepos = reposQuery.isLoading || reposQuery.isFetching;\n+\n   useEffect(() => {\n     setConfigs(previewConfigs);\n   }, [previewConfigs]);\n@@ -581,95 +644,16 @@ export function PreviewDashboard({\n     }\n   };\n \n-  const fetchRepos = useCallback(\n-    async (searchTerm: string, signal?: AbortSignal) => {\n-      if (!canSearchRepos || selectedInstallationId === null) {\n-        setRepos([]);\n-        return;\n-      }\n-      setIsLoadingRepos(true);\n-      setErrorMessage(null);\n-      try {\n-        const params = new URLSearchParams({\n-          team: selectedTeamSlugOrIdState,\n-          installationId: String(selectedInstallationId),\n-        });\n-        const trimmed = searchTerm.trim();\n-        if (trimmed) {\n-          params.set(\"search\", trimmed);\n-        }\n-        const response = await fetch(\n-          `/api/integrations/github/repos?${params.toString()}`,\n-          {\n-            signal,\n-          }\n-        );\n-        if (!response.ok) {\n-          throw new Error(await response.text());\n-        }\n-        const payload = (await response.json()) as {\n-          repos: RepoSearchResult[];\n-        };\n-        setRepos(trimmed ? payload.repos : payload.repos.slice(0, 5));\n-        setIsLoadingRepos(false);\n-      } catch (err) {\n-        if (err instanceof Error && err.name === \"AbortError\") {\n-          // Request was cancelled, don't update any state\n-          return;\n-        }\n-        const message =\n-          err instanceof Error ? err.message : \"Failed to load repositories\";\n-        console.error(\"[PreviewDashboard] Failed to load repositories\", err);\n-        setErrorMessage(message);\n-        setIsLoadingRepos(false);\n-      }\n-    },\n-    [canSearchRepos, selectedInstallationId, selectedTeamSlugOrIdState]\n-  );\n-\n-  // Debounced search effect with abort controller\n-  useEffect(() => {\n-    if (!canSearchRepos || selectedInstallationId === null) {\n-      setRepos([]);\n-      return;\n-    }\n-\n-    const abortController = new AbortController();\n-    const timeoutId = setTimeout(() => {\n-      void fetchRepos(repoSearch, abortController.signal);\n-    }, 300);\n-\n-    return () => {\n-      clearTimeout(timeoutId);\n-      abortController.abort();\n-    };\n-  }, [repoSearch, canSearchRepos, selectedInstallationId, fetchRepos]);\n-\n-  const handleContinue = useCallback(\n-    (repoName: string) => {\n-      if (!repoName.trim()) return;\n-      setNavigatingRepo(repoName);\n-      const params = new URLSearchParams({\n-        repo: repoName,\n-        installationId: String(selectedInstallationId ?? \"\"),\n-        team: selectedTeamSlugOrIdState,\n-      });\n-      window.location.href = `/preview/configure?${params.toString()}`;\n-    },\n-    [selectedInstallationId, selectedTeamSlugOrIdState]\n-  );\n-\n-  useEffect(() => {\n-    if (selectedInstallationId !== null) {\n-      const abortController = new AbortController();\n-      void fetchRepos(\"\", abortController.signal);\n-      return () => {\n-        abortController.abort();\n-      };\n-    } else {\n-      setRepos([]);\n-    }\n-  }, [selectedInstallationId, fetchRepos]);\n+  const handleContinue = useCallback((repoName: string) => {\n+    if (!repoName.trim()) return;\n+    setNavigatingRepo(repoName);\n+    const params = new URLSearchParams({\n+      repo: repoName,\n+      installationId: String(selectedInstallationId ?? \"\"),\n+      team: selectedTeamSlugOrIdState,\n+    });\n+    window.location.href = `/preview/configure?${params.toString()}`;\n+  }, [selectedInstallationId, selectedTeamSlugOrIdState]);\n \n   useEffect(() => {\n     if (!selectedTeamSlugOrIdState && teamOptions[0]) {\n@@ -806,9 +790,6 @@ export function PreviewDashboard({\n                 void handleInstallGithubApp();\n                 return;\n               }\n-              // Clear repos and show loading state immediately when switching accounts\n-              setRepos([]);\n-              setIsLoadingRepos(true);\n               setSelectedInstallationId(Number(value));\n             }}\n             className=\"h-10 appearance-none bg-transparent py-2 pl-11 pr-8 text-sm text-white focus:outline-none\"\ndiff --git a/apps/www/components/ui/tooltip-base.tsx b/apps/www/components/ui/tooltip-base.tsx\nindex c1c0844b4..2a77237e3 100644\n--- a/apps/www/components/ui/tooltip-base.tsx\n+++ b/apps/www/components/ui/tooltip-base.tsx\n@@ -14,18 +14,30 @@ interface TooltipTriggerProps extends React.ComponentProps<typeof BaseTooltip.Tr\n   delay?: number;\n   closeDelay?: number;\n   delayDuration?: number;\n+  children?: React.ReactNode;\n }\n \n function TooltipTrigger({\n-  asChild: _asChild,\n+  asChild,\n   delayDuration,\n   delay = delayDuration ?? 0,\n   closeDelay,\n   children,\n   ...props\n }: TooltipTriggerProps) {\n+  // Base UI uses `render` prop for composition instead of `asChild`\n+  if (asChild && React.isValidElement(children)) {\n+    return (\n+      <BaseTooltip.Trigger\n+        {...props}\n+        delay={delay}\n+        closeDelay={closeDelay}\n+        render={children as React.ReactElement<Record<string, unknown>>}\n+      />\n+    );\n+  }\n   return (\n-    <BaseTooltip.Trigger {...props} {...{ delay, closeDelay }}>\n+    <BaseTooltip.Trigger {...props} delay={delay} closeDelay={closeDelay}>\n       {children}\n     </BaseTooltip.Trigger>\n   );\n","comments":[{"type":"issue_comment","id":3600053183,"prNumber":1099,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\nCaptured 5 screenshots for commit `d5ca08a` (2025-12-02 03:46:40.362 UTC).\n\n**Lower section showing configured repositories list with an active repository (austinywang/landing) and feature description cards**\n\n![configured-repositories-section.png](https://adorable-wombat-701.convex.cloud/api/storage/691b3a24-d94f-495c-958c-278c4a6915df)\n\n**Header section with quick setup input field for entering Git repository URLs**\n\n![header-and-quick-setup.png](https://adorable-wombat-701.convex.cloud/api/storage/224e801b-db63-4143-86ec-6c9c14b91754)\n\n**Full page view of the preview dashboard showing the complete layout with repository selection, feature cards, and configured repositories**\n\n![preview-dashboard-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/25903bd2-daa0-42bb-b30a-0cd327f7e18d)\n\n**Repository search box with 'test' query entered, demonstrating the TanStack Query debounced search functionality**\n\n![repository-search-with-query.png](https://adorable-wombat-701.convex.cloud/api/storage/a312c468-4bda-41e0-a922-958d4e49cc98)\n\n**Repository selection box showing the empty state with 'No repositories found' message and team/account dropdowns**\n\n![repository-selection-empty-state.png](https://adorable-wombat-701.convex.cloud/api/storage/2631fb1c-621a-4dde-a9eb-37c05b7121af)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"de87e9f4a81d2d170a4c1a48dbd65bbddd3dd6b5","createdAt":"2025-12-02T03:46:41Z","updatedAt":"2025-12-02T20:02:25Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1099#issuecomment-3600053183"},{"type":"issue_comment","id":3603749851,"prNumber":1099,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\nCaptured 7 screenshots for commit `22984a2` (2025-12-02 20:02:23.593 UTC).\n\n**Close-up of the configured repositories section showing active repository configurations**\n\n![configured-repositories-section.png](https://adorable-wombat-701.convex.cloud/api/storage/bc5e424b-89e8-4482-b947-77af26bc1d00)\n\n**Full page screenshot of the preview dashboard showing the main landing page with repository selection, configured repos, and feature descriptions**\n\n![preview-page-full.png](https://adorable-wombat-701.convex.cloud/api/storage/86486f0d-36e8-4d6b-b2a7-68dae5cbd515)\n\n**Viewport screenshot of the preview dashboard in its default state**\n\n![preview-page-viewport.png](https://adorable-wombat-701.convex.cloud/api/storage/665a109e-10ce-4f9c-b016-8c5fdde12f24)\n\n**Repository search box in active/focused state showing the search interface**\n\n![repo-search-active.png](https://adorable-wombat-701.convex.cloud/api/storage/efba21b9-337f-4167-9408-b7be15cc0a1b)\n\n**Repository search after clearing the query, showing default state**\n\n![repo-search-cleared.png](https://adorable-wombat-701.convex.cloud/api/storage/60ba4b0b-f1af-4450-ad66-7b6441cc4420)\n\n**Repository search with 'cmux' query entered, demonstrating the TanStack Query implementation in action**\n\n![repo-search-with-query.png](https://adorable-wombat-701.convex.cloud/api/storage/ccd72594-cd11-47ea-8e13-cf9409ecabb3)\n\n**Close-up of the GitHub account selector dropdown component**\n\n![repo-selector-component.png](https://adorable-wombat-701.convex.cloud/api/storage/6fe5d74a-16c0-4844-8afc-ce938ba93a10)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"de87e9f4a81d2d170a4c1a48dbd65bbddd3dd6b5","createdAt":"2025-12-02T20:02:24Z","updatedAt":"2025-12-02T20:07:09Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1099#issuecomment-3603749851"},{"type":"issue_comment","id":3603766400,"prNumber":1099,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\nCaptured 6 screenshots for commit `22984a2` (2025-12-02 20:07:06.153 UTC).\n\n**Lower section showing configured repositories list with manaflow-ai/cmux and austinywang/landing repos, displaying their status badges and action buttons**\n\n![configured-repositories-section.png](https://famous-camel-162.convex.cloud/api/storage/c5989783-80b1-408b-8003-3f08f1fcddce)\n\n**Full page screenshot of the preview dashboard showing the entire layout including header, repository selection, and configured repositories**\n\n![preview-dashboard-full-page.png](https://famous-camel-162.convex.cloud/api/storage/3d34ad0c-cd57-4bca-a5dc-1fe541d12851)\n\n**Close-up of the header section and Git repository URL input field for setting up screenshot previews**\n\n![preview-dashboard-header-and-input.png](https://famous-camel-162.convex.cloud/api/storage/1c406ca0-cd67-4365-89dc-3ac8439d4990)\n\n**Top viewport showing the preview dashboard header with 'Screenshot previews for GitHub PRs' title and repository URL input**\n\n![preview-dashboard-viewport-top.png](https://famous-camel-162.convex.cloud/api/storage/7f051f21-d920-4ca8-9c55-831aa1b33f90)\n\n**Repository search interface with empty search showing 'No repositories found' state, with team selector and GitHub account dropdown**\n\n![repository-search-empty-state.png](https://famous-camel-162.convex.cloud/api/storage/9d839cf7-5f2b-4948-9660-25fefe6e1538)\n\n**Repository selection area showing the search input with 'cmux' query entered, demonstrating the TanStack Query-powered search functionality**\n\n![repository-search-with-query.png](https://famous-camel-162.convex.cloud/api/storage/a0e154d0-8a6a-4097-8677-1e88316ae661)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"de87e9f4a81d2d170a4c1a48dbd65bbddd3dd6b5","createdAt":"2025-12-02T20:07:09Z","updatedAt":"2025-12-02T20:16:27Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1099#issuecomment-3603766400"},{"type":"issue_comment","id":3603802569,"prNumber":1099,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n\n\nCaptured 10 screenshots for commit `de87e9f` (2025-12-02 20:16:24.956 UTC).\n\n**Configured repositories list showing manaflow-ai/cmux and austinywang/landing with action buttons**\n\n![configured-repositories-section.png](https://adorable-wombat-701.convex.cloud/api/storage/d78e0c6a-993d-4faa-9b40-14134e3cbdf3)\n\n**From the creators of section showing cmux branding and links to GitHub and explore cmux**\n\n![creators-section.png](https://adorable-wombat-701.convex.cloud/api/storage/d071118c-8906-408e-9f53-22b6e6f3fa22)\n\n**What is preview.new section showing three feature cards: Computer use agent, GitHub comments, and Isolated dev servers**\n\n![feature-cards-section.png](https://adorable-wombat-701.convex.cloud/api/storage/cfed0c91-e0fb-4147-8a5f-d5cbf1eca819)\n\n**Header section with title, description, and repository URL input field**\n\n![header-and-input-section.png](https://adorable-wombat-701.convex.cloud/api/storage/0aa206a3-ab67-4856-98d4-2e4b302b01a4)\n\n**Full page screenshot of the preview dashboard showing the complete layout**\n\n![preview-dashboard-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/dd4f93e2-4aac-44b2-86c0-94254339c992)\n\n**Repository search box with 'cmux' query entered showing search state**\n\n![repository-search-with-query.png](https://adorable-wombat-701.convex.cloud/api/storage/292e993a-6c50-44d2-9849-5566dd967251)\n\n**Repository selection box with GitHub account dropdown and search functionality**\n\n![repository-selection-with-search.png](https://adorable-wombat-701.convex.cloud/api/storage/c1b9854d-24a3-4c21-b68b-bf16e9298a86)\n\n**Delete configuration button with tooltip displayed (demonstrating the fixed tooltip-base component)**\n\n![tooltip-delete-configuration.png](https://adorable-wombat-701.convex.cloud/api/storage/13b9a012-3573-42c1-b6da-f65cde5b8bba)\n\n**Edit configuration button with tooltip displayed (demonstrating the fixed tooltip-base component)**\n\n![tooltip-edit-configuration.png](https://adorable-wombat-701.convex.cloud/api/storage/fde17240-d999-4c14-af4e-959c3a5c0f8f)\n\n**Repository URL input field filled with example GitHub URL and enabled Continue button**\n\n![url-input-filled.png](https://adorable-wombat-701.convex.cloud/api/storage/a77dbce8-a07b-483a-985b-38d5c881c6f6)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"de87e9f4a81d2d170a4c1a48dbd65bbddd3dd6b5","createdAt":"2025-12-02T20:16:26Z","updatedAt":"2025-12-02T20:16:26Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1099#issuecomment-3603802569"}]}
{"number":1098,"title":"Collapse env vars by default in Preview configure","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1098","headRef":"cmux/collapse-env-vars-by-default-in-preview-configure-rmsfq","headSha":"94ad71b708100d3821469ed39959934730bd4e7a","baseRef":"main","baseSha":"f865673c4835b1e3a252c0c1d446c613119ef416","createdAt":"2025-12-02T03:34:32Z","updatedAt":"2025-12-02T20:25:16Z","diff":"diff --git a/apps/www/components/preview/preview-configure-client.tsx b/apps/www/components/preview/preview-configure-client.tsx\nindex 42398ee8f..f11a7826c 100644\n--- a/apps/www/components/preview/preview-configure-client.tsx\n+++ b/apps/www/components/preview/preview-configure-client.tsx\n@@ -369,6 +369,10 @@ export function PreviewConfigureClient({\n   initialDevScript,\n   startAtConfigureEnvironment = false,\n }: PreviewConfigureClientProps) {\n+  const initialEnvPrefilled = useMemo(\n+    () => Boolean(initialEnvVarsContent && initialEnvVarsContent.trim().length > 0),\n+    [initialEnvVarsContent]\n+  );\n   const initialEnvVars = useMemo(() => {\n     const parsed = initialEnvVarsContent\n       ? parseEnvBlock(initialEnvVarsContent).map((entry) => ({\n@@ -381,10 +385,9 @@ export function PreviewConfigureClient({\n   }, [initialEnvVarsContent]);\n   const initialHasEnvValues = useMemo(\n     () =>\n-      initialEnvVars.some(\n-        (r) => r.name.trim().length > 0 || r.value.trim().length > 0\n-      ),\n-    [initialEnvVars]\n+      initialEnvPrefilled ||\n+      initialEnvVars.some((r) => r.name.trim().length > 0 || r.value.trim().length > 0),\n+    [initialEnvPrefilled, initialEnvVars]\n   );\n   const initialFrameworkConfig =\n     FRAMEWORK_PRESETS[initialFrameworkPreset] ?? FRAMEWORK_PRESETS.other;\n@@ -413,6 +416,7 @@ export function PreviewConfigureClient({\n   const [currentStep, setCurrentStep] = useState<WizardStep>(1);\n \n   const [envVars, setEnvVars] = useState<EnvVar[]>(initialEnvVars);\n+  const [hasTouchedEnvVars, setHasTouchedEnvVars] = useState(false);\n   const [frameworkPreset, setFrameworkPreset] = useState<FrameworkPreset>(\n     initialFrameworkPreset\n   );\n@@ -523,10 +527,9 @@ export function PreviewConfigureClient({\n \n   const hasEnvValues = useMemo(\n     () =>\n-      envVars.some(\n-        (r) => r.name.trim().length > 0 || r.value.trim().length > 0\n-      ),\n-    [envVars]\n+      (!hasTouchedEnvVars && initialEnvPrefilled) ||\n+      envVars.some((r) => r.name.trim().length > 0 || r.value.trim().length > 0),\n+    [envVars, hasTouchedEnvVars, initialEnvPrefilled]\n   );\n   const maintenanceScriptValue = maintenanceScript.trim();\n   const devScriptValue = devScript.trim();\n@@ -709,6 +712,7 @@ export function PreviewConfigureClient({\n   }, [envVars, instance?.instanceId, resolvedTeamSlugOrId]);\n \n   const updateEnvVars = useCallback((updater: (prev: EnvVar[]) => EnvVar[]) => {\n+    setHasTouchedEnvVars(true);\n     setEnvVars((prev) => updater(prev));\n   }, []);\n \n@@ -740,17 +744,21 @@ export function PreviewConfigureClient({\n     setHasUserEditedScripts(true);\n   }, []);\n \n-  const handleToggleEnvNone = useCallback((value: boolean) => {\n-    setEnvNone(value);\n-    setActiveEnvValueIndex(null);\n-    if (value) {\n-      setAreEnvValuesHidden(true);\n-      setEnvVars([{ name: \"\", value: \"\", isSecret: true }]);\n-      setIsEnvOpen(false);\n-    } else {\n-      setIsEnvOpen(true);\n-    }\n-  }, []);\n+  const handleToggleEnvNone = useCallback(\n+    (value: boolean) => {\n+      setHasTouchedEnvVars(true);\n+      setEnvNone(value);\n+      setActiveEnvValueIndex(null);\n+      if (value) {\n+        setAreEnvValuesHidden(true);\n+        setEnvVars([{ name: \"\", value: \"\", isSecret: true }]);\n+        setIsEnvOpen(false);\n+      } else {\n+        setIsEnvOpen(true);\n+      }\n+    },\n+    []\n+  );\n \n   const handleToggleMaintenanceNone = useCallback((value: boolean) => {\n     setMaintenanceNone(value);\n","comments":[{"type":"issue_comment","id":3603795343,"prNumber":1098,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n\n\nCaptured 5 screenshots for commit `94ad71b` (2025-12-02 20:14:22.378 UTC).\n\n**Environment variables section collapsed by default with green checkmark badge indicating completion when env vars are pre-configured**\n\n![env-vars-collapsed-with-checkmark.png](https://adorable-wombat-701.convex.cloud/api/storage/a9683981-24ef-4b1e-af7f-c0b243c5e113)\n\n**Environment variables section expanded showing the form fields with masked values (••••) for security**\n\n![env-vars-expanded-state.png](https://adorable-wombat-701.convex.cloud/api/storage/1940f2a1-360b-4509-9752-18ea0601bf70)\n\n**Environment variables section with values revealed after clicking the eye icon, showing DATABASE_URL and API_KEY in plain text**\n\n![env-vars-values-revealed.png](https://adorable-wombat-701.convex.cloud/api/storage/efe2ac64-9690-412a-869f-eb9de31d4a67)\n\n**Full page overview showing the environment variables UI with collapsed section (pre-filled vars) on the left and expanded section (empty vars) on the right**\n\n![full-page-overview.png](https://adorable-wombat-701.convex.cloud/api/storage/6432f94c-1b50-4912-836d-fc46e2bc857e)\n\n**Side-by-side comparison showing both collapsed (with pre-filled vars) and open (without pre-filled vars) states of the environment variables section**\n\n![side-by-side-comparison.png](https://adorable-wombat-701.convex.cloud/api/storage/c358ee8a-52a0-47b4-9961-897ccd56f3cd)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"94ad71b708100d3821469ed39959934730bd4e7a","createdAt":"2025-12-02T20:14:23Z","updatedAt":"2025-12-02T20:14:23Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1098#issuecomment-3603795343"}]}
{"number":1096,"title":"preview new landing ui 1","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1096","headRef":"preview-new-landing-ui-1","headSha":"4510778bd0c587ce72481c7250bb54904a5efee7","baseRef":"main","baseSha":"9ef183407f9e47be9035d71149c4c9bf61fcac8d","createdAt":"2025-12-02T03:14:18Z","updatedAt":"2025-12-02T03:58:11Z","diff":"diff --git a/.cursor/commands/deslop.md b/.cursor/commands/deslop.md\nnew file mode 100644\nindex 000000000..d82835663\n--- /dev/null\n+++ b/.cursor/commands/deslop.md\n@@ -0,0 +1,11 @@\n+# Remove AI code slop\n+\n+Check the diff against main, and remove all AI generated slop introduced in this branch.\n+\n+This includes:\n+- Extra comments that a human wouldn't add or is inconsistent with the rest of the file\n+- Extra defensive checks or try/catch blocks that are abnormal for that area of the codebase (especially if called by trusted / validated codepaths)\n+- Casts to any to get around type issues\n+- Any other style that is inconsistent with the file\n+\n+Report at the end with only a 1-3 sentence summary of what you changed\n\\ No newline at end of file\ndiff --git a/apps/www/app/(preview)/preview/page.tsx b/apps/www/app/(preview)/preview/page.tsx\nindex b928f8445..2b6ebd89e 100644\n--- a/apps/www/app/(preview)/preview/page.tsx\n+++ b/apps/www/app/(preview)/preview/page.tsx\n@@ -54,7 +54,40 @@ export default async function PreviewLandingPage({ searchParams }: PageProps) {\n   if (!user) {\n     return (\n       <div className=\"relative isolate min-h-dvh bg-[#05050a] text-white flex justify-center\">\n-        <div className=\"absolute inset-0 -z-10 bg-[radial-gradient(circle_at_calc(50%_+_150px)_450px,_rgba(4,120,255,0.25),_transparent_82%)]\" />\n+        <svg\n+          className=\"absolute inset-0 -z-10 w-full h-full -mx-8 sm:mx-0\"\n+          xmlns=\"http://www.w3.org/2000/svg\"\n+          viewBox=\"0 0 832 252\"\n+          fill=\"none\"\n+          preserveAspectRatio=\"none\"\n+        >\n+          <ellipse className=\"sm:hidden\" cx=\"446\" cy=\"96\" rx=\"500\" ry=\"126\" fill=\"url(#paint0_radial_preview_1_sm)\" />\n+          <ellipse className=\"hidden sm:block\" cx=\"446\" cy=\"96\" rx=\"416\" ry=\"126\" fill=\"url(#paint0_radial_preview_1)\" />\n+          <defs>\n+            <radialGradient\n+              id=\"paint0_radial_preview_1_sm\"\n+              cx=\"0\"\n+              cy=\"0\"\n+              r=\"1\"\n+              gradientUnits=\"userSpaceOnUse\"\n+              gradientTransform=\"translate(446 96) scale(500 126)\"\n+            >\n+              <stop stopColor=\"rgba(4,120,255,0.25)\" />\n+              <stop offset=\"1\" stopColor=\"rgba(4,120,255,0)\" />\n+            </radialGradient>\n+            <radialGradient\n+              id=\"paint0_radial_preview_1\"\n+              cx=\"0\"\n+              cy=\"0\"\n+              r=\"1\"\n+              gradientUnits=\"userSpaceOnUse\"\n+              gradientTransform=\"translate(446 96) scale(416 126)\"\n+            >\n+              <stop stopColor=\"rgba(4,120,255,0.25)\" />\n+              <stop offset=\"1\" stopColor=\"rgba(4,120,255,0)\" />\n+            </radialGradient>\n+          </defs>\n+        </svg>\n \n         <PreviewDashboard\n           selectedTeamSlugOrId=\"\"\n@@ -153,7 +186,40 @@ export default async function PreviewLandingPage({ searchParams }: PageProps) {\n \n   return (\n     <div className=\"relative isolate min-h-dvh bg-[#05050a] text-white flex justify-center\">\n-      <div className=\"absolute inset-0 -z-10 bg-[radial-gradient(circle_at_calc(50%_+_150px)_450px,_rgba(4,120,255,0.25),_transparent_82%)]\" />\n+      <svg\n+        className=\"absolute inset-0 -z-10 w-full h-full -mx-8 sm:mx-0\"\n+        xmlns=\"http://www.w3.org/2000/svg\"\n+        viewBox=\"0 0 832 252\"\n+        fill=\"none\"\n+        preserveAspectRatio=\"none\"\n+      >\n+        <ellipse className=\"sm:hidden\" cx=\"446\" cy=\"96\" rx=\"500\" ry=\"126\" fill=\"url(#paint0_radial_preview_2_sm)\" />\n+        <ellipse className=\"hidden sm:block\" cx=\"446\" cy=\"96\" rx=\"416\" ry=\"126\" fill=\"url(#paint0_radial_preview_2)\" />\n+        <defs>\n+          <radialGradient\n+            id=\"paint0_radial_preview_2_sm\"\n+            cx=\"0\"\n+            cy=\"0\"\n+            r=\"1\"\n+            gradientUnits=\"userSpaceOnUse\"\n+            gradientTransform=\"translate(446 96) scale(500 126)\"\n+          >\n+            <stop stopColor=\"rgba(4,120,255,0.25)\" />\n+            <stop offset=\"1\" stopColor=\"rgba(4,120,255,0)\" />\n+          </radialGradient>\n+          <radialGradient\n+            id=\"paint0_radial_preview_2\"\n+            cx=\"0\"\n+            cy=\"0\"\n+            r=\"1\"\n+            gradientUnits=\"userSpaceOnUse\"\n+            gradientTransform=\"translate(446 96) scale(416 126)\"\n+          >\n+            <stop stopColor=\"rgba(4,120,255,0.25)\" />\n+            <stop offset=\"1\" stopColor=\"rgba(4,120,255,0)\" />\n+          </radialGradient>\n+        </defs>\n+      </svg>\n \n       <PreviewDashboard\n         selectedTeamSlugOrId={selectedTeamSlugOrId}\ndiff --git a/apps/www/components/icons/framework-logos.tsx b/apps/www/components/icons/framework-logos.tsx\nnew file mode 100644\nindex 000000000..b4a90b0e2\n--- /dev/null\n+++ b/apps/www/components/icons/framework-logos.tsx\n@@ -0,0 +1,288 @@\n+import type { SVGProps } from \"react\";\n+\n+export function AngularLogo(props: SVGProps<SVGSVGElement>) {\n+  return (\n+    <svg\n+      width=\"48\"\n+      height=\"48\"\n+      fill=\"none\"\n+      xmlns=\"http://www.w3.org/2000/svg\"\n+      viewBox=\"0 0 48 48\"\n+      {...props}\n+    >\n+      <path\n+        d=\"M24 1L3 8.636l3.203 28.313L24 47l17.797-10.051L45 8.636 24 1z\"\n+        fill=\"#DA0B36\"\n+      />\n+      <path\n+        d=\"M24 1v5.106-.023V47l17.797-10.051L45 8.636 24 1z\"\n+        fill=\"#C10933\"\n+      />\n+      <path\n+        d=\"M24.022 6L11 36h4.855l2.618-6.713h11.054L32.145 36H37L24.022 6zm3.804 19.15H20.22l3.803-9.403 3.804 9.402z\"\n+        fill=\"#fff\"\n+      />\n+    </svg>\n+  );\n+}\n+\n+export function NextLogo(props: SVGProps<SVGSVGElement>) {\n+  return (\n+    <svg\n+      width=\"48\"\n+      height=\"48\"\n+      fill=\"none\"\n+      xmlns=\"http://www.w3.org/2000/svg\"\n+      viewBox=\"0 0 48 48\"\n+      {...props}\n+    >\n+      <mask\n+        id=\"next-mask\"\n+        style={{ maskType: \"alpha\" }}\n+        maskUnits=\"userSpaceOnUse\"\n+        x=\"0\"\n+        y=\"0\"\n+        width=\"48\"\n+        height=\"48\"\n+      >\n+        <circle cx=\"24\" cy=\"24\" r=\"24\" fill=\"#000\" />\n+      </mask>\n+      <g mask=\"url(#next-mask)\">\n+        <circle\n+          cx=\"24\"\n+          cy=\"24\"\n+          r=\"23.2\"\n+          fill=\"#000\"\n+          stroke=\"#fff\"\n+          strokeWidth=\"1.6\"\n+        />\n+        <path\n+          d=\"M39.8687 42.0055L18.4378 14.4H14.3999V33.592H17.6302V18.5023L37.333 43.9587C38.222 43.3637 39.069 42.7108 39.8687 42.0055Z\"\n+          fill=\"url(#next-gradient0)\"\n+        />\n+        <rect\n+          x=\"30.6667\"\n+          y=\"14.4\"\n+          width=\"3.2\"\n+          height=\"19.2\"\n+          fill=\"url(#next-gradient1)\"\n+        />\n+      </g>\n+      <defs>\n+        <linearGradient\n+          id=\"next-gradient0\"\n+          x1=\"29.0666\"\n+          y1=\"31.0667\"\n+          x2=\"38.5332\"\n+          y2=\"42.8\"\n+          gradientUnits=\"userSpaceOnUse\"\n+        >\n+          <stop stopColor=\"#fff\" />\n+          <stop offset=\"1\" stopColor=\"#fff\" stopOpacity=\"0\" />\n+        </linearGradient>\n+        <linearGradient\n+          id=\"next-gradient1\"\n+          x1=\"32.2667\"\n+          y1=\"14.4\"\n+          x2=\"32.2132\"\n+          y2=\"28.5001\"\n+          gradientUnits=\"userSpaceOnUse\"\n+        >\n+          <stop stopColor=\"#fff\" />\n+          <stop offset=\"1\" stopColor=\"#fff\" stopOpacity=\"0\" />\n+        </linearGradient>\n+      </defs>\n+    </svg>\n+  );\n+}\n+\n+export function NuxtLogo(props: SVGProps<SVGSVGElement>) {\n+  return (\n+    <svg\n+      width=\"61\"\n+      height=\"40\"\n+      viewBox=\"0 0 61 40\"\n+      fill=\"none\"\n+      xmlns=\"http://www.w3.org/2000/svg\"\n+      {...props}\n+    >\n+      <path\n+        d=\"M33.997 39.539h22.528c.715 0 1.418-.183 2.038-.53a4.014 4.014 0 0 0 1.492-1.447 3.861 3.861 0 0 0 .545-1.977 3.86 3.86 0 0 0-.547-1.977L44.923 8.19a4.016 4.016 0 0 0-1.49-1.447 4.172 4.172 0 0 0-2.038-.53c-.716 0-1.418.183-2.038.53a4.016 4.016 0 0 0-1.492 1.447l-3.868 6.504-7.563-12.718A4.018 4.018 0 0 0 24.942.53 4.175 4.175 0 0 0 22.904 0c-.716 0-1.419.183-2.039.53a4.018 4.018 0 0 0-1.492 1.446L.547 33.608A3.861 3.861 0 0 0 0 35.585c0 .694.188 1.376.545 1.977.358.601.873 1.1 1.492 1.447.62.347 1.323.53 2.038.53h14.141c5.603 0 9.735-2.387 12.578-7.044l6.902-11.596 3.698-6.205 11.096 18.64H37.695l-3.699 6.205Zm-16.011-6.212-9.869-.002L22.91 8.474l7.381 12.425-4.942 8.305c-1.888 3.022-4.033 4.123-7.363 4.123Z\"\n+        fill=\"#00DC82\"\n+      />\n+    </svg>\n+  );\n+}\n+\n+export function ReactLogo(props: SVGProps<SVGSVGElement>) {\n+  return (\n+    <svg\n+      width=\"48\"\n+      height=\"48\"\n+      fill=\"none\"\n+      xmlns=\"http://www.w3.org/2000/svg\"\n+      viewBox=\"0 0 48 48\"\n+      {...props}\n+    >\n+      <g clipPath=\"url(#react-clip0)\">\n+        <path\n+          d=\"M24 28.631a4.278 4.278 0 1 0 0-8.556 4.278 4.278 0 0 0 0 8.556z\"\n+          fill=\"#61DAFB\"\n+        />\n+        <path\n+          d=\"M24 33.118c12.678 0 22.956-3.924 22.956-8.765 0-4.84-10.278-8.765-22.956-8.765-12.679 0-22.957 3.924-22.957 8.765 0 4.841 10.278 8.765 22.957 8.765z\"\n+          stroke=\"#61DAFB\"\n+        />\n+        <path\n+          d=\"M16.409 28.736c6.34 10.98 14.877 17.918 19.07 15.498 4.191-2.42 2.451-13.284-3.888-24.264C25.25 8.99 16.714 2.053 12.52 4.473 8.33 6.892 10.07 17.756 16.41 28.736z\"\n+          stroke=\"#61DAFB\"\n+        />\n+        <path\n+          d=\"M16.409 19.97c-6.34 10.98-8.08 21.843-3.887 24.264 4.192 2.42 12.73-4.518 19.069-15.498 6.34-10.98 8.08-21.843 3.887-24.264-4.192-2.42-12.73 4.519-19.069 15.498z\"\n+          stroke=\"#61DAFB\"\n+        />\n+      </g>\n+      <defs>\n+        <clipPath id=\"react-clip0\">\n+          <path fill=\"#fff\" transform=\"translate(0 3)\" d=\"M0 0H48V42.706H0z\" />\n+        </clipPath>\n+      </defs>\n+    </svg>\n+  );\n+}\n+\n+export function RemixLogo(props: SVGProps<SVGSVGElement>) {\n+  return (\n+    <svg\n+      viewBox=\"0 0 800 800\"\n+      fill=\"none\"\n+      xmlns=\"http://www.w3.org/2000/svg\"\n+      {...props}\n+    >\n+      <path\n+        d=\"M700 0H100C44.772 0 0 44.772 0 100v600c0 55.228 44.772 100 100 100h600c55.228 0 100-44.772 100-100V100C800 44.772 755.228 0 700 0Z\"\n+        fill=\"#212121\"\n+      />\n+      <path\n+        fillRule=\"evenodd\"\n+        clipRule=\"evenodd\"\n+        d=\"M587.947 527.768c4.254 54.65 4.254 80.268 4.254 108.232H465.756c0-6.091.109-11.663.219-17.313.342-17.564.699-35.88-2.147-72.868-3.761-54.152-27.08-66.185-69.957-66.185H195v-98.525h204.889c54.16 0 81.241-16.476 81.241-60.098 0-38.357-27.081-61.601-81.241-61.601H195V163h227.456C545.069 163 606 220.912 606 313.42c0 69.193-42.877 114.319-100.799 121.84 48.895 9.777 77.48 37.605 82.746 92.508Z\"\n+        fill=\"#fff\"\n+      />\n+      <path\n+        d=\"M195 636v-73.447h133.697c22.332 0 27.181 16.563 27.181 26.441V636H195Z\"\n+        fill=\"#fff\"\n+      />\n+      <path\n+        d=\"M194.5 636v.5h161.878v-47.506c0-5.006-1.226-11.734-5.315-17.224-4.108-5.515-11.059-9.717-22.366-9.717H194.5V636Z\"\n+        stroke=\"#fff\"\n+        strokeOpacity=\".8\"\n+      />\n+    </svg>\n+  );\n+}\n+\n+export function SvelteLogo(props: SVGProps<SVGSVGElement>) {\n+  return (\n+    <svg\n+      width=\"47\"\n+      height=\"48\"\n+      fill=\"none\"\n+      xmlns=\"http://www.w3.org/2000/svg\"\n+      viewBox=\"0 0 47 48\"\n+      {...props}\n+    >\n+      <g clipPath=\"url(#svelte-clip0)\">\n+        <path\n+          d=\"M39.792 6.09C35.507-.027 27.044-1.84 20.924 2.048L10.177 8.88a12.297 12.297 0 0 0-5.57 8.237 12.922 12.922 0 0 0 1.28 8.315 12.313 12.313 0 0 0-1.844 4.596c-.619 3.47.19 7.043 2.244 9.91 4.287 6.119 12.75 7.931 18.869 4.042l10.747-6.831a12.295 12.295 0 0 0 5.57-8.237 12.927 12.927 0 0 0-1.28-8.315A12.31 12.31 0 0 0 42.037 16c.619-3.47-.19-7.043-2.245-9.91\"\n+          fill=\"#FF3E00\"\n+        />\n+        <path\n+          d=\"M19.873 40.52a8.55 8.55 0 0 1-9.165-3.388 7.866 7.866 0 0 1-1.35-5.962c.062-.339.148-.674.257-1.001l.202-.616.55.404a13.881 13.881 0 0 0 4.206 2.095l.4.121-.037.398a2.4 2.4 0 0 0 .433 1.594 2.575 2.575 0 0 0 2.76 1.022 2.37 2.37 0 0 0 .66-.29l10.75-6.833a2.233 2.233 0 0 0 1.011-1.492 2.377 2.377 0 0 0-.407-1.797 2.577 2.577 0 0 0-2.76-1.022 2.37 2.37 0 0 0-.66.289L22.62 26.65c-.675.428-1.411.75-2.183.956a8.55 8.55 0 0 1-9.166-3.388 7.866 7.866 0 0 1-1.35-5.962 7.394 7.394 0 0 1 3.35-4.954l10.75-6.834a7.844 7.844 0 0 1 2.185-.957 8.55 8.55 0 0 1 9.165 3.388 7.866 7.866 0 0 1 1.35 5.962c-.062.34-.148.674-.256 1.001l-.203.616-.55-.403a13.87 13.87 0 0 0-4.206-2.096l-.4-.121.037-.398a2.404 2.404 0 0 0-.433-1.594 2.575 2.575 0 0 0-2.76-1.022 2.37 2.37 0 0 0-.66.29l-10.75 6.833a2.229 2.229 0 0 0-1.01 1.492c-.112.63.034 1.277.406 1.797a2.577 2.577 0 0 0 2.76 1.023c.234-.063.457-.16.661-.29l4.102-2.607a7.834 7.834 0 0 1 2.183-.957 8.55 8.55 0 0 1 9.165 3.388 7.865 7.865 0 0 1 1.35 5.962 7.398 7.398 0 0 1-3.35 4.955l-10.75 6.833a7.842 7.842 0 0 1-2.185.958\"\n+          fill=\"#fff\"\n+        />\n+      </g>\n+      <defs>\n+        <clipPath id=\"svelte-clip0\">\n+          <path fill=\"#fff\" transform=\"translate(3.84)\" d=\"M0 0H38.4V46.08H0z\" />\n+        </clipPath>\n+      </defs>\n+    </svg>\n+  );\n+}\n+\n+export function ViteLogo(props: SVGProps<SVGSVGElement>) {\n+  return (\n+    <svg\n+      width=\"410\"\n+      height=\"404\"\n+      viewBox=\"0 0 410 404\"\n+      fill=\"none\"\n+      xmlns=\"http://www.w3.org/2000/svg\"\n+      {...props}\n+    >\n+      <path\n+        d=\"M399.641 59.5246L215.643 388.545C211.844 395.338 202.084 395.378 198.228 388.618L10.5817 59.5563C6.38087 52.1896 12.6802 43.2665 21.0281 44.7586L205.223 77.6824C206.398 77.8924 207.601 77.8904 208.776 77.6763L389.119 44.8058C397.439 43.2894 403.768 52.1434 399.641 59.5246Z\"\n+        fill=\"url(#vite-paint0-linear)\"\n+      />\n+      <path\n+        d=\"M292.965 1.5744L156.801 28.2552C154.563 28.6937 152.906 30.5903 152.771 32.8664L144.395 174.33C144.198 177.662 147.258 180.248 150.51 179.498L188.42 170.749C191.967 169.931 195.172 173.055 194.443 176.622L183.18 231.775C182.422 235.487 185.907 238.661 189.532 237.56L212.947 230.446C216.577 229.344 220.065 232.527 219.297 236.242L201.398 322.875C200.278 328.294 207.486 331.249 210.492 326.603L212.5 323.5L323.454 102.072C325.312 98.3645 322.108 94.137 318.036 94.9228L279.014 102.454C275.347 103.161 272.227 99.746 273.262 96.1583L298.731 7.86689C299.767 4.27314 296.636 0.855181 292.965 1.5744Z\"\n+        fill=\"url(#vite-paint1-linear)\"\n+      />\n+      <defs>\n+        <linearGradient\n+          id=\"vite-paint0-linear\"\n+          x1=\"6.00017\"\n+          y1=\"32.9999\"\n+          x2=\"235\"\n+          y2=\"344\"\n+          gradientUnits=\"userSpaceOnUse\"\n+        >\n+          <stop stopColor=\"#41D1FF\" />\n+          <stop offset=\"1\" stopColor=\"#BD34FE\" />\n+        </linearGradient>\n+        <linearGradient\n+          id=\"vite-paint1-linear\"\n+          x1=\"194.651\"\n+          y1=\"8.81818\"\n+          x2=\"236.076\"\n+          y2=\"292.989\"\n+          gradientUnits=\"userSpaceOnUse\"\n+        >\n+          <stop stopColor=\"#FFEA83\" />\n+          <stop offset=\"0.0833333\" stopColor=\"#FFDD35\" />\n+          <stop offset=\"1\" stopColor=\"#FFA800\" />\n+        </linearGradient>\n+      </defs>\n+    </svg>\n+  );\n+}\n+\n+export function VueLogo(props: SVGProps<SVGSVGElement>) {\n+  return (\n+    <svg\n+      width=\"48\"\n+      height=\"48\"\n+      fill=\"none\"\n+      xmlns=\"http://www.w3.org/2000/svg\"\n+      viewBox=\"0 0 48 48\"\n+      {...props}\n+    >\n+      <g clipPath=\"url(#vue-clip0)\">\n+        <path\n+          d=\"M29.54 3L24 12.7 18.456 3H-.001l24 42L47.998 3H29.54z\"\n+          fill=\"#41B883\"\n+        />\n+        <path\n+          d=\"M29.54 3L24 12.7 18.456 3H9.599l14.4 25.2L38.398 3H29.54z\"\n+          fill=\"#34495E\"\n+        />\n+      </g>\n+      <defs>\n+        <clipPath id=\"vue-clip0\">\n+          <path fill=\"#fff\" transform=\"translate(0 3)\" d=\"M0 0H48V42H0z\" />\n+        </clipPath>\n+      </defs>\n+    </svg>\n+  );\n+}\ndiff --git a/apps/www/components/preview/framework-preset-select.tsx b/apps/www/components/preview/framework-preset-select.tsx\nnew file mode 100644\nindex 000000000..13a0ba70d\n--- /dev/null\n+++ b/apps/www/components/preview/framework-preset-select.tsx\n@@ -0,0 +1,331 @@\n+\"use client\";\n+\n+import * as SelectPrimitive from \"@radix-ui/react-select\";\n+import { ChevronDown, Check, Sparkles } from \"lucide-react\";\n+import { forwardRef, type ReactNode } from \"react\";\n+import clsx from \"clsx\";\n+import {\n+  Tooltip,\n+  TooltipContent,\n+  TooltipProvider,\n+  TooltipTrigger,\n+} from \"@/components/ui/tooltip\";\n+import {\n+  AngularLogo,\n+  NextLogo,\n+  NuxtLogo,\n+  ReactLogo,\n+  RemixLogo,\n+  SvelteLogo,\n+  ViteLogo,\n+  VueLogo,\n+} from \"@/components/icons/framework-logos\";\n+\n+export type FrameworkPreset =\n+  | \"other\"\n+  | \"next\"\n+  | \"vite\"\n+  | \"remix\"\n+  | \"nuxt\"\n+  | \"sveltekit\"\n+  | \"angular\"\n+  | \"cra\"\n+  | \"vue\";\n+\n+type FrameworkIconKey =\n+  | \"other\"\n+  | \"next\"\n+  | \"vite\"\n+  | \"remix\"\n+  | \"nuxt\"\n+  | \"svelte\"\n+  | \"angular\"\n+  | \"react\"\n+  | \"vue\";\n+\n+type FrameworkPresetConfig = {\n+  name: string;\n+  maintenanceScript: string;\n+  devScript: string;\n+  icon: FrameworkIconKey;\n+};\n+\n+export const FRAMEWORK_PRESETS: Record<FrameworkPreset, FrameworkPresetConfig> =\n+  {\n+    other: {\n+      name: \"Other\",\n+      maintenanceScript: \"\",\n+      devScript: \"\",\n+      icon: \"other\",\n+    },\n+    next: {\n+      name: \"Next.js\",\n+      maintenanceScript: \"npm install\",\n+      devScript: \"npm run dev\",\n+      icon: \"next\",\n+    },\n+    vite: {\n+      name: \"Vite\",\n+      maintenanceScript: \"npm install\",\n+      devScript: \"npm run dev\",\n+      icon: \"vite\",\n+    },\n+    remix: {\n+      name: \"Remix\",\n+      maintenanceScript: \"npm install\",\n+      devScript: \"npm run dev\",\n+      icon: \"remix\",\n+    },\n+    nuxt: {\n+      name: \"Nuxt\",\n+      maintenanceScript: \"npm install\",\n+      devScript: \"npm run dev\",\n+      icon: \"nuxt\",\n+    },\n+    sveltekit: {\n+      name: \"SvelteKit\",\n+      maintenanceScript: \"npm install\",\n+      devScript: \"npm run dev\",\n+      icon: \"svelte\",\n+    },\n+    angular: {\n+      name: \"Angular\",\n+      maintenanceScript: \"npm install\",\n+      devScript: \"npm start\",\n+      icon: \"angular\",\n+    },\n+    cra: {\n+      name: \"Create React App\",\n+      maintenanceScript: \"npm install\",\n+      devScript: \"npm start\",\n+      icon: \"react\",\n+    },\n+    vue: {\n+      name: \"Vue\",\n+      maintenanceScript: \"npm install\",\n+      devScript: \"npm run dev\",\n+      icon: \"vue\",\n+    },\n+  };\n+\n+const FRAMEWORK_ICON_META: Record<\n+  FrameworkIconKey,\n+  { icon: ReactNode; bgClass: string; textClass: string }\n+> = {\n+  other: {\n+    icon: <Sparkles className=\"h-4 w-4\" />,\n+    bgClass: \"bg-neutral-200 dark:bg-neutral-800\",\n+    textClass: \"text-neutral-700 dark:text-neutral-100\",\n+  },\n+  next: {\n+    icon: <NextLogo className=\"h-5 w-5\" aria-hidden=\"true\" />,\n+    bgClass: \"bg-neutral-100 dark:bg-neutral-800\",\n+    textClass: \"\",\n+  },\n+  vite: {\n+    icon: <ViteLogo className=\"h-5 w-5\" aria-hidden=\"true\" />,\n+    bgClass: \"bg-neutral-100 dark:bg-neutral-800\",\n+    textClass: \"\",\n+  },\n+  remix: {\n+    icon: <RemixLogo className=\"h-5 w-5\" aria-hidden=\"true\" />,\n+    bgClass: \"bg-neutral-100 dark:bg-neutral-800\",\n+    textClass: \"\",\n+  },\n+  nuxt: {\n+    icon: <NuxtLogo className=\"h-5 w-5\" aria-hidden=\"true\" />,\n+    bgClass: \"bg-neutral-100 dark:bg-neutral-800\",\n+    textClass: \"\",\n+  },\n+  svelte: {\n+    icon: <SvelteLogo className=\"h-5 w-5\" aria-hidden=\"true\" />,\n+    bgClass: \"bg-neutral-100 dark:bg-neutral-800\",\n+    textClass: \"\",\n+  },\n+  angular: {\n+    icon: <AngularLogo className=\"h-5 w-5\" aria-hidden=\"true\" />,\n+    bgClass: \"bg-neutral-100 dark:bg-neutral-800\",\n+    textClass: \"\",\n+  },\n+  react: {\n+    icon: <ReactLogo className=\"h-5 w-5\" aria-hidden=\"true\" />,\n+    bgClass: \"bg-neutral-100 dark:bg-neutral-800\",\n+    textClass: \"\",\n+  },\n+  vue: {\n+    icon: <VueLogo className=\"h-5 w-5\" aria-hidden=\"true\" />,\n+    bgClass: \"bg-neutral-100 dark:bg-neutral-800\",\n+    textClass: \"\",\n+  },\n+};\n+\n+function FrameworkIconBubble({ preset }: { preset: FrameworkPreset }) {\n+  const meta =\n+    FRAMEWORK_ICON_META[FRAMEWORK_PRESETS[preset].icon] ??\n+    FRAMEWORK_ICON_META.other;\n+  return (\n+    <span\n+      className={clsx(\n+        \"flex h-8 w-8 items-center justify-center rounded-md border border-neutral-200 dark:border-neutral-800\",\n+        meta.bgClass,\n+        meta.textClass\n+      )}\n+      aria-hidden=\"true\"\n+    >\n+      {meta.icon}\n+    </span>\n+  );\n+}\n+\n+type FrameworkPresetSelectProps = {\n+  value: FrameworkPreset;\n+  onValueChange: (value: FrameworkPreset) => void;\n+};\n+\n+const SelectTrigger = forwardRef<\n+  HTMLButtonElement,\n+  SelectPrimitive.SelectTriggerProps & { preset: FrameworkPreset }\n+>(({ className, preset, ...props }, ref) => {\n+  const config = FRAMEWORK_PRESETS[preset];\n+  return (\n+    <SelectPrimitive.Trigger\n+      ref={ref}\n+      className={clsx(\n+        \"flex w-full items-center justify-between rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-3 py-2.5 text-sm text-neutral-900 dark:text-neutral-100 font-sans\",\n+        \"focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700\",\n+        \"data-[placeholder]:text-neutral-400\",\n+        className\n+      )}\n+      {...props}\n+    >\n+      <span className=\"flex items-center gap-3\">\n+        <FrameworkIconBubble preset={preset} />\n+        <span className=\"text-left\">\n+          <span className=\"block font-medium\">{config.name}</span>\n+          <span className=\"block text-xs text-neutral-500 dark:text-neutral-400\">\n+            Autofills install and dev scripts\n+          </span>\n+        </span>\n+      </span>\n+      <SelectPrimitive.Icon asChild>\n+        <ChevronDown className=\"h-4 w-4 text-neutral-400 transition-transform data-[state=open]:rotate-180\" />\n+      </SelectPrimitive.Icon>\n+    </SelectPrimitive.Trigger>\n+  );\n+});\n+SelectTrigger.displayName = \"SelectTrigger\";\n+\n+const SelectContent = forwardRef<\n+  HTMLDivElement,\n+  SelectPrimitive.SelectContentProps\n+>(({ className, children, ...props }, ref) => (\n+  <SelectPrimitive.Portal>\n+    <SelectPrimitive.Content\n+      ref={ref}\n+      className={clsx(\n+        \"z-50 w-[var(--radix-select-trigger-width)] overflow-hidden rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 shadow-lg font-sans\",\n+        \"data-[state=open]:animate-in data-[state=open]:fade-in-0 data-[state=open]:zoom-in-95\",\n+        \"data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95\",\n+        \"data-[side=bottom]:slide-in-from-top-2 data-[side=top]:slide-in-from-bottom-2\",\n+        className\n+      )}\n+      position=\"popper\"\n+      sideOffset={8}\n+      {...props}\n+    >\n+      <SelectPrimitive.Viewport className=\"max-h-64 overflow-y-auto\">\n+        {children}\n+      </SelectPrimitive.Viewport>\n+    </SelectPrimitive.Content>\n+  </SelectPrimitive.Portal>\n+));\n+SelectContent.displayName = \"SelectContent\";\n+\n+const SelectItem = forwardRef<\n+  HTMLDivElement,\n+  SelectPrimitive.SelectItemProps & { preset: FrameworkPreset }\n+>(({ className, preset, ...props }, ref) => {\n+  const config = FRAMEWORK_PRESETS[preset];\n+  return (\n+    <SelectPrimitive.Item\n+      ref={ref}\n+      className={clsx(\n+        \"relative flex w-full cursor-pointer select-none items-center gap-3 px-3 py-2 text-left text-sm outline-none transition\",\n+        \"focus:bg-neutral-100 dark:focus:bg-neutral-900\",\n+        \"data-[state=checked]:bg-neutral-100 dark:data-[state=checked]:bg-neutral-900\",\n+        \"data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n+        className\n+      )}\n+      {...props}\n+    >\n+      <FrameworkIconBubble preset={preset} />\n+      <div className=\"flex-1\">\n+        <div className=\"font-medium text-neutral-900 dark:text-neutral-100\">\n+          {config.name}\n+        </div>\n+        <div className=\"text-xs text-neutral-500 dark:text-neutral-400\">\n+          Default: {config.devScript || \"Custom\"}\n+        </div>\n+      </div>\n+      <SelectPrimitive.ItemIndicator className=\"absolute right-3\">\n+        <Check className=\"h-4 w-4 text-neutral-900 dark:text-neutral-100\" />\n+      </SelectPrimitive.ItemIndicator>\n+    </SelectPrimitive.Item>\n+  );\n+});\n+SelectItem.displayName = \"SelectItem\";\n+\n+export function FrameworkPresetSelect({\n+  value,\n+  onValueChange,\n+}: FrameworkPresetSelectProps) {\n+  const frameworkOptions = Object.keys(FRAMEWORK_PRESETS) as FrameworkPreset[];\n+\n+  return (\n+    <div>\n+      <label\n+        id=\"framework-preset-label\"\n+        className=\"block text-sm font-medium text-neutral-900 dark:text-neutral-100 mb-2\"\n+      >\n+        Framework Preset\n+      </label>\n+      <SelectPrimitive.Root\n+        value={value}\n+        onValueChange={(val) => onValueChange(val as FrameworkPreset)}\n+      >\n+        <SelectTrigger\n+          preset={value}\n+          aria-labelledby=\"framework-preset-label\"\n+        />\n+        <SelectContent>\n+          {frameworkOptions.map((preset) => (\n+            <SelectItem key={preset} value={preset} preset={preset}>\n+              {FRAMEWORK_PRESETS[preset].name}\n+            </SelectItem>\n+          ))}\n+        </SelectContent>\n+      </SelectPrimitive.Root>\n+      <TooltipProvider>\n+        <p className=\"mt-2 text-xs text-neutral-500 dark:text-neutral-400\">\n+          Workspace root{\" \"}\n+          <Tooltip>\n+            <TooltipTrigger asChild>\n+              <code\n+                className=\"rounded bg-neutral-100 px-1 py-0.5 text-[11px] text-neutral-700 dark:bg-neutral-900 dark:text-neutral-200 cursor-help\"\n+                tabIndex={0}\n+                role=\"button\"\n+                aria-describedby=\"workspace-root-desc\"\n+              >\n+                /root/workspace\n+              </code>\n+            </TooltipTrigger>\n+            <TooltipContent side=\"top\" id=\"workspace-root-desc\">\n+              This is the absolute path inside the sandbox environment\n+            </TooltipContent>\n+          </Tooltip>{\" \"}\n+          maps directly to your repository root.\n+        </p>\n+      </TooltipProvider>\n+    </div>\n+  );\n+}\ndiff --git a/apps/www/components/preview/preview-configure-client.tsx b/apps/www/components/preview/preview-configure-client.tsx\nindex 5c2c39f61..42398ee8f 100644\n--- a/apps/www/components/preview/preview-configure-client.tsx\n+++ b/apps/www/components/preview/preview-configure-client.tsx\n@@ -7,7 +7,6 @@ import {\n   useMemo,\n   useRef,\n   useState,\n-  type ReactNode,\n } from \"react\";\n import {\n   Loader2,\n@@ -18,77 +17,21 @@ import {\n   Minus,\n   Plus,\n   Copy,\n-  Github,\n   ChevronDown,\n-  Sparkles,\n   Check,\n } from \"lucide-react\";\n import Link from \"next/link\";\n import { formatEnvVarsContent } from \"@cmux/shared/utils/format-env-vars-content\";\n import clsx from \"clsx\";\n+import {\n+  FrameworkPresetSelect,\n+  FRAMEWORK_PRESETS,\n+  type FrameworkPreset,\n+} from \"./framework-preset-select\";\n \n const MASKED_ENV_VALUE = \"••••••••••••••••\";\n \n-export type FrameworkPreset =\n-  | \"other\"\n-  | \"next\"\n-  | \"vite\"\n-  | \"remix\"\n-  | \"nuxt\"\n-  | \"sveltekit\"\n-  | \"angular\"\n-  | \"cra\"\n-  | \"vue\";\n-\n-type FrameworkIconKey =\n-  | \"other\"\n-  | \"next\"\n-  | \"vite\"\n-  | \"remix\"\n-  | \"nuxt\"\n-  | \"svelte\"\n-  | \"angular\"\n-  | \"react\"\n-  | \"vue\";\n-\n-type FrameworkPresetConfig = {\n-  name: string;\n-  maintenanceScript: string;\n-  devScript: string;\n-  icon: FrameworkIconKey;\n-};\n-\n-const FRAMEWORK_PRESETS: Record<FrameworkPreset, FrameworkPresetConfig> = {\n-  other: { name: \"Other\", maintenanceScript: \"\", devScript: \"\", icon: \"other\" },\n-  next: { name: \"Next.js\", maintenanceScript: \"npm install\", devScript: \"npm run dev\", icon: \"next\" },\n-  vite: { name: \"Vite\", maintenanceScript: \"npm install\", devScript: \"npm run dev\", icon: \"vite\" },\n-  remix: { name: \"Remix\", maintenanceScript: \"npm install\", devScript: \"npm run dev\", icon: \"remix\" },\n-  nuxt: { name: \"Nuxt\", maintenanceScript: \"npm install\", devScript: \"npm run dev\", icon: \"nuxt\" },\n-  sveltekit: {\n-    name: \"SvelteKit\",\n-    maintenanceScript: \"npm install\",\n-    devScript: \"npm run dev\",\n-    icon: \"svelte\",\n-  },\n-  angular: {\n-    name: \"Angular\",\n-    maintenanceScript: \"npm install\",\n-    devScript: \"npm start\",\n-    icon: \"angular\",\n-  },\n-  cra: {\n-    name: \"Create React App\",\n-    maintenanceScript: \"npm install\",\n-    devScript: \"npm start\",\n-    icon: \"react\",\n-  },\n-  vue: {\n-    name: \"Vue\",\n-    maintenanceScript: \"npm install\",\n-    devScript: \"npm run dev\",\n-    icon: \"vue\",\n-  },\n-};\n+export type { FrameworkPreset };\n \n type SandboxInstance = {\n   instanceId: string;\n@@ -182,129 +125,6 @@ function deriveVncUrl(\n   return normalizeVncUrl(baseUrl);\n }\n \n-const FRAMEWORK_ICON_META: Record<\n-  FrameworkIconKey,\n-  { icon: ReactNode; bgClass: string; textClass: string }\n-> = {\n-  other: {\n-    icon: <Sparkles className=\"h-4 w-4\" />,\n-    bgClass: \"bg-neutral-200 dark:bg-neutral-800\",\n-    textClass: \"text-neutral-700 dark:text-neutral-100\",\n-  },\n-  next: {\n-    icon: (\n-      <img\n-        src=\"/framework-logos/next.svg\"\n-        alt=\"\"\n-        aria-hidden=\"true\"\n-        className=\"h-5 w-5\"\n-      />\n-    ),\n-    bgClass: \"bg-neutral-100 dark:bg-neutral-800\",\n-    textClass: \"\",\n-  },\n-  vite: {\n-    icon: (\n-      <img\n-        src=\"/framework-logos/vite.svg\"\n-        alt=\"\"\n-        aria-hidden=\"true\"\n-        className=\"h-5 w-5\"\n-      />\n-    ),\n-    bgClass: \"bg-neutral-100 dark:bg-neutral-800\",\n-    textClass: \"\",\n-  },\n-  remix: {\n-    icon: (\n-      <img\n-        src=\"/framework-logos/remix.svg\"\n-        alt=\"\"\n-        aria-hidden=\"true\"\n-        className=\"h-5 w-5\"\n-      />\n-    ),\n-    bgClass: \"bg-neutral-100 dark:bg-neutral-800\",\n-    textClass: \"\",\n-  },\n-  nuxt: {\n-    icon: (\n-      <img\n-        src=\"/framework-logos/nuxt.svg\"\n-        alt=\"\"\n-        aria-hidden=\"true\"\n-        className=\"h-5 w-5\"\n-      />\n-    ),\n-    bgClass: \"bg-neutral-100 dark:bg-neutral-800\",\n-    textClass: \"\",\n-  },\n-  svelte: {\n-    icon: (\n-      <img\n-        src=\"/framework-logos/svelte.svg\"\n-        alt=\"\"\n-        aria-hidden=\"true\"\n-        className=\"h-5 w-5\"\n-      />\n-    ),\n-    bgClass: \"bg-neutral-100 dark:bg-neutral-800\",\n-    textClass: \"\",\n-  },\n-  angular: {\n-    icon: (\n-      <img\n-        src=\"/framework-logos/angular.svg\"\n-        alt=\"\"\n-        aria-hidden=\"true\"\n-        className=\"h-5 w-5\"\n-      />\n-    ),\n-    bgClass: \"bg-neutral-100 dark:bg-neutral-800\",\n-    textClass: \"\",\n-  },\n-  react: {\n-    icon: (\n-      <img\n-        src=\"/framework-logos/react.svg\"\n-        alt=\"\"\n-        aria-hidden=\"true\"\n-        className=\"h-5 w-5\"\n-      />\n-    ),\n-    bgClass: \"bg-neutral-100 dark:bg-neutral-800\",\n-    textClass: \"\",\n-  },\n-  vue: {\n-    icon: (\n-      <img\n-        src=\"/framework-logos/vue.svg\"\n-        alt=\"\"\n-        aria-hidden=\"true\"\n-        className=\"h-5 w-5\"\n-      />\n-    ),\n-    bgClass: \"bg-neutral-100 dark:bg-neutral-800\",\n-    textClass: \"\",\n-  },\n-};\n-\n-function FrameworkIconBubble({ preset }: { preset: FrameworkPreset }) {\n-  const meta = FRAMEWORK_ICON_META[FRAMEWORK_PRESETS[preset].icon] ?? FRAMEWORK_ICON_META.other;\n-  return (\n-    <span\n-      className={clsx(\n-        \"flex h-8 w-8 items-center justify-center rounded-md border border-neutral-200 dark:border-neutral-800\",\n-        meta.bgClass,\n-        meta.textClass\n-      )}\n-      aria-hidden=\"true\"\n-    >\n-      {meta.icon}\n-    </span>\n-  );\n-}\n-\n const ensureInitialEnvVars = (initial?: EnvVar[]): EnvVar[] => {\n   const base = (initial ?? []).map((item) => ({\n     name: item.name,\n@@ -328,7 +148,12 @@ function parseEnvBlock(text: string): Array<{ name: string; value: string }> {\n \n   for (const line of lines) {\n     const trimmed = line.trim();\n-    if (trimmed.length === 0 || trimmed.startsWith(\"#\") || trimmed.startsWith(\"//\")) continue;\n+    if (\n+      trimmed.length === 0 ||\n+      trimmed.startsWith(\"#\") ||\n+      trimmed.startsWith(\"//\")\n+    )\n+      continue;\n \n     const cleanLine = trimmed.replace(/^export\\s+/, \"\").replace(/^set\\s+/, \"\");\n     const eqIdx = cleanLine.indexOf(\"=\");\n@@ -338,8 +163,10 @@ function parseEnvBlock(text: string): Array<{ name: string; value: string }> {\n     const key = cleanLine.slice(0, eqIdx).trim();\n     let value = cleanLine.slice(eqIdx + 1).trim();\n \n-    if ((value.startsWith('\"') && value.endsWith('\"')) ||\n-        (value.startsWith(\"'\") && value.endsWith(\"'\"))) {\n+    if (\n+      (value.startsWith('\"') && value.endsWith('\"')) ||\n+      (value.startsWith(\"'\") && value.endsWith(\"'\"))\n+    ) {\n       value = value.slice(1, -1);\n     }\n \n@@ -351,7 +178,6 @@ function parseEnvBlock(text: string): Array<{ name: string; value: string }> {\n   return results;\n }\n \n-\n // Persistent iframe manager for Next.js\n type PersistentIframeOptions = {\n   allow?: string;\n@@ -365,7 +191,12 @@ type MountOptions = {\n class SimplePersistentIframeManager {\n   private iframes = new Map<\n     string,\n-    { iframe: HTMLIFrameElement; wrapper: HTMLDivElement; allow?: string; sandbox?: string }\n+    {\n+      iframe: HTMLIFrameElement;\n+      wrapper: HTMLDivElement;\n+      allow?: string;\n+      sandbox?: string;\n+    }\n   >();\n   private container: HTMLDivElement | null = null;\n \n@@ -448,7 +279,8 @@ class SimplePersistentIframeManager {\n     if (options?.allow) {\n       iframe.allow = options.allow;\n     } else {\n-      iframe.allow = \"clipboard-read; clipboard-write; cross-origin-isolated; fullscreen\";\n+      iframe.allow =\n+        \"clipboard-read; clipboard-write; cross-origin-isolated; fullscreen\";\n     }\n     if (options?.sandbox) {\n       iframe.setAttribute(\"sandbox\", options.sandbox);\n@@ -508,7 +340,8 @@ class SimplePersistentIframeManager {\n   }\n }\n \n-const iframeManager = typeof window !== \"undefined\" ? new SimplePersistentIframeManager() : null;\n+const iframeManager =\n+  typeof window !== \"undefined\" ? new SimplePersistentIframeManager() : null;\n \n function StepBadge({ step, done }: { step: number; done: boolean }) {\n   return (\n@@ -547,19 +380,26 @@ export function PreviewConfigureClient({\n     return ensureInitialEnvVars(parsed);\n   }, [initialEnvVarsContent]);\n   const initialHasEnvValues = useMemo(\n-    () => initialEnvVars.some((r) => r.name.trim().length > 0 || r.value.trim().length > 0),\n+    () =>\n+      initialEnvVars.some(\n+        (r) => r.name.trim().length > 0 || r.value.trim().length > 0\n+      ),\n     [initialEnvVars]\n   );\n   const initialFrameworkConfig =\n     FRAMEWORK_PRESETS[initialFrameworkPreset] ?? FRAMEWORK_PRESETS.other;\n   const initialMaintenanceScriptValue =\n     initialMaintenanceScript ?? initialFrameworkConfig.maintenanceScript;\n-  const initialDevScriptValue = initialDevScript ?? initialFrameworkConfig.devScript;\n-  const initialMaintenanceNone = initialMaintenanceScriptValue.trim().length === 0;\n+  const initialDevScriptValue =\n+    initialDevScript ?? initialFrameworkConfig.devScript;\n+  const initialMaintenanceNone =\n+    initialMaintenanceScriptValue.trim().length === 0;\n   const initialDevNone = initialDevScriptValue.trim().length === 0;\n   const initialEnvComplete = initialHasEnvValues;\n-  const initialMaintenanceComplete = initialMaintenanceNone || initialMaintenanceScriptValue.trim().length > 0;\n-  const initialDevComplete = initialDevNone || initialDevScriptValue.trim().length > 0;\n+  const initialMaintenanceComplete =\n+    initialMaintenanceNone || initialMaintenanceScriptValue.trim().length > 0;\n+  const initialDevComplete =\n+    initialDevNone || initialDevScriptValue.trim().length > 0;\n \n   const [instance, setInstance] = useState<SandboxInstance | null>(null);\n   const [isProvisioning, setIsProvisioning] = useState(false);\n@@ -573,31 +413,45 @@ export function PreviewConfigureClient({\n   const [currentStep, setCurrentStep] = useState<WizardStep>(1);\n \n   const [envVars, setEnvVars] = useState<EnvVar[]>(initialEnvVars);\n-  const [frameworkPreset, setFrameworkPreset] = useState<FrameworkPreset>(initialFrameworkPreset);\n-  const [maintenanceScript, setMaintenanceScript] = useState(initialMaintenanceScriptValue);\n+  const [frameworkPreset, setFrameworkPreset] = useState<FrameworkPreset>(\n+    initialFrameworkPreset\n+  );\n+  const [maintenanceScript, setMaintenanceScript] = useState(\n+    initialMaintenanceScriptValue\n+  );\n   const [devScript, setDevScript] = useState(initialDevScriptValue);\n   const [hasUserEditedScripts, setHasUserEditedScripts] = useState(false);\n-  const [isFrameworkMenuOpen, setIsFrameworkMenuOpen] = useState(false);\n   const [hasCompletedSetup, setHasCompletedSetup] = useState(false);\n   const [isEnvOpen, setIsEnvOpen] = useState(false);\n   const [isBuildOpen, setIsBuildOpen] = useState(false);\n   const [envNone, setEnvNone] = useState(false);\n-  const [maintenanceNone, setMaintenanceNone] = useState(() => initialMaintenanceNone);\n+  const [maintenanceNone, setMaintenanceNone] = useState(\n+    () => initialMaintenanceNone\n+  );\n   const [devNone, setDevNone] = useState(() => initialDevNone);\n   const [runConfirmed, setRunConfirmed] = useState(false);\n   const [browserConfirmed, setBrowserConfirmed] = useState(false);\n   const [commandsCopied, setCommandsCopied] = useState(false);\n-  const [isEnvSectionOpen, setIsEnvSectionOpen] = useState(() => !initialEnvComplete);\n+  const [isEnvSectionOpen, setIsEnvSectionOpen] = useState(\n+    () => !initialEnvComplete\n+  );\n   const [isMaintenanceSectionOpen, setIsMaintenanceSectionOpen] = useState(\n     () => !initialMaintenanceComplete\n   );\n-  const [isDevSectionOpen, setIsDevSectionOpen] = useState(() => !initialDevComplete);\n+  const [isDevSectionOpen, setIsDevSectionOpen] = useState(\n+    () => !initialDevComplete\n+  );\n   const [isRunSectionOpen, setIsRunSectionOpen] = useState(true);\n-  const [isBrowserSetupSectionOpen, setIsBrowserSetupSectionOpen] = useState(true);\n+  const [isBrowserSetupSectionOpen, setIsBrowserSetupSectionOpen] =\n+    useState(true);\n \n   const [areEnvValuesHidden, setAreEnvValuesHidden] = useState(true);\n-  const [activeEnvValueIndex, setActiveEnvValueIndex] = useState<number | null>(null);\n-  const [pendingFocusIndex, setPendingFocusIndex] = useState<number | null>(null);\n+  const [activeEnvValueIndex, setActiveEnvValueIndex] = useState<number | null>(\n+    null\n+  );\n+  const [pendingFocusIndex, setPendingFocusIndex] = useState<number | null>(\n+    null\n+  );\n \n   const [isSaving, setIsSaving] = useState(false);\n \n@@ -607,34 +461,10 @@ export function PreviewConfigureClient({\n     }\n   }, [initialHasEnvValues]);\n \n-  useEffect(() => {\n-    const handleClickOutside = (event: MouseEvent) => {\n-      if (\n-        frameworkSelectRef.current &&\n-        !frameworkSelectRef.current.contains(event.target as Node)\n-      ) {\n-        setIsFrameworkMenuOpen(false);\n-      }\n-    };\n-    const handleEscape = (event: KeyboardEvent) => {\n-      if (event.key === \"Escape\") {\n-        setIsFrameworkMenuOpen(false);\n-      }\n-    };\n-\n-    document.addEventListener(\"mousedown\", handleClickOutside);\n-    document.addEventListener(\"keydown\", handleEscape);\n-    return () => {\n-      document.removeEventListener(\"mousedown\", handleClickOutside);\n-      document.removeEventListener(\"keydown\", handleEscape);\n-    };\n-  }, []);\n-\n   const persistentIframeManager = iframeManager;\n \n   const keyInputRefs = useRef<Array<HTMLInputElement | null>>([]);\n   const lastSubmittedEnvContent = useRef<string | null>(null);\n-  const frameworkSelectRef = useRef<HTMLDivElement | null>(null);\n   const copyResetTimeoutRef = useRef<number | null>(null);\n   const envSectionCollapsedOnEnterRef = useRef(false);\n \n@@ -646,22 +476,24 @@ export function PreviewConfigureClient({\n     };\n   }, []);\n \n-  const vscodePersistKey = instance?.instanceId ? `preview-${instance.instanceId}:vscode` : \"vscode\";\n-  const browserPersistKey = instance?.instanceId ? `preview-${instance.instanceId}:browser` : \"browser\";\n+  const vscodePersistKey = instance?.instanceId\n+    ? `preview-${instance.instanceId}:vscode`\n+    : \"vscode\";\n+  const browserPersistKey = instance?.instanceId\n+    ? `preview-${instance.instanceId}:browser`\n+    : \"browser\";\n \n   const selectedTeam = useMemo(\n-    () => teams.find((team) => team.slugOrId === selectedTeamSlugOrId) ?? teams[0] ?? null,\n+    () =>\n+      teams.find((team) => team.slugOrId === selectedTeamSlugOrId) ??\n+      teams[0] ??\n+      null,\n     [selectedTeamSlugOrId, teams]\n   );\n \n   const resolvedTeamSlugOrId =\n     selectedTeam?.slugOrId ?? initialTeamSlugOrId ?? teams[0]?.slugOrId ?? \"\";\n   const selectedTeamSlugOrIdRef = useRef(resolvedTeamSlugOrId);\n-  const frameworkOptions = useMemo(\n-    () => Object.entries(FRAMEWORK_PRESETS) as Array<[FrameworkPreset, FrameworkPresetConfig]>,\n-    []\n-  );\n-  const selectedFrameworkConfig = FRAMEWORK_PRESETS[frameworkPreset];\n \n   useEffect(() => {\n     selectedTeamSlugOrIdRef.current = resolvedTeamSlugOrId;\n@@ -690,7 +522,10 @@ export function PreviewConfigureClient({\n   );\n \n   const hasEnvValues = useMemo(\n-    () => envVars.some((r) => r.name.trim().length > 0 || r.value.trim().length > 0),\n+    () =>\n+      envVars.some(\n+        (r) => r.name.trim().length > 0 || r.value.trim().length > 0\n+      ),\n     [envVars]\n   );\n   const maintenanceScriptValue = maintenanceScript.trim();\n@@ -701,7 +536,11 @@ export function PreviewConfigureClient({\n \n   // Collapse env section when entering configure step if it's already satisfied\n   useEffect(() => {\n-    if (!hasCompletedSetup || !envDone || envSectionCollapsedOnEnterRef.current) {\n+    if (\n+      !hasCompletedSetup ||\n+      !envDone ||\n+      envSectionCollapsedOnEnterRef.current\n+    ) {\n       return;\n     }\n     setIsEnvSectionOpen(false);\n@@ -710,7 +549,11 @@ export function PreviewConfigureClient({\n \n   // Auto-enter configuration once VS Code is available when resuming an existing environment\n   useEffect(() => {\n-    if (startAtConfigureEnvironment && instance?.vscodeUrl && !hasCompletedSetup) {\n+    if (\n+      startAtConfigureEnvironment &&\n+      instance?.vscodeUrl &&\n+      !hasCompletedSetup\n+    ) {\n       setHasCompletedSetup(true);\n     }\n   }, [hasCompletedSetup, instance?.vscodeUrl, startAtConfigureEnvironment]);\n@@ -762,9 +605,10 @@ export function PreviewConfigureClient({\n       const data = (await response.json()) as SandboxInstance;\n       const normalizedFromResponse =\n         data.vncUrl && data.vncUrl.trim().length > 0\n-          ? normalizeVncUrl(data.vncUrl) ?? data.vncUrl\n+          ? (normalizeVncUrl(data.vncUrl) ?? data.vncUrl)\n           : null;\n-      const derived = normalizedFromResponse ?? deriveVncUrl(data.instanceId, data.vscodeUrl);\n+      const derived =\n+        normalizedFromResponse ?? deriveVncUrl(data.instanceId, data.vscodeUrl);\n \n       if (selectedTeamSlugOrIdRef.current !== resolvedTeamSlugOrId) {\n         return;\n@@ -775,7 +619,10 @@ export function PreviewConfigureClient({\n         vncUrl: derived ?? undefined,\n       });\n     } catch (error) {\n-      const message = error instanceof Error ? error.message : \"Failed to provision workspace\";\n+      const message =\n+        error instanceof Error\n+          ? error.message\n+          : \"Failed to provision workspace\";\n       if (selectedTeamSlugOrIdRef.current === resolvedTeamSlugOrId) {\n         setErrorMessage(message);\n       }\n@@ -792,7 +639,13 @@ export function PreviewConfigureClient({\n     if (!instance && !isProvisioning && !errorMessage) {\n       void provisionVM();\n     }\n-  }, [instance, isProvisioning, errorMessage, provisionVM, resolvedTeamSlugOrId]);\n+  }, [\n+    instance,\n+    isProvisioning,\n+    errorMessage,\n+    provisionVM,\n+    resolvedTeamSlugOrId,\n+  ]);\n \n   useEffect(() => {\n     if (pendingFocusIndex !== null) {\n@@ -823,7 +676,10 @@ export function PreviewConfigureClient({\n         .map((r) => ({ name: r.name, value: r.value }))\n     );\n \n-    if (envVarsContent.length === 0 && lastSubmittedEnvContent.current === null) {\n+    if (\n+      envVarsContent.length === 0 &&\n+      lastSubmittedEnvContent.current === null\n+    ) {\n       return;\n     }\n \n@@ -836,7 +692,10 @@ export function PreviewConfigureClient({\n         await fetch(`/api/sandboxes/${instance.instanceId}/env`, {\n           method: \"POST\",\n           headers: { \"Content-Type\": \"application/json\" },\n-          body: JSON.stringify({ teamSlugOrId: resolvedTeamSlugOrId, envVarsContent }),\n+          body: JSON.stringify({\n+            teamSlugOrId: resolvedTeamSlugOrId,\n+            envVarsContent,\n+          }),\n         });\n         lastSubmittedEnvContent.current = envVarsContent;\n       } catch (error) {\n@@ -853,19 +712,21 @@ export function PreviewConfigureClient({\n     setEnvVars((prev) => updater(prev));\n   }, []);\n \n-  const handleFrameworkPresetChange = useCallback((preset: FrameworkPreset) => {\n-    setFrameworkPreset(preset);\n-    setIsFrameworkMenuOpen(false);\n-    // Only auto-fill if user hasn't manually edited the scripts\n-    if (!hasUserEditedScripts) {\n-      const presetConfig = FRAMEWORK_PRESETS[preset];\n-      setMaintenanceScript(presetConfig.maintenanceScript);\n-      setDevScript(presetConfig.devScript);\n-      // Update none states based on whether the preset has scripts\n-      setMaintenanceNone(presetConfig.maintenanceScript.trim().length === 0);\n-      setDevNone(presetConfig.devScript.trim().length === 0);\n-    }\n-  }, [hasUserEditedScripts]);\n+  const handleFrameworkPresetChange = useCallback(\n+    (preset: FrameworkPreset) => {\n+      setFrameworkPreset(preset);\n+      // Only auto-fill if user hasn't manually edited the scripts\n+      if (!hasUserEditedScripts) {\n+        const presetConfig = FRAMEWORK_PRESETS[preset];\n+        setMaintenanceScript(presetConfig.maintenanceScript);\n+        setDevScript(presetConfig.devScript);\n+        // Update none states based on whether the preset has scripts\n+        setMaintenanceNone(presetConfig.maintenanceScript.trim().length === 0);\n+        setDevNone(presetConfig.devScript.trim().length === 0);\n+      }\n+    },\n+    [hasUserEditedScripts]\n+  );\n \n   const handleMaintenanceScriptChange = useCallback((value: string) => {\n     setMaintenanceNone(false);\n@@ -879,20 +740,17 @@ export function PreviewConfigureClient({\n     setHasUserEditedScripts(true);\n   }, []);\n \n-  const handleToggleEnvNone = useCallback(\n-    (value: boolean) => {\n-      setEnvNone(value);\n-      setActiveEnvValueIndex(null);\n-      if (value) {\n-        setAreEnvValuesHidden(true);\n-        setEnvVars([{ name: \"\", value: \"\", isSecret: true }]);\n-        setIsEnvOpen(false);\n-      } else {\n-        setIsEnvOpen(true);\n-      }\n-    },\n-    []\n-  );\n+  const handleToggleEnvNone = useCallback((value: boolean) => {\n+    setEnvNone(value);\n+    setActiveEnvValueIndex(null);\n+    if (value) {\n+      setAreEnvValuesHidden(true);\n+      setEnvVars([{ name: \"\", value: \"\", isSecret: true }]);\n+      setIsEnvOpen(false);\n+    } else {\n+      setIsEnvOpen(true);\n+    }\n+  }, []);\n \n   const handleToggleMaintenanceNone = useCallback((value: boolean) => {\n     setMaintenanceNone(value);\n@@ -911,7 +769,9 @@ export function PreviewConfigureClient({\n   }, []);\n \n   const handleCopyCommands = useCallback(async () => {\n-    const combined = [maintenanceScript.trim(), devScript.trim()].filter(Boolean).join(\" && \");\n+    const combined = [maintenanceScript.trim(), devScript.trim()]\n+      .filter(Boolean)\n+      .join(\" && \");\n     if (!combined) {\n       return;\n     }\n@@ -959,7 +819,9 @@ export function PreviewConfigureClient({\n     const normalizedMaintenanceScript = maintenanceScript.trim();\n     const normalizedDevScript = devScript.trim();\n     const requestMaintenanceScript =\n-      normalizedMaintenanceScript.length > 0 ? normalizedMaintenanceScript : undefined;\n+      normalizedMaintenanceScript.length > 0\n+        ? normalizedMaintenanceScript\n+        : undefined;\n     const requestDevScript =\n       normalizedDevScript.length > 0 ? normalizedDevScript : undefined;\n \n@@ -997,7 +859,9 @@ export function PreviewConfigureClient({\n           teamSlugOrId: resolvedTeamSlugOrId,\n           repoFullName: repo,\n           environmentId,\n-          repoInstallationId: _installationId ? Number(_installationId) : undefined,\n+          repoInstallationId: _installationId\n+            ? Number(_installationId)\n+            : undefined,\n           repoDefaultBranch: \"main\",\n           status: \"active\",\n         }),\n@@ -1009,7 +873,8 @@ export function PreviewConfigureClient({\n \n       window.location.href = \"/preview\";\n     } catch (error) {\n-      const message = error instanceof Error ? error.message : \"Failed to save configuration\";\n+      const message =\n+        error instanceof Error ? error.message : \"Failed to save configuration\";\n       setErrorMessage(message);\n       console.error(\"Failed to save preview configuration:\", error);\n     } finally {\n@@ -1041,14 +906,26 @@ export function PreviewConfigureClient({\n     if (instance.vscodeUrl) {\n       const vscodeUrl = new URL(instance.vscodeUrl);\n       vscodeUrl.searchParams.set(\"folder\", \"/root/workspace\");\n-      persistentIframeManager.getOrCreateIframe(vscodePersistKey, vscodeUrl.toString());\n+      persistentIframeManager.getOrCreateIframe(\n+        vscodePersistKey,\n+        vscodeUrl.toString()\n+      );\n     }\n \n     // Pre-create browser iframe if available\n     if (resolvedVncUrl) {\n-      persistentIframeManager.getOrCreateIframe(browserPersistKey, resolvedVncUrl);\n+      persistentIframeManager.getOrCreateIframe(\n+        browserPersistKey,\n+        resolvedVncUrl\n+      );\n     }\n-  }, [instance, persistentIframeManager, resolvedVncUrl, vscodePersistKey, browserPersistKey]);\n+  }, [\n+    instance,\n+    persistentIframeManager,\n+    resolvedVncUrl,\n+    vscodePersistKey,\n+    browserPersistKey,\n+  ]);\n \n   // Mount iframes to their targets when visible\n   useLayoutEffect(() => {\n@@ -1058,22 +935,24 @@ export function PreviewConfigureClient({\n \n     if (instance.vscodeUrl && currentStep === 1) {\n       const target = document.querySelector(\n-        `[data-iframe-target=\"${vscodePersistKey}\"]`,\n+        `[data-iframe-target=\"${vscodePersistKey}\"]`\n       ) as HTMLElement | null;\n       if (target) {\n-        cleanupFunctions.push(persistentIframeManager.mountIframe(vscodePersistKey, target));\n+        cleanupFunctions.push(\n+          persistentIframeManager.mountIframe(vscodePersistKey, target)\n+        );\n       }\n     }\n \n     if (resolvedVncUrl && currentStep === 2) {\n       const target = document.querySelector(\n-        `[data-iframe-target=\"${browserPersistKey}\"]`,\n+        `[data-iframe-target=\"${browserPersistKey}\"]`\n       ) as HTMLElement | null;\n       if (target) {\n         cleanupFunctions.push(\n           persistentIframeManager.mountIframe(browserPersistKey, target, {\n             backgroundColor: \"#000000\",\n-          }),\n+          })\n         );\n       }\n     }\n@@ -1098,8 +977,10 @@ export function PreviewConfigureClient({\n     }\n \n     // Hide iframes during setup screen, show based on step after setup\n-    const workspaceVisible = hasCompletedSetup && currentStep === 1 && Boolean(instance?.vscodeUrl);\n-    const browserVisible = hasCompletedSetup && currentStep === 2 && Boolean(resolvedVncUrl);\n+    const workspaceVisible =\n+      hasCompletedSetup && currentStep === 1 && Boolean(instance?.vscodeUrl);\n+    const browserVisible =\n+      hasCompletedSetup && currentStep === 2 && Boolean(resolvedVncUrl);\n \n     persistentIframeManager.setVisibility(vscodePersistKey, workspaceVisible);\n     persistentIframeManager.setVisibility(browserPersistKey, browserVisible);\n@@ -1141,14 +1022,15 @@ export function PreviewConfigureClient({\n     // When editing an existing environment, show loader until VS Code is ready\n     if (startAtConfigureEnvironment && !isWorkspaceReady) {\n       return (\n-        <div className=\"flex min-h-dvh items-center justify-center bg-white dark:bg-black font-mono\">\n+        <div className=\"flex min-h-dvh items-center justify-center bg-white dark:bg-black font-sans\">\n           <div className=\"text-center px-6\">\n             <Loader2 className=\"mx-auto h-8 w-8 animate-spin text-neutral-400\" />\n             <h1 className=\"mt-4 text-lg font-medium text-neutral-900 dark:text-neutral-100\">\n               Resuming your VS Code workspace...\n             </h1>\n             <p className=\"mt-2 text-sm text-neutral-500 dark:text-neutral-400\">\n-              We&apos;ll show the configuration form once your environment is ready.\n+              We&apos;ll show the configuration form once your environment is\n+              ready.\n             </p>\n           </div>\n         </div>\n@@ -1156,7 +1038,7 @@ export function PreviewConfigureClient({\n     }\n \n     return (\n-      <div className=\"min-h-dvh bg-white dark:bg-black font-mono\">\n+      <div className=\"min-h-dvh bg-white dark:bg-black font-sans\">\n         {/* Main Content */}\n         <div className=\"max-w-2xl mx-auto px-6 py-10\">\n           <div className=\"mb-3\">\n@@ -1174,82 +1056,31 @@ export function PreviewConfigureClient({\n             <h1 className=\"text-2xl font-semibold text-neutral-900 dark:text-neutral-100 mb-1\">\n               Configure Project\n             </h1>\n-            <div className=\"flex items-center gap-2 text-sm text-neutral-600 dark:text-neutral-400\">\n-              <Github className=\"h-4 w-4\" />\n-              <span className=\"font-mono\">{repo}</span>\n+            <div className=\"flex items-center gap-2 text-sm text-neutral-600 dark:text-neutral-400 pt-2\">\n+              <svg\n+                className=\"h-4 w-4 shrink-0 text-white\"\n+                viewBox=\"0 0 24 24\"\n+                fill=\"currentColor\"\n+              >\n+                <path d=\"M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z\" />\n+              </svg>\n+              <span className=\"font-sans\">{repo}</span>\n             </div>\n           </div>\n \n           <div className=\"space-y-6\">\n             {/* Framework Preset */}\n-            <div>\n-              <label className=\"block text-sm font-medium text-neutral-900 dark:text-neutral-100 mb-2\">\n-                Framework Preset\n-              </label>\n-              <div className=\"relative\" ref={frameworkSelectRef}>\n-                <button\n-                  type=\"button\"\n-                  aria-haspopup=\"listbox\"\n-                  aria-expanded={isFrameworkMenuOpen}\n-                  onClick={() => setIsFrameworkMenuOpen((prev) => !prev)}\n-                  className=\"flex w-full items-center justify-between rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-3 py-2.5 text-sm text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700\"\n-                >\n-                  <span className=\"flex items-center gap-3\">\n-                    <FrameworkIconBubble preset={frameworkPreset} />\n-                    <span className=\"text-left\">\n-                      <span className=\"block font-medium\">{selectedFrameworkConfig.name}</span>\n-                      <span className=\"block text-xs text-neutral-500 dark:text-neutral-400\">\n-                        Autofills install and dev scripts\n-                      </span>\n-                    </span>\n-                  </span>\n-                  <ChevronDown\n-                    className={clsx(\n-                      \"h-4 w-4 text-neutral-400 transition-transform\",\n-                      isFrameworkMenuOpen && \"rotate-180\"\n-                    )}\n-                  />\n-                </button>\n-                {isFrameworkMenuOpen ? (\n-                  <div className=\"absolute z-20 mt-2 w-full rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 shadow-lg\">\n-                    <ul className=\"max-h-64 overflow-y-auto py-1\" role=\"listbox\">\n-                      {frameworkOptions.map(([key, config]) => (\n-                        <li key={key}>\n-                          <button\n-                            type=\"button\"\n-                            role=\"option\"\n-                            aria-selected={frameworkPreset === key}\n-                            onClick={() => handleFrameworkPresetChange(key as FrameworkPreset)}\n-                            className={clsx(\n-                              \"flex w-full items-center gap-3 px-3 py-2 text-left text-sm transition\",\n-                              frameworkPreset === key\n-                                ? \"bg-neutral-100 dark:bg-neutral-900\"\n-                                : \"hover:bg-neutral-50 dark:hover:bg-neutral-900/80\"\n-                            )}\n-                          >\n-                            <FrameworkIconBubble preset={key as FrameworkPreset} />\n-                            <div className=\"flex-1\">\n-                              <div className=\"font-medium text-neutral-900 dark:text-neutral-100\">\n-                                {config.name}\n-                              </div>\n-                              <div className=\"text-xs text-neutral-500 dark:text-neutral-400\">\n-                                Default: {config.devScript || \"Custom\"}\n-                              </div>\n-                            </div>\n-                          </button>\n-                        </li>\n-                      ))}\n-                    </ul>\n-                  </div>\n-                ) : null}\n-              </div>\n-              <p className=\"mt-2 text-xs text-neutral-500 dark:text-neutral-400\">\n-                Workspace root <code className=\"rounded bg-neutral-100 px-1 py-0.5 text-neutral-700 dark:bg-neutral-900 dark:text-neutral-200\">/root/workspace</code> maps directly to your repository root.\n-              </p>\n-            </div>\n+            <FrameworkPresetSelect\n+              value={frameworkPreset}\n+              onValueChange={handleFrameworkPresetChange}\n+            />\n \n             {/* Maintenance and Dev Scripts - Collapsible */}\n-            <details className=\"group\" open={isBuildOpen} onToggle={(e) => setIsBuildOpen(e.currentTarget.open)}>\n+            <details\n+              className=\"group\"\n+              open={isBuildOpen}\n+              onToggle={(e) => setIsBuildOpen(e.currentTarget.open)}\n+            >\n               <summary className=\"flex items-center gap-2 cursor-pointer text-base font-semibold text-neutral-900 dark:text-neutral-100 list-none\">\n                 <ChevronDown className=\"h-4 w-4 text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\" />\n                 Maintenance and Dev Scripts\n@@ -1261,12 +1092,19 @@ export function PreviewConfigureClient({\n                   </label>\n                   <textarea\n                     value={maintenanceScript ?? \"\"}\n-                    onChange={(e) => handleMaintenanceScriptChange(e.target.value)}\n-                    placeholder={\"npm install, bun install, pip install -r requirements.txt\"}\n+                    onChange={(e) =>\n+                      handleMaintenanceScriptChange(e.target.value)\n+                    }\n+                    placeholder={\n+                      \"npm install, bun install, pip install -r requirements.txt\"\n+                    }\n                     rows={2}\n-                    className=\"w-full rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-3 py-2 text-sm font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 resize-none\"\n+                    className=\"w-full rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-3 py-2 text-xs font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 resize-none\"\n                   />\n-                  <p className=\"text-xs text-neutral-400 mt-1\">Runs after git pull to install dependencies (e.g. npm install, bun install, pip install -r requirements.txt)</p>\n+                  <p className=\"text-xs text-neutral-400 mt-1\">\n+                    Runs after git pull to install dependencies (e.g. npm\n+                    install, bun install, pip install -r requirements.txt)\n+                  </p>\n                 </div>\n                 <div>\n                   <label className=\"block text-xs text-neutral-500 dark:text-neutral-400 mb-1.5\">\n@@ -1275,17 +1113,26 @@ export function PreviewConfigureClient({\n                   <textarea\n                     value={devScript ?? \"\"}\n                     onChange={(e) => handleDevScriptChange(e.target.value)}\n-                    placeholder={\"npm run dev, bun dev, python manage.py runserver\"}\n+                    placeholder={\n+                      \"npm run dev, bun dev, python manage.py runserver\"\n+                    }\n                     rows={2}\n-                    className=\"w-full rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-3 py-2 text-sm font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 resize-none\"\n+                    className=\"w-full rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-3 py-2 text-xs font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 resize-none\"\n                   />\n-                  <p className=\"text-xs text-neutral-400 mt-1\">Starts the development server (e.g. npm run dev, bun dev, python manage.py runserver)</p>\n+                  <p className=\"text-xs text-neutral-400 mt-1\">\n+                    Starts the development server (e.g. npm run dev, bun dev,\n+                    python manage.py runserver)\n+                  </p>\n                 </div>\n-            </div>\n-          </details>\n+              </div>\n+            </details>\n \n             {/* Environment Variables - Collapsible */}\n-            <details className=\"group\" open={isEnvOpen} onToggle={(e) => setIsEnvOpen(e.currentTarget.open)}>\n+            <details\n+              className=\"group\"\n+              open={isEnvOpen}\n+              onToggle={(e) => setIsEnvOpen(e.currentTarget.open)}\n+            >\n               <summary className=\"flex items-center gap-2 cursor-pointer text-base font-semibold text-neutral-900 dark:text-neutral-100 list-none\">\n                 <ChevronDown className=\"h-4 w-4 text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\" />\n                 <span>Environment Variables</span>\n@@ -1298,7 +1145,9 @@ export function PreviewConfigureClient({\n                       setAreEnvValuesHidden((previous) => !previous);\n                     }}\n                     className=\"text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-300 transition p-0.5\"\n-                    aria-label={areEnvValuesHidden ? \"Reveal values\" : \"Hide values\"}\n+                    aria-label={\n+                      areEnvValuesHidden ? \"Reveal values\" : \"Hide values\"\n+                    }\n                   >\n                     {areEnvValuesHidden ? (\n                       <EyeOff className=\"h-4 w-4\" />\n@@ -1321,7 +1170,11 @@ export function PreviewConfigureClient({\n                       updateEnvVars((prev) => {\n                         const map = new Map(\n                           prev\n-                            .filter((r) => r.name.trim().length > 0 || r.value.trim().length > 0)\n+                            .filter(\n+                              (r) =>\n+                                r.name.trim().length > 0 ||\n+                                r.value.trim().length > 0\n+                            )\n                             .map((r) => [r.name, r] as const)\n                         );\n                         for (const it of items) {\n@@ -1330,7 +1183,11 @@ export function PreviewConfigureClient({\n                           if (existing) {\n                             map.set(it.name, { ...existing, value: it.value });\n                           } else {\n-                            map.set(it.name, { name: it.name, value: it.value, isSecret: true });\n+                            map.set(it.name, {\n+                              name: it.name,\n+                              value: it.value,\n+                              isSecret: true,\n+                            });\n                           }\n                         }\n                         const next = Array.from(map.values());\n@@ -1343,8 +1200,10 @@ export function PreviewConfigureClient({\n                 }}\n               >\n                 <div\n-                  className=\"grid gap-2 text-xs text-neutral-500 dark:text-neutral-500 items-center pr-10\"\n-                  style={{ gridTemplateColumns: \"minmax(0, 1fr) minmax(0, 1.5fr) 40px\" }}\n+                  className=\"grid gap-2 text-xs text-neutral-500 dark:text-neutral-500 items-center pr-10 mb-1\"\n+                  style={{\n+                    gridTemplateColumns: \"minmax(0, 1fr) minmax(0, 1.5fr) 40px\",\n+                  }}\n                 >\n                   <span>Name</span>\n                   <span>Value</span>\n@@ -1354,22 +1213,28 @@ export function PreviewConfigureClient({\n                 {envVars.map((row, idx) => {\n                   const rowKey = idx;\n                   const isEditingValue = activeEnvValueIndex === idx;\n-                  const shouldMaskValue = areEnvValuesHidden && row.value.trim().length > 0 && !isEditingValue;\n+                  const shouldMaskValue =\n+                    areEnvValuesHidden &&\n+                    row.value.trim().length > 0 &&\n+                    !isEditingValue;\n                   return (\n                     <div\n                       key={rowKey}\n-                      className=\"grid gap-2 items-center pr-10\"\n-                    style={{ gridTemplateColumns: \"minmax(0, 1fr) minmax(0, 1.5fr) 40px\" }}\n-                  >\n-                    <input\n-                      type=\"text\"\n-                      value={row.name}\n-                      disabled={envNone}\n-                      ref={(el) => {\n-                        keyInputRefs.current[idx] = el;\n+                      className=\"grid gap-2 items-center pr-10 min-h-9\"\n+                      style={{\n+                        gridTemplateColumns:\n+                          \"minmax(0, 1fr) minmax(0, 1.5fr) 40px\",\n                       }}\n-                      onChange={(e) => {\n-                        const v = e.target.value;\n+                    >\n+                      <input\n+                        type=\"text\"\n+                        value={row.name}\n+                        disabled={envNone}\n+                        ref={(el) => {\n+                          keyInputRefs.current[idx] = el;\n+                        }}\n+                        onChange={(e) => {\n+                          const v = e.target.value;\n                           setEnvNone(false);\n                           updateEnvVars((prev) => {\n                             const next = [...prev];\n@@ -1377,21 +1242,21 @@ export function PreviewConfigureClient({\n                             if (current) {\n                               next[idx] = { ...current, name: v };\n                             }\n-                          return next;\n-                        });\n-                      }}\n-                      placeholder=\"EXAMPLE_NAME\"\n-                      className=\"w-full min-w-0 rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-3 py-2 text-sm font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 disabled:opacity-60 disabled:cursor-not-allowed\"\n-                    />\n-                    <input\n-                      type={shouldMaskValue ? \"password\" : \"text\"}\n-                      value={shouldMaskValue ? MASKED_ENV_VALUE : row.value}\n-                      disabled={envNone}\n-                      onChange={\n-                        shouldMaskValue\n-                          ? undefined\n-                          : (e) => {\n-                              const v = e.target.value;\n+                            return next;\n+                          });\n+                        }}\n+                        placeholder=\"EXAMPLE_NAME\"\n+                        className=\"w-full min-w-0 h-9 rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-3 text-sm font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 disabled:opacity-60 disabled:cursor-not-allowed\"\n+                      />\n+                      <input\n+                        type={shouldMaskValue ? \"password\" : \"text\"}\n+                        value={shouldMaskValue ? MASKED_ENV_VALUE : row.value}\n+                        disabled={envNone}\n+                        onChange={\n+                          shouldMaskValue\n+                            ? undefined\n+                            : (e) => {\n+                                const v = e.target.value;\n                                 setEnvNone(false);\n                                 updateEnvVars((prev) => {\n                                   const next = [...prev];\n@@ -1402,46 +1267,60 @@ export function PreviewConfigureClient({\n                                   return next;\n                                 });\n                               }\n-                      }\n-                      onFocus={() => setActiveEnvValueIndex(idx)}\n-                      onBlur={() => setActiveEnvValueIndex((current) => (current === idx ? null : current))}\n-                      readOnly={shouldMaskValue}\n-                      placeholder=\"I9JU23NF394R6HH\"\n-                      className=\"w-full min-w-0 rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-3 py-2 text-sm font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 disabled:opacity-60 disabled:cursor-not-allowed\"\n-                    />\n-                    <button\n-                      type=\"button\"\n-                      disabled={envNone}\n-                      onClick={() => {\n-                        updateEnvVars((prev) => {\n-                          const next = prev.filter((_, i) => i !== idx);\n-                          return next.length > 0 ? next : [{ name: \"\", value: \"\", isSecret: true }];\n-                        });\n-                      }}\n-                      className=\"h-9 w-9 rounded-md border border-neutral-200 dark:border-neutral-800 text-neutral-500 dark:text-neutral-400 grid place-items-center hover:bg-neutral-50 dark:hover:bg-neutral-900 disabled:opacity-60 disabled:cursor-not-allowed\"\n-                      aria-label=\"Remove variable\"\n-                    >\n-                      <Minus className=\"w-4 h-4\" />\n-                    </button>\n-                  </div>\n-                );\n-              })}\n-\n-                <div className=\"pt-2\">\n+                        }\n+                        onFocus={() => setActiveEnvValueIndex(idx)}\n+                        onBlur={() =>\n+                          setActiveEnvValueIndex((current) =>\n+                            current === idx ? null : current\n+                          )\n+                        }\n+                        readOnly={shouldMaskValue}\n+                        placeholder=\"I9JU23NF394R6HH\"\n+                        className=\"w-full min-w-0 h-9 rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-3 text-sm font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 disabled:opacity-60 disabled:cursor-not-allowed\"\n+                      />\n+                      <button\n+                        type=\"button\"\n+                        disabled={envNone || envVars.length <= 1}\n+                        onClick={() => {\n+                          updateEnvVars((prev) => {\n+                            const next = prev.filter((_, i) => i !== idx);\n+                            return next.length > 0\n+                              ? next\n+                              : [{ name: \"\", value: \"\", isSecret: true }];\n+                          });\n+                        }}\n+                        className={clsx(\n+                          \"h-9 w-9 rounded-md border border-neutral-200 dark:border-neutral-800 text-neutral-500 dark:text-neutral-400 grid place-items-center\",\n+                          envNone || envVars.length <= 1\n+                            ? \"opacity-60 cursor-not-allowed\"\n+                            : \"hover:bg-neutral-50 dark:hover:bg-neutral-900\"\n+                        )}\n+                        aria-label=\"Remove variable\"\n+                      >\n+                        <Minus className=\"w-4 h-4\" />\n+                      </button>\n+                    </div>\n+                  );\n+                })}\n+\n+                <div className=\"mt-1\">\n                   <button\n                     type=\"button\"\n                     onClick={() =>\n-                      updateEnvVars((prev) => [...prev, { name: \"\", value: \"\", isSecret: true }])\n+                      updateEnvVars((prev) => [\n+                        ...prev,\n+                        { name: \"\", value: \"\", isSecret: true },\n+                      ])\n                     }\n                     disabled={envNone}\n-                    className=\"inline-flex items-center gap-2 rounded-md border border-neutral-200 dark:border-neutral-800 px-3 py-2 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-neutral-50 dark:hover:bg-neutral-900 transition disabled:opacity-60 disabled:cursor-not-allowed\"\n+                    className=\"inline-flex items-center gap-2 h-9 rounded-md border border-neutral-200 dark:border-neutral-800 px-3 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-neutral-50 dark:hover:bg-neutral-900 transition disabled:opacity-60 disabled:cursor-not-allowed\"\n                   >\n-                    <Plus className=\"w-4 h-4\" /> Add Variable\n+                    <Plus className=\"w-4 h-4\" /> Add variable\n                   </button>\n                 </div>\n               </div>\n \n-              <p className=\"text-xs text-neutral-400 dark:text-neutral-400 pl-6 mt-2\">\n+              <p className=\"text-xs text-neutral-400 dark:text-neutral-400 pl-6 mt-4\">\n                 Tip: Paste a .env file to auto-fill\n               </p>\n             </details>\n@@ -1449,25 +1328,7 @@ export function PreviewConfigureClient({\n \n           {/* Next Button */}\n           <div className=\"mt-10 pt-6 border-t border-neutral-200 dark:border-neutral-800\">\n-            <div className=\"flex items-center justify-between gap-4\">\n-              <div className=\"flex items-center gap-2 text-xs text-neutral-600 dark:text-neutral-400\">\n-                {isProvisioning ? (\n-                  <>\n-                    <Loader2 className=\"h-3 w-3 animate-spin\" />\n-                    <span>Provisioning workspace...</span>\n-                  </>\n-                ) : isWorkspaceReady ? (\n-                  <>\n-                    <span className=\"inline-block h-2 w-2 rounded-full bg-green-500\" />\n-                    <span>Workspace ready</span>\n-                  </>\n-                ) : (\n-                  <>\n-                    <span className=\"inline-block h-2 w-2 rounded-full bg-neutral-400 dark:bg-neutral-600\" />\n-                    <span>Waiting for workspace...</span>\n-                  </>\n-                )}\n-              </div>\n+            <div className=\"flex items-center justify-end gap-4\">\n               <button\n                 type=\"button\"\n                 disabled={!isWorkspaceReady}\n@@ -1475,7 +1336,7 @@ export function PreviewConfigureClient({\n                 className={clsx(\n                   \"inline-flex items-center gap-2 rounded-md px-5 py-2.5 text-sm font-semibold transition\",\n                   isWorkspaceReady\n-                    ? \"bg-neutral-900 dark:bg-neutral-100 text-white dark:text-neutral-900 hover:bg-neutral-800 dark:hover:bg-neutral-200\"\n+                    ? \"bg-neutral-900 dark:bg-neutral-100 text-white dark:text-neutral-900 hover:bg-neutral-800 dark:hover:bg-neutral-200 cursor-pointer\"\n                     : \"bg-neutral-900 dark:bg-neutral-100 text-white dark:text-neutral-900 opacity-50 cursor-not-allowed\"\n                 )}\n               >\n@@ -1493,15 +1354,25 @@ export function PreviewConfigureClient({\n     <div className=\"space-y-5\">\n       {/* Workspace Info */}\n       <p className=\"text-[11px] text-neutral-500 dark:text-neutral-400 leading-relaxed\">\n-        Your workspace root at <code className=\"px-1 py-0.5 rounded bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-700 dark:text-neutral-300\">/root/workspace</code> maps directly to your repo root.\n+        Your workspace root at{\" \"}\n+        <code className=\"px-1 py-0.5 rounded bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-700 dark:text-neutral-300\">\n+          /root/workspace\n+        </code>{\" \"}\n+        maps directly to your repo root.\n       </p>\n \n       {/* Maintenance Script */}\n-      <details className=\"group\" open={isMaintenanceSectionOpen} onToggle={(e) => setIsMaintenanceSectionOpen(e.currentTarget.open)}>\n+      <details\n+        className=\"group\"\n+        open={isMaintenanceSectionOpen}\n+        onToggle={(e) => setIsMaintenanceSectionOpen(e.currentTarget.open)}\n+      >\n         <summary className=\"flex items-center gap-2 cursor-pointer list-none\">\n           <ChevronDown className=\"h-3.5 w-3.5 text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\" />\n           <StepBadge step={1} done={maintenanceDone} />\n-          <span className=\"text-[13px] font-medium text-neutral-900 dark:text-neutral-100\">Maintenance script</span>\n+          <span className=\"text-[13px] font-medium text-neutral-900 dark:text-neutral-100\">\n+            Maintenance script\n+          </span>\n         </summary>\n         <div className=\"mt-3 ml-6 space-y-2\">\n           <p className=\"text-[11px] text-neutral-500 dark:text-neutral-400\">\n@@ -1510,14 +1381,21 @@ export function PreviewConfigureClient({\n           <textarea\n             value={maintenanceScript ?? \"\"}\n             onChange={(e) => handleMaintenanceScriptChange(e.target.value)}\n-            placeholder={\"npm install, bun install, pip install -r requirements.txt\"}\n+            placeholder={\n+              \"npm install, bun install, pip install -r requirements.txt\"\n+            }\n             disabled={maintenanceNone}\n             rows={2}\n             className=\"w-full min-w-0 rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-2.5 py-1.5 text-[12px] font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 disabled:opacity-60 disabled:cursor-not-allowed resize-none\"\n           />\n           <div className=\"flex items-center justify-end\">\n             <label className=\"flex items-center gap-1.5 text-[10px] text-neutral-400 cursor-pointer hover:text-neutral-600 dark:hover:text-neutral-300\">\n-              <input type=\"checkbox\" checked={maintenanceNone} onChange={(e) => handleToggleMaintenanceNone(e.target.checked)} className=\"h-3.5 w-3.5 rounded border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-950 text-emerald-500 focus:ring-2 focus:ring-emerald-500/40\" />\n+              <input\n+                type=\"checkbox\"\n+                checked={maintenanceNone}\n+                onChange={(e) => handleToggleMaintenanceNone(e.target.checked)}\n+                className=\"h-3.5 w-3.5 rounded border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-950 text-emerald-500 focus:ring-2 focus:ring-emerald-500/40\"\n+              />\n               None\n             </label>\n           </div>\n@@ -1525,11 +1403,17 @@ export function PreviewConfigureClient({\n       </details>\n \n       {/* Dev Script */}\n-      <details className=\"group\" open={isDevSectionOpen} onToggle={(e) => setIsDevSectionOpen(e.currentTarget.open)}>\n+      <details\n+        className=\"group\"\n+        open={isDevSectionOpen}\n+        onToggle={(e) => setIsDevSectionOpen(e.currentTarget.open)}\n+      >\n         <summary className=\"flex items-center gap-2 cursor-pointer list-none\">\n           <ChevronDown className=\"h-3.5 w-3.5 text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\" />\n           <StepBadge step={2} done={devDone} />\n-          <span className=\"text-[13px] font-medium text-neutral-900 dark:text-neutral-100\">Dev script</span>\n+          <span className=\"text-[13px] font-medium text-neutral-900 dark:text-neutral-100\">\n+            Dev script\n+          </span>\n         </summary>\n         <div className=\"mt-3 ml-6 space-y-2\">\n           <p className=\"text-[11px] text-neutral-500 dark:text-neutral-400\">\n@@ -1545,7 +1429,12 @@ export function PreviewConfigureClient({\n           />\n           <div className=\"flex items-center justify-end\">\n             <label className=\"flex items-center gap-1.5 text-[10px] text-neutral-400 cursor-pointer hover:text-neutral-600 dark:hover:text-neutral-300\">\n-              <input type=\"checkbox\" checked={devNone} onChange={(e) => handleToggleDevNone(e.target.checked)} className=\"h-3.5 w-3.5 rounded border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-950 text-emerald-500 focus:ring-2 focus:ring-emerald-500/40\" />\n+              <input\n+                type=\"checkbox\"\n+                checked={devNone}\n+                onChange={(e) => handleToggleDevNone(e.target.checked)}\n+                className=\"h-3.5 w-3.5 rounded border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-950 text-emerald-500 focus:ring-2 focus:ring-emerald-500/40\"\n+              />\n               None\n             </label>\n           </div>\n@@ -1553,18 +1442,32 @@ export function PreviewConfigureClient({\n       </details>\n \n       {/* Environment Variables */}\n-      <details className=\"group\" open={isEnvSectionOpen} onToggle={(e) => setIsEnvSectionOpen(e.currentTarget.open)}>\n+      <details\n+        className=\"group\"\n+        open={isEnvSectionOpen}\n+        onToggle={(e) => setIsEnvSectionOpen(e.currentTarget.open)}\n+      >\n         <summary className=\"flex items-center gap-2 cursor-pointer list-none\">\n           <ChevronDown className=\"h-3.5 w-3.5 text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\" />\n           <StepBadge step={3} done={envDone} />\n-          <span className=\"text-[13px] font-medium text-neutral-900 dark:text-neutral-100\">Environment variables</span>\n+          <span className=\"text-[13px] font-medium text-neutral-900 dark:text-neutral-100\">\n+            Environment variables\n+          </span>\n           <button\n             type=\"button\"\n-            onClick={(e) => { e.preventDefault(); setActiveEnvValueIndex(null); setAreEnvValuesHidden((prev) => !prev); }}\n+            onClick={(e) => {\n+              e.preventDefault();\n+              setActiveEnvValueIndex(null);\n+              setAreEnvValuesHidden((prev) => !prev);\n+            }}\n             className=\"ml-auto text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-300 p-0.5\"\n             aria-label={areEnvValuesHidden ? \"Reveal values\" : \"Hide values\"}\n           >\n-            {areEnvValuesHidden ? <EyeOff className=\"h-3.5 w-3.5\" /> : <Eye className=\"h-3.5 w-3.5\" />}\n+            {areEnvValuesHidden ? (\n+              <EyeOff className=\"h-3.5 w-3.5\" />\n+            ) : (\n+              <Eye className=\"h-3.5 w-3.5\" />\n+            )}\n           </button>\n         </summary>\n         <div\n@@ -1577,12 +1480,25 @@ export function PreviewConfigureClient({\n               if (items.length > 0) {\n                 setEnvNone(false);\n                 updateEnvVars((prev) => {\n-                  const map = new Map(prev.filter((r) => r.name.trim().length > 0 || r.value.trim().length > 0).map((r) => [r.name, r] as const));\n+                  const map = new Map(\n+                    prev\n+                      .filter(\n+                        (r) =>\n+                          r.name.trim().length > 0 || r.value.trim().length > 0\n+                      )\n+                      .map((r) => [r.name, r] as const)\n+                  );\n                   for (const it of items) {\n                     if (!it.name) continue;\n                     const existing = map.get(it.name);\n-                    if (existing) map.set(it.name, { ...existing, value: it.value });\n-                    else map.set(it.name, { name: it.name, value: it.value, isSecret: true });\n+                    if (existing)\n+                      map.set(it.name, { ...existing, value: it.value });\n+                    else\n+                      map.set(it.name, {\n+                        name: it.name,\n+                        value: it.value,\n+                        isSecret: true,\n+                      });\n                   }\n                   const next = Array.from(map.values());\n                   next.push({ name: \"\", value: \"\", isSecret: true });\n@@ -1593,41 +1509,96 @@ export function PreviewConfigureClient({\n             }\n           }}\n         >\n-          <div className=\"grid gap-2 text-[10px] text-neutral-500 items-center\" style={{ gridTemplateColumns: \"minmax(0, 1fr) minmax(0, 1.5fr) 28px\" }}>\n+          <div\n+            className=\"grid gap-2 text-[10px] text-neutral-500 items-center min-h-7\"\n+            style={{\n+              gridTemplateColumns: \"minmax(0, 1fr) minmax(0, 1.5fr) 28px\",\n+            }}\n+          >\n             <span>Key</span>\n             <span>Value</span>\n             <span />\n           </div>\n           {envVars.map((row, idx) => {\n             const isEditingValue = activeEnvValueIndex === idx;\n-            const shouldMaskValue = areEnvValuesHidden && row.value.trim().length > 0 && !isEditingValue;\n+            const shouldMaskValue =\n+              areEnvValuesHidden &&\n+              row.value.trim().length > 0 &&\n+              !isEditingValue;\n             return (\n-              <div key={idx} className=\"grid gap-2 items-center\" style={{ gridTemplateColumns: \"minmax(0, 1fr) minmax(0, 1.5fr) 28px\" }}>\n+              <div\n+                key={idx}\n+                className=\"grid gap-2 items-center min-h-7\"\n+                style={{\n+                  gridTemplateColumns: \"minmax(0, 1fr) minmax(0, 1.5fr) 28px\",\n+                }}\n+              >\n                 <input\n                   type=\"text\"\n                   value={row.name}\n                   disabled={envNone}\n-                  ref={(el) => { keyInputRefs.current[idx] = el; }}\n-                  onChange={(e) => { setEnvNone(false); updateEnvVars((prev) => { const next = [...prev]; if (next[idx]) next[idx] = { ...next[idx], name: e.target.value }; return next; }); }}\n+                  ref={(el) => {\n+                    keyInputRefs.current[idx] = el;\n+                  }}\n+                  onChange={(e) => {\n+                    setEnvNone(false);\n+                    updateEnvVars((prev) => {\n+                      const next = [...prev];\n+                      if (next[idx])\n+                        next[idx] = { ...next[idx], name: e.target.value };\n+                      return next;\n+                    });\n+                  }}\n                   placeholder=\"EXAMPLE_NAME\"\n-                  className=\"w-full min-w-0 rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-2.5 py-1.5 text-[12px] font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 disabled:opacity-60 disabled:cursor-not-allowed\"\n+                  className=\"w-full min-w-0 h-7 rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-2.5 text-[12px] font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 disabled:opacity-60 disabled:cursor-not-allowed\"\n                 />\n                 <input\n                   type=\"text\"\n                   value={shouldMaskValue ? MASKED_ENV_VALUE : row.value}\n                   disabled={envNone}\n-                  onChange={shouldMaskValue ? undefined : (e) => { setEnvNone(false); updateEnvVars((prev) => { const next = [...prev]; if (next[idx]) next[idx] = { ...next[idx], value: e.target.value }; return next; }); }}\n+                  onChange={\n+                    shouldMaskValue\n+                      ? undefined\n+                      : (e) => {\n+                          setEnvNone(false);\n+                          updateEnvVars((prev) => {\n+                            const next = [...prev];\n+                            if (next[idx])\n+                              next[idx] = {\n+                                ...next[idx],\n+                                value: e.target.value,\n+                              };\n+                            return next;\n+                          });\n+                        }\n+                  }\n                   onFocus={() => setActiveEnvValueIndex(idx)}\n-                  onBlur={() => setActiveEnvValueIndex((current) => (current === idx ? null : current))}\n+                  onBlur={() =>\n+                    setActiveEnvValueIndex((current) =>\n+                      current === idx ? null : current\n+                    )\n+                  }\n                   readOnly={shouldMaskValue}\n                   placeholder=\"I9JU23NF394R6HH\"\n-                  className=\"w-full min-w-0 rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-2.5 py-1.5 text-[12px] font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 disabled:opacity-60 disabled:cursor-not-allowed\"\n+                  className=\"w-full min-w-0 h-7 rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-2.5 text-[12px] font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 disabled:opacity-60 disabled:cursor-not-allowed\"\n                 />\n                 <button\n                   type=\"button\"\n-                  disabled={envNone}\n-                  onClick={() => updateEnvVars((prev) => { const next = prev.filter((_, i) => i !== idx); return next.length > 0 ? next : [{ name: \"\", value: \"\", isSecret: true }]; })}\n-                  className=\"h-7 w-7 rounded border border-neutral-200 dark:border-neutral-800 text-neutral-400 grid place-items-center hover:border-neutral-300 dark:hover:border-neutral-700 hover:text-neutral-600 dark:hover:text-neutral-200 disabled:opacity-50\"\n+                  disabled={envNone || envVars.length <= 1}\n+                  onClick={() =>\n+                    updateEnvVars((prev) => {\n+                      const next = prev.filter((_, i) => i !== idx);\n+                      return next.length > 0\n+                        ? next\n+                        : [{ name: \"\", value: \"\", isSecret: true }];\n+                    })\n+                  }\n+                  className={clsx(\n+                    \"h-7 w-7 rounded border border-neutral-200 dark:border-neutral-800 text-neutral-400 grid place-items-center\",\n+                    envNone || envVars.length <= 1\n+                      ? \"opacity-50 cursor-not-allowed\"\n+                      : \"hover:border-neutral-300 dark:hover:border-neutral-700 hover:text-neutral-600 dark:hover:text-neutral-200\"\n+                  )}\n                   aria-label=\"Remove\"\n                 >\n                   <Minus className=\"w-3 h-3\" />\n@@ -1639,48 +1610,100 @@ export function PreviewConfigureClient({\n             <button\n               type=\"button\"\n               disabled={envNone}\n-              onClick={() => updateEnvVars((prev) => [...prev, { name: \"\", value: \"\", isSecret: true }])}\n+              onClick={() =>\n+                updateEnvVars((prev) => [\n+                  ...prev,\n+                  { name: \"\", value: \"\", isSecret: true },\n+                ])\n+              }\n               className=\"inline-flex items-center gap-1 text-[11px] text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-300 disabled:opacity-50\"\n             >\n-              <Plus className=\"w-3 h-3\" /> Add\n+              <Plus className=\"w-3 h-3\" /> Add variable\n             </button>\n             <label className=\"flex items-center gap-1.5 text-[10px] text-neutral-400 cursor-pointer hover:text-neutral-600 dark:hover:text-neutral-300\">\n-              <input type=\"checkbox\" checked={envNone} onChange={(e) => handleToggleEnvNone(e.target.checked)} className=\"h-3.5 w-3.5 rounded border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-950 text-emerald-500 focus:ring-2 focus:ring-emerald-500/40\" />\n+              <input\n+                type=\"checkbox\"\n+                checked={envNone}\n+                onChange={(e) => handleToggleEnvNone(e.target.checked)}\n+                className=\"h-3.5 w-3.5 rounded border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-950 text-emerald-500 focus:ring-2 focus:ring-emerald-500/40\"\n+              />\n               None\n             </label>\n           </div>\n-          <p className=\"text-[10px] text-neutral-400\">Tip: Paste .env to auto-fill</p>\n+          <p className=\"text-[10px] text-neutral-400\">\n+            Tip: Paste .env to auto-fill\n+          </p>\n         </div>\n       </details>\n \n       {/* Run Scripts */}\n-      <details className=\"group\" open={isRunSectionOpen} onToggle={(e) => setIsRunSectionOpen(e.currentTarget.open)}>\n+      <details\n+        className=\"group\"\n+        open={isRunSectionOpen}\n+        onToggle={(e) => setIsRunSectionOpen(e.currentTarget.open)}\n+      >\n         <summary className=\"flex items-center gap-2 cursor-pointer list-none\">\n           <ChevronDown className=\"h-3.5 w-3.5 text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\" />\n           <StepBadge step={4} done={runConfirmed} />\n-          <span className=\"text-[13px] font-medium text-neutral-900 dark:text-neutral-100\">Run scripts in VS Code terminal</span>\n+          <span className=\"text-[13px] font-medium text-neutral-900 dark:text-neutral-100\">\n+            Run scripts in VS Code terminal\n+          </span>\n         </summary>\n         <div className=\"mt-3 ml-6 space-y-3\">\n           <p className=\"text-[11px] text-neutral-500 dark:text-neutral-400\">\n-            Open terminal (<kbd className=\"px-1 py-0.5 rounded bg-neutral-100 dark:bg-neutral-800 text-[10px] font-sans\">Ctrl+Shift+`</kbd> or <kbd className=\"px-1 py-0.5 rounded bg-neutral-100 dark:bg-neutral-800 text-[10px] font-sans\">Cmd+J</kbd>) and paste:\n+            Open terminal (\n+            <kbd className=\"px-1 py-0.5 rounded bg-neutral-100 dark:bg-neutral-800 text-[10px] font-sans\">\n+              Ctrl+Shift+`\n+            </kbd>{\" \"}\n+            or{\" \"}\n+            <kbd className=\"px-1 py-0.5 rounded bg-neutral-100 dark:bg-neutral-800 text-[10px] font-sans\">\n+              Cmd+J\n+            </kbd>\n+            ) and paste:\n           </p>\n           <div className=\"rounded-md border border-neutral-200 dark:border-neutral-800 bg-neutral-50 dark:bg-neutral-900 overflow-hidden\">\n-              <div className=\"flex items-center justify-between px-3 py-1.5 border-b border-neutral-200 dark:border-neutral-800 bg-neutral-100 dark:bg-neutral-800/50\">\n-                <span className=\"text-[10px] uppercase tracking-wide text-neutral-500\">Commands</span>\n-                {(maintenanceScriptValue || devScriptValue) && (\n-                  <button type=\"button\" onClick={handleCopyCommands} className={clsx(\"p-0.5\", commandsCopied ? \"text-emerald-500\" : \"text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-300\")}>\n-                    {commandsCopied ? <Check className=\"h-3 w-3\" /> : <Copy className=\"h-3 w-3\" />}\n-                  </button>\n-                )}\n-              </div>\n-              <pre className=\"px-3 py-2 text-[11px] font-mono text-neutral-900 dark:text-neutral-100 overflow-x-auto whitespace-pre-wrap break-all select-all\">\n-                {(maintenanceScriptValue || devScriptValue)\n-                  ? [maintenanceScript.trim(), devScript.trim()].filter(Boolean).join(\" && \")\n-                  : <span className=\"text-neutral-400 italic\">Enter scripts above to see commands</span>}\n-              </pre>\n+            <div className=\"flex items-center justify-between px-3 py-1.5 border-b border-neutral-200 dark:border-neutral-800 bg-neutral-100 dark:bg-neutral-800/50\">\n+              <span className=\"text-[10px] uppercase tracking-wide text-neutral-500\">\n+                Commands\n+              </span>\n+              {(maintenanceScriptValue || devScriptValue) && (\n+                <button\n+                  type=\"button\"\n+                  onClick={handleCopyCommands}\n+                  className={clsx(\n+                    \"p-0.5\",\n+                    commandsCopied\n+                      ? \"text-emerald-500\"\n+                      : \"text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-300\"\n+                  )}\n+                >\n+                  {commandsCopied ? (\n+                    <Check className=\"h-3 w-3\" />\n+                  ) : (\n+                    <Copy className=\"h-3 w-3\" />\n+                  )}\n+                </button>\n+              )}\n             </div>\n+            <pre className=\"px-3 py-2 text-[11px] font-mono text-neutral-900 dark:text-neutral-100 overflow-x-auto whitespace-pre-wrap break-all select-all\">\n+              {maintenanceScriptValue || devScriptValue ? (\n+                [maintenanceScript.trim(), devScript.trim()]\n+                  .filter(Boolean)\n+                  .join(\" && \")\n+              ) : (\n+                <span className=\"text-neutral-400 italic\">\n+                  Enter scripts above to see commands\n+                </span>\n+              )}\n+            </pre>\n+          </div>\n           <label className=\"flex items-center gap-1.5 text-[11px] text-neutral-500 dark:text-neutral-400 cursor-pointer hover:text-neutral-700 dark:hover:text-neutral-300\">\n-            <input type=\"checkbox\" checked={runConfirmed} onChange={(e) => setRunConfirmed(e.target.checked)} className=\"h-3.5 w-3.5 rounded border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-950 text-emerald-500 focus:ring-2 focus:ring-emerald-500/40\" />\n+            <input\n+              type=\"checkbox\"\n+              checked={runConfirmed}\n+              onChange={(e) => setRunConfirmed(e.target.checked)}\n+              className=\"h-3.5 w-3.5 rounded border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-950 text-emerald-500 focus:ring-2 focus:ring-emerald-500/40\"\n+            />\n             Proceed once dev script is running\n           </label>\n         </div>\n@@ -1691,11 +1714,17 @@ export function PreviewConfigureClient({\n   const renderStep2Content = () => (\n     <div className=\"space-y-5\">\n       {/* Browser Setup Info */}\n-      <details className=\"group\" open={isBrowserSetupSectionOpen} onToggle={(e) => setIsBrowserSetupSectionOpen(e.currentTarget.open)}>\n+      <details\n+        className=\"group\"\n+        open={isBrowserSetupSectionOpen}\n+        onToggle={(e) => setIsBrowserSetupSectionOpen(e.currentTarget.open)}\n+      >\n         <summary className=\"flex items-center gap-2 cursor-pointer list-none\">\n           <ChevronDown className=\"h-3.5 w-3.5 text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\" />\n           <StepBadge step={5} done={browserConfirmed} />\n-          <span className=\"text-[13px] font-medium text-neutral-900 dark:text-neutral-100\">Configure browser</span>\n+          <span className=\"text-[13px] font-medium text-neutral-900 dark:text-neutral-100\">\n+            Configure browser\n+          </span>\n         </summary>\n         <div className=\"mt-3 ml-6 space-y-3\">\n           <p className=\"text-[11px] text-neutral-500 dark:text-neutral-400\">\n@@ -1703,20 +1732,33 @@ export function PreviewConfigureClient({\n           </p>\n           <ul className=\"space-y-2 text-[11px] text-neutral-600 dark:text-neutral-400\">\n             <li className=\"flex items-start gap-2\">\n-              <span className=\"flex h-4 w-4 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-500 dark:text-neutral-400 flex-shrink-0 mt-0.5\">1</span>\n+              <span className=\"flex h-4 w-4 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-500 dark:text-neutral-400 flex-shrink-0 mt-0.5\">\n+                1\n+              </span>\n               <span>Sign in to any dashboards or SaaS tools</span>\n             </li>\n             <li className=\"flex items-start gap-2\">\n-              <span className=\"flex h-4 w-4 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-500 dark:text-neutral-400 flex-shrink-0 mt-0.5\">2</span>\n+              <span className=\"flex h-4 w-4 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-500 dark:text-neutral-400 flex-shrink-0 mt-0.5\">\n+                2\n+              </span>\n               <span>Dismiss cookie banners, popups, or MFA prompts</span>\n             </li>\n             <li className=\"flex items-start gap-2\">\n-              <span className=\"flex h-4 w-4 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-500 dark:text-neutral-400 flex-shrink-0 mt-0.5\">3</span>\n-              <span>Navigate to your dev server URL (e.g., localhost:3000)</span>\n+              <span className=\"flex h-4 w-4 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-500 dark:text-neutral-400 flex-shrink-0 mt-0.5\">\n+                3\n+              </span>\n+              <span>\n+                Navigate to your dev server URL (e.g., localhost:3000)\n+              </span>\n             </li>\n           </ul>\n           <label className=\"flex items-center gap-1.5 text-[11px] text-neutral-500 dark:text-neutral-400 cursor-pointer hover:text-neutral-700 dark:hover:text-neutral-300 pt-1\">\n-            <input type=\"checkbox\" checked={browserConfirmed} onChange={(e) => setBrowserConfirmed(e.target.checked)} className=\"h-3.5 w-3.5 rounded border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-950 text-emerald-500 focus:ring-2 focus:ring-emerald-500/40\" />\n+            <input\n+              type=\"checkbox\"\n+              checked={browserConfirmed}\n+              onChange={(e) => setBrowserConfirmed(e.target.checked)}\n+              className=\"h-3.5 w-3.5 rounded border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-950 text-emerald-500 focus:ring-2 focus:ring-emerald-500/40\"\n+            />\n             Browser is set up properly\n           </label>\n         </div>\n@@ -1725,7 +1767,8 @@ export function PreviewConfigureClient({\n       {/* Note about terminal */}\n       <div className=\"rounded-md border border-amber-200 dark:border-amber-900/50 bg-amber-50 dark:bg-amber-950/20 px-3 py-2.5\">\n         <p className=\"text-[11px] text-amber-800 dark:text-amber-200\">\n-          <strong>Note:</strong> Running terminals will be stopped on save. The maintenance and dev scripts run automatically on each preview.\n+          <strong>Note:</strong> Running terminals will be stopped on save. The\n+          maintenance and dev scripts run automatically on each preview.\n         </p>\n       </div>\n     </div>\n@@ -1733,7 +1776,9 @@ export function PreviewConfigureClient({\n \n   const renderPreviewPanel = () => {\n     const isVscodeStep = currentStep === 1;\n-    const placeholder = isVscodeStep ? workspacePlaceholder : browserPlaceholder;\n+    const placeholder = isVscodeStep\n+      ? workspacePlaceholder\n+      : browserPlaceholder;\n     const iframeKey = isVscodeStep ? vscodePersistKey : browserPersistKey;\n \n     return (\n@@ -1785,7 +1830,9 @@ export function PreviewConfigureClient({\n         <div className=\"flex-shrink-0 border-t border-neutral-200 dark:border-neutral-800 p-6 bg-white dark:bg-black\">\n           {errorMessage && (\n             <div className=\"rounded-md bg-red-50 dark:bg-red-950/20 border border-red-200 dark:border-red-900/50 p-3 mb-4\">\n-              <p className=\"text-sm text-red-600 dark:text-red-400\">{errorMessage}</p>\n+              <p className=\"text-sm text-red-600 dark:text-red-400\">\n+                {errorMessage}\n+              </p>\n             </div>\n           )}\n \n@@ -1807,7 +1854,7 @@ export function PreviewConfigureClient({\n               <button\n                 type=\"button\"\n                 onClick={handleNextStep}\n-                className=\"inline-flex items-center gap-2 rounded-md bg-neutral-900 dark:bg-neutral-100 text-white dark:text-neutral-900 px-4 py-2 text-sm font-semibold hover:bg-neutral-800 dark:hover:bg-neutral-200 transition\"\n+                className=\"inline-flex items-center gap-2 rounded-md bg-neutral-900 dark:bg-neutral-100 text-white dark:text-neutral-900 px-4 py-2 text-sm font-semibold hover:bg-neutral-800 dark:hover:bg-neutral-200 transition cursor-pointer\"\n               >\n                 Next\n                 <ArrowRight className=\"w-4 h-4\" />\ndiff --git a/apps/www/components/preview/preview-dashboard.tsx b/apps/www/components/preview/preview-dashboard.tsx\nindex d98b56a5f..515672435 100644\n--- a/apps/www/components/preview/preview-dashboard.tsx\n+++ b/apps/www/components/preview/preview-dashboard.tsx\n@@ -24,7 +24,7 @@ import {\n   TooltipContent,\n   TooltipProvider,\n   TooltipTrigger,\n-} from \"@/components/ui/tooltip\";\n+} from \"@/components/ui/tooltip-base\";\n import { LucideIcon } from \"lucide-react\";\n import { useOAuthPopup } from \"@/hooks/use-oauth-popup\";\n \n@@ -131,7 +131,7 @@ function Section({\n   return (\n     <div className={`flex flex-col h-full ${className ?? \"\"}`}>\n       <div\n-        className={`flex items-center ${inlineHeader ? \"gap-2\" : \"justify-between gap-2\"} h-[34px] shrink-0 ${inlineHeader ? \"pb-2\" : \"pb-3\"}`}\n+        className={`flex flex-col sm:flex-row sm:items-center ${inlineHeader ? \"gap-2\" : \"justify-between gap-2\"} h-auto sm:h-[34px] shrink-0 ${inlineHeader ? \"pb-2\" : \"pb-3\"}`}\n       >\n         <h2 className=\"text-base font-medium text-white\">{title}</h2>\n         {headerContent}\n@@ -203,7 +203,12 @@ function PopupCompleteView() {\n }\n \n /** Opens a centered popup window */\n-function openCenteredPopup(url: string, name: string, width: number, height: number) {\n+function openCenteredPopup(\n+  url: string,\n+  name: string,\n+  width: number,\n+  height: number\n+) {\n   const screenLeft = window.screenLeft ?? window.screenX;\n   const screenTop = window.screenTop ?? window.screenY;\n   const screenWidth = window.innerWidth;\n@@ -544,11 +549,18 @@ export function PreviewDashboard({\n       const payload = (await response.json()) as { installUrl: string };\n \n       // Open centered popup for GitHub App installation\n-      const popup = openCenteredPopup(payload.installUrl, \"github-app-install\", 1000, 700);\n+      const popup = openCenteredPopup(\n+        payload.installUrl,\n+        \"github-app-install\",\n+        1000,\n+        700\n+      );\n \n       if (!popup) {\n         // Popup was blocked - fall back to redirect\n-        console.warn(\"[PreviewDashboard] Popup blocked, falling back to redirect\");\n+        console.warn(\n+          \"[PreviewDashboard] Popup blocked, falling back to redirect\"\n+        );\n         window.location.href = payload.installUrl;\n         return;\n       }\n@@ -752,7 +764,7 @@ export function PreviewDashboard({\n       </div>\n     </div>\n   ) : !hasGithubAppInstallation ? (\n-    <div className=\"relative flex flex-1 flex-col items-center justify-center rounded-lg border border-white/5 bg-white/[0.02] backdrop-blur-sm overflow-hidden\">\n+    <div className=\"relative flex flex-1 flex-col items-center justify-center rounded-lg border border-white/5 bg-white/[0.02] backdrop-blur-sm overflow-hidden py-16 sm:py-10\">\n       <GrainOverlay opacity={0.02} />\n       <h3 className=\"text-base font-medium text-white pb-5\">\n         No connected repositories\n@@ -765,11 +777,7 @@ export function PreviewDashboard({\n         {isInstallingApp ? (\n           <Loader2 className=\"h-4 w-4 animate-spin\" />\n         ) : (\n-          <svg\n-            className=\"h-4 w-4\"\n-            viewBox=\"0 0 24 24\"\n-            fill=\"currentColor\"\n-          >\n+          <svg className=\"h-4 w-4\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n             <path d=\"M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z\" />\n           </svg>\n         )}\n@@ -783,7 +791,13 @@ export function PreviewDashboard({\n     <div className=\"flex flex-1 flex-col overflow-hidden rounded-lg border border-white/10\">\n       <div className=\"flex border-b border-white/10 shrink-0\">\n         <div className=\"relative border-r border-white/10\">\n-          <Github className=\"pointer-events-none absolute left-4 top-1/2 -translate-y-1/2 h-4 w-4 text-neutral-400\" />\n+          <svg\n+            className=\"pointer-events-none absolute left-4 top-1/2 -translate-y-1/2 h-4 w-4\"\n+            viewBox=\"0 0 24 24\"\n+            fill=\"white\"\n+          >\n+            <path d=\"M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z\" />\n+          </svg>\n           <select\n             value={selectedInstallationId ?? \"\"}\n             onChange={(e) => {\n@@ -848,7 +862,7 @@ export function PreviewDashboard({\n             Select a team and install the GitHub App to search.\n           </div>\n         ) : isLoadingRepos ? (\n-          <div className=\"flex items-center justify-center h-full\">\n+          <div className=\"flex items-center justify-center h-full min-h-[225px]\">\n             <Loader2 className=\"h-5 w-5 animate-spin text-neutral-500\" />\n           </div>\n         ) : repos.length > 0 ? (\n@@ -858,14 +872,22 @@ export function PreviewDashboard({\n               className=\"flex items-center justify-between px-4 py-2.5\"\n             >\n               <div className=\"flex items-center gap-2.5 min-w-0\">\n-                <Github className=\"h-4 w-4 text-neutral-400 shrink-0\" />\n-                <span className=\"text-sm text-white\">{repo.full_name}</span>\n+                <svg\n+                  className=\"h-4 w-4 shrink-0\"\n+                  viewBox=\"0 0 24 24\"\n+                  fill=\"white\"\n+                >\n+                  <path d=\"M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z\" />\n+                </svg>\n+                <span className=\"text-sm text-white truncate\">\n+                  {repo.full_name}\n+                </span>\n               </div>\n               <Button\n                 onClick={() => handleContinue(repo.full_name)}\n                 disabled={navigatingRepo !== null || !selectedInstallationId}\n                 size=\"sm\"\n-                className=\"h-6 px-3 text-xs bg-white text-black hover:bg-neutral-200 min-w-[55px]\"\n+                className=\"h-6 px-3 text-xs bg-white text-black hover:bg-neutral-200 min-w-[55px] cursor-pointer\"\n               >\n                 {navigatingRepo === repo.full_name ? (\n                   <Loader2 className=\"h-3.5 w-3.5 animate-spin\" />\n@@ -1035,37 +1057,45 @@ export function PreviewDashboard({\n                   : \"Connect GitHub and import a repository to get started.\"}\n               </p>\n             ) : (\n-              <TooltipProvider delayDuration={100}>\n+              <TooltipProvider>\n                 <div className=\"space-y-1.5\">\n                   {configs.map((config) => (\n                     <div\n                       key={config.id}\n-                      className=\"flex items-center justify-between px-3 py-2.5\"\n+                      className=\"flex items-center justify-between pl-0 pr-3 py-2.5\"\n                     >\n                       <div className=\"flex items-center gap-2.5 min-w-0\">\n-                        <Github className=\"h-4 w-4 text-neutral-500 shrink-0\" />\n+                        <svg\n+                          className=\"h-4 w-4 shrink-0\"\n+                          viewBox=\"0 0 24 24\"\n+                          fill=\"white\"\n+                        >\n+                          <path d=\"M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z\" />\n+                        </svg>\n                         <span className=\"text-sm text-white truncate\">\n                           {config.repoFullName}\n                         </span>\n-                        <span className=\"text-xs text-neutral-600\">\n-                          {config.teamName}\n-                        </span>\n-                        <span\n-                          className={clsx(\n-                            \"text-xs px-2 py-0.5 rounded\",\n-                            config.status === \"active\"\n-                              ? \"bg-emerald-500/10 text-emerald-400\"\n-                              : config.status === \"paused\"\n-                                ? \"bg-amber-500/10 text-amber-400\"\n-                                : \"bg-neutral-500/10 text-neutral-400\"\n-                          )}\n-                        >\n-                          {config.status}\n-                        </span>\n+                        <div className=\"flex items-center gap-2.5 translate-y-[0.5px]\">\n+                          <span className=\"text-xs text-neutral-600\">\n+                            {config.teamName}\n+                          </span>\n+                          <span\n+                            className={clsx(\n+                              \"text-xs px-2 py-0.5 rounded\",\n+                              config.status === \"active\"\n+                                ? \"bg-emerald-500/10 text-emerald-400\"\n+                                : config.status === \"paused\"\n+                                  ? \"bg-amber-500/10 text-amber-400\"\n+                                  : \"bg-neutral-500/10 text-neutral-400\"\n+                            )}\n+                          >\n+                            {config.status}\n+                          </span>\n+                        </div>\n                       </div>\n                       <div className=\"flex items-center gap-1.5\">\n                         <Tooltip>\n-                          <TooltipTrigger asChild>\n+                          <TooltipTrigger asChild delayDuration={0}>\n                             <button\n                               type=\"button\"\n                               onClick={() => handleOpenConfig(config)}\n@@ -1084,7 +1114,7 @@ export function PreviewDashboard({\n                           </TooltipContent>\n                         </Tooltip>\n                         <Tooltip>\n-                          <TooltipTrigger asChild>\n+                          <TooltipTrigger asChild delayDuration={0}>\n                             <button\n                               type=\"button\"\n                               onClick={() => handleRequestDelete(config)}\ndiff --git a/apps/www/components/ui/tooltip-base.tsx b/apps/www/components/ui/tooltip-base.tsx\nnew file mode 100644\nindex 000000000..c1c0844b4\n--- /dev/null\n+++ b/apps/www/components/ui/tooltip-base.tsx\n@@ -0,0 +1,83 @@\n+import * as React from \"react\";\n+\n+import { Tooltip as BaseTooltip } from \"@base-ui-components/react/tooltip\";\n+import { cn } from \"@/lib/utils\";\n+\n+const TooltipProvider = BaseTooltip.Provider;\n+\n+function Tooltip(props: React.ComponentProps<typeof BaseTooltip.Root>) {\n+  return <BaseTooltip.Root {...props} />;\n+}\n+\n+interface TooltipTriggerProps extends React.ComponentProps<typeof BaseTooltip.Trigger> {\n+  asChild?: boolean;\n+  delay?: number;\n+  closeDelay?: number;\n+  delayDuration?: number;\n+}\n+\n+function TooltipTrigger({\n+  asChild: _asChild,\n+  delayDuration,\n+  delay = delayDuration ?? 0,\n+  closeDelay,\n+  children,\n+  ...props\n+}: TooltipTriggerProps) {\n+  return (\n+    <BaseTooltip.Trigger {...props} {...{ delay, closeDelay }}>\n+      {children}\n+    </BaseTooltip.Trigger>\n+  );\n+}\n+\n+function TooltipContent({\n+  className,\n+  sideOffset = 10,\n+  side,\n+  align,\n+  children,\n+  ...props\n+}: React.ComponentProps<typeof BaseTooltip.Positioner>) {\n+  return (\n+    <BaseTooltip.Portal>\n+      <BaseTooltip.Positioner sideOffset={sideOffset} side={side} align={align} {...props}>\n+        <BaseTooltip.Popup\n+          className={cn(\n+            \"flex flex-col px-2 py-1 rounded-md bg-white text-sm font-sans origin-(--transform-origin) shadow-lg shadow-neutral-200 outline-1 outline-neutral-200 transition-[transform,scale,opacity] data-ending-style:opacity-0 data-ending-style:scale-90 data-instant:transition-none data-starting-style:opacity-0 data-starting-style:scale-90 dark:bg-neutral-800 dark:shadow-none dark:outline-neutral-600 dark:-outline-offset-1\",\n+            className\n+          )}\n+        >\n+          <BaseTooltip.Arrow\n+            className=\"flex data-[side=bottom]:-top-2 data-[side=bottom]:rotate-0 data-[side=left]:right-[-13px] data-[side=left]:rotate-90 data-[side=right]:left-[-13px] data-[side=right]:-rotate-90 data-[side=top]:-bottom-2 data-[side=top]:rotate-180\"\n+          >\n+            <ArrowSvg />\n+          </BaseTooltip.Arrow>\n+          {children}\n+        </BaseTooltip.Popup>\n+      </BaseTooltip.Positioner>\n+    </BaseTooltip.Portal>\n+  );\n+}\n+\n+function ArrowSvg(props: React.ComponentProps<\"svg\">) {\n+  return (\n+    <svg width=\"20\" height=\"10\" viewBox=\"0 0 20 10\" fill=\"none\" {...props}>\n+      <path\n+        d=\"M9.66437 2.60207L4.80758 6.97318C4.07308 7.63423 3.11989 8 2.13172 8H0V10H20V8H18.5349C17.5468 8 16.5936 7.63423 15.8591 6.97318L11.0023 2.60207C10.622 2.2598 10.0447 2.25979 9.66437 2.60207Z\"\n+        className=\"fill-white dark:fill-neutral-800\"\n+      />\n+      <path\n+        d=\"M8.99542 1.85876C9.75604 1.17425 10.9106 1.17422 11.6713 1.85878L16.5281 6.22989C17.0789 6.72568 17.7938 7.00001 18.5349 7.00001L15.89 7L11.0023 2.60207C10.622 2.2598 10.0447 2.2598 9.66436 2.60207L4.77734 7L2.13171 7.00001C2.87284 7.00001 3.58774 6.72568 4.13861 6.22989L8.99542 1.85876Z\"\n+        className=\"fill-neutral-200 dark:fill-none\"\n+      />\n+      <path\n+        d=\"M10.3333 3.34539L5.47654 7.71648C4.55842 8.54279 3.36693 9 2.13172 9H0V8H2.13172C3.11989 8 4.07308 7.63423 4.80758 6.97318L9.66437 2.60207C10.0447 2.25979 10.622 2.2598 11.0023 2.60207L15.8591 6.97318C16.5936 7.63423 17.5468 8 18.5349 8H20V9H18.5349C17.2998 9 16.1083 8.54278 15.1901 7.71648L10.3333 3.34539Z\"\n+        className=\"dark:fill-neutral-600\"\n+      />\n+    </svg>\n+  );\n+}\n+\n+export { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger };\n+\ndiff --git a/apps/www/components/ui/tooltip.tsx b/apps/www/components/ui/tooltip.tsx\nindex 1bf472438..f851fb7f0 100644\n--- a/apps/www/components/ui/tooltip.tsx\n+++ b/apps/www/components/ui/tooltip.tsx\n@@ -30,7 +30,7 @@ function TooltipContent({\n         data-slot=\"tooltip-content\"\n         sideOffset={sideOffset}\n         className={cn(\n-          \"z-[var(--z-tooltip,10020)] w-fit pointer-events-none select-none rounded-md bg-neutral-800 px-3 py-2 text-xs text-white shadow-sm\",\n+          \"z-[var(--z-tooltip,10020)] w-fit pointer-events-none select-none rounded-md bg-neutral-800 px-3 py-2 text-xs text-white shadow-sm font-sans\",\n           \"data-[state=delayed-open]:animate-in data-[state=delayed-open]:fade-in-0 data-[state=delayed-open]:zoom-in-95\",\n           \"data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95\",\n           \"data-[state=delayed-open]:data-[side=bottom]:slide-in-from-top-2 data-[state=delayed-open]:data-[side=top]:slide-in-from-bottom-2 data-[state=delayed-open]:data-[side=left]:slide-in-from-right-2 data-[state=delayed-open]:data-[side=right]:slide-in-from-left-2\",\ndiff --git a/apps/www/package.json b/apps/www/package.json\nindex b64fe13c9..ff8d86da0 100644\n--- a/apps/www/package.json\n+++ b/apps/www/package.json\n@@ -21,6 +21,7 @@\n     \"@ai-sdk/google\": \"^2.0.25\",\n     \"@ai-sdk/openai\": \"^2.0.58\",\n     \"@asteasolutions/zod-to-openapi\": \"^8.1.0\",\n+    \"@base-ui-components/react\": \"^1.0.0-beta.7\",\n     \"@cmux/convex\": \"workspace:*\",\n     \"@cmux/shared\": \"workspace:*\",\n     \"@cmux/www-openapi-client\": \"workspace:*\",\n@@ -31,6 +32,7 @@\n     \"@mantine/hooks\": \"^8.1.3\",\n     \"@octokit/auth-app\": \"^6.1.4\",\n     \"@openai/codex-sdk\": \"^0.46.0\",\n+    \"@radix-ui/react-select\": \"^2.2.6\",\n     \"@radix-ui/react-slot\": \"^1.2.3\",\n     \"@radix-ui/react-tooltip\": \"^1.2.8\",\n     \"@sentry/nextjs\": \"^10.27.0\",\ndiff --git a/apps/www/public/framework-logos/angular.svg b/apps/www/public/framework-logos/angular.svg\ndeleted file mode 100644\nindex 4bfc7d11a..000000000\n--- a/apps/www/public/framework-logos/angular.svg\n+++ /dev/null\n@@ -1 +0,0 @@\n-<svg width=\"48\" height=\"48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M24 1L3 8.636l3.203 28.313L24 47l17.797-10.051L45 8.636 24 1z\" fill=\"#DA0B36\"/><path d=\"M24 1v5.106-.023V47l17.797-10.051L45 8.636 24 1z\" fill=\"#C10933\"/><path d=\"M24.022 6L11 36h4.855l2.618-6.713h11.054L32.145 36H37L24.022 6zm3.804 19.15H20.22l3.803-9.403 3.804 9.402z\" fill=\"#fff\"/></svg>\n\\ No newline at end of file\ndiff --git a/apps/www/public/framework-logos/next.svg b/apps/www/public/framework-logos/next.svg\ndeleted file mode 100644\nindex c734900cc..000000000\n--- a/apps/www/public/framework-logos/next.svg\n+++ /dev/null\n@@ -1 +0,0 @@\n-<svg width=\"48\" height=\"48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><mask id=\"mask\" style=\"mask-type:alpha\" maskUnits=\"userSpaceOnUse\" x=\"0\" y=\"0\" width=\"48\" height=\"48\"><circle cx=\"24\" cy=\"24\" r=\"24\" fill=\"#000\"/></mask><g mask=\"url(#mask)\"><circle cx=\"24\" cy=\"24\" r=\"23.2\" fill=\"#000\" stroke=\"#fff\" stroke-width=\"1.6\"/><path d=\"M39.8687 42.0055L18.4378 14.4H14.3999V33.592H17.6302V18.5023L37.333 43.9587C38.222 43.3637 39.069 42.7108 39.8687 42.0055Z\" fill=\"url(#gradient0)\"/><rect x=\"30.6667\" y=\"14.4\" width=\"3.2\" height=\"19.2\" fill=\"url(#gradient1)\"/></g><defs><linearGradient id=\"gradient0\" x1=\"29.0666\" y1=\"31.0667\" x2=\"38.5332\" y2=\"42.8\" gradientUnits=\"userSpaceOnUse\"><stop stop-color=\"#fff\"/><stop offset=\"1\" stop-color=\"#fff\" stop-opacity=\"0\"/></linearGradient><linearGradient id=\"gradient1\" x1=\"32.2667\" y1=\"14.4\" x2=\"32.2132\" y2=\"28.5001\" gradientUnits=\"userSpaceOnUse\"><stop stop-color=\"#fff\"/><stop offset=\"1\" stop-color=\"#fff\" stop-opacity=\"0\"/></linearGradient></defs></svg>\n\\ No newline at end of file\ndiff --git a/apps/www/public/framework-logos/nuxt.svg b/apps/www/public/framework-logos/nuxt.svg\ndeleted file mode 100644\nindex 946d7a39a..000000000\n--- a/apps/www/public/framework-logos/nuxt.svg\n+++ /dev/null\n@@ -1,3 +0,0 @@\n-<svg width=\"61\" height=\"40\" viewBox=\"0 0 61 40\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n-  <path d=\"M33.997 39.539h22.528c.715 0 1.418-.183 2.038-.53a4.014 4.014 0 0 0 1.492-1.447 3.861 3.861 0 0 0 .545-1.977 3.86 3.86 0 0 0-.547-1.977L44.923 8.19a4.016 4.016 0 0 0-1.49-1.447 4.172 4.172 0 0 0-2.038-.53c-.716 0-1.418.183-2.038.53a4.016 4.016 0 0 0-1.492 1.447l-3.868 6.504-7.563-12.718A4.018 4.018 0 0 0 24.942.53 4.175 4.175 0 0 0 22.904 0c-.716 0-1.419.183-2.039.53a4.018 4.018 0 0 0-1.492 1.446L.547 33.608A3.861 3.861 0 0 0 0 35.585c0 .694.188 1.376.545 1.977.358.601.873 1.1 1.492 1.447.62.347 1.323.53 2.038.53h14.141c5.603 0 9.735-2.387 12.578-7.044l6.902-11.596 3.698-6.205 11.096 18.64H37.695l-3.699 6.205Zm-16.011-6.212-9.869-.002L22.91 8.474l7.381 12.425-4.942 8.305c-1.888 3.022-4.033 4.123-7.363 4.123Z\" fill=\"#00DC82\"/>\n-</svg>\ndiff --git a/apps/www/public/framework-logos/react.svg b/apps/www/public/framework-logos/react.svg\ndeleted file mode 100644\nindex 523333e1a..000000000\n--- a/apps/www/public/framework-logos/react.svg\n+++ /dev/null\n@@ -1 +0,0 @@\n-<svg width=\"48\" height=\"48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><g clip-path=\"url(#clip0)\"><path d=\"M24 28.631a4.278 4.278 0 1 0 0-8.556 4.278 4.278 0 0 0 0 8.556z\" fill=\"#61DAFB\"/><path d=\"M24 33.118c12.678 0 22.956-3.924 22.956-8.765 0-4.84-10.278-8.765-22.956-8.765-12.679 0-22.957 3.924-22.957 8.765 0 4.841 10.278 8.765 22.957 8.765z\" stroke=\"#61DAFB\"/><path d=\"M16.409 28.736c6.34 10.98 14.877 17.918 19.07 15.498 4.191-2.42 2.451-13.284-3.888-24.264C25.25 8.99 16.714 2.053 12.52 4.473 8.33 6.892 10.07 17.756 16.41 28.736z\" stroke=\"#61DAFB\"/><path d=\"M16.409 19.97c-6.34 10.98-8.08 21.843-3.887 24.264 4.192 2.42 12.73-4.518 19.069-15.498 6.34-10.98 8.08-21.843 3.887-24.264-4.192-2.42-12.73 4.519-19.069 15.498z\" stroke=\"#61DAFB\"/></g><defs><clipPath id=\"clip0\"><path fill=\"#fff\" transform=\"translate(0 3)\" d=\"M0 0H48V42.706H0z\"/></clipPath></defs></svg>\n\\ No newline at end of file\ndiff --git a/apps/www/public/framework-logos/remix.svg b/apps/www/public/framework-logos/remix.svg\ndeleted file mode 100644\nindex ffcdf8287..000000000\n--- a/apps/www/public/framework-logos/remix.svg\n+++ /dev/null\n@@ -1,6 +0,0 @@\n-<svg viewBox=\"0 0 800 800\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n-  <path d=\"M700 0H100C44.772 0 0 44.772 0 100v600c0 55.228 44.772 100 100 100h600c55.228 0 100-44.772 100-100V100C800 44.772 755.228 0 700 0Z\" fill=\"#212121\"/>\n-  <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M587.947 527.768c4.254 54.65 4.254 80.268 4.254 108.232H465.756c0-6.091.109-11.663.219-17.313.342-17.564.699-35.88-2.147-72.868-3.761-54.152-27.08-66.185-69.957-66.185H195v-98.525h204.889c54.16 0 81.241-16.476 81.241-60.098 0-38.357-27.081-61.601-81.241-61.601H195V163h227.456C545.069 163 606 220.912 606 313.42c0 69.193-42.877 114.319-100.799 121.84 48.895 9.777 77.48 37.605 82.746 92.508Z\" fill=\"#fff\"/>\n-  <path d=\"M195 636v-73.447h133.697c22.332 0 27.181 16.563 27.181 26.441V636H195Z\" fill=\"#fff\"/>\n-  <path d=\"M194.5 636v.5h161.878v-47.506c0-5.006-1.226-11.734-5.315-17.224-4.108-5.515-11.059-9.717-22.366-9.717H194.5V636Z\" stroke=\"#fff\" stroke-opacity=\".8\"/>\n-</svg>\ndiff --git a/apps/www/public/framework-logos/svelte.svg b/apps/www/public/framework-logos/svelte.svg\ndeleted file mode 100644\nindex 40c960773..000000000\n--- a/apps/www/public/framework-logos/svelte.svg\n+++ /dev/null\n@@ -1 +0,0 @@\n-<svg width=\"47\" height=\"48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><g clip-path=\"url(#clip0)\"><path d=\"M39.792 6.09C35.507-.027 27.044-1.84 20.924 2.048L10.177 8.88a12.297 12.297 0 0 0-5.57 8.237 12.922 12.922 0 0 0 1.28 8.315 12.313 12.313 0 0 0-1.844 4.596c-.619 3.47.19 7.043 2.244 9.91 4.287 6.119 12.75 7.931 18.869 4.042l10.747-6.831a12.295 12.295 0 0 0 5.57-8.237 12.927 12.927 0 0 0-1.28-8.315A12.31 12.31 0 0 0 42.037 16c.619-3.47-.19-7.043-2.245-9.91\" fill=\"#FF3E00\"/><path d=\"M19.873 40.52a8.55 8.55 0 0 1-9.165-3.388 7.866 7.866 0 0 1-1.35-5.962c.062-.339.148-.674.257-1.001l.202-.616.55.404a13.881 13.881 0 0 0 4.206 2.095l.4.121-.037.398a2.4 2.4 0 0 0 .433 1.594 2.575 2.575 0 0 0 2.76 1.022 2.37 2.37 0 0 0 .66-.29l10.75-6.833a2.233 2.233 0 0 0 1.011-1.492 2.377 2.377 0 0 0-.407-1.797 2.577 2.577 0 0 0-2.76-1.022 2.37 2.37 0 0 0-.66.289L22.62 26.65c-.675.428-1.411.75-2.183.956a8.55 8.55 0 0 1-9.166-3.388 7.866 7.866 0 0 1-1.35-5.962 7.394 7.394 0 0 1 3.35-4.954l10.75-6.834a7.844 7.844 0 0 1 2.185-.957 8.55 8.55 0 0 1 9.165 3.388 7.866 7.866 0 0 1 1.35 5.962c-.062.34-.148.674-.256 1.001l-.203.616-.55-.403a13.87 13.87 0 0 0-4.206-2.096l-.4-.121.037-.398a2.404 2.404 0 0 0-.433-1.594 2.575 2.575 0 0 0-2.76-1.022 2.37 2.37 0 0 0-.66.29l-10.75 6.833a2.229 2.229 0 0 0-1.01 1.492c-.112.63.034 1.277.406 1.797a2.577 2.577 0 0 0 2.76 1.023c.234-.063.457-.16.661-.29l4.102-2.607a7.834 7.834 0 0 1 2.183-.957 8.55 8.55 0 0 1 9.165 3.388 7.865 7.865 0 0 1 1.35 5.962 7.398 7.398 0 0 1-3.35 4.955l-10.75 6.833a7.842 7.842 0 0 1-2.185.958\" fill=\"#fff\"/></g><defs><clipPath id=\"clip0\"><path fill=\"#fff\" transform=\"translate(3.84)\" d=\"M0 0H38.4V46.08H0z\"/></clipPath></defs></svg>\n\\ No newline at end of file\ndiff --git a/apps/www/public/framework-logos/vite.svg b/apps/www/public/framework-logos/vite.svg\ndeleted file mode 100644\nindex de4aeddc1..000000000\n--- a/apps/www/public/framework-logos/vite.svg\n+++ /dev/null\n@@ -1,15 +0,0 @@\n-<svg width=\"410\" height=\"404\" viewBox=\"0 0 410 404\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n-<path d=\"M399.641 59.5246L215.643 388.545C211.844 395.338 202.084 395.378 198.228 388.618L10.5817 59.5563C6.38087 52.1896 12.6802 43.2665 21.0281 44.7586L205.223 77.6824C206.398 77.8924 207.601 77.8904 208.776 77.6763L389.119 44.8058C397.439 43.2894 403.768 52.1434 399.641 59.5246Z\" fill=\"url(#paint0_linear)\"/>\n-<path d=\"M292.965 1.5744L156.801 28.2552C154.563 28.6937 152.906 30.5903 152.771 32.8664L144.395 174.33C144.198 177.662 147.258 180.248 150.51 179.498L188.42 170.749C191.967 169.931 195.172 173.055 194.443 176.622L183.18 231.775C182.422 235.487 185.907 238.661 189.532 237.56L212.947 230.446C216.577 229.344 220.065 232.527 219.297 236.242L201.398 322.875C200.278 328.294 207.486 331.249 210.492 326.603L212.5 323.5L323.454 102.072C325.312 98.3645 322.108 94.137 318.036 94.9228L279.014 102.454C275.347 103.161 272.227 99.746 273.262 96.1583L298.731 7.86689C299.767 4.27314 296.636 0.855181 292.965 1.5744Z\" fill=\"url(#paint1_linear)\"/>\n-<defs>\n-<linearGradient id=\"paint0_linear\" x1=\"6.00017\" y1=\"32.9999\" x2=\"235\" y2=\"344\" gradientUnits=\"userSpaceOnUse\">\n-<stop stop-color=\"#41D1FF\"/>\n-<stop offset=\"1\" stop-color=\"#BD34FE\"/>\n-</linearGradient>\n-<linearGradient id=\"paint1_linear\" x1=\"194.651\" y1=\"8.81818\" x2=\"236.076\" y2=\"292.989\" gradientUnits=\"userSpaceOnUse\">\n-<stop stop-color=\"#FFEA83\"/>\n-<stop offset=\"0.0833333\" stop-color=\"#FFDD35\"/>\n-<stop offset=\"1\" stop-color=\"#FFA800\"/>\n-</linearGradient>\n-</defs>\n-</svg>\ndiff --git a/apps/www/public/framework-logos/vue.svg b/apps/www/public/framework-logos/vue.svg\ndeleted file mode 100644\nindex e4111af71..000000000\n--- a/apps/www/public/framework-logos/vue.svg\n+++ /dev/null\n@@ -1 +0,0 @@\n-<svg width=\"48\" height=\"48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><g clip-path=\"url(#clip0)\"><path d=\"M29.54 3L24 12.7 18.456 3H-.001l24 42L47.998 3H29.54z\" fill=\"#41B883\"/><path d=\"M29.54 3L24 12.7 18.456 3H9.599l14.4 25.2L38.398 3H29.54z\" fill=\"#34495E\"/></g><defs><clipPath id=\"clip0\"><path fill=\"#fff\" transform=\"translate(0 3)\" d=\"M0 0H48V42H0z\"/></clipPath></defs></svg>\n\\ No newline at end of file\ndiff --git a/bun.lock b/bun.lock\nindex 36dc8139e..04966cc2d 100644\n--- a/bun.lock\n+++ b/bun.lock\n@@ -35,7 +35,7 @@\n     },\n     \"apps/client\": {\n       \"name\": \"@cmux/client\",\n-      \"version\": \"1.0.181\",\n+      \"version\": \"1.0.184\",\n       \"dependencies\": {\n         \"@base-ui-components/react\": \"1.0.0-beta.2\",\n         \"@cmux/convex\": \"workspace:*\",\n@@ -312,6 +312,7 @@\n         \"@ai-sdk/google\": \"^2.0.25\",\n         \"@ai-sdk/openai\": \"^2.0.58\",\n         \"@asteasolutions/zod-to-openapi\": \"^8.1.0\",\n+        \"@base-ui-components/react\": \"^1.0.0-beta.7\",\n         \"@cmux/convex\": \"workspace:*\",\n         \"@cmux/shared\": \"workspace:*\",\n         \"@cmux/www-openapi-client\": \"workspace:*\",\n@@ -322,6 +323,7 @@\n         \"@mantine/hooks\": \"^8.1.3\",\n         \"@octokit/auth-app\": \"^6.1.4\",\n         \"@openai/codex-sdk\": \"^0.46.0\",\n+        \"@radix-ui/react-select\": \"^2.2.6\",\n         \"@radix-ui/react-slot\": \"^1.2.3\",\n         \"@radix-ui/react-tooltip\": \"^1.2.8\",\n         \"@sentry/nextjs\": \"^10.27.0\",\n@@ -5095,6 +5097,8 @@\n \n     \"@cmux/worker/@openai/codex-sdk\": [\"@openai/codex-sdk@0.47.0\", \"\", {}, \"sha512-GFmF0C7wkmX10omICL/5Gm1w+BvZtc41Rwuv7/pVO47ZbSq+9bJqn0XUpwoyrYQavg+BsKSuJAo9CYCn9JhkZA==\"],\n \n+    \"@cmux/www/@base-ui-components/react\": [\"@base-ui-components/react@1.0.0-beta.7\", \"\", { \"dependencies\": { \"@babel/runtime\": \"^7.28.4\", \"@base-ui-components/utils\": \"0.2.1\", \"@floating-ui/react-dom\": \"^2.1.6\", \"@floating-ui/utils\": \"^0.2.10\", \"reselect\": \"^5.1.1\", \"tabbable\": \"^6.3.0\", \"use-sync-external-store\": \"^1.6.0\" }, \"peerDependencies\": { \"@types/react\": \"^17 || ^18 || ^19\", \"react\": \"^17 || ^18 || ^19\", \"react-dom\": \"^17 || ^18 || ^19\" }, \"optionalPeers\": [\"@types/react\"] }, \"sha512-jZoU6ZzPPDhiP62ToFpIZVkLDzYleL8NJhiw4Dm9Q+N7Q+/rOW+N6YN0URuQ9zMdcl8jvIks/8iY1cyD/VC87A==\"],\n+\n     \"@cmux/www/lucide-react\": [\"lucide-react@0.460.0\", \"\", { \"peerDependencies\": { \"react\": \"^16.5.1 || ^17.0.0 || ^18.0.0 || ^19.0.0-rc\" } }, \"sha512-BVtq/DykVeIvRTJvRAgCsOwaGL8Un3Bxh8MbDxMhEWlZay3T4IpEKDEpwt5KZ0KJMHzgm6jrltxlT5eXOWXDHg==\"],\n \n     \"@cmux/www/morphcloud\": [\"morphcloud@0.0.18\", \"\", { \"dependencies\": { \"ignore\": \"^7.0.0\", \"node-ssh\": \"^13.2.0\", \"undici\": \"^7.12.0\", \"uuid\": \"^11.1.0\" } }, \"sha512-k3kxdvmwUQbRM5RBJp/UMXQKOqZBBy+BVo/jgNLuNp8yLBq5CJqGAK3O0oZewwKUK2/UL4LyHkwJxBNf7gy0kg==\"],\n@@ -6033,6 +6037,12 @@\n \n     \"@cmux/www-openapi-client/typescript-eslint/@typescript-eslint/utils\": [\"@typescript-eslint/utils@8.48.0\", \"\", { \"dependencies\": { \"@eslint-community/eslint-utils\": \"^4.7.0\", \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-yTJO1XuGxCsSfIVt1+1UrLHtue8xz16V8apzPYI06W0HbEbEWHxHXgZaAgavIkoh+GeV6hKKd5jm0sS6OYxWXQ==\"],\n \n+    \"@cmux/www/@base-ui-components/react/@base-ui-components/utils\": [\"@base-ui-components/utils@0.2.1\", \"\", { \"dependencies\": { \"@babel/runtime\": \"^7.28.4\", \"@floating-ui/utils\": \"^0.2.10\", \"reselect\": \"^5.1.1\", \"use-sync-external-store\": \"^1.6.0\" }, \"peerDependencies\": { \"@types/react\": \"^17 || ^18 || ^19\", \"react\": \"^17 || ^18 || ^19\", \"react-dom\": \"^17 || ^18 || ^19\" }, \"optionalPeers\": [\"@types/react\"] }, \"sha512-6D3PNibMXWPxiXCW/aMTclTypNG/QPCUc5vwGS6yKIcoYGDmjLiG3VyJ7hlGAnXiMGJMWH2TVl335N+zkRAKZQ==\"],\n+\n+    \"@cmux/www/@base-ui-components/react/tabbable\": [\"tabbable@6.3.0\", \"\", {}, \"sha512-EIHvdY5bPLuWForiR/AN2Bxngzpuwn1is4asboytXtpTgsArc+WmSJKVLlhdh71u7jFcryDqB2A8lQvj78MkyQ==\"],\n+\n+    \"@cmux/www/@base-ui-components/react/use-sync-external-store\": [\"use-sync-external-store@1.6.0\", \"\", { \"peerDependencies\": { \"react\": \"^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\" } }, \"sha512-Pp6GSwGP/NrPIrxVFAIkOQeyw8lFenOHijQWkUTrDvrF4ALqylP2C/KCkeS9dpUM3KvYRQhna5vt7IL95+ZQ9w==\"],\n+\n     \"@cmux/www/morphcloud/ignore\": [\"ignore@7.0.5\", \"\", {}, \"sha512-Hs59xBNfUIunMFgWAbGX5cq6893IbWg4KnrjbYwX3tx0ztorVgTDA6B2sxf8ejHJ4wz8BqGUMYlnzNBer5NvGg==\"],\n \n     \"@cmux/www/morphcloud/undici\": [\"undici@7.16.0\", \"\", {}, \"sha512-QEg3HPMll0o3t2ourKwOeUAZ159Kn9mx5pnzHRQO8+Wixmh88YdZRiIwat0iNzNNXn0yoEtXJqFpyW7eM8BV7g==\"],\n","comments":[{"type":"issue_comment","id":3599997307,"prNumber":1096,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\nCaptured 21 screenshots for commit `491c1b9` (2025-12-02 03:20:12.427 UTC).\n\n**GitHub account selector showing connected accounts**\n\n![account-selector-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/8bfd950e-18e2-46f0-a6a7-2a5fb5a1fdba)\n\n**Choose a repository section heading with team selector**\n\n![choose-repository-section-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/0c715e9f-847e-4d3f-b758-51f1bffd2b42)\n\n**Full page screenshot of the configure page showing framework preset selector**\n\n![configure-page-full-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/c9cab5bf-eb60-4bab-a956-bbf6669e1dc1)\n\n**Configure page viewport showing the project configuration form**\n\n![configure-page-viewport-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/f59155eb-4672-481d-8e42-fe6d82e4eedd)\n\n**Individual configured repository item showing repo name, team, and status**\n\n![configured-repo-item-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/b82f3136-9832-493a-b191-563cf8451f7e)\n\n**Configured repositories section heading**\n\n![configured-repositories-section-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/1bdc0a28-6df7-4950-9f20-33fa70c0cd8c)\n\n**Explore cmux button in the footer section**\n\n![explore-cmux-button-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/60477ac7-8611-4e69-8975-979661e77696)\n\n**Feature card showing Computer use agent feature with description**\n\n![feature-card-computer-use-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/25442235-1749-4cb5-a2b4-bb0b8e8fa349)\n\n**Feature card showing GitHub comments feature with description**\n\n![feature-card-github-comments-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/d20eecd4-f017-490a-ad76-3d8d19e4f4b7)\n\n**Feature card showing Isolated dev servers feature with description**\n\n![feature-card-isolated-servers-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/464f40ea-a0fc-4866-ae98-c2f8fb14a452)\n\n**Framework preset dropdown menu showing all available frameworks (Next.js, Vite, Remix, Nuxt, SvelteKit, Angular, React, Vue)**\n\n![framework-preset-dropdown-open-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/3363a044-dbf5-4510-a5d0-65df43d09e6a)\n\n**Framework preset selector showing selected framework with icon and description**\n\n![framework-preset-selector-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/681a138c-0ae6-4b70-bf81-cb0d0ea5fca6)\n\n**From the creators of section with cmux.dev branding**\n\n![from-creators-section-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/95a9f6cc-acc4-418f-a847-b30d8a7050cf)\n\n**Star on GitHub button in the footer section**\n\n![github-star-button-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/b0b1292f-4cc3-4b2f-8cf7-f736f3f9c524)\n\n**Header section with title 'Screenshot previews for GitHub PRs' and description**\n\n![header-section-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/0ac02973-303d-4074-b279-43b954929f25)\n\n**Full page screenshot of the new preview landing page UI showing all sections**\n\n![preview-page-full-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/8fd7df84-5bf0-47f3-adb6-1c64535cd0e9)\n\n**Desktop viewport screenshot of the preview landing page**\n\n![preview-page-viewport-desktop-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/381a1ca7-7112-45da-a745-9620e22ad66a)\n\n**Repository search input field**\n\n![repository-search-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/ddbb0843-3e0b-4e3a-a447-702b4669d10e)\n\n**Team selection dropdown showing available teams**\n\n![team-selector-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/4bd96103-f70d-4159-81f8-e6c48d7b1b03)\n\n**Repository URL input field with Continue button for quick setup**\n\n![url-input-section-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/6c5bdbb3-c8ae-4f24-b4ae-a09b291fa0df)\n\n**What is preview.new section heading**\n\n![what-is-preview-section-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/0953862c-d6bc-43ed-aefa-9df71529e227)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"4510778bd0c587ce72481c7250bb54904a5efee7","createdAt":"2025-12-02T03:20:13Z","updatedAt":"2025-12-02T03:58:11Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1096#issuecomment-3599997307"},{"type":"issue_comment","id":3600077176,"prNumber":1096,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n\n\nCaptured 11 screenshots for commit `4510778` (2025-12-02 03:58:09.148 UTC).\n\n![framework-preset-different-option-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/6198c224-3b5e-4471-b96b-c447c6b00de5)\n\n**Framework Preset dropdown menu opened showing all available framework options with logos (Next.js, Vite, Remix, Nuxt, SvelteKit, Angular, React, Vue)**\n\n![framework-preset-dropdown-open-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/3e2048a7-1c4c-46e4-b666-a252cc642778)\n\n**Full page showing expanded Maintenance and Dev Scripts section demonstrating how framework preset autofills script values**\n\n![framework-preset-scripts-expanded-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/af0074c0-b151-42bc-a9ab-3a519a454b9b)\n\n**Configure page with Vite framework preset selected, showing updated button with Vite logo**\n\n![framework-preset-vite-selected-final-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/5bf1ed07-4e82-4adf-ad08-de90ac10ca11)\n\n![framework-preset-vite-selected-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/a5daf7ee-2345-47ef-a9d5-4a72436ab2e6)\n\n**Full configure page showing the new Framework Preset selector with Next.js selected**\n\n![preview-configure-page-full-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/ab653bd0-d179-4190-b834-488766c0b601)\n\n**Configure page viewport showing Framework Preset selector and configuration options**\n\n![preview-configure-page-viewport-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/d1abc4b5-11c2-44ee-808a-deb1a0d4f97c)\n\n**Header section of the landing page showing the title, description, and URL input**\n\n![preview-landing-header-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/b1ef272d-20c2-47d1-b3d1-b2d726373a15)\n\n**Full page screenshot of the new preview.new landing page with updated UI design**\n\n![preview-landing-page-full-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/9447999d-30d0-460b-84e2-fde93c8ed0ef)\n\n**Middle section viewport showing configured repositories and creators section**\n\n![preview-landing-viewport-middle-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/27936bb4-3502-422d-a50d-259387165b6e)\n\n**Top viewport of the landing page showing repository chooser and feature cards**\n\n![preview-landing-viewport-top-preview-new-landing-ui-1.png](https://adorable-wombat-701.convex.cloud/api/storage/193beb6c-9a61-4e32-a436-a9dea523e4e8)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"4510778bd0c587ce72481c7250bb54904a5efee7","createdAt":"2025-12-02T03:58:10Z","updatedAt":"2025-12-02T03:58:10Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1096#issuecomment-3600077176"}]}
{"number":1095,"title":"preview new landing ui","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1095","headRef":"preview-new-landing-ui","headSha":"b92984ed2d432b281311b3d84622996402db6945","baseRef":"main","baseSha":"1939b65a4bc88355454a867d316358d21c49e3e6","createdAt":"2025-12-01T23:26:28Z","updatedAt":"2025-12-02T03:20:38Z","diff":"diff --git a/apps/www/app/(home)/handler/after-sign-in/CheckSessionStorageRedirect.tsx b/apps/www/app/(home)/handler/after-sign-in/CheckSessionStorageRedirect.tsx\nnew file mode 100644\nindex 000000000..80467a205\n--- /dev/null\n+++ b/apps/www/app/(home)/handler/after-sign-in/CheckSessionStorageRedirect.tsx\n@@ -0,0 +1,46 @@\n+\"use client\";\n+\n+import { useEffect } from \"react\";\n+import { useRouter } from \"next/navigation\";\n+import { Loader2 } from \"lucide-react\";\n+\n+const OAUTH_CALLBACK_KEY = \"oauth_callback_url\";\n+\n+type CheckSessionStorageRedirectProps = {\n+  fallbackPath: string;\n+};\n+\n+export function CheckSessionStorageRedirect({\n+  fallbackPath,\n+}: CheckSessionStorageRedirectProps) {\n+  const router = useRouter();\n+\n+  useEffect(() => {\n+    let redirectPath = fallbackPath;\n+\n+    try {\n+      const storedCallback = sessionStorage.getItem(OAUTH_CALLBACK_KEY);\n+      if (storedCallback) {\n+        // Validate it's a relative path for security\n+        if (storedCallback.startsWith(\"/\") && !storedCallback.startsWith(\"//\")) {\n+          redirectPath = storedCallback;\n+        }\n+        sessionStorage.removeItem(OAUTH_CALLBACK_KEY);\n+      }\n+    } catch {\n+      // sessionStorage not available\n+    }\n+\n+    console.log(\"[CheckSessionStorageRedirect] Redirecting to:\", redirectPath);\n+    router.replace(redirectPath);\n+  }, [router, fallbackPath]);\n+\n+  return (\n+    <div className=\"min-h-dvh bg-[#05050a] text-white flex items-center justify-center font-sans\">\n+      <div className=\"flex flex-col items-center gap-4\">\n+        <Loader2 className=\"h-8 w-8 animate-spin text-neutral-400\" />\n+        <p className=\"text-sm text-neutral-400\">Completing sign in...</p>\n+      </div>\n+    </div>\n+  );\n+}\ndiff --git a/apps/www/app/(home)/handler/after-sign-in/page.tsx b/apps/www/app/(home)/handler/after-sign-in/page.tsx\nindex c1e5611ed..224cce1df 100644\n--- a/apps/www/app/(home)/handler/after-sign-in/page.tsx\n+++ b/apps/www/app/(home)/handler/after-sign-in/page.tsx\n@@ -3,6 +3,7 @@ import { redirect } from \"next/navigation\";\n \n import { env } from \"@/lib/utils/www-env\";\n import { OpenCmuxClient } from \"./OpenCmuxClient\";\n+import { CheckSessionStorageRedirect } from \"./CheckSessionStorageRedirect\";\n \n export const dynamic = \"force-dynamic\";\n \n@@ -82,6 +83,13 @@ export default async function AfterSignInPage({ searchParams: searchParamsPromis\n     hasAccessToken: !!stackAccessToken,\n   });\n \n+  // If no return URL in query params, this is a client component that will check sessionStorage\n+  // For OAuth popup flow, the callback URL is stored in sessionStorage\n+  if (!afterAuthReturnToRaw) {\n+    // Return a client component that checks sessionStorage\n+    return <CheckSessionStorageRedirect fallbackPath=\"/\" />;\n+  }\n+\n   // Handle Electron deep link redirects\n   if (afterAuthReturnToRaw?.startsWith(CMUX_SCHEME)) {\n     console.log(\"[After Sign In] Opening Electron app with deep link\");\ndiff --git a/apps/www/app/(preview)/preview/page.tsx b/apps/www/app/(preview)/preview/page.tsx\nindex 205fa669e..b928f8445 100644\n--- a/apps/www/app/(preview)/preview/page.tsx\n+++ b/apps/www/app/(preview)/preview/page.tsx\n@@ -53,8 +53,8 @@ export default async function PreviewLandingPage({ searchParams }: PageProps) {\n \n   if (!user) {\n     return (\n-      <div className=\"relative isolate min-h-dvh bg-[#05050a] text-white\">\n-        <div className=\"absolute inset-0 -z-10 bg-[radial-gradient(circle_at_top,_rgba(4,120,255,0.3),_transparent_45%)]\" />\n+      <div className=\"relative isolate min-h-dvh bg-[#05050a] text-white flex justify-center\">\n+        <div className=\"absolute inset-0 -z-10 bg-[radial-gradient(circle_at_calc(50%_+_150px)_450px,_rgba(4,120,255,0.25),_transparent_82%)]\" />\n \n         <PreviewDashboard\n           selectedTeamSlugOrId=\"\"\n@@ -89,6 +89,14 @@ export default async function PreviewLandingPage({ searchParams }: PageProps) {\n     return value ?? null;\n   })();\n \n+  const popupComplete = (() => {\n+    const value = resolvedSearch?.popup_complete;\n+    if (Array.isArray(value)) {\n+      return value[0] === \"true\";\n+    }\n+    return value === \"true\";\n+  })();\n+\n   const selectedTeam =\n     teams.find((team) => getTeamSlugOrId(team) === searchTeam) ?? teams[0];\n   const selectedTeamSlugOrId = selectedTeam ? getTeamSlugOrId(selectedTeam) : \"\";\n@@ -144,8 +152,8 @@ export default async function PreviewLandingPage({ searchParams }: PageProps) {\n   );\n \n   return (\n-    <div className=\"relative isolate min-h-dvh bg-[#05050a] text-white\">\n-      <div className=\"absolute inset-0 -z-10 bg-[radial-gradient(circle_at_top,_rgba(4,120,255,0.3),_transparent_45%)]\" />\n+    <div className=\"relative isolate min-h-dvh bg-[#05050a] text-white flex justify-center\">\n+      <div className=\"absolute inset-0 -z-10 bg-[radial-gradient(circle_at_calc(50%_+_150px)_450px,_rgba(4,120,255,0.25),_transparent_82%)]\" />\n \n       <PreviewDashboard\n         selectedTeamSlugOrId={selectedTeamSlugOrId}\n@@ -153,6 +161,7 @@ export default async function PreviewLandingPage({ searchParams }: PageProps) {\n         providerConnectionsByTeam={providerConnectionsByTeam}\n         isAuthenticated={true}\n         previewConfigs={previewConfigs}\n+        popupComplete={popupComplete}\n       />\n     </div>\n   );\ndiff --git a/apps/www/app/sign-in/oauth/[provider]/page.tsx b/apps/www/app/sign-in/oauth/[provider]/page.tsx\nnew file mode 100644\nindex 000000000..1081b3803\n--- /dev/null\n+++ b/apps/www/app/sign-in/oauth/[provider]/page.tsx\n@@ -0,0 +1,91 @@\n+\"use client\";\n+\n+import { useEffect, useRef } from \"react\";\n+import { useParams, useSearchParams } from \"next/navigation\";\n+import { useStackApp } from \"@stackframe/stack\";\n+import { Loader2 } from \"lucide-react\";\n+\n+type OAuthProvider = \"github\" | \"gitlab\" | \"bitbucket\" | \"google\";\n+\n+const VALID_PROVIDERS: OAuthProvider[] = [\n+  \"github\",\n+  \"gitlab\",\n+  \"bitbucket\",\n+  \"google\",\n+];\n+\n+const PROVIDER_DISPLAY_NAMES: Record<OAuthProvider, string> = {\n+  github: \"GitHub\",\n+  gitlab: \"GitLab\",\n+  bitbucket: \"Bitbucket\",\n+  google: \"Google\",\n+};\n+\n+function isValidProvider(provider: string): provider is OAuthProvider {\n+  return VALID_PROVIDERS.includes(provider as OAuthProvider);\n+}\n+\n+export default function OAuthSignInPage() {\n+  const params = useParams();\n+  const searchParams = useSearchParams();\n+  const app = useStackApp();\n+  const hasInitiated = useRef(false);\n+\n+  const provider = typeof params.provider === \"string\" ? params.provider : \"\";\n+  const afterAuthReturnTo = searchParams.get(\"after_auth_return_to\");\n+\n+  useEffect(() => {\n+    if (hasInitiated.current) return;\n+    if (!provider || !isValidProvider(provider)) return;\n+\n+    hasInitiated.current = true;\n+\n+    const initiateOAuth = async () => {\n+      try {\n+        // Use signInWithOAuth for direct OAuth flow\n+        // The afterCallbackRedirectUrl should be where Stack Auth redirects after OAuth\n+        await app.signInWithOAuth(provider);\n+      } catch (error) {\n+        console.error(\"[OAuthSignInPage] Failed to initiate OAuth sign-in\", error);\n+        // If OAuth fails, redirect to the default sign-in page\n+        const fallbackUrl = afterAuthReturnTo\n+          ? `${app.urls.signIn}?after_auth_return_to=${encodeURIComponent(afterAuthReturnTo)}`\n+          : app.urls.signIn;\n+        window.location.href = fallbackUrl;\n+      }\n+    };\n+\n+    // Store the callback URL so the after-sign-in page can use it\n+    // Stack Auth's afterSignIn handler will check this\n+    try {\n+      if (afterAuthReturnTo) {\n+        sessionStorage.setItem(\"oauth_callback_url\", afterAuthReturnTo);\n+      }\n+    } catch {\n+      // sessionStorage might not be available\n+    }\n+\n+    void initiateOAuth();\n+  }, [provider, afterAuthReturnTo, app]);\n+\n+  if (!provider || !isValidProvider(provider)) {\n+    return (\n+      <div className=\"min-h-dvh bg-[#05050a] text-white flex items-center justify-center\">\n+        <div className=\"text-center\">\n+          <p className=\"text-red-400\">Invalid OAuth provider</p>\n+        </div>\n+      </div>\n+    );\n+  }\n+\n+  return (\n+    <div className=\"min-h-dvh bg-[#05050a] text-white flex items-center justify-center font-sans\">\n+      <div className=\"flex flex-col items-center gap-4\">\n+        <Loader2 className=\"h-8 w-8 animate-spin text-neutral-400\" />\n+        <p className=\"text-sm text-neutral-400\">\n+          Redirecting to {PROVIDER_DISPLAY_NAMES[provider]}...\n+        </p>\n+      </div>\n+    </div>\n+  );\n+}\ndiff --git a/apps/www/app/sign-in/oauth/callback/page.tsx b/apps/www/app/sign-in/oauth/callback/page.tsx\nnew file mode 100644\nindex 000000000..5b67a7f09\n--- /dev/null\n+++ b/apps/www/app/sign-in/oauth/callback/page.tsx\n@@ -0,0 +1,65 @@\n+\"use client\";\n+\n+import { useEffect } from \"react\";\n+import { Loader2 } from \"lucide-react\";\n+\n+const OAUTH_COMPLETE_KEY = \"oauth_popup_complete\";\n+\n+/**\n+ * OAuth callback page that signals completion to the parent window.\n+ * This page is opened in a popup, and when the OAuth flow completes, Stack Auth\n+ * redirects here. We signal the parent via postMessage and localStorage, then close.\n+ */\n+export default function OAuthCallbackPage() {\n+  useEffect(() => {\n+    // Signal completion to parent window via multiple channels for reliability\n+    const signalCompletion = () => {\n+      // Method 1: postMessage to opener (works if same-origin or if opener exists)\n+      try {\n+        if (window.opener && !window.opener.closed) {\n+          window.opener.postMessage(\n+            { type: OAUTH_COMPLETE_KEY, success: true },\n+            window.location.origin\n+          );\n+        }\n+      } catch {\n+        // Opener might be cross-origin or null\n+      }\n+\n+      // Method 2: localStorage event (works across tabs/windows on same origin)\n+      try {\n+        localStorage.setItem(OAUTH_COMPLETE_KEY, Date.now().toString());\n+        // Remove it immediately - we just need the event to fire\n+        localStorage.removeItem(OAUTH_COMPLETE_KEY);\n+      } catch {\n+        // localStorage might be unavailable\n+      }\n+    };\n+\n+    // Signal completion after a small delay to ensure cookies are set\n+    const signalTimer = setTimeout(signalCompletion, 300);\n+\n+    // Close the popup after signaling\n+    const closeTimer = setTimeout(() => {\n+      window.close();\n+    }, 600);\n+\n+    return () => {\n+      clearTimeout(signalTimer);\n+      clearTimeout(closeTimer);\n+    };\n+  }, []);\n+\n+  return (\n+    <div className=\"min-h-dvh bg-[#05050a] text-white flex items-center justify-center font-sans\">\n+      <div className=\"flex flex-col items-center gap-4\">\n+        <Loader2 className=\"h-8 w-8 animate-spin text-neutral-400\" />\n+        <p className=\"text-sm text-neutral-400\">\n+          Sign in successful. Closing...\n+        </p>\n+      </div>\n+    </div>\n+  );\n+}\n+\n+export { OAUTH_COMPLETE_KEY };\ndiff --git a/apps/www/components/preview/preview-dashboard.tsx b/apps/www/components/preview/preview-dashboard.tsx\nindex 6b711ab33..d98b56a5f 100644\n--- a/apps/www/components/preview/preview-dashboard.tsx\n+++ b/apps/www/components/preview/preview-dashboard.tsx\n@@ -4,6 +4,7 @@ import { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\n import {\n   ArrowLeft,\n   Camera,\n+  CheckCircle2,\n   ExternalLink,\n   Github,\n   Link2,\n@@ -11,20 +12,21 @@ import {\n   Pencil,\n   Search,\n   Server,\n-  Shield,\n   Star,\n   Trash2,\n-  User,\n } from \"lucide-react\";\n import Link from \"next/link\";\n import clsx from \"clsx\";\n import { Button } from \"@/components/ui/button\";\n+import CmuxLogo from \"@/components/logo/cmux-logo\";\n import {\n   Tooltip,\n   TooltipContent,\n   TooltipProvider,\n   TooltipTrigger,\n } from \"@/components/ui/tooltip\";\n+import { LucideIcon } from \"lucide-react\";\n+import { useOAuthPopup } from \"@/hooks/use-oauth-popup\";\n \n type ProviderConnection = {\n   installationId: number;\n@@ -66,34 +68,186 @@ type PreviewDashboardProps = {\n   providerConnectionsByTeam: Record<string, ProviderConnection[]>;\n   isAuthenticated: boolean;\n   previewConfigs: PreviewConfigListItem[];\n+  popupComplete?: boolean;\n };\n \n const ADD_INSTALLATION_VALUE = \"__add_github_account__\";\n \n+type FeatureCardProps = {\n+  icon: LucideIcon;\n+  iconBgColor: string;\n+  iconColor: string;\n+  title: string;\n+  description: string;\n+};\n+\n+function GrainOverlay({ opacity = 0.08 }: { opacity?: number }) {\n+  return (\n+    <div\n+      className=\"pointer-events-none absolute inset-0 mix-blend-overlay\"\n+      style={{\n+        opacity,\n+        backgroundImage: `url(\"data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E\")`,\n+      }}\n+    />\n+  );\n+}\n+\n+function FeatureCard({\n+  icon: _Icon,\n+  iconBgColor: _iconBgColor,\n+  iconColor: _iconColor,\n+  title,\n+  description,\n+}: FeatureCardProps) {\n+  return (\n+    <div className=\"relative flex items-start rounded-lg border border-white/5 bg-white/[0.01] backdrop-blur-sm p-4 overflow-hidden\">\n+      <GrainOverlay />\n+      <div className=\"relative\">\n+        <h4 className=\"text-sm font-medium text-white pb-1\">{title}</h4>\n+        <p className=\"text-[13px] text-neutral-300/90 leading-tight\">\n+          {description}\n+        </p>\n+      </div>\n+    </div>\n+  );\n+}\n+\n+type SectionProps = {\n+  title: string;\n+  headerContent?: React.ReactNode;\n+  children: React.ReactNode;\n+  className?: string;\n+  inlineHeader?: boolean;\n+};\n+\n+function Section({\n+  title,\n+  headerContent,\n+  children,\n+  className,\n+  inlineHeader,\n+}: SectionProps) {\n+  return (\n+    <div className={`flex flex-col h-full ${className ?? \"\"}`}>\n+      <div\n+        className={`flex items-center ${inlineHeader ? \"gap-2\" : \"justify-between gap-2\"} h-[34px] shrink-0 ${inlineHeader ? \"pb-2\" : \"pb-3\"}`}\n+      >\n+        <h2 className=\"text-base font-medium text-white\">{title}</h2>\n+        {headerContent}\n+      </div>\n+      <div className=\"flex flex-col flex-1 min-h-0\">{children}</div>\n+    </div>\n+  );\n+}\n+\n+/**\n+ * Shown in popup after GitHub App installation completes.\n+ * Sends message to opener and auto-closes after delay.\n+ */\n+function PopupCompleteView() {\n+  const [canClose, setCanClose] = useState(true);\n+\n+  useEffect(() => {\n+    if (window.opener) {\n+      try {\n+        window.opener.postMessage(\n+          { type: \"github_app_installed\" },\n+          window.location.origin\n+        );\n+      } catch (error) {\n+        console.error(\"[PopupComplete] Failed to post message\", error);\n+      }\n+\n+      const timer = setTimeout(() => {\n+        try {\n+          window.close();\n+        } catch (error) {\n+          console.error(\"[PopupComplete] Failed to close popup\", error);\n+          setCanClose(false);\n+        }\n+      }, 1500);\n+\n+      return () => clearTimeout(timer);\n+    } else {\n+      window.location.href = \"/preview\";\n+    }\n+  }, []);\n+\n+  return (\n+    <div className=\"min-h-dvh text-white flex items-center justify-center px-6\">\n+      <div className=\"text-center max-w-md\">\n+        <div className=\"mx-auto mb-6 grid place-items-center\">\n+          <div className=\"h-14 w-14 rounded-full bg-emerald-500/10 ring-8 ring-emerald-500/5 grid place-items-center\">\n+            <CheckCircle2 className=\"h-7 w-7 text-emerald-500\" />\n+          </div>\n+        </div>\n+        <h1 className=\"text-2xl font-semibold\">Installation Complete</h1>\n+        <p className=\"mt-2 text-sm text-neutral-400\">\n+          {canClose\n+            ? \"Closing this window...\"\n+            : \"You can close this window and return to the previous page.\"}\n+        </p>\n+        {!canClose && (\n+          <button\n+            type=\"button\"\n+            onClick={() => window.close()}\n+            className=\"mt-6 inline-flex items-center justify-center gap-2 rounded-lg bg-white px-6 py-3 text-base font-medium text-black transition-colors hover:bg-neutral-200\"\n+          >\n+            Close Window\n+          </button>\n+        )}\n+      </div>\n+    </div>\n+  );\n+}\n+\n+/** Opens a centered popup window */\n+function openCenteredPopup(url: string, name: string, width: number, height: number) {\n+  const screenLeft = window.screenLeft ?? window.screenX;\n+  const screenTop = window.screenTop ?? window.screenY;\n+  const screenWidth = window.innerWidth;\n+  const screenHeight = window.innerHeight;\n+\n+  const left = screenLeft + (screenWidth - width) / 2;\n+  const top = screenTop + (screenHeight - height) / 2;\n+\n+  const features = `width=${width},height=${height},left=${left},top=${top},resizable=yes,scrollbars=yes`;\n+  return window.open(url, name, features);\n+}\n+\n export function PreviewDashboard({\n   selectedTeamSlugOrId,\n   teamOptions,\n   providerConnectionsByTeam,\n   isAuthenticated,\n   previewConfigs,\n+  popupComplete,\n }: PreviewDashboardProps) {\n   const [selectedTeamSlugOrIdState, setSelectedTeamSlugOrIdState] = useState(\n-    () => selectedTeamSlugOrId || teamOptions[0]?.slugOrId || \"\",\n+    () => selectedTeamSlugOrId || teamOptions[0]?.slugOrId || \"\"\n   );\n   const [isInstallingApp, setIsInstallingApp] = useState(false);\n   const [errorMessage, setErrorMessage] = useState<string | null>(null);\n   const [configError, setConfigError] = useState<string | null>(null);\n \n   // Repository selection state\n-  const [selectedInstallationId, setSelectedInstallationId] = useState<number | null>(null);\n+  const [selectedInstallationId, setSelectedInstallationId] = useState<\n+    number | null\n+  >(null);\n   const [repoSearch, setRepoSearch] = useState(\"\");\n   const [repos, setRepos] = useState<RepoSearchResult[]>([]);\n   const [isLoadingRepos, setIsLoadingRepos] = useState(false);\n   const [navigatingRepo, setNavigatingRepo] = useState<string | null>(null);\n-  const [configs, setConfigs] = useState<PreviewConfigListItem[]>(previewConfigs);\n+  const [configs, setConfigs] =\n+    useState<PreviewConfigListItem[]>(previewConfigs);\n   const [updatingConfigId, setUpdatingConfigId] = useState<string | null>(null);\n   const [openingConfigId, setOpeningConfigId] = useState<string | null>(null);\n-  const [configPendingDelete, setConfigPendingDelete] = useState<PreviewConfigListItem | null>(null);\n+  const [configPendingDelete, setConfigPendingDelete] =\n+    useState<PreviewConfigListItem | null>(null);\n+\n+  // OAuth sign-in with popup\n+  const { signInWithPopup, signingInProvider } = useOAuthPopup();\n \n   // Public URL input state\n   const [repoUrlInput, setRepoUrlInput] = useState(\"\");\n@@ -103,7 +257,8 @@ export function PreviewDashboard({\n     [providerConnectionsByTeam, selectedTeamSlugOrIdState]\n   );\n   const activeConnections = useMemo(\n-    () => currentProviderConnections.filter((connection) => connection.isActive),\n+    () =>\n+      currentProviderConnections.filter((connection) => connection.isActive),\n     [currentProviderConnections]\n   );\n   const previousTeamRef = useRef(selectedTeamSlugOrIdState);\n@@ -131,7 +286,9 @@ export function PreviewDashboard({\n       }\n     } catch {\n       // Not a valid URL, check if it's owner/repo format\n-      const ownerRepoMatch = trimmed.match(/^([a-zA-Z0-9_.-]+)\\/([a-zA-Z0-9_.-]+)$/);\n+      const ownerRepoMatch = trimmed.match(\n+        /^([a-zA-Z0-9_.-]+)\\/([a-zA-Z0-9_.-]+)$/\n+      );\n       if (ownerRepoMatch) {\n         return trimmed;\n       }\n@@ -164,20 +321,32 @@ export function PreviewDashboard({\n     setUpdatingConfigId(configPendingDelete.id);\n     setConfigError(null);\n     try {\n-      const params = new URLSearchParams({ teamSlugOrId: configPendingDelete.teamSlugOrId });\n-      const response = await fetch(`/api/preview/configs/${configPendingDelete.id}?${params.toString()}`, {\n-        method: \"DELETE\",\n-        headers: { \"Content-Type\": \"application/json\" },\n+      const params = new URLSearchParams({\n+        teamSlugOrId: configPendingDelete.teamSlugOrId,\n       });\n+      const response = await fetch(\n+        `/api/preview/configs/${configPendingDelete.id}?${params.toString()}`,\n+        {\n+          method: \"DELETE\",\n+          headers: { \"Content-Type\": \"application/json\" },\n+        }\n+      );\n       if (!response.ok) {\n         throw new Error(await response.text());\n       }\n-      setConfigs((previous) => previous.filter((item) => item.id !== configPendingDelete.id));\n+      setConfigs((previous) =>\n+        previous.filter((item) => item.id !== configPendingDelete.id)\n+      );\n       setConfigPendingDelete(null);\n     } catch (error) {\n       const message =\n-        error instanceof Error ? error.message : \"Failed to delete preview configuration\";\n-      console.error(\"[PreviewDashboard] Failed to delete preview configuration\", error);\n+        error instanceof Error\n+          ? error.message\n+          : \"Failed to delete preview configuration\";\n+      console.error(\n+        \"[PreviewDashboard] Failed to delete preview configuration\",\n+        error\n+      );\n       setConfigError(message);\n     } finally {\n       setUpdatingConfigId(null);\n@@ -188,15 +357,12 @@ export function PreviewDashboard({\n     setConfigPendingDelete(null);\n   }, []);\n \n-  const handleTeamChange = useCallback(\n-    (nextTeam: string) => {\n-      setSelectedTeamSlugOrIdState(nextTeam);\n-      setSelectedInstallationId(null);\n-      setRepoSearch(\"\");\n-      setErrorMessage(null);\n-    },\n-    []\n-  );\n+  const handleTeamChange = useCallback((nextTeam: string) => {\n+    setSelectedTeamSlugOrIdState(nextTeam);\n+    setSelectedInstallationId(null);\n+    setRepoSearch(\"\");\n+    setErrorMessage(null);\n+  }, []);\n \n   const handleStartPreview = useCallback(async () => {\n     const repoName = parseGithubUrl(repoUrlInput);\n@@ -234,18 +400,15 @@ export function PreviewDashboard({\n       setNavigatingRepo(\"__url_input__\");\n \n       try {\n-        try {\n-          sessionStorage.setItem(\"pr_review_return_url\", configurePath);\n-        } catch (storageError) {\n-          console.warn(\"[PreviewDashboard] Failed to persist return URL\", storageError);\n-        }\n-\n         const response = await fetch(\"/api/integrations/github/install-state\", {\n           method: \"POST\",\n           headers: { \"Content-Type\": \"application/json\" },\n           body: JSON.stringify({\n             teamSlugOrId: selectedTeamSlugOrIdState,\n-            returnUrl: new URL(configurePath, window.location.origin).toString(),\n+            returnUrl: new URL(\n+              configurePath,\n+              window.location.origin\n+            ).toString(),\n           }),\n         });\n \n@@ -259,14 +422,21 @@ export function PreviewDashboard({\n           throw new Error(\"GitHub App slug is not configured\");\n         }\n \n-        const url = new URL(`https://github.com/apps/${githubAppSlug}/installations/new`);\n+        const url = new URL(\n+          `https://github.com/apps/${githubAppSlug}/installations/new`\n+        );\n         url.searchParams.set(\"state\", payload.state);\n         window.location.href = url.toString();\n         return;\n       } catch (error) {\n         const message =\n-          error instanceof Error ? error.message : \"Failed to start GitHub App install\";\n-        console.error(\"[PreviewDashboard] Failed to start GitHub App install\", error);\n+          error instanceof Error\n+            ? error.message\n+            : \"Failed to start GitHub App install\";\n+        console.error(\n+          \"[PreviewDashboard] Failed to start GitHub App install\",\n+          error\n+        );\n         setErrorMessage(message);\n         setIsInstallingApp(false);\n         setNavigatingRepo(null);\n@@ -306,38 +476,94 @@ export function PreviewDashboard({\n     previousTeamRef.current = selectedTeamSlugOrIdState;\n   }, [activeConnections, selectedInstallationId, selectedTeamSlugOrIdState]);\n \n+  // Popup ref and listener for GitHub App installation\n+  const installPopupRef = useRef<Window | null>(null);\n+\n+  // Listen for GitHub App installation completion\n+  useEffect(() => {\n+    const handleMessage = (event: MessageEvent) => {\n+      if (event.origin !== window.location.origin) return;\n+      if (event.data?.type === \"github_app_installed\") {\n+        setIsInstallingApp(false);\n+        // Reload to get the new installation\n+        window.location.reload();\n+      }\n+    };\n+\n+    const handleFocus = () => {\n+      // Check if popup was closed when we regain focus\n+      if (installPopupRef.current && isInstallingApp) {\n+        setTimeout(() => {\n+          try {\n+            if (installPopupRef.current?.closed) {\n+              setIsInstallingApp(false);\n+              installPopupRef.current = null;\n+            }\n+          } catch {\n+            // Ignore cross-origin errors\n+          }\n+        }, 500);\n+      }\n+    };\n+\n+    window.addEventListener(\"message\", handleMessage);\n+    window.addEventListener(\"focus\", handleFocus);\n+\n+    return () => {\n+      window.removeEventListener(\"message\", handleMessage);\n+      window.removeEventListener(\"focus\", handleFocus);\n+    };\n+  }, [isInstallingApp]);\n+\n   const handleInstallGithubApp = async () => {\n     if (!selectedTeamSlugOrIdState) {\n       setErrorMessage(\"Select a team first\");\n       return;\n     }\n+\n     setIsInstallingApp(true);\n     setErrorMessage(null);\n     try {\n-      const currentUrl = window.location.href;\n-      try {\n-        sessionStorage.setItem(\"pr_review_return_url\", currentUrl);\n-      } catch (storageError) {\n-        console.warn(\"[PreviewDashboard] Failed to persist return URL\", storageError);\n-      }\n+      // Use popup_complete query param as returnUrl so it can signal the parent window and close\n+      const popupCompleteUrl = new URL(\n+        \"/preview?popup_complete=true\",\n+        window.location.origin\n+      ).toString();\n \n       const response = await fetch(\"/api/integrations/github/install-state\", {\n         method: \"POST\",\n         headers: { \"Content-Type\": \"application/json\" },\n         body: JSON.stringify({\n           teamSlugOrId: selectedTeamSlugOrIdState,\n-          returnUrl: currentUrl,\n+          returnUrl: popupCompleteUrl,\n         }),\n       });\n       if (!response.ok) {\n         throw new Error(await response.text());\n       }\n       const payload = (await response.json()) as { installUrl: string };\n-      window.location.href = payload.installUrl;\n+\n+      // Open centered popup for GitHub App installation\n+      const popup = openCenteredPopup(payload.installUrl, \"github-app-install\", 1000, 700);\n+\n+      if (!popup) {\n+        // Popup was blocked - fall back to redirect\n+        console.warn(\"[PreviewDashboard] Popup blocked, falling back to redirect\");\n+        window.location.href = payload.installUrl;\n+        return;\n+      }\n+\n+      installPopupRef.current = popup;\n+      popup.focus();\n     } catch (error) {\n       const message =\n-        error instanceof Error ? error.message : \"Failed to start GitHub App install\";\n-      console.error(\"[PreviewDashboard] Failed to start GitHub App install\", error);\n+        error instanceof Error\n+          ? error.message\n+          : \"Failed to start GitHub App install\";\n+      console.error(\n+        \"[PreviewDashboard] Failed to start GitHub App install\",\n+        error\n+      );\n       setErrorMessage(message);\n       setIsInstallingApp(false);\n     }\n@@ -360,13 +586,18 @@ export function PreviewDashboard({\n         if (trimmed) {\n           params.set(\"search\", trimmed);\n         }\n-        const response = await fetch(`/api/integrations/github/repos?${params.toString()}`, {\n-          signal,\n-        });\n+        const response = await fetch(\n+          `/api/integrations/github/repos?${params.toString()}`,\n+          {\n+            signal,\n+          }\n+        );\n         if (!response.ok) {\n           throw new Error(await response.text());\n         }\n-        const payload = (await response.json()) as { repos: RepoSearchResult[] };\n+        const payload = (await response.json()) as {\n+          repos: RepoSearchResult[];\n+        };\n         setRepos(trimmed ? payload.repos : payload.repos.slice(0, 5));\n         setIsLoadingRepos(false);\n       } catch (err) {\n@@ -374,7 +605,8 @@ export function PreviewDashboard({\n           // Request was cancelled, don't update any state\n           return;\n         }\n-        const message = err instanceof Error ? err.message : \"Failed to load repositories\";\n+        const message =\n+          err instanceof Error ? err.message : \"Failed to load repositories\";\n         console.error(\"[PreviewDashboard] Failed to load repositories\", err);\n         setErrorMessage(message);\n         setIsLoadingRepos(false);\n@@ -383,7 +615,6 @@ export function PreviewDashboard({\n     [canSearchRepos, selectedInstallationId, selectedTeamSlugOrIdState]\n   );\n \n-\n   // Debounced search effect with abort controller\n   useEffect(() => {\n     if (!canSearchRepos || selectedInstallationId === null) {\n@@ -402,16 +633,19 @@ export function PreviewDashboard({\n     };\n   }, [repoSearch, canSearchRepos, selectedInstallationId, fetchRepos]);\n \n-  const handleContinue = useCallback((repoName: string) => {\n-    if (!repoName.trim()) return;\n-    setNavigatingRepo(repoName);\n-    const params = new URLSearchParams({\n-      repo: repoName,\n-      installationId: String(selectedInstallationId ?? \"\"),\n-      team: selectedTeamSlugOrIdState,\n-    });\n-    window.location.href = `/preview/configure?${params.toString()}`;\n-  }, [selectedInstallationId, selectedTeamSlugOrIdState]);\n+  const handleContinue = useCallback(\n+    (repoName: string) => {\n+      if (!repoName.trim()) return;\n+      setNavigatingRepo(repoName);\n+      const params = new URLSearchParams({\n+        repo: repoName,\n+        installationId: String(selectedInstallationId ?? \"\"),\n+        team: selectedTeamSlugOrIdState,\n+      });\n+      window.location.href = `/preview/configure?${params.toString()}`;\n+    },\n+    [selectedInstallationId, selectedTeamSlugOrIdState]\n+  );\n \n   useEffect(() => {\n     if (selectedInstallationId !== null) {\n@@ -433,25 +667,96 @@ export function PreviewDashboard({\n \n   // Repo selection box - only this part, not configured repos\n   const repoSelectionBox = !isAuthenticated ? (\n-    <div className=\"flex flex-1 flex-col items-center justify-center rounded-lg border border-white/5 bg-white/[0.02]\">\n-      <User className=\"h-6 w-6 text-neutral-500 mb-3\" />\n-      <h3 className=\"text-base font-medium text-white mb-1.5\">Sign in to continue</h3>\n-      <p className=\"text-sm text-neutral-500 mb-5 max-w-xs text-center\">\n-        Sign in to import your repositories and capture pull requests.\n+    <div className=\"relative flex flex-1 flex-col items-center justify-center rounded-lg border border-white/5 bg-white/[0.02] backdrop-blur-sm px-4 py-10 overflow-hidden\">\n+      <GrainOverlay opacity={0.02} />\n+      <p className=\"text-sm text-neutral-300/85 pb-6 max-w-xs text-center\">\n+        Select a Git provider to import a Git Repository\n       </p>\n-      <Button asChild className=\"bg-white text-black hover:bg-neutral-200\">\n-        <Link href=\"/handler/sign-in?after_auth_return_to=/preview\">\n-          Sign In\n-        </Link>\n-      </Button>\n+      <div className=\"flex flex-col gap-3 w-full max-w-xs\">\n+        <Button\n+          onClick={() => signInWithPopup(\"github\")}\n+          disabled={signingInProvider !== null}\n+          className=\"w-full h-10 bg-[#24292f] text-white hover:bg-[#32383f] inline-flex items-center justify-center gap-2 disabled:opacity-50\"\n+        >\n+          {signingInProvider === \"github\" ? (\n+            <Loader2 className=\"h-[18px] w-[18px] animate-spin\" />\n+          ) : (\n+            <svg\n+              className=\"h-[18px] w-[18px] shrink-0\"\n+              viewBox=\"0 0 24 24\"\n+              fill=\"currentColor\"\n+            >\n+              <path d=\"M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z\" />\n+            </svg>\n+          )}\n+          Continue with GitHub\n+        </Button>\n+        <Button\n+          onClick={() => signInWithPopup(\"gitlab\")}\n+          disabled={signingInProvider !== null}\n+          className=\"w-full h-10 bg-[#fc6d26] text-white hover:bg-[#ff8245] inline-flex items-center justify-center gap-2 disabled:opacity-50\"\n+        >\n+          {signingInProvider === \"gitlab\" ? (\n+            <Loader2 className=\"h-4 w-4 animate-spin\" />\n+          ) : (\n+            <svg\n+              className=\"h-4 w-4 shrink-0\"\n+              viewBox=\"90 90 200 175\"\n+              fill=\"currentColor\"\n+            >\n+              <path d=\"M282.83,170.73l-.27-.69-26.14-68.22a6.81,6.81,0,0,0-2.69-3.24,7,7,0,0,0-8,.43,7,7,0,0,0-2.32,3.52l-17.65,54H154.29l-17.65-54A6.86,6.86,0,0,0,134.32,99a7,7,0,0,0-8-.43,6.87,6.87,0,0,0-2.69,3.24L97.44,170l-.26.69a48.54,48.54,0,0,0,16.1,56.1l.09.07.24.17,39.82,29.82,19.7,14.91,12,9.06a8.07,8.07,0,0,0,9.76,0l12-9.06,19.7-14.91,40.06-30,.1-.08A48.56,48.56,0,0,0,282.83,170.73Z\" />\n+            </svg>\n+          )}\n+          Continue with GitLab\n+        </Button>\n+        <Button\n+          onClick={() => signInWithPopup(\"bitbucket\")}\n+          disabled={signingInProvider !== null}\n+          className=\"w-full h-10 bg-[#0052cc] text-white hover:bg-[#006cf2] inline-flex items-center justify-center gap-2 disabled:opacity-50\"\n+        >\n+          {signingInProvider === \"bitbucket\" ? (\n+            <Loader2 className=\"h-4 w-4 animate-spin\" />\n+          ) : (\n+            <svg className=\"h-4 w-4 shrink-0\" viewBox=\"-2 -2 65 59\">\n+              <defs>\n+                <linearGradient\n+                  id=\"bitbucket-grad\"\n+                  x1=\"104.953%\"\n+                  x2=\"46.569%\"\n+                  y1=\"21.921%\"\n+                  y2=\"75.234%\"\n+                >\n+                  <stop\n+                    offset=\"7%\"\n+                    stopColor=\"currentColor\"\n+                    stopOpacity=\"0.4\"\n+                  />\n+                  <stop offset=\"100%\" stopColor=\"currentColor\" />\n+                </linearGradient>\n+              </defs>\n+              <path\n+                d=\"M59.696 18.86h-18.77l-3.15 18.39h-13L9.426 55.47a2.71 2.71 0 001.75.66h40.74a2 2 0 002-1.68l5.78-35.59z\"\n+                fill=\"url(#bitbucket-grad)\"\n+                fillRule=\"nonzero\"\n+                transform=\"translate(-.026 .82)\"\n+              />\n+              <path\n+                d=\"M2 .82a2 2 0 00-2 2.32l8.49 51.54a2.7 2.7 0 00.91 1.61 2.71 2.71 0 001.75.66l15.76-18.88H24.7l-3.47-18.39h38.44l2.7-16.53a2 2 0 00-2-2.32L2 .82z\"\n+                fill=\"currentColor\"\n+                fillRule=\"nonzero\"\n+              />\n+            </svg>\n+          )}\n+          Continue with Bitbucket\n+        </Button>\n+      </div>\n     </div>\n   ) : !hasGithubAppInstallation ? (\n-    <div className=\"flex flex-1 flex-col items-center justify-center rounded-lg border border-white/5 bg-white/[0.02]\">\n-      <Github className=\"h-6 w-6 text-neutral-500 mb-3\" />\n-      <h3 className=\"text-base font-medium text-white mb-1.5\">Connect to GitHub</h3>\n-      <p className=\"text-sm text-neutral-500 mb-5 max-w-xs text-center\">\n-        Install the preview.new GitHub App to connect your repositories.\n-      </p>\n+    <div className=\"relative flex flex-1 flex-col items-center justify-center rounded-lg border border-white/5 bg-white/[0.02] backdrop-blur-sm overflow-hidden\">\n+      <GrainOverlay opacity={0.02} />\n+      <h3 className=\"text-base font-medium text-white pb-5\">\n+        No connected repositories\n+      </h3>\n       <Button\n         onClick={handleInstallGithubApp}\n         disabled={isInstallingApp}\n@@ -460,12 +765,18 @@ export function PreviewDashboard({\n         {isInstallingApp ? (\n           <Loader2 className=\"h-4 w-4 animate-spin\" />\n         ) : (\n-          <Shield className=\"h-4 w-4\" />\n+          <svg\n+            className=\"h-4 w-4\"\n+            viewBox=\"0 0 24 24\"\n+            fill=\"currentColor\"\n+          >\n+            <path d=\"M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z\" />\n+          </svg>\n         )}\n-        Install GitHub App\n+        Add repositories\n       </Button>\n       {errorMessage && (\n-        <p className=\"mt-4 text-sm text-red-400\">{errorMessage}</p>\n+        <p className=\"pt-4 text-sm text-red-400\">{errorMessage}</p>\n       )}\n     </div>\n   ) : (\n@@ -496,8 +807,18 @@ export function PreviewDashboard({\n             <option value={ADD_INSTALLATION_VALUE}>Add account</option>\n           </select>\n           <div className=\"pointer-events-none absolute right-2.5 top-1/2 -translate-y-1/2\">\n-            <svg className=\"h-4 w-4 text-neutral-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n-              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n+            <svg\n+              className=\"h-4 w-4 text-neutral-500\"\n+              fill=\"none\"\n+              viewBox=\"0 0 24 24\"\n+              stroke=\"currentColor\"\n+            >\n+              <path\n+                strokeLinecap=\"round\"\n+                strokeLinejoin=\"round\"\n+                strokeWidth={2}\n+                d=\"M19 9l-7 7-7-7\"\n+              />\n             </svg>\n           </div>\n         </div>\n@@ -563,32 +884,37 @@ export function PreviewDashboard({\n     </div>\n   );\n \n+  // Render popup complete UI if in popup mode\n+  if (popupComplete) {\n+    return <PopupCompleteView />;\n+  }\n+\n   return (\n-    <div className=\"mx-auto w-full max-w-5xl px-6 py-10\">\n+    <div className=\"w-full max-w-5xl px-6 py-10 font-sans\">\n       {/* Header */}\n-      <div className=\"mb-10\">\n+      <div className=\"pb-10\">\n         <Link\n           href=\"https://cmux.dev\"\n-          className=\"inline-flex items-center gap-2 text-sm text-neutral-400 transition hover:text-white mb-5\"\n+          className=\"inline-flex items-center gap-2 text-sm text-neutral-400 transition hover:text-white pb-5\"\n         >\n           <ArrowLeft className=\"h-4 w-4\" />\n           <span>Back to cmux</span>\n         </Link>\n \n-        <h1 className=\"text-3xl font-semibold tracking-tight text-white mb-2\">\n+        <h1 className=\"text-3xl font-semibold tracking-tight text-white pb-2\">\n           Screenshot previews for GitHub PRs\n         </h1>\n-        <p className=\"text-base text-neutral-400 max-w-2xl\">\n-          preview.new sets up a GitHub agent that takes screenshot previews of your dev server so you\n-          can visually verify your pull requests.\n+        <p className=\"text-lg text-neutral-300/85 max-w-2xl\">\n+          Code review agent that takes screenshots of code diffs involving UI\n+          changes\n         </p>\n       </div>\n \n       {/* Quick Setup Input */}\n-      <div id=\"setup-preview\" className=\"mb-10\">\n+      <div id=\"setup-preview\" className=\"pb-10\">\n         <div className=\"flex rounded-lg border border-white/10 overflow-hidden\">\n-          <div className=\"relative flex-1 flex items-center\">\n-            <Link2 className=\"absolute left-4 h-5 w-5 text-neutral-500\" />\n+          <div className=\"relative flex-1 flex items-center bg-white/5 backdrop-blur-sm\">\n+            <Link2 className=\"absolute left-4 h-5 w-5 text-neutral-500 z-10\" />\n             <input\n               type=\"text\"\n               value={repoUrlInput}\n@@ -600,8 +926,12 @@ export function PreviewDashboard({\n           </div>\n           <Button\n             onClick={() => void handleStartPreview()}\n-            disabled={!repoUrlInput.trim() || navigatingRepo !== null || (isAuthenticated && !selectedTeamSlugOrIdState)}\n-            className=\"h-10 px-4 rounded-none bg-white text-black hover:bg-neutral-200 text-sm font-medium\"\n+            disabled={\n+              !repoUrlInput.trim() ||\n+              navigatingRepo !== null ||\n+              (isAuthenticated && !selectedTeamSlugOrIdState)\n+            }\n+            className=\"h-10 px-4 rounded-none bg-white/90 backdrop-blur-sm text-black hover:bg-white text-sm font-medium\"\n           >\n             {navigatingRepo === \"__url_input__\" ? (\n               <Loader2 className=\"h-4 w-4 animate-spin\" />\n@@ -610,210 +940,215 @@ export function PreviewDashboard({\n             )}\n           </Button>\n         </div>\n-        {!isAuthenticated && (\n-          <p className=\"text-xs text-neutral-500 mt-2\">\n-            You&apos;ll be asked to sign in to continue.\n-          </p>\n-        )}\n         {errorMessage && (\n-          <p className=\"text-xs text-red-400 mt-2\">{errorMessage}</p>\n+          <p className=\"text-xs text-red-400 pt-2\">{errorMessage}</p>\n         )}\n       </div>\n \n       {/* Main content grid */}\n       <div className=\"grid gap-6 lg:grid-cols-[minmax(0,1.35fr)_minmax(0,1fr)]\">\n-        {/* Left Column Header */}\n-        <div className=\"flex items-center justify-between min-h-[34px]\">\n-          <h2 className=\"text-base font-medium text-white\">Choose a repository</h2>\n-          {isAuthenticated && teamOptions.length > 0 && (\n-            <div className=\"flex items-center gap-2.5\">\n-              <label className=\"text-sm text-neutral-500\">Team</label>\n-              <div className=\"relative\">\n-                <select\n-                  value={selectedTeamSlugOrIdState}\n-                  onChange={(e) => handleTeamChange(e.target.value)}\n-                  className=\"appearance-none rounded-md border border-white/10 bg-white/5 pl-3 pr-8 py-1.5 text-sm text-white focus:border-white/20 focus:outline-none\"\n-                >\n-                  {teamOptions.map((team) => (\n-                    <option key={team.slugOrId} value={team.slugOrId}>\n-                      {team.displayName}\n-                    </option>\n-                  ))}\n-                </select>\n-                <div className=\"pointer-events-none absolute right-2.5 top-2\">\n-                  <svg className=\"h-4 w-4 text-neutral-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n-                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n-                  </svg>\n+        {/* Left Column: Choose a repository */}\n+        <Section\n+          title=\"Choose a repository\"\n+          headerContent={\n+            isAuthenticated && teamOptions.length > 0 ? (\n+              <div className=\"flex items-center gap-2.5\">\n+                <label className=\"text-sm text-neutral-500\">Team</label>\n+                <div className=\"relative\">\n+                  <select\n+                    value={selectedTeamSlugOrIdState}\n+                    onChange={(e) => handleTeamChange(e.target.value)}\n+                    className=\"appearance-none rounded-md border border-white/10 bg-white/5 pl-3 pr-8 py-1.5 text-sm text-white focus:border-white/20 focus:outline-none\"\n+                  >\n+                    {teamOptions.map((team) => (\n+                      <option key={team.slugOrId} value={team.slugOrId}>\n+                        {team.displayName}\n+                      </option>\n+                    ))}\n+                  </select>\n+                  <div className=\"pointer-events-none absolute right-2.5 top-2\">\n+                    <svg\n+                      className=\"h-4 w-4 text-neutral-500\"\n+                      fill=\"none\"\n+                      viewBox=\"0 0 24 24\"\n+                      stroke=\"currentColor\"\n+                    >\n+                      <path\n+                        strokeLinecap=\"round\"\n+                        strokeLinejoin=\"round\"\n+                        strokeWidth={2}\n+                        d=\"M19 9l-7 7-7-7\"\n+                      />\n+                    </svg>\n+                  </div>\n                 </div>\n               </div>\n-            </div>\n-          )}\n-        </div>\n-\n-        {/* Right Column Header */}\n-        <div className=\"flex items-center justify-between min-h-[34px]\">\n-          <h2 className=\"text-base font-medium text-white\">What is preview.new?</h2>\n-        </div>\n-\n-        {/* Left: Repo selection box */}\n-        <div className=\"flex flex-col\">\n+            ) : undefined\n+          }\n+        >\n           {repoSelectionBox}\n-        </div>\n-\n-        {/* Right: Feature cards */}\n-        <div className=\"space-y-3\">\n-          <div className=\"flex items-start gap-4 rounded-lg border border-white/5 bg-white/5 p-4\">\n-            <div className=\"shrink-0 rounded p-2 bg-sky-500/10 text-sky-400\">\n-              <Camera className=\"h-5 w-5\" />\n-            </div>\n-            <div>\n-              <h4 className=\"text-sm font-medium text-white mb-1\">Screenshot agent</h4>\n-              <p className=\"text-xs text-neutral-400 leading-relaxed\">\n-                An agent boots your dev server and captures screenshots of your UI on every PR.\n-              </p>\n-            </div>\n-          </div>\n+        </Section>\n \n-          <div className=\"flex items-start gap-4 rounded-lg border border-white/5 bg-white/5 p-4\">\n-            <div className=\"shrink-0 rounded p-2 bg-emerald-500/10 text-emerald-400\">\n-              <Github className=\"h-5 w-5\" />\n-            </div>\n-            <div>\n-              <h4 className=\"text-sm font-medium text-white mb-1\">GitHub comments</h4>\n-              <p className=\"text-xs text-neutral-400 leading-relaxed\">\n-                Screenshots are posted directly to your PR as comments for easy review.\n-              </p>\n-            </div>\n+        {/* Right Column: What is preview.new? */}\n+        <Section title=\"What is preview.new?\">\n+          <div className=\"space-y-3\">\n+            <FeatureCard\n+              icon={Camera}\n+              iconBgColor=\"bg-sky-500/10\"\n+              iconColor=\"text-sky-400\"\n+              title=\"Computer use agent\"\n+              description=\"An agent boots your dev server and captures screenshots of your UI on every PR.\"\n+            />\n+            <FeatureCard\n+              icon={Github}\n+              iconBgColor=\"bg-emerald-500/10\"\n+              iconColor=\"text-emerald-400\"\n+              title=\"GitHub comments\"\n+              description=\"Screenshots are posted directly to your PR as comments for easy review.\"\n+            />\n+            <FeatureCard\n+              icon={Server}\n+              iconBgColor=\"bg-purple-500/10\"\n+              iconColor=\"text-purple-400\"\n+              title=\"Isolated dev servers\"\n+              description=\"Each PR runs in a dedicated VM with your exact dev environment.\"\n+            />\n           </div>\n+        </Section>\n \n-          <div className=\"flex items-start gap-4 rounded-lg border border-white/5 bg-white/5 p-4\">\n-            <div className=\"shrink-0 rounded p-2 bg-purple-500/10 text-purple-400\">\n-              <Server className=\"h-5 w-5\" />\n-            </div>\n-            <div>\n-              <h4 className=\"text-sm font-medium text-white mb-1\">Isolated VMs</h4>\n-              <p className=\"text-xs text-neutral-400 leading-relaxed\">\n-                Each PR runs in a dedicated VM with your exact dev environment.\n+        {/* Configured repositories and From creators */}\n+        <div className=\"pt-4 lg:col-span-2 grid gap-6 lg:grid-cols-[minmax(0,1.35fr)_minmax(0,1fr)]\">\n+          {/* Left: Configured repositories */}\n+          <Section\n+            title=\"Configured repositories\"\n+            headerContent={\n+              configError ? (\n+                <span className=\"text-sm text-red-400\">{configError}</span>\n+              ) : undefined\n+            }\n+          >\n+            {configs.length === 0 ? (\n+              <p className=\"text-sm text-neutral-400\">\n+                No preview configs yet.{\" \"}\n+                {isAuthenticated && hasGithubAppInstallation\n+                  ? \"Choose a repository above to create one.\"\n+                  : \"Connect GitHub and import a repository to get started.\"}\n               </p>\n-            </div>\n-          </div>\n-        </div>\n-\n-        {/* Left: Configured repositories */}\n-        <div>\n-          <div className=\"flex items-center justify-between mb-6\">\n-            <h2 className=\"text-base font-medium text-white\">Configured repositories</h2>\n-            {configError && <span className=\"text-sm text-red-400\">{configError}</span>}\n-          </div>\n-          {configs.length === 0 ? (\n-            <p className=\"text-sm text-neutral-500\">\n-              No preview configs yet.{\" \"}\n-              {isAuthenticated && hasGithubAppInstallation\n-                ? \"Choose a repository above to create one.\"\n-                : \"Connect GitHub and import a repository to get started.\"}\n-            </p>\n-          ) : (\n-            <TooltipProvider delayDuration={100}>\n-              <div className=\"space-y-1.5\">\n-                {configs.map((config) => (\n-                  <div\n-                    key={config.id}\n-                    className=\"flex items-center justify-between px-3 py-2.5\"\n-                  >\n-                    <div className=\"flex items-center gap-2.5 min-w-0\">\n-                      <Github className=\"h-4 w-4 text-neutral-500 shrink-0\" />\n-                      <span className=\"text-sm text-white truncate\">{config.repoFullName}</span>\n-                      <span className=\"text-xs text-neutral-600\">{config.teamName}</span>\n-                      <span\n-                        className={clsx(\n-                          \"text-xs px-2 py-0.5 rounded\",\n-                          config.status === \"active\"\n-                            ? \"bg-emerald-500/10 text-emerald-400\"\n-                            : config.status === \"paused\"\n-                              ? \"bg-amber-500/10 text-amber-400\"\n-                              : \"bg-neutral-500/10 text-neutral-400\"\n-                        )}\n-                      >\n-                        {config.status}\n-                      </span>\n-                    </div>\n-                    <div className=\"flex items-center gap-1.5\">\n-                      <Tooltip>\n-                        <TooltipTrigger asChild>\n-                          <button\n-                            type=\"button\"\n-                            onClick={() => handleOpenConfig(config)}\n-                            disabled={openingConfigId === config.id}\n-                            className=\"p-1.5 text-neutral-500 disabled:opacity-50\"\n-                          >\n-                            {openingConfigId === config.id ? (\n-                              <Loader2 className=\"h-4 w-4 animate-spin\" />\n-                            ) : (\n-                              <Pencil className=\"h-4 w-4\" />\n-                            )}\n-                          </button>\n-                        </TooltipTrigger>\n-                        <TooltipContent side=\"top\" className=\"text-xs\">\n-                          Edit configuration\n-                        </TooltipContent>\n-                      </Tooltip>\n-                      <Tooltip>\n-                        <TooltipTrigger asChild>\n-                          <button\n-                            type=\"button\"\n-                            onClick={() => handleRequestDelete(config)}\n-                            disabled={updatingConfigId === config.id}\n-                            className=\"p-1.5 text-red-400 disabled:opacity-50\"\n-                          >\n-                            {updatingConfigId === config.id ? (\n-                              <Loader2 className=\"h-4 w-4 animate-spin\" />\n-                            ) : (\n-                              <Trash2 className=\"h-4 w-4\" />\n-                            )}\n-                          </button>\n-                        </TooltipTrigger>\n-                        <TooltipContent side=\"top\" className=\"text-xs\">\n-                          Delete configuration\n-                        </TooltipContent>\n-                      </Tooltip>\n+            ) : (\n+              <TooltipProvider delayDuration={100}>\n+                <div className=\"space-y-1.5\">\n+                  {configs.map((config) => (\n+                    <div\n+                      key={config.id}\n+                      className=\"flex items-center justify-between px-3 py-2.5\"\n+                    >\n+                      <div className=\"flex items-center gap-2.5 min-w-0\">\n+                        <Github className=\"h-4 w-4 text-neutral-500 shrink-0\" />\n+                        <span className=\"text-sm text-white truncate\">\n+                          {config.repoFullName}\n+                        </span>\n+                        <span className=\"text-xs text-neutral-600\">\n+                          {config.teamName}\n+                        </span>\n+                        <span\n+                          className={clsx(\n+                            \"text-xs px-2 py-0.5 rounded\",\n+                            config.status === \"active\"\n+                              ? \"bg-emerald-500/10 text-emerald-400\"\n+                              : config.status === \"paused\"\n+                                ? \"bg-amber-500/10 text-amber-400\"\n+                                : \"bg-neutral-500/10 text-neutral-400\"\n+                          )}\n+                        >\n+                          {config.status}\n+                        </span>\n+                      </div>\n+                      <div className=\"flex items-center gap-1.5\">\n+                        <Tooltip>\n+                          <TooltipTrigger asChild>\n+                            <button\n+                              type=\"button\"\n+                              onClick={() => handleOpenConfig(config)}\n+                              disabled={openingConfigId === config.id}\n+                              className=\"p-1.5 text-neutral-500 disabled:opacity-50\"\n+                            >\n+                              {openingConfigId === config.id ? (\n+                                <Loader2 className=\"h-4 w-4 animate-spin\" />\n+                              ) : (\n+                                <Pencil className=\"h-4 w-4\" />\n+                              )}\n+                            </button>\n+                          </TooltipTrigger>\n+                          <TooltipContent side=\"top\" className=\"text-xs\">\n+                            Edit configuration\n+                          </TooltipContent>\n+                        </Tooltip>\n+                        <Tooltip>\n+                          <TooltipTrigger asChild>\n+                            <button\n+                              type=\"button\"\n+                              onClick={() => handleRequestDelete(config)}\n+                              disabled={updatingConfigId === config.id}\n+                              className=\"p-1.5 text-red-400 disabled:opacity-50\"\n+                            >\n+                              {updatingConfigId === config.id ? (\n+                                <Loader2 className=\"h-4 w-4 animate-spin\" />\n+                              ) : (\n+                                <Trash2 className=\"h-4 w-4\" />\n+                              )}\n+                            </button>\n+                          </TooltipTrigger>\n+                          <TooltipContent side=\"top\" className=\"text-xs\">\n+                            Delete configuration\n+                          </TooltipContent>\n+                        </Tooltip>\n+                      </div>\n                     </div>\n-                  </div>\n-                ))}\n-              </div>\n-            </TooltipProvider>\n-          )}\n-        </div>\n+                  ))}\n+                </div>\n+              </TooltipProvider>\n+            )}\n+          </Section>\n \n-        {/* Right: From creators section */}\n-        <div>\n-          <div className=\"flex items-center gap-2 mb-6\">\n-            <h2 className=\"text-base font-medium text-white\">From the creators of</h2>\n-            <div className=\"inline-flex items-center gap-1.5 text-white\">\n-              <span className=\"text-blue-400\">&gt;</span>\n-              <Link href=\"https://cmux.dev\" className=\"text-md font-medium text-white hover:underline\">\n-                cmux.dev\n+          {/* Right: From creators section */}\n+          <Section\n+            title=\"From the creators of\"\n+            inlineHeader={true}\n+            headerContent={\n+              <Link\n+                href=\"https://cmux.dev\"\n+                className=\"inline-flex items-center hover:opacity-80 transition-opacity\"\n+                style={{ transform: \"translate(-2.5px, -0.5px)\" }}\n+              >\n+                <CmuxLogo\n+                  height=\"2em\"\n+                  wordmarkText=\"cmux.dev\"\n+                  wordmarkFill=\"#fff\"\n+                />\n+              </Link>\n+            }\n+          >\n+            <p className=\"text-sm text-neutral-400 pb-2\">\n+              Want UI screenshots for your code reviews? Check out cmux - an\n+              open-source Claude Code/Codex manager with visual diffs!\n+            </p>\n+            <div className=\"flex items-center gap-3 pt-2\">\n+              <Link\n+                href=\"https://github.com/manaflow-ai/cmux\"\n+                className=\"inline-flex items-center gap-1.5 rounded-md border border-white/10 bg-white/5 px-3 py-1.5 text-xs text-white\"\n+              >\n+                <Star className=\"h-3.5 w-3.5\" />\n+                Star on GitHub\n+              </Link>\n+              <Link\n+                href=\"https://cmux.dev\"\n+                className=\"inline-flex items-center gap-1.5 rounded-md border border-white/10 bg-white/5 px-3 py-1.5 text-xs text-white\"\n+              >\n+                <ExternalLink className=\"h-3.5 w-3.5\" />\n+                Explore cmux\n               </Link>\n             </div>\n-          </div>\n-          <p className=\"text-sm text-neutral-500 mb-2\">\n-            Want UI screenshots for your code reviews? Check out cmux - an open-source Claude Code/Codex manager with visual diffs!\n-          </p>\n-          <div className=\"flex items-center gap-3\">\n-            <Link\n-              href=\"https://github.com/manaflow-ai/cmux\"\n-              className=\"inline-flex items-center gap-1.5 rounded-md border border-white/10 bg-white/5 px-3 py-1.5 text-xs text-white\"\n-            >\n-              <Star className=\"h-3.5 w-3.5\" />\n-              Star on GitHub\n-            </Link>\n-            <Link\n-              href=\"https://cmux.dev\"\n-              className=\"inline-flex items-center gap-1.5 rounded-md border border-white/10 bg-white/5 px-3 py-1.5 text-xs text-white\"\n-            >\n-              <ExternalLink className=\"h-3.5 w-3.5\" />\n-              Explore cmux\n-            </Link>\n-          </div>\n+          </Section>\n         </div>\n       </div>\n \n@@ -834,18 +1169,23 @@ export function PreviewDashboard({\n                 <Trash2 className=\"h-5 w-5\" />\n               </div>\n               <div className=\"flex-1\">\n-                <h3 className=\"text-lg font-semibold text-white\">Delete configuration?</h3>\n-                <p className=\"mt-1 text-sm text-neutral-400\">\n+                <h3 className=\"text-lg font-semibold text-white\">\n+                  Delete configuration?\n+                </h3>\n+                <p className=\"pt-1 text-sm text-neutral-400\">\n                   Are you sure you want to remove{\" \"}\n-                  <span className=\"text-white\">{configPendingDelete.repoFullName}</span>{\" \"}\n-                  from preview.new? This stops screenshot previews for this repository.\n+                  <span className=\"text-white\">\n+                    {configPendingDelete.repoFullName}\n+                  </span>{\" \"}\n+                  from preview.new? This stops screenshot previews for this\n+                  repository.\n                 </p>\n               </div>\n             </div>\n             {configError && (\n-              <p className=\"mt-3 text-sm text-red-400\">{configError}</p>\n+              <p className=\"pt-3 text-sm text-red-400\">{configError}</p>\n             )}\n-            <div className=\"mt-5 flex justify-end gap-3\">\n+            <div className=\"pt-5 flex justify-end gap-3\">\n               <Button\n                 onClick={handleCancelDelete}\n                 disabled={updatingConfigId === configPendingDelete.id}\n@@ -859,7 +1199,7 @@ export function PreviewDashboard({\n                 variant=\"destructive\"\n               >\n                 {updatingConfigId === configPendingDelete.id ? (\n-                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n+                  <Loader2 className=\"pr-2 h-4 w-4 animate-spin\" />\n                 ) : (\n                   \"Delete\"\n                 )}\ndiff --git a/apps/www/hooks/use-oauth-popup.ts b/apps/www/hooks/use-oauth-popup.ts\nnew file mode 100644\nindex 000000000..693b6c799\n--- /dev/null\n+++ b/apps/www/hooks/use-oauth-popup.ts\n@@ -0,0 +1,204 @@\n+\"use client\";\n+\n+import { useCallback, useEffect, useRef, useState } from \"react\";\n+\n+type OAuthProvider = \"github\" | \"gitlab\" | \"bitbucket\" | \"google\";\n+\n+type UseOAuthPopupOptions = {\n+  onSuccess?: () => void;\n+  onError?: (error: Error) => void;\n+};\n+\n+type UseOAuthPopupReturn = {\n+  signInWithPopup: (provider: OAuthProvider) => void;\n+  cancelSignIn: () => void;\n+  signingInProvider: OAuthProvider | null;\n+  isSigningIn: boolean;\n+};\n+\n+const OAUTH_COMPLETE_KEY = \"oauth_popup_complete\";\n+\n+export function useOAuthPopup(\n+  options?: UseOAuthPopupOptions\n+): UseOAuthPopupReturn {\n+  const [signingInProvider, setSigningInProvider] =\n+    useState<OAuthProvider | null>(null);\n+\n+  // Use ref to track popup window across renders\n+  const popupRef = useRef<Window | null>(null);\n+  // Track if we're in the process of completing (to avoid double-handling)\n+  const isCompletingRef = useRef(false);\n+\n+  // Memoize callbacks in refs to avoid stale closures\n+  const onSuccessRef = useRef(options?.onSuccess);\n+  const onErrorRef = useRef(options?.onError);\n+  useEffect(() => {\n+    onSuccessRef.current = options?.onSuccess;\n+    onErrorRef.current = options?.onError;\n+  }, [options?.onSuccess, options?.onError]);\n+\n+  // Cleanup function\n+  const cleanup = useCallback(() => {\n+    popupRef.current = null;\n+    isCompletingRef.current = false;\n+  }, []);\n+\n+  // Handle successful completion (from postMessage or storage event)\n+  const handleComplete = useCallback(() => {\n+    if (isCompletingRef.current) return; // Prevent double-handling\n+    isCompletingRef.current = true;\n+    cleanup();\n+    // Don't clear signingInProvider - let the page reload handle it\n+    if (onSuccessRef.current) {\n+      onSuccessRef.current();\n+    } else {\n+      window.location.reload();\n+    }\n+  }, [cleanup]);\n+\n+  // Cancel sign-in (called by user or when detecting popup close)\n+  const cancelSignIn = useCallback(() => {\n+    // Try to close popup if still open\n+    if (popupRef.current) {\n+      try {\n+        popupRef.current.close();\n+      } catch {\n+        // Ignore errors closing popup\n+      }\n+    }\n+    cleanup();\n+    setSigningInProvider(null);\n+  }, [cleanup]);\n+\n+  // Check if popup was closed (called on focus/visibility events)\n+  const checkPopupClosed = useCallback(() => {\n+    const popup = popupRef.current;\n+    if (!popup || isCompletingRef.current) return;\n+\n+    // Delay check to avoid false positives during cross-origin navigation\n+    setTimeout(() => {\n+      if (!popupRef.current || isCompletingRef.current) return;\n+\n+      try {\n+        if (popupRef.current.closed) {\n+          cancelSignIn();\n+        }\n+      } catch {\n+        // Error accessing popup - could be cross-origin, don't cancel\n+      }\n+    }, 500);\n+  }, [cancelSignIn]);\n+\n+  // Listen for completion signals from the popup\n+  useEffect(() => {\n+    const handleMessage = (event: MessageEvent) => {\n+      if (event.origin !== window.location.origin) return;\n+      if (event.data?.type === OAUTH_COMPLETE_KEY && event.data?.success) {\n+        handleComplete();\n+      }\n+    };\n+\n+    const handleStorage = (event: StorageEvent) => {\n+      if (event.key === OAUTH_COMPLETE_KEY) {\n+        handleComplete();\n+      }\n+    };\n+\n+    window.addEventListener(\"message\", handleMessage);\n+    window.addEventListener(\"storage\", handleStorage);\n+\n+    return () => {\n+      window.removeEventListener(\"message\", handleMessage);\n+      window.removeEventListener(\"storage\", handleStorage);\n+    };\n+  }, [handleComplete]);\n+\n+  // Listen for focus/visibility to detect popup close\n+  useEffect(() => {\n+    if (!signingInProvider) return;\n+\n+    const handleFocus = () => {\n+      checkPopupClosed();\n+    };\n+\n+    const handleVisibility = () => {\n+      if (document.visibilityState === \"visible\") {\n+        checkPopupClosed();\n+      }\n+    };\n+\n+    window.addEventListener(\"focus\", handleFocus);\n+    document.addEventListener(\"visibilitychange\", handleVisibility);\n+\n+    return () => {\n+      window.removeEventListener(\"focus\", handleFocus);\n+      document.removeEventListener(\"visibilitychange\", handleVisibility);\n+    };\n+  }, [signingInProvider, checkPopupClosed]);\n+\n+  // Cleanup on unmount\n+  useEffect(() => {\n+    return cleanup;\n+  }, [cleanup]);\n+\n+  const signInWithPopup = useCallback(\n+    (provider: OAuthProvider) => {\n+      // Cleanup any existing popup\n+      if (popupRef.current) {\n+        try {\n+          popupRef.current.close();\n+        } catch {\n+          // Ignore\n+        }\n+      }\n+      cleanup();\n+\n+      setSigningInProvider(provider);\n+\n+      // Calculate centered position\n+      const width = 600;\n+      const height = 700;\n+      const screenLeft = window.screenLeft ?? window.screenX ?? 0;\n+      const screenTop = window.screenTop ?? window.screenY ?? 0;\n+      const screenWidth = window.outerWidth || window.innerWidth || width;\n+      const screenHeight = window.outerHeight || window.innerHeight || height;\n+      const left = Math.floor(screenLeft + (screenWidth - width) / 2);\n+      const top = Math.floor(screenTop + (screenHeight - height) / 2);\n+\n+      const features = [\n+        `width=${width}`,\n+        `height=${height}`,\n+        `left=${left}`,\n+        `top=${top}`,\n+        \"resizable=yes\",\n+        \"scrollbars=yes\",\n+      ].join(\",\");\n+\n+      // Build the OAuth URL with callback as return destination\n+      // Use relative path - the after-sign-in handler only accepts relative paths for security\n+      const returnTo = encodeURIComponent(\"/sign-in/oauth/callback\");\n+      const oauthUrl = `/sign-in/oauth/${provider}?after_auth_return_to=${returnTo}`;\n+\n+      // Open popup directly to the OAuth URL\n+      const popup = window.open(oauthUrl, `oauth-${provider}`, features);\n+\n+      if (!popup) {\n+        // Popup was blocked - fall back to redirect\n+        console.warn(\"[useOAuthPopup] Popup blocked, falling back to redirect\");\n+        window.location.href = oauthUrl;\n+        return;\n+      }\n+\n+      popupRef.current = popup;\n+      popup.focus();\n+    },\n+    [cleanup]\n+  );\n+\n+  return {\n+    signInWithPopup,\n+    cancelSignIn,\n+    signingInProvider,\n+    isSigningIn: signingInProvider !== null,\n+  };\n+}\n","comments":[{"type":"issue_comment","id":3599424227,"prNumber":1095,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\nCaptured 23 screenshots for commit `e3d5b91` (2025-12-01 23:30:44.602 UTC).\n\n![back-to-cmux-link.png](https://famous-camel-162.convex.cloud/api/storage/0719070e-fb21-47c5-a3be-65598d9d817e)\n\n![choose-repository-section.png](https://famous-camel-162.convex.cloud/api/storage/696ec7a7-e25a-497b-ba7c-39fc3626578b)\n\n![configured-repositories-section.png](https://famous-camel-162.convex.cloud/api/storage/203ee327-8ca6-472d-929d-b1bcdc5c994d)\n\n![continue-button-enabled.png](https://famous-camel-162.convex.cloud/api/storage/9a0c5359-be56-4bd3-9549-ca23340ab55d)\n\n![creators-section.png](https://famous-camel-162.convex.cloud/api/storage/f9319005-c8f9-425f-85a0-bfda8ddc8418)\n\n![delete-button-hover-with-tooltip.png](https://famous-camel-162.convex.cloud/api/storage/9ee0dd79-6f86-4401-b4cc-3bf7876a15e9)\n\n![edit-button-hover-with-tooltip.png](https://famous-camel-162.convex.cloud/api/storage/de2d2e01-e2fe-4584-8e79-fadc4c8d52cc)\n\n![explore-cmux-button.png](https://famous-camel-162.convex.cloud/api/storage/9fd37379-85ce-40f5-bd81-eb767a66f9da)\n\n![feature-card-github-comments.png](https://famous-camel-162.convex.cloud/api/storage/18ad1e5e-922c-498a-8bf3-8f96af97ae15)\n\n![feature-card-isolated-vms.png](https://famous-camel-162.convex.cloud/api/storage/c5e1f45c-76a0-42cc-9e7d-19fe59da611e)\n\n![feature-card-screenshot-agent.png](https://famous-camel-162.convex.cloud/api/storage/dd5acedf-40d8-45c2-a835-4237b90b6d71)\n\n![full-page-preview-landing.png](https://famous-camel-162.convex.cloud/api/storage/22f43c58-2449-438f-a6df-ea043b7fb418)\n\n![github-account-selector.png](https://famous-camel-162.convex.cloud/api/storage/c0d9d1e6-d169-4632-87dc-ab4e7fd138dc)\n\n![header-section.png](https://famous-camel-162.convex.cloud/api/storage/7f83a051-835f-4411-9bb9-d40b8f2ff6a9)\n\n![repository-search-active.png](https://famous-camel-162.convex.cloud/api/storage/7c003e4f-284e-4206-85bb-1379772427d2)\n\n![repository-search-input.png](https://famous-camel-162.convex.cloud/api/storage/32f8adf3-cada-4f69-891f-adc7d7dbe832)\n\n![repository-url-input-filled.png](https://famous-camel-162.convex.cloud/api/storage/be886404-3d4d-4f6a-a13c-de266c20fffe)\n\n![repository-url-input.png](https://famous-camel-162.convex.cloud/api/storage/903fb526-d503-4caf-a221-2bdfe188a097)\n\n![star-on-github-button.png](https://famous-camel-162.convex.cloud/api/storage/6962523d-19a0-451c-a894-e9d23bfbb7fc)\n\n![team-selector.png](https://famous-camel-162.convex.cloud/api/storage/cc9f877d-8aaf-4a7b-9311-91b9b52c9c94)\n\n![top-section-viewport.png](https://famous-camel-162.convex.cloud/api/storage/be081380-ea56-46fe-b460-47e19564716c)\n\n![viewport-preview-landing.png](https://famous-camel-162.convex.cloud/api/storage/f46d491f-f035-46c9-8529-cb34520fd8b0)\n\n![what-is-preview-section.png](https://famous-camel-162.convex.cloud/api/storage/771a3d2e-7538-49ee-acc4-93ac2a0db25a)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"b92984ed2d432b281311b3d84622996402db6945","createdAt":"2025-12-01T23:30:45Z","updatedAt":"2025-12-01T23:41:30Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1095#issuecomment-3599424227"},{"type":"issue_comment","id":3599451763,"prNumber":1095,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\nCaptured 9 screenshots for commit `e3d5b91` (2025-12-01 23:41:26.542 UTC).\n\n![configured-repositories-section.png](https://adorable-wombat-701.convex.cloud/api/storage/9b95b16a-d196-46f5-b797-35f7d7bb8f99)\n\n![from-creators-section.png](https://adorable-wombat-701.convex.cloud/api/storage/2d2ee955-d42b-4b3d-b6ef-101fb3a4adea)\n\n![full-page-preview-dashboard.png](https://adorable-wombat-701.convex.cloud/api/storage/51258cbf-4a9e-4d3e-940b-470c0f982cdc)\n\n![quick-setup-with-input.png](https://adorable-wombat-701.convex.cloud/api/storage/fc1fb947-8683-4004-9031-d0fbc3ab582f)\n\n![repository-search-with-results.png](https://adorable-wombat-701.convex.cloud/api/storage/7b176740-eedd-489e-bcb7-f2bd4b6cc7f6)\n\n![viewport-bottom.png](https://adorable-wombat-701.convex.cloud/api/storage/e4d2d158-6d59-41dd-9cc6-365628ccc461)\n\n![viewport-middle.png](https://adorable-wombat-701.convex.cloud/api/storage/2b2cf403-eeed-4881-9518-ac7552c22a32)\n\n![viewport-top.png](https://adorable-wombat-701.convex.cloud/api/storage/f08766a6-fcc3-43e5-bc58-63f54dbda0dd)\n\n![what-is-preview-section.png](https://adorable-wombat-701.convex.cloud/api/storage/ecd294e9-b662-4202-a7aa-dd14d4a244c9)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"b92984ed2d432b281311b3d84622996402db6945","createdAt":"2025-12-01T23:41:29Z","updatedAt":"2025-12-02T00:22:03Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1095#issuecomment-3599451763"},{"type":"issue_comment","id":3599556836,"prNumber":1095,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\nCaptured 10 screenshots for commit `5c01904` (2025-12-02 00:21:59.839 UTC).\n\n**Bottom section with 'From the creators of cmux' branding and call-to-action links**\n\n![cmux-branding-section.png](https://famous-camel-162.convex.cloud/api/storage/a8597fdc-0181-4941-8090-725934e34fd7)\n\n**Configured repositories section showing active preview configurations with edit and delete buttons**\n\n![configured-repos-view.png](https://famous-camel-162.convex.cloud/api/storage/c9e8a2b2-56d6-42c7-9aa6-d62dfa99012b)\n\n**Features section explaining preview.new capabilities (Computer use agent, GitHub comments, Isolated dev servers)**\n\n![features-section.png](https://famous-camel-162.convex.cloud/api/storage/280574b1-19ec-4429-ba8f-30ea49d36b22)\n\n**Page header showing 'Screenshot previews for GitHub PRs' title**\n\n![header-title.png](https://famous-camel-162.convex.cloud/api/storage/1255f32e-0fff-4de8-b04d-c4ec13051ab0)\n\n**Repository URL input field filled with example GitHub URL showing active state**\n\n![input-with-url.png](https://famous-camel-162.convex.cloud/api/storage/1dd73428-fef0-42d2-934d-a651c239d83f)\n\n**Main content grid showing repository selection and 'What is preview.new?' sections**\n\n![main-content-grid.png](https://famous-camel-162.convex.cloud/api/storage/ee3b2846-54be-4e02-b780-de3da612eed8)\n\n**Full-page screenshot of the new preview landing page showing the complete layout**\n\n![preview-landing-page-full.png](https://famous-camel-162.convex.cloud/api/storage/e0b0e03e-b740-4d40-a375-31b04fc86c11)\n\n**Authenticated view of the preview dashboard with team selector and repository options**\n\n![preview-viewport-authenticated.png](https://famous-camel-162.convex.cloud/api/storage/02bb878b-5741-4bb2-96bb-f5f1c96f08f6)\n\n**Repository selection interface with GitHub account dropdown and search functionality**\n\n![repository-search-interface.png](https://famous-camel-162.convex.cloud/api/storage/26fe36e4-e2aa-4888-9484-d10a7ce170e1)\n\n**Top section with team selector dropdown and repository URL input field**\n\n![team-selector-view.png](https://famous-camel-162.convex.cloud/api/storage/21b26a3e-e985-4480-8830-67884f217b4f)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"b92984ed2d432b281311b3d84622996402db6945","createdAt":"2025-12-02T00:22:02Z","updatedAt":"2025-12-02T01:38:50Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1095#issuecomment-3599556836"},{"type":"issue_comment","id":3599736879,"prNumber":1095,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\nCaptured 15 screenshots for commit `1b7aaac` (2025-12-02 01:38:46.604 UTC).\n\n![after-sign-in-redirect-to-home.png](https://adorable-wombat-701.convex.cloud/api/storage/603248b0-691c-4fd6-bfe7-33830707513c)\n\n![choose-repository-section.png](https://adorable-wombat-701.convex.cloud/api/storage/2361f3bd-36a0-48ff-9933-920db3887259)\n\n![configured-repositories-section.png](https://adorable-wombat-701.convex.cloud/api/storage/1d25a90c-9d48-4995-8ba1-c510ebb98951)\n\n![from-creators-section.png](https://adorable-wombat-701.convex.cloud/api/storage/b15e0f81-2f72-441b-a5ab-5099757ec178)\n\n![header-section.png](https://adorable-wombat-701.convex.cloud/api/storage/11b56c16-0c4d-49d8-b48d-2de2b54f783c)\n\n![oauth-callback-page.png](https://adorable-wombat-701.convex.cloud/api/storage/395a3f07-8500-4b5d-92fb-15a0a4dcc506)\n\n![preview-landing-page-authenticated-full.png](https://adorable-wombat-701.convex.cloud/api/storage/7d8a9ada-8468-457a-a52b-eaf4128a6d18)\n\n![preview-landing-page-authenticated-viewport.png](https://adorable-wombat-701.convex.cloud/api/storage/24629840-e85a-4673-8b21-3c28d5e7b206)\n\n![preview-landing-with-url-filled.png](https://adorable-wombat-701.convex.cloud/api/storage/e01a54ad-4a81-478f-94a7-01d8bdaa233a)\n\n![repository-search-with-input.png](https://adorable-wombat-701.convex.cloud/api/storage/de0cc6d3-68c8-49f1-a4ac-ac679c38fa7e)\n\n![repository-selection-dropdown.png](https://adorable-wombat-701.convex.cloud/api/storage/ffcf4799-fee6-4782-a4f5-69b63d7c4c85)\n\n![team-selection-dropdown.png](https://adorable-wombat-701.convex.cloud/api/storage/3d9c0b93-cacb-47cb-ae08-fcd53a9dc276)\n\n![url-input-section.png](https://adorable-wombat-701.convex.cloud/api/storage/f02ef77e-7dc1-428b-85ff-0bd16001d29e)\n\n![url-input-with-repo-filled.png](https://adorable-wombat-701.convex.cloud/api/storage/1acf3ab5-f81d-45dd-bd4c-27e99b851a02)\n\n![what-is-preview-section.png](https://adorable-wombat-701.convex.cloud/api/storage/bcb33864-9899-4a6f-b3a8-63afdada9ba8)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"b92984ed2d432b281311b3d84622996402db6945","createdAt":"2025-12-02T01:38:49Z","updatedAt":"2025-12-02T02:15:34Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1095#issuecomment-3599736879"},{"type":"issue_comment","id":3599867706,"prNumber":1095,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\nCaptured 10 screenshots for commit `46828aa` (2025-12-02 02:15:32.641 UTC).\n\n**Bottom section showing configured repositories list and 'From the creators of' section with cmux branding and links**\n\n![configured-repos-and-creators-section-preview-new-landing-ui.png](https://adorable-wombat-701.convex.cloud/api/storage/719bedbc-9e61-4759-b519-88a8566b5502)\n\n**Configured repositories section displaying repository with status badge, team name, and action buttons (edit and delete)**\n\n![configured-repositories-list-preview-new-landing-ui.png](https://adorable-wombat-701.convex.cloud/api/storage/b56bc31c-5c81-46cd-af95-fb8308e32cd8)\n\n**Delete configuration confirmation modal with dark overlay, showing warning dialog for removing a repository from preview.new**\n\n![delete-confirmation-modal-preview-new-landing-ui.png](https://adorable-wombat-701.convex.cloud/api/storage/eb2216d9-63a5-4a06-885d-8b9b3f2713f9)\n\n**What is preview.new? section with three feature cards: Computer use agent, GitHub comments, and Isolated dev servers with grain texture overlay**\n\n![feature-cards-what-is-preview-new-preview-new-landing-ui.png](https://adorable-wombat-701.convex.cloud/api/storage/525e5e41-e9ff-451e-b2ed-342a633829c5)\n\n**GitHub App installation success page with instructions and Go Back button**\n\n![github-install-complete-preview-new-landing-ui.png](https://adorable-wombat-701.convex.cloud/api/storage/c1fef285-59b5-471c-890e-2e92fb867dac)\n\n**Quick setup input section showing the Git repository URL input with Continue button and team selector dropdown**\n\n![header-and-quick-setup-input-preview-new-landing-ui.png](https://adorable-wombat-701.convex.cloud/api/storage/c503e21b-714f-42ec-9ecd-6b2cfeab3f65)\n\n**Hero section with new heading 'Screenshot previews for GitHub PRs', Back to cmux link, and Git repository URL input field**\n\n![preview-landing-page-hero-section-preview-new-landing-ui.png](https://adorable-wombat-701.convex.cloud/api/storage/30c34d6f-d3fd-4b23-b11b-4840004b05a3)\n\n**Full-page view of the redesigned preview landing page in authenticated state, showing the new dark theme with radial gradient background**\n\n![preview-page-authenticated-preview-new-landing-ui.png](https://adorable-wombat-701.convex.cloud/api/storage/faaa8e34-bc6a-4c55-b4d4-aecf42321701)\n\n**Repository search box with active search query showing the new search functionality**\n\n![repository-search-with-query-preview-new-landing-ui.png](https://adorable-wombat-701.convex.cloud/api/storage/5a36d3ba-5d1e-4706-a940-8ed6a4e12d69)\n\n**Repository selection UI with GitHub account dropdown, team selector, and repository search interface**\n\n![repository-selection-with-github-dropdown-preview-new-landing-ui.png](https://adorable-wombat-701.convex.cloud/api/storage/4f48ccd6-593a-4d9a-b72e-eca9c77cf31b)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"b92984ed2d432b281311b3d84622996402db6945","createdAt":"2025-12-02T02:15:33Z","updatedAt":"2025-12-02T02:25:22Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1095#issuecomment-3599867706"},{"type":"issue_comment","id":3599888362,"prNumber":1095,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\nCaptured 9 screenshots for commit `f09041e` (2025-12-02 02:25:19.181 UTC).\n\n**Full-page screenshot of the new preview landing page showing the complete layout with header, repository input, team selector, and feature cards**\n\n![01-preview-landing-page-full.png](https://adorable-wombat-701.convex.cloud/api/storage/4e0cf023-5c56-4092-b858-35a13b7f6e29)\n\n**Viewport screenshot of the preview landing page showing the above-the-fold content with the main heading and repository setup section**\n\n![02-preview-landing-viewport.png](https://adorable-wombat-701.convex.cloud/api/storage/1fc110b5-225f-41db-aa62-fb50671a3157)\n\n**Scrolled view showing the repository selection section with 'No connected repositories' state and 'Add repositories' button**\n\n![03-repository-section-viewport.png](https://adorable-wombat-701.convex.cloud/api/storage/fda3a429-cb9e-4606-a981-1b376cea4db0)\n\n**Close-up of the header section showing 'Screenshot previews for GitHub PRs' title and description with the repository URL input field**\n\n![04-header-section.png](https://adorable-wombat-701.convex.cloud/api/storage/2fa040dd-e1fe-4b98-bb01-8ebe9b0e9a66)\n\n**Interactive state showing the repository URL input field filled with 'https://github.com/example/repo' and the Continue button enabled**\n\n![05-url-input-filled.png](https://adorable-wombat-701.convex.cloud/api/storage/b01f5b12-fb33-4e77-bf3d-62305b15c367)\n\n**View of the configured repositories section showing an active repository 'austinywang/landing' with edit and delete buttons**\n\n![06-configured-repos-section.png](https://adorable-wombat-701.convex.cloud/api/storage/3ee58d06-84ae-416b-8952-d60cc4418d19)\n\n**Full-page screenshot at 1440px width showing the complete responsive layout including all sections: header, repository input, team selector, feature cards, and configured repositories**\n\n![07-preview-landing-full-1440px.png](https://adorable-wombat-701.convex.cloud/api/storage/3972cb2e-ad5f-4151-b510-668d7607bc00)\n\n**Viewport screenshot at 1440px width showing the above-the-fold content optimized for desktop viewing**\n\n![08-preview-landing-viewport-1440px.png](https://adorable-wombat-701.convex.cloud/api/storage/aeed8601-79f6-4544-9ab2-3d22cba4f4dc)\n\n**Full-page mobile screenshot at 375px width demonstrating the responsive mobile layout with stacked sections and mobile-optimized spacing**\n\n![09-preview-landing-mobile-375px.png](https://adorable-wombat-701.convex.cloud/api/storage/1118e9e4-7bda-4745-87f6-0e8309d5c1ef)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"b92984ed2d432b281311b3d84622996402db6945","createdAt":"2025-12-02T02:25:21Z","updatedAt":"2025-12-02T03:20:39Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1095#issuecomment-3599888362"},{"type":"issue_comment","id":3599998005,"prNumber":1095,"botLogin":"cmux-agent[bot]","body":"## Preview Screenshots\n\n\n\nCaptured 10 screenshots for commit `9bdf705` (2025-12-02 03:20:37.284 UTC).\n\n**GitHub account selector dropdown showing available accounts and 'Add account' option**\n\n![preview-account-selector-dropdown.png](https://adorable-wombat-701.convex.cloud/api/storage/cdda638d-b458-4991-aa60-1f1671f78105)\n\n**Configured repositories section displaying existing preview configurations with active status**\n\n![preview-configured-repos.png](https://adorable-wombat-701.convex.cloud/api/storage/c3494f09-ab97-4342-8819-9f95bbd98792)\n\n**Features section showing 'What is preview.new?' with computer use agent, GitHub comments, and isolated dev servers cards**\n\n![preview-features-section.png](https://adorable-wombat-701.convex.cloud/api/storage/1494a9da-c565-4d29-8dda-02099ebb982c)\n\n**Bottom section with configured repositories list and 'From the creators of cmux.dev' promotional area**\n\n![preview-footer-section.png](https://adorable-wombat-701.convex.cloud/api/storage/d1cbcdce-9042-4b2f-9c05-363582ecfa83)\n\n**Header area with back link and main heading**\n\n![preview-header-section.png](https://adorable-wombat-701.convex.cloud/api/storage/653c59bd-2b15-467c-8d34-bb46df06a779)\n\n**Hero section showing 'Screenshot previews for GitHub PRs' heading and repository URL input**\n\n![preview-hero-and-input.png](https://adorable-wombat-701.convex.cloud/api/storage/041e43a4-bb1f-4f59-b539-7227185f9f5c)\n\n**Full page screenshot of the new preview landing page showing the complete UI layout**\n\n![preview-landing-page-full.png](https://adorable-wombat-701.convex.cloud/api/storage/d8c39381-914e-456d-96d7-fb2e04637343)\n\n**Repository selection section showing team selector dropdown and GitHub account chooser**\n\n![preview-repository-section-with-team.png](https://adorable-wombat-701.convex.cloud/api/storage/503d4fa7-fa4f-42e3-a086-4b7847da1cd0)\n\n**Repository selection interface with GitHub account dropdown and search functionality**\n\n![preview-repository-selector.png](https://adorable-wombat-701.convex.cloud/api/storage/8c2b466c-0774-4875-9138-9f0d7926c87d)\n\n**Top section with hero heading, description, and Git repository URL input field**\n\n![preview-top-section.png](https://adorable-wombat-701.convex.cloud/api/storage/80afa423-5cdd-43e0-a905-23c39aea8669)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"b92984ed2d432b281311b3d84622996402db6945","createdAt":"2025-12-02T03:20:38Z","updatedAt":"2025-12-02T03:20:38Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1095#issuecomment-3599998005"}]}
{"number":1094,"title":"use installation id instead of teamId for previewConfig","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1094","headRef":"fix-github-webhook-teamid-issues","headSha":"c17897d0a3b7df266c4920d2d2d809393da3ddca","baseRef":"main","baseSha":"c04ceb78dd72bf502782d7daa692b7fb9ec7a642","createdAt":"2025-12-01T04:29:57Z","updatedAt":"2025-12-01T04:39:36Z","diff":"diff --git a/apps/www/lib/routes/preview.route.ts b/apps/www/lib/routes/preview.route.ts\nindex 03e8574c2..a6ad48eae 100644\n--- a/apps/www/lib/routes/preview.route.ts\n+++ b/apps/www/lib/routes/preview.route.ts\n@@ -14,7 +14,7 @@ const PreviewConfigSchema = z\n     id: z.string(),\n     repoFullName: z.string(),\n     environmentId: z.string().optional().nullable(),\n-    repoInstallationId: z.number().optional().nullable(),\n+    repoInstallationId: z.number(),\n     repoDefaultBranch: z.string().optional().nullable(),\n     status: z.enum([\"active\", \"paused\", \"disabled\"]),\n     lastRunAt: z.number().optional().nullable(),\n@@ -35,7 +35,7 @@ const PreviewConfigMutationBody = z\n     teamSlugOrId: z.string(),\n     repoFullName: z.string(),\n     environmentId: z.string().optional(),\n-    repoInstallationId: z.number().optional(),\n+    repoInstallationId: z.number(),\n     repoDefaultBranch: z.string().optional(),\n     status: z.enum([\"active\", \"paused\", \"disabled\"]).optional(),\n   })\n@@ -71,7 +71,7 @@ function formatPreviewConfig(config: PreviewConfigDoc) {\n     id: config._id,\n     repoFullName: config.repoFullName,\n     environmentId: config.environmentId ?? null,\n-    repoInstallationId: config.repoInstallationId ?? null,\n+    repoInstallationId: config.repoInstallationId,\n     repoDefaultBranch: config.repoDefaultBranch ?? null,\n     status: config.status ?? \"active\",\n     lastRunAt: config.lastRunAt ?? null,\ndiff --git a/packages/convex/convex/github_webhook.ts b/packages/convex/convex/github_webhook.ts\nindex 2540a014f..d53d77f1e 100644\n--- a/packages/convex/convex/github_webhook.ts\n+++ b/packages/convex/convex/github_webhook.ts\n@@ -533,8 +533,8 @@ export const githubWebhook = httpAction(async (_ctx, req) => {\n             )\n           ) {\n             const previewConfig = await _ctx.runQuery(\n-              internal.previewConfigs.getByTeamAndRepo,\n-              { teamId, repoFullName },\n+              internal.previewConfigs.getByInstallationAndRepo,\n+              { installationId: installation, repoFullName },\n             );\n \n             if (previewConfig) {\n@@ -666,7 +666,7 @@ export const githubWebhook = httpAction(async (_ctx, req) => {\n             } else {\n               console.log(\"[preview-jobs] No preview config found for repo\", {\n                 repoFullName,\n-                teamId,\n+                installationId: installation,\n               });\n             }\n           }\ndiff --git a/packages/convex/convex/previewConfigs.ts b/packages/convex/convex/previewConfigs.ts\nindex 6b956de9a..b684970de 100644\n--- a/packages/convex/convex/previewConfigs.ts\n+++ b/packages/convex/convex/previewConfigs.ts\n@@ -80,7 +80,7 @@ export const upsert = authMutation({\n     teamSlugOrId: v.string(),\n     repoFullName: v.string(),\n     environmentId: v.optional(v.id(\"environments\")),\n-    repoInstallationId: v.optional(v.number()),\n+    repoInstallationId: v.number(),\n     repoDefaultBranch: v.optional(v.string()),\n     status: v.optional(\n       v.union(\n@@ -117,7 +117,7 @@ export const upsert = authMutation({\n     if (existing) {\n       await ctx.db.patch(existing._id, {\n         environmentId: args.environmentId ?? existing.environmentId,\n-        repoInstallationId: args.repoInstallationId ?? existing.repoInstallationId,\n+        repoInstallationId: args.repoInstallationId,\n         repoDefaultBranch: args.repoDefaultBranch ?? existing.repoDefaultBranch,\n         status: args.status ?? existing.status ?? \"active\",\n         updatedAt: now,\n@@ -158,3 +158,20 @@ export const getByTeamAndRepo = internalQuery({\n     return config ?? null;\n   },\n });\n+\n+export const getByInstallationAndRepo = internalQuery({\n+  args: {\n+    installationId: v.number(),\n+    repoFullName: v.string(),\n+  },\n+  handler: async (ctx, args) => {\n+    const repoFullName = normalizeRepoFullName(args.repoFullName);\n+    const config = await ctx.db\n+      .query(\"previewConfigs\")\n+      .withIndex(\"by_installation_repo\", (q) =>\n+        q.eq(\"repoInstallationId\", args.installationId).eq(\"repoFullName\", repoFullName),\n+      )\n+      .first();\n+    return config ?? null;\n+  },\n+});\ndiff --git a/packages/convex/convex/preview_jobs_worker.ts b/packages/convex/convex/preview_jobs_worker.ts\nindex 74bf57d0c..75866bd4d 100644\n--- a/packages/convex/convex/preview_jobs_worker.ts\n+++ b/packages/convex/convex/preview_jobs_worker.ts\n@@ -1027,9 +1027,11 @@ export async function runPreviewJob(\n       status: \"running\",\n     });\n \n+    // Use -f (force) to discard any local modifications that would conflict\n+    // This is safe because we already stashed changes above\n     const checkoutCmd = run.headRef\n-      ? [\"git\", \"-C\", repoDir, \"checkout\", \"-B\", run.headRef, run.headSha]\n-      : [\"git\", \"-C\", repoDir, \"checkout\", run.headSha];\n+      ? [\"git\", \"-C\", repoDir, \"checkout\", \"-f\", \"-B\", run.headRef, run.headSha]\n+      : [\"git\", \"-C\", repoDir, \"checkout\", \"-f\", run.headSha];\n \n     const checkoutResponse = await execInstanceInstanceIdExecPost({\n       client: morphClient,\ndiff --git a/packages/convex/convex/schema.ts b/packages/convex/convex/schema.ts\nindex c4c5259a1..6f6e7da3b 100644\n--- a/packages/convex/convex/schema.ts\n+++ b/packages/convex/convex/schema.ts\n@@ -551,7 +551,7 @@ const convexSchema = defineSchema({\n     createdByUserId: v.string(),\n     repoFullName: v.string(),\n     repoProvider: v.optional(v.literal(\"github\")),\n-    repoInstallationId: v.optional(v.number()),\n+    repoInstallationId: v.number(),\n     repoDefaultBranch: v.optional(v.string()),\n     environmentId: v.optional(v.id(\"environments\")),\n     status: v.optional(\n@@ -568,7 +568,8 @@ const convexSchema = defineSchema({\n     .index(\"by_team_repo\", [\"teamId\", \"repoFullName\"])\n     .index(\"by_team\", [\"teamId\", \"updatedAt\"])\n     .index(\"by_team_status\", [\"teamId\", \"status\", \"updatedAt\"])\n-    .index(\"by_environment\", [\"environmentId\"]),\n+    .index(\"by_environment\", [\"environmentId\"])\n+    .index(\"by_installation_repo\", [\"repoInstallationId\", \"repoFullName\"]),\n   previewRuns: defineTable({\n     previewConfigId: v.id(\"previewConfigs\"),\n     teamId: v.string(),\ndiff --git a/packages/www-openapi-client/src/client/types.gen.ts b/packages/www-openapi-client/src/client/types.gen.ts\nindex cde256d57..57e6e9e4c 100644\n--- a/packages/www-openapi-client/src/client/types.gen.ts\n+++ b/packages/www-openapi-client/src/client/types.gen.ts\n@@ -649,7 +649,7 @@ export type PreviewConfig = {\n     id: string;\n     repoFullName: string;\n     environmentId?: string | null;\n-    repoInstallationId?: number | null;\n+    repoInstallationId: number;\n     repoDefaultBranch?: string | null;\n     status: 'active' | 'paused' | 'disabled';\n     lastRunAt?: number | null;\n@@ -666,7 +666,7 @@ export type PreviewConfigMutationBody = {\n     teamSlugOrId: string;\n     repoFullName: string;\n     environmentId?: string;\n-    repoInstallationId?: number;\n+    repoInstallationId: number;\n     repoDefaultBranch?: string;\n     status?: 'active' | 'paused' | 'disabled';\n };\n","comments":[{"type":"issue_comment","id":3594500451,"prNumber":1094,"botLogin":"cmux-agent-internal-dev[bot]","body":"[Open Workspace](https://cmux.sh/austin-dev/task/kn755203sc46pd7bzv4a7e4hsn7wfeqf) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1094)\n\n## Preview Screenshots\n\nSuccessfully captured 4 screenshot(s) for commit `c17897d`:\n\n### delete-confirmation-modal-closeup-fix-github-webhook-teamid-issues.png\n![delete-confirmation-modal-closeup-fix-github-webhook-teamid-issues.png](https://famous-camel-162.convex.cloud/api/storage/330e5ff0-953e-4f5a-bbbe-1e278d3c036d)\n\n### preview-dashboard-delete-modal-fix-github-webhook-teamid-issues.png\n![preview-dashboard-delete-modal-fix-github-webhook-teamid-issues.png](https://famous-camel-162.convex.cloud/api/storage/91341b7f-2f2b-40f5-b374-badb9b477b0c)\n\n### preview-dashboard-delete-modal-second-repo-fix-github-webhook-teamid-issues.png\n![preview-dashboard-delete-modal-second-repo-fix-github-webhook-teamid-issues.png](https://famous-camel-162.convex.cloud/api/storage/55b49df3-b2fd-40a7-b167-836cfcec5ac8)\n\n### preview-dashboard-initial-fix-github-webhook-teamid-issues.png\n![preview-dashboard-initial-fix-github-webhook-teamid-issues.png](https://famous-camel-162.convex.cloud/api/storage/eb296d20-9154-4b96-8aef-821df9110ad1)\n\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"c17897d0a3b7df266c4920d2d2d809393da3ddca","createdAt":"2025-12-01T04:37:44Z","updatedAt":"2025-12-01T04:37:44Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1094#issuecomment-3594500451"}]}
{"number":1091,"title":"Add delete confirmation on preview page","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1091","headRef":"cmux/add-delete-confirmation-on-preview-page-oliho","headSha":"98248d99ba555e11bb56ec4c25d174e021a2a499","baseRef":"main","baseSha":"e5b8b126db94eccb2bff02217e41291a42012d1f","createdAt":"2025-11-30T23:44:44Z","updatedAt":"2025-12-01T00:12:03Z","diff":"diff --git a/apps/www/components/preview/preview-dashboard.tsx b/apps/www/components/preview/preview-dashboard.tsx\nindex e98fa40e3..6b711ab33 100644\n--- a/apps/www/components/preview/preview-dashboard.tsx\n+++ b/apps/www/components/preview/preview-dashboard.tsx\n@@ -93,6 +93,7 @@ export function PreviewDashboard({\n   const [configs, setConfigs] = useState<PreviewConfigListItem[]>(previewConfigs);\n   const [updatingConfigId, setUpdatingConfigId] = useState<string | null>(null);\n   const [openingConfigId, setOpeningConfigId] = useState<string | null>(null);\n+  const [configPendingDelete, setConfigPendingDelete] = useState<PreviewConfigListItem | null>(null);\n \n   // Public URL input state\n   const [repoUrlInput, setRepoUrlInput] = useState(\"\");\n@@ -153,31 +154,39 @@ export function PreviewDashboard({\n     window.location.href = `/preview/configure?${params.toString()}`;\n   }, []);\n \n-  const handleDeleteConfig = useCallback(\n-    async (config: PreviewConfigListItem) => {\n-      setUpdatingConfigId(config.id);\n-      setConfigError(null);\n-      try {\n-        const params = new URLSearchParams({ teamSlugOrId: config.teamSlugOrId });\n-        const response = await fetch(`/api/preview/configs/${config.id}?${params.toString()}`, {\n-          method: \"DELETE\",\n-          headers: { \"Content-Type\": \"application/json\" },\n-        });\n-        if (!response.ok) {\n-          throw new Error(await response.text());\n-        }\n-        setConfigs((previous) => previous.filter((item) => item.id !== config.id));\n-      } catch (error) {\n-        const message =\n-          error instanceof Error ? error.message : \"Failed to delete preview configuration\";\n-        console.error(\"[PreviewDashboard] Failed to delete preview configuration\", error);\n-        setConfigError(message);\n-      } finally {\n-        setUpdatingConfigId(null);\n+  const handleRequestDelete = useCallback((config: PreviewConfigListItem) => {\n+    setConfigError(null);\n+    setConfigPendingDelete(config);\n+  }, []);\n+\n+  const handleDeleteConfig = useCallback(async () => {\n+    if (!configPendingDelete) return;\n+    setUpdatingConfigId(configPendingDelete.id);\n+    setConfigError(null);\n+    try {\n+      const params = new URLSearchParams({ teamSlugOrId: configPendingDelete.teamSlugOrId });\n+      const response = await fetch(`/api/preview/configs/${configPendingDelete.id}?${params.toString()}`, {\n+        method: \"DELETE\",\n+        headers: { \"Content-Type\": \"application/json\" },\n+      });\n+      if (!response.ok) {\n+        throw new Error(await response.text());\n       }\n-    },\n-    []\n-  );\n+      setConfigs((previous) => previous.filter((item) => item.id !== configPendingDelete.id));\n+      setConfigPendingDelete(null);\n+    } catch (error) {\n+      const message =\n+        error instanceof Error ? error.message : \"Failed to delete preview configuration\";\n+      console.error(\"[PreviewDashboard] Failed to delete preview configuration\", error);\n+      setConfigError(message);\n+    } finally {\n+      setUpdatingConfigId(null);\n+    }\n+  }, [configPendingDelete]);\n+\n+  const handleCancelDelete = useCallback(() => {\n+    setConfigPendingDelete(null);\n+  }, []);\n \n   const handleTeamChange = useCallback(\n     (nextTeam: string) => {\n@@ -752,7 +761,7 @@ export function PreviewDashboard({\n                         <TooltipTrigger asChild>\n                           <button\n                             type=\"button\"\n-                            onClick={() => void handleDeleteConfig(config)}\n+                            onClick={() => handleRequestDelete(config)}\n                             disabled={updatingConfigId === config.id}\n                             className=\"p-1.5 text-red-400 disabled:opacity-50\"\n                           >\n@@ -807,6 +816,58 @@ export function PreviewDashboard({\n           </div>\n         </div>\n       </div>\n+\n+      {configPendingDelete && (\n+        <div\n+          className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm px-4 py-6\"\n+          onClick={() => {\n+            if (updatingConfigId === configPendingDelete.id) return;\n+            handleCancelDelete();\n+          }}\n+        >\n+          <div\n+            className=\"w-full max-w-md rounded-lg border border-white/10 bg-neutral-900 px-6 py-5 shadow-2xl\"\n+            onClick={(event) => event.stopPropagation()}\n+          >\n+            <div className=\"flex items-start gap-3\">\n+              <div className=\"rounded-full bg-red-500/10 p-2 text-red-400\">\n+                <Trash2 className=\"h-5 w-5\" />\n+              </div>\n+              <div className=\"flex-1\">\n+                <h3 className=\"text-lg font-semibold text-white\">Delete configuration?</h3>\n+                <p className=\"mt-1 text-sm text-neutral-400\">\n+                  Are you sure you want to remove{\" \"}\n+                  <span className=\"text-white\">{configPendingDelete.repoFullName}</span>{\" \"}\n+                  from preview.new? This stops screenshot previews for this repository.\n+                </p>\n+              </div>\n+            </div>\n+            {configError && (\n+              <p className=\"mt-3 text-sm text-red-400\">{configError}</p>\n+            )}\n+            <div className=\"mt-5 flex justify-end gap-3\">\n+              <Button\n+                onClick={handleCancelDelete}\n+                disabled={updatingConfigId === configPendingDelete.id}\n+                variant=\"secondary\"\n+              >\n+                Cancel\n+              </Button>\n+              <Button\n+                onClick={() => void handleDeleteConfig()}\n+                disabled={updatingConfigId === configPendingDelete.id}\n+                variant=\"destructive\"\n+              >\n+                {updatingConfigId === configPendingDelete.id ? (\n+                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n+                ) : (\n+                  \"Delete\"\n+                )}\n+              </Button>\n+            </div>\n+          </div>\n+        </div>\n+      )}\n     </div>\n   );\n }\n","comments":[{"type":"issue_comment","id":3593900468,"prNumber":1091,"botLogin":"cmux-agent[bot]","body":"[Open Workspace](https://cmux.sh/manaflow/task/kn783v0q6mpa7mrezegdjdse7s7wd00k) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1091)\n\n## Preview Screenshots\n\nSuccessfully captured 4 screenshot(s) for commit `b265461`:\n\n### configured-repositories-section.png\n![configured-repositories-section.png](https://adorable-wombat-701.convex.cloud/api/storage/f86ae995-ffe5-4be8-8c78-8eec41441d6f)\n\n### delete-dialog-viewport.png\n![delete-dialog-viewport.png](https://adorable-wombat-701.convex.cloud/api/storage/5b40d200-9332-448c-8f83-02d8de00c0dd)\n\n### preview-dashboard-delete-confirmation-dialog.png\n![preview-dashboard-delete-confirmation-dialog.png](https://adorable-wombat-701.convex.cloud/api/storage/00c68c4b-0c91-4a45-b48e-2219da1f98ac)\n\n### preview-dashboard-initial-state.png\n![preview-dashboard-initial-state.png](https://adorable-wombat-701.convex.cloud/api/storage/5c301cf4-5bd1-453b-9d79-522de9bef029)\n\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"98248d99ba555e11bb56ec4c25d174e021a2a499","createdAt":"2025-11-30T23:48:42Z","updatedAt":"2025-11-30T23:48:42Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1091#issuecomment-3593900468"},{"type":"issue_comment","id":3593925065,"prNumber":1091,"botLogin":"cmux-agent-internal-dev[bot]","body":"[Open Workspace](https://cmux.sh/austin-dev/task/kn7fv0bejdbbmdffb3knepne0n7wcnms) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1091)\n\n## Preview Screenshots\n\nSuccessfully captured 9 screenshot(s) for commit `98248d9`:\n\n### configured-repo-item.png\n![configured-repo-item.png](https://famous-camel-162.convex.cloud/api/storage/3f16a88a-fac4-4dcd-b4e6-efb377b7948a)\n\n### configured-repo-with-delete-button-hover.png\n![configured-repo-with-delete-button-hover.png](https://famous-camel-162.convex.cloud/api/storage/abdb08dd-1e7b-44dd-bd6f-987d3edf8957)\n\n### delete-confirmation-cancel-button.png\n![delete-confirmation-cancel-button.png](https://famous-camel-162.convex.cloud/api/storage/158249e3-0744-455a-9df6-3eb09d74d861)\n\n### delete-confirmation-delete-button.png\n![delete-confirmation-delete-button.png](https://famous-camel-162.convex.cloud/api/storage/7f423d74-914e-410e-a102-a8e160b044f0)\n\n### delete-confirmation-modal-full-page.png\n![delete-confirmation-modal-full-page.png](https://famous-camel-162.convex.cloud/api/storage/19d9a4c4-440e-4c13-b1ef-7056c7aba999)\n\n### delete-confirmation-modal-heading.png\n![delete-confirmation-modal-heading.png](https://famous-camel-162.convex.cloud/api/storage/fe674030-f83c-4699-a7ea-0c1ba41b1bdf)\n\n### delete-confirmation-modal-viewport.png\n![delete-confirmation-modal-viewport.png](https://famous-camel-162.convex.cloud/api/storage/861572ec-fb0d-45d0-91a0-7460a1c06900)\n\n### preview-dashboard-full-page.png\n![preview-dashboard-full-page.png](https://famous-camel-162.convex.cloud/api/storage/188e65bb-9786-435a-9807-f8f6a6e0ffe5)\n\n### preview-dashboard-viewport.png\n![preview-dashboard-viewport.png](https://famous-camel-162.convex.cloud/api/storage/111344f6-24a5-4fe2-9855-014c4241b2ce)\n\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"98248d99ba555e11bb56ec4c25d174e021a2a499","createdAt":"2025-11-30T23:57:45Z","updatedAt":"2025-11-30T23:57:45Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1091#issuecomment-3593925065"},{"type":"issue_comment","id":3593971198,"prNumber":1091,"botLogin":"cmux-agent[bot]","body":"[Open Workspace](https://cmux.sh/manaflow/task/kn70pkzfh0w2hsr4waxnpee1y97wc05f) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1091)\n\n## Preview Screenshots\n\nSuccessfully captured 5 screenshot(s) for commit `98248d9`:\n\n### configured-repositories-with-delete-buttons.png\n![configured-repositories-with-delete-buttons.png](https://adorable-wombat-701.convex.cloud/api/storage/870e4611-b378-41f2-846c-51b4522851f6)\n\n### delete-confirmation-modal-focused.png\n![delete-confirmation-modal-focused.png](https://adorable-wombat-701.convex.cloud/api/storage/c01b5c46-74c7-4b98-ae04-4c0d8a9b1de6)\n\n### preview-dashboard-delete-confirmation-modal-full-page.png\n![preview-dashboard-delete-confirmation-modal-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/6c462d56-e93e-4753-aff2-921bf70e2aa7)\n\n### preview-dashboard-delete-confirmation-modal-viewport.png\n![preview-dashboard-delete-confirmation-modal-viewport.png](https://adorable-wombat-701.convex.cloud/api/storage/b1cbc2b0-a795-4388-8025-4d5275cb4a84)\n\n### preview-dashboard-full-page.png\n![preview-dashboard-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/f75165b8-37bd-4b8e-9150-3d7b63d418fb)\n\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"98248d99ba555e11bb56ec4c25d174e021a2a499","createdAt":"2025-12-01T00:12:02Z","updatedAt":"2025-12-01T00:12:02Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1091#issuecomment-3593971198"}]}
{"number":1090,"title":"Clarify auto PR wording for crown winner","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1090","headRef":"cmux/clarify-auto-pr-wording-for-crown-winner-byi4r","headSha":"5f9ab63d588317006ddf3da742e5f80e7528322d","baseRef":"main","baseSha":"e5b8b126db94eccb2bff02217e41291a42012d1f","createdAt":"2025-11-30T23:38:08Z","updatedAt":"2025-12-03T04:40:55Z","diff":"diff --git a/apps/client/src/routes/_layout.$teamSlugOrId.settings.tsx b/apps/client/src/routes/_layout.$teamSlugOrId.settings.tsx\nindex f18a1f590..340b31fd6 100644\n--- a/apps/client/src/routes/_layout.$teamSlugOrId.settings.tsx\n+++ b/apps/client/src/routes/_layout.$teamSlugOrId.settings.tsx\n@@ -625,15 +625,15 @@ function SettingsComponent() {\n                 <div className=\"flex items-start justify-between gap-4\">\n                   <div>\n                     <label className=\"block text-sm font-medium text-neutral-900 dark:text-neutral-100\">\n-                      Auto pull request for crown winner\n+                      Auto-create pull request with the best diff\n                     </label>\n                     <p className=\"mt-1 text-xs text-neutral-500 dark:text-neutral-400\">\n-                      When enabled, cmux automatically creates a pull request\n-                      for the winning model’s code diff.\n+                      After all agents finish, automatically create a pull request with the\n+                      winning agent's solution.\n                     </p>\n                   </div>\n                   <Switch\n-                    aria-label=\"Auto pull request for crown winner\"\n+                    aria-label=\"Auto-create pull request with the best diff\"\n                     size=\"sm\"\n                     color=\"primary\"\n                     isSelected={autoPrEnabled}\n","comments":[{"type":"issue_comment","id":3593999663,"prNumber":1090,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n[Open Workspace](https://cmux.sh/austin-dev/task/kn7bx6n9h3g2bppghxznay3a217wf3nk) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1090)\n\n## Preview Screenshots\n\nSuccessfully captured 3 screenshot(s) for commit `5f9ab63`:\n\n### crown-evaluator-section-closeup-cmux-clarify-auto-pr-wording-for-crown-winner-byi4r.png\n![crown-evaluator-section-closeup-cmux-clarify-auto-pr-wording-for-crown-winner-byi4r.png](https://famous-camel-162.convex.cloud/api/storage/b67311ba-c079-4020-b7ae-387daa903400)\n\n### settings-crown-evaluator-section-cmux-clarify-auto-pr-wording-for-crown-winner-byi4r.png\n![settings-crown-evaluator-section-cmux-clarify-auto-pr-wording-for-crown-winner-byi4r.png](https://famous-camel-162.convex.cloud/api/storage/63011182-0c2f-418f-8b00-643d7c3a5d84)\n\n### settings-page-full-cmux-clarify-auto-pr-wording-for-crown-winner-byi4r.png\n![settings-page-full-cmux-clarify-auto-pr-wording-for-crown-winner-byi4r.png](https://famous-camel-162.convex.cloud/api/storage/458f124e-adf4-4e0f-a83d-2e0c32461d91)\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"5f9ab63d588317006ddf3da742e5f80e7528322d","createdAt":"2025-12-01T00:20:03Z","updatedAt":"2025-12-01T01:12:02Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1090#issuecomment-3593999663"},{"type":"issue_comment","id":3594126191,"prNumber":1090,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\nCaptured 2 screenshots for commit `6137114` (2025-12-01 01:11:58.226 UTC).\n\n![homepage-full-page.png](https://polite-canary-804.convex.cloud/api/storage/1c87d001-bd0f-4b5d-92ed-ddcd962fc673)\n\n![homepage-viewport.png](https://polite-canary-804.convex.cloud/api/storage/623f68e7-fd91-4912-ad69-f0464a23ef9f)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"5f9ab63d588317006ddf3da742e5f80e7528322d","createdAt":"2025-12-01T01:12:00Z","updatedAt":"2025-12-01T01:29:35Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1090#issuecomment-3594126191"},{"type":"issue_comment","id":3594159231,"prNumber":1090,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\nCaptured 2 screenshots for commit `6137114` (2025-12-01 01:29:32.287 UTC).\n\n![homepage-full-page.png](https://polite-canary-804.convex.cloud/api/storage/f62b78a5-4fd0-41c2-97e0-d4f51f8da980)\n\n![homepage-viewport.png](https://polite-canary-804.convex.cloud/api/storage/f2f2483f-4c07-46f2-9865-b91abc7114d3)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"5f9ab63d588317006ddf3da742e5f80e7528322d","createdAt":"2025-12-01T01:29:34Z","updatedAt":"2025-12-01T01:47:25Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1090#issuecomment-3594159231"},{"type":"issue_comment","id":3594189488,"prNumber":1090,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\nCaptured 2 screenshots for commit `6137114` (2025-12-01 01:47:21.983 UTC).\n\n**Screenshot homepage-full-page.png**\n\n![homepage-full-page.png](https://polite-canary-804.convex.cloud/api/storage/2322afa5-163e-4018-8aca-f74080104010)\n\n**Screenshot homepage-viewport.png**\n\n![homepage-viewport.png](https://polite-canary-804.convex.cloud/api/storage/41bafe55-d947-474e-bbec-ceb662d34bb1)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"5f9ab63d588317006ddf3da742e5f80e7528322d","createdAt":"2025-12-01T01:47:24Z","updatedAt":"2025-12-01T01:54:24Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1090#issuecomment-3594189488"},{"type":"issue_comment","id":3594201393,"prNumber":1090,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\nCaptured 2 screenshots for commit `6137114` (2025-12-01 01:54:21.040 UTC).\n\n**Screenshot homepage-full-page.png**\n\n![homepage-full-page.png](https://polite-canary-804.convex.cloud/api/storage/9e006a28-87d6-4686-9ebe-b1a74960f610)\n\n**Screenshot homepage-viewport.png**\n\n![homepage-viewport.png](https://polite-canary-804.convex.cloud/api/storage/a3f9fcc2-5b25-4895-a4eb-105fde700bb9)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"5f9ab63d588317006ddf3da742e5f80e7528322d","createdAt":"2025-12-01T01:54:23Z","updatedAt":"2025-12-01T02:00:45Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1090#issuecomment-3594201393"},{"type":"issue_comment","id":3594210786,"prNumber":1090,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\nCaptured 2 screenshots for commit `6137114` (2025-12-01 02:00:41.933 UTC).\n\n![homepage-full-page.png](https://polite-canary-804.convex.cloud/api/storage/76e44568-0618-40d1-84df-31ba7fd7d2c1)\n\n![homepage-viewport.png](https://polite-canary-804.convex.cloud/api/storage/679cc7b9-a08c-4fdb-8607-53db0e8ff15d)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"5f9ab63d588317006ddf3da742e5f80e7528322d","createdAt":"2025-12-01T02:00:44Z","updatedAt":"2025-12-01T02:04:13Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1090#issuecomment-3594210786"},{"type":"issue_comment","id":3594215967,"prNumber":1090,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\nCaptured 2 screenshots for commit `6137114` (2025-12-01 02:04:11.692 UTC).\n\n**Full page view of the homepage showing the updated hero section with 67x engineers messaging**\n\n![homepage-full-page.png](https://polite-canary-804.convex.cloud/api/storage/c7224d91-7029-4cbe-a4cb-19f8510989df)\n\n**Above-the-fold viewport showing the new hero text**\n\n![homepage-viewport.png](https://polite-canary-804.convex.cloud/api/storage/d7ccd29d-a3d5-4f91-8abe-d0691b3c8eb1)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"5f9ab63d588317006ddf3da742e5f80e7528322d","createdAt":"2025-12-01T02:04:12Z","updatedAt":"2025-12-01T02:32:54Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1090#issuecomment-3594215967"},{"type":"issue_comment","id":3594275001,"prNumber":1090,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nCaptured 2 screenshots for commit `ebef5f8` (2025-12-01 02:32:51.086 UTC).\n\n**Full page view of the homepage showing the updated hero section with 67x engineers messaging**\n\n![homepage-full-page.png](https://polite-canary-804.convex.cloud/api/storage/fbe0de78-f031-4dd6-b7b7-badd754064c7)\n\n**Above-the-fold viewport showing the new hero text**\n\n![homepage-viewport.png](https://polite-canary-804.convex.cloud/api/storage/2847fae4-5ae8-4e98-8d06-8533aa5a3c71)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"5f9ab63d588317006ddf3da742e5f80e7528322d","createdAt":"2025-12-01T02:32:53Z","updatedAt":"2025-12-01T02:32:53Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1090#issuecomment-3594275001"}]}
{"number":1088,"title":"Add previews tab with Completed and In-Progress","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1088","headRef":"cmux/add-previews-tab-with-completed-and-in-progress-maje7","headSha":"c801f75546b1a05193462271cbe1e5a8188cfd72","baseRef":"main","baseSha":"8b1617e504fffc9cec155bac3888fe8b33d96f4e","createdAt":"2025-11-30T22:05:09Z","updatedAt":"2025-12-02T01:45:48Z","diff":"diff --git a/apps/client/src/components/Sidebar.tsx b/apps/client/src/components/Sidebar.tsx\nindex 27f2c7d98..6978688cc 100644\n--- a/apps/client/src/components/Sidebar.tsx\n+++ b/apps/client/src/components/Sidebar.tsx\n@@ -18,6 +18,7 @@ import {\n } from \"react\";\n import CmuxLogo from \"./logo/cmux-logo\";\n import { SidebarNavLink } from \"./sidebar/SidebarNavLink\";\n+import { SidebarPreviewList } from \"./sidebar/SidebarPreviewList\";\n import { SidebarPullRequestList } from \"./sidebar/SidebarPullRequestList\";\n import { SidebarSectionLink } from \"./sidebar/SidebarSectionLink\";\n \n@@ -339,6 +340,19 @@ export function Sidebar({ tasks, teamSlugOrId }: SidebarProps) {\n               )}\n             </div>\n           </div>\n+\n+          <div className=\"mt-2 flex flex-col gap-0.5\">\n+            <SidebarSectionLink\n+              to=\"/$teamSlugOrId/previews\"\n+              params={{ teamSlugOrId }}\n+              exact\n+            >\n+              Previews\n+            </SidebarSectionLink>\n+          </div>\n+          <div className=\"ml-2 pt-px\">\n+            <SidebarPreviewList teamSlugOrId={teamSlugOrId} />\n+          </div>\n         </div>\n       </nav>\n \ndiff --git a/apps/client/src/components/TaskTree.tsx b/apps/client/src/components/TaskTree.tsx\nindex ddc4d6dab..5b6e15934 100644\n--- a/apps/client/src/components/TaskTree.tsx\n+++ b/apps/client/src/components/TaskTree.tsx\n@@ -1976,137 +1976,142 @@ function TaskRunDetails({\n         />\n       ) : null}\n \n-      {previewServices.map((service) => (\n-        <div key={service.port} className=\"relative group mt-px\">\n-          <TaskRunDetailLink\n-            to=\"/$teamSlugOrId/task/$taskId/run/$runId/preview/$previewId\"\n-            params={{\n-              teamSlugOrId,\n-              taskId,\n-              runId: run._id,\n-              previewId: `${service.port}`,\n-            }}\n-            icon={<ExternalLink className=\"w-3 h-3 mr-2 text-neutral-400\" />}\n-            label={`Preview (port ${service.port})`}\n-            indentLevel={indentLevel}\n-            className=\"pr-10\"\n-            onClick={(event) => {\n-              if (event.metaKey || event.ctrlKey) {\n-                event.preventDefault();\n-                window.open(service.url, \"_blank\", \"noopener,noreferrer\");\n-              }\n-            }}\n-          />\n+      {/* Hide preview ports and custom previews for preview screenshot jobs */}\n+      {!run.isPreviewJob && (\n+        <>\n+          {previewServices.map((service) => (\n+            <div key={service.port} className=\"relative group mt-px\">\n+              <TaskRunDetailLink\n+                to=\"/$teamSlugOrId/task/$taskId/run/$runId/preview/$previewId\"\n+                params={{\n+                  teamSlugOrId,\n+                  taskId,\n+                  runId: run._id,\n+                  previewId: `${service.port}`,\n+                }}\n+                icon={<ExternalLink className=\"w-3 h-3 mr-2 text-neutral-400\" />}\n+                label={`Preview (port ${service.port})`}\n+                indentLevel={indentLevel}\n+                className=\"pr-10\"\n+                onClick={(event) => {\n+                  if (event.metaKey || event.ctrlKey) {\n+                    event.preventDefault();\n+                    window.open(service.url, \"_blank\", \"noopener,noreferrer\");\n+                  }\n+                }}\n+              />\n \n-          <Dropdown.Root>\n-            <Dropdown.Trigger\n-              onClick={(event) => event.stopPropagation()}\n-              className={clsx(\n-                \"absolute right-2 top-1/2 -translate-y-1/2\",\n-                \"p-1 rounded flex items-center gap-1\",\n-                \"bg-neutral-100/80 dark:bg-neutral-700/80\",\n-                \"hover:bg-neutral-200/80 dark:hover:bg-neutral-600/80\",\n-                \"text-neutral-600 dark:text-neutral-400\"\n-              )}\n-            >\n-              <EllipsisVertical className=\"w-2.5 h-2.5\" />\n-            </Dropdown.Trigger>\n-            <Dropdown.Portal>\n-              <Dropdown.Positioner\n-                sideOffset={8}\n-                side={isElectron ? \"left\" : \"bottom\"}\n-              >\n-                <Dropdown.Popup>\n-                  <Dropdown.Arrow />\n-                  <Dropdown.Item\n-                    onClick={() => {\n-                      window.open(service.url, \"_blank\", \"noopener,noreferrer\");\n-                    }}\n-                    className=\"flex items-center gap-2\"\n+              <Dropdown.Root>\n+                <Dropdown.Trigger\n+                  onClick={(event) => event.stopPropagation()}\n+                  className={clsx(\n+                    \"absolute right-2 top-1/2 -translate-y-1/2\",\n+                    \"p-1 rounded flex items-center gap-1\",\n+                    \"bg-neutral-100/80 dark:bg-neutral-700/80\",\n+                    \"hover:bg-neutral-200/80 dark:hover:bg-neutral-600/80\",\n+                    \"text-neutral-600 dark:text-neutral-400\"\n+                  )}\n+                >\n+                  <EllipsisVertical className=\"w-2.5 h-2.5\" />\n+                </Dropdown.Trigger>\n+                <Dropdown.Portal>\n+                  <Dropdown.Positioner\n+                    sideOffset={8}\n+                    side={isElectron ? \"left\" : \"bottom\"}\n                   >\n-                    <ExternalLink className=\"w-3.5 h-3.5\" />\n-                    Open in new tab\n-                  </Dropdown.Item>\n-                </Dropdown.Popup>\n-              </Dropdown.Positioner>\n-            </Dropdown.Portal>\n-          </Dropdown.Root>\n-        </div>\n-      ))}\n+                    <Dropdown.Popup>\n+                      <Dropdown.Arrow />\n+                      <Dropdown.Item\n+                        onClick={() => {\n+                          window.open(service.url, \"_blank\", \"noopener,noreferrer\");\n+                        }}\n+                        className=\"flex items-center gap-2\"\n+                      >\n+                        <ExternalLink className=\"w-3.5 h-3.5\" />\n+                        Open in new tab\n+                      </Dropdown.Item>\n+                    </Dropdown.Popup>\n+                  </Dropdown.Positioner>\n+                </Dropdown.Portal>\n+              </Dropdown.Root>\n+            </div>\n+          ))}\n \n-      {customPreviews.map((preview, index) => (\n-        <div key={index} className=\"relative group mt-px\">\n-          <TaskRunDetailLink\n-            to=\"/$teamSlugOrId/task/$taskId/run/$runId/preview/$previewId\"\n-            params={{\n-              teamSlugOrId,\n-              taskId,\n-              runId: run._id,\n-              previewId: String(index),\n-            }}\n-            icon={<ExternalLink className=\"w-3 h-3 mr-2 text-neutral-400\" />}\n-            label={preview.url}\n-            indentLevel={indentLevel}\n-            className=\"pr-10\"\n-            onClick={(event) => {\n-              if (event.metaKey || event.ctrlKey) {\n-                event.preventDefault();\n-                window.open(preview.url, \"_blank\", \"noopener,noreferrer\");\n-              }\n-            }}\n-          />\n+          {customPreviews.map((preview, index) => (\n+            <div key={index} className=\"relative group mt-px\">\n+              <TaskRunDetailLink\n+                to=\"/$teamSlugOrId/task/$taskId/run/$runId/preview/$previewId\"\n+                params={{\n+                  teamSlugOrId,\n+                  taskId,\n+                  runId: run._id,\n+                  previewId: String(index),\n+                }}\n+                icon={<ExternalLink className=\"w-3 h-3 mr-2 text-neutral-400\" />}\n+                label={preview.url}\n+                indentLevel={indentLevel}\n+                className=\"pr-10\"\n+                onClick={(event) => {\n+                  if (event.metaKey || event.ctrlKey) {\n+                    event.preventDefault();\n+                    window.open(preview.url, \"_blank\", \"noopener,noreferrer\");\n+                  }\n+                }}\n+              />\n \n-          <Dropdown.Root>\n-            <Dropdown.Trigger\n-              onClick={(event) => event.stopPropagation()}\n-              className={clsx(\n-                \"absolute right-2 top-1/2 -translate-y-1/2\",\n-                \"p-1 rounded flex items-center gap-1\",\n-                \"bg-neutral-100/80 dark:bg-neutral-700/80\",\n-                \"hover:bg-neutral-200/80 dark:hover:bg-neutral-600/80\",\n-                \"text-neutral-600 dark:text-neutral-400\"\n-              )}\n-            >\n-              <EllipsisVertical className=\"w-2.5 h-2.5\" />\n-            </Dropdown.Trigger>\n-            <Dropdown.Portal>\n-              <Dropdown.Positioner\n-                sideOffset={8}\n-                side={isElectron ? \"left\" : \"bottom\"}\n-              >\n-                <Dropdown.Popup>\n-                  <Dropdown.Arrow />\n-                  <Dropdown.Item\n-                    onClick={() => {\n-                      window.open(preview.url, \"_blank\", \"noopener,noreferrer\");\n-                    }}\n-                    className=\"flex items-center gap-2\"\n-                  >\n-                    <ExternalLink className=\"w-3.5 h-3.5\" />\n-                    Open in new tab\n-                  </Dropdown.Item>\n-                  <Dropdown.Item\n-                    onClick={() => handleRemovePreview(index, currentPreviewId)}\n-                    className=\"flex items-center gap-2 text-red-600 dark:text-red-400\"\n+              <Dropdown.Root>\n+                <Dropdown.Trigger\n+                  onClick={(event) => event.stopPropagation()}\n+                  className={clsx(\n+                    \"absolute right-2 top-1/2 -translate-y-1/2\",\n+                    \"p-1 rounded flex items-center gap-1\",\n+                    \"bg-neutral-100/80 dark:bg-neutral-700/80\",\n+                    \"hover:bg-neutral-200/80 dark:hover:bg-neutral-600/80\",\n+                    \"text-neutral-600 dark:text-neutral-400\"\n+                  )}\n+                >\n+                  <EllipsisVertical className=\"w-2.5 h-2.5\" />\n+                </Dropdown.Trigger>\n+                <Dropdown.Portal>\n+                  <Dropdown.Positioner\n+                    sideOffset={8}\n+                    side={isElectron ? \"left\" : \"bottom\"}\n                   >\n-                    <Trash2 className=\"w-3.5 h-3.5\" />\n-                    Remove preview\n-                  </Dropdown.Item>\n-                </Dropdown.Popup>\n-              </Dropdown.Positioner>\n-            </Dropdown.Portal>\n-          </Dropdown.Root>\n-        </div>\n-      ))}\n+                    <Dropdown.Popup>\n+                      <Dropdown.Arrow />\n+                      <Dropdown.Item\n+                        onClick={() => {\n+                          window.open(preview.url, \"_blank\", \"noopener,noreferrer\");\n+                        }}\n+                        className=\"flex items-center gap-2\"\n+                      >\n+                        <ExternalLink className=\"w-3.5 h-3.5\" />\n+                        Open in new tab\n+                      </Dropdown.Item>\n+                      <Dropdown.Item\n+                        onClick={() => handleRemovePreview(index, currentPreviewId)}\n+                        className=\"flex items-center gap-2 text-red-600 dark:text-red-400\"\n+                      >\n+                        <Trash2 className=\"w-3.5 h-3.5\" />\n+                        Remove preview\n+                      </Dropdown.Item>\n+                    </Dropdown.Popup>\n+                  </Dropdown.Positioner>\n+                </Dropdown.Portal>\n+              </Dropdown.Root>\n+            </div>\n+          ))}\n \n-      <AddPreviewInput\n-        indentLevel={indentLevel}\n-        onAdd={handleAddPreview}\n-        currentCount={customPreviews.length}\n-        taskId={taskId}\n-        runId={run._id}\n-        teamSlugOrId={teamSlugOrId}\n-      />\n+          <AddPreviewInput\n+            indentLevel={indentLevel}\n+            onAdd={handleAddPreview}\n+            currentCount={customPreviews.length}\n+            taskId={taskId}\n+            runId={run._id}\n+            teamSlugOrId={teamSlugOrId}\n+          />\n+        </>\n+      )}\n \n       {hasChildren ? (\n         <div className=\"flex flex-col\">\ndiff --git a/apps/client/src/components/dashboard/PreviewItem.tsx b/apps/client/src/components/dashboard/PreviewItem.tsx\nnew file mode 100644\nindex 000000000..df586a7f6\n--- /dev/null\n+++ b/apps/client/src/components/dashboard/PreviewItem.tsx\n@@ -0,0 +1,227 @@\n+import {\n+  Tooltip,\n+  TooltipContent,\n+  TooltipTrigger,\n+} from \"@/components/ui/tooltip\";\n+import { useArchiveTask } from \"@/hooks/useArchiveTask\";\n+import type { Doc, Id } from \"@cmux/convex/dataModel\";\n+import { useClipboard } from \"@mantine/hooks\";\n+import { Link } from \"@tanstack/react-router\";\n+import clsx from \"clsx\";\n+import {\n+  Archive,\n+  Check,\n+  Copy,\n+  ExternalLink,\n+  GitPullRequest,\n+} from \"lucide-react\";\n+import { memo, useCallback } from \"react\";\n+\n+type PreviewRunWithConfig = Doc<\"previewRuns\"> & {\n+  configRepoFullName?: string;\n+  taskId?: Id<\"tasks\">;\n+};\n+\n+interface PreviewItemProps {\n+  previewRun: PreviewRunWithConfig;\n+  teamSlugOrId: string;\n+}\n+\n+export const PreviewItem = memo(function PreviewItem({\n+  previewRun,\n+  teamSlugOrId,\n+}: PreviewItemProps) {\n+  const clipboard = useClipboard({ timeout: 2000 });\n+  const { archive } = useArchiveTask(teamSlugOrId);\n+\n+  // Determine if this is a \"completed\" status (filled green circle) or \"in progress\" (empty circle)\n+  // \"completed\" and \"skipped\" show as green (done), \"failed\" shows as red\n+  const isCompleted = previewRun.status === \"completed\" || previewRun.status === \"skipped\";\n+  const isFailed = previewRun.status === \"failed\";\n+\n+  // Generate a display title from PR info\n+  const displayTitle = `PR #${previewRun.prNumber}`;\n+  const repoName = previewRun.repoFullName.split(\"/\")[1] || previewRun.repoFullName;\n+\n+  const handleCopy = useCallback(\n+    (e: React.MouseEvent) => {\n+      e.stopPropagation();\n+      e.preventDefault();\n+      clipboard.copy(previewRun.prUrl);\n+    },\n+    [clipboard, previewRun.prUrl]\n+  );\n+\n+  const handleOpenPR = useCallback(\n+    (e: React.MouseEvent) => {\n+      e.stopPropagation();\n+      e.preventDefault();\n+      window.open(previewRun.prUrl, \"_blank\", \"noopener,noreferrer\");\n+    },\n+    [previewRun.prUrl]\n+  );\n+\n+  const handleArchive = useCallback(\n+    (e: React.MouseEvent) => {\n+      e.stopPropagation();\n+      e.preventDefault();\n+      if (previewRun.taskId) {\n+        archive(previewRun.taskId);\n+      }\n+    },\n+    [archive, previewRun.taskId]\n+  );\n+\n+  // Format the timestamp\n+  const formatTime = (timestamp: number | undefined) => {\n+    if (!timestamp) return null;\n+    const date = new Date(timestamp);\n+    const today = new Date();\n+    const isToday =\n+      date.getDate() === today.getDate() &&\n+      date.getMonth() === today.getMonth() &&\n+      date.getFullYear() === today.getFullYear();\n+\n+    return isToday\n+      ? date.toLocaleTimeString([], { hour: \"numeric\", minute: \"2-digit\" })\n+      : date.toLocaleDateString([], { month: \"short\", day: \"numeric\" });\n+  };\n+\n+  const timestamp = previewRun.completedAt || previewRun.startedAt || previewRun.createdAt;\n+\n+  const rowContent = (\n+    <>\n+      <div className=\"flex items-center justify-center pl-1 -mr-2 relative\">\n+        {/* Placeholder for future selection checkbox */}\n+      </div>\n+      <div className=\"flex items-center justify-center\">\n+        <div\n+          className={clsx(\n+            \"rounded-full flex-shrink-0\",\n+            isCompleted\n+              ? \"w-[8px] h-[8px] border border-transparent bg-green-500\"\n+              : isFailed\n+                ? \"w-[8px] h-[8px] border border-transparent bg-red-500\"\n+                : \"w-[9.5px] h-[9.5px] border border-neutral-400 dark:border-neutral-500 bg-transparent\"\n+          )}\n+        />\n+      </div>\n+      <div className=\"min-w-0 flex items-center gap-2\">\n+        <GitPullRequest className=\"w-3.5 h-3.5 text-neutral-400 dark:text-neutral-500 flex-shrink-0\" />\n+        <span className=\"text-[13px] font-medium truncate min-w-0 pr-1\">\n+          {displayTitle}\n+        </span>\n+        {previewRun.headRef && (\n+          <span className=\"text-[11px] text-neutral-400 dark:text-neutral-500 truncate\">\n+            {previewRun.headRef}\n+          </span>\n+        )}\n+      </div>\n+      <div className=\"text-[11px] text-neutral-400 dark:text-neutral-500 min-w-0 text-right flex items-center justify-end gap-2\">\n+        <span className=\"truncate\">{repoName}</span>\n+      </div>\n+      <div className=\"text-[11px] text-neutral-400 dark:text-neutral-500 flex-shrink-0 tabular-nums text-right\">\n+        {formatTime(timestamp)}\n+      </div>\n+    </>\n+  );\n+\n+  const rowClassName = clsx(\n+    \"relative grid w-full items-center py-2 pr-3 cursor-default select-none group\",\n+    \"grid-cols-[24px_36px_1fr_minmax(120px,auto)_58px]\",\n+    \"bg-white dark:bg-neutral-900/50 group-hover:bg-neutral-50/90 dark:group-hover:bg-neutral-600/60\"\n+  );\n+\n+  return (\n+    <div className=\"relative group w-full\">\n+      {previewRun.taskId ? (\n+        <Link\n+          to=\"/$teamSlugOrId/task/$taskId\"\n+          params={{\n+            teamSlugOrId,\n+            taskId: previewRun.taskId,\n+          }}\n+          search={{ runId: previewRun.taskRunId }}\n+          className={rowClassName}\n+        >\n+          {rowContent}\n+        </Link>\n+      ) : (\n+        <div className={rowClassName}>\n+          {rowContent}\n+        </div>\n+      )}\n+      <div className=\"right-2 top-0 bottom-0 absolute py-2 group\">\n+        <div className=\"flex gap-1\">\n+          {/* Copy PR URL button */}\n+          <Tooltip>\n+            <TooltipTrigger asChild>\n+              <button\n+                onClick={handleCopy}\n+                className={clsx(\n+                  \"p-1 rounded\",\n+                  \"bg-neutral-100 dark:bg-neutral-700\",\n+                  \"text-neutral-600 dark:text-neutral-400\",\n+                  \"hover:bg-neutral-200 dark:hover:bg-neutral-600\",\n+                  \"group-hover:opacity-100 opacity-0\"\n+                )}\n+                title=\"Copy PR URL\"\n+              >\n+                {clipboard.copied ? (\n+                  <Check className=\"w-3.5 h-3.5\" />\n+                ) : (\n+                  <Copy className=\"w-3.5 h-3.5\" />\n+                )}\n+              </button>\n+            </TooltipTrigger>\n+            <TooltipContent side=\"top\">\n+              {clipboard.copied ? \"Copied!\" : \"Copy PR URL\"}\n+            </TooltipContent>\n+          </Tooltip>\n+\n+          {/* Open PR button */}\n+          <Tooltip>\n+            <TooltipTrigger asChild>\n+              <button\n+                onClick={handleOpenPR}\n+                className={clsx(\n+                  \"p-1 rounded\",\n+                  \"bg-neutral-100 dark:bg-neutral-700\",\n+                  \"text-neutral-600 dark:text-neutral-400\",\n+                  \"hover:bg-neutral-200 dark:hover:bg-neutral-600\",\n+                  \"group-hover:opacity-100 opacity-0\"\n+                )}\n+                title=\"Open PR\"\n+              >\n+                <ExternalLink className=\"w-3.5 h-3.5\" />\n+              </button>\n+            </TooltipTrigger>\n+            <TooltipContent side=\"top\">Open PR</TooltipContent>\n+          </Tooltip>\n+\n+          {/* Archive button - only show if there's a linked task */}\n+          {previewRun.taskId && (\n+            <Tooltip>\n+              <TooltipTrigger asChild>\n+                <button\n+                  onClick={handleArchive}\n+                  className={clsx(\n+                    \"p-1 rounded\",\n+                    \"bg-neutral-100 dark:bg-neutral-700\",\n+                    \"text-neutral-600 dark:text-neutral-400\",\n+                    \"hover:bg-neutral-200 dark:hover:bg-neutral-600\",\n+                    \"group-hover:opacity-100 opacity-0\"\n+                  )}\n+                  title=\"Archive\"\n+                >\n+                  <Archive className=\"w-3.5 h-3.5\" />\n+                </button>\n+              </TooltipTrigger>\n+              <TooltipContent side=\"top\">Archive</TooltipContent>\n+            </Tooltip>\n+          )}\n+        </div>\n+      </div>\n+    </div>\n+  );\n+});\ndiff --git a/apps/client/src/components/dashboard/TaskList.tsx b/apps/client/src/components/dashboard/TaskList.tsx\nindex dea857570..1bc7e946c 100644\n--- a/apps/client/src/components/dashboard/TaskList.tsx\n+++ b/apps/client/src/components/dashboard/TaskList.tsx\n@@ -1,10 +1,11 @@\n import { api } from \"@cmux/convex/api\";\n-import type { Doc } from \"@cmux/convex/dataModel\";\n+import type { Doc, Id } from \"@cmux/convex/dataModel\";\n import { useLocalStorage } from \"@mantine/hooks\";\n import { useQuery } from \"convex/react\";\n import clsx from \"clsx\";\n import { memo, useCallback, useMemo, useState } from \"react\";\n import { TaskItem } from \"./TaskItem\";\n+import { PreviewItem } from \"./PreviewItem\";\n import { ChevronRight } from \"lucide-react\";\n \n type TaskCategoryKey =\n@@ -109,6 +110,74 @@ const createCollapsedCategoryState = (\n   merged: defaultValue,\n });\n \n+// Preview run types\n+type PreviewRunWithConfig = Doc<\"previewRuns\"> & {\n+  configRepoFullName?: string;\n+  taskId?: Id<\"tasks\">;\n+};\n+\n+type PreviewCategoryKey = \"in_progress\" | \"completed\";\n+\n+const PREVIEW_CATEGORY_ORDER: PreviewCategoryKey[] = [\"in_progress\", \"completed\"];\n+\n+const PREVIEW_CATEGORY_META: Record<\n+  PreviewCategoryKey,\n+  { title: string; emptyLabel: string }\n+> = {\n+  in_progress: {\n+    title: \"In Progress\",\n+    emptyLabel: \"No previews are currently in progress.\",\n+  },\n+  completed: {\n+    title: \"Completed\",\n+    emptyLabel: \"No completed previews yet.\",\n+  },\n+};\n+\n+const createEmptyPreviewCategoryBuckets = (): Record<\n+  PreviewCategoryKey,\n+  PreviewRunWithConfig[]\n+> => ({\n+  in_progress: [],\n+  completed: [],\n+});\n+\n+const getPreviewCategory = (run: PreviewRunWithConfig): PreviewCategoryKey | null => {\n+  if (run.status === \"pending\" || run.status === \"running\") {\n+    return \"in_progress\";\n+  }\n+  // Only \"completed\" and \"skipped\" should show as completed (green circles)\n+  if (run.status === \"completed\" || run.status === \"skipped\") {\n+    return \"completed\";\n+  }\n+  // \"failed\" runs are excluded from both categories\n+  return null;\n+};\n+\n+const categorizePreviewRuns = (\n+  runs: PreviewRunWithConfig[] | undefined\n+): Record<PreviewCategoryKey, PreviewRunWithConfig[]> | null => {\n+  if (!runs) {\n+    return null;\n+  }\n+  const buckets = createEmptyPreviewCategoryBuckets();\n+  for (const run of runs) {\n+    const key = getPreviewCategory(run);\n+    // Skip runs that don't belong to any category (e.g., failed runs)\n+    if (key !== null) {\n+      buckets[key].push(run);\n+    }\n+  }\n+  return buckets;\n+};\n+\n+const createCollapsedPreviewCategoryState = (\n+  defaultValue = false\n+): Record<PreviewCategoryKey, boolean> => ({\n+  in_progress: defaultValue,\n+  completed: defaultValue,\n+});\n+\n export const TaskList = memo(function TaskList({\n   teamSlugOrId,\n }: {\n@@ -120,7 +189,8 @@ export const TaskList = memo(function TaskList({\n     archived: true,\n   });\n   const pinnedData = useQuery(api.tasks.getPinned, { teamSlugOrId });\n-  const [tab, setTab] = useState<\"all\" | \"archived\">(\"all\");\n+  const previewRuns = useQuery(api.previewRuns.listByTeam, { teamSlugOrId });\n+  const [tab, setTab] = useState<\"all\" | \"archived\" | \"previews\">(\"all\");\n \n   const categorizedTasks = useMemo(() => {\n     const categorized = categorizeTasks(allTasks);\n@@ -163,6 +233,36 @@ export const TaskList = memo(function TaskList({\n     }));\n   }, [setCollapsedCategories]);\n \n+  // Preview runs categorization\n+  const categorizedPreviewRuns = useMemo(\n+    () => categorizePreviewRuns(previewRuns),\n+    [previewRuns]\n+  );\n+  const previewCategoryBuckets = categorizedPreviewRuns ?? createEmptyPreviewCategoryBuckets();\n+\n+  const collapsedPreviewStorageKey = useMemo(\n+    () => `dashboard-collapsed-preview-categories-${teamSlugOrId}`,\n+    [teamSlugOrId]\n+  );\n+  const defaultCollapsedPreviewState = useMemo(\n+    () => createCollapsedPreviewCategoryState(),\n+    []\n+  );\n+  const [collapsedPreviewCategories, setCollapsedPreviewCategories] = useLocalStorage<\n+    Record<PreviewCategoryKey, boolean>\n+  >({\n+    key: collapsedPreviewStorageKey,\n+    defaultValue: defaultCollapsedPreviewState,\n+    getInitialValueInEffect: true,\n+  });\n+\n+  const togglePreviewCategoryCollapse = useCallback((categoryKey: PreviewCategoryKey) => {\n+    setCollapsedPreviewCategories((prev) => ({\n+      ...prev,\n+      [categoryKey]: !prev[categoryKey],\n+    }));\n+  }, [setCollapsedPreviewCategories]);\n+\n   return (\n     <div className=\"mt-6 w-full\">\n       <div className=\"mb-3 px-4\">\n@@ -179,6 +279,18 @@ export const TaskList = memo(function TaskList({\n           >\n             Tasks\n           </button>\n+          <button\n+            className={\n+              \"text-sm font-medium transition-colors \" +\n+              (tab === \"previews\"\n+                ? \"text-neutral-900 dark:text-neutral-100\"\n+                : \"text-neutral-500 dark:text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200\")\n+            }\n+            onMouseDown={() => setTab(\"previews\")}\n+            onClick={() => setTab(\"previews\")}\n+          >\n+            Previews\n+          </button>\n           <button\n             className={\n               \"text-sm font-medium transition-colors \" +\n@@ -212,6 +324,29 @@ export const TaskList = memo(function TaskList({\n               />\n             ))\n           )\n+        ) : tab === \"previews\" ? (\n+          previewRuns === undefined ? (\n+            <div className=\"text-sm text-neutral-500 dark:text-neutral-400 py-2 pl-4 select-none\">\n+              Loading...\n+            </div>\n+          ) : previewRuns.length === 0 ? (\n+            <div className=\"text-sm text-neutral-500 dark:text-neutral-400 py-2 pl-4 select-none\">\n+              No preview runs\n+            </div>\n+          ) : (\n+            <div className=\"mt-1 w-full flex flex-col space-y-[-1px] transform -translate-y-px\">\n+              {PREVIEW_CATEGORY_ORDER.map((categoryKey) => (\n+                <PreviewCategorySection\n+                  key={categoryKey}\n+                  categoryKey={categoryKey}\n+                  previewRuns={previewCategoryBuckets[categoryKey]}\n+                  teamSlugOrId={teamSlugOrId}\n+                  collapsed={Boolean(collapsedPreviewCategories[categoryKey])}\n+                  onToggle={togglePreviewCategoryCollapse}\n+                />\n+              ))}\n+            </div>\n+          )\n         ) : allTasks === undefined ? (\n           <div className=\"text-sm text-neutral-500 dark:text-neutral-400 py-2 pl-4 select-none\">\n             Loading...\n@@ -310,3 +445,73 @@ function TaskCategorySection({\n     </div>\n   );\n }\n+\n+function PreviewCategorySection({\n+  categoryKey,\n+  previewRuns,\n+  teamSlugOrId,\n+  collapsed,\n+  onToggle,\n+}: {\n+  categoryKey: PreviewCategoryKey;\n+  previewRuns: PreviewRunWithConfig[];\n+  teamSlugOrId: string;\n+  collapsed: boolean;\n+  onToggle: (key: PreviewCategoryKey) => void;\n+}) {\n+  const meta = PREVIEW_CATEGORY_META[categoryKey];\n+  const handleToggle = useCallback(\n+    () => onToggle(categoryKey),\n+    [categoryKey, onToggle]\n+  );\n+  const contentId = `preview-category-${categoryKey}`;\n+  const toggleLabel = collapsed\n+    ? `Expand ${meta.title}`\n+    : `Collapse ${meta.title}`;\n+  return (\n+    <div className=\"w-full\">\n+      <div\n+        className=\"sticky top-0 z-10 flex w-full border-y border-neutral-200 dark:border-neutral-900 bg-neutral-100 dark:bg-neutral-800 select-none\"\n+        onDoubleClick={handleToggle}\n+      >\n+        <div className=\"flex w-full items-center pr-4\">\n+          <button\n+            type=\"button\"\n+            onClick={handleToggle}\n+            aria-label={toggleLabel}\n+            aria-expanded={!collapsed}\n+            aria-controls={contentId}\n+            className=\"flex h-9 w-9 items-center justify-center text-neutral-500 hover:text-black dark:text-neutral-400 dark:hover:text-neutral-200 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-neutral-300 dark:focus-visible:outline-neutral-700 transition-colors\"\n+          >\n+            <ChevronRight\n+              className={clsx(\n+                \"h-3 w-3 transition-transform duration-200\",\n+                !collapsed && \"rotate-90\"\n+              )}\n+              aria-hidden=\"true\"\n+            />\n+          </button>\n+          <div className=\"flex items-center gap-2 text-xs font-medium tracking-tight text-neutral-900 dark:text-neutral-100\">\n+            <span>{meta.title}</span>\n+            <span className=\"text-xs text-neutral-500 dark:text-neutral-400\">\n+              {previewRuns.length}\n+            </span>\n+          </div>\n+        </div>\n+      </div>\n+      {collapsed ? null : previewRuns.length > 0 ? (\n+        <div id={contentId} className=\"flex flex-col w-full\">\n+          {previewRuns.map((run) => (\n+            <PreviewItem key={run._id} previewRun={run} teamSlugOrId={teamSlugOrId} />\n+          ))}\n+        </div>\n+      ) : (\n+        <div className=\"flex w-full items-center px-4 py-3\">\n+          <p className=\"pl-5 text-xs text-neutral-500 dark:text-neutral-400 select-none\">\n+            {meta.emptyLabel}\n+          </p>\n+        </div>\n+      )}\n+    </div>\n+  );\n+}\ndiff --git a/apps/client/src/components/sidebar/SidebarPreviewList.tsx b/apps/client/src/components/sidebar/SidebarPreviewList.tsx\nnew file mode 100644\nindex 000000000..cc324d3c1\n--- /dev/null\n+++ b/apps/client/src/components/sidebar/SidebarPreviewList.tsx\n@@ -0,0 +1,39 @@\n+import { TaskTree } from \"@/components/TaskTree\";\n+import { TaskTreeSkeleton } from \"@/components/TaskTreeSkeleton\";\n+import { api } from \"@cmux/convex/api\";\n+import { useQuery } from \"convex/react\";\n+\n+type Props = {\n+  teamSlugOrId: string;\n+};\n+\n+export function SidebarPreviewList({ teamSlugOrId }: Props) {\n+  const tasks = useQuery(api.tasks.getPreviewTasks, { teamSlugOrId });\n+\n+  if (tasks === undefined) {\n+    return <TaskTreeSkeleton count={3} />;\n+  }\n+\n+  if (tasks.length === 0) {\n+    return (\n+      <p className=\"mt-1 pl-2 pr-3 py-2 text-xs text-neutral-500 dark:text-neutral-400 select-none\">\n+        No preview runs\n+      </p>\n+    );\n+  }\n+\n+  return (\n+    <div className=\"space-y-px\">\n+      {tasks.map((task) => (\n+        <TaskTree\n+          key={task._id}\n+          task={task}\n+          defaultExpanded={false}\n+          teamSlugOrId={teamSlugOrId}\n+        />\n+      ))}\n+    </div>\n+  );\n+}\n+\n+export default SidebarPreviewList;\ndiff --git a/apps/client/src/hooks/useArchiveTask.ts b/apps/client/src/hooks/useArchiveTask.ts\nindex db4c7852d..4d358ef89 100644\n--- a/apps/client/src/hooks/useArchiveTask.ts\n+++ b/apps/client/src/hooks/useArchiveTask.ts\n@@ -36,6 +36,44 @@ export function useArchiveTask(teamSlugOrId: string) {\n       // default args variant used across app\n       updateLists({ teamSlugOrId });\n       updateLists({ teamSlugOrId, archived: false });\n+\n+      // Also update getById query if it exists (used by preview list)\n+      const detailArgs = { teamSlugOrId: args.teamSlugOrId, id: args.id };\n+      const existingDetail = localStore.getQuery(api.tasks.getById, detailArgs);\n+      if (existingDetail) {\n+        localStore.setQuery(api.tasks.getById, detailArgs, {\n+          ...existingDetail,\n+          isArchived: true,\n+        });\n+      }\n+\n+      // Also update getPreviewTasks query if it exists (used by sidebar previews)\n+      const previewArgs = { teamSlugOrId: args.teamSlugOrId };\n+      const previewTasks = localStore.getQuery(\n+        api.tasks.getPreviewTasks,\n+        previewArgs\n+      );\n+      if (previewTasks) {\n+        localStore.setQuery(\n+          api.tasks.getPreviewTasks,\n+          previewArgs,\n+          previewTasks.filter((t) => t._id !== args.id)\n+        );\n+      }\n+\n+      // Also update previewRuns.listByTeam query if it exists (used by dashboard previews tab)\n+      const previewRunsArgs = { teamSlugOrId: args.teamSlugOrId };\n+      const previewRuns = localStore.getQuery(\n+        api.previewRuns.listByTeam,\n+        previewRunsArgs\n+      );\n+      if (previewRuns) {\n+        localStore.setQuery(\n+          api.previewRuns.listByTeam,\n+          previewRunsArgs,\n+          previewRuns.filter((run) => run.taskId !== args.id)\n+        );\n+      }\n     }\n   );\n \n@@ -61,6 +99,16 @@ export function useArchiveTask(teamSlugOrId: string) {\n     };\n     updateLists({ teamSlugOrId });\n     updateLists({ teamSlugOrId, archived: false });\n+\n+    // Also update getById query if it exists (used by preview list)\n+    const detailArgs = { teamSlugOrId: args.teamSlugOrId, id: args.id };\n+    const existingDetail = localStore.getQuery(api.tasks.getById, detailArgs);\n+    if (existingDetail) {\n+      localStore.setQuery(api.tasks.getById, detailArgs, {\n+        ...existingDetail,\n+        isArchived: false,\n+      });\n+    }\n   });\n \n   const archiveWithUndo = (task: Doc<\"tasks\">) => {\ndiff --git a/apps/client/src/routeTree.gen.ts b/apps/client/src/routeTree.gen.ts\nindex ee9f698b4..b9bfb05dc 100644\n--- a/apps/client/src/routeTree.gen.ts\n+++ b/apps/client/src/routeTree.gen.ts\n@@ -26,6 +26,7 @@ import { Route as LayoutTeamSlugOrIdRouteImport } from './routes/_layout.$teamSl\n import { Route as LayoutTeamSlugOrIdWorkspacesRouteImport } from './routes/_layout.$teamSlugOrId.workspaces'\n import { Route as LayoutTeamSlugOrIdSettingsRouteImport } from './routes/_layout.$teamSlugOrId.settings'\n import { Route as LayoutTeamSlugOrIdPrsRouteImport } from './routes/_layout.$teamSlugOrId.prs'\n+import { Route as LayoutTeamSlugOrIdPreviewsRouteImport } from './routes/_layout.$teamSlugOrId.previews'\n import { Route as LayoutTeamSlugOrIdLogsRouteImport } from './routes/_layout.$teamSlugOrId.logs'\n import { Route as LayoutTeamSlugOrIdEnvironmentsRouteImport } from './routes/_layout.$teamSlugOrId.environments'\n import { Route as LayoutTeamSlugOrIdDiffRouteImport } from './routes/_layout.$teamSlugOrId.diff'\n@@ -133,6 +134,12 @@ const LayoutTeamSlugOrIdPrsRoute = LayoutTeamSlugOrIdPrsRouteImport.update({\n   path: '/prs',\n   getParentRoute: () => LayoutTeamSlugOrIdRoute,\n } as any)\n+const LayoutTeamSlugOrIdPreviewsRoute =\n+  LayoutTeamSlugOrIdPreviewsRouteImport.update({\n+    id: '/previews',\n+    path: '/previews',\n+    getParentRoute: () => LayoutTeamSlugOrIdRoute,\n+  } as any)\n const LayoutTeamSlugOrIdLogsRoute = LayoutTeamSlugOrIdLogsRouteImport.update({\n   id: '/logs',\n   path: '/logs',\n@@ -271,6 +278,7 @@ export interface FileRoutesByFullPath {\n   '/$teamSlugOrId/diff': typeof LayoutTeamSlugOrIdDiffRoute\n   '/$teamSlugOrId/environments': typeof LayoutTeamSlugOrIdEnvironmentsRouteWithChildren\n   '/$teamSlugOrId/logs': typeof LayoutTeamSlugOrIdLogsRoute\n+  '/$teamSlugOrId/previews': typeof LayoutTeamSlugOrIdPreviewsRoute\n   '/$teamSlugOrId/prs': typeof LayoutTeamSlugOrIdPrsRouteWithChildren\n   '/$teamSlugOrId/settings': typeof LayoutTeamSlugOrIdSettingsRoute\n   '/$teamSlugOrId/workspaces': typeof LayoutTeamSlugOrIdWorkspacesRoute\n@@ -308,6 +316,7 @@ export interface FileRoutesByTo {\n   '/$teamSlugOrId/dashboard': typeof LayoutTeamSlugOrIdDashboardRoute\n   '/$teamSlugOrId/diff': typeof LayoutTeamSlugOrIdDiffRoute\n   '/$teamSlugOrId/logs': typeof LayoutTeamSlugOrIdLogsRoute\n+  '/$teamSlugOrId/previews': typeof LayoutTeamSlugOrIdPreviewsRoute\n   '/$teamSlugOrId/prs': typeof LayoutTeamSlugOrIdPrsRouteWithChildren\n   '/$teamSlugOrId/settings': typeof LayoutTeamSlugOrIdSettingsRoute\n   '/$teamSlugOrId/workspaces': typeof LayoutTeamSlugOrIdWorkspacesRoute\n@@ -347,6 +356,7 @@ export interface FileRoutesById {\n   '/_layout/$teamSlugOrId/diff': typeof LayoutTeamSlugOrIdDiffRoute\n   '/_layout/$teamSlugOrId/environments': typeof LayoutTeamSlugOrIdEnvironmentsRouteWithChildren\n   '/_layout/$teamSlugOrId/logs': typeof LayoutTeamSlugOrIdLogsRoute\n+  '/_layout/$teamSlugOrId/previews': typeof LayoutTeamSlugOrIdPreviewsRoute\n   '/_layout/$teamSlugOrId/prs': typeof LayoutTeamSlugOrIdPrsRouteWithChildren\n   '/_layout/$teamSlugOrId/settings': typeof LayoutTeamSlugOrIdSettingsRoute\n   '/_layout/$teamSlugOrId/workspaces': typeof LayoutTeamSlugOrIdWorkspacesRoute\n@@ -387,6 +397,7 @@ export interface FileRouteTypes {\n     | '/$teamSlugOrId/diff'\n     | '/$teamSlugOrId/environments'\n     | '/$teamSlugOrId/logs'\n+    | '/$teamSlugOrId/previews'\n     | '/$teamSlugOrId/prs'\n     | '/$teamSlugOrId/settings'\n     | '/$teamSlugOrId/workspaces'\n@@ -424,6 +435,7 @@ export interface FileRouteTypes {\n     | '/$teamSlugOrId/dashboard'\n     | '/$teamSlugOrId/diff'\n     | '/$teamSlugOrId/logs'\n+    | '/$teamSlugOrId/previews'\n     | '/$teamSlugOrId/prs'\n     | '/$teamSlugOrId/settings'\n     | '/$teamSlugOrId/workspaces'\n@@ -462,6 +474,7 @@ export interface FileRouteTypes {\n     | '/_layout/$teamSlugOrId/diff'\n     | '/_layout/$teamSlugOrId/environments'\n     | '/_layout/$teamSlugOrId/logs'\n+    | '/_layout/$teamSlugOrId/previews'\n     | '/_layout/$teamSlugOrId/prs'\n     | '/_layout/$teamSlugOrId/settings'\n     | '/_layout/$teamSlugOrId/workspaces'\n@@ -616,6 +629,13 @@ declare module '@tanstack/react-router' {\n       preLoaderRoute: typeof LayoutTeamSlugOrIdPrsRouteImport\n       parentRoute: typeof LayoutTeamSlugOrIdRoute\n     }\n+    '/_layout/$teamSlugOrId/previews': {\n+      id: '/_layout/$teamSlugOrId/previews'\n+      path: '/previews'\n+      fullPath: '/$teamSlugOrId/previews'\n+      preLoaderRoute: typeof LayoutTeamSlugOrIdPreviewsRouteImport\n+      parentRoute: typeof LayoutTeamSlugOrIdRoute\n+    }\n     '/_layout/$teamSlugOrId/logs': {\n       id: '/_layout/$teamSlugOrId/logs'\n       path: '/logs'\n@@ -839,6 +859,7 @@ interface LayoutTeamSlugOrIdRouteChildren {\n   LayoutTeamSlugOrIdDiffRoute: typeof LayoutTeamSlugOrIdDiffRoute\n   LayoutTeamSlugOrIdEnvironmentsRoute: typeof LayoutTeamSlugOrIdEnvironmentsRouteWithChildren\n   LayoutTeamSlugOrIdLogsRoute: typeof LayoutTeamSlugOrIdLogsRoute\n+  LayoutTeamSlugOrIdPreviewsRoute: typeof LayoutTeamSlugOrIdPreviewsRoute\n   LayoutTeamSlugOrIdPrsRoute: typeof LayoutTeamSlugOrIdPrsRouteWithChildren\n   LayoutTeamSlugOrIdSettingsRoute: typeof LayoutTeamSlugOrIdSettingsRoute\n   LayoutTeamSlugOrIdWorkspacesRoute: typeof LayoutTeamSlugOrIdWorkspacesRoute\n@@ -854,6 +875,7 @@ const LayoutTeamSlugOrIdRouteChildren: LayoutTeamSlugOrIdRouteChildren = {\n   LayoutTeamSlugOrIdEnvironmentsRoute:\n     LayoutTeamSlugOrIdEnvironmentsRouteWithChildren,\n   LayoutTeamSlugOrIdLogsRoute: LayoutTeamSlugOrIdLogsRoute,\n+  LayoutTeamSlugOrIdPreviewsRoute: LayoutTeamSlugOrIdPreviewsRoute,\n   LayoutTeamSlugOrIdPrsRoute: LayoutTeamSlugOrIdPrsRouteWithChildren,\n   LayoutTeamSlugOrIdSettingsRoute: LayoutTeamSlugOrIdSettingsRoute,\n   LayoutTeamSlugOrIdWorkspacesRoute: LayoutTeamSlugOrIdWorkspacesRoute,\ndiff --git a/apps/client/src/routes/_layout.$teamSlugOrId.previews.tsx b/apps/client/src/routes/_layout.$teamSlugOrId.previews.tsx\nnew file mode 100644\nindex 000000000..b763addfd\n--- /dev/null\n+++ b/apps/client/src/routes/_layout.$teamSlugOrId.previews.tsx\n@@ -0,0 +1,57 @@\n+import { TaskTree } from \"@/components/TaskTree\";\n+import { TaskTreeSkeleton } from \"@/components/TaskTreeSkeleton\";\n+import { FloatingPane } from \"@/components/floating-pane\";\n+import { convexQueryClient } from \"@/contexts/convex/convex-query-client\";\n+import { useExpandTasks } from \"@/contexts/expand-tasks/ExpandTasksContext\";\n+import { api } from \"@cmux/convex/api\";\n+import { convexQuery } from \"@convex-dev/react-query\";\n+import { createFileRoute } from \"@tanstack/react-router\";\n+import { useQuery } from \"convex/react\";\n+\n+export const Route = createFileRoute(\"/_layout/$teamSlugOrId/previews\")({\n+  component: PreviewsRoute,\n+  loader: async ({ params }) => {\n+    const { teamSlugOrId } = params;\n+    void convexQueryClient.queryClient.ensureQueryData(\n+      convexQuery(api.tasks.getPreviewTasks, { teamSlugOrId })\n+    );\n+  },\n+});\n+\n+function PreviewsRoute() {\n+  const { teamSlugOrId } = Route.useParams();\n+  const tasks = useQuery(api.tasks.getPreviewTasks, { teamSlugOrId });\n+  const { expandTaskIds } = useExpandTasks();\n+\n+  return (\n+    <FloatingPane>\n+      <div className=\"grow h-full flex flex-col\">\n+        <div className=\"border-b border-neutral-200 px-6 py-4 dark:border-neutral-800\">\n+          <h1 className=\"text-base font-semibold text-neutral-900 dark:text-neutral-100 select-none\">\n+            Previews\n+          </h1>\n+        </div>\n+        <div className=\"overflow-y-auto px-4 pb-6\">\n+          {tasks === undefined ? (\n+            <TaskTreeSkeleton count={10} />\n+          ) : tasks.length === 0 ? (\n+            <p className=\"mt-6 text-sm text-neutral-500 dark:text-neutral-400 select-none\">\n+              No preview runs yet.\n+            </p>\n+          ) : (\n+            <div className=\"mt-2 space-y-1\">\n+              {tasks.map((task) => (\n+                <TaskTree\n+                  key={task._id}\n+                  task={task}\n+                  defaultExpanded={expandTaskIds?.includes(task._id) ?? false}\n+                  teamSlugOrId={teamSlugOrId}\n+                />\n+              ))}\n+            </div>\n+          )}\n+        </div>\n+      </div>\n+    </FloatingPane>\n+  );\n+}\ndiff --git a/packages/convex/convex/github_webhook.ts b/packages/convex/convex/github_webhook.ts\nindex d53d77f1e..d1890fd01 100644\n--- a/packages/convex/convex/github_webhook.ts\n+++ b/packages/convex/convex/github_webhook.ts\n@@ -559,11 +559,13 @@ export const githubWebhook = httpAction(async (_ctx, req) => {\n \n               if (prNumber && prUrl && headSha) {\n                 try {\n+                  // Use previewConfig.teamId instead of connection's teamId\n+                  // The previewConfig was set up with a specific team, so we should use that\n                   const runId = await _ctx.runMutation(\n                     internal.previewRuns.enqueueFromWebhook,\n                     {\n                       previewConfigId: previewConfig._id,\n-                      teamId,\n+                      teamId: previewConfig.teamId,\n                       repoFullName,\n                       repoInstallationId: installation,\n                       prNumber,\n@@ -607,7 +609,7 @@ export const githubWebhook = httpAction(async (_ctx, req) => {\n                     const taskId = await _ctx.runMutation(\n                       internal.tasks.createForPreview,\n                       {\n-                        teamId,\n+                        teamId: previewConfig.teamId,\n                         userId: previewConfig.createdByUserId,\n                         previewRunId: runId,\n                         repoFullName,\n@@ -622,7 +624,7 @@ export const githubWebhook = httpAction(async (_ctx, req) => {\n                       internal.taskRuns.createForPreview,\n                       {\n                         taskId,\n-                        teamId,\n+                        teamId: previewConfig.teamId,\n                         userId: previewConfig.createdByUserId,\n                         prUrl,\n                         environmentId: previewConfig.environmentId,\ndiff --git a/packages/convex/convex/previewRuns.ts b/packages/convex/convex/previewRuns.ts\nindex 6b7a197a6..f89b12955 100644\n--- a/packages/convex/convex/previewRuns.ts\n+++ b/packages/convex/convex/previewRuns.ts\n@@ -1,6 +1,7 @@\n import { v } from \"convex/values\";\n import { resolveTeamIdLoose } from \"../_shared/team\";\n import { internal } from \"./_generated/api\";\n+import type { Id } from \"./_generated/dataModel\";\n import { authMutation, authQuery } from \"./users/utils\";\n import { internalMutation, internalQuery } from \"./_generated/server\";\n \n@@ -433,6 +434,60 @@ export const listByConfig = authQuery({\n   },\n });\n \n+export const listByTeam = authQuery({\n+  args: {\n+    teamSlugOrId: v.string(),\n+    limit: v.optional(v.number()),\n+  },\n+  handler: async (ctx, args) => {\n+    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const take = Math.max(1, Math.min(args.limit ?? 50, 100));\n+    const runs = await ctx.db\n+      .query(\"previewRuns\")\n+      .withIndex(\"by_team_created\", (q) => q.eq(\"teamId\", teamId))\n+      .order(\"desc\")\n+      .take(take * 2); // Fetch extra to account for filtered archived tasks\n+\n+    // Enrich with config repo name and taskId from linked taskRun\n+    // Also filter out runs whose linked task is archived\n+    const enrichedRuns: Array<\n+      (typeof runs)[number] & {\n+        configRepoFullName?: string;\n+        taskId?: Id<\"tasks\">;\n+      }\n+    > = [];\n+\n+    for (const run of runs) {\n+      if (enrichedRuns.length >= take) break;\n+\n+      const config = await ctx.db.get(run.previewConfigId);\n+      let taskId = undefined;\n+      let isTaskArchived = false;\n+\n+      if (run.taskRunId) {\n+        const taskRun = await ctx.db.get(run.taskRunId);\n+        if (taskRun) {\n+          taskId = taskRun.taskId;\n+          // Check if the linked task is archived\n+          const task = await ctx.db.get(taskRun.taskId);\n+          isTaskArchived = task?.isArchived === true;\n+        }\n+      }\n+\n+      // Skip runs whose linked task is archived\n+      if (isTaskArchived) continue;\n+\n+      enrichedRuns.push({\n+        ...run,\n+        configRepoFullName: config?.repoFullName,\n+        taskId,\n+      });\n+    }\n+\n+    return enrichedRuns;\n+  },\n+});\n+\n /**\n  * Create a preview run manually (for local preview scripts).\n  * Follows the same flow as the GitHub webhook handler:\ndiff --git a/packages/convex/convex/schema.ts b/packages/convex/convex/schema.ts\nindex 7f47c995b..e69bc61e0 100644\n--- a/packages/convex/convex/schema.ts\n+++ b/packages/convex/convex/schema.ts\n@@ -163,7 +163,8 @@ const convexSchema = defineSchema({\n     .index(\"by_created\", [\"createdAt\"])\n     .index(\"by_user\", [\"userId\", \"createdAt\"])\n     .index(\"by_team_user\", [\"teamId\", \"userId\"])\n-    .index(\"by_pinned\", [\"pinned\", \"teamId\", \"userId\"]),\n+    .index(\"by_pinned\", [\"pinned\", \"teamId\", \"userId\"])\n+    .index(\"by_team_user_preview\", [\"teamId\", \"userId\", \"isPreview\"]),\n \n   taskRuns: defineTable({\n     taskId: v.id(\"tasks\"),\ndiff --git a/packages/convex/convex/tasks.ts b/packages/convex/convex/tasks.ts\nindex 7861207ff..769f65250 100644\n--- a/packages/convex/convex/tasks.ts\n+++ b/packages/convex/convex/tasks.ts\n@@ -26,6 +26,9 @@ export const get = authQuery({\n       q = q.filter((qq) => qq.neq(qq.field(\"isArchived\"), true));\n     }\n \n+    // Exclude preview tasks from the main tasks list\n+    q = q.filter((qq) => qq.neq(qq.field(\"isPreview\"), true));\n+\n     if (args.projectFullName) {\n       q = q.filter((qq) =>\n         qq.eq(qq.field(\"projectFullName\"), args.projectFullName),\n@@ -38,6 +41,40 @@ export const get = authQuery({\n   },\n });\n \n+export const getPreviewTasks = authQuery({\n+  args: {\n+    teamSlugOrId: v.string(),\n+    limit: v.optional(v.number()),\n+  },\n+  handler: async (ctx, args) => {\n+    const userId = ctx.identity.subject;\n+    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const take = Math.max(1, Math.min(args.limit ?? 50, 100));\n+\n+    // Get preview tasks using the dedicated index\n+    const tasks = await ctx.db\n+      .query(\"tasks\")\n+      .withIndex(\"by_team_user_preview\", (idx) =>\n+        idx.eq(\"teamId\", teamId).eq(\"userId\", userId).eq(\"isPreview\", true),\n+      )\n+      .filter((q) => q.neq(q.field(\"isArchived\"), true))\n+      .collect();\n+\n+    // Sort: in-progress (not completed) first, then by createdAt desc\n+    const sorted = tasks.sort((a, b) => {\n+      // In-progress first\n+      const aInProgress = !a.isCompleted;\n+      const bInProgress = !b.isCompleted;\n+      if (aInProgress && !bInProgress) return -1;\n+      if (!aInProgress && bInProgress) return 1;\n+      // Then by createdAt desc\n+      return (b.createdAt ?? 0) - (a.createdAt ?? 0);\n+    });\n+\n+    return sorted.slice(0, take);\n+  },\n+});\n+\n export const getPinned = authQuery({\n   args: {\n     teamSlugOrId: v.string(),\n@@ -46,13 +83,14 @@ export const getPinned = authQuery({\n     const userId = ctx.identity.subject;\n     const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n \n-    // Get pinned tasks\n+    // Get pinned tasks (excluding archived and preview tasks)\n     const pinnedTasks = await ctx.db\n       .query(\"tasks\")\n       .withIndex(\"by_pinned\", (idx) =>\n         idx.eq(\"pinned\", true).eq(\"teamId\", teamId).eq(\"userId\", userId),\n       )\n       .filter((q) => q.neq(q.field(\"isArchived\"), true))\n+      .filter((q) => q.neq(q.field(\"isPreview\"), true))\n       .collect();\n \n     return pinnedTasks.sort((a, b) => (b.updatedAt ?? 0) - (a.updatedAt ?? 0));\n@@ -80,6 +118,9 @@ export const getTasksWithTaskRuns = authQuery({\n       q = q.filter((qq) => qq.neq(qq.field(\"isArchived\"), true));\n     }\n \n+    // Exclude preview tasks from the main tasks list\n+    q = q.filter((qq) => qq.neq(qq.field(\"isPreview\"), true));\n+\n     if (args.projectFullName) {\n       q = q.filter((qq) =>\n         qq.eq(qq.field(\"projectFullName\"), args.projectFullName),\n@@ -849,6 +890,7 @@ export const createForPreview = internalMutation({\n       baseBranch: args.baseBranch,\n       worktreePath: undefined,\n       isCompleted: false,\n+      isPreview: true,\n       createdAt: now,\n       updatedAt: now,\n       images: undefined,\n","comments":[{"type":"issue_comment","id":3593616720,"prNumber":1088,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n[Open Workspace](https://cmux.dev/austin-dev/task/kn7bwcrrsmffjfwqnepn9009x97wdrkz) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1088)\n\n## Preview Screenshots\n\nSuccessfully captured 8 screenshot(s) for commit `23ab721`:\n\n### 01-dashboard-tasks-tab-full-page.png\n![01-dashboard-tasks-tab-full-page.png](https://famous-camel-162.convex.cloud/api/storage/eb0d2d12-7b8f-43cb-9c2e-fdfbd45d954b)\n\n### 02-dashboard-tasks-tab-tabs-area.png\n![02-dashboard-tasks-tab-tabs-area.png](https://famous-camel-162.convex.cloud/api/storage/c02abd55-0430-41ab-9c27-81612d6b385c)\n\n### 03-dashboard-previews-tab-full-page.png\n![03-dashboard-previews-tab-full-page.png](https://famous-camel-162.convex.cloud/api/storage/e976411b-d1af-4dbb-bafd-39bab7a3b7d2)\n\n### 04-dashboard-previews-tab-tabs-area.png\n![04-dashboard-previews-tab-tabs-area.png](https://famous-camel-162.convex.cloud/api/storage/5ef47860-e204-4bc9-95bf-6ba5c56e686f)\n\n### 05-previews-completed-section-header.png\n![05-previews-completed-section-header.png](https://famous-camel-162.convex.cloud/api/storage/04cccdc0-8245-42db-b4b8-9ea051d61d20)\n\n### 06-previews-in-progress-section-header.png\n![06-previews-in-progress-section-header.png](https://famous-camel-162.convex.cloud/api/storage/5ad5f42f-7c27-4da8-b0ab-76270337759e)\n\n### 07-preview-item-with-hover-state.png\n![07-preview-item-with-hover-state.png](https://famous-camel-162.convex.cloud/api/storage/8870177c-2363-45f5-b3cc-d5173bb1baea)\n\n### 08-preview-item-in-progress-with-hover.png\n![08-preview-item-in-progress-with-hover.png](https://famous-camel-162.convex.cloud/api/storage/2d162b54-8bac-46b3-9ba0-354cb567539e)\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_\n\n</details>","commitSha":"c801f75546b1a05193462271cbe1e5a8188cfd72","createdAt":"2025-11-30T22:11:00Z","updatedAt":"2025-12-01T07:01:10Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1088#issuecomment-3593616720"},{"type":"issue_comment","id":3594041863,"prNumber":1088,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n[Open Workspace](https://cmux.sh/manaflow/task/kn71h98pcw46d7jjr1y13zc91x7weyrk) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1088)\n\n## Preview Screenshots\n\nSuccessfully captured 8 screenshot(s) for commit `2a221e1`:\n\n### collapsed-completed-section.png\n![collapsed-completed-section.png](https://adorable-wombat-701.convex.cloud/api/storage/f631a269-1b47-4011-b49e-e766cec75cae)\n\n### completed-section-header.png\n![completed-section-header.png](https://adorable-wombat-701.convex.cloud/api/storage/81352ab8-fa27-40da-be13-ce7b3ae6a6fa)\n\n### dashboard-previews-tab-full-page.png\n![dashboard-previews-tab-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/a3ec8020-7ca6-461b-b5c2-612a30dc3618)\n\n### dashboard-tasks-tab.png\n![dashboard-tasks-tab.png](https://adorable-wombat-701.convex.cloud/api/storage/f4fb6a46-7453-45f2-97a9-bfdd2b37fe6c)\n\n### in-progress-section-empty-state.png\n![in-progress-section-empty-state.png](https://adorable-wombat-701.convex.cloud/api/storage/1e8f43b0-0e83-4345-9c4c-d3bbf1b6a6d6)\n\n### preview-item-hover-state.png\n![preview-item-hover-state.png](https://adorable-wombat-701.convex.cloud/api/storage/95541890-7523-4ae2-ab47-3fb7b3ea8d96)\n\n### preview-item-with-status-indicator.png\n![preview-item-with-status-indicator.png](https://adorable-wombat-701.convex.cloud/api/storage/7c49290f-575d-4818-9525-ec631448f9c7)\n\n### tab-navigation.png\n![tab-navigation.png](https://adorable-wombat-701.convex.cloud/api/storage/2fc12392-648b-42a0-b49a-994a299bacc5)\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"c801f75546b1a05193462271cbe1e5a8188cfd72","createdAt":"2025-12-01T00:32:26Z","updatedAt":"2025-12-01T07:01:11Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1088#issuecomment-3594041863"},{"type":"issue_comment","id":3594528062,"prNumber":1088,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n[Open Workspace](https://cmux.sh/manaflow/task/kn7d8bt7s1535ek7edcx3b0swn7wfxw5) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1088)\n\n## Preview Screenshots\n\nSuccessfully captured 1 screenshot(s) for commit `640a72e`:\n\n### dashboard-tasks-tab.png\n![dashboard-tasks-tab.png](https://adorable-wombat-701.convex.cloud/api/storage/646f905d-9380-4b9c-b38f-9fda1d81fafc)\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"c801f75546b1a05193462271cbe1e5a8188cfd72","createdAt":"2025-12-01T04:52:16Z","updatedAt":"2025-12-01T07:01:12Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1088#issuecomment-3594528062"},{"type":"issue_comment","id":3594882025,"prNumber":1088,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n[Open Workspace](https://cmux.sh/austin-dev/task/kn7f43hm5nmmg7yqngjcx5qs7s7wex1n) (expires in 30m) • [Open in GitHub](https://0github.com/manaflow-ai/cmux/pull/1088)\n\nCaptured 3 screenshots for commit `2a3fa13` (2025-12-01 07:01:06.957 UTC).\n\n**Dashboard before the PR changes, showing only 'Tasks' and 'Archived' tabs**\n\n![dashboard-tasks-tab-before-change.png](https://famous-camel-162.convex.cloud/api/storage/ccce55c8-b2fd-41c5-b8dd-cbd5a0628779)\n\n**Dashboard showing the new tab navigation with 'Tasks', 'Previews', and 'Archived' tabs visible**\n\n![dashboard-tasks-tab.png](https://famous-camel-162.convex.cloud/api/storage/9b7f1d2f-fd91-4543-9d41-d6b0e72d0c7e)\n\n**Previews tab error state due to Convex connection issue (shows the tab exists but cannot load data without backend)**\n\n![previews-tab-error-state.png](https://famous-camel-162.convex.cloud/api/storage/2b873b2e-482d-494d-9bdd-4f931c1b8863)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"c801f75546b1a05193462271cbe1e5a8188cfd72","createdAt":"2025-12-01T07:01:09Z","updatedAt":"2025-12-01T07:52:38Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1088#issuecomment-3594882025"},{"type":"issue_comment","id":3595094114,"prNumber":1088,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n[Open Workspace](https://cmux.sh/austin-dev/task/kn78xw73g3h7mxabsdt89b00v97wehr8?src=preview.new) • [Open Dev Browser](https://cmux.sh/austin-dev/task/kn78xw73g3h7mxabsdt89b00v97wehr8/browser?src=preview.new) • [Open Diff Heatmap](https://0github.com/manaflow-ai/cmux/pull/1088?src=preview.new) (expires in 30m)\n\nCaptured 10 screenshots for commit `dfefea5` (2025-12-01 07:52:36.487 UTC).\n\n![dashboard-tab-buttons-area.png](https://famous-camel-162.convex.cloud/api/storage/984731a8-a000-411b-9181-d72a31036aab)\n\n![dashboard-tasks-tab-before.png](https://famous-camel-162.convex.cloud/api/storage/b5d2be48-f694-4a3b-a844-3df789c75123)\n\n**Final view of the Tasks tab for comparison, showing the traditional task categories (Pinned, Workspaces, Ready to review, In progress, Merged)**\n\n![dashboard-tasks-tab-final.png](https://famous-camel-162.convex.cloud/api/storage/ec308727-e8f8-412e-8202-8b4df2272023)\n\n**Dashboard with the new 'Previews' tab button added between 'Tasks' and 'Archived' tabs**\n\n![dashboard-tasks-tab-with-new-previews-button.png](https://famous-camel-162.convex.cloud/api/storage/3f96460b-89eb-42f6-a79a-70043f7c04e8)\n\n**Initial error state showing missing Convex backend function (previewRuns:listByTeam) - this was resolved by adding the missing function**\n\n![error-missing-convex-function.png](https://famous-camel-162.convex.cloud/api/storage/dd624420-3758-4b88-87f1-8c6ec942be42)\n\n**Close-up view of the three tab buttons: Tasks, Previews, and Archived**\n\n![previews-tab-buttons-closeup.png](https://famous-camel-162.convex.cloud/api/storage/77c4f11b-9d4c-4d4b-bae1-fa899e063301)\n\n**Previews tab with 'Completed' section collapsed, showing only the 'In Progress' section with 2 preview runs**\n\n![previews-tab-completed-collapsed.png](https://famous-camel-162.convex.cloud/api/storage/998f85ac-5b58-4190-b27b-96a7cd5a7b33)\n\n**Previews tab with 'In Progress' section collapsed, showing only the 'Completed' section expanded**\n\n![previews-tab-in-progress-collapsed.png](https://famous-camel-162.convex.cloud/api/storage/4c871884-73ce-4cac-b3d5-29e56674574d)\n\n**Previews tab showing preview items with action buttons (Copy PR URL and Open PR) that appear for each preview run**\n\n![previews-tab-showing-action-buttons.png](https://famous-camel-162.convex.cloud/api/storage/89fdf080-3d63-4b00-9df3-dec7986d9468)\n\n**Previews tab showing two collapsible sections: 'In Progress' (2 items) and 'Completed' (10 items) with preview run items displaying PR numbers, branch names, repo names, and timestamps**\n\n![previews-tab-with-in-progress-and-completed-sections.png](https://famous-camel-162.convex.cloud/api/storage/46132660-a2dc-44cf-8fc7-5f526a51db4d)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"c801f75546b1a05193462271cbe1e5a8188cfd72","createdAt":"2025-12-01T07:52:37Z","updatedAt":"2025-12-01T22:51:10Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1088#issuecomment-3595094114"},{"type":"issue_comment","id":3599296361,"prNumber":1088,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\nCaptured 8 screenshots for commit `89f8076` (2025-12-01 22:51:06.337 UTC).\n\n**Close-up of Completed section showing preview runs with filled green circle status indicators**\n\n![completed-section-closeup.png](https://famous-camel-162.convex.cloud/api/storage/25a6b762-cc75-44b6-a8b9-7a2cb6701076)\n\n![dashboard-full-page.png](https://famous-camel-162.convex.cloud/api/storage/2123921d-f1f4-4abb-b8ff-b6f305f7e00e)\n\n**Full page screenshot of dashboard showing the new Previews section in the sidebar at the bottom**\n\n![dashboard-with-previews-sidebar-full.png](https://famous-camel-162.convex.cloud/api/storage/3d9d21c9-3850-4d75-9f70-4ff5e10907b8)\n\n**Close-up of In Progress section showing 3 preview runs with empty circle status indicators**\n\n![in-progress-section-closeup.png](https://famous-camel-162.convex.cloud/api/storage/9ff15323-f589-41aa-88c4-036e3f3251d2)\n\n**Preview items showing hover state with Copy PR URL and Open PR action buttons**\n\n![preview-item-with-hover-buttons.png](https://famous-camel-162.convex.cloud/api/storage/d83b9109-fa0e-48cc-a7c5-96730952f757)\n\n**Full page view of the new Previews tab showing In Progress and Completed categories**\n\n![previews-tab-full-page.png](https://famous-camel-162.convex.cloud/api/storage/d0e065b6-6a2a-4bfd-89d1-f20721bb1b41)\n\n**Viewport screenshot of the Previews tab with categorized preview runs**\n\n![previews-tab-viewport.png](https://famous-camel-162.convex.cloud/api/storage/72ddb309-f656-4f63-a3b7-11d2c561960a)\n\n**Close-up of the sidebar Previews section showing multiple PR entries with status indicators**\n\n![sidebar-previews-section.png](https://famous-camel-162.convex.cloud/api/storage/b4bab3f3-84f9-4236-8080-c1b5e51fea5c)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"c801f75546b1a05193462271cbe1e5a8188cfd72","createdAt":"2025-12-01T22:51:09Z","updatedAt":"2025-12-01T22:58:02Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1088#issuecomment-3599296361"},{"type":"issue_comment","id":3599319250,"prNumber":1088,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\nCaptured 10 screenshots for commit `89f8076` (2025-12-01 22:57:58.875 UTC).\n\n![complete-sidebar-view.png](https://adorable-wombat-701.convex.cloud/api/storage/9aaa7f57-9749-43c6-a406-17884b642880)\n\n![completed-section.png](https://adorable-wombat-701.convex.cloud/api/storage/3f0de9ff-b911-48da-88f2-91775007133e)\n\n![dashboard-tasks-tab-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/14b9e510-66b5-437f-a304-cec97ae89e1a)\n\n![in-progress-section.png](https://adorable-wombat-701.convex.cloud/api/storage/0e764086-391a-4c03-ab5b-bcef48825f61)\n\n![preview-item-hover-state.png](https://adorable-wombat-701.convex.cloud/api/storage/130fc266-1059-4b8e-9050-7008b59dc41a)\n\n![preview-item-with-buttons.png](https://adorable-wombat-701.convex.cloud/api/storage/546ee08d-7614-4434-928e-7b5ff7fe22ab)\n\n![previews-tab-buttons.png](https://adorable-wombat-701.convex.cloud/api/storage/6f1de9f1-8617-474f-afc2-9eac80045e45)\n\n![previews-tab-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/78586922-4156-4c6c-b275-ff575cd7b0b3)\n\n![sidebar-previews-list-detail.png](https://adorable-wombat-701.convex.cloud/api/storage/ee862b97-a614-4b39-97cc-43a0b08514e5)\n\n![sidebar-with-previews-section.png](https://adorable-wombat-701.convex.cloud/api/storage/06a51c21-2582-4f79-a6b3-86a48f4a1a22)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"c801f75546b1a05193462271cbe1e5a8188cfd72","createdAt":"2025-12-01T22:58:01Z","updatedAt":"2025-12-01T23:45:44Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1088#issuecomment-3599319250"},{"type":"issue_comment","id":3599463496,"prNumber":1088,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n\n\nCaptured 16 screenshots for commit `835f15f` (2025-12-01 23:45:40.692 UTC).\n\n**Full dashboard page showing the new Previews section in the sidebar with multiple preview items listed**\n\n![dashboard-full-page-with-previews-sidebar.png](https://famous-camel-162.convex.cloud/api/storage/b186beda-11db-412b-bdf0-6da3f7e0dea2)\n\n**Preview item for PR #1040 in the Completed section**\n\n![preview-item-completed-pr1040.png](https://famous-camel-162.convex.cloud/api/storage/fb24d1f2-dbf8-4df6-a9f6-e54fae800ade)\n\n**Preview item for PR #1095 in the Completed section**\n\n![preview-item-completed-pr1095.png](https://famous-camel-162.convex.cloud/api/storage/c67bc452-0454-48fd-a5d8-467b347bf3e7)\n\n**Preview item for PR #1088 in the In Progress section**\n\n![preview-item-in-progress-pr1088.png](https://famous-camel-162.convex.cloud/api/storage/ba00676e-b36e-4833-84a6-8c3dfabeda90)\n\n**Preview item for PR #1095 in the In Progress section**\n\n![preview-item-in-progress-pr1095.png](https://famous-camel-162.convex.cloud/api/storage/5debec21-5d3c-4a76-8ac4-8001fdf359aa)\n\n**Detailed task view when clicking a preview item in the sidebar, showing workspace, terminal, browser panels and multiple preview port links**\n\n![preview-task-detail-view-pr1088-expanded.png](https://famous-camel-162.convex.cloud/api/storage/bec0d530-34ce-45a2-8418-d616ab49e555)\n\n**Sidebar showing an expanded preview task with links to VS Code, Git diff, Browser, Terminals, and multiple preview ports**\n\n![preview-task-expanded-in-sidebar.png](https://famous-camel-162.convex.cloud/api/storage/30a29e60-0210-4c70-b6ba-43aab8c174be)\n\n**Completed section header showing count of 17 items**\n\n![previews-completed-section-header.png](https://famous-camel-162.convex.cloud/api/storage/116cff98-c5cd-48b7-b286-f3d2b25e1177)\n\n**In Progress section header showing count of 3 items**\n\n![previews-in-progress-section-header.png](https://famous-camel-162.convex.cloud/api/storage/56d32c22-1191-4619-8b19-a88cc84e1613)\n\n**Full page view of the Previews tab showing In Progress (3 items) and Completed (17 items) sections**\n\n![previews-tab-full-page-with-in-progress-and-completed.png](https://famous-camel-162.convex.cloud/api/storage/6f484e4e-5d8b-4590-a7ad-12e73fdde61d)\n\n**Complete sidebar navigation showing Pull Requests, Workspaces, and the new Previews section**\n\n![sidebar-full-navigation-with-previews.png](https://famous-camel-162.convex.cloud/api/storage/997eaf11-8b3b-47a5-ad43-6d00b791c885)\n\n**Individual preview item for PR #1088 in the sidebar**\n\n![sidebar-preview-item-1088.png](https://famous-camel-162.convex.cloud/api/storage/b7381269-17cc-4414-875e-bbb15e865c5c)\n\n**Individual preview item for PR #1095 in the sidebar**\n\n![sidebar-preview-item-1095.png](https://famous-camel-162.convex.cloud/api/storage/339c194e-3551-43a8-b45d-719aa407d5f0)\n\n**Close-up of the Previews section header in the sidebar**\n\n![sidebar-previews-section-header.png](https://famous-camel-162.convex.cloud/api/storage/ffcc51bc-b55d-4688-a8cd-39b1ef7c4298)\n\n**Tab navigation buttons showing Tasks, Previews, and Archived tabs**\n\n![tab-navigation-tasks-previews-archived.png](https://famous-camel-162.convex.cloud/api/storage/23a8fc15-ac32-4c35-8598-8faef06e6d52)\n\n**Tasks tab view showing all three tab buttons (Tasks, Previews, Archived)**\n\n![tasks-tab-view-showing-tab-navigation.png](https://famous-camel-162.convex.cloud/api/storage/41973fc9-f071-4a9a-9d88-a9b71631485b)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"c801f75546b1a05193462271cbe1e5a8188cfd72","createdAt":"2025-12-01T23:45:43Z","updatedAt":"2025-12-01T23:45:43Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1088#issuecomment-3599463496"}]}
{"number":1087,"title":"Ensure rustup default in VM","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1087","headRef":"cmux/ensure-rustup-default-in-vm-cz61v","headSha":"f579498271e6e8784dae6bd5efbd7705afee8261","baseRef":"main","baseSha":"8a17189f88a3e44a1322e44b89c7c4912e6d3509","createdAt":"2025-11-30T21:55:16Z","updatedAt":"2025-11-30T21:58:40Z","diff":"diff --git a/scripts/snapshot.py b/scripts/snapshot.py\nindex 392cfead3..8e46d98ce 100644\n--- a/scripts/snapshot.py\n+++ b/scripts/snapshot.py\n@@ -1823,6 +1823,13 @@ async def task_configure_zsh(ctx: TaskContext) -> None:\n export CARGO_HOME=/usr/local/cargo\n export PATH=\"/usr/local/bin:/usr/local/cargo/bin:$HOME/.local/bin:$PATH\"\n EOF\n+        # Also add to /etc/environment for non-interactive sessions\n+        if ! grep -q 'RUSTUP_HOME=' /etc/environment 2>/dev/null; then\n+          echo 'RUSTUP_HOME=/usr/local/rustup' >> /etc/environment\n+        fi\n+        if ! grep -q 'CARGO_HOME=' /etc/environment 2>/dev/null; then\n+          echo 'CARGO_HOME=/usr/local/cargo' >> /etc/environment\n+        fi\n         if ! grep -q \"alias g='git'\" /root/.bashrc 2>/dev/null; then\n           echo \"alias g='git'\" >> /root/.bashrc\n         fi\n@@ -2230,6 +2237,9 @@ async def task_configure_envctl(ctx: TaskContext) -> None:\n         if ! grep -q 'XDG_RUNTIME_DIR=/run/user/0' /root/.zshrc 2>/dev/null; then\n           echo 'export XDG_RUNTIME_DIR=/run/user/0' >> /root/.zshrc\n         fi\n+        if ! grep -q 'cmux-paths.sh' /root/.zshrc 2>/dev/null; then\n+          echo '[ -f /etc/profile.d/cmux-paths.sh ] && . /etc/profile.d/cmux-paths.sh' >> /root/.zshrc\n+        fi\n         \"\"\"\n     )\n     await ctx.run(\"configure-envctl\", cmd)\n","comments":[{"type":"issue_comment","id":3593579885,"prNumber":1087,"botLogin":"cmux-agent-internal-dev[bot]","body":"[Open Workspace](https://cmux.dev/austin-dev/task/kn72akhmawm3w2qfyda40edv8d7wc6tc) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1087)\n\n## Preview Screenshots\n\nSuccessfully captured 1 screenshot(s) for commit `f579498`:\n\n### dashboard-initial-view.png\n![dashboard-initial-view.png](https://famous-camel-162.convex.cloud/api/storage/a60aff02-7653-4f3e-8f28-2f770c0c1daf)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"f579498271e6e8784dae6bd5efbd7705afee8261","createdAt":"2025-11-30T21:58:40Z","updatedAt":"2025-11-30T21:58:40Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1087#issuecomment-3593579885"}]}
{"number":1085,"title":"github link sign in flow","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1085","headRef":"cmux/clarify-sign-in-message-on-preview-page-8sujf","headSha":"fc6cc00d2bf66ea23a2b904afe34e9125acde184","baseRef":"main","baseSha":"f0a8d115d5d32e94bf06b22b1a1bf2b3a122c3c5","createdAt":"2025-11-30T21:52:39Z","updatedAt":"2025-11-30T22:08:47Z","diff":"diff --git a/apps/www/components/preview/preview-dashboard.tsx b/apps/www/components/preview/preview-dashboard.tsx\nindex de7caccc5..e737e3916 100644\n--- a/apps/www/components/preview/preview-dashboard.tsx\n+++ b/apps/www/components/preview/preview-dashboard.tsx\n@@ -190,27 +190,35 @@ export function PreviewDashboard({\n   );\n \n   const handleStartPreview = useCallback(async () => {\n-    if (!selectedTeamSlugOrIdState) {\n-      setErrorMessage(\"Select a team before continuing.\");\n-      return;\n-    }\n-\n     const repoName = parseGithubUrl(repoUrlInput);\n     if (!repoName) {\n       setErrorMessage(\"Please enter a valid GitHub URL or owner/repo\");\n       return;\n     }\n-    const params = new URLSearchParams({ repo: repoName });\n-    params.set(\"team\", selectedTeamSlugOrIdState);\n-    const configurePath = `/preview/configure?${params.toString()}`;\n \n+    // For unauthenticated users, redirect to sign-in without requiring team selection\n     if (!isAuthenticated) {\n+      const params = new URLSearchParams({ repo: repoName });\n+      // Include team if available, otherwise the configure page will handle it after sign-in\n+      if (selectedTeamSlugOrIdState) {\n+        params.set(\"team\", selectedTeamSlugOrIdState);\n+      }\n+      const configurePath = `/preview/configure?${params.toString()}`;\n       setErrorMessage(null);\n       setNavigatingRepo(\"__url_input__\");\n       window.location.href = `/handler/sign-in?after_auth_return_to=${encodeURIComponent(configurePath)}`;\n       return;\n     }\n \n+    if (!selectedTeamSlugOrIdState) {\n+      setErrorMessage(\"Select a team before continuing.\");\n+      return;\n+    }\n+\n+    const params = new URLSearchParams({ repo: repoName });\n+    params.set(\"team\", selectedTeamSlugOrIdState);\n+    const configurePath = `/preview/configure?${params.toString()}`;\n+\n     if (!hasGithubAppInstallation) {\n       setErrorMessage(null);\n       setIsInstallingApp(true);\n@@ -563,7 +571,7 @@ export function PreviewDashboard({\n           </div>\n           <Button\n             onClick={() => void handleStartPreview()}\n-            disabled={!repoUrlInput.trim() || navigatingRepo !== null || !selectedTeamSlugOrIdState}\n+            disabled={!repoUrlInput.trim() || navigatingRepo !== null || (isAuthenticated && !selectedTeamSlugOrIdState)}\n             className=\"h-10 px-4 rounded-none bg-white text-black hover:bg-neutral-200 text-sm font-medium\"\n           >\n             {navigatingRepo === \"__url_input__\" ? (\n@@ -575,7 +583,7 @@ export function PreviewDashboard({\n         </div>\n         {!isAuthenticated && (\n           <p className=\"text-xs text-neutral-500 mt-2\">\n-            Sign in to connect private repos.\n+            You&apos;ll be asked to sign in to continue.\n           </p>\n         )}\n         {errorMessage && (\n","comments":[{"type":"issue_comment","id":3593600500,"prNumber":1085,"botLogin":"cmux-agent[bot]","body":"[Open Workspace](https://cmux.sh/manaflow/task/kn7f47vgvsz2ny2rdrsq45haq57wcrsk) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1085)\n\n## Preview Screenshots\n\nSuccessfully captured 6 screenshot(s) for commit `fc6cc00`:\n\n### authenticated-state-full-page.png\n![authenticated-state-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/9f54e915-1a02-417d-af93-9c6722a6ee22)\n\n### sign-in-message-highlighted.png\n![sign-in-message-highlighted.png](https://adorable-wombat-701.convex.cloud/api/storage/73525dcd-9a83-436f-ad0c-e26ef4ae718a)\n\n### unauthenticated-button-enabled.png\n![unauthenticated-button-enabled.png](https://adorable-wombat-701.convex.cloud/api/storage/183e748b-82eb-478f-8cf1-57b14ac56028)\n\n### unauthenticated-complete-view.png\n![unauthenticated-complete-view.png](https://adorable-wombat-701.convex.cloud/api/storage/c7324a5f-2115-4612-9805-52a93a4b52cf)\n\n### unauthenticated-state-viewport.png\n![unauthenticated-state-viewport.png](https://adorable-wombat-701.convex.cloud/api/storage/2d7f0bd5-aeba-4515-9c96-b54be304af15)\n\n### unauthenticated-url-input-filled.png\n![unauthenticated-url-input-filled.png](https://adorable-wombat-701.convex.cloud/api/storage/c5ae4bfe-a0cf-42d0-81fc-9a38a44e94d9)\n\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"fc6cc00d2bf66ea23a2b904afe34e9125acde184","createdAt":"2025-11-30T22:05:38Z","updatedAt":"2025-11-30T22:05:38Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1085#issuecomment-3593600500"},{"type":"issue_comment","id":3593609626,"prNumber":1085,"botLogin":"cmux-agent-internal-dev[bot]","body":"[Open Workspace](https://cmux.dev/austin-dev/task/kn7513w821r2aame4rf7jm4we97wdqz4) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1085)\n\n## Preview Screenshots\n\nSuccessfully captured 5 screenshot(s) for commit `fc6cc00`:\n\n### preview-dashboard-full-page.png\n![preview-dashboard-full-page.png](https://famous-camel-162.convex.cloud/api/storage/8aad3d0b-c67c-4641-bcd2-470e0530523f)\n\n### preview-dashboard-unauthenticated-viewport.png\n![preview-dashboard-unauthenticated-viewport.png](https://famous-camel-162.convex.cloud/api/storage/6fd88b1f-d757-4769-8ce4-c8f4fee1a7c2)\n\n### unauthenticated-input-section-with-signin-message.png\n![unauthenticated-input-section-with-signin-message.png](https://famous-camel-162.convex.cloud/api/storage/51e85273-7c52-4fb1-bbef-55dc56e7aa38)\n\n### unauthenticated-repository-section.png\n![unauthenticated-repository-section.png](https://famous-camel-162.convex.cloud/api/storage/1a75826d-1fee-4e17-b400-bd75488eb574)\n\n### unauthenticated-with-url-entered-button-enabled.png\n![unauthenticated-with-url-entered-button-enabled.png](https://famous-camel-162.convex.cloud/api/storage/bce5c106-2660-4530-85c3-7e54cf0c02a4)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"fc6cc00d2bf66ea23a2b904afe34e9125acde184","createdAt":"2025-11-30T22:08:47Z","updatedAt":"2025-11-30T22:08:47Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1085#issuecomment-3593609626"}]}
{"number":1080,"title":"next16","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1080","headRef":"next16","headSha":"229b8c319b7f4a7b2d1b03dce5dba4908e9004ab","baseRef":"main","baseSha":"5da7a30d935d021d6f8a88f4397e8e63a9cb1d8e","createdAt":"2025-11-30T08:44:48Z","updatedAt":"2025-11-30T20:26:05Z","diff":"diff --git a/apps/www/.eslintignore b/apps/www/.eslintignore\ndeleted file mode 100644\nindex 04e86f5fe..000000000\n--- a/apps/www/.eslintignore\n+++ /dev/null\n@@ -1 +0,0 @@\n-scripts/pr-review/pr-review-inject.bundle.js\ndiff --git a/apps/www/.mcp.json b/apps/www/.mcp.json\nindex ed1280e21..fac280579 100644\n--- a/apps/www/.mcp.json\n+++ b/apps/www/.mcp.json\n@@ -1,7 +1,8 @@\n {\n   \"mcpServers\": {\n-    \"Sentry\": {\n-      \"url\": \"https://mcp.sentry.dev/mcp/manaflow/cmux-www\"\n+    \"next-devtools\": {\n+      \"command\": \"bunx\",\n+      \"args\": [\"next-devtools-mcp@latest\"]\n     }\n   }\n-}\n\\ No newline at end of file\n+}\ndiff --git a/apps/www/eslint.config.js b/apps/www/eslint.config.js\nindex a3c753639..179c36268 100644\n--- a/apps/www/eslint.config.js\n+++ b/apps/www/eslint.config.js\n@@ -1,20 +1,27 @@\n import { dirname } from \"node:path\";\n import { fileURLToPath } from \"node:url\";\n-import { FlatCompat } from \"@eslint/eslintrc\";\n import tseslint from \"typescript-eslint\";\n+import nextPlugin from \"@next/eslint-plugin-next\";\n+import reactHooks from \"eslint-plugin-react-hooks\";\n \n const __filename = fileURLToPath(import.meta.url);\n const __dirname = dirname(__filename);\n \n-const compat = new FlatCompat({\n-  baseDirectory: __dirname,\n-});\n-\n export default tseslint.config(\n-  // Next.js rules via compat\n-  ...compat.extends(\"next/core-web-vitals\"),\n   // TypeScript ESLint recommended (no type-checking required)\n   ...tseslint.configs.recommended,\n+  // React hooks rules\n+  reactHooks.configs[\"recommended-latest\"],\n+  // Next.js plugin rules\n+  {\n+    plugins: {\n+      \"@next/next\": nextPlugin,\n+    },\n+    rules: {\n+      ...nextPlugin.configs.recommended.rules,\n+      ...nextPlugin.configs[\"core-web-vitals\"].rules,\n+    },\n+  },\n   // Ensure TypeScript parser resolves the correct tsconfig root\n   {\n     languageOptions: {\ndiff --git a/apps/www/next.config.ts b/apps/www/next.config.ts\nindex 3e214696c..642442b7c 100644\n--- a/apps/www/next.config.ts\n+++ b/apps/www/next.config.ts\n@@ -7,17 +7,6 @@ const nextConfig: NextConfig = {\n   outputFileTracingIncludes: {\n     \"/\": [\"./scripts/pr-review/pr-review-inject.bundle.js\"],\n   },\n-  webpack: (config, { isServer }) => {\n-    if (isServer) {\n-      const externals = [\"morphcloud\", \"ssh2\", \"node-ssh\", \"cpu-features\"];\n-      config.externals = Array.isArray(config.externals)\n-        ? [...config.externals, ...externals]\n-        : config.externals\n-        ? [config.externals, ...externals]\n-        : externals;\n-    }\n-    return config;\n-  },\n   transpilePackages: [\n     \"@cmux/server\",\n     \"@cmux/shared\",\ndiff --git a/apps/www/package.json b/apps/www/package.json\nindex 8d0fc027d..b64fe13c9 100644\n--- a/apps/www/package.json\n+++ b/apps/www/package.json\n@@ -4,7 +4,7 @@\n   \"type\": \"module\",\n   \"private\": true,\n   \"scripts\": {\n-    \"dev\": \"dotenv -e ../../.env -- next dev --turbo --port 9779\",\n+    \"dev\": \"dotenv -e ../../.env -- next dev --port 9779\",\n     \"prebuild\": \"bun run generate-openapi-client\",\n     \"build\": \"./scripts/build.sh\",\n     \"start\": \"next start\",\n@@ -47,7 +47,7 @@\n     \"jose\": \"^6.1.0\",\n     \"lucide-react\": \"^0.460.0\",\n     \"morphcloud\": \"^0.0.18\",\n-    \"next\": \"15.5.2\",\n+    \"next\": \"^16.0.5\",\n     \"octokit\": \"^3.2.2\",\n     \"posthog-js\": \"^1.297.2\",\n     \"posthog-node\": \"^5.11.0\",\n@@ -64,7 +64,7 @@\n     \"@eslint/eslintrc\": \"^3\",\n     \"@hey-api/client-fetch\": \"^0.13.1\",\n     \"@hey-api/openapi-ts\": \"^0.82.1\",\n-    \"@next/eslint-plugin-next\": \"^15.5.2\",\n+    \"@next/eslint-plugin-next\": \"^16.0.5\",\n     \"@tailwindcss/postcss\": \"^4\",\n     \"@types/node\": \"^24.9.1\",\n     \"@types/react\": \"^19\",\n@@ -72,7 +72,7 @@\n     \"dotenv\": \"^16.4.5\",\n     \"dotenv-cli\": \"^10.0.0\",\n     \"eslint\": \"^9.33.0\",\n-    \"eslint-config-next\": \"15.5.0\",\n+    \"eslint-config-next\": \"^16.0.5\",\n     \"tailwindcss\": \"^4\",\n     \"typescript\": \"^5.9.3\",\n     \"typescript-eslint\": \"^8.38.0\",\ndiff --git a/apps/www/middleware.ts b/apps/www/proxy.ts\nsimilarity index 97%\nrename from apps/www/middleware.ts\nrename to apps/www/proxy.ts\nindex b4a9e51b4..105b7ae1e 100644\n--- a/apps/www/middleware.ts\n+++ b/apps/www/proxy.ts\n@@ -2,7 +2,7 @@ import { NextResponse } from \"next/server\";\n import type { NextRequest } from \"next/server\";\n import { env } from \"@/lib/utils/www-env\";\n \n-export function middleware(request: NextRequest) {\n+export function proxy(request: NextRequest) {\n   const { pathname } = request.nextUrl;\n   const hostname = request.nextUrl.hostname;\n \ndiff --git a/bun.lock b/bun.lock\nindex 444eeb758..3856289b8 100644\n--- a/bun.lock\n+++ b/bun.lock\n@@ -35,7 +35,7 @@\n     },\n     \"apps/client\": {\n       \"name\": \"@cmux/client\",\n-      \"version\": \"1.0.179\",\n+      \"version\": \"1.0.181\",\n       \"dependencies\": {\n         \"@base-ui-components/react\": \"1.0.0-beta.2\",\n         \"@cmux/convex\": \"workspace:*\",\n@@ -339,7 +339,7 @@\n         \"jose\": \"^6.1.0\",\n         \"lucide-react\": \"^0.460.0\",\n         \"morphcloud\": \"^0.0.18\",\n-        \"next\": \"15.5.2\",\n+        \"next\": \"^16.0.5\",\n         \"octokit\": \"^3.2.2\",\n         \"posthog-js\": \"^1.297.2\",\n         \"posthog-node\": \"^5.11.0\",\n@@ -356,7 +356,7 @@\n         \"@eslint/eslintrc\": \"^3\",\n         \"@hey-api/client-fetch\": \"^0.13.1\",\n         \"@hey-api/openapi-ts\": \"^0.82.1\",\n-        \"@next/eslint-plugin-next\": \"^15.5.2\",\n+        \"@next/eslint-plugin-next\": \"^16.0.5\",\n         \"@tailwindcss/postcss\": \"^4\",\n         \"@types/node\": \"^24.9.1\",\n         \"@types/react\": \"^19\",\n@@ -364,7 +364,7 @@\n         \"dotenv\": \"^16.4.5\",\n         \"dotenv-cli\": \"^10.0.0\",\n         \"eslint\": \"^9.33.0\",\n-        \"eslint-config-next\": \"15.5.0\",\n+        \"eslint-config-next\": \"^16.0.5\",\n         \"tailwindcss\": \"^4\",\n         \"typescript\": \"^5.9.3\",\n         \"typescript-eslint\": \"^8.38.0\",\n@@ -1348,25 +1348,25 @@\n \n     \"@napi-rs/wasm-runtime\": [\"@napi-rs/wasm-runtime@1.0.5\", \"\", { \"dependencies\": { \"@emnapi/core\": \"^1.5.0\", \"@emnapi/runtime\": \"^1.5.0\", \"@tybys/wasm-util\": \"^0.10.1\" } }, \"sha512-TBr9Cf9onSAS2LQ2+QHx6XcC6h9+RIzJgbqG3++9TUZSH204AwEy5jg3BTQ0VATsyoGj4ee49tN/y6rvaOOtcg==\"],\n \n-    \"@next/env\": [\"@next/env@15.5.2\", \"\", {}, \"sha512-Qe06ew4zt12LeO6N7j8/nULSOe3fMXE4dM6xgpBQNvdzyK1sv5y4oAP3bq4LamrvGCZtmRYnW8URFCeX5nFgGg==\"],\n+    \"@next/env\": [\"@next/env@16.0.5\", \"\", {}, \"sha512-jRLOw822AE6aaIm9oh0NrauZEM0Vtx5xhYPgqx89txUmv/UmcRwpcXmGeQOvYNT/1bakUwA+nG5CA74upYVVDw==\"],\n \n-    \"@next/eslint-plugin-next\": [\"@next/eslint-plugin-next@15.5.3\", \"\", { \"dependencies\": { \"fast-glob\": \"3.3.1\" } }, \"sha512-SdhaKdko6dpsSr0DldkESItVrnPYB1NS2NpShCSX5lc7SSQmLZt5Mug6t2xbiuVWEVDLZSuIAoQyYVBYp0dR5g==\"],\n+    \"@next/eslint-plugin-next\": [\"@next/eslint-plugin-next@16.0.5\", \"\", { \"dependencies\": { \"fast-glob\": \"3.3.1\" } }, \"sha512-m1zPz6hsBvQt1CMRz7rTga8OXpRE9rVW4JHCSjW+tswTxiEU+6ev+GTlgm7ZzcCiMEVQAHTNhpEGFzDtVha9qg==\"],\n \n-    \"@next/swc-darwin-arm64\": [\"@next/swc-darwin-arm64@15.5.2\", \"\", { \"os\": \"darwin\", \"cpu\": \"arm64\" }, \"sha512-8bGt577BXGSd4iqFygmzIfTYizHb0LGWqH+qgIF/2EDxS5JsSdERJKA8WgwDyNBZgTIIA4D8qUtoQHmxIIquoQ==\"],\n+    \"@next/swc-darwin-arm64\": [\"@next/swc-darwin-arm64@16.0.5\", \"\", { \"os\": \"darwin\", \"cpu\": \"arm64\" }, \"sha512-65Mfo1rD+mVbJuBTlXbNelNOJ5ef+5pskifpFHsUt3cnOWjDNKctHBwwSz9tJlPp7qADZtiN/sdcG7mnc0El8Q==\"],\n \n-    \"@next/swc-darwin-x64\": [\"@next/swc-darwin-x64@15.5.2\", \"\", { \"os\": \"darwin\", \"cpu\": \"x64\" }, \"sha512-2DjnmR6JHK4X+dgTXt5/sOCu/7yPtqpYt8s8hLkHFK3MGkka2snTv3yRMdHvuRtJVkPwCGsvBSwmoQCHatauFQ==\"],\n+    \"@next/swc-darwin-x64\": [\"@next/swc-darwin-x64@16.0.5\", \"\", { \"os\": \"darwin\", \"cpu\": \"x64\" }, \"sha512-2fDzXD/JpEjY500VUF0uuGq3YZcpC6XxmGabePPLyHCKbw/YXRugv3MRHH7MxE2hVHtryXeSYYnxcESb/3OUIQ==\"],\n \n-    \"@next/swc-linux-arm64-gnu\": [\"@next/swc-linux-arm64-gnu@15.5.2\", \"\", { \"os\": \"linux\", \"cpu\": \"arm64\" }, \"sha512-3j7SWDBS2Wov/L9q0mFJtEvQ5miIqfO4l7d2m9Mo06ddsgUK8gWfHGgbjdFlCp2Ek7MmMQZSxpGFqcC8zGh2AA==\"],\n+    \"@next/swc-linux-arm64-gnu\": [\"@next/swc-linux-arm64-gnu@16.0.5\", \"\", { \"os\": \"linux\", \"cpu\": \"arm64\" }, \"sha512-meSLB52fw4tgDpPnyuhwA280EWLwwIntrxLYjzKU3e3730ur2WJAmmqoZ1LPIZ2l3eDfh9SBHnJGTczbgPeNeA==\"],\n \n-    \"@next/swc-linux-arm64-musl\": [\"@next/swc-linux-arm64-musl@15.5.2\", \"\", { \"os\": \"linux\", \"cpu\": \"arm64\" }, \"sha512-s6N8k8dF9YGc5T01UPQ08yxsK6fUow5gG1/axWc1HVVBYQBgOjca4oUZF7s4p+kwhkB1bDSGR8QznWrFZ/Rt5g==\"],\n+    \"@next/swc-linux-arm64-musl\": [\"@next/swc-linux-arm64-musl@16.0.5\", \"\", { \"os\": \"linux\", \"cpu\": \"arm64\" }, \"sha512-aAJtQkvUzz5t0xVAmK931SIhWnSQAaEoTyG/sKPCYq2u835K/E4a14A+WRPd4dkhxIHNudE8dI+FpHekgdrA4g==\"],\n \n-    \"@next/swc-linux-x64-gnu\": [\"@next/swc-linux-x64-gnu@15.5.2\", \"\", { \"os\": \"linux\", \"cpu\": \"x64\" }, \"sha512-o1RV/KOODQh6dM6ZRJGZbc+MOAHww33Vbs5JC9Mp1gDk8cpEO+cYC/l7rweiEalkSm5/1WGa4zY7xrNwObN4+Q==\"],\n+    \"@next/swc-linux-x64-gnu\": [\"@next/swc-linux-x64-gnu@16.0.5\", \"\", { \"os\": \"linux\", \"cpu\": \"x64\" }, \"sha512-bYwbjBwooMWRhy6vRxenaYdguTM2hlxFt1QBnUF235zTnU2DhGpETm5WU93UvtAy0uhC5Kgqsl8RyNXlprFJ6Q==\"],\n \n-    \"@next/swc-linux-x64-musl\": [\"@next/swc-linux-x64-musl@15.5.2\", \"\", { \"os\": \"linux\", \"cpu\": \"x64\" }, \"sha512-/VUnh7w8RElYZ0IV83nUcP/J4KJ6LLYliiBIri3p3aW2giF+PAVgZb6mk8jbQSB3WlTai8gEmCAr7kptFa1H6g==\"],\n+    \"@next/swc-linux-x64-musl\": [\"@next/swc-linux-x64-musl@16.0.5\", \"\", { \"os\": \"linux\", \"cpu\": \"x64\" }, \"sha512-iGv2K/4gW3mkzh+VcZTf2gEGX5o9xdb5oPqHjgZvHdVzCw0iSAJ7n9vKzl3SIEIIHZmqRsgNasgoLd0cxaD+tg==\"],\n \n-    \"@next/swc-win32-arm64-msvc\": [\"@next/swc-win32-arm64-msvc@15.5.2\", \"\", { \"os\": \"win32\", \"cpu\": \"arm64\" }, \"sha512-sMPyTvRcNKXseNQ/7qRfVRLa0VhR0esmQ29DD6pqvG71+JdVnESJaHPA8t7bc67KD5spP3+DOCNLhqlEI2ZgQg==\"],\n+    \"@next/swc-win32-arm64-msvc\": [\"@next/swc-win32-arm64-msvc@16.0.5\", \"\", { \"os\": \"win32\", \"cpu\": \"arm64\" }, \"sha512-6xf52Hp4SH9+4jbYmfUleqkuxvdB9JJRwwFlVG38UDuEGPqpIA+0KiJEU9lxvb0RGNo2i2ZUhc5LHajij9H9+A==\"],\n \n-    \"@next/swc-win32-x64-msvc\": [\"@next/swc-win32-x64-msvc@15.5.2\", \"\", { \"os\": \"win32\", \"cpu\": \"x64\" }, \"sha512-W5VvyZHnxG/2ukhZF/9Ikdra5fdNftxI6ybeVKYvBPDtyx7x4jPPSNduUkfH5fo3zG0JQ0bPxgy41af2JX5D4Q==\"],\n+    \"@next/swc-win32-x64-msvc\": [\"@next/swc-win32-x64-msvc@16.0.5\", \"\", { \"os\": \"win32\", \"cpu\": \"x64\" }, \"sha512-06kTaOh+Qy/kguN+MMK+/VtKmRkQJrPlGQMvCUbABk1UxI5SKTgJhbmMj9Hf0qWwrS6g9JM6/Zk+etqeMyvHAw==\"],\n \n     \"@noble/hashes\": [\"@noble/hashes@2.0.1\", \"\", {}, \"sha512-XlOlEbQcE9fmuXxrVTXCTlG2nlRXa9Rj3rr5Ue/+tX+nmkgbX720YHh0VR3hBF9xDvwnb8D2shVGOwNx+ulArw==\"],\n \n@@ -2038,8 +2038,6 @@\n \n     \"@rtsao/scc\": [\"@rtsao/scc@1.1.0\", \"\", {}, \"sha512-zt6OdqaDoOnJ1ZYsCYGt9YmWzDXl4vQdKTyJev62gFhRGKdx7mcT54V9KIjg+d2wi9EXsPvAPKe7i7WjfVWB8g==\"],\n \n-    \"@rushstack/eslint-patch\": [\"@rushstack/eslint-patch@1.12.0\", \"\", {}, \"sha512-5EwMtOqvJMMa3HbmxLlF74e+3/HhwBTMcvt3nqVJgGCozO6hzIPOBlwm8mGVNR9SN2IJpxSnlxczyDjcn7qIyw==\"],\n-\n     \"@scarf/scarf\": [\"@scarf/scarf@1.4.0\", \"\", {}, \"sha512-xxeapPiUXdZAE3che6f3xogoJPeZgig6omHEy1rIY5WVsB3H2BHNnZH+gHG6x91SCWyQCzWGsuL2Hh3ClO5/qQ==\"],\n \n     \"@secretlint/config-creator\": [\"@secretlint/config-creator@10.2.2\", \"\", { \"dependencies\": { \"@secretlint/types\": \"^10.2.2\" } }, \"sha512-BynOBe7Hn3LJjb3CqCHZjeNB09s/vgf0baBaHVw67w7gHF0d25c3ZsZ5+vv8TgwSchRdUCRrbbcq5i2B1fJ2QQ==\"],\n@@ -2708,8 +2706,6 @@\n \n     \"array-includes\": [\"array-includes@3.1.9\", \"\", { \"dependencies\": { \"call-bind\": \"^1.0.8\", \"call-bound\": \"^1.0.4\", \"define-properties\": \"^1.2.1\", \"es-abstract\": \"^1.24.0\", \"es-object-atoms\": \"^1.1.1\", \"get-intrinsic\": \"^1.3.0\", \"is-string\": \"^1.1.1\", \"math-intrinsics\": \"^1.1.0\" } }, \"sha512-FmeCCAenzH0KH381SPT5FZmiA/TmpndpcaShhfgEN9eCVjnFBqq3l1xrI42y8+PPLI6hypzou4GXw00WHmPBLQ==\"],\n \n-    \"array-union\": [\"array-union@2.1.0\", \"\", {}, \"sha512-HGyxoOTYUyCM6stUe6EJgnd4EoewAI7zMdfqO+kGjnlZmBDz/cR5pf8r/cR4Wq60sL/p0IkcjUEEPwS3GFrIyw==\"],\n-\n     \"array.prototype.findlast\": [\"array.prototype.findlast@1.2.5\", \"\", { \"dependencies\": { \"call-bind\": \"^1.0.7\", \"define-properties\": \"^1.2.1\", \"es-abstract\": \"^1.23.2\", \"es-errors\": \"^1.3.0\", \"es-object-atoms\": \"^1.0.0\", \"es-shim-unscopables\": \"^1.0.2\" } }, \"sha512-CVvd6FHg1Z3POpBLxO6E6zr+rSKEQ9L6rZHAaY7lLfhKsWYUBBOuMs0e9o24oopj6H+geRCX0YJ+TJLBK2eHyQ==\"],\n \n     \"array.prototype.findlastindex\": [\"array.prototype.findlastindex@1.2.6\", \"\", { \"dependencies\": { \"call-bind\": \"^1.0.8\", \"call-bound\": \"^1.0.4\", \"define-properties\": \"^1.2.1\", \"es-abstract\": \"^1.23.9\", \"es-errors\": \"^1.3.0\", \"es-object-atoms\": \"^1.1.1\", \"es-shim-unscopables\": \"^1.1.0\" } }, \"sha512-F/TKATkzseUExPlfvmwQKGITM3DGTK+vkAsCZoDc5daVygbJBnjEUCbgkAvVFsgfXfX4YIqZ/27G3k3tdXrTxQ==\"],\n@@ -2870,7 +2866,7 @@\n \n     \"camelcase\": [\"camelcase@6.3.0\", \"\", {}, \"sha512-Gmy6FhYlCY7uOElZUSbxo2UCDH8owEk996gkbrpsgGtrJLM3J7jGxl9Ic7Qwwj4ivOE5AWZWRMecDdF7hqGjFA==\"],\n \n-    \"caniuse-lite\": [\"caniuse-lite@1.0.30001743\", \"\", {}, \"sha512-e6Ojr7RV14Un7dz6ASD0aZDmQPT/A+eZU+nuTNfjqmRrmkmQlnTNWH0SKmqagx9PeW87UVqapSurtAXifmtdmw==\"],\n+    \"caniuse-lite\": [\"caniuse-lite@1.0.30001753\", \"\", {}, \"sha512-Bj5H35MD/ebaOV4iDLqPEtiliTN29qkGtEHCwawWn4cYm+bPJM2NsaP30vtZcnERClMzp52J4+aw2UNbK4o+zw==\"],\n \n     \"ccount\": [\"ccount@2.0.1\", \"\", {}, \"sha512-eyrF0jiFpY+3drT6383f1qhkbGsLSifNAjA61IUjZjmLCWjItY6LB9ft9YhoDgwfmclB2zhu51Lc7+95b8NRAg==\"],\n \n@@ -3108,8 +3104,6 @@\n \n     \"dir-compare\": [\"dir-compare@4.2.0\", \"\", { \"dependencies\": { \"minimatch\": \"^3.0.5\", \"p-limit\": \"^3.1.0 \" } }, \"sha512-2xMCmOoMrdQIPHdsTawECdNPwlVFB9zGcz3kuhmBO6U3oU+UQjsue0i8ayLKpgBcm+hcXPMVSGUN9d+pvJ6+VQ==\"],\n \n-    \"dir-glob\": [\"dir-glob@3.0.1\", \"\", { \"dependencies\": { \"path-type\": \"^4.0.0\" } }, \"sha512-WkrWp9GR4KXfKGYzOLmTuGVi1UWFfws377n9cc55/tb6DuqyF6pcQ5AbiHEshaDpY9v6oaSr2XCDidGmMwdzIA==\"],\n-\n     \"dmg-builder\": [\"dmg-builder@26.0.12\", \"\", { \"dependencies\": { \"app-builder-lib\": \"26.0.12\", \"builder-util\": \"26.0.11\", \"builder-util-runtime\": \"9.3.1\", \"fs-extra\": \"^10.1.0\", \"iconv-lite\": \"^0.6.2\", \"js-yaml\": \"^4.1.0\" }, \"optionalDependencies\": { \"dmg-license\": \"^1.0.11\" } }, \"sha512-59CAAjAhTaIMCN8y9kD573vDkxbs1uhDcrFLHSgutYdPcGOU35Rf95725snvzEOy4BFB7+eLJ8djCNPmGwG67w==\"],\n \n     \"dmg-license\": [\"dmg-license@1.0.11\", \"\", { \"dependencies\": { \"@types/plist\": \"^3.0.1\", \"@types/verror\": \"^1.10.3\", \"ajv\": \"^6.10.0\", \"crc\": \"^3.8.0\", \"iconv-corefoundation\": \"^1.1.7\", \"plist\": \"^3.0.4\", \"smart-buffer\": \"^4.0.2\", \"verror\": \"^1.10.0\" }, \"os\": \"darwin\", \"bin\": { \"dmg-license\": \"bin/dmg-license.js\" } }, \"sha512-ZdzmqwKmECOWJpqefloC5OJy1+WZBBse5+MR88z9g9Zn4VY+WYUkAyojmhzJckH5YbbZGcYIuGAkY5/Ys5OM2Q==\"],\n@@ -3236,7 +3230,7 @@\n \n     \"eslint\": [\"eslint@9.36.0\", \"\", { \"dependencies\": { \"@eslint-community/eslint-utils\": \"^4.8.0\", \"@eslint-community/regexpp\": \"^4.12.1\", \"@eslint/config-array\": \"^0.21.0\", \"@eslint/config-helpers\": \"^0.3.1\", \"@eslint/core\": \"^0.15.2\", \"@eslint/eslintrc\": \"^3.3.1\", \"@eslint/js\": \"9.36.0\", \"@eslint/plugin-kit\": \"^0.3.5\", \"@humanfs/node\": \"^0.16.6\", \"@humanwhocodes/module-importer\": \"^1.0.1\", \"@humanwhocodes/retry\": \"^0.4.2\", \"@types/estree\": \"^1.0.6\", \"@types/json-schema\": \"^7.0.15\", \"ajv\": \"^6.12.4\", \"chalk\": \"^4.0.0\", \"cross-spawn\": \"^7.0.6\", \"debug\": \"^4.3.2\", \"escape-string-regexp\": \"^4.0.0\", \"eslint-scope\": \"^8.4.0\", \"eslint-visitor-keys\": \"^4.2.1\", \"espree\": \"^10.4.0\", \"esquery\": \"^1.5.0\", \"esutils\": \"^2.0.2\", \"fast-deep-equal\": \"^3.1.3\", \"file-entry-cache\": \"^8.0.0\", \"find-up\": \"^5.0.0\", \"glob-parent\": \"^6.0.2\", \"ignore\": \"^5.2.0\", \"imurmurhash\": \"^0.1.4\", \"is-glob\": \"^4.0.0\", \"json-stable-stringify-without-jsonify\": \"^1.0.1\", \"lodash.merge\": \"^4.6.2\", \"minimatch\": \"^3.1.2\", \"natural-compare\": \"^1.4.0\", \"optionator\": \"^0.9.3\" }, \"peerDependencies\": { \"jiti\": \"*\" }, \"optionalPeers\": [\"jiti\"], \"bin\": { \"eslint\": \"bin/eslint.js\" } }, \"sha512-hB4FIzXovouYzwzECDcUkJ4OcfOEkXTv2zRY6B9bkwjx/cprAq0uvm1nl7zvQ0/TsUk0zQiN4uPfJpB9m+rPMQ==\"],\n \n-    \"eslint-config-next\": [\"eslint-config-next@15.5.0\", \"\", { \"dependencies\": { \"@next/eslint-plugin-next\": \"15.5.0\", \"@rushstack/eslint-patch\": \"^1.10.3\", \"@typescript-eslint/eslint-plugin\": \"^5.4.2 || ^6.0.0 || ^7.0.0 || ^8.0.0\", \"@typescript-eslint/parser\": \"^5.4.2 || ^6.0.0 || ^7.0.0 || ^8.0.0\", \"eslint-import-resolver-node\": \"^0.3.6\", \"eslint-import-resolver-typescript\": \"^3.5.2\", \"eslint-plugin-import\": \"^2.31.0\", \"eslint-plugin-jsx-a11y\": \"^6.10.0\", \"eslint-plugin-react\": \"^7.37.0\", \"eslint-plugin-react-hooks\": \"^5.0.0\" }, \"peerDependencies\": { \"eslint\": \"^7.23.0 || ^8.0.0 || ^9.0.0\", \"typescript\": \">=3.3.1\" }, \"optionalPeers\": [\"typescript\"] }, \"sha512-Yl4hlOdBqstAuHnlBfx2RimBzWQwysM2SJNu5EzYVa2qS2ItPs7lgxL0sJJDudEx5ZZHfWPZ/6U8+FtDFWs7/w==\"],\n+    \"eslint-config-next\": [\"eslint-config-next@16.0.5\", \"\", { \"dependencies\": { \"@next/eslint-plugin-next\": \"16.0.5\", \"eslint-import-resolver-node\": \"^0.3.6\", \"eslint-import-resolver-typescript\": \"^3.5.2\", \"eslint-plugin-import\": \"^2.32.0\", \"eslint-plugin-jsx-a11y\": \"^6.10.0\", \"eslint-plugin-react\": \"^7.37.0\", \"eslint-plugin-react-hooks\": \"^7.0.0\", \"globals\": \"16.4.0\", \"typescript-eslint\": \"^8.46.0\" }, \"peerDependencies\": { \"eslint\": \">=9.0.0\", \"typescript\": \">=3.3.1\" }, \"optionalPeers\": [\"typescript\"] }, \"sha512-9rBjZ/biSpolkIUiqvx/iwJJaz8sxJ6pKWSPptJenpj01HlWbCDeaA1v0yG3a71IIPMplxVCSXhmtP27SXqMdg==\"],\n \n     \"eslint-import-resolver-node\": [\"eslint-import-resolver-node@0.3.9\", \"\", { \"dependencies\": { \"debug\": \"^3.2.7\", \"is-core-module\": \"^2.13.0\", \"resolve\": \"^1.22.4\" } }, \"sha512-WFj2isz22JahUv+B788TlO3N6zL3nNJGU8CcZbPZvVEkBPaJdCV4vy5wyghty5ROFbCRnm132v8BScu5/1BQ8g==\"],\n \n@@ -3474,6 +3468,10 @@\n \n     \"help-me\": [\"help-me@5.0.0\", \"\", {}, \"sha512-7xgomUX6ADmcYzFik0HzAxh/73YlKR9bmFzf51CZwR+b6YtzU2m0u49hQCqV6SvlqIqsaxovfwdvbnsw3b/zpg==\"],\n \n+    \"hermes-estree\": [\"hermes-estree@0.25.1\", \"\", {}, \"sha512-0wUoCcLp+5Ev5pDW2OriHC2MJCbwLwuRx+gAqMTOkGKJJiBCLjtrvy4PWUGn6MIVefecRpzoOZ/UV6iGdOr+Cw==\"],\n+\n+    \"hermes-parser\": [\"hermes-parser@0.25.1\", \"\", { \"dependencies\": { \"hermes-estree\": \"0.25.1\" } }, \"sha512-6pEjquH3rqaI6cYAXYPcz9MS4rY6R4ngRgrgfDshRptUZIc3lw0MCIJIGDj9++mfySOuPTHB4nrSW99BCvOPIA==\"],\n+\n     \"hmac-drbg\": [\"hmac-drbg@1.0.1\", \"\", { \"dependencies\": { \"hash.js\": \"^1.0.3\", \"minimalistic-assert\": \"^1.0.0\", \"minimalistic-crypto-utils\": \"^1.0.1\" } }, \"sha512-Tti3gMqLdZfhOQY1Mzf/AanLiqh1WTiJgEj26ZuYQ9fbkLomzGchCws4FyrSd4VkpBfiNhaE1On+lOz894jvXg==\"],\n \n     \"hoist-non-react-statics\": [\"hoist-non-react-statics@3.3.2\", \"\", { \"dependencies\": { \"react-is\": \"^16.7.0\" } }, \"sha512-/gGivxi8JPKWNm/W0jSmzcMPpfpPLc3dY/6GxhX2hQ9iGj3aDfklV4ET7NjKpSinLpJ5vafa9iiGIEZg10SfBw==\"],\n@@ -4032,7 +4030,7 @@\n \n     \"neo-async\": [\"neo-async@2.6.2\", \"\", {}, \"sha512-Yd3UES5mWCSqR+qNT93S3UoYUkqAZ9lLg8a7g9rimsWmYGK8cVToA4/sF3RrshdyV3sAGMXVUmpMYOw+dLpOuw==\"],\n \n-    \"next\": [\"next@15.5.2\", \"\", { \"dependencies\": { \"@next/env\": \"15.5.2\", \"@swc/helpers\": \"0.5.15\", \"caniuse-lite\": \"^1.0.30001579\", \"postcss\": \"8.4.31\", \"styled-jsx\": \"5.1.6\" }, \"optionalDependencies\": { \"@next/swc-darwin-arm64\": \"15.5.2\", \"@next/swc-darwin-x64\": \"15.5.2\", \"@next/swc-linux-arm64-gnu\": \"15.5.2\", \"@next/swc-linux-arm64-musl\": \"15.5.2\", \"@next/swc-linux-x64-gnu\": \"15.5.2\", \"@next/swc-linux-x64-musl\": \"15.5.2\", \"@next/swc-win32-arm64-msvc\": \"15.5.2\", \"@next/swc-win32-x64-msvc\": \"15.5.2\", \"sharp\": \"^0.34.3\" }, \"peerDependencies\": { \"@opentelemetry/api\": \"^1.1.0\", \"@playwright/test\": \"^1.51.1\", \"babel-plugin-react-compiler\": \"*\", \"react\": \"^18.2.0 || 19.0.0-rc-de68d2f4-20241204 || ^19.0.0\", \"react-dom\": \"^18.2.0 || 19.0.0-rc-de68d2f4-20241204 || ^19.0.0\", \"sass\": \"^1.3.0\" }, \"optionalPeers\": [\"@opentelemetry/api\", \"@playwright/test\", \"babel-plugin-react-compiler\", \"sass\"], \"bin\": { \"next\": \"dist/bin/next\" } }, \"sha512-H8Otr7abj1glFhbGnvUt3gz++0AF1+QoCXEBmd/6aKbfdFwrn0LpA836Ed5+00va/7HQSDD+mOoVhn3tNy3e/Q==\"],\n+    \"next\": [\"next@16.0.5\", \"\", { \"dependencies\": { \"@next/env\": \"16.0.5\", \"@swc/helpers\": \"0.5.15\", \"caniuse-lite\": \"^1.0.30001579\", \"postcss\": \"8.4.31\", \"styled-jsx\": \"5.1.6\" }, \"optionalDependencies\": { \"@next/swc-darwin-arm64\": \"16.0.5\", \"@next/swc-darwin-x64\": \"16.0.5\", \"@next/swc-linux-arm64-gnu\": \"16.0.5\", \"@next/swc-linux-arm64-musl\": \"16.0.5\", \"@next/swc-linux-x64-gnu\": \"16.0.5\", \"@next/swc-linux-x64-musl\": \"16.0.5\", \"@next/swc-win32-arm64-msvc\": \"16.0.5\", \"@next/swc-win32-x64-msvc\": \"16.0.5\", \"sharp\": \"^0.34.4\" }, \"peerDependencies\": { \"@opentelemetry/api\": \"^1.1.0\", \"@playwright/test\": \"^1.51.1\", \"babel-plugin-react-compiler\": \"*\", \"react\": \"^18.2.0 || 19.0.0-rc-de68d2f4-20241204 || ^19.0.0\", \"react-dom\": \"^18.2.0 || 19.0.0-rc-de68d2f4-20241204 || ^19.0.0\", \"sass\": \"^1.3.0\" }, \"optionalPeers\": [\"@opentelemetry/api\", \"@playwright/test\", \"babel-plugin-react-compiler\", \"sass\"], \"bin\": { \"next\": \"dist/bin/next\" } }, \"sha512-XUPsFqSqu/NDdPfn/cju9yfIedkDI7ytDoALD9todaSMxk1Z5e3WcbUjfI9xsanFTys7xz62lnRWNFqJordzkQ==\"],\n \n     \"nice-try\": [\"nice-try@1.0.5\", \"\", {}, \"sha512-1nh45deeb5olNY7eX82BkPO7SSxR5SSYJiPTrTdFUVYwAl8CKMA5N9PjTYkHiRjisVcxcQ1HXdLhx2qxxJzLNQ==\"],\n \n@@ -5052,6 +5050,8 @@\n \n     \"zod-to-json-schema\": [\"zod-to-json-schema@3.24.6\", \"\", { \"peerDependencies\": { \"zod\": \"^3.24.1\" } }, \"sha512-h/z3PKvcTcTetyjl1fkj79MHNEjm+HpD6NXheWjzOekY7kV+lwDYnHw+ivHkijnCSMz1yJaWBD9vu/Fcmk+vEg==\"],\n \n+    \"zod-validation-error\": [\"zod-validation-error@4.0.2\", \"\", { \"peerDependencies\": { \"zod\": \"^3.25.0 || ^4.0.0\" } }, \"sha512-Q6/nZLe6jxuU80qb/4uJ4t5v2VEZ44lzQjPDhYJNztRQ4wyWc6VF3D3Kb/fAuPetZQnhS3hnajCf9CsWesghLQ==\"],\n+\n     \"zwitch\": [\"zwitch@2.0.4\", \"\", {}, \"sha512-bXE4cR/kVZhKZX/RjPEflHaKVhUVl85noU3v6b8apfQEc1x4A+zBxjZ4lN8LqGd6WZ3dl98pY4o717VFmoPp+A==\"],\n \n     \"@ai-sdk/gateway/@ai-sdk/provider-utils\": [\"@ai-sdk/provider-utils@3.0.9\", \"\", { \"dependencies\": { \"@ai-sdk/provider\": \"2.0.0\", \"@standard-schema/spec\": \"^1.0.0\", \"eventsource-parser\": \"^3.0.5\" }, \"peerDependencies\": { \"zod\": \"^3.25.76 || ^4\" } }, \"sha512-Pm571x5efqaI4hf9yW4KsVlDBDme8++UepZRnq+kqVBWWjgvGhQlzU8glaFq0YJEB9kkxZHbRRyVeHoV2sRYaQ==\"],\n@@ -5084,6 +5084,8 @@\n \n     \"@cloudflare/kv-asset-handler/mime\": [\"mime@3.0.0\", \"\", { \"bin\": { \"mime\": \"cli.js\" } }, \"sha512-jSCU7/VB1loIWBZe14aEYHU/+1UMEHoaO7qxCOVJOw9GgH72VAWppxNcjU+x9a2k3GSIBXNKxXQFqRvvZ7vr3A==\"],\n \n+    \"@cmux/morphcloud-openapi-client/typescript-eslint\": [\"typescript-eslint@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/eslint-plugin\": \"8.48.0\", \"@typescript-eslint/parser\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-fcKOvQD9GUn3Xw63EgiDqhvWJ5jsyZUaekl3KVpGsDJnN46WJTe3jWxtQP9lMZm1LJNkFLlTaWAxK2vUQR+cqw==\"],\n+\n     \"@cmux/scripts/morphcloud\": [\"morphcloud@0.0.18\", \"\", { \"dependencies\": { \"ignore\": \"^7.0.0\", \"node-ssh\": \"^13.2.0\", \"undici\": \"^7.12.0\", \"uuid\": \"^11.1.0\" } }, \"sha512-k3kxdvmwUQbRM5RBJp/UMXQKOqZBBy+BVo/jgNLuNp8yLBq5CJqGAK3O0oZewwKUK2/UL4LyHkwJxBNf7gy0kg==\"],\n \n     \"@cmux/server/electron\": [\"electron@38.2.2\", \"\", { \"dependencies\": { \"@electron/get\": \"^2.0.0\", \"@types/node\": \"^22.7.7\", \"extract-zip\": \"^2.0.1\" }, \"bin\": { \"electron\": \"cli.js\" } }, \"sha512-OXSaVNXDlonXDjMRsFNQo1j5tzTKwKXh5/m46IjAFccBcZJZMISI+EjSI07oexIuhvKM8AZLuFuihVn4YjWWrA==\"],\n@@ -5102,6 +5104,10 @@\n \n     \"@cmux/www/tailwind-merge\": [\"tailwind-merge@2.6.0\", \"\", {}, \"sha512-P+Vu1qXfzediirmHOC3xKGAYeZtPcV9g76X+xg2FD4tYgR71ewMA35Y3sCz3zhiN/dwefRpJX0yBcgwi1fXNQA==\"],\n \n+    \"@cmux/www/typescript-eslint\": [\"typescript-eslint@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/eslint-plugin\": \"8.48.0\", \"@typescript-eslint/parser\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-fcKOvQD9GUn3Xw63EgiDqhvWJ5jsyZUaekl3KVpGsDJnN46WJTe3jWxtQP9lMZm1LJNkFLlTaWAxK2vUQR+cqw==\"],\n+\n+    \"@cmux/www-openapi-client/typescript-eslint\": [\"typescript-eslint@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/eslint-plugin\": \"8.48.0\", \"@typescript-eslint/parser\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-fcKOvQD9GUn3Xw63EgiDqhvWJ5jsyZUaekl3KVpGsDJnN46WJTe3jWxtQP9lMZm1LJNkFLlTaWAxK2vUQR+cqw==\"],\n+\n     \"@convex-dev/auth/cookie\": [\"cookie@1.0.2\", \"\", {}, \"sha512-9Kr/j4O16ISv8zBBhJoi4bXOYNTkFLOqSL3UDB0njXxCXNezjeyVrJyGOWtgfs/q2km1gwBcfH8q1yEGoMYunA==\"],\n \n     \"@convex-dev/auth/jose\": [\"jose@5.10.0\", \"\", {}, \"sha512-s+3Al/p9g32Iq+oqXxkW//7jk2Vig6FF1CFqzVXoTUXt2qz89YWbL+OwS17NFYEvxC35n0FKeGO2LGYSxeM2Gg==\"],\n@@ -5522,8 +5528,6 @@\n \n     \"body-parser/iconv-lite\": [\"iconv-lite@0.4.24\", \"\", { \"dependencies\": { \"safer-buffer\": \">= 2.1.2 < 3\" } }, \"sha512-v3MXnZAcvnywkTUEZomIActle7RXXeedOR31wwl7VlyoXO4Qi9arvSenNQWne1TcRwhCL1HwLI21bEqdpj8/rA==\"],\n \n-    \"browserslist/caniuse-lite\": [\"caniuse-lite@1.0.30001753\", \"\", {}, \"sha512-Bj5H35MD/ebaOV4iDLqPEtiliTN29qkGtEHCwawWn4cYm+bPJM2NsaP30vtZcnERClMzp52J4+aw2UNbK4o+zw==\"],\n-\n     \"builder-util/fs-extra\": [\"fs-extra@10.1.0\", \"\", { \"dependencies\": { \"graceful-fs\": \"^4.2.0\", \"jsonfile\": \"^6.0.1\", \"universalify\": \"^2.0.0\" } }, \"sha512-oRXApq54ETRj4eMiFzGnHWGy+zo5raudjuxN0b8H7s/RU2oW0Wvsx9O0ACRN/kRq9E8Vu/ReskGB5o3ji+FzHQ==\"],\n \n     \"bun-react-template/lucide-react\": [\"lucide-react@0.540.0\", \"\", { \"peerDependencies\": { \"react\": \"^16.5.1 || ^17.0.0 || ^18.0.0 || ^19.0.0\" } }, \"sha512-armkCAqQvO62EIX4Hq7hqX/q11WSZu0Jd23cnnqx0/49yIxGXyL/zyZfBxNN9YDx0ensPTb4L+DjTh3yQXUxtQ==\"],\n@@ -5586,8 +5590,6 @@\n \n     \"dir-compare/minimatch\": [\"minimatch@3.1.2\", \"\", { \"dependencies\": { \"brace-expansion\": \"^1.1.7\" } }, \"sha512-J7p63hRiAjw1NDEww1W7i37+ByIrOWO5XQQAzZ3VOcL0PNybwpfmV/N05zFAzwQ9USyEcX6t3UO+K5aqBQOIHw==\"],\n \n-    \"dir-glob/path-type\": [\"path-type@4.0.0\", \"\", {}, \"sha512-gDKb8aZMDeD/tZWs9P6+q0J9Mwkdl6xMV8TjnGP3qJVJ06bdMgkbBlLU8IdfOsIsFz2BW1rNVT3XuNEl8zPAvw==\"],\n-\n     \"dmg-builder/fs-extra\": [\"fs-extra@10.1.0\", \"\", { \"dependencies\": { \"graceful-fs\": \"^4.2.0\", \"jsonfile\": \"^6.0.1\", \"universalify\": \"^2.0.0\" } }, \"sha512-oRXApq54ETRj4eMiFzGnHWGy+zo5raudjuxN0b8H7s/RU2oW0Wvsx9O0ACRN/kRq9E8Vu/ReskGB5o3ji+FzHQ==\"],\n \n     \"dmg-license/crc\": [\"crc@3.8.0\", \"\", { \"dependencies\": { \"buffer\": \"^5.1.0\" } }, \"sha512-iX3mfgcTMIq3ZKLIsVFAbv7+Mc10kxabAGQb8HvjA1o3T1PIYprbakQ65d3I+2HGHt6nSKkM9PYjgoJO2KcFBQ==\"],\n@@ -5638,11 +5640,9 @@\n \n     \"eslint/minimatch\": [\"minimatch@3.1.2\", \"\", { \"dependencies\": { \"brace-expansion\": \"^1.1.7\" } }, \"sha512-J7p63hRiAjw1NDEww1W7i37+ByIrOWO5XQQAzZ3VOcL0PNybwpfmV/N05zFAzwQ9USyEcX6t3UO+K5aqBQOIHw==\"],\n \n-    \"eslint-config-next/@next/eslint-plugin-next\": [\"@next/eslint-plugin-next@15.5.0\", \"\", { \"dependencies\": { \"fast-glob\": \"3.3.1\" } }, \"sha512-+k83U/fST66eQBjTltX2T9qUYd43ntAe+NZ5qeZVTQyTiFiHvTLtkpLKug4AnZAtuI/lwz5tl/4QDJymjVkybg==\"],\n-\n-    \"eslint-config-next/@typescript-eslint/eslint-plugin\": [\"@typescript-eslint/eslint-plugin@6.21.0\", \"\", { \"dependencies\": { \"@eslint-community/regexpp\": \"^4.5.1\", \"@typescript-eslint/scope-manager\": \"6.21.0\", \"@typescript-eslint/type-utils\": \"6.21.0\", \"@typescript-eslint/utils\": \"6.21.0\", \"@typescript-eslint/visitor-keys\": \"6.21.0\", \"debug\": \"^4.3.4\", \"graphemer\": \"^1.4.0\", \"ignore\": \"^5.2.4\", \"natural-compare\": \"^1.4.0\", \"semver\": \"^7.5.4\", \"ts-api-utils\": \"^1.0.1\" }, \"peerDependencies\": { \"@typescript-eslint/parser\": \"^6.0.0 || ^6.0.0-alpha\", \"eslint\": \"^7.0.0 || ^8.0.0\" } }, \"sha512-oy9+hTPCUFpngkEZUSzbf9MxI65wbKFoQYsgPdILTfbUldp5ovUuphZVe4i30emU9M/kP+T64Di0mxl7dSw3MA==\"],\n+    \"eslint-config-next/eslint-plugin-react-hooks\": [\"eslint-plugin-react-hooks@7.0.1\", \"\", { \"dependencies\": { \"@babel/core\": \"^7.24.4\", \"@babel/parser\": \"^7.24.4\", \"hermes-parser\": \"^0.25.1\", \"zod\": \"^3.25.0 || ^4.0.0\", \"zod-validation-error\": \"^3.5.0 || ^4.0.0\" }, \"peerDependencies\": { \"eslint\": \"^3.0.0 || ^4.0.0 || ^5.0.0 || ^6.0.0 || ^7.0.0 || ^8.0.0-0 || ^9.0.0\" } }, \"sha512-O0d0m04evaNzEPoSW+59Mezf8Qt0InfgGIBJnpC0h3NH/WjUAR7BIKUfysC6todmtiZ/A0oUVS8Gce0WhBrHsA==\"],\n \n-    \"eslint-config-next/@typescript-eslint/parser\": [\"@typescript-eslint/parser@6.21.0\", \"\", { \"dependencies\": { \"@typescript-eslint/scope-manager\": \"6.21.0\", \"@typescript-eslint/types\": \"6.21.0\", \"@typescript-eslint/typescript-estree\": \"6.21.0\", \"@typescript-eslint/visitor-keys\": \"6.21.0\", \"debug\": \"^4.3.4\" }, \"peerDependencies\": { \"eslint\": \"^7.0.0 || ^8.0.0\" } }, \"sha512-tbsV1jPne5CkFQCgPBcDOt30ItF7aJoZL997JSF7MhGQqOeT3svWRYxiqlfA5RUdlHN6Fi+EI9bxqbdyAUZjYQ==\"],\n+    \"eslint-config-next/typescript-eslint\": [\"typescript-eslint@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/eslint-plugin\": \"8.48.0\", \"@typescript-eslint/parser\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-fcKOvQD9GUn3Xw63EgiDqhvWJ5jsyZUaekl3KVpGsDJnN46WJTe3jWxtQP9lMZm1LJNkFLlTaWAxK2vUQR+cqw==\"],\n \n     \"eslint-import-resolver-node/debug\": [\"debug@3.2.7\", \"\", { \"dependencies\": { \"ms\": \"^2.1.1\" } }, \"sha512-CFjzYYAi4ThfiQvizrFQevTTXHtnCqWfe7x1AhgEscTz6ZbLbfoLRLPugTQyBth6f8ZERVUSyWHFD/7Wu4t1XQ==\"],\n \n@@ -5980,6 +5980,8 @@\n \n     \"@babel/helper-compilation-targets/browserslist/baseline-browser-mapping\": [\"baseline-browser-mapping@2.8.6\", \"\", { \"bin\": { \"baseline-browser-mapping\": \"dist/cli.js\" } }, \"sha512-wrH5NNqren/QMtKUEEJf7z86YjfqW/2uw3IL3/xpqZUC95SSVIFXYQeeGjL6FT/X68IROu6RMehZQS5foy2BXw==\"],\n \n+    \"@babel/helper-compilation-targets/browserslist/caniuse-lite\": [\"caniuse-lite@1.0.30001743\", \"\", {}, \"sha512-e6Ojr7RV14Un7dz6ASD0aZDmQPT/A+eZU+nuTNfjqmRrmkmQlnTNWH0SKmqagx9PeW87UVqapSurtAXifmtdmw==\"],\n+\n     \"@babel/helper-compilation-targets/browserslist/electron-to-chromium\": [\"electron-to-chromium@1.5.222\", \"\", {}, \"sha512-gA7psSwSwQRE60CEoLz6JBCQPIxNeuzB2nL8vE03GK/OHxlvykbLyeiumQy1iH5C2f3YbRAZpGCMT12a/9ih9w==\"],\n \n     \"@babel/helper-compilation-targets/browserslist/node-releases\": [\"node-releases@2.0.21\", \"\", {}, \"sha512-5b0pgg78U3hwXkCM8Z9b2FJdPZlr9Psr9V2gQPESdGHqbntyFJKFW4r5TeWGFzafGY3hzs1JC62VEQMbl1JFkw==\"],\n@@ -5988,6 +5990,14 @@\n \n     \"@babel/helper-compilation-targets/lru-cache/yallist\": [\"yallist@3.1.1\", \"\", {}, \"sha512-a4UGQaWPH59mOXUYnAG2ewncQS4i4F43Tv3JoAM+s2VDAmS9NsK8GpDMLrCHPksFT7h3K6TOoUNn2pb7RoXx4g==\"],\n \n+    \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin\": [\"@typescript-eslint/eslint-plugin@8.48.0\", \"\", { \"dependencies\": { \"@eslint-community/regexpp\": \"^4.10.0\", \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/type-utils\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\", \"graphemer\": \"^1.4.0\", \"ignore\": \"^7.0.0\", \"natural-compare\": \"^1.4.0\", \"ts-api-utils\": \"^2.1.0\" }, \"peerDependencies\": { \"@typescript-eslint/parser\": \"^8.48.0\", \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-XxXP5tL1txl13YFtrECECQYeZjBZad4fyd3cFV4a19LkAY/bIp9fev3US4S5fDVV2JaYFiKAZ/GRTOLer+mbyQ==\"],\n+\n+    \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/parser\": [\"@typescript-eslint/parser@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\", \"debug\": \"^4.3.4\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-jCzKdm/QK0Kg4V4IK/oMlRZlY+QOcdjv89U2NgKHZk1CYTj82/RVSx1mV/0gqCVMJ/DA+Zf/S4NBWNF8GQ+eqQ==\"],\n+\n+    \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/typescript-estree\": [\"@typescript-eslint/typescript-estree@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/project-service\": \"8.48.0\", \"@typescript-eslint/tsconfig-utils\": \"8.48.0\", \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\", \"debug\": \"^4.3.4\", \"minimatch\": \"^9.0.4\", \"semver\": \"^7.6.0\", \"tinyglobby\": \"^0.2.15\", \"ts-api-utils\": \"^2.1.0\" }, \"peerDependencies\": { \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-ljHab1CSO4rGrQIAyizUS6UGHHCiAYhbfcIZ1zVJr5nMryxlXMVWS3duFPSKvSUbFPwkXMFk1k0EMIjub4sRRQ==\"],\n+\n+    \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/utils\": [\"@typescript-eslint/utils@8.48.0\", \"\", { \"dependencies\": { \"@eslint-community/eslint-utils\": \"^4.7.0\", \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-yTJO1XuGxCsSfIVt1+1UrLHtue8xz16V8apzPYI06W0HbEbEWHxHXgZaAgavIkoh+GeV6hKKd5jm0sS6OYxWXQ==\"],\n+\n     \"@cmux/scripts/morphcloud/ignore\": [\"ignore@7.0.5\", \"\", {}, \"sha512-Hs59xBNfUIunMFgWAbGX5cq6893IbWg4KnrjbYwX3tx0ztorVgTDA6B2sxf8ejHJ4wz8BqGUMYlnzNBer5NvGg==\"],\n \n     \"@cmux/scripts/morphcloud/undici\": [\"undici@7.16.0\", \"\", {}, \"sha512-QEg3HPMll0o3t2ourKwOeUAZ159Kn9mx5pnzHRQO8+Wixmh88YdZRiIwat0iNzNNXn0yoEtXJqFpyW7eM8BV7g==\"],\n@@ -6016,6 +6026,14 @@\n \n     \"@cmux/server/octokit/@octokit/webhooks\": [\"@octokit/webhooks@12.3.2\", \"\", { \"dependencies\": { \"@octokit/request-error\": \"^5.0.0\", \"@octokit/webhooks-methods\": \"^4.1.0\", \"@octokit/webhooks-types\": \"7.6.1\", \"aggregate-error\": \"^3.1.0\" } }, \"sha512-exj1MzVXoP7xnAcAB3jZ97pTvVPkQF9y6GA/dvYC47HV7vLv+24XRS6b/v/XnyikpEuvMhugEXdGtAlU086WkQ==\"],\n \n+    \"@cmux/www-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin\": [\"@typescript-eslint/eslint-plugin@8.48.0\", \"\", { \"dependencies\": { \"@eslint-community/regexpp\": \"^4.10.0\", \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/type-utils\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\", \"graphemer\": \"^1.4.0\", \"ignore\": \"^7.0.0\", \"natural-compare\": \"^1.4.0\", \"ts-api-utils\": \"^2.1.0\" }, \"peerDependencies\": { \"@typescript-eslint/parser\": \"^8.48.0\", \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-XxXP5tL1txl13YFtrECECQYeZjBZad4fyd3cFV4a19LkAY/bIp9fev3US4S5fDVV2JaYFiKAZ/GRTOLer+mbyQ==\"],\n+\n+    \"@cmux/www-openapi-client/typescript-eslint/@typescript-eslint/parser\": [\"@typescript-eslint/parser@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\", \"debug\": \"^4.3.4\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-jCzKdm/QK0Kg4V4IK/oMlRZlY+QOcdjv89U2NgKHZk1CYTj82/RVSx1mV/0gqCVMJ/DA+Zf/S4NBWNF8GQ+eqQ==\"],\n+\n+    \"@cmux/www-openapi-client/typescript-eslint/@typescript-eslint/typescript-estree\": [\"@typescript-eslint/typescript-estree@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/project-service\": \"8.48.0\", \"@typescript-eslint/tsconfig-utils\": \"8.48.0\", \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\", \"debug\": \"^4.3.4\", \"minimatch\": \"^9.0.4\", \"semver\": \"^7.6.0\", \"tinyglobby\": \"^0.2.15\", \"ts-api-utils\": \"^2.1.0\" }, \"peerDependencies\": { \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-ljHab1CSO4rGrQIAyizUS6UGHHCiAYhbfcIZ1zVJr5nMryxlXMVWS3duFPSKvSUbFPwkXMFk1k0EMIjub4sRRQ==\"],\n+\n+    \"@cmux/www-openapi-client/typescript-eslint/@typescript-eslint/utils\": [\"@typescript-eslint/utils@8.48.0\", \"\", { \"dependencies\": { \"@eslint-community/eslint-utils\": \"^4.7.0\", \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-yTJO1XuGxCsSfIVt1+1UrLHtue8xz16V8apzPYI06W0HbEbEWHxHXgZaAgavIkoh+GeV6hKKd5jm0sS6OYxWXQ==\"],\n+\n     \"@cmux/www/morphcloud/ignore\": [\"ignore@7.0.5\", \"\", {}, \"sha512-Hs59xBNfUIunMFgWAbGX5cq6893IbWg4KnrjbYwX3tx0ztorVgTDA6B2sxf8ejHJ4wz8BqGUMYlnzNBer5NvGg==\"],\n \n     \"@cmux/www/morphcloud/undici\": [\"undici@7.16.0\", \"\", {}, \"sha512-QEg3HPMll0o3t2ourKwOeUAZ159Kn9mx5pnzHRQO8+Wixmh88YdZRiIwat0iNzNNXn0yoEtXJqFpyW7eM8BV7g==\"],\n@@ -6042,6 +6060,14 @@\n \n     \"@cmux/www/octokit/@octokit/webhooks\": [\"@octokit/webhooks@12.3.2\", \"\", { \"dependencies\": { \"@octokit/request-error\": \"^5.0.0\", \"@octokit/webhooks-methods\": \"^4.1.0\", \"@octokit/webhooks-types\": \"7.6.1\", \"aggregate-error\": \"^3.1.0\" } }, \"sha512-exj1MzVXoP7xnAcAB3jZ97pTvVPkQF9y6GA/dvYC47HV7vLv+24XRS6b/v/XnyikpEuvMhugEXdGtAlU086WkQ==\"],\n \n+    \"@cmux/www/typescript-eslint/@typescript-eslint/eslint-plugin\": [\"@typescript-eslint/eslint-plugin@8.48.0\", \"\", { \"dependencies\": { \"@eslint-community/regexpp\": \"^4.10.0\", \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/type-utils\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\", \"graphemer\": \"^1.4.0\", \"ignore\": \"^7.0.0\", \"natural-compare\": \"^1.4.0\", \"ts-api-utils\": \"^2.1.0\" }, \"peerDependencies\": { \"@typescript-eslint/parser\": \"^8.48.0\", \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-XxXP5tL1txl13YFtrECECQYeZjBZad4fyd3cFV4a19LkAY/bIp9fev3US4S5fDVV2JaYFiKAZ/GRTOLer+mbyQ==\"],\n+\n+    \"@cmux/www/typescript-eslint/@typescript-eslint/parser\": [\"@typescript-eslint/parser@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\", \"debug\": \"^4.3.4\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-jCzKdm/QK0Kg4V4IK/oMlRZlY+QOcdjv89U2NgKHZk1CYTj82/RVSx1mV/0gqCVMJ/DA+Zf/S4NBWNF8GQ+eqQ==\"],\n+\n+    \"@cmux/www/typescript-eslint/@typescript-eslint/typescript-estree\": [\"@typescript-eslint/typescript-estree@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/project-service\": \"8.48.0\", \"@typescript-eslint/tsconfig-utils\": \"8.48.0\", \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\", \"debug\": \"^4.3.4\", \"minimatch\": \"^9.0.4\", \"semver\": \"^7.6.0\", \"tinyglobby\": \"^0.2.15\", \"ts-api-utils\": \"^2.1.0\" }, \"peerDependencies\": { \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-ljHab1CSO4rGrQIAyizUS6UGHHCiAYhbfcIZ1zVJr5nMryxlXMVWS3duFPSKvSUbFPwkXMFk1k0EMIjub4sRRQ==\"],\n+\n+    \"@cmux/www/typescript-eslint/@typescript-eslint/utils\": [\"@typescript-eslint/utils@8.48.0\", \"\", { \"dependencies\": { \"@eslint-community/eslint-utils\": \"^4.7.0\", \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-yTJO1XuGxCsSfIVt1+1UrLHtue8xz16V8apzPYI06W0HbEbEWHxHXgZaAgavIkoh+GeV6hKKd5jm0sS6OYxWXQ==\"],\n+\n     \"@daytonaio/sdk/tar/chownr\": [\"chownr@2.0.0\", \"\", {}, \"sha512-bIomtDF5KGpdogkLd9VspvFzk9KfpyyGlS8YFVZl7TGPBHL5snIOnxeshwVgPteQ9b4Eydl+pVbIyE1DcvCWgQ==\"],\n \n     \"@daytonaio/sdk/tar/minipass\": [\"minipass@5.0.0\", \"\", {}, \"sha512-3FnjYuehv9k6ovOEbyOswadCDPX1piCfhV8ncmYtHOjuPwylVWsghTLo7rabjC3Rx5xD4HDx8Wm1xnMF7S5qFQ==\"],\n@@ -6420,27 +6446,13 @@\n \n     \"engine.io/@types/node/undici-types\": [\"undici-types@7.12.0\", \"\", {}, \"sha512-goOacqME2GYyOZZfb5Lgtu+1IDmAlAEu5xnD3+xTzS10hT0vzpf0SPjkXwAw9Jm+4n/mQGDP3LO8CPbYROeBfQ==\"],\n \n-    \"eslint-config-next/@next/eslint-plugin-next/fast-glob\": [\"fast-glob@3.3.1\", \"\", { \"dependencies\": { \"@nodelib/fs.stat\": \"^2.0.2\", \"@nodelib/fs.walk\": \"^1.2.3\", \"glob-parent\": \"^5.1.2\", \"merge2\": \"^1.3.0\", \"micromatch\": \"^4.0.4\" } }, \"sha512-kNFPyjhh5cKjrUltxs+wFx+ZkbRaxxmZ+X0ZU31SOsxCEtP9VPgtq2teZw1DebupL5GmDaNQ6yKMMVcM41iqDg==\"],\n+    \"eslint-config-next/typescript-eslint/@typescript-eslint/eslint-plugin\": [\"@typescript-eslint/eslint-plugin@8.48.0\", \"\", { \"dependencies\": { \"@eslint-community/regexpp\": \"^4.10.0\", \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/type-utils\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\", \"graphemer\": \"^1.4.0\", \"ignore\": \"^7.0.0\", \"natural-compare\": \"^1.4.0\", \"ts-api-utils\": \"^2.1.0\" }, \"peerDependencies\": { \"@typescript-eslint/parser\": \"^8.48.0\", \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-XxXP5tL1txl13YFtrECECQYeZjBZad4fyd3cFV4a19LkAY/bIp9fev3US4S5fDVV2JaYFiKAZ/GRTOLer+mbyQ==\"],\n \n-    \"eslint-config-next/@typescript-eslint/eslint-plugin/@typescript-eslint/scope-manager\": [\"@typescript-eslint/scope-manager@6.21.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"6.21.0\", \"@typescript-eslint/visitor-keys\": \"6.21.0\" } }, \"sha512-OwLUIWZJry80O99zvqXVEioyniJMa+d2GrqpUTqi5/v5D5rOrppJVBPa0yKCblcigC0/aYAzxxqQ1B+DS2RYsg==\"],\n+    \"eslint-config-next/typescript-eslint/@typescript-eslint/parser\": [\"@typescript-eslint/parser@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\", \"debug\": \"^4.3.4\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-jCzKdm/QK0Kg4V4IK/oMlRZlY+QOcdjv89U2NgKHZk1CYTj82/RVSx1mV/0gqCVMJ/DA+Zf/S4NBWNF8GQ+eqQ==\"],\n \n-    \"eslint-config-next/@typescript-eslint/eslint-plugin/@typescript-eslint/type-utils\": [\"@typescript-eslint/type-utils@6.21.0\", \"\", { \"dependencies\": { \"@typescript-eslint/typescript-estree\": \"6.21.0\", \"@typescript-eslint/utils\": \"6.21.0\", \"debug\": \"^4.3.4\", \"ts-api-utils\": \"^1.0.1\" }, \"peerDependencies\": { \"eslint\": \"^7.0.0 || ^8.0.0\" } }, \"sha512-rZQI7wHfao8qMX3Rd3xqeYSMCL3SoiSQLBATSiVKARdFGCYSRvmViieZjqc58jKgs8Y8i9YvVVhRbHSTA4VBag==\"],\n+    \"eslint-config-next/typescript-eslint/@typescript-eslint/typescript-estree\": [\"@typescript-eslint/typescript-estree@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/project-service\": \"8.48.0\", \"@typescript-eslint/tsconfig-utils\": \"8.48.0\", \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\", \"debug\": \"^4.3.4\", \"minimatch\": \"^9.0.4\", \"semver\": \"^7.6.0\", \"tinyglobby\": \"^0.2.15\", \"ts-api-utils\": \"^2.1.0\" }, \"peerDependencies\": { \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-ljHab1CSO4rGrQIAyizUS6UGHHCiAYhbfcIZ1zVJr5nMryxlXMVWS3duFPSKvSUbFPwkXMFk1k0EMIjub4sRRQ==\"],\n \n-    \"eslint-config-next/@typescript-eslint/eslint-plugin/@typescript-eslint/utils\": [\"@typescript-eslint/utils@6.21.0\", \"\", { \"dependencies\": { \"@eslint-community/eslint-utils\": \"^4.4.0\", \"@types/json-schema\": \"^7.0.12\", \"@types/semver\": \"^7.5.0\", \"@typescript-eslint/scope-manager\": \"6.21.0\", \"@typescript-eslint/types\": \"6.21.0\", \"@typescript-eslint/typescript-estree\": \"6.21.0\", \"semver\": \"^7.5.4\" }, \"peerDependencies\": { \"eslint\": \"^7.0.0 || ^8.0.0\" } }, \"sha512-NfWVaC8HP9T8cbKQxHcsJBY5YE1O33+jpMwN45qzWWaPDZgLIbo12toGMWnmhvCpd3sIxkpDw3Wv1B3dYrbDQQ==\"],\n-\n-    \"eslint-config-next/@typescript-eslint/eslint-plugin/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@6.21.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"6.21.0\", \"eslint-visitor-keys\": \"^3.4.1\" } }, \"sha512-JJtkDduxLi9bivAB+cYOVMtbkqdPOhZ+ZI5LC47MIRrDV4Yn2o+ZnW10Nkmr28xRpSpdJ6Sm42Hjf2+REYXm0A==\"],\n-\n-    \"eslint-config-next/@typescript-eslint/eslint-plugin/ignore\": [\"ignore@5.3.2\", \"\", {}, \"sha512-hsBTNUqQTDwkWtcdYI2i06Y/nUBEsNEDJKjWdigLvegy8kDuJAS8uRlpkkcQpyEXL0Z/pjDy5HBmMjRCJ2gq+g==\"],\n-\n-    \"eslint-config-next/@typescript-eslint/eslint-plugin/ts-api-utils\": [\"ts-api-utils@1.4.3\", \"\", { \"peerDependencies\": { \"typescript\": \">=4.2.0\" } }, \"sha512-i3eMG77UTMD0hZhgRS562pv83RC6ukSAC2GMNWc+9dieh/+jDM5u5YG+NHX6VNDRHQcHwmsTHctP9LhbC3WxVw==\"],\n-\n-    \"eslint-config-next/@typescript-eslint/parser/@typescript-eslint/scope-manager\": [\"@typescript-eslint/scope-manager@6.21.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"6.21.0\", \"@typescript-eslint/visitor-keys\": \"6.21.0\" } }, \"sha512-OwLUIWZJry80O99zvqXVEioyniJMa+d2GrqpUTqi5/v5D5rOrppJVBPa0yKCblcigC0/aYAzxxqQ1B+DS2RYsg==\"],\n-\n-    \"eslint-config-next/@typescript-eslint/parser/@typescript-eslint/types\": [\"@typescript-eslint/types@6.21.0\", \"\", {}, \"sha512-1kFmZ1rOm5epu9NZEZm1kckCDGj5UJEf7P1kliH4LKu/RkwpsfqqGmY2OOcUs18lSlQBKLDYBOGxRVtrMN5lpg==\"],\n-\n-    \"eslint-config-next/@typescript-eslint/parser/@typescript-eslint/typescript-estree\": [\"@typescript-eslint/typescript-estree@6.21.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"6.21.0\", \"@typescript-eslint/visitor-keys\": \"6.21.0\", \"debug\": \"^4.3.4\", \"globby\": \"^11.1.0\", \"is-glob\": \"^4.0.3\", \"minimatch\": \"9.0.3\", \"semver\": \"^7.5.4\", \"ts-api-utils\": \"^1.0.1\" } }, \"sha512-6npJTkZcO+y2/kr+z0hc4HwNfrrP4kNYh57ek7yCNlrBjWQ1Y0OS7jiZTkgumrvkX5HkEKXFZkkdFNkaW2wmUQ==\"],\n-\n-    \"eslint-config-next/@typescript-eslint/parser/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@6.21.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"6.21.0\", \"eslint-visitor-keys\": \"^3.4.1\" } }, \"sha512-JJtkDduxLi9bivAB+cYOVMtbkqdPOhZ+ZI5LC47MIRrDV4Yn2o+ZnW10Nkmr28xRpSpdJ6Sm42Hjf2+REYXm0A==\"],\n+    \"eslint-config-next/typescript-eslint/@typescript-eslint/utils\": [\"@typescript-eslint/utils@8.48.0\", \"\", { \"dependencies\": { \"@eslint-community/eslint-utils\": \"^4.7.0\", \"@typescript-eslint/scope-manager\": \"8.48.0\", \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-yTJO1XuGxCsSfIVt1+1UrLHtue8xz16V8apzPYI06W0HbEbEWHxHXgZaAgavIkoh+GeV6hKKd5jm0sS6OYxWXQ==\"],\n \n     \"express/debug/ms\": [\"ms@2.0.0\", \"\", {}, \"sha512-Tpp60P6IUJDTuOq/5Z8cdskzJujfwqfOTkrwIwj7IRISpnkJnT6SyJ4PCPnGMoFjC9ddhal5KVIYtAt97ix05A==\"],\n \n@@ -6666,6 +6678,34 @@\n \n     \"@aws-crypto/util/@smithy/util-utf8/@smithy/util-buffer-from/@smithy/is-array-buffer\": [\"@smithy/is-array-buffer@2.2.0\", \"\", { \"dependencies\": { \"tslib\": \"^2.6.2\" } }, \"sha512-GGP3O9QFD24uGeAXYUjwSTXARoqpZykHadOmA8G5vfJPK0/DC67qa//0qvqrJzL1xc8WQWX7/yc7fwudjPHPhA==\"],\n \n+    \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/scope-manager\": [\"@typescript-eslint/scope-manager@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\" } }, \"sha512-uGSSsbrtJrLduti0Q1Q9+BF1/iFKaxGoQwjWOIVNJv0o6omrdyR8ct37m4xIl5Zzpkp69Kkmvom7QFTtue89YQ==\"],\n+\n+    \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/type-utils\": [\"@typescript-eslint/type-utils@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\", \"debug\": \"^4.3.4\", \"ts-api-utils\": \"^2.1.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-zbeVaVqeXhhab6QNEKfK96Xyc7UQuoFWERhEnj3mLVnUWrQnv15cJNseUni7f3g557gm0e46LZ6IJ4NJVOgOpw==\"],\n+\n+    \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n+\n+    \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin/ignore\": [\"ignore@7.0.5\", \"\", {}, \"sha512-Hs59xBNfUIunMFgWAbGX5cq6893IbWg4KnrjbYwX3tx0ztorVgTDA6B2sxf8ejHJ4wz8BqGUMYlnzNBer5NvGg==\"],\n+\n+    \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/parser/@typescript-eslint/scope-manager\": [\"@typescript-eslint/scope-manager@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\" } }, \"sha512-uGSSsbrtJrLduti0Q1Q9+BF1/iFKaxGoQwjWOIVNJv0o6omrdyR8ct37m4xIl5Zzpkp69Kkmvom7QFTtue89YQ==\"],\n+\n+    \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/parser/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/parser/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n+\n+    \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/project-service\": [\"@typescript-eslint/project-service@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/tsconfig-utils\": \"^8.48.0\", \"@typescript-eslint/types\": \"^8.48.0\", \"debug\": \"^4.3.4\" }, \"peerDependencies\": { \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-Ne4CTZyRh1BecBf84siv42wv5vQvVmgtk8AuiEffKTUo3DrBaGYZueJSxxBZ8fjk/N3DrgChH4TOdIOwOwiqqw==\"],\n+\n+    \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/tsconfig-utils\": [\"@typescript-eslint/tsconfig-utils@8.48.0\", \"\", { \"peerDependencies\": { \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-WNebjBdFdyu10sR1M4OXTt2OkMd5KWIL+LLfeH9KhgP+jzfDV/LI3eXzwJ1s9+Yc0Kzo2fQCdY/OpdusCMmh6w==\"],\n+\n+    \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n+\n+    \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/typescript-estree/minimatch\": [\"minimatch@9.0.5\", \"\", { \"dependencies\": { \"brace-expansion\": \"^2.0.1\" } }, \"sha512-G6T0ZX48xgozx7587koeX9Ys2NYy6Gmv//P89sEte9V9whIapMNF4idKxnW2QtCcLiTWlb/wfCabAtAFWhhBow==\"],\n+\n+    \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/utils/@typescript-eslint/scope-manager\": [\"@typescript-eslint/scope-manager@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\" } }, \"sha512-uGSSsbrtJrLduti0Q1Q9+BF1/iFKaxGoQwjWOIVNJv0o6omrdyR8ct37m4xIl5Zzpkp69Kkmvom7QFTtue89YQ==\"],\n+\n+    \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/utils/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n     \"@cmux/server/electron/@types/node/undici-types\": [\"undici-types@6.21.0\", \"\", {}, \"sha512-iwDZqg0QAGrg9Rav5H4n0M64c3mkR59cJ6wQp+7C4nI0gsmExaedaYLNO44eT4AtBBwjbTiGPMlt2Md0T9H9JQ==\"],\n \n     \"@cmux/server/octokit/@octokit/app/@octokit/auth-unauthenticated\": [\"@octokit/auth-unauthenticated@5.0.1\", \"\", { \"dependencies\": { \"@octokit/request-error\": \"^5.0.0\", \"@octokit/types\": \"^12.0.0\" } }, \"sha512-oxeWzmBFxWd+XolxKTc4zr+h3mt+yofn4r7OfoIkR/Cj/o70eEGmPsFbueyJE2iBAGpjgTnEOKM3pnuEGVmiqg==\"],\n@@ -6692,6 +6732,34 @@\n \n     \"@cmux/server/octokit/@octokit/webhooks/@octokit/webhooks-methods\": [\"@octokit/webhooks-methods@4.1.0\", \"\", {}, \"sha512-zoQyKw8h9STNPqtm28UGOYFE7O6D4Il8VJwhAtMHFt2C4L0VQT1qGKLeefUOqHNs1mNRYSadVv7x0z8U2yyeWQ==\"],\n \n+    \"@cmux/www-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/scope-manager\": [\"@typescript-eslint/scope-manager@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\" } }, \"sha512-uGSSsbrtJrLduti0Q1Q9+BF1/iFKaxGoQwjWOIVNJv0o6omrdyR8ct37m4xIl5Zzpkp69Kkmvom7QFTtue89YQ==\"],\n+\n+    \"@cmux/www-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/type-utils\": [\"@typescript-eslint/type-utils@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\", \"debug\": \"^4.3.4\", \"ts-api-utils\": \"^2.1.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-zbeVaVqeXhhab6QNEKfK96Xyc7UQuoFWERhEnj3mLVnUWrQnv15cJNseUni7f3g557gm0e46LZ6IJ4NJVOgOpw==\"],\n+\n+    \"@cmux/www-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n+\n+    \"@cmux/www-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin/ignore\": [\"ignore@7.0.5\", \"\", {}, \"sha512-Hs59xBNfUIunMFgWAbGX5cq6893IbWg4KnrjbYwX3tx0ztorVgTDA6B2sxf8ejHJ4wz8BqGUMYlnzNBer5NvGg==\"],\n+\n+    \"@cmux/www-openapi-client/typescript-eslint/@typescript-eslint/parser/@typescript-eslint/scope-manager\": [\"@typescript-eslint/scope-manager@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\" } }, \"sha512-uGSSsbrtJrLduti0Q1Q9+BF1/iFKaxGoQwjWOIVNJv0o6omrdyR8ct37m4xIl5Zzpkp69Kkmvom7QFTtue89YQ==\"],\n+\n+    \"@cmux/www-openapi-client/typescript-eslint/@typescript-eslint/parser/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/www-openapi-client/typescript-eslint/@typescript-eslint/parser/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n+\n+    \"@cmux/www-openapi-client/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/project-service\": [\"@typescript-eslint/project-service@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/tsconfig-utils\": \"^8.48.0\", \"@typescript-eslint/types\": \"^8.48.0\", \"debug\": \"^4.3.4\" }, \"peerDependencies\": { \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-Ne4CTZyRh1BecBf84siv42wv5vQvVmgtk8AuiEffKTUo3DrBaGYZueJSxxBZ8fjk/N3DrgChH4TOdIOwOwiqqw==\"],\n+\n+    \"@cmux/www-openapi-client/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/tsconfig-utils\": [\"@typescript-eslint/tsconfig-utils@8.48.0\", \"\", { \"peerDependencies\": { \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-WNebjBdFdyu10sR1M4OXTt2OkMd5KWIL+LLfeH9KhgP+jzfDV/LI3eXzwJ1s9+Yc0Kzo2fQCdY/OpdusCMmh6w==\"],\n+\n+    \"@cmux/www-openapi-client/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/www-openapi-client/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n+\n+    \"@cmux/www-openapi-client/typescript-eslint/@typescript-eslint/typescript-estree/minimatch\": [\"minimatch@9.0.5\", \"\", { \"dependencies\": { \"brace-expansion\": \"^2.0.1\" } }, \"sha512-G6T0ZX48xgozx7587koeX9Ys2NYy6Gmv//P89sEte9V9whIapMNF4idKxnW2QtCcLiTWlb/wfCabAtAFWhhBow==\"],\n+\n+    \"@cmux/www-openapi-client/typescript-eslint/@typescript-eslint/utils/@typescript-eslint/scope-manager\": [\"@typescript-eslint/scope-manager@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\" } }, \"sha512-uGSSsbrtJrLduti0Q1Q9+BF1/iFKaxGoQwjWOIVNJv0o6omrdyR8ct37m4xIl5Zzpkp69Kkmvom7QFTtue89YQ==\"],\n+\n+    \"@cmux/www-openapi-client/typescript-eslint/@typescript-eslint/utils/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n     \"@cmux/www/octokit/@octokit/app/@octokit/auth-unauthenticated\": [\"@octokit/auth-unauthenticated@5.0.1\", \"\", { \"dependencies\": { \"@octokit/request-error\": \"^5.0.0\", \"@octokit/types\": \"^12.0.0\" } }, \"sha512-oxeWzmBFxWd+XolxKTc4zr+h3mt+yofn4r7OfoIkR/Cj/o70eEGmPsFbueyJE2iBAGpjgTnEOKM3pnuEGVmiqg==\"],\n \n     \"@cmux/www/octokit/@octokit/app/@octokit/plugin-paginate-rest\": [\"@octokit/plugin-paginate-rest@9.2.2\", \"\", { \"dependencies\": { \"@octokit/types\": \"^12.6.0\" }, \"peerDependencies\": { \"@octokit/core\": \"5\" } }, \"sha512-u3KYkGF7GcZnSD/3UP0S7K5XUFT2FkOQdcfXZGZQPGv3lm4F2Xbf71lvjldr8c1H3nNbF+33cLEkWYbokGWqiQ==\"],\n@@ -6716,6 +6784,34 @@\n \n     \"@cmux/www/octokit/@octokit/webhooks/@octokit/webhooks-methods\": [\"@octokit/webhooks-methods@4.1.0\", \"\", {}, \"sha512-zoQyKw8h9STNPqtm28UGOYFE7O6D4Il8VJwhAtMHFt2C4L0VQT1qGKLeefUOqHNs1mNRYSadVv7x0z8U2yyeWQ==\"],\n \n+    \"@cmux/www/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/scope-manager\": [\"@typescript-eslint/scope-manager@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\" } }, \"sha512-uGSSsbrtJrLduti0Q1Q9+BF1/iFKaxGoQwjWOIVNJv0o6omrdyR8ct37m4xIl5Zzpkp69Kkmvom7QFTtue89YQ==\"],\n+\n+    \"@cmux/www/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/type-utils\": [\"@typescript-eslint/type-utils@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\", \"debug\": \"^4.3.4\", \"ts-api-utils\": \"^2.1.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-zbeVaVqeXhhab6QNEKfK96Xyc7UQuoFWERhEnj3mLVnUWrQnv15cJNseUni7f3g557gm0e46LZ6IJ4NJVOgOpw==\"],\n+\n+    \"@cmux/www/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n+\n+    \"@cmux/www/typescript-eslint/@typescript-eslint/eslint-plugin/ignore\": [\"ignore@7.0.5\", \"\", {}, \"sha512-Hs59xBNfUIunMFgWAbGX5cq6893IbWg4KnrjbYwX3tx0ztorVgTDA6B2sxf8ejHJ4wz8BqGUMYlnzNBer5NvGg==\"],\n+\n+    \"@cmux/www/typescript-eslint/@typescript-eslint/parser/@typescript-eslint/scope-manager\": [\"@typescript-eslint/scope-manager@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\" } }, \"sha512-uGSSsbrtJrLduti0Q1Q9+BF1/iFKaxGoQwjWOIVNJv0o6omrdyR8ct37m4xIl5Zzpkp69Kkmvom7QFTtue89YQ==\"],\n+\n+    \"@cmux/www/typescript-eslint/@typescript-eslint/parser/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/www/typescript-eslint/@typescript-eslint/parser/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n+\n+    \"@cmux/www/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/project-service\": [\"@typescript-eslint/project-service@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/tsconfig-utils\": \"^8.48.0\", \"@typescript-eslint/types\": \"^8.48.0\", \"debug\": \"^4.3.4\" }, \"peerDependencies\": { \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-Ne4CTZyRh1BecBf84siv42wv5vQvVmgtk8AuiEffKTUo3DrBaGYZueJSxxBZ8fjk/N3DrgChH4TOdIOwOwiqqw==\"],\n+\n+    \"@cmux/www/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/tsconfig-utils\": [\"@typescript-eslint/tsconfig-utils@8.48.0\", \"\", { \"peerDependencies\": { \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-WNebjBdFdyu10sR1M4OXTt2OkMd5KWIL+LLfeH9KhgP+jzfDV/LI3eXzwJ1s9+Yc0Kzo2fQCdY/OpdusCMmh6w==\"],\n+\n+    \"@cmux/www/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/www/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n+\n+    \"@cmux/www/typescript-eslint/@typescript-eslint/typescript-estree/minimatch\": [\"minimatch@9.0.5\", \"\", { \"dependencies\": { \"brace-expansion\": \"^2.0.1\" } }, \"sha512-G6T0ZX48xgozx7587koeX9Ys2NYy6Gmv//P89sEte9V9whIapMNF4idKxnW2QtCcLiTWlb/wfCabAtAFWhhBow==\"],\n+\n+    \"@cmux/www/typescript-eslint/@typescript-eslint/utils/@typescript-eslint/scope-manager\": [\"@typescript-eslint/scope-manager@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\" } }, \"sha512-uGSSsbrtJrLduti0Q1Q9+BF1/iFKaxGoQwjWOIVNJv0o6omrdyR8ct37m4xIl5Zzpkp69Kkmvom7QFTtue89YQ==\"],\n+\n+    \"@cmux/www/typescript-eslint/@typescript-eslint/utils/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n     \"@daytonaio/sdk/tar/minizlib/minipass\": [\"minipass@3.3.6\", \"\", { \"dependencies\": { \"yallist\": \"^4.0.0\" } }, \"sha512-DxiNidxSEK+tHG6zOIklvNOwm3hvCrbUrdtzY74U6HKTJxvIDfOUL5W5P2Ghd3DTkhhKPYGqeNUIh5qcM4YBfw==\"],\n \n     \"@electron/node-gyp/glob/minimatch/brace-expansion\": [\"brace-expansion@2.0.2\", \"\", { \"dependencies\": { \"balanced-match\": \"^1.0.0\" } }, \"sha512-Jt0vHyM+jmUBqojB7E1NIYadt0vI0Qxjxd2TErW94wDz+E2LAm5vKMXXwg6ZZBTHPuUlDgQHKXvjGBdfcF1ZDQ==\"],\n@@ -6806,27 +6902,33 @@\n \n     \"chalk/ansi-styles/color-convert/color-name\": [\"color-name@1.1.4\", \"\", {}, \"sha512-dOy+3AuW3a2wNbZHIuMZpTcgjGuLU/uBL/ubcZF9OXbDo8ff4O8yVp5Bf0efS8uEoYo5q4Fx7dY9OgQGXgAsQA==\"],\n \n-    \"eslint-config-next/@next/eslint-plugin-next/fast-glob/glob-parent\": [\"glob-parent@5.1.2\", \"\", { \"dependencies\": { \"is-glob\": \"^4.0.1\" } }, \"sha512-AOIgSQCepiJYwP3ARnGx+5VnTu2HBYdzbGP45eLw1vr3zB3vZLeyed1sC9hnbcOc9/SrMyM5RPQrkGz4aS9Zow==\"],\n+    \"eslint-config-next/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/scope-manager\": [\"@typescript-eslint/scope-manager@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\" } }, \"sha512-uGSSsbrtJrLduti0Q1Q9+BF1/iFKaxGoQwjWOIVNJv0o6omrdyR8ct37m4xIl5Zzpkp69Kkmvom7QFTtue89YQ==\"],\n+\n+    \"eslint-config-next/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/type-utils\": [\"@typescript-eslint/type-utils@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/typescript-estree\": \"8.48.0\", \"@typescript-eslint/utils\": \"8.48.0\", \"debug\": \"^4.3.4\", \"ts-api-utils\": \"^2.1.0\" }, \"peerDependencies\": { \"eslint\": \"^8.57.0 || ^9.0.0\", \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-zbeVaVqeXhhab6QNEKfK96Xyc7UQuoFWERhEnj3mLVnUWrQnv15cJNseUni7f3g557gm0e46LZ6IJ4NJVOgOpw==\"],\n \n-    \"eslint-config-next/@typescript-eslint/eslint-plugin/@typescript-eslint/scope-manager/@typescript-eslint/types\": [\"@typescript-eslint/types@6.21.0\", \"\", {}, \"sha512-1kFmZ1rOm5epu9NZEZm1kckCDGj5UJEf7P1kliH4LKu/RkwpsfqqGmY2OOcUs18lSlQBKLDYBOGxRVtrMN5lpg==\"],\n+    \"eslint-config-next/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n \n-    \"eslint-config-next/@typescript-eslint/eslint-plugin/@typescript-eslint/type-utils/@typescript-eslint/typescript-estree\": [\"@typescript-eslint/typescript-estree@6.21.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"6.21.0\", \"@typescript-eslint/visitor-keys\": \"6.21.0\", \"debug\": \"^4.3.4\", \"globby\": \"^11.1.0\", \"is-glob\": \"^4.0.3\", \"minimatch\": \"9.0.3\", \"semver\": \"^7.5.4\", \"ts-api-utils\": \"^1.0.1\" } }, \"sha512-6npJTkZcO+y2/kr+z0hc4HwNfrrP4kNYh57ek7yCNlrBjWQ1Y0OS7jiZTkgumrvkX5HkEKXFZkkdFNkaW2wmUQ==\"],\n+    \"eslint-config-next/typescript-eslint/@typescript-eslint/eslint-plugin/ignore\": [\"ignore@7.0.5\", \"\", {}, \"sha512-Hs59xBNfUIunMFgWAbGX5cq6893IbWg4KnrjbYwX3tx0ztorVgTDA6B2sxf8ejHJ4wz8BqGUMYlnzNBer5NvGg==\"],\n \n-    \"eslint-config-next/@typescript-eslint/eslint-plugin/@typescript-eslint/utils/@typescript-eslint/types\": [\"@typescript-eslint/types@6.21.0\", \"\", {}, \"sha512-1kFmZ1rOm5epu9NZEZm1kckCDGj5UJEf7P1kliH4LKu/RkwpsfqqGmY2OOcUs18lSlQBKLDYBOGxRVtrMN5lpg==\"],\n+    \"eslint-config-next/typescript-eslint/@typescript-eslint/parser/@typescript-eslint/scope-manager\": [\"@typescript-eslint/scope-manager@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\" } }, \"sha512-uGSSsbrtJrLduti0Q1Q9+BF1/iFKaxGoQwjWOIVNJv0o6omrdyR8ct37m4xIl5Zzpkp69Kkmvom7QFTtue89YQ==\"],\n \n-    \"eslint-config-next/@typescript-eslint/eslint-plugin/@typescript-eslint/utils/@typescript-eslint/typescript-estree\": [\"@typescript-eslint/typescript-estree@6.21.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"6.21.0\", \"@typescript-eslint/visitor-keys\": \"6.21.0\", \"debug\": \"^4.3.4\", \"globby\": \"^11.1.0\", \"is-glob\": \"^4.0.3\", \"minimatch\": \"9.0.3\", \"semver\": \"^7.5.4\", \"ts-api-utils\": \"^1.0.1\" } }, \"sha512-6npJTkZcO+y2/kr+z0hc4HwNfrrP4kNYh57ek7yCNlrBjWQ1Y0OS7jiZTkgumrvkX5HkEKXFZkkdFNkaW2wmUQ==\"],\n+    \"eslint-config-next/typescript-eslint/@typescript-eslint/parser/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n \n-    \"eslint-config-next/@typescript-eslint/eslint-plugin/@typescript-eslint/visitor-keys/@typescript-eslint/types\": [\"@typescript-eslint/types@6.21.0\", \"\", {}, \"sha512-1kFmZ1rOm5epu9NZEZm1kckCDGj5UJEf7P1kliH4LKu/RkwpsfqqGmY2OOcUs18lSlQBKLDYBOGxRVtrMN5lpg==\"],\n+    \"eslint-config-next/typescript-eslint/@typescript-eslint/parser/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n \n-    \"eslint-config-next/@typescript-eslint/eslint-plugin/@typescript-eslint/visitor-keys/eslint-visitor-keys\": [\"eslint-visitor-keys@3.4.3\", \"\", {}, \"sha512-wpc+LXeiyiisxPlEkUzU6svyS1frIO3Mgxj1fdy7Pm8Ygzguax2N3Fa/D/ag1WqbOprdI+uY6wMUl8/a2G+iag==\"],\n+    \"eslint-config-next/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/project-service\": [\"@typescript-eslint/project-service@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/tsconfig-utils\": \"^8.48.0\", \"@typescript-eslint/types\": \"^8.48.0\", \"debug\": \"^4.3.4\" }, \"peerDependencies\": { \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-Ne4CTZyRh1BecBf84siv42wv5vQvVmgtk8AuiEffKTUo3DrBaGYZueJSxxBZ8fjk/N3DrgChH4TOdIOwOwiqqw==\"],\n \n-    \"eslint-config-next/@typescript-eslint/parser/@typescript-eslint/typescript-estree/globby\": [\"globby@11.1.0\", \"\", { \"dependencies\": { \"array-union\": \"^2.1.0\", \"dir-glob\": \"^3.0.1\", \"fast-glob\": \"^3.2.9\", \"ignore\": \"^5.2.0\", \"merge2\": \"^1.4.1\", \"slash\": \"^3.0.0\" } }, \"sha512-jhIXaOzy1sb8IyocaruWSn1TjmnBVs8Ayhcy83rmxNJ8q2uWKCAj3CnJY+KpGSXCueAPc0i05kVvVKtP1t9S3g==\"],\n+    \"eslint-config-next/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/tsconfig-utils\": [\"@typescript-eslint/tsconfig-utils@8.48.0\", \"\", { \"peerDependencies\": { \"typescript\": \">=4.8.4 <6.0.0\" } }, \"sha512-WNebjBdFdyu10sR1M4OXTt2OkMd5KWIL+LLfeH9KhgP+jzfDV/LI3eXzwJ1s9+Yc0Kzo2fQCdY/OpdusCMmh6w==\"],\n \n-    \"eslint-config-next/@typescript-eslint/parser/@typescript-eslint/typescript-estree/minimatch\": [\"minimatch@9.0.3\", \"\", { \"dependencies\": { \"brace-expansion\": \"^2.0.1\" } }, \"sha512-RHiac9mvaRw0x3AYRgDC1CxAP7HTcNrrECeA8YYJeWnpo+2Q5CegtZjaotWTWxDG3UeGA1coE05iH1mPjT/2mg==\"],\n+    \"eslint-config-next/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n \n-    \"eslint-config-next/@typescript-eslint/parser/@typescript-eslint/typescript-estree/ts-api-utils\": [\"ts-api-utils@1.4.3\", \"\", { \"peerDependencies\": { \"typescript\": \">=4.2.0\" } }, \"sha512-i3eMG77UTMD0hZhgRS562pv83RC6ukSAC2GMNWc+9dieh/+jDM5u5YG+NHX6VNDRHQcHwmsTHctP9LhbC3WxVw==\"],\n+    \"eslint-config-next/typescript-eslint/@typescript-eslint/typescript-estree/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n \n-    \"eslint-config-next/@typescript-eslint/parser/@typescript-eslint/visitor-keys/eslint-visitor-keys\": [\"eslint-visitor-keys@3.4.3\", \"\", {}, \"sha512-wpc+LXeiyiisxPlEkUzU6svyS1frIO3Mgxj1fdy7Pm8Ygzguax2N3Fa/D/ag1WqbOprdI+uY6wMUl8/a2G+iag==\"],\n+    \"eslint-config-next/typescript-eslint/@typescript-eslint/typescript-estree/minimatch\": [\"minimatch@9.0.5\", \"\", { \"dependencies\": { \"brace-expansion\": \"^2.0.1\" } }, \"sha512-G6T0ZX48xgozx7587koeX9Ys2NYy6Gmv//P89sEte9V9whIapMNF4idKxnW2QtCcLiTWlb/wfCabAtAFWhhBow==\"],\n+\n+    \"eslint-config-next/typescript-eslint/@typescript-eslint/utils/@typescript-eslint/scope-manager\": [\"@typescript-eslint/scope-manager@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"@typescript-eslint/visitor-keys\": \"8.48.0\" } }, \"sha512-uGSSsbrtJrLduti0Q1Q9+BF1/iFKaxGoQwjWOIVNJv0o6omrdyR8ct37m4xIl5Zzpkp69Kkmvom7QFTtue89YQ==\"],\n+\n+    \"eslint-config-next/typescript-eslint/@typescript-eslint/utils/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n \n     \"giget/tar/minizlib/minipass\": [\"minipass@3.3.6\", \"\", { \"dependencies\": { \"yallist\": \"^4.0.0\" } }, \"sha512-DxiNidxSEK+tHG6zOIklvNOwm3hvCrbUrdtzY74U6HKTJxvIDfOUL5W5P2Ghd3DTkhhKPYGqeNUIh5qcM4YBfw==\"],\n \n@@ -6866,18 +6968,48 @@\n \n     \"wrap-ansi/ansi-styles/color-convert/color-name\": [\"color-name@1.1.4\", \"\", {}, \"sha512-dOy+3AuW3a2wNbZHIuMZpTcgjGuLU/uBL/ubcZF9OXbDo8ff4O8yVp5Bf0efS8uEoYo5q4Fx7dY9OgQGXgAsQA==\"],\n \n+    \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/scope-manager/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/type-utils/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/visitor-keys/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/typescript-estree/minimatch/brace-expansion\": [\"brace-expansion@2.0.2\", \"\", { \"dependencies\": { \"balanced-match\": \"^1.0.0\" } }, \"sha512-Jt0vHyM+jmUBqojB7E1NIYadt0vI0Qxjxd2TErW94wDz+E2LAm5vKMXXwg6ZZBTHPuUlDgQHKXvjGBdfcF1ZDQ==\"],\n+\n+    \"@cmux/morphcloud-openapi-client/typescript-eslint/@typescript-eslint/utils/@typescript-eslint/scope-manager/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n+\n     \"@cmux/server/octokit/@octokit/app/@octokit/types/@octokit/openapi-types\": [\"@octokit/openapi-types@20.0.0\", \"\", {}, \"sha512-EtqRBEjp1dL/15V7WiX5LJMIxxkdiGJnabzYx5Apx4FkQIFgAfKumXeYAqqJCj1s+BMX4cPFIFC4OLCR6stlnA==\"],\n \n     \"@cmux/server/octokit/@octokit/oauth-app/@octokit/auth-unauthenticated/@octokit/types\": [\"@octokit/types@12.6.0\", \"\", { \"dependencies\": { \"@octokit/openapi-types\": \"^20.0.0\" } }, \"sha512-1rhSOfRa6H9w4YwK0yrf5faDaDTb+yLyBUKOCV4xtCDB5VmIPqd/v9yr9o6SAzOAlRxMiRiCic6JVM1/kunVkw==\"],\n \n     \"@cmux/server/octokit/@octokit/plugin-throttling/@octokit/types/@octokit/openapi-types\": [\"@octokit/openapi-types@20.0.0\", \"\", {}, \"sha512-EtqRBEjp1dL/15V7WiX5LJMIxxkdiGJnabzYx5Apx4FkQIFgAfKumXeYAqqJCj1s+BMX4cPFIFC4OLCR6stlnA==\"],\n \n+    \"@cmux/www-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/scope-manager/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/www-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/type-utils/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/www-openapi-client/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/visitor-keys/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/www-openapi-client/typescript-eslint/@typescript-eslint/typescript-estree/minimatch/brace-expansion\": [\"brace-expansion@2.0.2\", \"\", { \"dependencies\": { \"balanced-match\": \"^1.0.0\" } }, \"sha512-Jt0vHyM+jmUBqojB7E1NIYadt0vI0Qxjxd2TErW94wDz+E2LAm5vKMXXwg6ZZBTHPuUlDgQHKXvjGBdfcF1ZDQ==\"],\n+\n+    \"@cmux/www-openapi-client/typescript-eslint/@typescript-eslint/utils/@typescript-eslint/scope-manager/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n+\n     \"@cmux/www/octokit/@octokit/app/@octokit/types/@octokit/openapi-types\": [\"@octokit/openapi-types@20.0.0\", \"\", {}, \"sha512-EtqRBEjp1dL/15V7WiX5LJMIxxkdiGJnabzYx5Apx4FkQIFgAfKumXeYAqqJCj1s+BMX4cPFIFC4OLCR6stlnA==\"],\n \n     \"@cmux/www/octokit/@octokit/oauth-app/@octokit/auth-unauthenticated/@octokit/types\": [\"@octokit/types@12.6.0\", \"\", { \"dependencies\": { \"@octokit/openapi-types\": \"^20.0.0\" } }, \"sha512-1rhSOfRa6H9w4YwK0yrf5faDaDTb+yLyBUKOCV4xtCDB5VmIPqd/v9yr9o6SAzOAlRxMiRiCic6JVM1/kunVkw==\"],\n \n     \"@cmux/www/octokit/@octokit/plugin-throttling/@octokit/types/@octokit/openapi-types\": [\"@octokit/openapi-types@20.0.0\", \"\", {}, \"sha512-EtqRBEjp1dL/15V7WiX5LJMIxxkdiGJnabzYx5Apx4FkQIFgAfKumXeYAqqJCj1s+BMX4cPFIFC4OLCR6stlnA==\"],\n \n+    \"@cmux/www/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/scope-manager/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/www/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/type-utils/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/www/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/visitor-keys/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n+\n+    \"@cmux/www/typescript-eslint/@typescript-eslint/typescript-estree/minimatch/brace-expansion\": [\"brace-expansion@2.0.2\", \"\", { \"dependencies\": { \"balanced-match\": \"^1.0.0\" } }, \"sha512-Jt0vHyM+jmUBqojB7E1NIYadt0vI0Qxjxd2TErW94wDz+E2LAm5vKMXXwg6ZZBTHPuUlDgQHKXvjGBdfcF1ZDQ==\"],\n+\n+    \"@cmux/www/typescript-eslint/@typescript-eslint/utils/@typescript-eslint/scope-manager/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n+\n     \"@electron/rebuild/ora/cli-cursor/restore-cursor/onetime\": [\"onetime@5.1.2\", \"\", { \"dependencies\": { \"mimic-fn\": \"^2.1.0\" } }, \"sha512-kbpaSSGJTWdAY5KPVeMOKXSrPtr8C8C7wodJbcsd51jRnmD+GZu8Y0VoU6Dm5Z4vWr0Ig/1NKuWRKf7j5aaYSg==\"],\n \n     \"@electron/rebuild/ora/cli-cursor/restore-cursor/signal-exit\": [\"signal-exit@3.0.7\", \"\", {}, \"sha512-wnD2ZE+l+SPC/uoS0vXeE9L1+0wuaMqKlfz9AMUo38JsyLSBWSFcHR1Rri62LZc12vLr1gb3jl7iwQhgwpAbGQ==\"],\n@@ -6892,21 +7024,15 @@\n \n     \"@sentry/webpack-plugin/unplugin/chokidar/readdirp/picomatch\": [\"picomatch@2.3.1\", \"\", {}, \"sha512-JU3teHTNjmE2VCGFzuY8EXzCDVwEqB2a8fsIvwaStHhAWJEeVd1o1QD80CU6+ZdEXXSLbSsuLwJjkCBWqRQUVA==\"],\n \n-    \"eslint-config-next/@typescript-eslint/eslint-plugin/@typescript-eslint/type-utils/@typescript-eslint/typescript-estree/@typescript-eslint/types\": [\"@typescript-eslint/types@6.21.0\", \"\", {}, \"sha512-1kFmZ1rOm5epu9NZEZm1kckCDGj5UJEf7P1kliH4LKu/RkwpsfqqGmY2OOcUs18lSlQBKLDYBOGxRVtrMN5lpg==\"],\n-\n-    \"eslint-config-next/@typescript-eslint/eslint-plugin/@typescript-eslint/type-utils/@typescript-eslint/typescript-estree/globby\": [\"globby@11.1.0\", \"\", { \"dependencies\": { \"array-union\": \"^2.1.0\", \"dir-glob\": \"^3.0.1\", \"fast-glob\": \"^3.2.9\", \"ignore\": \"^5.2.0\", \"merge2\": \"^1.4.1\", \"slash\": \"^3.0.0\" } }, \"sha512-jhIXaOzy1sb8IyocaruWSn1TjmnBVs8Ayhcy83rmxNJ8q2uWKCAj3CnJY+KpGSXCueAPc0i05kVvVKtP1t9S3g==\"],\n+    \"eslint-config-next/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/scope-manager/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n \n-    \"eslint-config-next/@typescript-eslint/eslint-plugin/@typescript-eslint/type-utils/@typescript-eslint/typescript-estree/minimatch\": [\"minimatch@9.0.3\", \"\", { \"dependencies\": { \"brace-expansion\": \"^2.0.1\" } }, \"sha512-RHiac9mvaRw0x3AYRgDC1CxAP7HTcNrrECeA8YYJeWnpo+2Q5CegtZjaotWTWxDG3UeGA1coE05iH1mPjT/2mg==\"],\n+    \"eslint-config-next/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/type-utils/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n \n-    \"eslint-config-next/@typescript-eslint/eslint-plugin/@typescript-eslint/utils/@typescript-eslint/typescript-estree/globby\": [\"globby@11.1.0\", \"\", { \"dependencies\": { \"array-union\": \"^2.1.0\", \"dir-glob\": \"^3.0.1\", \"fast-glob\": \"^3.2.9\", \"ignore\": \"^5.2.0\", \"merge2\": \"^1.4.1\", \"slash\": \"^3.0.0\" } }, \"sha512-jhIXaOzy1sb8IyocaruWSn1TjmnBVs8Ayhcy83rmxNJ8q2uWKCAj3CnJY+KpGSXCueAPc0i05kVvVKtP1t9S3g==\"],\n+    \"eslint-config-next/typescript-eslint/@typescript-eslint/eslint-plugin/@typescript-eslint/visitor-keys/@typescript-eslint/types\": [\"@typescript-eslint/types@8.48.0\", \"\", {}, \"sha512-cQMcGQQH7kwKoVswD1xdOytxQR60MWKM1di26xSUtxehaDs/32Zpqsu5WJlXTtTTqyAVK8R7hvsUnIXRS+bjvA==\"],\n \n-    \"eslint-config-next/@typescript-eslint/eslint-plugin/@typescript-eslint/utils/@typescript-eslint/typescript-estree/minimatch\": [\"minimatch@9.0.3\", \"\", { \"dependencies\": { \"brace-expansion\": \"^2.0.1\" } }, \"sha512-RHiac9mvaRw0x3AYRgDC1CxAP7HTcNrrECeA8YYJeWnpo+2Q5CegtZjaotWTWxDG3UeGA1coE05iH1mPjT/2mg==\"],\n+    \"eslint-config-next/typescript-eslint/@typescript-eslint/typescript-estree/minimatch/brace-expansion\": [\"brace-expansion@2.0.2\", \"\", { \"dependencies\": { \"balanced-match\": \"^1.0.0\" } }, \"sha512-Jt0vHyM+jmUBqojB7E1NIYadt0vI0Qxjxd2TErW94wDz+E2LAm5vKMXXwg6ZZBTHPuUlDgQHKXvjGBdfcF1ZDQ==\"],\n \n-    \"eslint-config-next/@typescript-eslint/parser/@typescript-eslint/typescript-estree/globby/ignore\": [\"ignore@5.3.2\", \"\", {}, \"sha512-hsBTNUqQTDwkWtcdYI2i06Y/nUBEsNEDJKjWdigLvegy8kDuJAS8uRlpkkcQpyEXL0Z/pjDy5HBmMjRCJ2gq+g==\"],\n-\n-    \"eslint-config-next/@typescript-eslint/parser/@typescript-eslint/typescript-estree/globby/slash\": [\"slash@3.0.0\", \"\", {}, \"sha512-g9Q1haeby36OSStwb4ntCGGGaKsaVSjQ68fBxoQcutl5fS1vuY18H3wSt3jFyFtrkx+Kz0V1G85A4MyAdDMi2Q==\"],\n-\n-    \"eslint-config-next/@typescript-eslint/parser/@typescript-eslint/typescript-estree/minimatch/brace-expansion\": [\"brace-expansion@2.0.2\", \"\", { \"dependencies\": { \"balanced-match\": \"^1.0.0\" } }, \"sha512-Jt0vHyM+jmUBqojB7E1NIYadt0vI0Qxjxd2TErW94wDz+E2LAm5vKMXXwg6ZZBTHPuUlDgQHKXvjGBdfcF1ZDQ==\"],\n+    \"eslint-config-next/typescript-eslint/@typescript-eslint/utils/@typescript-eslint/scope-manager/@typescript-eslint/visitor-keys\": [\"@typescript-eslint/visitor-keys@8.48.0\", \"\", { \"dependencies\": { \"@typescript-eslint/types\": \"8.48.0\", \"eslint-visitor-keys\": \"^4.2.1\" } }, \"sha512-T0XJMaRPOH3+LBbAfzR2jalckP1MSG/L9eUtY0DEzUyVaXJ/t6zN0nR7co5kz0Jko/nkSYCBRkz1djvjajVTTg==\"],\n \n     \"mocha/yargs/cliui/strip-ansi/ansi-regex\": [\"ansi-regex@5.0.1\", \"\", {}, \"sha512-quJQXlTSUGL2LH9SUXo8VwsY4soanhgo6LNSm84E1LBcE8s3O0wpdiRzyR9z/ZZJMlMWv37qOOb9pdJlMUEKFQ==\"],\n \n@@ -6924,14 +7050,6 @@\n \n     \"@cmux/www/octokit/@octokit/oauth-app/@octokit/auth-unauthenticated/@octokit/types/@octokit/openapi-types\": [\"@octokit/openapi-types@20.0.0\", \"\", {}, \"sha512-EtqRBEjp1dL/15V7WiX5LJMIxxkdiGJnabzYx5Apx4FkQIFgAfKumXeYAqqJCj1s+BMX4cPFIFC4OLCR6stlnA==\"],\n \n-    \"eslint-config-next/@typescript-eslint/eslint-plugin/@typescript-eslint/type-utils/@typescript-eslint/typescript-estree/globby/slash\": [\"slash@3.0.0\", \"\", {}, \"sha512-g9Q1haeby36OSStwb4ntCGGGaKsaVSjQ68fBxoQcutl5fS1vuY18H3wSt3jFyFtrkx+Kz0V1G85A4MyAdDMi2Q==\"],\n-\n-    \"eslint-config-next/@typescript-eslint/eslint-plugin/@typescript-eslint/type-utils/@typescript-eslint/typescript-estree/minimatch/brace-expansion\": [\"brace-expansion@2.0.2\", \"\", { \"dependencies\": { \"balanced-match\": \"^1.0.0\" } }, \"sha512-Jt0vHyM+jmUBqojB7E1NIYadt0vI0Qxjxd2TErW94wDz+E2LAm5vKMXXwg6ZZBTHPuUlDgQHKXvjGBdfcF1ZDQ==\"],\n-\n-    \"eslint-config-next/@typescript-eslint/eslint-plugin/@typescript-eslint/utils/@typescript-eslint/typescript-estree/globby/slash\": [\"slash@3.0.0\", \"\", {}, \"sha512-g9Q1haeby36OSStwb4ntCGGGaKsaVSjQ68fBxoQcutl5fS1vuY18H3wSt3jFyFtrkx+Kz0V1G85A4MyAdDMi2Q==\"],\n-\n-    \"eslint-config-next/@typescript-eslint/eslint-plugin/@typescript-eslint/utils/@typescript-eslint/typescript-estree/minimatch/brace-expansion\": [\"brace-expansion@2.0.2\", \"\", { \"dependencies\": { \"balanced-match\": \"^1.0.0\" } }, \"sha512-Jt0vHyM+jmUBqojB7E1NIYadt0vI0Qxjxd2TErW94wDz+E2LAm5vKMXXwg6ZZBTHPuUlDgQHKXvjGBdfcF1ZDQ==\"],\n-\n     \"qrcode/yargs/cliui/wrap-ansi/ansi-styles/color-convert\": [\"color-convert@2.0.1\", \"\", { \"dependencies\": { \"color-name\": \"~1.1.4\" } }, \"sha512-RRECPsj7iu/xb5oKYcsFHSppFNnsj/52OVTRKb4zP5onXwVF3zVmmToNcOfGC+CRDpfK/U584fMg38ZHCaElKQ==\"],\n \n     \"qrcode/yargs/find-up/locate-path/p-locate/p-limit\": [\"p-limit@2.3.0\", \"\", { \"dependencies\": { \"p-try\": \"^2.0.0\" } }, \"sha512-//88mFWSJx8lxCzwdAABTJL2MyWB12+eIY7MDL2SqLmAkeKU9qxRvWuSyTjm3FUmpBEMuFfckAIqEaVGUDxb6w==\"],\ndiff --git a/packages/convex/convex/_generated/api.d.ts b/packages/convex/convex/_generated/api.d.ts\nindex 58d89883b..a468709e2 100644\n--- a/packages/convex/convex/_generated/api.d.ts\n+++ b/packages/convex/convex/_generated/api.d.ts\n@@ -15,8 +15,8 @@ import type * as codeReviewActions from \"../codeReviewActions.js\";\n import type * as codeReview_http from \"../codeReview_http.js\";\n import type * as comments from \"../comments.js\";\n import type * as containerSettings from \"../containerSettings.js\";\n-import type * as crown from \"../crown.js\";\n import type * as crown_actions from \"../crown/actions.js\";\n+import type * as crown from \"../crown.js\";\n import type * as crown_http from \"../crown_http.js\";\n import type * as environmentSnapshots from \"../environmentSnapshots.js\";\n import type * as environments from \"../environments.js\";\n@@ -55,9 +55,9 @@ import type * as taskRuns from \"../taskRuns.js\";\n import type * as taskRuns_http from \"../taskRuns_http.js\";\n import type * as tasks from \"../tasks.js\";\n import type * as teams from \"../teams.js\";\n-import type * as users from \"../users.js\";\n import type * as users_utils_getWorkerAuth from \"../users/utils/getWorkerAuth.js\";\n import type * as users_utils_index from \"../users/utils/index.js\";\n+import type * as users from \"../users.js\";\n import type * as workspaceConfigs from \"../workspaceConfigs.js\";\n import type * as workspaceSettings from \"../workspaceSettings.js\";\n \n@@ -67,6 +67,14 @@ import type {\n   FunctionReference,\n } from \"convex/server\";\n \n+/**\n+ * A utility for referencing Convex functions in your app's API.\n+ *\n+ * Usage:\n+ * ```js\n+ * const myFunctionReference = api.myModule.myFunction;\n+ * ```\n+ */\n declare const fullApi: ApiFromModules<{\n   apiKeys: typeof apiKeys;\n   backfill: typeof backfill;\n@@ -75,8 +83,8 @@ declare const fullApi: ApiFromModules<{\n   codeReview_http: typeof codeReview_http;\n   comments: typeof comments;\n   containerSettings: typeof containerSettings;\n-  crown: typeof crown;\n   \"crown/actions\": typeof crown_actions;\n+  crown: typeof crown;\n   crown_http: typeof crown_http;\n   environmentSnapshots: typeof environmentSnapshots;\n   environments: typeof environments;\n@@ -115,36 +123,20 @@ declare const fullApi: ApiFromModules<{\n   taskRuns_http: typeof taskRuns_http;\n   tasks: typeof tasks;\n   teams: typeof teams;\n-  users: typeof users;\n   \"users/utils/getWorkerAuth\": typeof users_utils_getWorkerAuth;\n   \"users/utils/index\": typeof users_utils_index;\n+  users: typeof users;\n   workspaceConfigs: typeof workspaceConfigs;\n   workspaceSettings: typeof workspaceSettings;\n }>;\n+declare const fullApiWithMounts: typeof fullApi;\n \n-/**\n- * A utility for referencing Convex functions in your app's public API.\n- *\n- * Usage:\n- * ```js\n- * const myFunctionReference = api.myModule.myFunction;\n- * ```\n- */\n export declare const api: FilterApi<\n-  typeof fullApi,\n+  typeof fullApiWithMounts,\n   FunctionReference<any, \"public\">\n >;\n-\n-/**\n- * A utility for referencing Convex functions in your app's internal API.\n- *\n- * Usage:\n- * ```js\n- * const myFunctionReference = internal.myModule.myFunction;\n- * ```\n- */\n export declare const internal: FilterApi<\n-  typeof fullApi,\n+  typeof fullApiWithMounts,\n   FunctionReference<any, \"internal\">\n >;\n \ndiff --git a/packages/convex/convex/_generated/server.d.ts b/packages/convex/convex/_generated/server.d.ts\nindex bec05e681..b5c682886 100644\n--- a/packages/convex/convex/_generated/server.d.ts\n+++ b/packages/convex/convex/_generated/server.d.ts\n@@ -10,6 +10,7 @@\n \n import {\n   ActionBuilder,\n+  AnyComponents,\n   HttpActionBuilder,\n   MutationBuilder,\n   QueryBuilder,\n@@ -18,9 +19,15 @@ import {\n   GenericQueryCtx,\n   GenericDatabaseReader,\n   GenericDatabaseWriter,\n+  FunctionReference,\n } from \"convex/server\";\n import type { DataModel } from \"./dataModel.js\";\n \n+type GenericCtx =\n+  | GenericActionCtx<DataModel>\n+  | GenericMutationCtx<DataModel>\n+  | GenericQueryCtx<DataModel>;\n+\n /**\n  * Define a query in this Convex app's public API.\n  *\n@@ -85,12 +92,11 @@ export declare const internalAction: ActionBuilder<DataModel, \"internal\">;\n /**\n  * Define an HTTP action.\n  *\n- * The wrapped function will be used to respond to HTTP requests received\n- * by a Convex deployment if the requests matches the path and method where\n- * this action is routed. Be sure to route your httpAction in `convex/http.js`.\n+ * This function will be used to respond to HTTP requests received by a Convex\n+ * deployment if the requests matches the path and method where this action\n+ * is routed. Be sure to route your action in `convex/http.js`.\n  *\n- * @param func - The function. It receives an {@link ActionCtx} as its first argument\n- * and a Fetch API `Request` object as its second.\n+ * @param func - The function. It receives an {@link ActionCtx} as its first argument.\n  * @returns The wrapped function. Import this function from `convex/http.js` and route it to hook it up.\n  */\n export declare const httpAction: HttpActionBuilder;\ndiff --git a/packages/convex/convex/_generated/server.js b/packages/convex/convex/_generated/server.js\nindex bf3d25ad3..4a21df4f7 100644\n--- a/packages/convex/convex/_generated/server.js\n+++ b/packages/convex/convex/_generated/server.js\n@@ -16,6 +16,7 @@ import {\n   internalActionGeneric,\n   internalMutationGeneric,\n   internalQueryGeneric,\n+  componentsGeneric,\n } from \"convex/server\";\n \n /**\n@@ -80,14 +81,10 @@ export const action = actionGeneric;\n export const internalAction = internalActionGeneric;\n \n /**\n- * Define an HTTP action.\n+ * Define a Convex HTTP action.\n  *\n- * The wrapped function will be used to respond to HTTP requests received\n- * by a Convex deployment if the requests matches the path and method where\n- * this action is routed. Be sure to route your httpAction in `convex/http.js`.\n- *\n- * @param func - The function. It receives an {@link ActionCtx} as its first argument\n- * and a Fetch API `Request` object as its second.\n- * @returns The wrapped function. Import this function from `convex/http.js` and route it to hook it up.\n+ * @param func - The function. It receives an {@link ActionCtx} as its first argument, and a `Request` object\n+ * as its second.\n+ * @returns The wrapped endpoint function. Route a URL path to this function in `convex/http.js`.\n  */\n export const httpAction = httpActionGeneric;\ndiff --git a/packages/shared/src/morph-snapshots.ts b/packages/shared/src/morph-snapshots.ts\nindex e63d76a8a..97b41db33 100644\n--- a/packages/shared/src/morph-snapshots.ts\n+++ b/packages/shared/src/morph-snapshots.ts\n@@ -78,7 +78,7 @@ const toPresetWithLatest = (\n   preset: MorphSnapshotPreset,\n ): MorphSnapshotPresetWithLatest => {\n   const sortedVersions = sortVersions(preset.versions);\n-  const latestVersion = sortedVersions.at(-1);\n+  const latestVersion = sortedVersions.length > 0 ? sortedVersions[sortedVersions.length - 1] : undefined;\n   if (!latestVersion) {\n     throw new Error(`Preset \"${preset.presetId}\" does not contain versions`);\n   }\n","comments":[{"type":"issue_comment","id":3592362881,"prNumber":1080,"botLogin":"cmux-agent-internal-dev[bot]","body":"[Open Workspace (expires in 30m)](https://cmux.sh/austin-dev/task/kn7eh8r9fax676c270g87t24197wcnt6) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1080)\n\n## Preview Story\n\nCaptured 11 screenshots for commit `a2dcea3` (2025-11-30 08:51:19.986 UTC).\n\n**Next.js / dependency sync + small generated/type updates (next16)**\n\n**Story**\n- Appears to be a Next.js-focused update (branch/pr title next16) with direct changes to apps/www/next.config.ts and apps/www/package.json — likely a framework/config tweak or migration.\n- Dependencies were updated significantly (bun.lock with many additions/removals) — lockfile drift or package bumps included.\n- apps/www/proxy.ts was renamed (file list shows a rename) — runtime import paths or server proxy behavior may be affected.\n- Convex-generated artifacts were modified (packages/convex/convex/_generated/*) — type and server stubs changed and need verification against backend schema.\n- Small config tweak in apps/www/.mcp.json and a trivial change in packages/shared/src/morph-snapshots.ts — likely CI/metadata and snapshot handling adjustments.\n\n**Review focus**\n- apps/www/next.config.ts — examine any new flags, redirects, rewrites, middleware, image or experimental config that could change runtime behavior or SSR/edge handling.\n- apps/www/package.json — check script changes, engines, and dependency version bumps that affect local dev, build, or deployment commands.\n- bun.lock — scan for major version changes (React, Next, Node-related libs, Webpack/Vite, runtime deps). Confirm lockfile matches package.json and CI toolchain (bun vs npm/pnpm/yarn).\n- apps/www/proxy.ts rename — search the repo for imports referencing the old path and verify server/proxy is registered where expected (dev and prod entrypoints).\n- packages/convex/convex/_generated/* (api.d.ts, server.d.ts, server.js) — ensure generated types match the deployed Convex schema; run typecheck and review any changed function signatures.\n- CI/infra file apps/www/.mcp.json — ensure any environment-specific changes (routes, build targets) are intentional and compatible with deploy pipeline.\n- Server vs client boundary changes — review any moved code or config that could cause server-only code to run in the browser (or vice versa) after Next config changes.\n- Break-on-imports / path changes — run a repo-wide search for renamed files/paths (proxy.ts) and confirm no unresolved imports remain.\n\n**Risks / unknowns**\n- Large dependency changes in bun.lock may introduce subtle runtime or minification differences — risk of runtime errors or different behavior between local/dev and CI/prod.\n- Renamed proxy.ts can produce 404s or failing API calls if runtime imports are stale or build cache not invalidated.\n- Generated Convex files updated — if types and server stubs are out of sync with the running backend, runtime API calls may break or cause type mismatches.\n- Next config tweaks (especially experimental/edge options) may change SSR/CSR behavior and cause hydration errors or different bundle outputs.\n\n**Test / verify**\n- Install dependencies and run a clean build: install (use your project’s package manager), then run the build command used in CI and verify it completes without warnings/errors.\n- Run the app locally in dev and in a production-like mode (dev server and built server) and smoke-test main pages (home/dashboard/settings) to catch hydration or SSR issues.\n- Exercise proxied endpoints: call any API routes that would go through apps/www/proxy.ts and confirm requests succeed and headers are preserved.\n- Run type-check (tsc) across the repo to catch any new type errors from updated generated Convex files.\n- Run unit and e2e tests (if present), and check visual snapshot tests (morph-snapshots) to identify unintended UI diffs.\n- Search the repo for references to the old proxy path and for any imports that might still reference pre-rename locations; fix or point reviewers to missing updates.\n- If CI uses bun, run the same commands with bun to mirror CI behavior (or confirm CI toolchain matches local instructions).\n\n**Evidence (11)**\n\n![App UI: top-level page layout and header](https://famous-camel-162.convex.cloud/api/storage/11cc2623-c4a2-4288-85a3-5e2d8030ab53)\n\n![App UI: navigation menu and sidebar visible](https://famous-camel-162.convex.cloud/api/storage/fda5807a-afff-433f-88d3-0d4911428f1f)\n\n![App UI: settings or preferences modal open](https://famous-camel-162.convex.cloud/api/storage/14adc1c8-524d-4e1f-ba40-5cfa3395f904)\n\n![App UI: dashboard or list view with items](https://famous-camel-162.convex.cloud/api/storage/397545e3-922f-4709-a5b3-18b1ffda6455)\n\n![App UI: content/editor area with controls](https://famous-camel-162.convex.cloud/api/storage/3122f5c2-b8a5-4cf6-95cb-14be389038cd)\n\n![App UI: confirmation dialog or popup](https://famous-camel-162.convex.cloud/api/storage/a7ecaf28-57dc-4caf-b814-45964f4a2f9c)\n\n![App UI: error or 404 page displayed](https://famous-camel-162.convex.cloud/api/storage/dfe8fa3b-081e-424a-bfaf-05689d2659b5)\n\n![Devtools/network: API request and response visible](https://famous-camel-162.convex.cloud/api/storage/032b466e-4918-42b4-ace1-269829f2f917)\n\n![Terminal/build output showing compile logs](https://famous-camel-162.convex.cloud/api/storage/d9103873-76b4-4eca-9e87-4fef05eb087b)\n\n![Auth screen or sign-in flow UI](https://famous-camel-162.convex.cloud/api/storage/a7e0ea7f-8303-4677-bfe7-af67bd1da562)\n\n![Visual snapshot diff or comparison screen](https://famous-camel-162.convex.cloud/api/storage/38829407-d752-4c61-99ad-4b68ac482647)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"229b8c319b7f4a7b2d1b03dce5dba4908e9004ab","createdAt":"2025-11-30T08:51:46Z","updatedAt":"2025-11-30T08:51:46Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1080#issuecomment-3592362881"},{"type":"issue_comment","id":3592365160,"prNumber":1080,"botLogin":"cmux-agent[bot]","body":"[Open Workspace](https://cmux.sh/manaflow/task/kn7dwr3krecd2h6ae2zzt39wdh7wdk26) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1080)\n\n## Preview Screenshots\n\nSuccessfully captured 10 screenshot(s) for commit `0715d4a`:\n\n### framework-icons-dark-mode-detail-next16.png\n![framework-icons-dark-mode-detail-next16.png](https://adorable-wombat-701.convex.cloud/api/storage/50067036-7992-41a6-ab03-3e47f19e706e)\n\n### framework-icons-dark-mode-next16.png\n![framework-icons-dark-mode-next16.png](https://adorable-wombat-701.convex.cloud/api/storage/3f68f44f-0cbf-4b7d-a9e8-9de56a94a740)\n\n### framework-icons-detail-overview-next16.png\n![framework-icons-detail-overview-next16.png](https://adorable-wombat-701.convex.cloud/api/storage/dd367fe2-2ddd-4fa7-9992-416110975e4f)\n\n### framework-icons-detail-viewport-next16.png\n![framework-icons-detail-viewport-next16.png](https://adorable-wombat-701.convex.cloud/api/storage/d52409be-943b-498a-8a5a-edd7d026ba70)\n\n### framework-icons-grid-next16.png\n![framework-icons-grid-next16.png](https://adorable-wombat-701.convex.cloud/api/storage/39856089-6867-44f9-b9fd-c6ead403dd99)\n\n### framework-icons-overview-next16.png\n![framework-icons-overview-next16.png](https://adorable-wombat-701.convex.cloud/api/storage/0070e7e8-13af-480e-b976-ab0f6ede013b)\n\n### framework-icons-viewport-next16.png\n![framework-icons-viewport-next16.png](https://adorable-wombat-701.convex.cloud/api/storage/3927f5d5-05eb-4fe0-b35f-00da872d8593)\n\n### homepage-next16.png\n![homepage-next16.png](https://adorable-wombat-701.convex.cloud/api/storage/210cb5bb-265f-4ab7-8da5-c203c3ce7222)\n\n### preview-dashboard-next16.png\n![preview-dashboard-next16.png](https://adorable-wombat-701.convex.cloud/api/storage/d45b8c9f-d239-428b-927e-fafc1c6b3c7d)\n\n### preview-dashboard-viewport-next16.png\n![preview-dashboard-viewport-next16.png](https://adorable-wombat-701.convex.cloud/api/storage/d3cf083c-cdda-4e9f-bfd2-ad43171d6cab)\n\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"229b8c319b7f4a7b2d1b03dce5dba4908e9004ab","createdAt":"2025-11-30T08:55:33Z","updatedAt":"2025-11-30T08:55:33Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1080#issuecomment-3592365160"},{"type":"issue_comment","id":3592368625,"prNumber":1080,"botLogin":"cmux-agent-internal-dev[bot]","body":"[Open Workspace (expires in 30m)](https://cmux.sh/austin-dev/task/kn7bzhfcdfemys22q5dbh223ax7wd6ng) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1080)\n\n## Preview Story\n\nCaptured 6 screenshots for commit `0715d4a` (2025-11-30 09:01:23.903 UTC).\n\n**Next.js config + lockfile + Convex codegen updates — verify build, runtime types, and proxy rename**\n\n**Story**\n- Updated Next.js app configuration and deployment metadata (apps/www/next.config.ts, apps/www/.mcp.json).\n- Renamed apps/www/proxy.ts (file moved/renamed) — imports calling it may need updates.\n- package.json edits alongside a large bun.lock change — dependency graph changed significantly (bun.lock +197 -79).\n- Convex generated client/server types and server.js updated (packages/convex/_generated/*) — API surface or types may have shifted.\n- Small snapshot/morph change in packages/shared/src/morph-snapshots.ts; 6 UI screenshots captured for visual verification.\n\n**Review focus**\n- apps/www/next.config.ts — inspect every config key changed (rewrites/redirects/middleware, experimental flags, image/domains, basePath). Verify SSR/SSG settings and any alterations to build-time behavior or environment variable usage.\n- apps/www/proxy.ts (renamed) — search the repo for imports referencing the old path/name. Confirm server/serverless entry points and middleware use the new path and that exports match previous API surface.\n- bun.lock and package.json — review dependency bumps/rollbacks for native modules or major version changes. Ensure lockfile was generated with the same package manager CI expects (bun vs npm/pnpm/yarn).\n- packages/convex/convex/_generated/* — compare generated server.d.ts/server.js and api.d.ts diffs to confirm no breaking type/signature changes for callers. If the PR updates codegen runtime, make sure runtime version alignment is correct.\n- apps/www/.mcp.json — check deployment/runtime metadata (build commands, routes, environment) for unintended changes that could affect builds or hosting.\n- Tests and typechecks — run typecheck and unit tests to catch signature mismatches introduced by generated file changes.\n- Screenshots — match UI flows shown in screenshots to the changed code (snapshots change + UI files). Look for unexpected visual regressions.\n\n**Risks / unknowns**\n- Large lockfile churn could introduce dependency regressions or CI mismatch if CI uses a different package manager or lockfile. Potential for native module binary incompatibilities.\n- Renaming proxy.ts risks broken imports or runtime errors in dev/production middleware if some import paths were missed.\n- Convex codegen changes can cause runtime failures if server/client expectations diverge (missing handlers, changed arg types).\n- Next config changes can break routing, image optimization, or SSR behavior leading to production 500s or incorrect static rendering.\n\n**Test / verify**\n- Locally: clean install (use same package manager as CI), run full build: apps/www > npm run build && npm start (or bun equivalent) to catch build/runtime errors.\n- Start dev server and exercise key routes and API endpoints used by the UI in screenshots (forms, lists, modals).\n- Run TypeScript check at repo root (tsc --noEmit) to catch type errors from generated files.\n- Run unit/integration tests and any e2e tests (Cypress/Playwright) for flows shown in screenshots: login, item list, form submit, modal open/close.\n- Search repo for old proxy path/name to ensure no remaining references; run project-wide grep for 'proxy.ts' and the previous filename.\n- Compare Convex generated types against backend schema: call a few server endpoints in dev to ensure shapes match and handlers exist.\n\n**Evidence (6)**\n\n![App header and top navigation view](https://famous-camel-162.convex.cloud/api/storage/54d53a70-a388-47bb-89bb-8c1a1e4561a5)\n\n![List or table view showing primary content](https://famous-camel-162.convex.cloud/api/storage/2d83fd16-2d12-42eb-9db3-0d8f11d79f3c)\n\n![Modal or dialog overlay visible on screen](https://famous-camel-162.convex.cloud/api/storage/644ef9b7-3dd3-4b20-9195-ab05cd60ec09)\n\n![Form input and submission area with controls](https://famous-camel-162.convex.cloud/api/storage/31eb1e21-ec12-42f7-b3aa-d068627f0446)\n\n![Empty state or inline error message visible](https://famous-camel-162.convex.cloud/api/storage/fe1c7171-66c2-42fa-8058-a28e41479997)\n\n![Responsive layout or mobile-sized viewport](https://famous-camel-162.convex.cloud/api/storage/39f3a78b-b668-405d-bda3-b8702d53dd7b)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"229b8c319b7f4a7b2d1b03dce5dba4908e9004ab","createdAt":"2025-11-30T09:01:45Z","updatedAt":"2025-11-30T09:01:45Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1080#issuecomment-3592368625"},{"type":"issue_comment","id":3593266086,"prNumber":1080,"botLogin":"cmux-agent[bot]","body":"[Open Workspace](https://cmux.sh/manaflow/task/kn789fnp3sh28e8z0q93sgwa117wcq2a) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1080)\n\n## Preview Screenshots\n\nSuccessfully captured 4 screenshot(s) for commit `229b8c3`:\n\n### framework-logo-next-svg.png\n![framework-logo-next-svg.png](https://adorable-wombat-701.convex.cloud/api/storage/2028f895-69c9-4ffd-8a80-cbc2143c3ab2)\n\n### framework-logos-demo-page.png\n![framework-logos-demo-page.png](https://adorable-wombat-701.convex.cloud/api/storage/102355ac-dabd-4e03-974a-bccafed8183f)\n\n### preview-main-page.png\n![preview-main-page.png](https://adorable-wombat-701.convex.cloud/api/storage/bdaf9316-304b-4ebd-935a-4d678f480b38)\n\n### preview-page-final.png\n![preview-page-final.png](https://adorable-wombat-701.convex.cloud/api/storage/c03133ca-fa38-49f4-b686-1359d08faa31)\n\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"229b8c319b7f4a7b2d1b03dce5dba4908e9004ab","createdAt":"2025-11-30T20:11:07Z","updatedAt":"2025-11-30T20:11:07Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1080#issuecomment-3593266086"},{"type":"issue_comment","id":3593267258,"prNumber":1080,"botLogin":"cmux-agent-internal-dev[bot]","body":"[Open Workspace (expires in 30m)](https://cmux.sh/austin-dev/task/kn74rgh56wn1gkh2vdg0t8faps7wd9by) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1080)\n\n## Preview Story\n\nCaptured 12 screenshots for commit `229b8c3` (2025-11-30 20:11:02.111 UTC).\n\n**ESLint -> native flat config; minor app/config updates**\n\n**Story**\n- Replaces FlatCompat with native flat config for ESLint 9 to remove circular-reference errors when extending next/core-web-vitals.\n- Deletes the deprecated ignore file for the app and updates lint config, package metadata, and related build/dev config.\n- Large lockfile churn and small generated-type tweaks included — mostly mechanical changes from dependency updates and codegen.\n- A file was renamed for proxy logic; next config was trimmed/modified. Changes are scoped primarily to the www app and tooling.\n\n**Review focus**\n- Verify eslint.config.js now uses native flat config syntax and that no FlatCompat imports remain anywhere in the repo (search for FlatCompat or 'flat' helpers).\n- Confirm that extending next/core-web-vitals no longer causes circular-reference errors by running the linter with the new config (see Test Ideas).\n- Check CI lint job configuration (pipeline or workflow) — ensure it runs with the updated ESLint v9 config and the same node/package-manager environment used locally.\n- Confirm removal of the ignore file is intentional: scan previously-ignored paths to ensure nothing that should be excluded from linting is now noisy (e.g., generated code, build artifacts).\n- Inspect the next/build config changes carefully — ensure removed/changed keys don't drop essential runtime settings (rewrites, headers, image domains, experimental flags).\n- Validate the proxy rename: confirm imports/exports are updated to the new name and server-start/dev proxy behavior still works (search for imports of the old name).\n- Review bun.lock diff for unexpected dependency upgrades (esp. ESLint, parser, Next.js, typescript, plugins) and ensure no breaking major-version bumps were introduced inadvertently.\n- Check generated type files changed by codegen — ensure types remain consistent and not accidentally hand-edited; re-run codegen if in doubt.\n\n**Risks / unknowns**\n- Deleting the ignore file may cause linter noise or slow local/CI runs if generated or node_modules files are linted.\n- Lockfile changes could pull in incompatible transitive dependency versions causing subtle runtime or devtooling breakages (esp. ESLint or Next.js related packages).\n- Renamed proxy file may leave a stale import/reference causing runtime failures only in certain environments (dev vs prod).\n- Native flat config can change rule resolution/order compared to FlatCompat — some rules may behave differently or stop applying.\n\n**Test / verify**\n- Run full lint locally: npm/yarn/bun install → run the project's eslint command used by CI: `pnpm -w eslint` or the script in package.json; confirm no circular-reference error and rules apply as expected.\n- Run the app dev server and a production build: `npm/yarn/bun install` → `next dev` and `next build && next start` (or repo's dev/build commands); smoke-test key pages in browser and check console for runtime errors.\n- Re-run CI lint job locally or via workflow dispatch if available; confirm the CI runner uses the same node and package-manager version as lockfile authoring to reproduce lockfile behavior.\n- Search the repo for references to the old proxy name and FlatCompat: `git grep -n 'FlatCompat\\|flatCompat\\|proxy.ts oldname'` — fix any misses.\n- Run TypeScript build or typecheck (tsc) to surface any typing regressions from generated file changes.\n- If codegen produced the generated types, re-run the generator script to ensure deterministic output and that changes are expected.\n\n**Evidence (12)**\n\n![Diff view of ESLint configuration changes in PR UI](https://famous-camel-162.convex.cloud/api/storage/39026963-2df2-42e6-aa41-ed9fba2e3e36)\n\n![Showed deletion of a lint ignore file from the app](https://famous-camel-162.convex.cloud/api/storage/cc909e35-75a2-4a60-befa-66778f696df8)\n\n![Package manifest diff highlighting script/dependency edits](https://famous-camel-162.convex.cloud/api/storage/c322ec6d-3468-4fca-8bf2-884815227e1e)\n\n![Lockfile diff with many dependency updates](https://famous-camel-162.convex.cloud/api/storage/aa02c646-4db0-40a9-8301-5c3271d8b417)\n\n![Diff showing Next config modifications in the app](https://famous-camel-162.convex.cloud/api/storage/b336c014-317a-45ee-ab84-5b7a87ef091e)\n\n![File tree view showing a renamed proxy implementation](https://famous-camel-162.convex.cloud/api/storage/6a1cb2dc-307f-4d1d-97ce-9e0c82b72cf9)\n\n![IDE/editor view of lint rule lines affected by the change](https://famous-camel-162.convex.cloud/api/storage/4bd745e4-aa4a-401e-a309-6c0d30bb2df4)\n\n![Terminal output of linter run (showing pass/fail)](https://famous-camel-162.convex.cloud/api/storage/157381b7-0029-4edb-8162-ea2be8275e99)\n\n![Browser screenshot of app homepage for smoke test](https://famous-camel-162.convex.cloud/api/storage/06a5f78e-ae5e-4c5f-9c57-894d9f53f5fc)\n\n![Diff of generated type definitions updated by codegen](https://famous-camel-162.convex.cloud/api/storage/48e3a86d-eda1-4cb2-ad69-3056a2e9d84d)\n\n![PR file-changes summary in the UI](https://famous-camel-162.convex.cloud/api/storage/cba8dc0d-6c0a-4da1-888d-061f79736215)\n\n![PR description and commit message panel in review UI](https://famous-camel-162.convex.cloud/api/storage/7c3539e0-a893-4125-a24c-c309ba459888)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"229b8c319b7f4a7b2d1b03dce5dba4908e9004ab","createdAt":"2025-11-30T20:11:37Z","updatedAt":"2025-11-30T20:11:37Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1080#issuecomment-3593267258"}]}
{"number":1075,"title":"Move complete items to ready-to-review","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1075","headRef":"cmux/move-complete-items-to-ready-to-review-d0guf","headSha":"efd8fbcc8ad540d62a7291419784f9b578ca1579","baseRef":"main","baseSha":"b8d8b04c9557898dd381f5a59b5755dd603a6791","createdAt":"2025-11-30T06:49:20Z","updatedAt":"2025-11-30T06:55:47Z","diff":"diff --git a/packages/convex/convex/preview_jobs_http.ts b/packages/convex/convex/preview_jobs_http.ts\nindex 2d6329a2f..6195c8826 100644\n--- a/packages/convex/convex/preview_jobs_http.ts\n+++ b/packages/convex/convex/preview_jobs_http.ts\n@@ -34,6 +34,10 @@ async function markPreviewTaskCompleted(\n \n   const taskAlreadyCompleted = task.isCompleted === true;\n   if (!taskAlreadyCompleted) {\n+    await ctx.runMutation(internal.tasks.setCrownEvaluationStatusInternal, {\n+      taskId: task._id,\n+      status: \"succeeded\",\n+    });\n     await ctx.runMutation(internal.tasks.setCompletedInternal, {\n       taskId: task._id,\n       isCompleted: true,\n","comments":[{"type":"issue_comment","id":3592286355,"prNumber":1075,"botLogin":"cmux-agent[bot]","body":"[Open Workspace](https://cmux.sh/manaflow/task/kn7fwyvq386xnr319kgx7fpne57wcdky) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1075)\n\n## Preview Screenshots\n\nSuccessfully captured 7 screenshot(s) for commit `efd8fbc`:\n\n### dashboard-main-view.png\n![dashboard-main-view.png](https://adorable-wombat-701.convex.cloud/api/storage/ff072339-c837-4136-ac67-f842ea75d798)\n\n### dashboard-start-task-button.png\n![dashboard-start-task-button.png](https://adorable-wombat-701.convex.cloud/api/storage/7d2bbac2-bc0d-4b23-a3a3-453fd2aa52b0)\n\n### dashboard-task-input-area.png\n![dashboard-task-input-area.png](https://adorable-wombat-701.convex.cloud/api/storage/3bdaadbd-ef21-4354-b68a-98cfffab8ccd)\n\n### preview-dashboard-configured-repos-heading.png\n![preview-dashboard-configured-repos-heading.png](https://adorable-wombat-701.convex.cloud/api/storage/e392e8ed-42eb-412c-91aa-660e8946cc9a)\n\n### preview-dashboard-full-page.png\n![preview-dashboard-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/a2b1c628-e2f0-4909-a44e-d063ec6d924a)\n\n### preview-dashboard-github-app-loading.png\n![preview-dashboard-github-app-loading.png](https://adorable-wombat-701.convex.cloud/api/storage/1e677b83-eb46-4709-98d6-c9664449a2f3)\n\n### preview-dashboard-team-selector.png\n![preview-dashboard-team-selector.png](https://adorable-wombat-701.convex.cloud/api/storage/421fb982-7346-4978-ac8e-52fb3bb678aa)\n\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"efd8fbcc8ad540d62a7291419784f9b578ca1579","createdAt":"2025-11-30T06:53:16Z","updatedAt":"2025-11-30T06:53:16Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1075#issuecomment-3592286355"},{"type":"issue_comment","id":3592287425,"prNumber":1075,"botLogin":"cmux-agent-internal-dev[bot]","body":"[Open Workspace](https://cmux.sh/austin-dev/task/kn77gbn3g656x96fqymx4pe0bd7wdrvq) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1075)\n\n## Preview Screenshots\n\nSuccessfully captured 3 screenshot(s) for commit `efd8fbc`:\n\n### dashboard-full-page.png\n![dashboard-full-page.png](https://famous-camel-162.convex.cloud/api/storage/817f2eb9-396b-4a7b-a706-6b0407a09240)\n\n### settings-full-page.png\n![settings-full-page.png](https://famous-camel-162.convex.cloud/api/storage/8301a29d-c8c6-49ac-a874-b9afb17f4a9b)\n\n### task-detail-page-timeline.png\n![task-detail-page-timeline.png](https://famous-camel-162.convex.cloud/api/storage/a25fa7e8-057c-441e-8468-147a7f9e10f1)\n\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"efd8fbcc8ad540d62a7291419784f9b578ca1579","createdAt":"2025-11-30T06:55:47Z","updatedAt":"2025-11-30T06:55:47Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1075#issuecomment-3592287425"}]}
{"number":1074,"title":"works without unnecessary info in previewRuns","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1074","headRef":"cmux/migrate-preview-set-to-taskrun-set","headSha":"16d53b8d646015962481d20ee796adf09b9ce8ce","baseRef":"main","baseSha":"1c621ad69bc4d03e2cd2bafb703277a65a6cb722","createdAt":"2025-11-30T06:33:21Z","updatedAt":"2025-11-30T06:47:57Z","diff":"diff --git a/apps/www/lib/routes/preview.route.ts b/apps/www/lib/routes/preview.route.ts\nindex 3635784d7..03e8574c2 100644\n--- a/apps/www/lib/routes/preview.route.ts\n+++ b/apps/www/lib/routes/preview.route.ts\n@@ -49,7 +49,6 @@ const PreviewRunSchema = z\n     headSha: z.string(),\n     baseSha: z.string().optional().nullable(),\n     status: z.enum([\"pending\", \"running\", \"completed\", \"failed\", \"skipped\"]),\n-    stateReason: z.string().optional().nullable(),\n     createdAt: z.number(),\n     updatedAt: z.number(),\n     dispatchedAt: z.number().optional().nullable(),\n@@ -89,7 +88,6 @@ function formatPreviewRun(run: PreviewRunDoc) {\n     headSha: run.headSha,\n     baseSha: run.baseSha ?? null,\n     status: run.status,\n-    stateReason: run.stateReason ?? null,\n     createdAt: run.createdAt,\n     updatedAt: run.updatedAt,\n     dispatchedAt: run.dispatchedAt ?? null,\ndiff --git a/packages/convex/convex/github_pr_comments.ts b/packages/convex/convex/github_pr_comments.ts\nindex e2bd802d4..0ef6879c1 100644\n--- a/packages/convex/convex/github_pr_comments.ts\n+++ b/packages/convex/convex/github_pr_comments.ts\n@@ -714,7 +714,6 @@ export const postPreviewCommentWithTaskScreenshots = internalAction({\n       await ctx.runMutation(internal.previewRuns.updateStatus, {\n         previewRunId,\n         status: screenshotSet.status as \"completed\" | \"failed\" | \"skipped\",\n-        stateReason: screenshotSet.error,\n         screenshotSetId: taskRun.latestScreenshotSetId,\n         githubCommentUrl: data.html_url ?? previewRun.githubCommentUrl,\n         githubCommentId: data.id ?? previewRun.githubCommentId,\ndiff --git a/packages/convex/convex/previewRuns.ts b/packages/convex/convex/previewRuns.ts\nindex 3cfc4e92d..2e3a4eb70 100644\n--- a/packages/convex/convex/previewRuns.ts\n+++ b/packages/convex/convex/previewRuns.ts\n@@ -53,7 +53,6 @@ export const enqueueFromWebhook = internalMutation({\n       headRepoFullName,\n       headRepoCloneUrl: args.headRepoCloneUrl,\n       status: \"pending\",\n-      stateReason: undefined,\n       dispatchedAt: undefined,\n       startedAt: undefined,\n       completedAt: undefined,\n@@ -115,7 +114,6 @@ export const updateStatus = internalMutation({\n       v.literal(\"failed\"),\n       v.literal(\"skipped\"),\n     ),\n-    stateReason: v.optional(v.string()),\n     screenshotSetId: v.optional(v.id(\"taskRunScreenshotSets\")),\n     githubCommentUrl: v.optional(v.string()),\n     githubCommentId: v.optional(v.number()),\n@@ -128,7 +126,6 @@ export const updateStatus = internalMutation({\n     const now = Date.now();\n     const patch: Record<string, unknown> = {\n       status: args.status,\n-      stateReason: args.stateReason,\n       screenshotSetId: args.screenshotSetId,\n       githubCommentUrl: args.githubCommentUrl ?? run.githubCommentUrl,\n       githubCommentId: args.githubCommentId ?? run.githubCommentId,\n@@ -143,37 +140,6 @@ export const updateStatus = internalMutation({\n   },\n });\n \n-export const updateInstanceMetadata = internalMutation({\n-  args: {\n-    previewRunId: v.id(\"previewRuns\"),\n-    morphInstanceId: v.optional(v.string()),\n-    morphInstanceStoppedAt: v.optional(v.number()),\n-    clearStoppedAt: v.optional(v.boolean()),\n-  },\n-  handler: async (ctx, args) => {\n-    const run = await ctx.db.get(args.previewRunId);\n-    if (!run) {\n-      throw new Error(\"Preview run not found\");\n-    }\n-\n-    const patch: Record<string, unknown> = {\n-      updatedAt: Date.now(),\n-    };\n-\n-    if (\"morphInstanceId\" in args) {\n-      patch.morphInstanceId = args.morphInstanceId;\n-    }\n-\n-    if (args.clearStoppedAt) {\n-      patch.morphInstanceStoppedAt = undefined;\n-    } else if (\"morphInstanceStoppedAt\" in args) {\n-      patch.morphInstanceStoppedAt = args.morphInstanceStoppedAt;\n-    }\n-\n-    await ctx.db.patch(run._id, patch);\n-  },\n-});\n-\n export const getById = internalQuery({\n   args: {\n     id: v.id(\"previewRuns\"),\ndiff --git a/packages/convex/convex/preview_jobs.ts b/packages/convex/convex/preview_jobs.ts\nindex 476334596..9a2fd7327 100644\n--- a/packages/convex/convex/preview_jobs.ts\n+++ b/packages/convex/convex/preview_jobs.ts\n@@ -12,27 +12,43 @@ export const stopPreviewInstance = internalAction({\n     previewRunId: v.id(\"previewRuns\"),\n   },\n   handler: async (ctx, { previewRunId }) => {\n-    const previewRun = await ctx.runQuery(internal.previewRuns.getById, {\n-      id: previewRunId,\n-    });\n+    const previewRun = await ctx.runQuery(internal.previewRuns.getById, { id: previewRunId });\n+    if (!previewRun) {\n+      console.warn(\"[preview-jobs] Preview run not found when stopping instance\", {\n+        previewRunId,\n+      });\n+      return;\n+    }\n \n-    if (!previewRun?.morphInstanceId) {\n+    if (!previewRun.taskRunId) {\n+      console.warn(\"[preview-jobs] Preview run missing taskRunId, cannot stop instance\", {\n+        previewRunId: previewRun._id,\n+      });\n       return;\n     }\n-    if (previewRun.morphInstanceStoppedAt) {\n-      console.log(\"[preview-jobs] Morph instance already stopped\", {\n+\n+    const taskRun = await ctx.runQuery(internal.taskRuns.getById, {\n+      id: previewRun.taskRunId,\n+    });\n+\n+    const containerName = taskRun?.vscode?.containerName;\n+    const provider = taskRun?.vscode?.provider ?? \"morph\";\n+\n+    if (!taskRun || !containerName) {\n+      console.warn(\"[preview-jobs] Task run missing Morph container info\", {\n         previewRunId: previewRun._id,\n-        morphInstanceId: previewRun.morphInstanceId,\n+        taskRunId: previewRun.taskRunId,\n       });\n       return;\n     }\n+\n     const morphApiKey = process.env.MORPH_API_KEY;\n     if (!morphApiKey) {\n       console.warn(\n         \"[preview-jobs] Cannot stop Morph instance without MORPH_API_KEY\",\n         {\n           previewRunId: previewRun._id,\n-          morphInstanceId: previewRun.morphInstanceId,\n+          taskRunId: taskRun._id,\n         }\n       );\n       return;\n@@ -44,50 +60,38 @@ export const stopPreviewInstance = internalAction({\n     try {\n       await stopInstanceInstanceInstanceIdDelete({\n         client: morphClient,\n-        path: { instance_id: previewRun.morphInstanceId },\n+        path: { instance_id: containerName },\n       });\n     } catch (error) {\n       console.error(\"[preview-jobs] Failed to stop Morph instance\", {\n         previewRunId: previewRun._id,\n-        morphInstanceId: previewRun.morphInstanceId,\n+        taskRunId: taskRun._id,\n+        containerName,\n         error,\n       });\n     }\n \n     try {\n-      await ctx.runMutation(internal.previewRuns.updateInstanceMetadata, {\n-        previewRunId: previewRun._id,\n-        morphInstanceStoppedAt: stoppedAt,\n+      await ctx.runMutation(internal.taskRuns.updateVSCodeMetadataInternal, {\n+        taskRunId: taskRun._id,\n+        vscode: {\n+          provider,\n+          status: \"stopped\",\n+          containerName,\n+          stoppedAt,\n+        },\n+        networking: [],\n       });\n     } catch (error) {\n-      console.error(\"[preview-jobs] Failed to record Morph instance stop time\", {\n-        previewRunId: previewRun._id,\n-        error,\n-      });\n-    }\n-\n-    if (previewRun.taskRunId) {\n-      try {\n-        await ctx.runMutation(internal.taskRuns.updateVSCodeMetadataInternal, {\n-          taskRunId: previewRun.taskRunId,\n-          vscode: {\n-            provider: \"morph\",\n-            status: \"stopped\",\n-            containerName: previewRun.morphInstanceId,\n-            stoppedAt,\n-          },\n-          networking: [],\n-        });\n-      } catch (error) {\n-        console.error(\n-          \"[preview-jobs] Failed to update task run VSCode metadata after stop\",\n-          {\n-            previewRunId: previewRun._id,\n-            taskRunId: previewRun.taskRunId,\n-            error,\n-          }\n-        );\n-      }\n+      console.error(\n+        \"[preview-jobs] Failed to update task run VSCode metadata after stop\",\n+        {\n+          previewRunId: previewRun._id,\n+          taskRunId: taskRun._id,\n+          containerName,\n+          error,\n+        }\n+      );\n     }\n   },\n });\ndiff --git a/packages/convex/convex/preview_jobs_http.ts b/packages/convex/convex/preview_jobs_http.ts\nindex 78a336484..2d6329a2f 100644\n--- a/packages/convex/convex/preview_jobs_http.ts\n+++ b/packages/convex/convex/preview_jobs_http.ts\n@@ -126,10 +126,9 @@ export const updatePreviewStatus = httpAction(async (ctx, req) => {\n     return jsonResponse({ error: \"Missing required fields\" }, 400);\n   }\n \n-  const { previewRunId, status, stateReason, screenshotSetId } = body as {\n+  const { previewRunId, status, screenshotSetId } = body as {\n     previewRunId: string;\n     status: string;\n-    stateReason?: string;\n     screenshotSetId?: string;\n   };\n \n@@ -147,7 +146,6 @@ export const updatePreviewStatus = httpAction(async (ctx, req) => {\n     await ctx.runMutation(internal.previewRuns.updateStatus, {\n       previewRunId: previewRunId as Id<\"previewRuns\">,\n       status: status as \"running\" | \"completed\" | \"failed\" | \"skipped\",\n-      stateReason,\n       screenshotSetId: screenshotSetId as Id<\"taskRunScreenshotSets\"> | undefined,\n     });\n \n@@ -324,7 +322,6 @@ export const completePreviewJob = httpAction(async (ctx, req) => {\n       await ctx.runMutation(internal.previewRuns.updateStatus, {\n         previewRunId: previewRun._id,\n         status: \"skipped\",\n-        stateReason: \"No screenshots available\",\n       });\n \n       const taskCompletion = await markPreviewTaskCompleted(ctx, taskRun, task);\ndiff --git a/packages/convex/convex/preview_jobs_worker.ts b/packages/convex/convex/preview_jobs_worker.ts\nindex 62d3f775f..74bf57d0c 100644\n--- a/packages/convex/convex/preview_jobs_worker.ts\n+++ b/packages/convex/convex/preview_jobs_worker.ts\n@@ -570,7 +570,6 @@ export async function runPreviewJob(\n     await ctx.runMutation(internal.previewRuns.updateStatus, {\n       previewRunId,\n       status: \"failed\",\n-      stateReason: \"Morph API key is not configured\",\n     });\n     return;\n   }\n@@ -597,7 +596,6 @@ export async function runPreviewJob(\n     await ctx.runMutation(internal.previewRuns.updateStatus, {\n       previewRunId,\n       status: \"failed\",\n-      stateReason: \"Convex URL is not configured for preview screenshots\",\n     });\n     return;\n   }\n@@ -614,7 +612,6 @@ export async function runPreviewJob(\n     await ctx.runMutation(internal.previewRuns.updateStatus, {\n       previewRunId,\n       status: \"skipped\",\n-      stateReason: \"No environment configured for preview run\",\n     });\n     return;\n   }\n@@ -631,7 +628,6 @@ export async function runPreviewJob(\n     await ctx.runMutation(internal.previewRuns.updateStatus, {\n       previewRunId,\n       status: \"skipped\",\n-      stateReason: \"Environment not found for preview run\",\n     });\n     return;\n   }\n@@ -644,7 +640,6 @@ export async function runPreviewJob(\n     await ctx.runMutation(internal.previewRuns.updateStatus, {\n       previewRunId,\n       status: \"skipped\",\n-      stateReason: \"Environment has no associated Morph snapshot\",\n     });\n     return;\n   }\n@@ -723,7 +718,6 @@ export async function runPreviewJob(\n   await ctx.runMutation(internal.previewRuns.updateStatus, {\n     previewRunId,\n     status: \"running\",\n-    stateReason: \"Provisioning Morph workspace\",\n   });\n \n   try {\n@@ -780,12 +774,6 @@ export async function runPreviewJob(\n       ? `${vscodeService.url}?folder=/root/workspace`\n       : null;\n \n-    await ctx.runMutation(internal.previewRuns.updateInstanceMetadata, {\n-      previewRunId,\n-      morphInstanceId: instance.id,\n-      clearStoppedAt: true,\n-    });\n-\n     console.log(\"[preview-jobs] Worker service ready\", {\n       previewRunId,\n       instanceId: instance.id,\n@@ -833,7 +821,6 @@ export async function runPreviewJob(\n     await ctx.runMutation(internal.previewRuns.updateStatus, {\n       previewRunId,\n       status: \"running\",\n-      stateReason: \"Fetching latest changes\",\n     });\n \n     // The repository is always at /root/workspace directly\n@@ -1038,7 +1025,6 @@ export async function runPreviewJob(\n     await ctx.runMutation(internal.previewRuns.updateStatus, {\n       previewRunId,\n       status: \"running\",\n-      stateReason: \"Checking out PR commit\",\n     });\n \n     const checkoutCmd = run.headRef\n@@ -1087,7 +1073,6 @@ export async function runPreviewJob(\n     await ctx.runMutation(internal.previewRuns.updateStatus, {\n       previewRunId,\n       status: \"running\",\n-      stateReason: \"Setting up environment and triggering screenshots\",\n     });\n \n     if (taskRunId && previewJwt) {\n@@ -1248,7 +1233,6 @@ export async function runPreviewJob(\n       await ctx.runMutation(internal.previewRuns.updateStatus, {\n         previewRunId,\n         status: \"failed\",\n-        stateReason: message,\n       });\n     } catch (statusError) {\n       console.error(\"[preview-jobs] Failed to update preview status\", {\ndiff --git a/packages/convex/convex/schema.ts b/packages/convex/convex/schema.ts\nindex 20d356240..2ae00348a 100644\n--- a/packages/convex/convex/schema.ts\n+++ b/packages/convex/convex/schema.ts\n@@ -588,15 +588,12 @@ const convexSchema = defineSchema({\n       v.literal(\"failed\"),\n       v.literal(\"skipped\"),\n     ),\n-    stateReason: v.optional(v.string()),\n     dispatchedAt: v.optional(v.number()),\n     startedAt: v.optional(v.number()),\n     completedAt: v.optional(v.number()),\n     screenshotSetId: v.optional(v.id(\"taskRunScreenshotSets\")),\n     githubCommentUrl: v.optional(v.string()),\n     githubCommentId: v.optional(v.number()),\n-    morphInstanceId: v.optional(v.string()),\n-    morphInstanceStoppedAt: v.optional(v.number()),\n     createdAt: v.number(),\n     updatedAt: v.number(),\n   })\ndiff --git a/packages/www-openapi-client/src/client/types.gen.ts b/packages/www-openapi-client/src/client/types.gen.ts\nindex c22b65e6a..cde256d57 100644\n--- a/packages/www-openapi-client/src/client/types.gen.ts\n+++ b/packages/www-openapi-client/src/client/types.gen.ts\n@@ -678,7 +678,6 @@ export type PreviewRun = {\n     headSha: string;\n     baseSha?: string | null;\n     status: 'pending' | 'running' | 'completed' | 'failed' | 'skipped';\n-    stateReason?: string | null;\n     createdAt: number;\n     updatedAt: number;\n     dispatchedAt?: number | null;\n","comments":[{"type":"issue_comment","id":3592283744,"prNumber":1074,"botLogin":"cmux-agent-internal-dev[bot]","body":"[Open Workspace](https://cmux.sh/austin-dev/task/kn7d5hbsyt88ganh6dnw2ep8cd7wdfae) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1074)\n\n## Preview Screenshots\n\nSuccessfully captured 9 screenshot(s) for commit `16d53b8`:\n\n### preview-configure-details-expanded-full.png\n![preview-configure-details-expanded-full.png](https://famous-camel-162.convex.cloud/api/storage/a4229df9-e951-4358-a166-464bc79d1864)\n\n### preview-configure-details-expanded.png\n![preview-configure-details-expanded.png](https://famous-camel-162.convex.cloud/api/storage/8326ceba-aa9a-4d67-bc0a-bed4fc67c2c4)\n\n### preview-configure-full-page.png\n![preview-configure-full-page.png](https://famous-camel-162.convex.cloud/api/storage/231250ad-1e7d-48b6-af76-e4e051e2ab9b)\n\n### preview-configure-viewport.png\n![preview-configure-viewport.png](https://famous-camel-162.convex.cloud/api/storage/e88cd81c-51a9-472f-a4b7-8f6ca9af2dc8)\n\n### preview-configure-workspace-ready.png\n![preview-configure-workspace-ready.png](https://famous-camel-162.convex.cloud/api/storage/dc47a253-5e6f-4615-8c14-586ace62a228)\n\n### preview-dashboard-full-page.png\n![preview-dashboard-full-page.png](https://famous-camel-162.convex.cloud/api/storage/84e55645-2b56-4fe6-b63a-454e56cbc074)\n\n### preview-dashboard-viewport-configured-repos.png\n![preview-dashboard-viewport-configured-repos.png](https://famous-camel-162.convex.cloud/api/storage/ab76e937-3622-4e07-a4ba-782669261556)\n\n### preview-dashboard-viewport-middle.png\n![preview-dashboard-viewport-middle.png](https://famous-camel-162.convex.cloud/api/storage/2c69e97a-1ab8-4c81-8155-44205a9aa825)\n\n### preview-dashboard-viewport-top.png\n![preview-dashboard-viewport-top.png](https://famous-camel-162.convex.cloud/api/storage/cef389e5-1386-4603-b499-0721c3a0e72b)\n\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"16d53b8d646015962481d20ee796adf09b9ce8ce","createdAt":"2025-11-30T06:47:57Z","updatedAt":"2025-11-30T06:47:57Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1074#issuecomment-3592283744"}]}
{"number":1072,"title":"add framework logos","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1072","headRef":"cmux/add-framework-logos","headSha":"3ffd5dcfd9074b27aaaf2a189e612731f5236548","baseRef":"main","baseSha":"b3a9bee2511bf7918afe8b169eaf2f88321951aa","createdAt":"2025-11-30T05:01:43Z","updatedAt":"2025-11-30T05:19:39Z","diff":"diff --git a/apps/www/components/preview/preview-configure-client.tsx b/apps/www/components/preview/preview-configure-client.tsx\nindex 0f4ac2692..5c2c39f61 100644\n--- a/apps/www/components/preview/preview-configure-client.tsx\n+++ b/apps/www/components/preview/preview-configure-client.tsx\n@@ -35,7 +35,6 @@ export type FrameworkPreset =\n   | \"vite\"\n   | \"remix\"\n   | \"nuxt\"\n-  | \"astro\"\n   | \"sveltekit\"\n   | \"angular\"\n   | \"cra\"\n@@ -47,7 +46,6 @@ type FrameworkIconKey =\n   | \"vite\"\n   | \"remix\"\n   | \"nuxt\"\n-  | \"astro\"\n   | \"svelte\"\n   | \"angular\"\n   | \"react\"\n@@ -66,7 +64,6 @@ const FRAMEWORK_PRESETS: Record<FrameworkPreset, FrameworkPresetConfig> = {\n   vite: { name: \"Vite\", maintenanceScript: \"npm install\", devScript: \"npm run dev\", icon: \"vite\" },\n   remix: { name: \"Remix\", maintenanceScript: \"npm install\", devScript: \"npm run dev\", icon: \"remix\" },\n   nuxt: { name: \"Nuxt\", maintenanceScript: \"npm install\", devScript: \"npm run dev\", icon: \"nuxt\" },\n-  astro: { name: \"Astro\", maintenanceScript: \"npm install\", devScript: \"npm run dev\", icon: \"astro\" },\n   sveltekit: {\n     name: \"SvelteKit\",\n     maintenanceScript: \"npm install\",\n@@ -196,111 +193,99 @@ const FRAMEWORK_ICON_META: Record<\n   },\n   next: {\n     icon: (\n-      <svg viewBox=\"0 0 24 24\" aria-hidden=\"true\" className=\"h-4 w-4\">\n-        <path\n-          d=\"M18.665 21.978C16.758 23.255 14.465 24 12 24 5.377 24 0 18.623 0 12S5.377 0 12 0s12 5.377 12 12c0 3.583-1.574 6.801-4.067 9.001L9.219 7.2H7.2v9.596h1.615V9.251l9.85 12.727Zm-3.332-8.533 1.6 2.061V7.2h-1.6v6.245Z\"\n-          fill=\"currentColor\"\n-        />\n-      </svg>\n+      <img\n+        src=\"/framework-logos/next.svg\"\n+        alt=\"\"\n+        aria-hidden=\"true\"\n+        className=\"h-5 w-5\"\n+      />\n     ),\n-    bgClass: \"bg-neutral-900\",\n-    textClass: \"text-white\",\n+    bgClass: \"bg-neutral-100 dark:bg-neutral-800\",\n+    textClass: \"\",\n   },\n   vite: {\n     icon: (\n-      <svg viewBox=\"0 0 24 24\" aria-hidden=\"true\" className=\"h-4 w-4\">\n-        <path\n-          d=\"m8.286 10.578.512-8.657a.306.306 0 0 1 .247-.282L17.377.006a.306.306 0 0 1 .353.385l-1.558 5.403a.306.306 0 0 0 .352.385l2.388-.46a.306.306 0 0 1 .332.438l-6.79 13.55-.123.19a.294.294 0 0 1-.252.14c-.177 0-.35-.152-.305-.369l1.095-5.301a.306.306 0 0 0-.388-.355l-1.433.435a.306.306 0 0 1-.389-.354l.69-3.375a.306.306 0 0 0-.37-.36l-2.32.536a.306.306 0 0 1-.374-.316zm14.976-7.926L17.284 3.74l-.544 1.887 2.077-.4a.8.8 0 0 1 .84.369.8.8 0 0 1 .034.783L12.9 19.93l-.013.025-.015.023-.122.19a.801.801 0 0 1-.672.37.826.826 0 0 1-.634-.302.8.8 0 0 1-.16-.67l1.029-4.981-1.12.34a.81.81 0 0 1-.86-.262.802.802 0 0 1-.165-.67l.63-3.08-2.027.468a.808.808 0 0 1-.768-.233.81.81 0 0 1-.217-.6l.389-6.57-7.44-1.33a.612.612 0 0 0-.64.906L11.58 23.691a.612.612 0 0 0 1.066-.004l11.26-20.135a.612.612 0 0 0-.644-.9z\"\n-          fill=\"currentColor\"\n-        />\n-      </svg>\n+      <img\n+        src=\"/framework-logos/vite.svg\"\n+        alt=\"\"\n+        aria-hidden=\"true\"\n+        className=\"h-5 w-5\"\n+      />\n     ),\n-    bgClass: \"bg-gradient-to-br from-indigo-500 via-purple-500 to-amber-400\",\n-    textClass: \"text-white\",\n+    bgClass: \"bg-neutral-100 dark:bg-neutral-800\",\n+    textClass: \"\",\n   },\n   remix: {\n     icon: (\n-      <svg viewBox=\"0 0 24 24\" aria-hidden=\"true\" className=\"h-4 w-4\">\n-        <path\n-          d=\"M21.511 18.508c.216 2.773.216 4.073.216 5.492H15.31c0-.309.006-.592.011-.878.018-.892.036-1.821-.109-3.698-.19-2.747-1.374-3.358-3.55-3.358H1.574v-5h10.396c2.748 0 4.122-.835 4.122-3.049 0-1.946-1.374-3.125-4.122-3.125H1.573V0h11.541c6.221 0 9.313 2.938 9.313 7.632 0 3.511-2.176 5.8-5.114 6.182 2.48.497 3.93 1.909 4.198 4.694ZM1.573 24v-3.727h6.784c1.133 0 1.379.84 1.379 1.342V24Z\"\n-          fill=\"currentColor\"\n-        />\n-      </svg>\n+      <img\n+        src=\"/framework-logos/remix.svg\"\n+        alt=\"\"\n+        aria-hidden=\"true\"\n+        className=\"h-5 w-5\"\n+      />\n     ),\n-    bgClass: \"bg-neutral-800\",\n-    textClass: \"text-white\",\n+    bgClass: \"bg-neutral-100 dark:bg-neutral-800\",\n+    textClass: \"\",\n   },\n   nuxt: {\n     icon: (\n-      <svg viewBox=\"0 0 24 24\" aria-hidden=\"true\" className=\"h-4 w-4\">\n-        <path\n-          d=\"m2.5 17.75 5.25-9.5 4.3 7.5 2.95-5.5 6.5 11.5h-3.2l-3.3-5.8-2.8 5.8-4.3-7.5-3.35 6H2.5Z\"\n-          fill=\"currentColor\"\n-        />\n-      </svg>\n-    ),\n-    bgClass: \"bg-emerald-600\",\n-    textClass: \"text-white\",\n-  },\n-  astro: {\n-    icon: (\n-      <svg viewBox=\"0 0 24 24\" aria-hidden=\"true\" className=\"h-4 w-4\">\n-        <path\n-          d=\"M8.358 20.162c-1.186-1.07-1.532-3.316-1.038-4.944.856 1.026 2.043 1.352 3.272 1.535 1.897.283 3.76.177 5.522-.678.202-.098.388-.229.608-.36.166.473.209.95.151 1.437-.14 1.185-.738 2.1-1.688 2.794-.38.277-.782.525-1.175.787-1.205.804-1.531 1.747-1.078 3.119l.044.148a3.158 3.158 0 0 1-1.407-1.188 3.31 3.31 0 0 1-.544-1.815c-.004-.32-.004-.642-.048-.958-.106-.769-.472-1.113-1.161-1.133-.707-.02-1.267.411-1.415 1.09-.012.053-.028.104-.045.165h.002zm-5.961-4.445s3.24-1.575 6.49-1.575l2.451-7.565c.092-.366.36-.614.662-.614.302 0 .57.248.662.614l2.45 7.565c3.85 0 6.491 1.575 6.491 1.575L16.088.727C15.93.285 15.663 0 15.303 0H8.697c-.36 0-.615.285-.784.727l-5.516 14.99z\"\n-          fill=\"currentColor\"\n-        />\n-      </svg>\n+      <img\n+        src=\"/framework-logos/nuxt.svg\"\n+        alt=\"\"\n+        aria-hidden=\"true\"\n+        className=\"h-5 w-5\"\n+      />\n     ),\n-    bgClass: \"bg-neutral-900\",\n-    textClass: \"text-white\",\n+    bgClass: \"bg-neutral-100 dark:bg-neutral-800\",\n+    textClass: \"\",\n   },\n   svelte: {\n     icon: (\n-      <svg viewBox=\"0 0 24 24\" aria-hidden=\"true\" className=\"h-4 w-4\">\n-        <path\n-          d=\"M10.354 21.125a4.44 4.44 0 0 1-4.765-1.767 4.109 4.109 0 0 1-.703-3.107 3.898 3.898 0 0 1 .134-.522l.105-.321.287.21a7.21 7.21 0 0 0 2.186 1.092l.208.063-.02.208a1.253 1.253 0 0 0 .226.83 1.337 1.337 0 0 0 1.435.533 1.231 1.231 0 0 0 .343-.15l5.59-3.562a1.164 1.164 0 0 0 .524-.778 1.242 1.242 0 0 0-.211-.937 1.338 1.338 0 0 0-1.435-.533 1.23 1.23 0 0 0-.343.15l-2.133 1.36a4.078 4.078 0 0 1-1.135.499 4.44 4.44 0 0 1-4.765-1.766 4.108 4.108 0 0 1-.702-3.108 3.855 3.855 0 0 1 1.742-2.582l5.589-3.563a4.072 4.072 0 0 1 1.135-.499 4.44 4.44 0 0 1 4.765 1.767 4.109 4.109 0 0 1 .703 3.107 3.943 3.943 0 0 1-.134.522l-.105.321-.286-.21a7.204 7.204 0 0 0-2.187-1.093l-.208-.063.02-.207a1.255 1.255 0 0 0-.226-.831 1.337 1.337 0 0 0-1.435-.532 1.231 1.231 0 0 0-.343.15L8.62 9.368a1.162 1.162 0 0 0-.524.778 1.24 1.24 0 0 0 .211.937 1.338 1.338 0 0 0 1.435.533 1.235 1.235 0 0 0 .344-.151l2.132-1.36a4.067 4.067 0 0 1 1.135-.498 4.44 4.44 0 0 1 4.765 1.766 4.108 4.108 0 0 1 .702 3.108 3.857 3.857 0 0 1-1.742 2.583l-5.589 3.562a4.072 4.072 0 0 1-1.135.499m10.358-17.95C18.484-.015 14.082-.96 10.9 1.068L5.31 4.63a6.412 6.412 0 0 0-2.896 4.295 6.753 6.753 0 0 0 .666 4.336 6.43 6.43 0 0 0-.96 2.396 6.833 6.833 0 0 0 1.168 5.167c2.229 3.19 6.63 4.135 9.812 2.108l5.59-3.562a6.41 6.41 0 0 0 2.896-4.295 6.756 6.756 0 0 0-.665-4.336 6.429 6.429 0 0 0 .958-2.396 6.831 6.831 0 0 0-1.167-5.168Z\"\n-          fill=\"currentColor\"\n-        />\n-      </svg>\n+      <img\n+        src=\"/framework-logos/svelte.svg\"\n+        alt=\"\"\n+        aria-hidden=\"true\"\n+        className=\"h-5 w-5\"\n+      />\n     ),\n-    bgClass: \"bg-orange-500\",\n-    textClass: \"text-white\",\n+    bgClass: \"bg-neutral-100 dark:bg-neutral-800\",\n+    textClass: \"\",\n   },\n   angular: {\n     icon: (\n-      <svg viewBox=\"0 0 24 24\" aria-hidden=\"true\" className=\"h-4 w-4\">\n-        <path\n-          d=\"M11.985 0 2.1 3.65l1.5 13.05 8.385 4.8 8.4-4.8 1.5-13.05L11.985 0Zm0 3.45 5.1 1.8-.6 6.6h-2.1l.3-3.15-2.7 1.05-2.7-1.05.3 3.15h-2.1l-.6-6.6 5.1-1.8Zm0 8.55 2.85 1.05-.9 4.35-1.95 1.05-1.95-1.05-.9-4.35Z\"\n-          fill=\"currentColor\"\n-        />\n-      </svg>\n+      <img\n+        src=\"/framework-logos/angular.svg\"\n+        alt=\"\"\n+        aria-hidden=\"true\"\n+        className=\"h-5 w-5\"\n+      />\n     ),\n-    bgClass: \"bg-red-600\",\n-    textClass: \"text-white\",\n+    bgClass: \"bg-neutral-100 dark:bg-neutral-800\",\n+    textClass: \"\",\n   },\n   react: {\n     icon: (\n-      <svg viewBox=\"0 0 24 24\" aria-hidden=\"true\" className=\"h-4 w-4\">\n-        <path\n-          d=\"M12 9.2a2.8 2.8 0 1 0 0 5.6 2.8 2.8 0 0 0 0-5.6Zm0-6.2c1.35 0 2.53.27 3.16.7.6.4.77.86.47 1.5-.24.53-.73 1.16-1.37 1.82.32.34.62.7.9 1.07 1.13-.35 2.21-.54 3.07-.54 1.35 0 2.53.27 3.16.7.6.4.77.86.47 1.5-.52 1.15-1.95 2.63-3.81 3.92.13.53.23 1.06.3 1.6 1.21.26 2.33.68 3.04 1.18.6.4.77.86.47 1.5-.24.53-.73 1.16-1.37 1.82-.64.66-1.35 1.25-2.08 1.77-.73.52-1.48.96-2.2 1.3-.73.35-1.42.6-2.02.73-.6.14-1.12.15-1.5 0-.38.15-.9.14-1.5 0-.6-.14-1.29-.38-2.02-.73-.72-.34-1.47-.78-2.2-1.3a16.3 16.3 0 0 1-2.08-1.77c-.64-.66-1.13-1.29-1.37-1.82-.3-.64-.13-1.1.47-1.5.71-.5 1.83-.92 3.04-1.18.07-.54.17-1.07.3-1.6-1.86-1.29-3.29-2.77-3.81-3.92-.3-.64-.13-1.1.47-1.5.63-.43 1.8-.7 3.16-.7.86 0 1.94.2 3.07.54.28-.37.58-.73.9-1.07-.64-.66-1.13-1.29-1.37-1.82-.3-.64-.13-1.1.47-1.5C9.47 3.27 10.65 3 12 3Zm0 1c-1.15 0-2.18.2-2.75.58-.26.17-.28.28-.16.55.17.37.57.88 1.13 1.46.2.2.42.43.64.67-.46.52-.87 1.06-1.24 1.62-1.3-.4-2.5-.63-3.38-.63-1.15 0-2.18.2-2.75.58-.26.17-.28.28-.16.55.37.82 1.57 2.08 3.47 3.36l.35.24c-.16.66-.27 1.33-.33 2.01-1.17.26-2.26.66-2.97 1.15-.26.18-.28.3-.16.56.17.38.57.88 1.13 1.46.56.58 1.19 1.12 1.87 1.6.68.48 1.37.9 2.04 1.22.68.32 1.31.54 1.82.66.5.12.85.12 1 .06l.18-.06c.15.06.5.06 1-.06.51-.12 1.14-.34 1.82-.66.67-.32 1.36-.74 2.04-1.22.68-.48 1.31-1.02 1.87-1.6.56-.58.96-1.08 1.13-1.46.12-.26.1-.38-.16-.56-.71-.49-1.8-.89-2.97-1.15a12.5 12.5 0 0 0-.33-2.01l.35-.24c1.9-1.28 3.1-2.54 3.47-3.36.12-.27.1-.38-.16-.56-.57-.38-1.6-.58-2.75-.58-.88 0-2.08.23-3.38.63a13 13 0 0 0-1.24-1.62 17 17 0 0 0 .64-.67c.56-.58.96-1.09 1.13-1.46.12-.27.1-.38-.16-.56-.57-.38-1.6-.58-2.75-.58Z\"\n-          fill=\"currentColor\"\n-        />\n-      </svg>\n+      <img\n+        src=\"/framework-logos/react.svg\"\n+        alt=\"\"\n+        aria-hidden=\"true\"\n+        className=\"h-5 w-5\"\n+      />\n     ),\n-    bgClass: \"bg-sky-100\",\n-    textClass: \"text-sky-700\",\n+    bgClass: \"bg-neutral-100 dark:bg-neutral-800\",\n+    textClass: \"\",\n   },\n   vue: {\n     icon: (\n-      <svg viewBox=\"0 0 24 24\" aria-hidden=\"true\" className=\"h-4 w-4\">\n-        <path\n-          d=\"M12 3.1 9.07 8.2 6.14 3.1H0l12 20.9L24 3.1h-6.14L14.93 8.2 12 3.1Z\"\n-          fill=\"currentColor\"\n-        />\n-      </svg>\n+      <img\n+        src=\"/framework-logos/vue.svg\"\n+        alt=\"\"\n+        aria-hidden=\"true\"\n+        className=\"h-5 w-5\"\n+      />\n     ),\n-    bgClass: \"bg-emerald-600\",\n-    textClass: \"text-white\",\n+    bgClass: \"bg-neutral-100 dark:bg-neutral-800\",\n+    textClass: \"\",\n   },\n };\n \ndiff --git a/apps/www/lib/github/framework-detection.ts b/apps/www/lib/github/framework-detection.ts\nindex f12901bd2..9d2a9c315 100644\n--- a/apps/www/lib/github/framework-detection.ts\n+++ b/apps/www/lib/github/framework-detection.ts\n@@ -14,7 +14,6 @@ function chooseFrameworkFromPackageJson(pkg: PackageJson): FrameworkPreset | nul\n   if (hasAny(\"next\")) return \"next\";\n   if (hasAny(\"nuxt\")) return \"nuxt\";\n   if (hasAny(\"@remix-run/node\", \"@remix-run/serve\", \"remix\")) return \"remix\";\n-  if (hasAny(\"astro\")) return \"astro\";\n   if (hasAny(\"@sveltejs/kit\")) return \"sveltekit\";\n   if (hasAny(\"@angular/core\")) return \"angular\";\n   if (hasAny(\"react-scripts\")) return \"cra\";\n@@ -26,7 +25,6 @@ function chooseFrameworkFromPackageJson(pkg: PackageJson): FrameworkPreset | nul\n   if (scriptValues.some((val) => val.includes(\"next\"))) return \"next\";\n   if (scriptValues.some((val) => val.includes(\"nuxt\"))) return \"nuxt\";\n   if (scriptValues.some((val) => val.includes(\"remix\"))) return \"remix\";\n-  if (scriptValues.some((val) => val.includes(\"astro\"))) return \"astro\";\n   if (scriptValues.some((val) => val.includes(\"svelte\"))) return \"sveltekit\";\n   if (scriptValues.some((val) => val.includes(\"ng \"))) return \"angular\";\n   if (scriptValues.some((val) => val.includes(\"vue\"))) return \"vue\";\n@@ -84,7 +82,6 @@ export async function detectFrameworkPreset(repoFullName: string): Promise<Frame\n     [\"next\", [\"next.config.js\", \"next.config.ts\", \"next.config.mjs\"]],\n     [\"nuxt\", [\"nuxt.config.ts\", \"nuxt.config.js\", \"nuxt.config.mjs\"]],\n     [\"remix\", [\"remix.config.js\", \"remix.config.ts\"]],\n-    [\"astro\", [\"astro.config.mjs\", \"astro.config.ts\", \"astro.config.js\"]],\n     [\"sveltekit\", [\"svelte.config.js\", \"svelte.config.ts\"]],\n     [\"angular\", [\"angular.json\"]],\n     [\"vite\", [\"vite.config.ts\", \"vite.config.js\", \"vite.config.mjs\"]],\ndiff --git a/apps/www/public/framework-logos/angular.svg b/apps/www/public/framework-logos/angular.svg\nnew file mode 100644\nindex 000000000..4bfc7d11a\n--- /dev/null\n+++ b/apps/www/public/framework-logos/angular.svg\n@@ -0,0 +1 @@\n+<svg width=\"48\" height=\"48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M24 1L3 8.636l3.203 28.313L24 47l17.797-10.051L45 8.636 24 1z\" fill=\"#DA0B36\"/><path d=\"M24 1v5.106-.023V47l17.797-10.051L45 8.636 24 1z\" fill=\"#C10933\"/><path d=\"M24.022 6L11 36h4.855l2.618-6.713h11.054L32.145 36H37L24.022 6zm3.804 19.15H20.22l3.803-9.403 3.804 9.402z\" fill=\"#fff\"/></svg>\n\\ No newline at end of file\ndiff --git a/apps/www/public/framework-logos/next.svg b/apps/www/public/framework-logos/next.svg\nnew file mode 100644\nindex 000000000..c734900cc\n--- /dev/null\n+++ b/apps/www/public/framework-logos/next.svg\n@@ -0,0 +1 @@\n+<svg width=\"48\" height=\"48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><mask id=\"mask\" style=\"mask-type:alpha\" maskUnits=\"userSpaceOnUse\" x=\"0\" y=\"0\" width=\"48\" height=\"48\"><circle cx=\"24\" cy=\"24\" r=\"24\" fill=\"#000\"/></mask><g mask=\"url(#mask)\"><circle cx=\"24\" cy=\"24\" r=\"23.2\" fill=\"#000\" stroke=\"#fff\" stroke-width=\"1.6\"/><path d=\"M39.8687 42.0055L18.4378 14.4H14.3999V33.592H17.6302V18.5023L37.333 43.9587C38.222 43.3637 39.069 42.7108 39.8687 42.0055Z\" fill=\"url(#gradient0)\"/><rect x=\"30.6667\" y=\"14.4\" width=\"3.2\" height=\"19.2\" fill=\"url(#gradient1)\"/></g><defs><linearGradient id=\"gradient0\" x1=\"29.0666\" y1=\"31.0667\" x2=\"38.5332\" y2=\"42.8\" gradientUnits=\"userSpaceOnUse\"><stop stop-color=\"#fff\"/><stop offset=\"1\" stop-color=\"#fff\" stop-opacity=\"0\"/></linearGradient><linearGradient id=\"gradient1\" x1=\"32.2667\" y1=\"14.4\" x2=\"32.2132\" y2=\"28.5001\" gradientUnits=\"userSpaceOnUse\"><stop stop-color=\"#fff\"/><stop offset=\"1\" stop-color=\"#fff\" stop-opacity=\"0\"/></linearGradient></defs></svg>\n\\ No newline at end of file\ndiff --git a/apps/www/public/framework-logos/nuxt.svg b/apps/www/public/framework-logos/nuxt.svg\nnew file mode 100644\nindex 000000000..946d7a39a\n--- /dev/null\n+++ b/apps/www/public/framework-logos/nuxt.svg\n@@ -0,0 +1,3 @@\n+<svg width=\"61\" height=\"40\" viewBox=\"0 0 61 40\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n+  <path d=\"M33.997 39.539h22.528c.715 0 1.418-.183 2.038-.53a4.014 4.014 0 0 0 1.492-1.447 3.861 3.861 0 0 0 .545-1.977 3.86 3.86 0 0 0-.547-1.977L44.923 8.19a4.016 4.016 0 0 0-1.49-1.447 4.172 4.172 0 0 0-2.038-.53c-.716 0-1.418.183-2.038.53a4.016 4.016 0 0 0-1.492 1.447l-3.868 6.504-7.563-12.718A4.018 4.018 0 0 0 24.942.53 4.175 4.175 0 0 0 22.904 0c-.716 0-1.419.183-2.039.53a4.018 4.018 0 0 0-1.492 1.446L.547 33.608A3.861 3.861 0 0 0 0 35.585c0 .694.188 1.376.545 1.977.358.601.873 1.1 1.492 1.447.62.347 1.323.53 2.038.53h14.141c5.603 0 9.735-2.387 12.578-7.044l6.902-11.596 3.698-6.205 11.096 18.64H37.695l-3.699 6.205Zm-16.011-6.212-9.869-.002L22.91 8.474l7.381 12.425-4.942 8.305c-1.888 3.022-4.033 4.123-7.363 4.123Z\" fill=\"#00DC82\"/>\n+</svg>\ndiff --git a/apps/www/public/framework-logos/react.svg b/apps/www/public/framework-logos/react.svg\nnew file mode 100644\nindex 000000000..523333e1a\n--- /dev/null\n+++ b/apps/www/public/framework-logos/react.svg\n@@ -0,0 +1 @@\n+<svg width=\"48\" height=\"48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><g clip-path=\"url(#clip0)\"><path d=\"M24 28.631a4.278 4.278 0 1 0 0-8.556 4.278 4.278 0 0 0 0 8.556z\" fill=\"#61DAFB\"/><path d=\"M24 33.118c12.678 0 22.956-3.924 22.956-8.765 0-4.84-10.278-8.765-22.956-8.765-12.679 0-22.957 3.924-22.957 8.765 0 4.841 10.278 8.765 22.957 8.765z\" stroke=\"#61DAFB\"/><path d=\"M16.409 28.736c6.34 10.98 14.877 17.918 19.07 15.498 4.191-2.42 2.451-13.284-3.888-24.264C25.25 8.99 16.714 2.053 12.52 4.473 8.33 6.892 10.07 17.756 16.41 28.736z\" stroke=\"#61DAFB\"/><path d=\"M16.409 19.97c-6.34 10.98-8.08 21.843-3.887 24.264 4.192 2.42 12.73-4.518 19.069-15.498 6.34-10.98 8.08-21.843 3.887-24.264-4.192-2.42-12.73 4.519-19.069 15.498z\" stroke=\"#61DAFB\"/></g><defs><clipPath id=\"clip0\"><path fill=\"#fff\" transform=\"translate(0 3)\" d=\"M0 0H48V42.706H0z\"/></clipPath></defs></svg>\n\\ No newline at end of file\ndiff --git a/apps/www/public/framework-logos/remix.svg b/apps/www/public/framework-logos/remix.svg\nnew file mode 100644\nindex 000000000..ffcdf8287\n--- /dev/null\n+++ b/apps/www/public/framework-logos/remix.svg\n@@ -0,0 +1,6 @@\n+<svg viewBox=\"0 0 800 800\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n+  <path d=\"M700 0H100C44.772 0 0 44.772 0 100v600c0 55.228 44.772 100 100 100h600c55.228 0 100-44.772 100-100V100C800 44.772 755.228 0 700 0Z\" fill=\"#212121\"/>\n+  <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M587.947 527.768c4.254 54.65 4.254 80.268 4.254 108.232H465.756c0-6.091.109-11.663.219-17.313.342-17.564.699-35.88-2.147-72.868-3.761-54.152-27.08-66.185-69.957-66.185H195v-98.525h204.889c54.16 0 81.241-16.476 81.241-60.098 0-38.357-27.081-61.601-81.241-61.601H195V163h227.456C545.069 163 606 220.912 606 313.42c0 69.193-42.877 114.319-100.799 121.84 48.895 9.777 77.48 37.605 82.746 92.508Z\" fill=\"#fff\"/>\n+  <path d=\"M195 636v-73.447h133.697c22.332 0 27.181 16.563 27.181 26.441V636H195Z\" fill=\"#fff\"/>\n+  <path d=\"M194.5 636v.5h161.878v-47.506c0-5.006-1.226-11.734-5.315-17.224-4.108-5.515-11.059-9.717-22.366-9.717H194.5V636Z\" stroke=\"#fff\" stroke-opacity=\".8\"/>\n+</svg>\ndiff --git a/apps/www/public/framework-logos/svelte.svg b/apps/www/public/framework-logos/svelte.svg\nnew file mode 100644\nindex 000000000..40c960773\n--- /dev/null\n+++ b/apps/www/public/framework-logos/svelte.svg\n@@ -0,0 +1 @@\n+<svg width=\"47\" height=\"48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><g clip-path=\"url(#clip0)\"><path d=\"M39.792 6.09C35.507-.027 27.044-1.84 20.924 2.048L10.177 8.88a12.297 12.297 0 0 0-5.57 8.237 12.922 12.922 0 0 0 1.28 8.315 12.313 12.313 0 0 0-1.844 4.596c-.619 3.47.19 7.043 2.244 9.91 4.287 6.119 12.75 7.931 18.869 4.042l10.747-6.831a12.295 12.295 0 0 0 5.57-8.237 12.927 12.927 0 0 0-1.28-8.315A12.31 12.31 0 0 0 42.037 16c.619-3.47-.19-7.043-2.245-9.91\" fill=\"#FF3E00\"/><path d=\"M19.873 40.52a8.55 8.55 0 0 1-9.165-3.388 7.866 7.866 0 0 1-1.35-5.962c.062-.339.148-.674.257-1.001l.202-.616.55.404a13.881 13.881 0 0 0 4.206 2.095l.4.121-.037.398a2.4 2.4 0 0 0 .433 1.594 2.575 2.575 0 0 0 2.76 1.022 2.37 2.37 0 0 0 .66-.29l10.75-6.833a2.233 2.233 0 0 0 1.011-1.492 2.377 2.377 0 0 0-.407-1.797 2.577 2.577 0 0 0-2.76-1.022 2.37 2.37 0 0 0-.66.289L22.62 26.65c-.675.428-1.411.75-2.183.956a8.55 8.55 0 0 1-9.166-3.388 7.866 7.866 0 0 1-1.35-5.962 7.394 7.394 0 0 1 3.35-4.954l10.75-6.834a7.844 7.844 0 0 1 2.185-.957 8.55 8.55 0 0 1 9.165 3.388 7.866 7.866 0 0 1 1.35 5.962c-.062.34-.148.674-.256 1.001l-.203.616-.55-.403a13.87 13.87 0 0 0-4.206-2.096l-.4-.121.037-.398a2.404 2.404 0 0 0-.433-1.594 2.575 2.575 0 0 0-2.76-1.022 2.37 2.37 0 0 0-.66.29l-10.75 6.833a2.229 2.229 0 0 0-1.01 1.492c-.112.63.034 1.277.406 1.797a2.577 2.577 0 0 0 2.76 1.023c.234-.063.457-.16.661-.29l4.102-2.607a7.834 7.834 0 0 1 2.183-.957 8.55 8.55 0 0 1 9.165 3.388 7.865 7.865 0 0 1 1.35 5.962 7.398 7.398 0 0 1-3.35 4.955l-10.75 6.833a7.842 7.842 0 0 1-2.185.958\" fill=\"#fff\"/></g><defs><clipPath id=\"clip0\"><path fill=\"#fff\" transform=\"translate(3.84)\" d=\"M0 0H38.4V46.08H0z\"/></clipPath></defs></svg>\n\\ No newline at end of file\ndiff --git a/apps/www/public/framework-logos/vite.svg b/apps/www/public/framework-logos/vite.svg\nnew file mode 100644\nindex 000000000..de4aeddc1\n--- /dev/null\n+++ b/apps/www/public/framework-logos/vite.svg\n@@ -0,0 +1,15 @@\n+<svg width=\"410\" height=\"404\" viewBox=\"0 0 410 404\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n+<path d=\"M399.641 59.5246L215.643 388.545C211.844 395.338 202.084 395.378 198.228 388.618L10.5817 59.5563C6.38087 52.1896 12.6802 43.2665 21.0281 44.7586L205.223 77.6824C206.398 77.8924 207.601 77.8904 208.776 77.6763L389.119 44.8058C397.439 43.2894 403.768 52.1434 399.641 59.5246Z\" fill=\"url(#paint0_linear)\"/>\n+<path d=\"M292.965 1.5744L156.801 28.2552C154.563 28.6937 152.906 30.5903 152.771 32.8664L144.395 174.33C144.198 177.662 147.258 180.248 150.51 179.498L188.42 170.749C191.967 169.931 195.172 173.055 194.443 176.622L183.18 231.775C182.422 235.487 185.907 238.661 189.532 237.56L212.947 230.446C216.577 229.344 220.065 232.527 219.297 236.242L201.398 322.875C200.278 328.294 207.486 331.249 210.492 326.603L212.5 323.5L323.454 102.072C325.312 98.3645 322.108 94.137 318.036 94.9228L279.014 102.454C275.347 103.161 272.227 99.746 273.262 96.1583L298.731 7.86689C299.767 4.27314 296.636 0.855181 292.965 1.5744Z\" fill=\"url(#paint1_linear)\"/>\n+<defs>\n+<linearGradient id=\"paint0_linear\" x1=\"6.00017\" y1=\"32.9999\" x2=\"235\" y2=\"344\" gradientUnits=\"userSpaceOnUse\">\n+<stop stop-color=\"#41D1FF\"/>\n+<stop offset=\"1\" stop-color=\"#BD34FE\"/>\n+</linearGradient>\n+<linearGradient id=\"paint1_linear\" x1=\"194.651\" y1=\"8.81818\" x2=\"236.076\" y2=\"292.989\" gradientUnits=\"userSpaceOnUse\">\n+<stop stop-color=\"#FFEA83\"/>\n+<stop offset=\"0.0833333\" stop-color=\"#FFDD35\"/>\n+<stop offset=\"1\" stop-color=\"#FFA800\"/>\n+</linearGradient>\n+</defs>\n+</svg>\ndiff --git a/apps/www/public/framework-logos/vue.svg b/apps/www/public/framework-logos/vue.svg\nnew file mode 100644\nindex 000000000..e4111af71\n--- /dev/null\n+++ b/apps/www/public/framework-logos/vue.svg\n@@ -0,0 +1 @@\n+<svg width=\"48\" height=\"48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><g clip-path=\"url(#clip0)\"><path d=\"M29.54 3L24 12.7 18.456 3H-.001l24 42L47.998 3H29.54z\" fill=\"#41B883\"/><path d=\"M29.54 3L24 12.7 18.456 3H9.599l14.4 25.2L38.398 3H29.54z\" fill=\"#34495E\"/></g><defs><clipPath id=\"clip0\"><path fill=\"#fff\" transform=\"translate(0 3)\" d=\"M0 0H48V42H0z\"/></clipPath></defs></svg>\n\\ No newline at end of file\n","comments":[{"type":"issue_comment","id":3592201457,"prNumber":1072,"botLogin":"cmux-agent-internal-dev[bot]","body":"[Open Workspace](https://cmux.sh/austin-dev/task/kn7c4rqa4mvrt8cntjq2rk77wn7wcww2) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1072)\n\n## Preview Screenshots\n\nSuccessfully captured 8 screenshot(s) for commit `3ffd5dc`:\n\n### all-framework-logos-grid.png\n![all-framework-logos-grid.png](https://famous-camel-162.convex.cloud/api/storage/986fdfae-5e1c-4c08-8291-be44a8740650)\n\n### before-after-comparison.png\n![before-after-comparison.png](https://famous-camel-162.convex.cloud/api/storage/7bf5f624-bdfd-4e46-90e5-81a41845b62b)\n\n### framework-logos-demo-dark-mode-full-page.png\n![framework-logos-demo-dark-mode-full-page.png](https://famous-camel-162.convex.cloud/api/storage/6dda1d4f-a531-4115-a2ae-1dfa74243f20)\n\n### framework-logos-demo-light-mode-full-page.png\n![framework-logos-demo-light-mode-full-page.png](https://famous-camel-162.convex.cloud/api/storage/2c5b478a-5ecd-4673-a126-583ca452741a)\n\n### framework-selector-button-closeup.png\n![framework-selector-button-closeup.png](https://famous-camel-162.convex.cloud/api/storage/2becea8b-4ec4-41ba-b318-fdd098055967)\n\n### framework-selector-dropdown.png\n![framework-selector-dropdown.png](https://famous-camel-162.convex.cloud/api/storage/9ba41290-1a70-40ea-8ab5-df490d4b3722)\n\n### individual-framework-logos-dark.png\n![individual-framework-logos-dark.png](https://famous-camel-162.convex.cloud/api/storage/a4e37e25-1fd5-4ea6-a8e3-4a0a59d031bd)\n\n### svg-files-overview.png\n![svg-files-overview.png](https://famous-camel-162.convex.cloud/api/storage/9b473ac9-7c5e-423d-adf4-4360401c17a6)\n\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"3ffd5dcfd9074b27aaaf2a189e612731f5236548","createdAt":"2025-11-30T05:09:14Z","updatedAt":"2025-11-30T05:09:14Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1072#issuecomment-3592201457"},{"type":"issue_comment","id":3592207092,"prNumber":1072,"botLogin":"cmux-agent[bot]","body":"[Open Workspace](https://cmux.sh/manaflow/task/kn75vzg4he098g3g42v5kexqfd7wdjk5) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1072)\n\n## Preview Screenshots\n\nSuccessfully captured 8 screenshot(s) for commit `3ffd5dc`:\n\n### 01-framework-logos-demo-full-page.png\n![01-framework-logos-demo-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/0847f247-8d45-4f30-836a-c99ec41741c1)\n\n### 02-framework-icons-grid.png\n![02-framework-icons-grid.png](https://adorable-wombat-701.convex.cloud/api/storage/3392d6d5-3207-4d18-8d0f-2c49b0cb1057)\n\n### 03-framework-dropdown-preview.png\n![03-framework-dropdown-preview.png](https://adorable-wombat-701.convex.cloud/api/storage/ce08d946-1b5f-4334-ad10-74e0aaad796f)\n\n### 04-large-framework-icons.png\n![04-large-framework-icons.png](https://adorable-wombat-701.convex.cloud/api/storage/5233d008-d950-4b13-92c7-6459a6cea72b)\n\n### 05-next-svg.png\n![05-next-svg.png](https://adorable-wombat-701.convex.cloud/api/storage/a51e45fe-93e7-4f73-a0dd-32658f0dec22)\n\n### 06-react-svg.png\n![06-react-svg.png](https://adorable-wombat-701.convex.cloud/api/storage/2b7e0f55-9644-4bec-88a2-c59b0863700b)\n\n### 07-vite-svg.png\n![07-vite-svg.png](https://adorable-wombat-701.convex.cloud/api/storage/8ec302ea-3d9a-4508-85ab-f2761ed4f6b2)\n\n### 08-vue-svg.png\n![08-vue-svg.png](https://adorable-wombat-701.convex.cloud/api/storage/583a9910-67f2-4311-8c47-69499a2b5172)\n\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"3ffd5dcfd9074b27aaaf2a189e612731f5236548","createdAt":"2025-11-30T05:19:39Z","updatedAt":"2025-11-30T05:19:39Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1072#issuecomment-3592207092"}]}
{"number":1071,"title":"Detect preview completion and update dashboard status","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1071","headRef":"cmux/detect-preview-completion-and-update-dashboard-sta-dkne6","headSha":"bc9847956d60cba52dda7724eaac7044d9af3402","baseRef":"main","baseSha":"c6a8d8a2828e8b14767f9f11acdd9a4029bf144f","createdAt":"2025-11-30T04:38:59Z","updatedAt":"2025-11-30T05:00:20Z","diff":"diff --git a/packages/convex/convex/preview_jobs_http.ts b/packages/convex/convex/preview_jobs_http.ts\nindex 0503f3a98..8091e9d60 100644\n--- a/packages/convex/convex/preview_jobs_http.ts\n+++ b/packages/convex/convex/preview_jobs_http.ts\n@@ -1,7 +1,7 @@\n import { env } from \"../_shared/convex-env\";\n import { internal } from \"./_generated/api\";\n import type { Doc, Id } from \"./_generated/dataModel\";\n-import { httpAction } from \"./_generated/server\";\n+import { httpAction, type ActionCtx } from \"./_generated/server\";\n import { runPreviewJob } from \"./preview_jobs_worker\";\n import { getWorkerAuth } from \"./users/utils/getWorkerAuth\";\n \n@@ -12,6 +12,40 @@ function jsonResponse(body: unknown, status = 200): Response {\n   });\n }\n \n+async function markPreviewTaskCompleted(\n+  ctx: ActionCtx,\n+  taskRun: Doc<\"taskRuns\">,\n+  task: Doc<\"tasks\">,\n+): Promise<{\n+  runStatusUpdated: boolean;\n+  taskAlreadyCompleted: boolean;\n+}> {\n+  const runAlreadyTerminal =\n+    taskRun.status === \"completed\" ||\n+    taskRun.status === \"failed\" ||\n+    taskRun.status === \"skipped\";\n+\n+  if (!runAlreadyTerminal) {\n+    await ctx.runMutation(internal.taskRuns.updateStatus, {\n+      id: taskRun._id,\n+      status: \"completed\",\n+    });\n+  }\n+\n+  const taskAlreadyCompleted = task.isCompleted === true;\n+  if (!taskAlreadyCompleted) {\n+    await ctx.runMutation(internal.tasks.setCompletedInternal, {\n+      taskId: task._id,\n+      isCompleted: true,\n+    });\n+  }\n+\n+  return {\n+    runStatusUpdated: !runAlreadyTerminal,\n+    taskAlreadyCompleted,\n+  };\n+}\n+\n export const dispatchPreviewJob = httpAction(async (ctx, req) => {\n   const workerAuth = await getWorkerAuth(req, { loggerPrefix: \"[preview-jobs-http]\" });\n   if (!workerAuth) {\n@@ -275,6 +309,18 @@ export const completePreviewJob = httpAction(async (ctx, req) => {\n       return jsonResponse({ error: \"Task run not found\" }, 404);\n     }\n \n+    const task = await ctx.runQuery(internal.tasks.getByIdInternal, {\n+      id: taskRun.taskId,\n+    });\n+\n+    if (!task) {\n+      console.error(\"[preview-jobs-http] Task not found for preview completion\", {\n+        taskRunId,\n+        taskId: taskRun.taskId,\n+      });\n+      return jsonResponse({ error: \"Task not found\" }, 404);\n+    }\n+\n     if (!taskRun.latestScreenshotSetId) {\n       console.log(\"[preview-jobs-http] No screenshots found for task run\", {\n         taskRunId,\n@@ -284,10 +330,15 @@ export const completePreviewJob = httpAction(async (ctx, req) => {\n         status: \"skipped\",\n         stateReason: \"No screenshots available\",\n       });\n+\n+      const taskCompletion = await markPreviewTaskCompleted(ctx, taskRun, task);\n+\n       return jsonResponse({\n         success: true,\n         skipped: true,\n-        reason: \"No screenshots available\"\n+        reason: \"No screenshots available\",\n+        runStatusUpdated: taskCompletion.runStatusUpdated,\n+        alreadyCompleted: taskCompletion.taskAlreadyCompleted,\n       });\n     }\n \n@@ -333,9 +384,14 @@ export const completePreviewJob = httpAction(async (ctx, req) => {\n           previewRunId: previewRun._id,\n           commentUrl: commentResult.commentUrl,\n         });\n+\n+        const taskCompletion = await markPreviewTaskCompleted(ctx, taskRun, task);\n+\n         return jsonResponse({\n           success: true,\n           commentUrl: commentResult.commentUrl,\n+          runStatusUpdated: taskCompletion.runStatusUpdated,\n+          alreadyCompleted: taskCompletion.taskAlreadyCompleted,\n         });\n       } else {\n         console.error(\"[preview-jobs-http] Failed to post GitHub comment\", {\n@@ -360,10 +416,14 @@ export const completePreviewJob = httpAction(async (ctx, req) => {\n         status: \"completed\",\n       });\n \n+      const taskCompletion = await markPreviewTaskCompleted(ctx, taskRun, task);\n+\n       return jsonResponse({\n         success: true,\n         skipped: true,\n         reason: \"No GitHub installation ID\",\n+        runStatusUpdated: taskCompletion.runStatusUpdated,\n+        alreadyCompleted: taskCompletion.taskAlreadyCompleted,\n       });\n     }\n   } catch (error) {\ndiff --git a/packages/convex/convex/tasks.ts b/packages/convex/convex/tasks.ts\nindex ca75b7174..2983fb9a4 100644\n--- a/packages/convex/convex/tasks.ts\n+++ b/packages/convex/convex/tasks.ts\n@@ -856,3 +856,16 @@ export const createForPreview = internalMutation({\n     return taskId;\n   },\n });\n+\n+export const setCompletedInternal = internalMutation({\n+  args: {\n+    taskId: v.id(\"tasks\"),\n+    isCompleted: v.boolean(),\n+  },\n+  handler: async (ctx, args) => {\n+    await ctx.db.patch(args.taskId, {\n+      isCompleted: args.isCompleted,\n+      updatedAt: Date.now(),\n+    });\n+  },\n+});\n","comments":[{"type":"issue_comment","id":3592195786,"prNumber":1071,"botLogin":"cmux-agent-internal-dev[bot]","body":"[Open Workspace](https://cmux.sh/austin-dev/task/kn7cjx74gq283a7yeb5epr7vsx7wdrhv) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1071)\n\n## Preview Screenshots\n\nSuccessfully captured 3 screenshot(s) for commit `bc98479`:\n\n### dashboard-full-page.png\n![dashboard-full-page.png](https://famous-camel-162.convex.cloud/api/storage/1b3c0404-d3db-498f-a8ee-9a66ac3195c6)\n\n### dashboard-viewport.png\n![dashboard-viewport.png](https://famous-camel-162.convex.cloud/api/storage/48c86c9d-a20b-40f6-b91c-aa3fbe2e8a55)\n\n### task-detail-view.png\n![task-detail-view.png](https://famous-camel-162.convex.cloud/api/storage/902e26fe-7dee-4745-9d94-515c3a5a3ac1)\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"bc9847956d60cba52dda7724eaac7044d9af3402","createdAt":"2025-11-30T04:58:21Z","updatedAt":"2025-11-30T04:58:21Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1071#issuecomment-3592195786"}]}
{"number":1069,"title":"Fix account switch loading to show correct repos","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1069","headRef":"cmux/fix-account-switch-loading-to-show-correct-repos-g5674","headSha":"98860bfe5ef55514e4256f6835e4a52c6c25ce80","baseRef":"main","baseSha":"c6a8d8a2828e8b14767f9f11acdd9a4029bf144f","createdAt":"2025-11-30T03:29:23Z","updatedAt":"2025-11-30T05:37:36Z","diff":"diff --git a/apps/www/components/preview/preview-dashboard.tsx b/apps/www/components/preview/preview-dashboard.tsx\nindex de7caccc5..c55f8fb28 100644\n--- a/apps/www/components/preview/preview-dashboard.tsx\n+++ b/apps/www/components/preview/preview-dashboard.tsx\n@@ -327,7 +327,7 @@ export function PreviewDashboard({\n   };\n \n   const fetchRepos = useCallback(\n-    async (searchTerm: string) => {\n+    async (searchTerm: string, signal?: AbortSignal) => {\n       if (!canSearchRepos || selectedInstallationId === null) {\n         setRepos([]);\n         return;\n@@ -343,17 +343,23 @@ export function PreviewDashboard({\n         if (trimmed) {\n           params.set(\"search\", trimmed);\n         }\n-        const response = await fetch(`/api/integrations/github/repos?${params.toString()}`);\n+        const response = await fetch(`/api/integrations/github/repos?${params.toString()}`, {\n+          signal,\n+        });\n         if (!response.ok) {\n           throw new Error(await response.text());\n         }\n         const payload = (await response.json()) as { repos: RepoSearchResult[] };\n         setRepos(trimmed ? payload.repos : payload.repos.slice(0, 5));\n+        setIsLoadingRepos(false);\n       } catch (err) {\n+        if (err instanceof Error && err.name === \"AbortError\") {\n+          // Request was cancelled, don't update any state\n+          return;\n+        }\n         const message = err instanceof Error ? err.message : \"Failed to load repositories\";\n         console.error(\"[PreviewDashboard] Failed to load repositories\", err);\n         setErrorMessage(message);\n-      } finally {\n         setIsLoadingRepos(false);\n       }\n     },\n@@ -361,15 +367,22 @@ export function PreviewDashboard({\n   );\n \n \n-  // Debounced search effect\n+  // Debounced search effect with abort controller\n   useEffect(() => {\n-    if (!canSearchRepos || selectedInstallationId === null) return;\n+    if (!canSearchRepos || selectedInstallationId === null) {\n+      setRepos([]);\n+      return;\n+    }\n \n+    const abortController = new AbortController();\n     const timeoutId = setTimeout(() => {\n-      void fetchRepos(repoSearch);\n+      void fetchRepos(repoSearch, abortController.signal);\n     }, 300);\n \n-    return () => clearTimeout(timeoutId);\n+    return () => {\n+      clearTimeout(timeoutId);\n+      abortController.abort();\n+    };\n   }, [repoSearch, canSearchRepos, selectedInstallationId, fetchRepos]);\n \n   const handleContinue = useCallback((repoName: string) => {\n@@ -385,7 +398,11 @@ export function PreviewDashboard({\n \n   useEffect(() => {\n     if (selectedInstallationId !== null) {\n-      void fetchRepos(\"\");\n+      const abortController = new AbortController();\n+      void fetchRepos(\"\", abortController.signal);\n+      return () => {\n+        abortController.abort();\n+      };\n     } else {\n       setRepos([]);\n     }\n@@ -447,6 +464,9 @@ export function PreviewDashboard({\n                 void handleInstallGithubApp();\n                 return;\n               }\n+              // Clear repos and show loading state immediately when switching accounts\n+              setRepos([]);\n+              setIsLoadingRepos(true);\n               setSelectedInstallationId(Number(value));\n             }}\n             className=\"h-10 appearance-none bg-transparent py-2 pl-11 pr-8 text-sm text-white focus:outline-none\"\n","comments":[{"type":"issue_comment","id":3592158741,"prNumber":1069,"botLogin":"cmux-agent[bot]","body":"[Open Workspace](https://cmux.sh/manaflow/task/kn7a7xknyg781tzj5kgpc7ze617wc7d6) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1069)\n\n## Preview Screenshots\n\nSuccessfully captured 4 screenshot(s) for commit `a225759`:\n\n### choose-repository-section-header.png\n![choose-repository-section-header.png](https://adorable-wombat-701.convex.cloud/api/storage/7deaf8c3-21a3-4488-95fc-d0b3a6a001df)\n\n### connect-to-github-section.png\n![connect-to-github-section.png](https://adorable-wombat-701.convex.cloud/api/storage/077d8a08-5778-4682-9af5-1efb277d5af7)\n\n### preview-dashboard-initial-state.png\n![preview-dashboard-initial-state.png](https://adorable-wombat-701.convex.cloud/api/storage/ad1be1e0-85e7-4712-ad84-3b7cb741d0c0)\n\n### team-selector-dropdown.png\n![team-selector-dropdown.png](https://adorable-wombat-701.convex.cloud/api/storage/eed8f4dc-639d-4030-a669-df80ef17943a)\n\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"98860bfe5ef55514e4256f6835e4a52c6c25ce80","createdAt":"2025-11-30T03:33:04Z","updatedAt":"2025-11-30T03:33:04Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1069#issuecomment-3592158741"},{"type":"issue_comment","id":3592159485,"prNumber":1069,"botLogin":"cmux-agent-internal-dev[bot]","body":"[Open Workspace](https://cmux.sh/austin-dev/task/kn78fwb5jny9gsf5fyj0bwxbnh7wcgmt) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1069)\n\n## Preview Screenshots\n\nSuccessfully captured 4 screenshot(s) for commit `a225759`:\n\n### choose-repository-section.png\n![choose-repository-section.png](https://famous-camel-162.convex.cloud/api/storage/caf14900-23dd-43d2-b040-28f32bdd764a)\n\n### preview-page-current-state.png\n![preview-page-current-state.png](https://famous-camel-162.convex.cloud/api/storage/2d2ca08e-f4fa-49a4-9858-0526887dc335)\n\n### preview-page-initial-state.png\n![preview-page-initial-state.png](https://famous-camel-162.convex.cloud/api/storage/88825c0e-50dc-4c46-bf07-33956668943c)\n\n### preview-page-with-errors.png\n![preview-page-with-errors.png](https://famous-camel-162.convex.cloud/api/storage/505266c5-33ad-4f7b-9a19-fe32c9ea334a)\n\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"98860bfe5ef55514e4256f6835e4a52c6c25ce80","createdAt":"2025-11-30T03:34:33Z","updatedAt":"2025-11-30T03:34:33Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1069#issuecomment-3592159485"},{"type":"issue_comment","id":3592203469,"prNumber":1069,"botLogin":"cmux-agent-internal-dev[bot]","body":"[Open Workspace](https://cmux.sh/austin-dev/task/kn71jzg6s2y2ysrrq3qdh2zwc17wcd6p) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1069)\n\n## Preview Screenshots\n\nSuccessfully captured 5 screenshot(s) for commit `98860bf`:\n\n### configured-repositories.png\n![configured-repositories.png](https://famous-camel-162.convex.cloud/api/storage/447439f1-1aaf-4e35-beb1-19b006430d9f)\n\n### header-section.png\n![header-section.png](https://famous-camel-162.convex.cloud/api/storage/eac00784-48c2-4739-8b2b-b7b3eb2b2443)\n\n### preview-dashboard-initial-state.png\n![preview-dashboard-initial-state.png](https://famous-camel-162.convex.cloud/api/storage/ddfbbd41-4e80-4877-acbf-81211558f6b8)\n\n### repository-selection-and-features.png\n![repository-selection-and-features.png](https://famous-camel-162.convex.cloud/api/storage/3c500da0-557c-4fa9-b23e-5f3e16641c3f)\n\n### team-selector-and-connect-github.png\n![team-selector-and-connect-github.png](https://famous-camel-162.convex.cloud/api/storage/72190f86-b8ea-461f-bb5e-752ab81c2d5b)\n\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"98860bfe5ef55514e4256f6835e4a52c6c25ce80","createdAt":"2025-11-30T05:13:27Z","updatedAt":"2025-11-30T05:13:27Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1069#issuecomment-3592203469"},{"type":"issue_comment","id":3592227951,"prNumber":1069,"botLogin":"cmux-agent[bot]","body":"[Open Workspace](https://cmux.sh/manaflow/task/kn797xwkp3mtcsfqzn227czge97wcc8s) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1069)\n\n## Preview Screenshots\n\nSuccessfully captured 9 screenshot(s) for commit `98860bf`:\n\n### account-2-no-repos-state.png\n![account-2-no-repos-state.png](https://adorable-wombat-701.convex.cloud/api/storage/2408a618-f624-4ce5-bac7-3bc0ee68217f)\n\n### account-dropdown-focused.png\n![account-dropdown-focused.png](https://adorable-wombat-701.convex.cloud/api/storage/6c132354-3acd-45a5-ae77-bf25565c7808)\n\n### account-switch-back-loading-state.png\n![account-switch-back-loading-state.png](https://adorable-wombat-701.convex.cloud/api/storage/abfa2c91-cd89-477c-b105-08c6243e6481)\n\n### account-switch-loading-state.png\n![account-switch-loading-state.png](https://adorable-wombat-701.convex.cloud/api/storage/c3a260a7-a39a-4d05-ae56-3b3ab8849d50)\n\n### full-page-with-account-dropdown.png\n![full-page-with-account-dropdown.png](https://adorable-wombat-701.convex.cloud/api/storage/f2342cd6-3004-479c-8c94-8b0e5ac4e3af)\n\n### preview-dashboard-manaflow-team.png\n![preview-dashboard-manaflow-team.png](https://adorable-wombat-701.convex.cloud/api/storage/e898234e-711a-4479-ad08-d520590d6831)\n\n### preview-dashboard-no-github-app.png\n![preview-dashboard-no-github-app.png](https://adorable-wombat-701.convex.cloud/api/storage/d599a3af-6a68-4ad8-95d7-5f24ff05b5b8)\n\n### repository-selection-box-detail.png\n![repository-selection-box-detail.png](https://adorable-wombat-701.convex.cloud/api/storage/acd5ace4-2923-432f-b3fa-62874c94d205)\n\n### repository-selection-with-accounts-dropdown.png\n![repository-selection-with-accounts-dropdown.png](https://adorable-wombat-701.convex.cloud/api/storage/02194abd-349a-4d96-bfd9-ef6de6b54652)\n\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"98860bfe5ef55514e4256f6835e4a52c6c25ce80","createdAt":"2025-11-30T05:37:36Z","updatedAt":"2025-11-30T05:37:36Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1069#issuecomment-3592227951"}]}
{"number":1067,"title":"web mode feature flags","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1067","headRef":"web-mode-feature-flags-0","headSha":"6228392a779dc91eb5412068510df105c4c1e88c","baseRef":"main","baseSha":"c6a8d8a2828e8b14767f9f11acdd9a4029bf144f","createdAt":"2025-11-30T02:44:00Z","updatedAt":"2025-11-30T05:29:04Z","diff":"diff --git a/apps/client/src/client-env.ts b/apps/client/src/client-env.ts\nindex 6f0e2c7b6..511f4f1f4 100644\n--- a/apps/client/src/client-env.ts\n+++ b/apps/client/src/client-env.ts\n@@ -17,6 +17,11 @@ export const env = createEnv({\n     NEXT_PUBLIC_SERVER_ORIGIN: z.string().optional(),\n     NEXT_PUBLIC_POSTHOG_KEY: z.string().optional(),\n     NEXT_PUBLIC_POSTHOG_HOST: z.string().optional(),\n+    // When enabled, restricts features to web-compatible only (e.g., cloud mode only, no local Docker)\n+    NEXT_PUBLIC_WEB_MODE: z\n+      .enum([\"true\", \"false\"])\n+      .optional()\n+      .transform((v) => v === \"true\"),\n   },\n \n   /**\ndiff --git a/apps/client/src/components/OpenEditorSplitButton.tsx b/apps/client/src/components/OpenEditorSplitButton.tsx\nindex 443040b76..9dc771247 100644\n--- a/apps/client/src/components/OpenEditorSplitButton.tsx\n+++ b/apps/client/src/components/OpenEditorSplitButton.tsx\n@@ -1,3 +1,4 @@\n+import { env } from \"@/client-env\";\n import { editorIcons } from \"@/components/ui/dropdown-types\";\n import { useSocket } from \"@/contexts/socket/use-socket\";\n import { Menu } from \"@base-ui-components/react/menu\";\n@@ -205,6 +206,11 @@ export function OpenEditorSplitButton({\n     openEditor(selected.id);\n   }, [openEditor, selected]);\n \n+  // In web mode, opening local editors is not available\n+  if (env.NEXT_PUBLIC_WEB_MODE) {\n+    return null;\n+  }\n+\n   return (\n     <div className=\"flex items-stretch\">\n       <button\ndiff --git a/apps/client/src/components/OpenInEditorButton.tsx b/apps/client/src/components/OpenInEditorButton.tsx\nindex 192c14cef..d4dd46e97 100644\n--- a/apps/client/src/components/OpenInEditorButton.tsx\n+++ b/apps/client/src/components/OpenInEditorButton.tsx\n@@ -1,3 +1,4 @@\n+import { env } from \"@/client-env\";\n import { useSocket } from \"@/contexts/socket/use-socket\";\n import { ChevronDown, ExternalLink } from \"lucide-react\";\n import { useEffect, useRef, useState, useMemo } from \"react\";\n@@ -100,6 +101,11 @@ export function OpenInEditorButton({ workspacePath }: OpenInEditorButtonProps) {\n     }\n   };\n \n+  // In web mode, opening local editors is not available\n+  if (env.NEXT_PUBLIC_WEB_MODE) {\n+    return null;\n+  }\n+\n   return (\n     <div className=\"relative\" ref={dropdownRef}>\n       <div className=\"flex items-center h-8 bg-neutral-800 rounded-md overflow-hidden border border-neutral-700 shadow-sm\">\ndiff --git a/apps/client/src/components/dashboard/DashboardInputControls.tsx b/apps/client/src/components/dashboard/DashboardInputControls.tsx\nindex 0f8285a44..7a283dd2a 100644\n--- a/apps/client/src/components/dashboard/DashboardInputControls.tsx\n+++ b/apps/client/src/components/dashboard/DashboardInputControls.tsx\n@@ -674,12 +674,14 @@ export const DashboardInputControls = memo(function DashboardInputControls({\n       </div>\n \n       <div className=\"flex items-center justify-end gap-2.5 ml-auto mr-0 pr-1\">\n-        {/* Cloud/Local Mode Toggle */}\n-        <ModeToggleTooltip\n-          isCloudMode={isCloudMode}\n-          onToggle={onCloudModeToggle}\n-          disabled={cloudToggleDisabled}\n-        />\n+        {/* Cloud/Local Mode Toggle - hidden in web mode (always cloud) */}\n+        {!env.NEXT_PUBLIC_WEB_MODE && (\n+          <ModeToggleTooltip\n+            isCloudMode={isCloudMode}\n+            onToggle={onCloudModeToggle}\n+            disabled={cloudToggleDisabled}\n+          />\n+        )}\n \n         <button\n           className={clsx(\ndiff --git a/apps/client/src/routes/_layout.$teamSlugOrId.dashboard.tsx b/apps/client/src/routes/_layout.$teamSlugOrId.dashboard.tsx\nindex 60c0acb17..ed01d6c1a 100644\n--- a/apps/client/src/routes/_layout.$teamSlugOrId.dashboard.tsx\n+++ b/apps/client/src/routes/_layout.$teamSlugOrId.dashboard.tsx\n@@ -1,3 +1,4 @@\n+import { env } from \"@/client-env\";\n import {\n   DashboardInput,\n   type EditorApi,\n@@ -136,7 +137,9 @@ function DashboardComponent() {\n   );\n \n   const [taskDescription, setTaskDescription] = useState<string>(\"\");\n+  // In web mode, always force cloud mode\n   const [isCloudMode, setIsCloudMode] = useState<boolean>(() => {\n+    if (env.NEXT_PUBLIC_WEB_MODE) return true;\n     const stored = localStorage.getItem(\"isCloudMode\");\n     return stored ? JSON.parse(stored) : true;\n   });\n@@ -726,6 +729,8 @@ function DashboardComponent() {\n \n   // Cloud mode toggle handler\n   const handleCloudModeToggle = useCallback(() => {\n+    // In web mode, always stay in cloud mode\n+    if (env.NEXT_PUBLIC_WEB_MODE) return;\n     if (isEnvSelected) return; // environment forces cloud mode\n     const newMode = !isCloudMode;\n     setIsCloudMode(newMode);\ndiff --git a/apps/client/src/routes/_layout.$teamSlugOrId.settings.tsx b/apps/client/src/routes/_layout.$teamSlugOrId.settings.tsx\nindex a92ea5639..f18a1f590 100644\n--- a/apps/client/src/routes/_layout.$teamSlugOrId.settings.tsx\n+++ b/apps/client/src/routes/_layout.$teamSlugOrId.settings.tsx\n@@ -1,3 +1,4 @@\n+import { env } from \"@/client-env\";\n import { ContainerSettings } from \"@/components/ContainerSettings\";\n import { FloatingPane } from \"@/components/floating-pane\";\n import { ProviderStatusSettings } from \"@/components/provider-status-settings\";\n@@ -642,40 +643,42 @@ function SettingsComponent() {\n               </div>\n             </div>\n \n-            {/* Worktree Path */}\n-            <div className=\"bg-white dark:bg-neutral-950 rounded-lg border border-neutral-200 dark:border-neutral-800\">\n-              <div className=\"px-4 py-3 border-b border-neutral-200 dark:border-neutral-800\">\n-                <h2 className=\"text-sm font-medium text-neutral-900 dark:text-neutral-100\">\n-                  Worktree Location\n-                </h2>\n-              </div>\n-              <div className=\"p-4\">\n-                <div>\n-                  <label\n-                    htmlFor=\"worktreePath\"\n-                    className=\"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2\"\n-                  >\n-                    Custom Worktree Path\n-                  </label>\n-                  <p className=\"text-xs text-neutral-500 dark:text-neutral-400 mb-3\">\n-                    Specify where to store git worktrees. Leave empty to use the\n-                    default location. You can use ~ for your home directory.\n-                  </p>\n-                  <input\n-                    type=\"text\"\n-                    id=\"worktreePath\"\n-                    value={worktreePath}\n-                    onChange={(e) => setWorktreePath(e.target.value)}\n-                    className=\"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-neutral-900 text-neutral-900 dark:text-neutral-100\"\n-                    placeholder=\"~/my-custom-worktrees\"\n-                    autoComplete=\"off\"\n-                  />\n-                  <p className=\"text-xs text-neutral-500 dark:text-neutral-400 mt-2\">\n-                    Default location: ~/cmux\n-                  </p>\n+            {/* Worktree Path - hidden in web mode */}\n+            {!env.NEXT_PUBLIC_WEB_MODE && (\n+              <div className=\"bg-white dark:bg-neutral-950 rounded-lg border border-neutral-200 dark:border-neutral-800\">\n+                <div className=\"px-4 py-3 border-b border-neutral-200 dark:border-neutral-800\">\n+                  <h2 className=\"text-sm font-medium text-neutral-900 dark:text-neutral-100\">\n+                    Worktree Location\n+                  </h2>\n+                </div>\n+                <div className=\"p-4\">\n+                  <div>\n+                    <label\n+                      htmlFor=\"worktreePath\"\n+                      className=\"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2\"\n+                    >\n+                      Custom Worktree Path\n+                    </label>\n+                    <p className=\"text-xs text-neutral-500 dark:text-neutral-400 mb-3\">\n+                      Specify where to store git worktrees. Leave empty to use the\n+                      default location. You can use ~ for your home directory.\n+                    </p>\n+                    <input\n+                      type=\"text\"\n+                      id=\"worktreePath\"\n+                      value={worktreePath}\n+                      onChange={(e) => setWorktreePath(e.target.value)}\n+                      className=\"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-neutral-900 text-neutral-900 dark:text-neutral-100\"\n+                      placeholder=\"~/my-custom-worktrees\"\n+                      autoComplete=\"off\"\n+                    />\n+                    <p className=\"text-xs text-neutral-500 dark:text-neutral-400 mt-2\">\n+                      Default location: ~/cmux\n+                    </p>\n+                  </div>\n                 </div>\n               </div>\n-            </div>\n+            )}\n \n             {/* AI Provider Authentication */}\n             <div className=\"bg-white dark:bg-neutral-950 rounded-lg border border-neutral-200 dark:border-neutral-800\">\n@@ -965,32 +968,36 @@ function SettingsComponent() {\n               </div>\n             </div>\n \n-            {/* Provider Status */}\n-            <div className=\"bg-white dark:bg-neutral-950 rounded-lg border border-neutral-200 dark:border-neutral-800\">\n-              <div className=\"px-4 py-3 border-b border-neutral-200 dark:border-neutral-800\">\n-                <h2 className=\"text-sm font-medium text-neutral-900 dark:text-neutral-100\">\n-                  Provider Status\n-                </h2>\n-              </div>\n-              <div className=\"p-4\">\n-                <ProviderStatusSettings />\n+            {/* Provider Status - hidden in web mode */}\n+            {!env.NEXT_PUBLIC_WEB_MODE && (\n+              <div className=\"bg-white dark:bg-neutral-950 rounded-lg border border-neutral-200 dark:border-neutral-800\">\n+                <div className=\"px-4 py-3 border-b border-neutral-200 dark:border-neutral-800\">\n+                  <h2 className=\"text-sm font-medium text-neutral-900 dark:text-neutral-100\">\n+                    Provider Status\n+                  </h2>\n+                </div>\n+                <div className=\"p-4\">\n+                  <ProviderStatusSettings />\n+                </div>\n               </div>\n-            </div>\n+            )}\n \n-            {/* Container Settings */}\n-            <div className=\"bg-white dark:bg-neutral-950 rounded-lg border border-neutral-200 dark:border-neutral-800\">\n-              <div className=\"px-4 py-3 border-b border-neutral-200 dark:border-neutral-800\">\n-                <h2 className=\"text-sm font-medium text-neutral-900 dark:text-neutral-100\">\n-                  Container Management\n-                </h2>\n-              </div>\n-              <div className=\"p-4\">\n-                <ContainerSettings\n-                  teamSlugOrId={teamSlugOrId}\n-                  onDataChange={handleContainerSettingsChange}\n-                />\n+            {/* Container Settings - hidden in web mode */}\n+            {!env.NEXT_PUBLIC_WEB_MODE && (\n+              <div className=\"bg-white dark:bg-neutral-950 rounded-lg border border-neutral-200 dark:border-neutral-800\">\n+                <div className=\"px-4 py-3 border-b border-neutral-200 dark:border-neutral-800\">\n+                  <h2 className=\"text-sm font-medium text-neutral-900 dark:text-neutral-100\">\n+                    Container Management\n+                  </h2>\n+                </div>\n+                <div className=\"p-4\">\n+                  <ContainerSettings\n+                    teamSlugOrId={teamSlugOrId}\n+                    onDataChange={handleContainerSettingsChange}\n+                  />\n+                </div>\n               </div>\n-            </div>\n+            )}\n \n             {/* Notifications */}\n             <div className=\"bg-white dark:bg-neutral-950 rounded-lg border border-neutral-200 dark:border-neutral-800 hidden\">\ndiff --git a/apps/server/src/socket-handlers.ts b/apps/server/src/socket-handlers.ts\nindex f97e2366c..8591329b1 100644\n--- a/apps/server/src/socket-handlers.ts\n+++ b/apps/server/src/socket-handlers.ts\n@@ -1,4 +1,5 @@\n import { api } from \"@cmux/convex/api\";\n+import { env } from \"./utils/server-env\";\n import type { Id } from \"@cmux/convex/dataModel\";\n import type { WorkspaceConfigResponse } from \"@cmux/www-openapi-client\";\n import {\n@@ -382,7 +383,8 @@ export function setupSocketHandlers(\n         });\n       });\n       // Start Docker container state sync after first authenticated connection\n-      if (!dockerEventsStarted) {\n+      // Skip in web mode since Docker is not used\n+      if (!dockerEventsStarted && !env.NEXT_PUBLIC_WEB_MODE) {\n         dockerEventsStarted = true;\n         runWithAuth(initialToken, initialAuthJson, () => {\n           serverLogger.info(\n@@ -452,6 +454,23 @@ export function setupSocketHandlers(\n     });\n \n     void (async () => {\n+      // In web mode, skip detecting local editors entirely\n+      if (env.NEXT_PUBLIC_WEB_MODE) {\n+        const emptyAvailability: AvailableEditors = {\n+          vscode: false,\n+          cursor: false,\n+          windsurf: false,\n+          finder: false,\n+          iterm: false,\n+          terminal: false,\n+          ghostty: false,\n+          alacritty: false,\n+          xcode: false,\n+        };\n+        socket.emit(\"available-editors\", emptyAvailability);\n+        return;\n+      }\n+\n       const commandExists = async (cmd: string) => {\n         try {\n           await execAsync(`command -v ${cmd}`);\n@@ -525,6 +544,15 @@ export function setupSocketHandlers(\n       serverLogger.info(\"starting task!\", taskData);\n       const taskId = taskData.taskId;\n       try {\n+        // In web mode, local (Docker) tasks are not supported\n+        if (env.NEXT_PUBLIC_WEB_MODE && !taskData.isCloudMode) {\n+          callback({\n+            taskId,\n+            error: \"Local mode is not available in the web version. Please use Cloud mode.\",\n+          });\n+          return;\n+        }\n+\n         // For local mode, ensure Docker is running before attempting to spawn\n         if (!taskData.isCloudMode) {\n           try {\n@@ -705,6 +733,11 @@ export function setupSocketHandlers(\n         if (!callback) {\n           return;\n         }\n+        // In web mode, local VSCode serve-web is not used\n+        if (env.NEXT_PUBLIC_WEB_MODE) {\n+          callback({ baseUrl: null, port: null });\n+          return;\n+        }\n         try {\n           callback({\n             baseUrl: getVSCodeServeWebBaseUrl(),\n@@ -729,6 +762,15 @@ export function setupSocketHandlers(\n         rawData,\n         callback: (response: CreateLocalWorkspaceResponse) => void\n       ) => {\n+        // In web mode, local workspaces are not supported\n+        if (env.NEXT_PUBLIC_WEB_MODE) {\n+          callback({\n+            success: false,\n+            error: \"Local workspaces are not available in the web version. Please use Cloud mode.\",\n+          });\n+          return;\n+        }\n+\n         const parsed = CreateLocalWorkspaceSchema.safeParse(rawData);\n         if (!parsed.success) {\n           serverLogger.error(\n@@ -1653,6 +1695,12 @@ export function setupSocketHandlers(\n     // (I'll include the rest of the handlers in the next message due to length)\n \n     socket.on(\"open-in-editor\", async (data, callback) => {\n+      // In web mode, opening local editors is not supported\n+      if (env.NEXT_PUBLIC_WEB_MODE) {\n+        callback?.({ success: false, error: \"Opening local editors is not available in the web version.\" });\n+        return;\n+      }\n+\n       try {\n         const { editor, path } = OpenInEditorSchema.parse(data);\n \n@@ -1965,6 +2013,17 @@ export function setupSocketHandlers(\n     });\n \n     socket.on(\"github-test-auth\", async (callback) => {\n+      // In web mode, this debug feature is not available\n+      if (env.NEXT_PUBLIC_WEB_MODE) {\n+        callback({\n+          authStatus: \"Not available in web mode\",\n+          whoami: \"N/A\",\n+          home: \"N/A\",\n+          ghConfig: \"N/A\",\n+        });\n+        return;\n+      }\n+\n       try {\n         // Run all commands in parallel\n         const [authStatus, whoami, home, ghConfig] = await Promise.all([\n@@ -2364,6 +2423,17 @@ ${title}`;\n     });\n \n     socket.on(\"check-provider-status\", async (callback) => {\n+      // In web mode, Docker/local providers are not used - return \"ready\" status\n+      if (env.NEXT_PUBLIC_WEB_MODE) {\n+        callback({\n+          success: true,\n+          providers: [\n+            { name: \"morph\", isAvailable: true },\n+          ],\n+        });\n+        return;\n+      }\n+\n       try {\n         const status = await checkAllProvidersStatus({\n           teamSlugOrId: safeTeam,\n@@ -2382,6 +2452,13 @@ ${title}`;\n       try {\n         const { taskId } = ArchiveTaskSchema.parse(data);\n \n+        // In web mode, skip Docker container operations (managed by cloud provider)\n+        if (env.NEXT_PUBLIC_WEB_MODE) {\n+          serverLogger.info(`Skipping container cleanup for task ${taskId} in web mode`);\n+          callback({ success: true });\n+          return;\n+        }\n+\n         // Stop/pause all containers via helper (handles querying + logging)\n         const results = await stopContainersForRuns(taskId, safeTeam);\n \ndiff --git a/apps/server/src/utils/getGitHubToken.ts b/apps/server/src/utils/getGitHubToken.ts\nindex d7ff2a643..2e038da34 100644\n--- a/apps/server/src/utils/getGitHubToken.ts\n+++ b/apps/server/src/utils/getGitHubToken.ts\n@@ -1,26 +1,79 @@\n import { exec } from \"node:child_process\";\n import { promisify } from \"node:util\";\n+import { getAuthHeaderJson } from \"./requestContext\";\n+import { env, getWwwBaseUrl } from \"./server-env\";\n \n const execAsync = promisify(exec);\n \n-export async function getGitHubTokenFromKeychain(): Promise<string | null> {\n+/**\n+ * Get GitHub OAuth token from Stack Auth via the www API.\n+ * This uses the current user's connected GitHub account.\n+ */\n+async function getGitHubTokenFromStackAuth(): Promise<string | null> {\n+  const authHeaderJson = getAuthHeaderJson();\n+  if (!authHeaderJson) {\n+    return null;\n+  }\n+\n   try {\n-    // Only try to get GitHub token from gh CLI\n-    try {\n-      const { stdout: ghToken } = await execAsync(\n-        \"bash -lc 'gh auth token 2>/dev/null'\"\n-      );\n-      if (ghToken.trim()) {\n-        return ghToken.trim();\n-      }\n-    } catch {\n-      // gh not available or not authenticated\n+    const baseUrl = getWwwBaseUrl();\n+    const response = await fetch(`${baseUrl}/api/integrations/github/oauth-token`, {\n+      method: \"GET\",\n+      headers: {\n+        \"x-stack-auth\": authHeaderJson,\n+      },\n+    });\n+\n+    if (!response.ok) {\n+      console.error(`[getGitHubToken] Stack Auth API returned ${response.status}`);\n+      return null;\n     }\n \n+    const data = (await response.json()) as { accessToken: string | null; error: string | null };\n+    if (data.error) {\n+      console.warn(`[getGitHubToken] Stack Auth error: ${data.error}`);\n+      return null;\n+    }\n+\n+    return data.accessToken;\n+  } catch (error) {\n+    console.error(\"[getGitHubToken] Failed to get token from Stack Auth:\", error);\n     return null;\n+  }\n+}\n+\n+/**\n+ * Get GitHub token from local gh CLI.\n+ * Only used in non-web (Electron) mode.\n+ */\n+async function getGitHubTokenFromGhCli(): Promise<string | null> {\n+  try {\n+    const { stdout: ghToken } = await execAsync(\n+      \"bash -lc 'gh auth token 2>/dev/null'\"\n+    );\n+    if (ghToken.trim()) {\n+      return ghToken.trim();\n+    }\n   } catch {\n+    // gh not available or not authenticated\n+  }\n+  return null;\n+}\n+\n+export async function getGitHubTokenFromKeychain(): Promise<string | null> {\n+  // Always try Stack Auth first (works in both web and electron mode)\n+  const stackAuthToken = await getGitHubTokenFromStackAuth();\n+  if (stackAuthToken) {\n+    return stackAuthToken;\n+  }\n+\n+  // In web mode, don't fall back to gh CLI (it won't be available)\n+  if (env.NEXT_PUBLIC_WEB_MODE) {\n     return null;\n   }\n+\n+  // Fall back to gh CLI in non-web mode\n+  return getGitHubTokenFromGhCli();\n }\n \n export async function getGitCredentialsFromHost(): Promise<{\ndiff --git a/apps/server/src/utils/server-env.ts b/apps/server/src/utils/server-env.ts\nindex 176f15d5c..a7338fd2f 100644\n--- a/apps/server/src/utils/server-env.ts\n+++ b/apps/server/src/utils/server-env.ts\n@@ -7,6 +7,11 @@ export const env = createEnv({\n     // Public origin used across the app; prefer this for WWW base URL\n     NEXT_PUBLIC_WWW_ORIGIN: z.string().min(1).optional(),\n     NEXT_PUBLIC_CONVEX_URL: z.string().min(1),\n+    // When enabled, restricts features to web-compatible only (e.g., cloud mode only, no local Docker)\n+    NEXT_PUBLIC_WEB_MODE: z\n+      .enum([\"true\", \"false\"])\n+      .optional()\n+      .transform((v) => v === \"true\"),\n   },\n   // Handle both Node and Vite/Bun\n   runtimeEnv: { ...import.meta.env, ...process.env },\ndiff --git a/apps/www/lib/hono-app.ts b/apps/www/lib/hono-app.ts\nindex 6f0e38564..fc783d9ab 100644\n--- a/apps/www/lib/hono-app.ts\n+++ b/apps/www/lib/hono-app.ts\n@@ -15,6 +15,7 @@ import {\n   devServerRouter,\n   environmentsRouter,\n   githubInstallStateRouter,\n+  githubOAuthTokenRouter,\n   healthRouter,\n   morphRouter,\n   sandboxesRouter,\n@@ -115,6 +116,7 @@ app.route(\"/\", githubPrsFilesRouter);\n app.route(\"/\", githubPrsFileContentsRouter);\n app.route(\"/\", githubPrsFileContentsBatchRouter);\n app.route(\"/\", githubInstallStateRouter);\n+app.route(\"/\", githubOAuthTokenRouter);\n app.route(\"/\", morphRouter);\n app.route(\"/\", iframePreflightRouter);\n app.route(\"/\", environmentsRouter);\ndiff --git a/apps/www/lib/routes/github.oauth-token.route.ts b/apps/www/lib/routes/github.oauth-token.route.ts\nnew file mode 100644\nindex 000000000..09019d02b\n--- /dev/null\n+++ b/apps/www/lib/routes/github.oauth-token.route.ts\n@@ -0,0 +1,57 @@\n+import { stackServerAppJs } from \"@/lib/utils/stack\";\n+import { createRoute, OpenAPIHono, z } from \"@hono/zod-openapi\";\n+\n+export const githubOAuthTokenRouter = new OpenAPIHono();\n+\n+const GithubOAuthTokenResponse = z\n+  .object({\n+    accessToken: z.string().nullable(),\n+    error: z.string().nullable(),\n+  })\n+  .openapi(\"GithubOAuthTokenResponse\");\n+\n+githubOAuthTokenRouter.openapi(\n+  createRoute({\n+    method: \"get\" as const,\n+    path: \"/integrations/github/oauth-token\",\n+    tags: [\"Integrations\"],\n+    summary: \"Get the current user's GitHub OAuth access token\",\n+    responses: {\n+      200: {\n+        description: \"GitHub OAuth token response\",\n+        content: {\n+          \"application/json\": {\n+            schema: GithubOAuthTokenResponse,\n+          },\n+        },\n+      },\n+      401: { description: \"Unauthorized\" },\n+    },\n+  }),\n+  async (c) => {\n+    const user = await stackServerAppJs.getUser({ tokenStore: c.req.raw });\n+    if (!user) {\n+      return c.text(\"Unauthorized\", 401);\n+    }\n+\n+    try {\n+      const githubAccount = await user.getConnectedAccount(\"github\");\n+      if (!githubAccount) {\n+        return c.json({ accessToken: null, error: \"GitHub account not connected\" }, 200);\n+      }\n+\n+      const { accessToken } = await githubAccount.getAccessToken();\n+      if (!accessToken || accessToken.trim().length === 0) {\n+        return c.json({ accessToken: null, error: \"GitHub access token not found\" }, 200);\n+      }\n+\n+      return c.json({ accessToken: accessToken.trim(), error: null }, 200);\n+    } catch (error) {\n+      console.error(\"[github.oauth-token] Error getting GitHub token:\", error);\n+      return c.json({\n+        accessToken: null,\n+        error: error instanceof Error ? error.message : \"Failed to get GitHub token\",\n+      }, 200);\n+    }\n+  }\n+);\ndiff --git a/apps/www/lib/routes/index.ts b/apps/www/lib/routes/index.ts\nindex b6bdee25a..97b3d0fa4 100644\n--- a/apps/www/lib/routes/index.ts\n+++ b/apps/www/lib/routes/index.ts\n@@ -1,6 +1,7 @@\n export { booksRouter } from \"./books.route\";\n export { devServerRouter } from \"./dev-server.route\";\n export { environmentsRouter } from \"./environments.route\";\n+export { githubOAuthTokenRouter } from \"./github.oauth-token.route\";\n export { githubPrsBackfillRepoRouter } from \"./github.prs.backfill-repo.route\";\n export { githubPrsBackfillRouter } from \"./github.prs.backfill.route\";\n export { githubPrsCodeRouter } from \"./github.prs.code.route\";\ndiff --git a/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts b/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts\nindex 2b62b1d55..f99506014 100644\n--- a/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts\n+++ b/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts\n@@ -1,8 +1,8 @@\n // This file is auto-generated by @hey-api/openapi-ts\n \n-import { type Options, getApiHealth, postApiAuthAnonymousSignUp, getApiUsers, postApiUsers, deleteApiUsersById, getApiUsersById, patchApiUsersById, getApiBooks, postApiBooks, getApiBooksById, postApiBooksByIdBorrow, postApiBooksByIdReturn, postApiDevServerStart, getApiIntegrationsGithubRepos, getApiIntegrationsGithubPrs, postApiIntegrationsGithubPrsBackfill, postApiIntegrationsGithubPrsBackfillRepo, getApiIntegrationsGithubPrsCode, postApiIntegrationsGithubPrsOpen, postApiIntegrationsGithubPrsMerge, postApiIntegrationsGithubPrsClose, postApiIntegrationsGithubPrsMergeSimple, getApiIntegrationsGithubPrsRaw, getApiIntegrationsGithubPrsFiles, getApiIntegrationsGithubPrsFileContents, postApiIntegrationsGithubPrsFileContentsBatch, postApiIntegrationsGithubInstallState, postApiMorphTaskRunsByTaskRunIdResume, postApiMorphTaskRunsByTaskRunIdIsPaused, postApiMorphSetupInstance, getApiEnvironments, postApiEnvironments, deleteApiEnvironmentsById, getApiEnvironmentsById, patchApiEnvironmentsById, getApiEnvironmentsByIdVars, patchApiEnvironmentsByIdPorts, getApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivate, postApiSandboxesStart, postApiSandboxesByIdEnv, postApiSandboxesByIdStop, getApiSandboxesByIdStatus, postApiSandboxesByIdPublishDevcontainer, postApiTeams, postApiBranchesGenerate, postApiCodeReviewStart, getApiWorkspaceConfigs, postApiWorkspaceConfigs, getApiPreviewConfigs, postApiPreviewConfigs, deleteApiPreviewConfigsByPreviewConfigId, getApiPreviewConfigsByPreviewConfigIdRuns } from '../sdk.gen.js';\n+import { type Options, getApiHealth, postApiAuthAnonymousSignUp, getApiUsers, postApiUsers, deleteApiUsersById, getApiUsersById, patchApiUsersById, getApiBooks, postApiBooks, getApiBooksById, postApiBooksByIdBorrow, postApiBooksByIdReturn, postApiDevServerStart, getApiIntegrationsGithubRepos, getApiIntegrationsGithubPrs, postApiIntegrationsGithubPrsBackfill, postApiIntegrationsGithubPrsBackfillRepo, getApiIntegrationsGithubPrsCode, postApiIntegrationsGithubPrsOpen, postApiIntegrationsGithubPrsMerge, postApiIntegrationsGithubPrsClose, postApiIntegrationsGithubPrsMergeSimple, getApiIntegrationsGithubPrsRaw, getApiIntegrationsGithubPrsFiles, getApiIntegrationsGithubPrsFileContents, postApiIntegrationsGithubPrsFileContentsBatch, postApiIntegrationsGithubInstallState, getApiIntegrationsGithubOauthToken, postApiMorphTaskRunsByTaskRunIdResume, postApiMorphTaskRunsByTaskRunIdIsPaused, postApiMorphSetupInstance, getApiEnvironments, postApiEnvironments, deleteApiEnvironmentsById, getApiEnvironmentsById, patchApiEnvironmentsById, getApiEnvironmentsByIdVars, patchApiEnvironmentsByIdPorts, getApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivate, postApiSandboxesStart, postApiSandboxesByIdEnv, postApiSandboxesByIdStop, getApiSandboxesByIdStatus, postApiSandboxesByIdPublishDevcontainer, postApiTeams, postApiBranchesGenerate, postApiCodeReviewStart, getApiWorkspaceConfigs, postApiWorkspaceConfigs, getApiPreviewConfigs, postApiPreviewConfigs, deleteApiPreviewConfigsByPreviewConfigId, getApiPreviewConfigsByPreviewConfigIdRuns } from '../sdk.gen.js';\n import { queryOptions, type UseMutationOptions, type DefaultError, infiniteQueryOptions, type InfiniteData } from '@tanstack/react-query';\n-import type { GetApiHealthData, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponse, GetApiUsersData, GetApiUsersResponse, PostApiUsersData, PostApiUsersError, PostApiUsersResponse, DeleteApiUsersByIdData, DeleteApiUsersByIdError, DeleteApiUsersByIdResponse, GetApiUsersByIdData, PatchApiUsersByIdData, PatchApiUsersByIdError, PatchApiUsersByIdResponse, GetApiBooksData, PostApiBooksData, PostApiBooksError, PostApiBooksResponse, GetApiBooksByIdData, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowError, PostApiBooksByIdBorrowResponse, PostApiBooksByIdReturnData, PostApiBooksByIdReturnError, PostApiBooksByIdReturnResponse, PostApiDevServerStartData, PostApiDevServerStartError, PostApiDevServerStartResponse, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponse, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponse, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillRepoData, GetApiIntegrationsGithubPrsCodeData, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponse, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponse, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponse, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponse, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFileContentsData, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponse, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponse, PostApiMorphTaskRunsByTaskRunIdResumeData, PostApiMorphTaskRunsByTaskRunIdResumeResponse, PostApiMorphTaskRunsByTaskRunIdIsPausedData, PostApiMorphTaskRunsByTaskRunIdIsPausedResponse, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponse, GetApiEnvironmentsData, PostApiEnvironmentsData, PostApiEnvironmentsResponse, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdData, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdVarsData, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponse, GetApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponse, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponse, PostApiSandboxesStartData, PostApiSandboxesStartResponse, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponse, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponse, GetApiSandboxesByIdStatusData, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponse, PostApiTeamsData, PostApiTeamsError, PostApiTeamsResponse, PostApiBranchesGenerateData, PostApiBranchesGenerateResponse, PostApiCodeReviewStartData, PostApiCodeReviewStartResponse, GetApiWorkspaceConfigsData, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponse, GetApiPreviewConfigsData, PostApiPreviewConfigsData, PostApiPreviewConfigsResponse, DeleteApiPreviewConfigsByPreviewConfigIdData, DeleteApiPreviewConfigsByPreviewConfigIdResponse, GetApiPreviewConfigsByPreviewConfigIdRunsData } from '../types.gen.js';\n+import type { GetApiHealthData, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponse, GetApiUsersData, GetApiUsersResponse, PostApiUsersData, PostApiUsersError, PostApiUsersResponse, DeleteApiUsersByIdData, DeleteApiUsersByIdError, DeleteApiUsersByIdResponse, GetApiUsersByIdData, PatchApiUsersByIdData, PatchApiUsersByIdError, PatchApiUsersByIdResponse, GetApiBooksData, PostApiBooksData, PostApiBooksError, PostApiBooksResponse, GetApiBooksByIdData, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowError, PostApiBooksByIdBorrowResponse, PostApiBooksByIdReturnData, PostApiBooksByIdReturnError, PostApiBooksByIdReturnResponse, PostApiDevServerStartData, PostApiDevServerStartError, PostApiDevServerStartResponse, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponse, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponse, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillRepoData, GetApiIntegrationsGithubPrsCodeData, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponse, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponse, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponse, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponse, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFileContentsData, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponse, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponse, GetApiIntegrationsGithubOauthTokenData, PostApiMorphTaskRunsByTaskRunIdResumeData, PostApiMorphTaskRunsByTaskRunIdResumeResponse, PostApiMorphTaskRunsByTaskRunIdIsPausedData, PostApiMorphTaskRunsByTaskRunIdIsPausedResponse, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponse, GetApiEnvironmentsData, PostApiEnvironmentsData, PostApiEnvironmentsResponse, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdData, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdVarsData, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponse, GetApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponse, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponse, PostApiSandboxesStartData, PostApiSandboxesStartResponse, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponse, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponse, GetApiSandboxesByIdStatusData, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponse, PostApiTeamsData, PostApiTeamsError, PostApiTeamsResponse, PostApiBranchesGenerateData, PostApiBranchesGenerateResponse, PostApiCodeReviewStartData, PostApiCodeReviewStartResponse, GetApiWorkspaceConfigsData, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponse, GetApiPreviewConfigsData, PostApiPreviewConfigsData, PostApiPreviewConfigsResponse, DeleteApiPreviewConfigsByPreviewConfigIdData, DeleteApiPreviewConfigsByPreviewConfigIdResponse, GetApiPreviewConfigsByPreviewConfigIdRunsData } from '../types.gen.js';\n import { client as _heyApiClient } from '../client.gen.js';\n \n export type QueryKey<TOptions extends Options> = [\n@@ -651,6 +651,26 @@ export const postApiIntegrationsGithubInstallStateMutation = (options?: Partial<\n     return mutationOptions;\n };\n \n+export const getApiIntegrationsGithubOauthTokenQueryKey = (options?: Options<GetApiIntegrationsGithubOauthTokenData>) => createQueryKey('getApiIntegrationsGithubOauthToken', options);\n+\n+/**\n+ * Get the current user's GitHub OAuth access token\n+ */\n+export const getApiIntegrationsGithubOauthTokenOptions = (options?: Options<GetApiIntegrationsGithubOauthTokenData>) => {\n+    return queryOptions({\n+        queryFn: async ({ queryKey, signal }) => {\n+            const { data } = await getApiIntegrationsGithubOauthToken({\n+                ...options,\n+                ...queryKey[0],\n+                signal,\n+                throwOnError: true\n+            });\n+            return data;\n+        },\n+        queryKey: getApiIntegrationsGithubOauthTokenQueryKey(options)\n+    });\n+};\n+\n /**\n  * Resume the Morph instance backing a task run\n  */\ndiff --git a/packages/www-openapi-client/src/client/sdk.gen.ts b/packages/www-openapi-client/src/client/sdk.gen.ts\nindex a529cc467..834397a27 100644\n--- a/packages/www-openapi-client/src/client/sdk.gen.ts\n+++ b/packages/www-openapi-client/src/client/sdk.gen.ts\n@@ -1,7 +1,7 @@\n // This file is auto-generated by @hey-api/openapi-ts\n \n import type { Options as ClientOptions, TDataShape, Client } from './client/index.js';\n-import type { GetApiHealthData, GetApiHealthResponses, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponses, PostApiAuthAnonymousSignUpErrors, GetApiUsersData, GetApiUsersResponses, PostApiUsersData, PostApiUsersResponses, PostApiUsersErrors, DeleteApiUsersByIdData, DeleteApiUsersByIdResponses, DeleteApiUsersByIdErrors, GetApiUsersByIdData, GetApiUsersByIdResponses, GetApiUsersByIdErrors, PatchApiUsersByIdData, PatchApiUsersByIdResponses, PatchApiUsersByIdErrors, GetApiBooksData, GetApiBooksResponses, PostApiBooksData, PostApiBooksResponses, PostApiBooksErrors, GetApiBooksByIdData, GetApiBooksByIdResponses, GetApiBooksByIdErrors, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowResponses, PostApiBooksByIdBorrowErrors, PostApiBooksByIdReturnData, PostApiBooksByIdReturnResponses, PostApiBooksByIdReturnErrors, PostApiDevServerStartData, PostApiDevServerStartResponses, PostApiDevServerStartErrors, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponses, GetApiIntegrationsGithubReposErrors, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponses, GetApiIntegrationsGithubPrsErrors, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillResponses, PostApiIntegrationsGithubPrsBackfillErrors, PostApiIntegrationsGithubPrsBackfillRepoData, PostApiIntegrationsGithubPrsBackfillRepoResponses, PostApiIntegrationsGithubPrsBackfillRepoErrors, GetApiIntegrationsGithubPrsCodeData, GetApiIntegrationsGithubPrsCodeResponses, GetApiIntegrationsGithubPrsCodeErrors, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponses, PostApiIntegrationsGithubPrsOpenErrors, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponses, PostApiIntegrationsGithubPrsMergeErrors, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponses, PostApiIntegrationsGithubPrsCloseErrors, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponses, PostApiIntegrationsGithubPrsMergeSimpleErrors, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsRawResponses, GetApiIntegrationsGithubPrsRawErrors, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFilesResponses, GetApiIntegrationsGithubPrsFilesErrors, GetApiIntegrationsGithubPrsFileContentsData, GetApiIntegrationsGithubPrsFileContentsResponses, GetApiIntegrationsGithubPrsFileContentsErrors, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponses, PostApiIntegrationsGithubPrsFileContentsBatchErrors, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponses, PostApiIntegrationsGithubInstallStateErrors, PostApiMorphTaskRunsByTaskRunIdResumeData, PostApiMorphTaskRunsByTaskRunIdResumeResponses, PostApiMorphTaskRunsByTaskRunIdResumeErrors, PostApiMorphTaskRunsByTaskRunIdIsPausedData, PostApiMorphTaskRunsByTaskRunIdIsPausedResponses, PostApiMorphTaskRunsByTaskRunIdIsPausedErrors, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponses, PostApiMorphSetupInstanceErrors, GetApiIframePreflightData, GetApiIframePreflightResponses, GetApiIframePreflightErrors, GetApiEnvironmentsData, GetApiEnvironmentsResponses, GetApiEnvironmentsErrors, PostApiEnvironmentsData, PostApiEnvironmentsResponses, PostApiEnvironmentsErrors, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponses, DeleteApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdData, GetApiEnvironmentsByIdResponses, GetApiEnvironmentsByIdErrors, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponses, PatchApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdVarsData, GetApiEnvironmentsByIdVarsResponses, GetApiEnvironmentsByIdVarsErrors, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponses, PatchApiEnvironmentsByIdPortsErrors, GetApiEnvironmentsByIdSnapshotsData, GetApiEnvironmentsByIdSnapshotsResponses, GetApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponses, PostApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponses, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateErrors, PostApiSandboxesStartData, PostApiSandboxesStartResponses, PostApiSandboxesStartErrors, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponses, PostApiSandboxesByIdEnvErrors, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponses, PostApiSandboxesByIdStopErrors, GetApiSandboxesByIdStatusData, GetApiSandboxesByIdStatusResponses, GetApiSandboxesByIdStatusErrors, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponses, PostApiSandboxesByIdPublishDevcontainerErrors, PostApiTeamsData, PostApiTeamsResponses, PostApiTeamsErrors, PostApiBranchesGenerateData, PostApiBranchesGenerateResponses, PostApiBranchesGenerateErrors, PostApiCodeReviewStartData, PostApiCodeReviewStartResponses, PostApiCodeReviewStartErrors, GetApiWorkspaceConfigsData, GetApiWorkspaceConfigsResponses, GetApiWorkspaceConfigsErrors, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponses, PostApiWorkspaceConfigsErrors, GetApiPreviewConfigsData, GetApiPreviewConfigsResponses, GetApiPreviewConfigsErrors, PostApiPreviewConfigsData, PostApiPreviewConfigsResponses, PostApiPreviewConfigsErrors, DeleteApiPreviewConfigsByPreviewConfigIdData, DeleteApiPreviewConfigsByPreviewConfigIdResponses, DeleteApiPreviewConfigsByPreviewConfigIdErrors, GetApiPreviewConfigsByPreviewConfigIdRunsData, GetApiPreviewConfigsByPreviewConfigIdRunsResponses, GetApiPreviewConfigsByPreviewConfigIdRunsErrors } from './types.gen.js';\n+import type { GetApiHealthData, GetApiHealthResponses, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponses, PostApiAuthAnonymousSignUpErrors, GetApiUsersData, GetApiUsersResponses, PostApiUsersData, PostApiUsersResponses, PostApiUsersErrors, DeleteApiUsersByIdData, DeleteApiUsersByIdResponses, DeleteApiUsersByIdErrors, GetApiUsersByIdData, GetApiUsersByIdResponses, GetApiUsersByIdErrors, PatchApiUsersByIdData, PatchApiUsersByIdResponses, PatchApiUsersByIdErrors, GetApiBooksData, GetApiBooksResponses, PostApiBooksData, PostApiBooksResponses, PostApiBooksErrors, GetApiBooksByIdData, GetApiBooksByIdResponses, GetApiBooksByIdErrors, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowResponses, PostApiBooksByIdBorrowErrors, PostApiBooksByIdReturnData, PostApiBooksByIdReturnResponses, PostApiBooksByIdReturnErrors, PostApiDevServerStartData, PostApiDevServerStartResponses, PostApiDevServerStartErrors, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponses, GetApiIntegrationsGithubReposErrors, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponses, GetApiIntegrationsGithubPrsErrors, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillResponses, PostApiIntegrationsGithubPrsBackfillErrors, PostApiIntegrationsGithubPrsBackfillRepoData, PostApiIntegrationsGithubPrsBackfillRepoResponses, PostApiIntegrationsGithubPrsBackfillRepoErrors, GetApiIntegrationsGithubPrsCodeData, GetApiIntegrationsGithubPrsCodeResponses, GetApiIntegrationsGithubPrsCodeErrors, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponses, PostApiIntegrationsGithubPrsOpenErrors, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponses, PostApiIntegrationsGithubPrsMergeErrors, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponses, PostApiIntegrationsGithubPrsCloseErrors, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponses, PostApiIntegrationsGithubPrsMergeSimpleErrors, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsRawResponses, GetApiIntegrationsGithubPrsRawErrors, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFilesResponses, GetApiIntegrationsGithubPrsFilesErrors, GetApiIntegrationsGithubPrsFileContentsData, GetApiIntegrationsGithubPrsFileContentsResponses, GetApiIntegrationsGithubPrsFileContentsErrors, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponses, PostApiIntegrationsGithubPrsFileContentsBatchErrors, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponses, PostApiIntegrationsGithubInstallStateErrors, GetApiIntegrationsGithubOauthTokenData, GetApiIntegrationsGithubOauthTokenResponses, GetApiIntegrationsGithubOauthTokenErrors, PostApiMorphTaskRunsByTaskRunIdResumeData, PostApiMorphTaskRunsByTaskRunIdResumeResponses, PostApiMorphTaskRunsByTaskRunIdResumeErrors, PostApiMorphTaskRunsByTaskRunIdIsPausedData, PostApiMorphTaskRunsByTaskRunIdIsPausedResponses, PostApiMorphTaskRunsByTaskRunIdIsPausedErrors, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponses, PostApiMorphSetupInstanceErrors, GetApiIframePreflightData, GetApiIframePreflightResponses, GetApiIframePreflightErrors, GetApiEnvironmentsData, GetApiEnvironmentsResponses, GetApiEnvironmentsErrors, PostApiEnvironmentsData, PostApiEnvironmentsResponses, PostApiEnvironmentsErrors, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponses, DeleteApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdData, GetApiEnvironmentsByIdResponses, GetApiEnvironmentsByIdErrors, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponses, PatchApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdVarsData, GetApiEnvironmentsByIdVarsResponses, GetApiEnvironmentsByIdVarsErrors, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponses, PatchApiEnvironmentsByIdPortsErrors, GetApiEnvironmentsByIdSnapshotsData, GetApiEnvironmentsByIdSnapshotsResponses, GetApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponses, PostApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponses, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateErrors, PostApiSandboxesStartData, PostApiSandboxesStartResponses, PostApiSandboxesStartErrors, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponses, PostApiSandboxesByIdEnvErrors, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponses, PostApiSandboxesByIdStopErrors, GetApiSandboxesByIdStatusData, GetApiSandboxesByIdStatusResponses, GetApiSandboxesByIdStatusErrors, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponses, PostApiSandboxesByIdPublishDevcontainerErrors, PostApiTeamsData, PostApiTeamsResponses, PostApiTeamsErrors, PostApiBranchesGenerateData, PostApiBranchesGenerateResponses, PostApiBranchesGenerateErrors, PostApiCodeReviewStartData, PostApiCodeReviewStartResponses, PostApiCodeReviewStartErrors, GetApiWorkspaceConfigsData, GetApiWorkspaceConfigsResponses, GetApiWorkspaceConfigsErrors, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponses, PostApiWorkspaceConfigsErrors, GetApiPreviewConfigsData, GetApiPreviewConfigsResponses, GetApiPreviewConfigsErrors, PostApiPreviewConfigsData, PostApiPreviewConfigsResponses, PostApiPreviewConfigsErrors, DeleteApiPreviewConfigsByPreviewConfigIdData, DeleteApiPreviewConfigsByPreviewConfigIdResponses, DeleteApiPreviewConfigsByPreviewConfigIdErrors, GetApiPreviewConfigsByPreviewConfigIdRunsData, GetApiPreviewConfigsByPreviewConfigIdRunsResponses, GetApiPreviewConfigsByPreviewConfigIdRunsErrors } from './types.gen.js';\n import { client as _heyApiClient } from './client.gen.js';\n \n export type Options<TData extends TDataShape = TDataShape, ThrowOnError extends boolean = boolean> = ClientOptions<TData, ThrowOnError> & {\n@@ -337,6 +337,16 @@ export const postApiIntegrationsGithubInstallState = <ThrowOnError extends boole\n     });\n };\n \n+/**\n+ * Get the current user's GitHub OAuth access token\n+ */\n+export const getApiIntegrationsGithubOauthToken = <ThrowOnError extends boolean = false>(options?: Options<GetApiIntegrationsGithubOauthTokenData, ThrowOnError>) => {\n+    return (options?.client ?? _heyApiClient).get<GetApiIntegrationsGithubOauthTokenResponses, GetApiIntegrationsGithubOauthTokenErrors, ThrowOnError>({\n+        url: '/api/integrations/github/oauth-token',\n+        ...options\n+    });\n+};\n+\n /**\n  * Resume the Morph instance backing a task run\n  */\ndiff --git a/packages/www-openapi-client/src/client/types.gen.ts b/packages/www-openapi-client/src/client/types.gen.ts\nindex e454f1a45..c22b65e6a 100644\n--- a/packages/www-openapi-client/src/client/types.gen.ts\n+++ b/packages/www-openapi-client/src/client/types.gen.ts\n@@ -351,6 +351,11 @@ export type GithubInstallStateRequest = {\n     returnUrl?: string;\n };\n \n+export type GithubOAuthTokenResponse = {\n+    accessToken: string | null;\n+    error: string | null;\n+};\n+\n export type ResumeTaskRunResponse = {\n     resumed: true;\n };\n@@ -1624,6 +1629,29 @@ export type PostApiIntegrationsGithubInstallStateResponses = {\n \n export type PostApiIntegrationsGithubInstallStateResponse = PostApiIntegrationsGithubInstallStateResponses[keyof PostApiIntegrationsGithubInstallStateResponses];\n \n+export type GetApiIntegrationsGithubOauthTokenData = {\n+    body?: never;\n+    path?: never;\n+    query?: never;\n+    url: '/api/integrations/github/oauth-token';\n+};\n+\n+export type GetApiIntegrationsGithubOauthTokenErrors = {\n+    /**\n+     * Unauthorized\n+     */\n+    401: unknown;\n+};\n+\n+export type GetApiIntegrationsGithubOauthTokenResponses = {\n+    /**\n+     * GitHub OAuth token response\n+     */\n+    200: GithubOAuthTokenResponse;\n+};\n+\n+export type GetApiIntegrationsGithubOauthTokenResponse = GetApiIntegrationsGithubOauthTokenResponses[keyof GetApiIntegrationsGithubOauthTokenResponses];\n+\n export type PostApiMorphTaskRunsByTaskRunIdResumeData = {\n     body: ResumeTaskRunBody;\n     path: {\n","comments":[{"type":"issue_comment","id":3592132269,"prNumber":1067,"botLogin":"cmux-agent[bot]","body":"[Open Workspace](https://cmux.sh/manaflow/task/kn71851cnkxhrsrnf3179fe8ws7wdb1g) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1067)\n\n## Preview Screenshots\n\nSuccessfully captured 7 screenshot(s) for commit `5fccd6f`:\n\n### dashboard-cloud-mode-toggle-web-mode-feature-flags-0.png\n![dashboard-cloud-mode-toggle-web-mode-feature-flags-0.png](https://adorable-wombat-701.convex.cloud/api/storage/a27a6c5f-8e0c-4717-ac7e-9174644609d8)\n\n### dashboard-full-page-web-mode-feature-flags-0.png\n![dashboard-full-page-web-mode-feature-flags-0.png](https://adorable-wombat-701.convex.cloud/api/storage/c0bf0546-d94f-4229-8759-6c444b9013e6)\n\n### dashboard-input-controls-select-agents-web-mode-feature-flags-0.png\n![dashboard-input-controls-select-agents-web-mode-feature-flags-0.png](https://adorable-wombat-701.convex.cloud/api/storage/9d5fafd9-6dfb-4f5d-b16e-a63c657d9054)\n\n### dashboard-input-controls-select-project-web-mode-feature-flags-0.png\n![dashboard-input-controls-select-project-web-mode-feature-flags-0.png](https://adorable-wombat-701.convex.cloud/api/storage/9f4c4d10-dfaa-4e9f-aa26-9a718de001d4)\n\n### task-detail-choose-editor-button-web-mode-feature-flags-0.png\n![task-detail-choose-editor-button-web-mode-feature-flags-0.png](https://adorable-wombat-701.convex.cloud/api/storage/4b083432-055d-4fe4-8ceb-a85133eaed98)\n\n### task-detail-full-page-web-mode-feature-flags-0.png\n![task-detail-full-page-web-mode-feature-flags-0.png](https://adorable-wombat-701.convex.cloud/api/storage/cd3c89f9-3634-4543-b6f9-c99b34ea726c)\n\n### task-detail-open-in-editor-button-web-mode-feature-flags-0.png\n![task-detail-open-in-editor-button-web-mode-feature-flags-0.png](https://adorable-wombat-701.convex.cloud/api/storage/986b6625-4a0a-4c94-af47-694094f1bc74)\n\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"6228392a779dc91eb5412068510df105c4c1e88c","createdAt":"2025-11-30T02:46:41Z","updatedAt":"2025-11-30T02:46:41Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1067#issuecomment-3592132269"}]}
{"number":1065,"title":"Add code-review summaries with image embeds","state":"open","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1065","headRef":"cmux/add-code-review-summaries-with-image-embeds-xa8yb","headSha":"4fe69f90260f79b7f7f37e547c635671dde0b0dc","baseRef":"main","baseSha":"1939b65a4bc88355454a867d316358d21c49e3e6","createdAt":"2025-11-30T00:01:52Z","updatedAt":"2025-12-02T01:57:55Z","diff":"diff --git a/packages/convex/convex/github_pr_comments.ts b/packages/convex/convex/github_pr_comments.ts\nindex 27ab2efcc..92c7571a6 100644\n--- a/packages/convex/convex/github_pr_comments.ts\n+++ b/packages/convex/convex/github_pr_comments.ts\n@@ -1,6 +1,12 @@\n \"use node\";\n+import { createAnthropic } from \"@ai-sdk/anthropic\";\n+import { createOpenAI } from \"@ai-sdk/openai\";\n+import { generateObject, type LanguageModel } from \"ai\";\n import { v } from \"convex/values\";\n+import { z } from \"zod\";\n+import { CLOUDFLARE_OPENAI_BASE_URL } from \"@cmux/shared\";\n import { fetchInstallationAccessToken } from \"../_shared/githubApp\";\n+import { env } from \"../_shared/convex-env\";\n import { internal } from \"./_generated/api\";\n import type { Doc, Id } from \"./_generated/dataModel\";\n import {\n@@ -39,6 +45,34 @@ const parseRepoFullName = (\n \n type PreviewRunDoc = Doc<\"previewRuns\">;\n type ScreenshotSetDoc = Doc<\"previewScreenshotSets\">;\n+type RenderableScreenshotSet = {\n+  status: ScreenshotSetDoc[\"status\"];\n+  commitSha?: string | null;\n+  capturedAt?: number | null;\n+  error?: string | null;\n+  images: Array<{\n+    storageId: Id<\"_storage\">;\n+    mimeType: string;\n+    fileName?: string;\n+    commitSha?: string;\n+    width?: number;\n+    height?: number;\n+  }>;\n+};\n+\n+const PREVIEW_OPENAI_MODEL = \"gpt-5-mini\";\n+const PREVIEW_ANTHROPIC_MODEL = \"claude-3-5-sonnet-20241022\";\n+\n+const PreviewNarrativeSchema = z.object({\n+  headline: z.string().optional(),\n+  story: z.array(z.string()).min(1).optional(),\n+  reviewFocus: z.array(z.string()).min(1).optional(),\n+  risks: z.array(z.string()).optional(),\n+  testIdeas: z.array(z.string()).optional(),\n+  imageCaptions: z.array(z.string()).optional(),\n+});\n+\n+type PreviewNarrative = z.infer<typeof PreviewNarrativeSchema>;\n \n const COLLAPSE_MARKER = \"<!-- cmux-preview-collapsed -->\";\n const COLLAPSE_SUMMARY = \"Older cmux preview screenshots (latest comment is above)\";\n@@ -53,6 +87,213 @@ const STATUS_SUMMARY_LABEL: Record<ScreenshotSetDoc[\"status\"], string> = {\n   failed: \"❌ Failed\",\n   skipped: \"⚠️ Skipped\",\n };\n+const MAX_FILES_FOR_NARRATIVE = 40;\n+const MAX_PR_BODY_CHARS = 2_500;\n+\n+function resolvePreviewModel(): {\n+  provider: \"openai\" | \"anthropic\";\n+  model: LanguageModel;\n+} {\n+  const openaiKey = env.OPENAI_API_KEY;\n+  if (openaiKey) {\n+    const openai = createOpenAI({\n+      apiKey: openaiKey,\n+      baseURL: CLOUDFLARE_OPENAI_BASE_URL,\n+    });\n+    return { provider: \"openai\", model: openai(PREVIEW_OPENAI_MODEL) };\n+  }\n+\n+  const anthropicKey = env.ANTHROPIC_API_KEY;\n+  if (anthropicKey) {\n+    const anthropic = createAnthropic({ apiKey: anthropicKey });\n+    return { provider: \"anthropic\", model: anthropic(PREVIEW_ANTHROPIC_MODEL) };\n+  }\n+\n+  throw new Error(\n+    \"Preview narrative generation is not configured (missing OpenAI or Anthropic API key)\",\n+  );\n+}\n+\n+const formatPrBody = (body?: string | null): string => {\n+  if (!body) return \"\";\n+  const trimmed = body.trim();\n+  if (trimmed.length <= MAX_PR_BODY_CHARS) return trimmed;\n+  return `${trimmed.slice(0, MAX_PR_BODY_CHARS)}…`;\n+};\n+\n+async function fetchPrContext({\n+  octokit,\n+  owner,\n+  repo,\n+  prNumber,\n+  commitSha,\n+}: {\n+  octokit: Octokit;\n+  owner: string;\n+  repo: string;\n+  prNumber: number;\n+  commitSha?: string | null;\n+}): Promise<{\n+  title?: string;\n+  body?: string;\n+  changedFiles: string[];\n+  headRef?: string;\n+  commitMessage?: string;\n+}> {\n+  let title: string | undefined;\n+  let body: string | undefined;\n+  let headRef: string | undefined;\n+  let commitMessage: string | undefined;\n+  const changedFiles: string[] = [];\n+\n+  try {\n+    const { data } = await octokit.rest.pulls.get({\n+      owner,\n+      repo,\n+      pull_number: prNumber,\n+    });\n+    title = data.title;\n+    body = data.body ?? undefined;\n+    headRef = data.head?.ref;\n+  } catch (error) {\n+    console.warn(\"[github_pr_comments] Failed to fetch PR metadata\", {\n+      owner,\n+      repo,\n+      prNumber,\n+      error,\n+    });\n+  }\n+\n+  try {\n+    const files = await octokit.paginate(octokit.rest.pulls.listFiles, {\n+      owner,\n+      repo,\n+      pull_number: prNumber,\n+      per_page: 100,\n+    });\n+    for (const file of files.slice(0, MAX_FILES_FOR_NARRATIVE)) {\n+      const status = file.status ? ` (${file.status})` : \"\";\n+      const additions =\n+        typeof file.additions === \"number\" && file.additions > 0\n+          ? ` +${file.additions}`\n+          : \"\";\n+      const deletions =\n+        typeof file.deletions === \"number\" && file.deletions > 0\n+          ? ` -${file.deletions}`\n+          : \"\";\n+      const changeSummary =\n+        additions || deletions ? `${additions}${deletions}` : \"\";\n+      changedFiles.push(`${file.filename}${status}${changeSummary ? ` [${changeSummary}]` : \"\"}`);\n+    }\n+  } catch (error) {\n+    console.warn(\"[github_pr_comments] Failed to fetch PR files\", {\n+      owner,\n+      repo,\n+      prNumber,\n+      error,\n+    });\n+  }\n+\n+  if (commitSha) {\n+    try {\n+      const { data } = await octokit.rest.repos.getCommit({\n+        owner,\n+        repo,\n+        ref: commitSha,\n+      });\n+      commitMessage = data.commit?.message;\n+    } catch (error) {\n+      console.warn(\"[github_pr_comments] Failed to fetch commit message\", {\n+        owner,\n+        repo,\n+        commitSha,\n+        error,\n+      });\n+    }\n+  }\n+\n+  return {\n+    title,\n+    body: formatPrBody(body),\n+    changedFiles,\n+    headRef,\n+    commitMessage,\n+  };\n+}\n+\n+async function generatePreviewNarrative({\n+  screenshotSet,\n+  prContext,\n+  prUrl,\n+  workspaceUrl,\n+}: {\n+  screenshotSet: RenderableScreenshotSet;\n+  prContext: Awaited<ReturnType<typeof fetchPrContext>>;\n+  prUrl?: string | null;\n+  workspaceUrl?: string | null;\n+}): Promise<PreviewNarrative | null> {\n+  try {\n+    const { model, provider } = resolvePreviewModel();\n+    const fileList =\n+      prContext.changedFiles.length > 0\n+        ? prContext.changedFiles.map((f, idx) => `${idx + 1}. ${f}`).join(\"\\n\")\n+        : \"No file list available.\";\n+    const screenshotCount = screenshotSet.images.length;\n+    const prompt = `You are drafting a short code review guide for a PR with captured UI screenshots.\n+\n+PR Title: ${prContext.title ?? \"unknown\"}\n+Head branch: ${prContext.headRef ?? \"unknown\"}\n+Commit for screenshots: ${screenshotSet.commitSha ?? \"unknown\"}\n+Commit message: ${prContext.commitMessage ?? \"n/a\"}\n+PR URL: ${prUrl ?? \"n/a\"}\n+Workspace URL: ${workspaceUrl ?? \"n/a\"}\n+\n+PR Summary (body):\n+${prContext.body ?? \"<empty>\"} \n+\n+Changed files (truncated):\n+${fileList}\n+\n+Screenshot context:\n+- Count: ${screenshotCount}\n+- Captured at: ${formatTimestamp(screenshotSet.capturedAt)}\n+\n+Write actionable bullets that help a human reviewer:\n+- Focus on what the PR is trying to achieve, based on the title/body/files.\n+- Call out specific review hotspots or risky areas.\n+- If applicable, suggest quick test or verification steps a reviewer can perform.\n+- Keep bullets tight and concrete; avoid filler.\n+- Do not invent details that aren't implied by the context above.\n+\n+Respond as JSON matching this schema:\n+{\n+  \"headline\": optional short string,\n+  \"story\": required array of bullet strings (what changed, user impact),\n+  \"reviewFocus\": required array of bullet strings (what to inspect closely),\n+  \"risks\": optional array of bullet strings,\n+  \"testIdeas\": optional array of bullet strings,\n+  \"imageCaptions\": optional array of strings (one per screenshot, concise alt text without referencing filenames)\n+}\n+`;\n+\n+    const { object } = await generateObject({\n+      model,\n+      schema: PreviewNarrativeSchema,\n+      system:\n+        \"You are an expert reviewer. Stay concise and actionable. Prefer specific file or area names when available. Never add Markdown headers or code fences; return JSON only.\",\n+      prompt,\n+      ...(provider === \"openai\" ? {} : { temperature: 0 }),\n+      maxRetries: 2,\n+    });\n+\n+    return object;\n+  } catch (error) {\n+    console.warn(\"[github_pr_comments] Failed to generate preview narrative\", {\n+      error,\n+    });\n+    return null;\n+  }\n+}\n \n const formatTimestamp = (value?: number | null): string => {\n   if (!value) {\n@@ -61,9 +302,30 @@ const formatTimestamp = (value?: number | null): string => {\n   return new Date(value).toISOString().replace(\"T\", \" \").replace(\"Z\", \" UTC\");\n };\n \n-const formatCommitLabel = (set: ScreenshotSetDoc): string =>\n+const formatCommitLabel = (set: RenderableScreenshotSet): string =>\n   set.commitSha ? `\\`${set.commitSha.slice(0, 7)}\\`` : \"latest commit\";\n \n+const formatReviewLinks = ({\n+  prUrl,\n+  workspaceUrl,\n+  workspaceLabel = \"Open Workspace\",\n+  prLabel = \"Open in GitHub\",\n+}: {\n+  prUrl?: string | null;\n+  workspaceUrl?: string | null;\n+  workspaceLabel?: string;\n+  prLabel?: string;\n+}): string | null => {\n+  const links: string[] = [];\n+  if (workspaceUrl) {\n+    links.push(`[${workspaceLabel}](${workspaceUrl})`);\n+  }\n+  if (prUrl) {\n+    links.push(`[${prLabel}](${prUrl})`);\n+  }\n+  return links.length > 0 ? links.join(\" • \") : null;\n+};\n+\n const isNonUiChangeReason = (reason?: string | null): boolean => {\n   if (!reason) {\n     return false;\n@@ -98,22 +360,107 @@ const summarizeSet = (\n \n async function renderScreenshotSetMarkdown(\n   ctx: ActionCtx,\n-  set: ScreenshotSetDoc,\n+  set: RenderableScreenshotSet,\n   heading: string,\n+  options?: {\n+    prUrl?: string | null;\n+    workspaceUrl?: string | null;\n+    compact?: boolean;\n+    includeLinksRow?: boolean;\n+    narrative?: PreviewNarrative | null;\n+  },\n ): Promise<string> {\n   const commitLabel = formatCommitLabel(set);\n   const timestamp = formatTimestamp(set.capturedAt);\n   const lines: string[] = [heading, \"\"];\n+  const linkRow = options?.includeLinksRow\n+    ? formatReviewLinks({\n+        prUrl: options.prUrl,\n+        workspaceUrl: options.workspaceUrl,\n+      })\n+    : null;\n+\n+  if (linkRow) {\n+    lines.push(linkRow, \"\");\n+  }\n \n   if (set.status === \"completed\" && set.images.length > 0) {\n     const count = set.images.length;\n     const intro = `Captured ${count} screenshot${count === 1 ? \"\" : \"s\"} for commit ${commitLabel} (${timestamp}).`;\n     lines.push(intro, \"\");\n-    for (const image of set.images) {\n+\n+    if (!options?.compact) {\n+      const narrative = options?.narrative;\n+      const storyLines = (narrative?.story ?? []).filter(Boolean);\n+      const focusLines = (narrative?.reviewFocus ?? []).filter(Boolean);\n+      const riskLines = (narrative?.risks ?? []).filter(Boolean);\n+      const testLines = (narrative?.testIdeas ?? []).filter(Boolean);\n+\n+      if (narrative?.headline) {\n+        lines.push(`**${narrative.headline}**`, \"\");\n+      }\n+\n+      if (storyLines.length > 0) {\n+        lines.push(\"**Story**\", ...storyLines.map((item) => `- ${item}`), \"\");\n+      }\n+\n+      if (focusLines.length > 0) {\n+        lines.push(\n+          \"**Review focus**\",\n+          ...focusLines.map((item) => `- ${item}`),\n+          \"\",\n+        );\n+      }\n+\n+      if (riskLines.length > 0) {\n+        lines.push(\n+          \"**Risks / unknowns**\",\n+          ...riskLines.map((item) => `- ${item}`),\n+          \"\",\n+        );\n+      }\n+\n+      if (testLines.length > 0) {\n+        lines.push(\"**Test / verify**\", ...testLines.map((item) => `- ${item}`), \"\");\n+      }\n+\n+      if (\n+        !narrative ||\n+        (storyLines.length === 0 &&\n+          focusLines.length === 0 &&\n+          riskLines.length === 0 &&\n+          testLines.length === 0)\n+      ) {\n+        // Fallback guidance when LLM output is unavailable\n+        lines.push(\n+          \"**Review focus**\",\n+          \"- Walk through the screenshots in order; they capture the latest UI flow.\",\n+          options?.prUrl ? `- Cross-check intent against the PR description (${options.prUrl}).` : \"- Cross-check intent against the PR description.\",\n+          options?.workspaceUrl\n+            ? \"- Use the workspace link to reproduce the flow and validate interactions.\"\n+            : \"- Re-run the flow locally to validate interactions.\",\n+          \"\",\n+        );\n+      }\n+\n+      lines.push(\n+        `**Evidence (${count})**`,\n+        \"\",\n+      );\n+    } else {\n+      lines.push(`**Evidence (${count})**`, \"\");\n+    }\n+\n+    const imageCaptions = options?.narrative?.imageCaptions ?? [];\n+    for (const [index, image] of set.images.entries()) {\n       const storageUrl = await ctx.storage.getUrl(image.storageId);\n       if (!storageUrl) continue;\n-      const fileName = image.fileName || \"screenshot\";\n-      lines.push(`![${fileName}](${storageUrl})`, \"\");\n+      const altFromNarrative = imageCaptions[index]?.trim();\n+      const altText =\n+        altFromNarrative && altFromNarrative.length > 0\n+          ? altFromNarrative\n+          : `Screenshot ${index + 1} for ${commitLabel}`;\n+      lines.push(`![${altText}](${storageUrl})`, \"\");\n     }\n   } else if (set.status === \"failed\") {\n     lines.push(\n@@ -336,6 +683,41 @@ export const postPreviewComment = internalAction({\n         return { ok: false, error: \"Screenshot set not found\" };\n       }\n \n+      const prUrl =\n+        previewRun.prUrl ||\n+        `https://github.com/${repoFullName}/pull/${prNumber}`;\n+      let workspaceUrl: string | null = null;\n+\n+      if (previewRun.taskRunId) {\n+        const taskRun = await ctx.runQuery(internal.taskRuns.getById, {\n+          id: previewRun.taskRunId as Id<\"taskRuns\">,\n+        });\n+\n+        if (taskRun) {\n+          const team = await ctx.runQuery(\n+            internal.teams.getByTeamIdInternal,\n+            { teamId: taskRun.teamId },\n+          );\n+          const teamSlug = team?.slug ?? taskRun.teamId;\n+          workspaceUrl = `${CMUX_BASE_URL}/${teamSlug}/task/${taskRun.taskId}`;\n+        }\n+      }\n+\n+      const prContext = await fetchPrContext({\n+        octokit,\n+        owner: repo.owner,\n+        repo: repo.repo,\n+        prNumber,\n+        commitSha: screenshotSet.commitSha,\n+      });\n+\n+      const narrative = await generatePreviewNarrative({\n+        screenshotSet,\n+        prContext,\n+        prUrl,\n+        workspaceUrl,\n+      });\n+\n       // Collect previous screenshot sets for this PR so we can collapse them\n       const previousRuns =\n         (await ctx.runQuery(internal.previewRuns.listByConfigAndPr, {\n@@ -368,16 +750,33 @@ export const postPreviewComment = internalAction({\n         ctx,\n         screenshotSet,\n         latestHeading,\n+        { prUrl, workspaceUrl, narrative },\n       );\n \n-      const commentSections: string[] = [\"## Preview Screenshots\", latestSection];\n+      const linksLine = formatReviewLinks({\n+        prUrl,\n+        workspaceUrl,\n+        workspaceLabel: \"Open Workspace (expires in 30m)\",\n+      });\n+\n+      const commentSections: string[] = [];\n+\n+      if (linksLine) {\n+        commentSections.push(linksLine);\n+      }\n+\n+      commentSections.push(\"## Preview Screenshots\", latestSection);\n \n       if (previousSetEntries.length > 0) {\n         const collapsedSections: string[] = [];\n         for (const entry of previousSetEntries) {\n           const sectionHeading = `#### ${summarizeSet(entry.set, entry.run)}`;\n           collapsedSections.push(\n-            await renderScreenshotSetMarkdown(ctx, entry.set, sectionHeading),\n+            await renderScreenshotSetMarkdown(ctx, entry.set, sectionHeading, {\n+              prUrl,\n+              workspaceUrl,\n+              compact: true,\n+            }),\n           );\n         }\n \n@@ -659,6 +1058,7 @@ export const postPreviewCommentWithTaskScreenshots = internalAction({\n       });\n       const teamSlug: string = team?.slug ?? taskRun.teamId;\n       const workspaceUrl: string = `${CMUX_BASE_URL}/${teamSlug}/task/${taskRun.taskId}`;\n+      const prUrl = `https://github.com/${repoFullName}/pull/${prNumber}`;\n \n       // Get screenshot set from task run\n       const screenshotSet = await ctx.runQuery(\n@@ -673,31 +1073,51 @@ export const postPreviewCommentWithTaskScreenshots = internalAction({\n         return { ok: false, error: \"Screenshot set not found\" };\n       }\n \n-      // Build comment body\n-      let commentBody: string = `[Open Workspace](${workspaceUrl}) (expires in 30m) • [Open in GitHub](https://github.com/${repoFullName}/pull/${prNumber})\\n\\n`;\n-      commentBody += \"## Preview Screenshots\\n\\n\";\n-\n-      if (screenshotSet.status === \"completed\" && screenshotSet.images.length > 0) {\n-        commentBody += `Successfully captured ${screenshotSet.images.length} screenshot(s) for commit \\`${(screenshotSet.commitSha || \"\").slice(0, 7)}\\`:\\n\\n`;\n-\n-        for (const image of screenshotSet.images) {\n-          // Get storage URL for the image\n-          const storageUrl = await ctx.storage.getUrl(image.storageId);\n-          if (storageUrl) {\n-            const fileName = image.fileName || \"screenshot\";\n-            commentBody += `### ${fileName}\\n`;\n-            commentBody += `![${fileName}](${storageUrl})\\n\\n`;\n-          }\n-        }\n+      const prContext = await fetchPrContext({\n+        octokit,\n+        owner: repo.owner,\n+        repo: repo.repo,\n+        prNumber,\n+        commitSha: screenshotSet.commitSha,\n+      });\n \n-        commentBody += `\\n---\\n${PREVIEW_SIGNATURE}`;\n-      } else if (screenshotSet.status === \"failed\") {\n-        commentBody += `Failed to capture screenshots: ${screenshotSet.error || \"Unknown error\"}\\n\\n`;\n-        commentBody += `\\n---\\n${PREVIEW_SIGNATURE}`;\n-      } else if (screenshotSet.status === \"skipped\") {\n-        commentBody += `Screenshot capture was skipped: ${screenshotSet.error || \"No preview configured\"}\\n\\n`;\n-        commentBody += `\\n---\\n${PREVIEW_SIGNATURE}`;\n-      }\n+      const renderableSet: RenderableScreenshotSet = {\n+        status: screenshotSet.status as ScreenshotSetDoc[\"status\"],\n+        commitSha: screenshotSet.commitSha,\n+        capturedAt: screenshotSet.capturedAt,\n+        error: screenshotSet.error,\n+        images: screenshotSet.images.map((image) => ({\n+          storageId: image.storageId as Id<\"_storage\">,\n+          mimeType: image.mimeType,\n+          fileName: image.fileName,\n+          commitSha: image.commitSha,\n+          width: (image as { width?: number }).width,\n+          height: (image as { height?: number }).height,\n+        })),\n+      };\n+\n+      const narrative = await generatePreviewNarrative({\n+        screenshotSet: renderableSet,\n+        prContext,\n+        prUrl,\n+        workspaceUrl,\n+      });\n+\n+      const linksLine = formatReviewLinks({\n+        prUrl,\n+        workspaceUrl,\n+        workspaceLabel: \"Open Workspace (expires in 30m)\",\n+      });\n+      const reviewSection = await renderScreenshotSetMarkdown(\n+        ctx,\n+        renderableSet,\n+        \"## Preview Story\",\n+        { prUrl, workspaceUrl, narrative },\n+      );\n+\n+      const commentBody = [linksLine, reviewSection, \"---\", PREVIEW_SIGNATURE]\n+        .filter(Boolean)\n+        .join(\"\\n\\n\");\n \n       // Post comment to GitHub\n       const { data } = await octokit.rest.issues.createComment({\n","comments":[{"type":"issue_comment","id":3592209889,"prNumber":1065,"botLogin":"cmux-agent[bot]","body":"[Open Workspace](https://cmux.sh/manaflow/task/kn7fvbs2rx23srekwbd5222t1x7wcht6) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1065)\n\n## Preview Screenshots\n\nSuccessfully captured 1 screenshot(s) for commit `63c51d7`:\n\n### dashboard-start-task-button-default.png\n![dashboard-start-task-button-default.png](https://adorable-wombat-701.convex.cloud/api/storage/7dd47286-4231-4696-b981-8c9157607ea7)\n\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"4fe69f90260f79b7f7f37e547c635671dde0b0dc","createdAt":"2025-11-30T05:22:32Z","updatedAt":"2025-11-30T05:22:32Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1065#issuecomment-3592209889"},{"type":"issue_comment","id":3592317468,"prNumber":1065,"botLogin":"cmux-agent-internal-dev[bot]","body":"[Open Workspace](https://cmux.sh/austin-dev/task/kn76dx7dgcstqemy8t7ch2jyv57wcqfb) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1065)\n\n## Preview Screenshots\n\nSuccessfully captured 13 screenshot(s) for commit `4fe69f9`:\n\n### preview-configure-all-sections-expanded.png\n![preview-configure-all-sections-expanded.png](https://famous-camel-162.convex.cloud/api/storage/6d956593-d48f-48d4-9e2d-39b2f1c5c1a8)\n\n### preview-configure-env-vars-section.png\n![preview-configure-env-vars-section.png](https://famous-camel-162.convex.cloud/api/storage/fb4bae7c-d7ad-4794-ac75-7c7e6f8da2a3)\n\n### preview-configure-fullpage.png\n![preview-configure-fullpage.png](https://famous-camel-162.convex.cloud/api/storage/fc8274ae-3fcc-4805-b0e1-1f18b2fc73f7)\n\n### preview-configure-header.png\n![preview-configure-header.png](https://famous-camel-162.convex.cloud/api/storage/ee9925c7-b92f-4e3a-8aa6-6f2b68efc540)\n\n### preview-configure-maintenance-script-expanded.png\n![preview-configure-maintenance-script-expanded.png](https://famous-camel-162.convex.cloud/api/storage/abcb4807-2ab5-43c6-8baf-bdabd2ca9ca3)\n\n### preview-configure-run-scripts-section.png\n![preview-configure-run-scripts-section.png](https://famous-camel-162.convex.cloud/api/storage/dca7cfde-4f8e-4fd3-97e5-040bbf554ff2)\n\n### preview-configure-viewport.png\n![preview-configure-viewport.png](https://famous-camel-162.convex.cloud/api/storage/28c5c5a0-3c46-4a36-8d8a-5c490bcdfae4)\n\n### preview-configure-with-sections-expanded.png\n![preview-configure-with-sections-expanded.png](https://famous-camel-162.convex.cloud/api/storage/e255a618-cef2-45a0-a491-9ec99d852729)\n\n### preview-dashboard-connect-github.png\n![preview-dashboard-connect-github.png](https://famous-camel-162.convex.cloud/api/storage/6099ec1a-dbea-4562-a5ea-5e31ccd756cc)\n\n### preview-dashboard-features.png\n![preview-dashboard-features.png](https://famous-camel-162.convex.cloud/api/storage/e7c3c708-ad45-4f01-b9cd-96a7012d78d2)\n\n### preview-dashboard-fullpage.png\n![preview-dashboard-fullpage.png](https://famous-camel-162.convex.cloud/api/storage/40b6f126-82bb-4639-90bb-d1c4923943c6)\n\n### preview-dashboard-header.png\n![preview-dashboard-header.png](https://famous-camel-162.convex.cloud/api/storage/6baa0ea9-39e2-4000-8007-cd98ceb172d6)\n\n### preview-dashboard-viewport.png\n![preview-dashboard-viewport.png](https://famous-camel-162.convex.cloud/api/storage/eb2156e3-0e58-44bf-85b2-e7f14b10723a)\n\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"4fe69f90260f79b7f7f37e547c635671dde0b0dc","createdAt":"2025-11-30T07:34:27Z","updatedAt":"2025-11-30T07:34:27Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1065#issuecomment-3592317468"}]}
{"number":1064,"title":"Add completion detection for preview screenshots","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1064","headRef":"cmux/add-completion-detection-for-preview-screenshots-1sn71","headSha":"f3a55a8a7e3e02360dc27af55e8c0886c2e83c49","baseRef":"main","baseSha":"5b6710a66035554a6095d59b2c206536f15d108f","createdAt":"2025-11-29T23:41:14Z","updatedAt":"2025-11-30T04:39:02Z","diff":"diff --git a/apps/worker/src/index.ts b/apps/worker/src/index.ts\nindex e07656c31..b52e94770 100644\n--- a/apps/worker/src/index.ts\n+++ b/apps/worker/src/index.ts\n@@ -173,6 +173,25 @@ async function runPreviewJobScreenshots({\n   log(\"INFO\", `${logPrefix} Preview job completed successfully`, {\n     result,\n   });\n+\n+  try {\n+    const completionResult = await convexRequest(\n+      \"/api/preview/task-complete\",\n+      token,\n+      { taskRunId },\n+      convexUrl\n+    );\n+\n+    log(\"INFO\", `${logPrefix} Preview task completion recorded`, {\n+      taskRunId,\n+      completionResult,\n+    });\n+  } catch (error) {\n+    log(\"ERROR\", `${logPrefix} Failed to mark preview task complete`, {\n+      taskRunId,\n+      error,\n+    });\n+  }\n }\n \n const Terminal = xtermHeadless.Terminal;\ndiff --git a/packages/convex/convex/http.ts b/packages/convex/convex/http.ts\nindex 4755b7f3c..8b4d6ac4b 100644\n--- a/packages/convex/convex/http.ts\n+++ b/packages/convex/convex/http.ts\n@@ -24,6 +24,7 @@ import {\n   createScreenshotSet,\n   dispatchPreviewJob,\n   completePreviewJob,\n+  completePreviewTask,\n } from \"./preview_jobs_http\";\n \n const http = httpRouter();\n@@ -136,6 +137,12 @@ http.route({\n   handler: createScreenshotSet,\n });\n \n+http.route({\n+  path: \"/api/preview/task-complete\",\n+  method: \"POST\",\n+  handler: completePreviewTask,\n+});\n+\n http.route({\n   path: \"/api/preview/complete\",\n   method: \"POST\",\ndiff --git a/packages/convex/convex/previewRuns.ts b/packages/convex/convex/previewRuns.ts\nindex f6aed0f45..54c2572c4 100644\n--- a/packages/convex/convex/previewRuns.ts\n+++ b/packages/convex/convex/previewRuns.ts\n@@ -140,6 +140,71 @@ export const updateStatus = internalMutation({\n       patch.startedAt = now;\n     }\n     await ctx.db.patch(run._id, patch);\n+\n+    if (run.taskRunId) {\n+      try {\n+        const taskRun = await ctx.db.get(run.taskRunId);\n+        if (!taskRun) {\n+          console.error(\"[previewRuns] Linked task run not found for preview run\", {\n+            previewRunId: run._id,\n+            taskRunId: run.taskRunId,\n+          });\n+          return;\n+        }\n+\n+        if (!taskRun.isPreviewJob) {\n+          return;\n+        }\n+\n+        const isTerminalStatus =\n+          args.status === \"completed\" ||\n+          args.status === \"failed\" ||\n+          args.status === \"skipped\";\n+        const existingIsTerminal =\n+          taskRun.status === \"completed\" ||\n+          taskRun.status === \"failed\" ||\n+          taskRun.status === \"skipped\";\n+\n+        if (!isTerminalStatus && existingIsTerminal) {\n+          return;\n+        }\n+\n+        const nextTaskRunStatus =\n+          args.status === \"failed\"\n+            ? \"failed\"\n+            : args.status === \"skipped\"\n+              ? \"skipped\"\n+              : args.status === \"running\"\n+                ? \"running\"\n+                : \"completed\";\n+\n+        const taskRunPatch: Record<string, unknown> = {\n+          status: nextTaskRunStatus,\n+          updatedAt: now,\n+        };\n+\n+        if (isTerminalStatus) {\n+          taskRunPatch.completedAt = taskRun.completedAt ?? now;\n+        }\n+\n+        await ctx.db.patch(taskRun._id, taskRunPatch);\n+\n+        if (args.status === \"completed\" || args.status === \"skipped\") {\n+          await ctx.db.patch(taskRun.taskId, {\n+            isCompleted: true,\n+            crownEvaluationStatus: \"succeeded\",\n+            crownEvaluationError: undefined,\n+            updatedAt: now,\n+          });\n+        }\n+      } catch (error) {\n+        console.error(\"[previewRuns] Failed to sync preview task completion\", {\n+          previewRunId: run._id,\n+          taskRunId: run.taskRunId,\n+          error,\n+        });\n+      }\n+    }\n   },\n });\n \ndiff --git a/packages/convex/convex/preview_jobs_http.ts b/packages/convex/convex/preview_jobs_http.ts\nindex 0503f3a98..9c643ca24 100644\n--- a/packages/convex/convex/preview_jobs_http.ts\n+++ b/packages/convex/convex/preview_jobs_http.ts\n@@ -66,6 +66,112 @@ export const dispatchPreviewJob = httpAction(async (ctx, req) => {\n   }\n });\n \n+/**\n+ * Mark a preview task run and task as completed once screenshots finish.\n+ */\n+export const completePreviewTask = httpAction(async (ctx, req) => {\n+  const workerAuth = await getWorkerAuth(req, { loggerPrefix: \"[preview-jobs-http]\" });\n+  if (!workerAuth) {\n+    console.error(\"[preview-jobs-http] Unauthorized preview task completion request\");\n+    return jsonResponse({ error: \"Unauthorized\" }, 401);\n+  }\n+\n+  let body: unknown;\n+  try {\n+    body = await req.json();\n+  } catch {\n+    return jsonResponse({ error: \"Invalid JSON\" }, 400);\n+  }\n+\n+  if (!body || typeof body !== \"object\" || !(\"taskRunId\" in body)) {\n+    return jsonResponse({ error: \"Missing taskRunId\" }, 400);\n+  }\n+\n+  const { taskRunId } = body as { taskRunId?: string };\n+  const logContext = { taskRunId };\n+\n+  if (!taskRunId) {\n+    return jsonResponse({ error: \"taskRunId is required\" }, 400);\n+  }\n+\n+  const taskRun = await ctx.runQuery(internal.taskRuns.getById, {\n+    id: taskRunId as Id<\"taskRuns\">,\n+  });\n+\n+  if (!taskRun) {\n+    console.error(\"[preview-jobs-http] Task run not found for preview completion\", logContext);\n+    return jsonResponse({ error: \"Task run not found\" }, 404);\n+  }\n+\n+  if (\n+    taskRun.teamId !== workerAuth.payload.teamId ||\n+    taskRun.userId !== workerAuth.payload.userId\n+  ) {\n+    console.error(\"[preview-jobs-http] Unauthorized preview task completion attempt\", {\n+      ...logContext,\n+      workerTeamId: workerAuth.payload.teamId,\n+      taskRunTeamId: taskRun.teamId,\n+    });\n+    return jsonResponse({ error: \"Unauthorized\" }, 401);\n+  }\n+\n+  const task = await ctx.runQuery(internal.tasks.getByIdInternal, {\n+    id: taskRun.taskId,\n+  });\n+\n+  if (!task) {\n+    console.error(\"[preview-jobs-http] Task not found for preview completion\", {\n+      ...logContext,\n+      taskId: taskRun.taskId,\n+    });\n+    return jsonResponse({ error: \"Task not found\" }, 404);\n+  }\n+\n+  if (\n+    task.teamId !== workerAuth.payload.teamId ||\n+    task.userId !== workerAuth.payload.userId\n+  ) {\n+    console.error(\"[preview-jobs-http] Unauthorized preview task completion attempt (task)\", {\n+      ...logContext,\n+      workerTeamId: workerAuth.payload.teamId,\n+      taskTeamId: task.teamId,\n+    });\n+    return jsonResponse({ error: \"Unauthorized\" }, 401);\n+  }\n+\n+  const runAlreadyTerminal =\n+    taskRun.status === \"completed\" ||\n+    taskRun.status === \"failed\" ||\n+    taskRun.status === \"skipped\";\n+\n+  if (!runAlreadyTerminal) {\n+    await ctx.runMutation(internal.taskRuns.updateStatus, {\n+      id: taskRun._id,\n+      status: \"completed\",\n+    });\n+  }\n+\n+  const taskAlreadyCompleted = task.isCompleted === true;\n+  if (!taskAlreadyCompleted) {\n+    await ctx.runMutation(internal.tasks.markCompletedInternal, {\n+      taskId: task._id,\n+    });\n+  }\n+\n+  console.log(\"[preview-jobs-http] Preview task marked complete\", {\n+    ...logContext,\n+    runStatusUpdated: !runAlreadyTerminal,\n+    taskAlreadyCompleted,\n+  });\n+\n+  return jsonResponse({\n+    ok: true,\n+    runStatusUpdated: !runAlreadyTerminal,\n+    taskCompleted: true,\n+    alreadyCompleted: taskAlreadyCompleted,\n+  });\n+});\n+\n /**\n  * HTTP action for www API to update preview run status\n  */\ndiff --git a/packages/convex/convex/tasks.ts b/packages/convex/convex/tasks.ts\nindex ca75b7174..010b3c929 100644\n--- a/packages/convex/convex/tasks.ts\n+++ b/packages/convex/convex/tasks.ts\n@@ -219,6 +219,16 @@ export const setCompleted = authMutation({\n   },\n });\n \n+export const markCompletedInternal = internalMutation({\n+  args: { taskId: v.id(\"tasks\") },\n+  handler: async (ctx, args) => {\n+    await ctx.db.patch(args.taskId, {\n+      isCompleted: true,\n+      updatedAt: Date.now(),\n+    });\n+  },\n+});\n+\n export const update = authMutation({\n   args: { teamSlugOrId: v.string(), id: v.id(\"tasks\"), text: v.string() },\n   handler: async (ctx, args) => {\ndiff --git a/packages/shared/src/morph-snapshots.json b/packages/shared/src/morph-snapshots.json\nindex 036712c98..904cbeab7 100644\n--- a/packages/shared/src/morph-snapshots.json\n+++ b/packages/shared/src/morph-snapshots.json\n@@ -1,6 +1,6 @@\n {\n   \"schemaVersion\": 1,\n-  \"updatedAt\": \"2025-11-29T22:01:05Z\",\n+  \"updatedAt\": \"2025-11-30T00:25:33Z\",\n   \"presets\": [\n     {\n       \"presetId\": \"4vcpu_16gb_48gb\",\n@@ -48,6 +48,16 @@\n           \"version\": 8,\n           \"snapshotId\": \"snapshot_u00k1p82\",\n           \"capturedAt\": \"2025-11-29T22:00:34Z\"\n+        },\n+        {\n+          \"version\": 9,\n+          \"snapshotId\": \"snapshot_x1nryztw\",\n+          \"capturedAt\": \"2025-11-29T23:27:47Z\"\n+        },\n+        {\n+          \"version\": 10,\n+          \"snapshotId\": \"snapshot_6ayc75i9\",\n+          \"capturedAt\": \"2025-11-30T00:26:06Z\"\n         }\n       ],\n       \"description\": \"Great default for day-to-day work. Balanced CPU, memory, and storage.\"\n@@ -98,6 +108,16 @@\n           \"version\": 8,\n           \"snapshotId\": \"snapshot_8b1361wp\",\n           \"capturedAt\": \"2025-11-29T22:01:05Z\"\n+        },\n+        {\n+          \"version\": 9,\n+          \"snapshotId\": \"snapshot_uwp8h162\",\n+          \"capturedAt\": \"2025-11-29T23:27:17Z\"\n+        },\n+        {\n+          \"version\": 10,\n+          \"snapshotId\": \"snapshot_yr5rygih\",\n+          \"capturedAt\": \"2025-11-30T00:25:33Z\"\n         }\n       ],\n       \"description\": \"Extra headroom for larger codebases or heavier workloads.\"\ndiff --git a/packages/www-openapi-client/src/client/types.gen.ts b/packages/www-openapi-client/src/client/types.gen.ts\nindex e454f1a45..5daf93761 100644\n--- a/packages/www-openapi-client/src/client/types.gen.ts\n+++ b/packages/www-openapi-client/src/client/types.gen.ts\n@@ -379,7 +379,7 @@ export type SetupInstanceBody = {\n     instanceId?: string;\n     selectedRepos?: Array<string>;\n     ttlSeconds?: number;\n-    snapshotId?: string | ('snapshot_u00k1p82' | 'snapshot_8b1361wp' | 'snapshot_pcmfvjra');\n+    snapshotId?: string | ('snapshot_6ayc75i9' | 'snapshot_yr5rygih' | 'snapshot_pcmfvjra');\n };\n \n export type CreateEnvironmentResponse = {\n","comments":[{"type":"issue_comment","id":3592116461,"prNumber":1064,"botLogin":"cmux-agent-internal-dev[bot]","body":"[Open Workspace](https://cmux.dev/austin-dev/task/kn7170j7v9kyap4mrm2ggrj0m17wc0qj) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1064)\n\n## Preview Screenshots\n\nSuccessfully captured 13 screenshot(s) for commit `f3a55a8`:\n\n### preview-configure-complete-page.png\n![preview-configure-complete-page.png](https://famous-camel-162.convex.cloud/api/storage/2013e31f-2744-4d16-84c8-63b83fccb6a4)\n\n### preview-configure-environment-variables-revealed.png\n![preview-configure-environment-variables-revealed.png](https://famous-camel-162.convex.cloud/api/storage/a15925b7-1362-4eb1-8518-8e2aa3ad8504)\n\n### preview-configure-environment-variables.png\n![preview-configure-environment-variables.png](https://famous-camel-162.convex.cloud/api/storage/5c353906-bd4a-4078-9acc-c81aa85434b3)\n\n### preview-configure-framework-preset.png\n![preview-configure-framework-preset.png](https://famous-camel-162.convex.cloud/api/storage/92d9b4a0-ff37-4ff1-b73b-c02c9340e4eb)\n\n### preview-configure-full-page.png\n![preview-configure-full-page.png](https://famous-camel-162.convex.cloud/api/storage/ad5d45c1-2f67-4d27-b3d1-7af84b8fc7c0)\n\n### preview-configure-header.png\n![preview-configure-header.png](https://famous-camel-162.convex.cloud/api/storage/c94320ef-c471-496e-bb7f-4eff40dc0d79)\n\n### preview-configure-maintenance-dev-scripts.png\n![preview-configure-maintenance-dev-scripts.png](https://famous-camel-162.convex.cloud/api/storage/e3955fe4-ecc6-4ef7-a20f-187cf947c223)\n\n### preview-dashboard-choose-repository.png\n![preview-dashboard-choose-repository.png](https://famous-camel-162.convex.cloud/api/storage/dfe7c2e8-c39c-4023-9705-a34fb35ed581)\n\n### preview-dashboard-configured-repos.png\n![preview-dashboard-configured-repos.png](https://famous-camel-162.convex.cloud/api/storage/7ca29455-6b97-4dd6-b811-e9af55e74d9a)\n\n### preview-dashboard-from-creators.png\n![preview-dashboard-from-creators.png](https://famous-camel-162.convex.cloud/api/storage/a94221ce-6613-441e-ba7b-82cbf37f17af)\n\n### preview-dashboard-full-page.png\n![preview-dashboard-full-page.png](https://famous-camel-162.convex.cloud/api/storage/e01cad38-fce1-468f-b919-cea79dc1adb7)\n\n### preview-dashboard-hero-section.png\n![preview-dashboard-hero-section.png](https://famous-camel-162.convex.cloud/api/storage/93aa3272-aa74-4c00-8238-80558c31daf4)\n\n### preview-dashboard-what-is-preview.png\n![preview-dashboard-what-is-preview.png](https://famous-camel-162.convex.cloud/api/storage/8a1f77d1-c879-4297-bf74-f585129e7cf6)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"f3a55a8a7e3e02360dc27af55e8c0886c2e83c49","createdAt":"2025-11-30T02:18:10Z","updatedAt":"2025-11-30T02:18:10Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1064#issuecomment-3592116461"}]}
{"number":1061,"title":"Lock start after submission to prevent duplicates","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1061","headRef":"cmux/lock-start-after-submission-to-prevent-duplicates-cgt7d","headSha":"134191a0fc2521fb70525a30f5c341ac1ce46456","baseRef":"main","baseSha":"cff9cedc57a0db1d755a398153217a1efb445664","createdAt":"2025-11-29T22:48:04Z","updatedAt":"2025-11-29T23:12:12Z","diff":"diff --git a/apps/client/src/components/dashboard/DashboardStartTaskButton.tsx b/apps/client/src/components/dashboard/DashboardStartTaskButton.tsx\nindex e49c8eae7..45342f6bf 100644\n--- a/apps/client/src/components/dashboard/DashboardStartTaskButton.tsx\n+++ b/apps/client/src/components/dashboard/DashboardStartTaskButton.tsx\n@@ -6,15 +6,17 @@ interface DashboardStartTaskButtonProps {\n   canSubmit: boolean;\n   onStartTask: () => void;\n   disabledReason?: string;\n+  isStarting: boolean;\n }\n \n export function DashboardStartTaskButton({\n   canSubmit,\n   onStartTask,\n   disabledReason,\n+  isStarting,\n }: DashboardStartTaskButtonProps) {\n   const isMac = navigator.userAgent.toUpperCase().indexOf(\"MAC\") >= 0;\n-  const isDisabled = !canSubmit || !!disabledReason;\n+  const isDisabled = isStarting || !canSubmit || !!disabledReason;\n \n   return (\n     <Tooltip delayDuration={0}>\n@@ -31,8 +33,9 @@ export function DashboardStartTaskButton({\n             className=\"!h-7 focus-visible:ring-offset-1 focus-visible:ring-offset-white dark:focus-visible:ring-offset-neutral-900\"\n             onClick={onStartTask}\n             disabled={isDisabled}\n+            aria-busy={isStarting}\n           >\n-            Start task\n+            {isStarting ? \"Starting...\" : \"Start task\"}\n           </Button>\n         </span>\n       </TooltipTrigger>\ndiff --git a/apps/client/src/routes/_layout.$teamSlugOrId.dashboard.tsx b/apps/client/src/routes/_layout.$teamSlugOrId.dashboard.tsx\nindex fb4f14c49..60c0acb17 100644\n--- a/apps/client/src/routes/_layout.$teamSlugOrId.dashboard.tsx\n+++ b/apps/client/src/routes/_layout.$teamSlugOrId.dashboard.tsx\n@@ -144,6 +144,8 @@ function DashboardComponent() {\n   const [, setDockerReady] = useState<boolean | null>(null);\n   const [providerStatus, setProviderStatus] =\n     useState<ProviderStatusResponse | null>(null);\n+  const [isStartingTask, setIsStartingTask] = useState(false);\n+  const isStartingTaskRef = useRef(false);\n \n   // const [hasDismissedCloudRepoOnboarding, setHasDismissedCloudRepoOnboarding] =\n   //   useState<boolean>(false);\n@@ -409,53 +411,60 @@ function DashboardComponent() {\n   }, [selectedBranch, branchNames, remoteDefaultBranch]);\n \n   const handleStartTask = useCallback(async () => {\n-    // For local mode, perform a fresh docker check right before starting\n-    if (!isEnvSelected && !isCloudMode) {\n-      // Always check Docker status when in local mode, regardless of current state\n-      if (socket) {\n-        const ready = await new Promise<boolean>((resolve) => {\n-          socket.emit(\"check-provider-status\", (response) => {\n-            const isRunning = !!response?.dockerStatus?.isRunning;\n-            if (typeof isRunning === \"boolean\") {\n-              setDockerReady(isRunning);\n-            }\n-            resolve(isRunning);\n+    if (isStartingTaskRef.current) {\n+      return;\n+    }\n+\n+    isStartingTaskRef.current = true;\n+    setIsStartingTask(true);\n+\n+    try {\n+      // For local mode, perform a fresh docker check right before starting\n+      if (!isEnvSelected && !isCloudMode) {\n+        // Always check Docker status when in local mode, regardless of current state\n+        if (socket) {\n+          const ready = await new Promise<boolean>((resolve) => {\n+            socket.emit(\"check-provider-status\", (response) => {\n+              const isRunning = !!response?.dockerStatus?.isRunning;\n+              if (typeof isRunning === \"boolean\") {\n+                setDockerReady(isRunning);\n+              }\n+              resolve(isRunning);\n+            });\n           });\n-        });\n \n-        // Only show the alert if Docker is actually not running after checking\n-        if (!ready) {\n-          toast.error(\"Docker is not running. Start Docker Desktop.\");\n+          // Only show the alert if Docker is actually not running after checking\n+          if (!ready) {\n+            toast.error(\"Docker is not running. Start Docker Desktop.\");\n+            return;\n+          }\n+        } else {\n+          // If socket is not connected, we can't verify Docker status\n+          console.error(\"Cannot verify Docker status: socket not connected\");\n+          toast.error(\n+            \"Cannot verify Docker status. Please ensure the server is running.\"\n+          );\n           return;\n         }\n-      } else {\n-        // If socket is not connected, we can't verify Docker status\n-        console.error(\"Cannot verify Docker status: socket not connected\");\n-        toast.error(\n-          \"Cannot verify Docker status. Please ensure the server is running.\"\n-        );\n-        return;\n       }\n-    }\n \n-    if (!selectedProject[0] || !taskDescription.trim()) {\n-      console.error(\"Please select a project and enter a task description\");\n-      return;\n-    }\n-    if (!socket) {\n-      console.error(\"Socket not connected\");\n-      return;\n-    }\n+      if (!selectedProject[0] || !taskDescription.trim()) {\n+        console.error(\"Please select a project and enter a task description\");\n+        return;\n+      }\n+      if (!socket) {\n+        console.error(\"Socket not connected\");\n+        return;\n+      }\n \n-    // Use the effective selected branch (respects available branches and sensible defaults)\n-    const branch = effectiveSelectedBranch[0];\n-    const projectFullName = selectedProject[0];\n-    const envSelected = projectFullName.startsWith(\"env:\");\n-    const environmentId = envSelected\n-      ? (projectFullName.replace(/^env:/, \"\") as Id<\"environments\">)\n-      : undefined;\n+      // Use the effective selected branch (respects available branches and sensible defaults)\n+      const branch = effectiveSelectedBranch[0];\n+      const projectFullName = selectedProject[0];\n+      const envSelected = projectFullName.startsWith(\"env:\");\n+      const environmentId = envSelected\n+        ? (projectFullName.replace(/^env:/, \"\") as Id<\"environments\">)\n+        : undefined;\n \n-    try {\n       // Extract content including images from the editor\n       const content = editorApiRef.current?.getContent();\n       const images = content?.images || [];\n@@ -562,6 +571,9 @@ function DashboardComponent() {\n       console.log(\"Task created:\", taskId);\n     } catch (error) {\n       console.error(\"Error starting task:\", error);\n+    } finally {\n+      isStartingTaskRef.current = false;\n+      setIsStartingTask(false);\n     }\n   }, [\n     selectedProject,\n@@ -961,6 +973,7 @@ function DashboardComponent() {\n               providerStatus={providerStatus}\n               canSubmit={canSubmit}\n               onStartTask={handleStartTask}\n+              isStartingTask={isStartingTask}\n             />\n             {shouldShowWorkspaceSetup ? (\n               <WorkspaceSetupPanel\n@@ -1038,6 +1051,7 @@ type DashboardMainCardProps = {\n   providerStatus: ProviderStatusResponse | null;\n   canSubmit: boolean;\n   onStartTask: () => void;\n+  isStartingTask: boolean;\n };\n \n function DashboardMainCard({\n@@ -1066,6 +1080,7 @@ function DashboardMainCard({\n   providerStatus,\n   canSubmit,\n   onStartTask,\n+  isStartingTask,\n }: DashboardMainCardProps) {\n   return (\n     <div className=\"relative bg-white dark:bg-neutral-700/50 border border-neutral-500/15 dark:border-neutral-500/15 rounded-2xl transition-all\">\n@@ -1103,6 +1118,8 @@ function DashboardMainCard({\n         <DashboardStartTaskButton\n           canSubmit={canSubmit}\n           onStartTask={onStartTask}\n+          isStarting={isStartingTask}\n+          disabledReason={isStartingTask ? \"Starting task...\" : undefined}\n         />\n       </DashboardInputFooter>\n     </div>\n","comments":[{"type":"issue_comment","id":3592002699,"prNumber":1061,"botLogin":"cmux-agent[bot]","body":"[Open Workspace](https://cmux.dev/manaflow/task/kn7bw4g8x45qmn27p878jftreh7wad3p) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1061)\n\n## Preview Screenshots\n\nSuccessfully captured 3 screenshot(s) for commit `134191a`:\n\n### dashboard-full-page.png\n![dashboard-full-page.png](https://adorable-wombat-701.convex.cloud/api/storage/1db472e8-5370-4667-8266-639bf6ab63f4)\n\n### start-task-button-disabled.png\n![start-task-button-disabled.png](https://adorable-wombat-701.convex.cloud/api/storage/4bd5dc4e-2dbc-4448-b28a-85cb0a6c4dc0)\n\n### start-task-button-with-tooltip.png\n![start-task-button-with-tooltip.png](https://adorable-wombat-701.convex.cloud/api/storage/f764c297-37f0-471d-aecd-de4773781032)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"134191a0fc2521fb70525a30f5c341ac1ce46456","createdAt":"2025-11-29T22:52:00Z","updatedAt":"2025-11-29T22:52:00Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1061#issuecomment-3592002699"}]}
{"number":1058,"title":"Simplify screenshot metadata and export local manifest","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1058","headRef":"screenshot-improve-1","headSha":"9bffaadf24b0cb5c625e485f6287898b577dbadd","baseRef":"main","baseSha":"60ec13aee1eb5924d3f52b07a66ba05f5a5ac026","createdAt":"2025-11-27T06:44:40Z","updatedAt":"2025-12-01T07:42:52Z","diff":"diff --git a/Dockerfile b/Dockerfile\nindex 3496ca018..ff5b0ab89 100644\n--- a/Dockerfile\n+++ b/Dockerfile\n@@ -714,7 +714,7 @@ ENV PATH=\"/usr/local/bin:$PATH\"\n ENV BUN_INSTALL_CACHE_DIR=/cmux/node_modules/.bun\n \n RUN --mount=type=cache,target=/root/.bun/install/cache \\\n-  bun add -g @openai/codex@0.50.0 @anthropic-ai/claude-code@2.0.27 @google/gemini-cli@0.1.21 opencode-ai@0.6.4 codebuff @devcontainers/cli @sourcegraph/amp\n+  bun add -g @openai/codex@0.50.0 @anthropic-ai/claude-code@2.0.54 @google/gemini-cli@0.1.21 opencode-ai@0.6.4 codebuff @devcontainers/cli @sourcegraph/amp\n \n # Install cursor cli\n RUN curl https://cursor.com/install -fsS | bash\ndiff --git a/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.pr.tsx b/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.pr.tsx\nindex 888f4e3aa..37bbefd98 100644\n--- a/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.pr.tsx\n+++ b/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.pr.tsx\n@@ -129,7 +129,7 @@ function RunPullRequestPage() {\n                 rel=\"noopener noreferrer\"\n                 className=\"text-xs text-blue-600 dark:text-blue-400 hover:underline flex items-center gap-1\"\n               >\n-                Open in GitHub\n+                Open Heatmap Diff Viewer\n                 <svg\n                   className=\"w-3 h-3\"\n                   fill=\"none\"\ndiff --git a/apps/worker/package.json b/apps/worker/package.json\nindex c13092f83..e694dcef7 100644\n--- a/apps/worker/package.json\n+++ b/apps/worker/package.json\n@@ -11,7 +11,7 @@\n     \"typecheck\": \"tsc --noEmit -p tsconfig.json\"\n   },\n   \"dependencies\": {\n-    \"@anthropic-ai/claude-agent-sdk\": \"^0.1.27\",\n+    \"@anthropic-ai/claude-agent-sdk\": \"^0.1.54\",\n     \"@cmux/convex\": \"workspace:*\",\n     \"@cmux/shared\": \"workspace:*\",\n     \"@openai/codex-sdk\": \"^0.47.0\",\n@@ -25,8 +25,7 @@\n     \"multer\": \"^1.4.5-lts.1\",\n     \"socket.io\": \"^4.8.0\",\n     \"undici\": \"^6.21.3\",\n-    \"zod\": \"^4.1.12\",\n-    \"zod-to-json-schema\": \"^3.24.6\"\n+    \"zod\": \"^4.1.12\"\n   },\n   \"devDependencies\": {\n     \"@types/express\": \"^4.17.21\",\ndiff --git a/apps/worker/src/screenshotCollector/claudeMessageFormatter.ts b/apps/worker/src/screenshotCollector/claudeMessageFormatter.ts\nindex ab85491e6..6f331e0b1 100644\n--- a/apps/worker/src/screenshotCollector/claudeMessageFormatter.ts\n+++ b/apps/worker/src/screenshotCollector/claudeMessageFormatter.ts\n@@ -71,6 +71,10 @@ export function formatClaudeMessage(message: SDKMessage): string {\n           return `📦 Compacted (${message.compact_metadata.trigger}, ${message.compact_metadata.pre_tokens} tokens)`;\n         case \"hook_response\":\n           return `🪝 Hook: ${message.hook_name} (${message.hook_event}) - exit ${message.exit_code ?? \"N/A\"}`;\n+        case \"status\": {\n+          const status = message.status ?? \"idle\";\n+          return `🔄 Status: ${status}`;\n+        }\n         default: {\n           // Type assertion for exhaustiveness check\n           const _exhaustive: never = message;\n@@ -79,6 +83,21 @@ export function formatClaudeMessage(message: SDKMessage): string {\n       }\n     }\n \n+    case \"tool_progress\": {\n+      const parent =\n+        message.parent_tool_use_id === null\n+          ? \"\"\n+          : ` (child of ${message.parent_tool_use_id})`;\n+      return `⏳ Tool progress: ${message.tool_name} ${parent} after ${message.elapsed_time_seconds.toFixed(1)}s`;\n+    }\n+\n+    case \"auth_status\": {\n+      const output =\n+        message.output.length > 0 ? ` output=\"${message.output.join(\" | \")}\"` : \"\";\n+      const error = message.error ? ` error=\"${message.error}\"` : \"\";\n+      return `🔐 Auth status: ${message.isAuthenticating ? \"authenticating\" : \"idle\"}${output}${error}`;\n+    }\n+\n     case \"stream_event\": {\n       // Skip streaming events for cleaner logs (they're partial)\n       return \"\";\ndiff --git a/apps/worker/src/screenshotCollector/claudeScreenshotCollector.ts b/apps/worker/src/screenshotCollector/claudeScreenshotCollector.ts\nindex 23a9a046b..af8d6d900 100644\n--- a/apps/worker/src/screenshotCollector/claudeScreenshotCollector.ts\n+++ b/apps/worker/src/screenshotCollector/claudeScreenshotCollector.ts\n@@ -1,6 +1,7 @@\n import { query } from \"@anthropic-ai/claude-agent-sdk\";\n import { promises as fs } from \"node:fs\";\n import * as path from \"node:path\";\n+import { z } from \"zod\";\n \n import { log } from \"../logger\";\n import { logToScreenshotCollector } from \"./logger\";\n@@ -14,6 +15,42 @@ function isScreenshotFile(fileName: string): boolean {\n   return IMAGE_EXTENSIONS.has(path.extname(fileName).toLowerCase());\n }\n \n+const screenshotOutputSchema = z.object({\n+  hasUiChanges: z.boolean(),\n+  images: z\n+    .array(\n+      z.object({\n+        path: z.string().min(1),\n+        description: z.string().min(1),\n+      })\n+    )\n+    .default([]),\n+});\n+\n+type ScreenshotStructuredOutput = z.infer<typeof screenshotOutputSchema>;\n+\n+const screenshotOutputJsonSchema = {\n+  $schema: \"http://json-schema.org/draft-07/schema#\",\n+  type: \"object\",\n+  additionalProperties: false,\n+  required: [\"hasUiChanges\", \"images\"],\n+  properties: {\n+    hasUiChanges: { type: \"boolean\" },\n+    images: {\n+      type: \"array\",\n+      items: {\n+        type: \"object\",\n+        additionalProperties: false,\n+        required: [\"path\", \"description\"],\n+        properties: {\n+          path: { type: \"string\" },\n+          description: { type: \"string\" },\n+        },\n+      },\n+    },\n+  },\n+} as const;\n+\n async function collectScreenshotFiles(\n   directory: string\n ): Promise<{ files: string[]; hasNestedDirectories: boolean }> {\n@@ -70,7 +107,8 @@ export type CaptureScreenshotsOptions =\n \n export interface ScreenshotResult {\n   status: \"completed\" | \"failed\" | \"skipped\";\n-  screenshotPaths?: string[];\n+  screenshots?: { path: string; description?: string }[];\n+  hasUiChanges?: boolean;\n   error?: string;\n   reason?: string;\n }\n@@ -87,7 +125,10 @@ function isTaskRunJwtAuth(\n \n export async function captureScreenshotsForBranch(\n   options: BranchCaptureOptions\n-): Promise<string[]> {\n+): Promise<{\n+  screenshots: { path: string; description?: string }[];\n+  hasUiChanges?: boolean;\n+}> {\n   const {\n     workspaceDir,\n     changedFiles,\n@@ -123,6 +164,7 @@ Please:\n \n <IMPORTANT>\n Focus on capturing visual changes. If no UI changes are present, just let me know.\n+When providing structured_output, set hasUiChanges to true if you saw UI changes and false otherwise. Include every screenshot you saved with the absolute file path (or a path relative to ${outputDir}) and a short description of what the screenshot shows. The paths must match the files you saved.\n Do not close the browser after you're done, since I will want to click around the final page you navigated to.\n Do not create summary documents.\n If you can't install dependencies/start the dev server, just let me know. Do not create fake html mocks. We must take screenshots of the actual ground truth UI.\n@@ -133,6 +175,7 @@ If you can't install dependencies/start the dev server, just let me know. Do not\n   );\n \n   const screenshotPaths: string[] = [];\n+  let structuredOutput: ScreenshotStructuredOutput | null = null;\n \n   try {\n     const hadOriginalApiKey = Object.prototype.hasOwnProperty.call(\n@@ -194,6 +237,10 @@ If you can't install dependencies/start the dev server, just let me know. Do not\n           permissionMode: \"bypassPermissions\",\n           cwd: workspaceDir,\n           pathToClaudeCodeExecutable: options.pathToClaudeCodeExecutable,\n+          outputFormat: {\n+            type: \"json_schema\",\n+            schema: screenshotOutputJsonSchema,\n+          },\n           env: {\n             ...process.env,\n             IS_SANDBOX: \"1\",\n@@ -216,6 +263,22 @@ If you can't install dependencies/start the dev server, just let me know. Do not\n         if (formatted) {\n           await logToScreenshotCollector(formatted);\n         }\n+\n+        if (message.type === \"result\" && \"structured_output\" in message) {\n+          const parsed = screenshotOutputSchema.safeParse(\n+            message.structured_output\n+          );\n+          if (parsed.success) {\n+            structuredOutput = parsed.data;\n+            await logToScreenshotCollector(\n+              `Structured output captured (hasUiChanges=${parsed.data.hasUiChanges}, images=${parsed.data.images.length})`\n+            );\n+          } else {\n+            await logToScreenshotCollector(\n+              `Structured output validation failed: ${parsed.error.message}`\n+            );\n+          }\n+        }\n       }\n     } catch (error) {\n       await logToScreenshotCollector(\n@@ -260,7 +323,39 @@ If you can't install dependencies/start the dev server, just let me know. Do not\n       });\n     }\n \n-    return screenshotPaths;\n+    const descriptionByPath = new Map<string, string>();\n+    const resolvedOutputDir = path.resolve(outputDir);\n+    if (structuredOutput) {\n+      for (const image of structuredOutput.images) {\n+        const absolutePath = path.isAbsolute(image.path)\n+          ? path.normalize(image.path)\n+          : path.normalize(path.resolve(resolvedOutputDir, image.path));\n+        descriptionByPath.set(absolutePath, image.description);\n+      }\n+    }\n+\n+    const screenshotsWithDescriptions = screenshotPaths.map((absolutePath) => {\n+      const normalized = path.normalize(absolutePath);\n+      return {\n+        path: absolutePath,\n+        description: descriptionByPath.get(normalized),\n+      };\n+    });\n+\n+    if (\n+      structuredOutput &&\n+      structuredOutput.images.length > 0 &&\n+      descriptionByPath.size === 0\n+    ) {\n+      await logToScreenshotCollector(\n+        \"Structured output provided image descriptions, but none matched saved files; ensure paths are absolute or relative to the output directory.\"\n+      );\n+    }\n+\n+    return {\n+      screenshots: screenshotsWithDescriptions,\n+      hasUiChanges: structuredOutput?.hasUiChanges,\n+    };\n   } catch (error) {\n     const message =\n       error instanceof Error ? error.message : String(error ?? \"unknown error\");\n@@ -324,7 +419,8 @@ export async function claudeCodeCapturePRScreenshots(\n \n     await fs.mkdir(outputDir, { recursive: true });\n \n-    const allScreenshots: string[] = [];\n+    const allScreenshots: { path: string; description?: string }[] = [];\n+    let hasUiChanges: boolean | undefined;\n \n     const CAPTURE_BEFORE = false;\n \n@@ -356,9 +452,12 @@ export async function claudeCodeCapturePRScreenshots(\n               pathToClaudeCodeExecutable: options.pathToClaudeCodeExecutable,\n             }\n       );\n-      allScreenshots.push(...beforeScreenshots);\n+      allScreenshots.push(...beforeScreenshots.screenshots);\n+      if (beforeScreenshots.hasUiChanges !== undefined) {\n+        hasUiChanges = beforeScreenshots.hasUiChanges;\n+      }\n       await logToScreenshotCollector(\n-        `Captured ${beforeScreenshots.length} 'before' screenshots`\n+        `Captured ${beforeScreenshots.screenshots.length} 'before' screenshots`\n       );\n     }\n \n@@ -389,9 +488,12 @@ export async function claudeCodeCapturePRScreenshots(\n             pathToClaudeCodeExecutable: options.pathToClaudeCodeExecutable,\n           }\n     );\n-    allScreenshots.push(...afterScreenshots);\n+    allScreenshots.push(...afterScreenshots.screenshots);\n+    if (afterScreenshots.hasUiChanges !== undefined) {\n+      hasUiChanges = afterScreenshots.hasUiChanges;\n+    }\n     await logToScreenshotCollector(\n-      `Captured ${afterScreenshots.length} 'after' screenshots`\n+      `Captured ${afterScreenshots.screenshots.length} 'after' screenshots`\n     );\n \n     await logToScreenshotCollector(\n@@ -404,7 +506,8 @@ export async function claudeCodeCapturePRScreenshots(\n \n     return {\n       status: \"completed\",\n-      screenshotPaths: allScreenshots,\n+      screenshots: allScreenshots,\n+      hasUiChanges,\n     };\n   } catch (error) {\n     const message =\ndiff --git a/apps/worker/src/screenshotCollector/claudeScreenshotCollectorCli.ts b/apps/worker/src/screenshotCollector/claudeScreenshotCollectorCli.ts\nindex d23735974..7218d7283 100644\n--- a/apps/worker/src/screenshotCollector/claudeScreenshotCollectorCli.ts\n+++ b/apps/worker/src/screenshotCollector/claudeScreenshotCollectorCli.ts\n@@ -16,9 +16,7 @@ function parsePRUrl(prUrl: string): {\n   // Match patterns like:\n   // https://github.com/owner/repo/pull/123\n   // github.com/owner/repo/pull/123\n-  const match = prUrl.match(\n-    /github\\.com\\/([^/]+)\\/([^/]+)\\/pull\\/(\\d+)/\n-  );\n+  const match = prUrl.match(/github\\.com\\/([^/]+)\\/([^/]+)\\/pull\\/(\\d+)/);\n \n   if (match && match[1] && match[2] && match[3]) {\n     return {\n@@ -244,11 +242,7 @@ async function main() {\n     console.log(`📄 Found ${changedFiles.length} changed files`);\n \n     // Set up git repository\n-    const { workspaceDir, cleanup } = await setupGitRepo(\n-      owner,\n-      repo,\n-      prNumber\n-    );\n+    const { workspaceDir, cleanup } = await setupGitRepo(owner, repo, prNumber);\n \n     // Store cleanup function for signal handlers\n     cleanupFn = cleanup;\n@@ -275,8 +269,9 @@ async function main() {\n \n       if (result.status === \"completed\") {\n         console.log(\"✓ Screenshots captured successfully\");\n-        console.log(`  Screenshots: ${result.screenshotPaths?.length || 0}`);\n-        const firstScreenshot = result.screenshotPaths?.[0];\n+        const screenshots = result.screenshots ?? [];\n+        console.log(`  Screenshots: ${screenshots.length}`);\n+        const firstScreenshot = screenshots[0]?.path;\n         if (firstScreenshot) {\n           console.log(`  Location: ${path.dirname(firstScreenshot)}`);\n         }\ndiff --git a/apps/worker/src/screenshotCollector/runTaskScreenshots.ts b/apps/worker/src/screenshotCollector/runTaskScreenshots.ts\nindex f747e1ee6..ce1efeac2 100644\n--- a/apps/worker/src/screenshotCollector/runTaskScreenshots.ts\n+++ b/apps/worker/src/screenshotCollector/runTaskScreenshots.ts\n@@ -33,8 +33,10 @@ async function uploadScreenshotFile(params: {\n   commitSha: string;\n   token: string;\n   convexUrl?: string;\n+  description?: string;\n }): Promise<NonNullable<ScreenshotUploadPayload[\"images\"]>[number]> {\n-  const { screenshotPath, fileName, commitSha, token, convexUrl } = params;\n+  const { screenshotPath, fileName, commitSha, token, convexUrl, description } =\n+    params;\n   const resolvedFileName = fileName ?? path.basename(screenshotPath);\n   const contentType = resolveContentType(screenshotPath);\n \n@@ -72,6 +74,7 @@ async function uploadScreenshotFile(params: {\n     mimeType: contentType,\n     fileName: resolvedFileName,\n     commitSha,\n+    description,\n   };\n }\n \n@@ -93,11 +96,13 @@ export async function runTaskScreenshots(\n   });\n \n   let images: ScreenshotUploadPayload[\"images\"];\n+  let hasUiChanges: boolean | undefined;\n   let status: ScreenshotUploadPayload[\"status\"] = \"failed\";\n   let error: string | undefined;\n \n   if (result.status === \"completed\") {\n     const capturedScreens = result.screenshots ?? [];\n+    hasUiChanges = result.hasUiChanges;\n     if (capturedScreens.length === 0) {\n       status = \"failed\";\n       error = \"Claude collector returned no screenshots\";\n@@ -110,6 +115,7 @@ export async function runTaskScreenshots(\n           commitSha: result.commitSha,\n           token,\n           convexUrl,\n+          description: screenshot.description,\n         })\n       );\n \n@@ -173,7 +179,6 @@ export async function runTaskScreenshots(\n       result,\n     });\n   }\n-\n   await uploadScreenshot({\n     token,\n     baseUrlOverride: convexUrl,\n@@ -183,6 +188,7 @@ export async function runTaskScreenshots(\n       status,\n       images,\n       error,\n+      hasUiChanges,\n     },\n   });\n }\ndiff --git a/apps/worker/src/screenshotCollector/startScreenshotCollection.ts b/apps/worker/src/screenshotCollector/startScreenshotCollection.ts\nindex b2f4fea8f..d30f937da 100644\n--- a/apps/worker/src/screenshotCollector/startScreenshotCollection.ts\n+++ b/apps/worker/src/screenshotCollector/startScreenshotCollection.ts\n@@ -32,6 +32,7 @@ export interface StartScreenshotCollectionOptions {\n interface CapturedScreenshot {\n   path: string;\n   fileName: string;\n+  description?: string;\n }\n \n export type ScreenshotCollectionResult =\n@@ -39,6 +40,7 @@ export type ScreenshotCollectionResult =\n       status: \"completed\";\n       screenshots: CapturedScreenshot[];\n       commitSha: string;\n+      hasUiChanges?: boolean;\n     }\n   | { status: \"skipped\"; reason: string }\n   | { status: \"failed\"; error: string };\n@@ -457,25 +459,31 @@ export async function startScreenshotCollection(\n     });\n \n     if (claudeResult.status === \"completed\") {\n-      const screenshotPaths = claudeResult.screenshotPaths ?? [];\n-      if (screenshotPaths.length === 0) {\n+      const collectedScreenshots = claudeResult.screenshots ?? [];\n+      if (collectedScreenshots.length === 0) {\n         const error = \"Claude collector reported success but returned no files\";\n         await logToScreenshotCollector(error);\n         log(\"ERROR\", error, { headBranch, outputDir });\n         return { status: \"failed\", error };\n       }\n \n-      const screenshotEntries: CapturedScreenshot[] = screenshotPaths.map(\n-        (absolutePath) => ({\n-          path: absolutePath,\n-          fileName: path.basename(absolutePath),\n-        })\n-      );\n+      const screenshotEntries: CapturedScreenshot[] =\n+        collectedScreenshots.map((screenshot) => ({\n+          path: screenshot.path,\n+          fileName: path.basename(screenshot.path),\n+          description: screenshot.description,\n+        }));\n \n       if (screenshotEntries.length === 0) {\n         const error = \"Claude collector produced no screenshot entries\";\n         await logToScreenshotCollector(error);\n-        log(\"ERROR\", error, { headBranch, outputDir, screenshotPaths });\n+        log(\"ERROR\", error, {\n+          headBranch,\n+          outputDir,\n+          screenshotPaths: collectedScreenshots.map(\n+            (screenshot) => screenshot.path\n+          ),\n+        });\n         return { status: \"failed\", error };\n       }\n \n@@ -483,7 +491,13 @@ export async function startScreenshotCollection(\n       if (!initialPrimary) {\n         const error = \"Unable to determine primary screenshot entry\";\n         await logToScreenshotCollector(error);\n-        log(\"ERROR\", error, { headBranch, outputDir, screenshotPaths });\n+        log(\"ERROR\", error, {\n+          headBranch,\n+          outputDir,\n+          screenshotPaths: collectedScreenshots.map(\n+            (screenshot) => screenshot.path\n+          ),\n+        });\n         return { status: \"failed\", error };\n       }\n       let primaryScreenshot: CapturedScreenshot = initialPrimary;\n@@ -495,6 +509,7 @@ export async function startScreenshotCollection(\n           const updatedScreenshot: CapturedScreenshot = {\n             path: copyTarget,\n             fileName: path.basename(copyTarget),\n+            description: primaryScreenshot.description,\n           };\n           screenshotEntries[0] = updatedScreenshot;\n           primaryScreenshot = updatedScreenshot;\n@@ -528,6 +543,28 @@ export async function startScreenshotCollection(\n         );\n       }\n \n+      // Write manifest.json with hasUiChanges and image info for local docker workflows\n+      const manifestPath = path.join(outputDir, \"manifest.json\");\n+      const manifest = {\n+        hasUiChanges: claudeResult.hasUiChanges,\n+        images: screenshotEntries.map((entry) => ({\n+          path: entry.path,\n+          description: entry.description,\n+        })),\n+      };\n+      try {\n+        await fs.writeFile(manifestPath, JSON.stringify(manifest, null, 2));\n+        await logToScreenshotCollector(`Wrote manifest to ${manifestPath}`);\n+      } catch (manifestError) {\n+        const message =\n+          manifestError instanceof Error\n+            ? manifestError.message\n+            : String(manifestError ?? \"unknown manifest write error\");\n+        await logToScreenshotCollector(\n+          `Failed to write manifest.json: ${message}`\n+        );\n+      }\n+\n       log(\"INFO\", \"Claude screenshot collector completed\", {\n         headBranch,\n         baseBranch,\n@@ -539,6 +576,7 @@ export async function startScreenshotCollection(\n         status: \"completed\",\n         screenshots: screenshotEntries,\n         commitSha,\n+        hasUiChanges: claudeResult.hasUiChanges,\n       };\n     }\n \ndiff --git a/bun.lock b/bun.lock\nindex 3856289b8..36dc8139e 100644\n--- a/bun.lock\n+++ b/bun.lock\n@@ -276,7 +276,7 @@\n     \"apps/worker\": {\n       \"name\": \"@cmux/worker\",\n       \"dependencies\": {\n-        \"@anthropic-ai/claude-agent-sdk\": \"^0.1.27\",\n+        \"@anthropic-ai/claude-agent-sdk\": \"^0.1.54\",\n         \"@cmux/convex\": \"workspace:*\",\n         \"@cmux/shared\": \"workspace:*\",\n         \"@openai/codex-sdk\": \"^0.47.0\",\n@@ -291,7 +291,6 @@\n         \"socket.io\": \"^4.8.0\",\n         \"undici\": \"^6.21.3\",\n         \"zod\": \"^4.1.12\",\n-        \"zod-to-json-schema\": \"^3.24.6\",\n       },\n       \"devDependencies\": {\n         \"@types/express\": \"^4.17.21\",\n@@ -562,7 +561,7 @@\n \n     \"@ant-design/react-slick\": [\"@ant-design/react-slick@1.1.2\", \"\", { \"dependencies\": { \"@babel/runtime\": \"^7.10.4\", \"classnames\": \"^2.2.5\", \"json2mq\": \"^0.2.0\", \"resize-observer-polyfill\": \"^1.5.1\", \"throttle-debounce\": \"^5.0.0\" }, \"peerDependencies\": { \"react\": \">=16.9.0\" } }, \"sha512-EzlvzE6xQUBrZuuhSAFTdsr4P2bBBHGZwKFemEfq8gIGyIQCxalYfZW/T2ORbtQx5rU69o+WycP3exY/7T1hGA==\"],\n \n-    \"@anthropic-ai/claude-agent-sdk\": [\"@anthropic-ai/claude-agent-sdk@0.1.27\", \"\", { \"optionalDependencies\": { \"@img/sharp-darwin-arm64\": \"^0.33.5\", \"@img/sharp-darwin-x64\": \"^0.33.5\", \"@img/sharp-linux-arm\": \"^0.33.5\", \"@img/sharp-linux-arm64\": \"^0.33.5\", \"@img/sharp-linux-x64\": \"^0.33.5\", \"@img/sharp-win32-x64\": \"^0.33.5\" }, \"peerDependencies\": { \"zod\": \"^3.24.1\" } }, \"sha512-HuMPW6spj2q8FODiP/WBCqUZAYGwDPoI1EpicP9KUXvuYk+2MZQYSaD7oiN6iNPupR2T5oJ2HY/D9OzjyCD2Mw==\"],\n+    \"@anthropic-ai/claude-agent-sdk\": [\"@anthropic-ai/claude-agent-sdk@0.1.54\", \"\", { \"optionalDependencies\": { \"@img/sharp-darwin-arm64\": \"^0.33.5\", \"@img/sharp-darwin-x64\": \"^0.33.5\", \"@img/sharp-linux-arm\": \"^0.33.5\", \"@img/sharp-linux-arm64\": \"^0.33.5\", \"@img/sharp-linux-x64\": \"^0.33.5\", \"@img/sharp-linuxmusl-arm64\": \"^0.33.5\", \"@img/sharp-linuxmusl-x64\": \"^0.33.5\", \"@img/sharp-win32-x64\": \"^0.33.5\" }, \"peerDependencies\": { \"zod\": \"^3.24.1\" } }, \"sha512-NVdtI63qu+ukIVHvB2Gx4weSlZS8R4l7PiogKg59TlpmzhBI9oZr1hy9MTKf1ujtKwM0m8cqT0odvPVyGuf/+Q==\"],\n \n     \"@apm-js-collab/code-transformer\": [\"@apm-js-collab/code-transformer@0.8.2\", \"\", {}, \"sha512-YRjJjNq5KFSjDUoqu5pFUWrrsvGOxl6c3bu+uMFc9HNNptZ2rNU/TI2nLw4jnhQNtka972Ee2m3uqbvDQtPeCA==\"],\n \ndiff --git a/packages/convex/convex/_generated/api.d.ts b/packages/convex/convex/_generated/api.d.ts\nindex 58d89883b..e694bb11f 100644\n--- a/packages/convex/convex/_generated/api.d.ts\n+++ b/packages/convex/convex/_generated/api.d.ts\n@@ -49,6 +49,7 @@ import type * as stack from \"../stack.js\";\n import type * as stack_webhook from \"../stack_webhook.js\";\n import type * as stack_webhook_actions from \"../stack_webhook_actions.js\";\n import type * as storage from \"../storage.js\";\n+import type * as sync from \"../sync.js\";\n import type * as taskComments from \"../taskComments.js\";\n import type * as taskRunLogChunks from \"../taskRunLogChunks.js\";\n import type * as taskRuns from \"../taskRuns.js\";\n@@ -109,6 +110,7 @@ declare const fullApi: ApiFromModules<{\n   stack_webhook: typeof stack_webhook;\n   stack_webhook_actions: typeof stack_webhook_actions;\n   storage: typeof storage;\n+  sync: typeof sync;\n   taskComments: typeof taskComments;\n   taskRunLogChunks: typeof taskRunLogChunks;\n   taskRuns: typeof taskRuns;\ndiff --git a/packages/convex/convex/github_pr_comments.ts b/packages/convex/convex/github_pr_comments.ts\nindex 0ef6879c1..ee2deee56 100644\n--- a/packages/convex/convex/github_pr_comments.ts\n+++ b/packages/convex/convex/github_pr_comments.ts\n@@ -17,26 +17,6 @@ const COMMENT_SIGNATURE_MATCHERS = [\n ];\n const PREVIEW_SIGNATURE = `_Generated by [cmux](${CMUX_BASE_URL}) preview system_`;\n \n-const createOctokit = (token: string): Octokit => {\n-  return new Octokit({\n-    auth: token,\n-    userAgent: \"cmux-github-bot\",\n-    request: {\n-      timeout: 10_000,\n-    },\n-  });\n-};\n-\n-const parseRepoFullName = (\n-  repoFullName: string,\n-): { owner: string; repo: string } | null => {\n-  const [owner, repo] = repoFullName.split(\"/\");\n-  if (!owner || !repo) {\n-    return null;\n-  }\n-  return { owner, repo };\n-};\n-\n type PreviewRunDoc = Doc<\"previewRuns\">;\n type ScreenshotSetDoc = Doc<\"taskRunScreenshotSets\">;\n \n@@ -96,6 +76,27 @@ const summarizeSet = (\n   return `${prefix} – commit ${commit} (${timestamp})`;\n };\n \n+/**\n+ * Formats a single screenshot image into markdown lines.\n+ * Shared helper to ensure consistent rendering across all codepaths.\n+ */\n+const formatScreenshotImageMarkdown = (\n+  storageUrl: string,\n+  fileName: string,\n+  description?: string,\n+  options?: { includeHeader?: boolean },\n+): string[] => {\n+  const lines: string[] = [];\n+  if (options?.includeHeader) {\n+    lines.push(`### ${fileName}`);\n+  }\n+  if (description) {\n+    lines.push(`**${description}**`, \"\");\n+  }\n+  lines.push(`![${fileName}](${storageUrl})`, \"\");\n+  return lines;\n+};\n+\n async function renderScreenshotSetMarkdown(\n   ctx: ActionCtx,\n   set: ScreenshotSetDoc,\n@@ -106,6 +107,13 @@ async function renderScreenshotSetMarkdown(\n   const lines: string[] = [heading, \"\"];\n \n   if (set.status === \"completed\" && set.images.length > 0) {\n+    // Check if the model detected no UI changes\n+    if (!set.hasUiChanges) {\n+      lines.push(\n+        `> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.`,\n+        \"\",\n+      );\n+    }\n     const count = set.images.length;\n     const intro = `Captured ${count} screenshot${count === 1 ? \"\" : \"s\"} for commit ${commitLabel} (${timestamp}).`;\n     lines.push(intro, \"\");\n@@ -113,7 +121,7 @@ async function renderScreenshotSetMarkdown(\n       const storageUrl = await ctx.storage.getUrl(image.storageId);\n       if (!storageUrl) continue;\n       const fileName = image.fileName || \"screenshot\";\n-      lines.push(`![${fileName}](${storageUrl})`, \"\");\n+      lines.push(...formatScreenshotImageMarkdown(storageUrl, fileName, image.description));\n     }\n   } else if (set.status === \"failed\") {\n     lines.push(\n@@ -131,6 +139,26 @@ async function renderScreenshotSetMarkdown(\n   return lines.join(\"\\n\").replace(/\\n{3,}/g, \"\\n\\n\").trimEnd();\n }\n \n+const createOctokit = (token: string): Octokit => {\n+  return new Octokit({\n+    auth: token,\n+    userAgent: \"cmux-github-bot\",\n+    request: {\n+      timeout: 10_000,\n+    },\n+  });\n+};\n+\n+const parseRepoFullName = (\n+  repoFullName: string,\n+): { owner: string; repo: string } | null => {\n+  const [owner, repo] = repoFullName.split(\"/\");\n+  if (!owner || !repo) {\n+    return null;\n+  }\n+  return { owner, repo };\n+};\n+\n const collapseCommentBody = (body: string): string => {\n   const trimmed = body.trim();\n   if (trimmed.includes(COLLAPSE_MARKER)) {\n@@ -174,7 +202,7 @@ async function collapseOlderPreviewComments({\n     },\n   );\n \n-      for await (const { data } of iterator) {\n+  for await (const { data } of iterator) {\n     for (const comment of data) {\n       if (collapsedCount >= MAX_COMMENTS_TO_COLLAPSE) {\n         return;\n@@ -280,6 +308,15 @@ export const addPrReaction = internalAction({\n   },\n });\n \n+/**\n+ * Unified function to post preview comments to GitHub PRs.\n+ *\n+ * Options:\n+ * - includePreviousRuns: Include collapsible history of previous screenshot sets (default: false)\n+ * - workspaceUrl: Optional URL to include a \"Open Workspace\" link at the top\n+ * - devServerUrl: Optional URL for \"Dev Server Preview\" link\n+ * - previewConfigId: Required when includePreviousRuns is true, used to fetch history\n+ */\n export const postPreviewComment = internalAction({\n   args: {\n     installationId: v.number(),\n@@ -287,9 +324,24 @@ export const postPreviewComment = internalAction({\n     prNumber: v.number(),\n     screenshotSetId: v.id(\"taskRunScreenshotSets\"),\n     previewRunId: v.id(\"previewRuns\"),\n+    // Options for different behaviors\n+    includePreviousRuns: v.optional(v.boolean()),\n+    workspaceUrl: v.optional(v.string()),\n+    devServerUrl: v.optional(v.string()),\n+    previewConfigId: v.optional(v.id(\"previewConfigs\")),\n   },\n-  handler: async (ctx, args) => {\n-    const { installationId, repoFullName, prNumber, screenshotSetId } = args;\n+  handler: async (ctx, args): Promise<{ ok: true; commentId?: number; commentUrl?: string } | { ok: false; error: string }> => {\n+    const {\n+      installationId,\n+      repoFullName,\n+      prNumber,\n+      screenshotSetId,\n+      previewRunId,\n+      includePreviousRuns = false,\n+      workspaceUrl,\n+      devServerUrl,\n+      previewConfigId,\n+    } = args;\n \n     try {\n       const accessToken = await fetchInstallationAccessToken(installationId);\n@@ -311,19 +363,6 @@ export const postPreviewComment = internalAction({\n \n       const octokit = createOctokit(accessToken);\n \n-      const previewRunPayload = await ctx.runQuery(\n-        internal.previewRuns.getRunWithConfig,\n-        { previewRunId: args.previewRunId },\n-      );\n-      const previewRun = previewRunPayload?.run;\n-      if (!previewRun) {\n-        console.error(\"[github_pr_comments] Preview run not found\", {\n-          previewRunId: args.previewRunId,\n-        });\n-        return { ok: false, error: \"Preview run not found\" };\n-      }\n-\n-      // Get screenshot set\n       const screenshotSet = await ctx.runQuery(\n         internal.previewScreenshots.getScreenshotSet,\n         { screenshotSetId },\n@@ -336,67 +375,83 @@ export const postPreviewComment = internalAction({\n         return { ok: false, error: \"Screenshot set not found\" };\n       }\n \n-      // Collect previous screenshot sets for this PR so we can collapse them\n-      const previousRuns =\n-        (await ctx.runQuery(internal.previewRuns.listByConfigAndPr, {\n-          previewConfigId: previewRun.previewConfigId,\n-          prNumber: previewRun.prNumber,\n-          limit: MAX_PREVIOUS_SCREENSHOT_SETS + 1,\n-        })) ?? [];\n-\n-      const previousSetEntries: Array<{\n-        run: PreviewRunDoc;\n-        set: ScreenshotSetDoc;\n-      }> = [];\n-      for (const run of previousRuns) {\n-        if (run._id === previewRun._id) continue;\n-        if (!run.screenshotSetId) continue;\n-        const priorSet = await ctx.runQuery(\n-          internal.previewScreenshots.getScreenshotSet,\n-          { screenshotSetId: run.screenshotSetId },\n-        );\n-        if (!priorSet) continue;\n-        previousSetEntries.push({ run, set: priorSet });\n-        if (previousSetEntries.length >= MAX_PREVIOUS_SCREENSHOT_SETS) {\n-          break;\n-        }\n+      // Build comment sections\n+      const commentSections: string[] = [\"## Preview Screenshots\"];\n+\n+      // Build links row (under the heading)\n+      const linkParts: string[] = [];\n+      if (workspaceUrl) {\n+        linkParts.push(`[Open Workspace (1 hr)](${workspaceUrl}?src=preview.new)`);\n       }\n+      if (devServerUrl) {\n+        linkParts.push(`[Open Dev Browser (1 hr)](${devServerUrl}?src=preview.new)`);\n+      }\n+      linkParts.push(`[Open Diff Heatmap](https://0github.com/${repoFullName}/pull/${prNumber}?src=preview.new)`);\n \n-      // Build comment body\n-      const latestHeading = `### Latest commit ${formatCommitLabel(screenshotSet)}`;\n+      // Render the main screenshot section\n+      const latestHeading = includePreviousRuns\n+        ? `### Latest commit ${formatCommitLabel(screenshotSet)}`\n+        : \"\";\n       const latestSection = await renderScreenshotSetMarkdown(\n         ctx,\n         screenshotSet,\n         latestHeading,\n       );\n \n-      const commentSections: string[] = [\"## Preview Screenshots\", latestSection];\n+      commentSections.push(latestSection);\n \n-      if (previousSetEntries.length > 0) {\n-        const collapsedSections: string[] = [];\n-        for (const entry of previousSetEntries) {\n-          const sectionHeading = `#### ${summarizeSet(entry.set, entry.run)}`;\n-          collapsedSections.push(\n-            await renderScreenshotSetMarkdown(ctx, entry.set, sectionHeading),\n+      // Fetch and render previous runs if requested\n+      if (includePreviousRuns && previewConfigId) {\n+        const previousRuns =\n+          (await ctx.runQuery(internal.previewRuns.listByConfigAndPr, {\n+            previewConfigId,\n+            prNumber,\n+            limit: MAX_PREVIOUS_SCREENSHOT_SETS + 1,\n+          })) ?? [];\n+\n+        const previousSetEntries: Array<{\n+          run: PreviewRunDoc;\n+          set: ScreenshotSetDoc;\n+        }> = [];\n+        for (const run of previousRuns) {\n+          if (run._id === previewRunId) continue;\n+          if (!run.screenshotSetId) continue;\n+          const priorSet = await ctx.runQuery(\n+            internal.previewScreenshots.getScreenshotSet,\n+            { screenshotSetId: run.screenshotSetId },\n           );\n+          if (!priorSet) continue;\n+          previousSetEntries.push({ run, set: priorSet });\n+          if (previousSetEntries.length >= MAX_PREVIOUS_SCREENSHOT_SETS) {\n+            break;\n+          }\n         }\n \n-        const previousBlock = [\n-          \"<details>\",\n-          `<summary>Previous preview runs (${previousSetEntries.length})</summary>`,\n-          \"\",\n-          collapsedSections.join(\"\\n\\n---\\n\\n\"),\n-          \"\",\n-          \"</details>\",\n-        ].join(\"\\n\");\n+        if (previousSetEntries.length > 0) {\n+          const collapsedSections: string[] = [];\n+          for (const entry of previousSetEntries) {\n+            const sectionHeading = `#### ${summarizeSet(entry.set, entry.run)}`;\n+            collapsedSections.push(\n+              await renderScreenshotSetMarkdown(ctx, entry.set, sectionHeading),\n+            );\n+          }\n+\n+          const previousBlock = [\n+            \"<details>\",\n+            `<summary>Previous preview runs (${previousSetEntries.length})</summary>`,\n+            \"\",\n+            collapsedSections.join(\"\\n\\n---\\n\\n\"),\n+            \"\",\n+            \"</details>\",\n+          ].join(\"\\n\");\n \n-        commentSections.push(previousBlock);\n+          commentSections.push(previousBlock);\n+        }\n       }\n \n-      commentSections.push(\"---\", COMMENT_SIGNATURE);\n+      commentSections.push(\"---\", PREVIEW_SIGNATURE);\n       const commentBody = commentSections.join(\"\\n\\n\");\n \n-      // Post comment to GitHub\n       const { data } = await octokit.rest.issues.createComment({\n         owner: repo.owner,\n         repo: repo.repo,\n@@ -413,11 +468,11 @@ export const postPreviewComment = internalAction({\n       });\n \n       await ctx.runMutation(internal.previewRuns.updateStatus, {\n-        previewRunId: args.previewRunId,\n-        status: \"completed\",\n+        previewRunId,\n+        status: screenshotSet.status as \"completed\" | \"failed\" | \"skipped\",\n         screenshotSetId,\n-        githubCommentUrl: data.html_url ?? previewRun.githubCommentUrl,\n-        githubCommentId: data.id ?? previewRun.githubCommentId,\n+        githubCommentUrl: data.html_url,\n+        githubCommentId: data.id,\n       });\n \n       await collapseOlderPreviewComments({\n@@ -520,9 +575,8 @@ async function getScreenshotsForPr(\n     repoFullName: string;\n     prNumber: number;\n   },\n-): Promise<Array<{ url: string; fileName?: string }>> {\n+): Promise<Array<{ url: string; fileName?: string; description?: string }>> {\n   try {\n-    // Find task runs that have this PR\n     const taskRuns = await ctx.runQuery(\n       internal.github_pr_queries.findTaskRunsForPr,\n       {\n@@ -536,8 +590,7 @@ async function getScreenshotsForPr(\n       return [];\n     }\n \n-    // Get screenshots from the latest task run\n-    const screenshots: Array<{ url: string; fileName?: string }> = [];\n+    const screenshots: Array<{ url: string; fileName?: string; description?: string }> = [];\n \n     for (const run of taskRuns) {\n       if (run.latestScreenshotSetId) {\n@@ -554,6 +607,7 @@ async function getScreenshotsForPr(\n               screenshots.push({\n                 url: image.url,\n                 fileName: image.fileName,\n+                description: image.description,\n               });\n             }\n           }\n@@ -577,7 +631,7 @@ async function getScreenshotsForPr(\n }\n \n function formatScreenshotComment(\n-  screenshots: Array<{ url: string; fileName?: string }>,\n+  screenshots: Array<{ url: string; fileName?: string; description?: string }>,\n ): string {\n   if (screenshots.length === 0) {\n     return \"\";\n@@ -589,156 +643,13 @@ function formatScreenshotComment(\n \n   for (const screenshot of screenshots) {\n     const title = screenshot.fileName || \"Screenshot\";\n-    markdown += `### ${title}\\n\\n`;\n-    markdown += `![${title}](${screenshot.url})\\n\\n`;\n+    const lines = formatScreenshotImageMarkdown(screenshot.url, title, screenshot.description, { includeHeader: true });\n+    markdown += lines.join(\"\\n\") + \"\\n\";\n   }\n \n   return markdown;\n }\n \n-export const postPreviewCommentWithTaskScreenshots = internalAction({\n-  args: {\n-    installationId: v.number(),\n-    repoFullName: v.string(),\n-    prNumber: v.number(),\n-    taskRunId: v.id(\"taskRuns\"),\n-    previewRunId: v.id(\"previewRuns\"),\n-  },\n-  handler: async (ctx, args): Promise<{ ok: true; commentId?: number; commentUrl?: string } | { ok: false; error: string }> => {\n-    const { installationId, repoFullName, prNumber, taskRunId, previewRunId } = args;\n-\n-    try {\n-      const accessToken = await fetchInstallationAccessToken(installationId);\n-      if (!accessToken) {\n-        console.error(\n-          \"[github_pr_comments] Failed to get access token for preview comment\",\n-          { installationId },\n-        );\n-        return { ok: false, error: \"Failed to get access token\" };\n-      }\n-\n-      const repo = parseRepoFullName(repoFullName);\n-      if (!repo) {\n-        console.error(\"[github_pr_comments] Invalid repo full name\", {\n-          repoFullName,\n-        });\n-        return { ok: false, error: \"Invalid repository name\" };\n-      }\n-\n-      const octokit = createOctokit(accessToken);\n-\n-      // Get task run to find screenshot set\n-      const taskRun = await ctx.runQuery(internal.taskRuns.getById, {\n-        id: taskRunId,\n-      });\n-\n-      if (!taskRun?.latestScreenshotSetId) {\n-        console.error(\"[github_pr_comments] No screenshot set for task run\", {\n-          taskRunId,\n-        });\n-        return { ok: false, error: \"No screenshot set found\" };\n-      }\n-\n-      const previewRun = await ctx.runQuery(internal.previewRuns.getById, {\n-        id: previewRunId,\n-      });\n-\n-      if (!previewRun) {\n-        console.error(\"[github_pr_comments] Preview run not found\", {\n-          previewRunId,\n-        });\n-        return { ok: false, error: \"Preview run not found\" };\n-      }\n-\n-      // Get team info for the URL\n-      const team = await ctx.runQuery(internal.teams.getByTeamIdInternal, {\n-        teamId: taskRun.teamId,\n-      });\n-      const teamSlug: string = team?.slug ?? taskRun.teamId;\n-      const workspaceUrl: string = `${CMUX_BASE_URL}/${teamSlug}/task/${taskRun.taskId}`;\n-\n-      // Get screenshot set from task run\n-      const screenshotSet = await ctx.runQuery(\n-        internal.github_pr_queries.getScreenshotSet,\n-        { screenshotSetId: taskRun.latestScreenshotSetId },\n-      );\n-\n-      if (!screenshotSet) {\n-        console.error(\"[github_pr_comments] Screenshot set not found\", {\n-          screenshotSetId: taskRun.latestScreenshotSetId,\n-        });\n-        return { ok: false, error: \"Screenshot set not found\" };\n-      }\n-\n-      // Build comment body\n-      let commentBody: string = `[Open Workspace](${workspaceUrl}) (expires in 30m) • [Open in GitHub](https://github.com/${repoFullName}/pull/${prNumber})\\n\\n`;\n-      commentBody += \"## Preview Screenshots\\n\\n\";\n-\n-      if (screenshotSet.status === \"completed\" && screenshotSet.images.length > 0) {\n-        commentBody += `Successfully captured ${screenshotSet.images.length} screenshot(s) for commit \\`${(screenshotSet.commitSha || \"\").slice(0, 7)}\\`:\\n\\n`;\n-\n-        for (const image of screenshotSet.images) {\n-          // Get storage URL for the image\n-          const storageUrl = await ctx.storage.getUrl(image.storageId);\n-          if (storageUrl) {\n-            const fileName = image.fileName || \"screenshot\";\n-            commentBody += `### ${fileName}\\n`;\n-            commentBody += `![${fileName}](${storageUrl})\\n\\n`;\n-          }\n-        }\n-\n-        commentBody += `\\n---\\n${PREVIEW_SIGNATURE}`;\n-      } else if (screenshotSet.status === \"failed\") {\n-        commentBody += `Failed to capture screenshots: ${screenshotSet.error || \"Unknown error\"}\\n\\n`;\n-        commentBody += `\\n---\\n${PREVIEW_SIGNATURE}`;\n-      } else if (screenshotSet.status === \"skipped\") {\n-        commentBody += `Screenshot capture was skipped: ${screenshotSet.error || \"No preview configured\"}\\n\\n`;\n-        commentBody += `\\n---\\n${PREVIEW_SIGNATURE}`;\n-      }\n-\n-      // Post comment to GitHub\n-      const { data } = await octokit.rest.issues.createComment({\n-        owner: repo.owner,\n-        repo: repo.repo,\n-        issue_number: prNumber,\n-        body: commentBody,\n-      });\n-      console.log(\"[github_pr_comments] Successfully posted preview comment\", {\n-        installationId,\n-        repoFullName,\n-        prNumber,\n-        commentId: data.id,\n-        commentUrl: data.html_url,\n-      });\n-\n-      await ctx.runMutation(internal.previewRuns.updateStatus, {\n-        previewRunId,\n-        status: screenshotSet.status as \"completed\" | \"failed\" | \"skipped\",\n-        screenshotSetId: taskRun.latestScreenshotSetId,\n-        githubCommentUrl: data.html_url ?? previewRun.githubCommentUrl,\n-        githubCommentId: data.id ?? previewRun.githubCommentId,\n-      });\n-\n-      return { ok: true, commentId: data.id, commentUrl: data.html_url };\n-    } catch (error) {\n-      console.error(\n-        \"[github_pr_comments] Unexpected error posting preview comment\",\n-        {\n-          installationId,\n-          repoFullName,\n-          prNumber,\n-          taskRunId,\n-          error,\n-        },\n-      );\n-      return {\n-        ok: false,\n-        error: error instanceof Error ? error.message : String(error),\n-      };\n-    }\n-  },\n-});\n-\n export const addScreenshotCommentToPr = internalAction({\n   args: {\n     installationId: v.number(),\ndiff --git a/packages/convex/convex/http.ts b/packages/convex/convex/http.ts\nindex 4755b7f3c..bd3393c91 100644\n--- a/packages/convex/convex/http.ts\n+++ b/packages/convex/convex/http.ts\n@@ -7,10 +7,6 @@ import {\n   crownWorkerComplete,\n } from \"./crown_http\";\n import { createScreenshotUploadUrl, uploadScreenshot } from \"./screenshots_http\";\n-import {\n-  createPreviewScreenshotUploadUrl,\n-  uploadPreviewScreenshot,\n-} from \"./preview_screenshots_http\";\n import {\n   codeReviewFileCallback,\n   codeReviewJobCallback,\n@@ -82,18 +78,6 @@ http.route({\n   handler: createScreenshotUploadUrl,\n });\n \n-http.route({\n-  path: \"/api/screenshots/preview/upload\",\n-  method: \"POST\",\n-  handler: uploadPreviewScreenshot,\n-});\n-\n-http.route({\n-  path: \"/api/screenshots/preview/upload-url\",\n-  method: \"POST\",\n-  handler: createPreviewScreenshotUploadUrl,\n-});\n-\n http.route({\n   path: \"/api/code-review/callback\",\n   method: \"POST\",\ndiff --git a/packages/convex/convex/previewRuns.ts b/packages/convex/convex/previewRuns.ts\nindex 83edbbc86..6b7a197a6 100644\n--- a/packages/convex/convex/previewRuns.ts\n+++ b/packages/convex/convex/previewRuns.ts\n@@ -1,6 +1,7 @@\n import { v } from \"convex/values\";\n import { resolveTeamIdLoose } from \"../_shared/team\";\n-import { authQuery } from \"./users/utils\";\n+import { internal } from \"./_generated/api\";\n+import { authMutation, authQuery } from \"./users/utils\";\n import { internalMutation, internalQuery } from \"./_generated/server\";\n \n function normalizeRepoFullName(value: string): string {\n@@ -431,3 +432,129 @@ export const listByConfig = authQuery({\n     return runs;\n   },\n });\n+\n+/**\n+ * Create a preview run manually (for local preview scripts).\n+ * Follows the same flow as the GitHub webhook handler:\n+ * 1. Creates or reuses a preview run\n+ * 2. Creates a task and taskRun\n+ * 3. Links the taskRun to the preview run\n+ *\n+ * Requires an existing previewConfig for the repo.\n+ */\n+export const createManual = authMutation({\n+  args: {\n+    teamSlugOrId: v.string(),\n+    repoFullName: v.string(),\n+    prNumber: v.number(),\n+    prUrl: v.string(),\n+    headSha: v.string(),\n+    baseSha: v.optional(v.string()),\n+    headRef: v.optional(v.string()),\n+  },\n+  handler: async (ctx, args) => {\n+    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const repoFullName = normalizeRepoFullName(args.repoFullName);\n+\n+    // Find the preview config for this repo\n+    const config = await ctx.db\n+      .query(\"previewConfigs\")\n+      .withIndex(\"by_team_repo\", (q) =>\n+        q.eq(\"teamId\", teamId).eq(\"repoFullName\", repoFullName),\n+      )\n+      .first();\n+\n+    if (!config) {\n+      throw new Error(\n+        `No preview configuration found for ${repoFullName}. ` +\n+        `Please create one first via the cmux UI.`,\n+      );\n+    }\n+\n+    // Check for existing pending/running run for this PR (similar to webhook flow)\n+    const existingByPr = await ctx.db\n+      .query(\"previewRuns\")\n+      .withIndex(\"by_config_pr\", (q) =>\n+        q.eq(\"previewConfigId\", config._id).eq(\"prNumber\", args.prNumber),\n+      )\n+      .order(\"desc\")\n+      .first();\n+\n+    if (\n+      existingByPr &&\n+      existingByPr.taskRunId &&\n+      (existingByPr.status === \"pending\" || existingByPr.status === \"running\")\n+    ) {\n+      // Return existing run only if it has a taskRun linked\n+      return { previewRunId: existingByPr._id, reused: true };\n+    }\n+\n+    const now = Date.now();\n+\n+    // Step 1: Create preview run (following enqueueFromWebhook pattern)\n+    const runId = await ctx.db.insert(\"previewRuns\", {\n+      previewConfigId: config._id,\n+      teamId,\n+      repoFullName,\n+      repoInstallationId: config.repoInstallationId,\n+      prNumber: args.prNumber,\n+      prUrl: args.prUrl,\n+      headSha: args.headSha,\n+      baseSha: args.baseSha,\n+      headRef: args.headRef,\n+      headRepoFullName: undefined,\n+      headRepoCloneUrl: undefined,\n+      status: \"running\", // Start as running since we're doing local capture\n+      stateReason: \"Manual local preview\",\n+      dispatchedAt: now,\n+      startedAt: now,\n+      completedAt: undefined,\n+      screenshotSetId: undefined,\n+      githubCommentUrl: undefined,\n+      createdAt: now,\n+      updatedAt: now,\n+    });\n+\n+    await ctx.db.patch(config._id, {\n+      lastRunAt: now,\n+      updatedAt: now,\n+    });\n+\n+    // Step 2: Get user ID from auth context\n+    const identity = await ctx.auth.getUserIdentity();\n+    if (!identity) {\n+      throw new Error(\"Authentication required\");\n+    }\n+    const userId = config.createdByUserId;\n+\n+    // Step 3: Create task for this preview run (following webhook pattern)\n+    const taskId = await ctx.runMutation(internal.tasks.createForPreview, {\n+      teamId,\n+      userId,\n+      previewRunId: runId,\n+      repoFullName,\n+      prNumber: args.prNumber,\n+      prUrl: args.prUrl,\n+      headSha: args.headSha,\n+      baseBranch: config.repoDefaultBranch,\n+    });\n+\n+    // Step 4: Create taskRun (following webhook pattern)\n+    const { taskRunId } = await ctx.runMutation(internal.taskRuns.createForPreview, {\n+      taskId,\n+      teamId,\n+      userId,\n+      prUrl: args.prUrl,\n+      environmentId: config.environmentId,\n+      newBranch: args.headRef,\n+    });\n+\n+    // Step 5: Link the taskRun to the preview run\n+    await ctx.runMutation(internal.previewRuns.linkTaskRun, {\n+      previewRunId: runId,\n+      taskRunId,\n+    });\n+\n+    return { previewRunId: runId, reused: false };\n+  },\n+});\ndiff --git a/packages/convex/convex/previewScreenshots.ts b/packages/convex/convex/previewScreenshots.ts\nindex 70c7190dd..6fd5774b1 100644\n--- a/packages/convex/convex/previewScreenshots.ts\n+++ b/packages/convex/convex/previewScreenshots.ts\n@@ -1,6 +1,11 @@\n import { v } from \"convex/values\";\n import { internal } from \"./_generated/api\";\n-import { internalAction, internalMutation, internalQuery } from \"./_generated/server\";\n+import {\n+  action,\n+  internalAction,\n+  internalMutation,\n+  internalQuery,\n+} from \"./_generated/server\";\n import type { Id } from \"./_generated/dataModel\";\n \n export const createScreenshotSet = internalMutation({\n@@ -9,17 +14,21 @@ export const createScreenshotSet = internalMutation({\n     status: v.union(\n       v.literal(\"completed\"),\n       v.literal(\"failed\"),\n-      v.literal(\"skipped\"),\n+      v.literal(\"skipped\")\n     ),\n     commitSha: v.string(),\n     error: v.optional(v.string()),\n+    hasUiChanges: v.optional(v.boolean()),\n     images: v.array(\n       v.object({\n         storageId: v.id(\"_storage\"),\n         mimeType: v.string(),\n         fileName: v.optional(v.string()),\n         commitSha: v.optional(v.string()),\n-      }),\n+        width: v.optional(v.number()),\n+        height: v.optional(v.number()),\n+        description: v.optional(v.string()),\n+      })\n     ),\n   },\n   handler: async (ctx, args): Promise<Id<\"taskRunScreenshotSets\">> => {\n@@ -38,7 +47,9 @@ export const createScreenshotSet = internalMutation({\n     }\n \n     if (args.status === \"completed\" && args.images.length === 0) {\n-      throw new Error(\"At least one screenshot is required for completed status\");\n+      throw new Error(\n+        \"At least one screenshot is required for completed status\"\n+      );\n     }\n \n     const screenshots = args.images.map((image) => ({\n@@ -46,6 +57,7 @@ export const createScreenshotSet = internalMutation({\n       mimeType: image.mimeType,\n       fileName: image.fileName,\n       commitSha: image.commitSha ?? args.commitSha,\n+      description: image.description,\n     }));\n \n     const screenshotSetId: Id<\"taskRunScreenshotSets\"> = await ctx.runMutation(\n@@ -54,9 +66,10 @@ export const createScreenshotSet = internalMutation({\n         taskId: taskRun.taskId,\n         runId: taskRun._id,\n         status: args.status,\n+        hasUiChanges: args.hasUiChanges,\n         screenshots,\n         error: args.error,\n-      },\n+      }\n     );\n \n     const primaryScreenshot = screenshots[0];\n@@ -150,13 +163,14 @@ export const triggerGithubComment = internalAction({\n       screenshotSetId: previewRun.screenshotSetId,\n     });\n \n-    // Post GitHub comment with screenshots\n     await ctx.runAction(internal.github_pr_comments.postPreviewComment, {\n       installationId: previewRun.repoInstallationId,\n       repoFullName: previewRun.repoFullName,\n       prNumber: previewRun.prNumber,\n       screenshotSetId: previewRun.screenshotSetId,\n       previewRunId: args.previewRunId,\n+      includePreviousRuns: true,\n+      previewConfigId: previewRun.previewConfigId,\n     });\n \n     console.log(\"[previewScreenshots] GitHub comment posted successfully\", {\n@@ -164,3 +178,161 @@ export const triggerGithubComment = internalAction({\n     });\n   },\n });\n+\n+/**\n+ * Public action for uploading screenshots and posting GitHub comment.\n+ * Used by the local preview script.\n+ */\n+export const uploadAndComment = action({\n+  args: {\n+    previewRunId: v.id(\"previewRuns\"),\n+    status: v.union(\n+      v.literal(\"completed\"),\n+      v.literal(\"failed\"),\n+      v.literal(\"skipped\")\n+    ),\n+    commitSha: v.string(),\n+    error: v.optional(v.string()),\n+    hasUiChanges: v.optional(v.boolean()),\n+    images: v.optional(\n+      v.array(\n+        v.object({\n+          storageId: v.string(),\n+          mimeType: v.string(),\n+          fileName: v.optional(v.string()),\n+          commitSha: v.string(),\n+          width: v.optional(v.number()),\n+          height: v.optional(v.number()),\n+          description: v.optional(v.string()),\n+        })\n+      )\n+    ),\n+  },\n+  returns: v.object({\n+    ok: v.boolean(),\n+    screenshotSetId: v.optional(v.string()),\n+    githubCommentUrl: v.optional(v.string()),\n+  }),\n+  handler: async (\n+    ctx,\n+    args\n+  ): Promise<{\n+    ok: boolean;\n+    screenshotSetId?: string;\n+    githubCommentUrl?: string;\n+  }> => {\n+    const runData = await ctx.runQuery(internal.previewRuns.getRunWithConfig, {\n+      previewRunId: args.previewRunId,\n+    });\n+\n+    if (!runData?.run) {\n+      throw new Error(\"Preview run not found\");\n+    }\n+\n+    const { run: previewRun } = runData;\n+\n+    const identity = await ctx.auth.getUserIdentity();\n+    if (!identity) {\n+      throw new Error(\"Authentication required\");\n+    }\n+\n+    // Verify the authenticated user is a member of the team that owns this preview run\n+    const { isMember } = await ctx.runQuery(internal.teams.checkTeamMembership, {\n+      teamId: previewRun.teamId,\n+      userId: identity.subject,\n+    });\n+    if (!isMember) {\n+      throw new Error(\"Forbidden: Not a member of this team\");\n+    }\n+\n+    const typedImages: Array<{\n+      storageId: Id<\"_storage\">;\n+      mimeType: string;\n+      fileName?: string;\n+      commitSha?: string;\n+      width?: number;\n+      height?: number;\n+      description?: string;\n+    }> = (args.images ?? []).map((img) => ({\n+      storageId: img.storageId as Id<\"_storage\">,\n+      mimeType: img.mimeType,\n+      fileName: img.fileName,\n+      commitSha: img.commitSha,\n+      width: img.width,\n+      height: img.height,\n+      description: img.description,\n+    }));\n+\n+    const screenshotSetId = await ctx.runMutation(\n+      internal.previewScreenshots.createScreenshotSet,\n+      {\n+        previewRunId: args.previewRunId,\n+        status: args.status,\n+        commitSha: args.commitSha,\n+        error: args.error,\n+        hasUiChanges: args.hasUiChanges,\n+        images: typedImages,\n+      }\n+    );\n+\n+    let githubCommentUrl: string | undefined;\n+\n+    // Post GitHub comment for completed or skipped status\n+    if (\n+      previewRun.repoInstallationId &&\n+      screenshotSetId &&\n+      (args.status === \"completed\" || args.status === \"skipped\")\n+    ) {\n+      console.log(\n+        \"[previewScreenshots] Posting GitHub comment for manual upload\",\n+        {\n+          previewRunId: args.previewRunId,\n+          repoFullName: previewRun.repoFullName,\n+          prNumber: previewRun.prNumber,\n+        }\n+      );\n+\n+      try {\n+        const commentResult = await ctx.runAction(\n+          internal.github_pr_comments.postPreviewComment,\n+          {\n+            installationId: previewRun.repoInstallationId,\n+            repoFullName: previewRun.repoFullName,\n+            prNumber: previewRun.prNumber,\n+            previewRunId: args.previewRunId,\n+            screenshotSetId,\n+          }\n+        );\n+\n+        if (!commentResult?.ok) {\n+          throw new Error(\n+            commentResult.error ?? \"Failed to post GitHub comment\"\n+          );\n+        }\n+\n+        if (commentResult.commentUrl) {\n+          githubCommentUrl = commentResult.commentUrl;\n+        }\n+      } catch (error) {\n+        console.error(\n+          \"[previewScreenshots] Failed to post GitHub comment:\",\n+          error\n+        );\n+      }\n+    } else if (!previewRun.repoInstallationId) {\n+      console.warn(\n+        \"[previewScreenshots] No GitHub installation ID - cannot post comment\",\n+        {\n+          previewRunId: args.previewRunId,\n+          repoFullName: previewRun.repoFullName,\n+        }\n+      );\n+    }\n+\n+    return {\n+      ok: true,\n+      screenshotSetId: screenshotSetId as string,\n+      githubCommentUrl,\n+    };\n+  },\n+});\ndiff --git a/packages/convex/convex/preview_jobs_http.ts b/packages/convex/convex/preview_jobs_http.ts\nindex d6f907a5f..0af9f4d53 100644\n--- a/packages/convex/convex/preview_jobs_http.ts\n+++ b/packages/convex/convex/preview_jobs_http.ts\n@@ -361,14 +361,23 @@ export const completePreviewJob = httpAction(async (ctx, req) => {\n \n     // Post GitHub comment if we have installation ID\n     if (previewRun.repoInstallationId) {\n+      const team = await ctx.runQuery(internal.teams.getByTeamIdInternal, {\n+        teamId: taskRun.teamId,\n+      });\n+      const teamSlug = team?.slug ?? taskRun.teamId;\n+      const workspaceUrl = `https://cmux.sh/${teamSlug}/task/${taskRun.taskId}`;\n+      const devServerUrl = `https://cmux.sh/${teamSlug}/task/${taskRun.taskId}/browser`;\n+\n       const commentResult = await ctx.runAction(\n-        internal.github_pr_comments.postPreviewCommentWithTaskScreenshots,\n+        internal.github_pr_comments.postPreviewComment,\n         {\n           installationId: previewRun.repoInstallationId,\n           repoFullName: previewRun.repoFullName,\n           prNumber: previewRun.prNumber,\n-          taskRunId: taskRunId as Id<\"taskRuns\">,\n+          screenshotSetId: taskRun.latestScreenshotSetId,\n           previewRunId: previewRun._id,\n+          workspaceUrl,\n+          devServerUrl,\n         }\n       );\n \ndiff --git a/packages/convex/convex/schema.ts b/packages/convex/convex/schema.ts\nindex 6f6e7da3b..7f47c995b 100644\n--- a/packages/convex/convex/schema.ts\n+++ b/packages/convex/convex/schema.ts\n@@ -310,6 +310,7 @@ const convexSchema = defineSchema({\n       v.literal(\"failed\"),\n       v.literal(\"skipped\"),\n     ),\n+    hasUiChanges: v.optional(v.boolean()),\n     commitSha: v.optional(v.string()),\n     capturedAt: v.number(),\n     error: v.optional(v.string()),\n@@ -319,6 +320,7 @@ const convexSchema = defineSchema({\n         mimeType: v.string(),\n         fileName: v.optional(v.string()),\n         commitSha: v.optional(v.string()),\n+        description: v.optional(v.string()),\n       }),\n     ),\n     createdAt: v.number(),\n@@ -590,6 +592,7 @@ const convexSchema = defineSchema({\n       v.literal(\"failed\"),\n       v.literal(\"skipped\"),\n     ),\n+    stateReason: v.optional(v.string()),\n     dispatchedAt: v.optional(v.number()),\n     startedAt: v.optional(v.number()),\n     completedAt: v.optional(v.number()),\ndiff --git a/packages/convex/convex/screenshots_http.ts b/packages/convex/convex/screenshots_http.ts\nindex a2f49864a..8b2d8de9e 100644\n--- a/packages/convex/convex/screenshots_http.ts\n+++ b/packages/convex/convex/screenshots_http.ts\n@@ -81,6 +81,7 @@ export const uploadScreenshot = httpAction(async (ctx, req) => {\n     mimeType: image.mimeType,\n     fileName: image.fileName,\n     commitSha: image.commitSha,\n+    description: image.description,\n   }));\n \n   if (payload.status === \"completed\") {\n@@ -98,6 +99,7 @@ export const uploadScreenshot = httpAction(async (ctx, req) => {\n       taskId: run.taskId,\n       runId: payload.runId,\n       status: payload.status,\n+      hasUiChanges: payload.hasUiChanges,\n       screenshots: storedScreens,\n       error: payload.error,\n     }\ndiff --git a/packages/convex/convex/sync.ts b/packages/convex/convex/sync.ts\nnew file mode 100644\nindex 000000000..16e7eeb98\n--- /dev/null\n+++ b/packages/convex/convex/sync.ts\n@@ -0,0 +1,219 @@\n+/**\n+ * Sync mutations for upserting data from other Convex deployments.\n+ * Used by scripts/sync-convex-dev.ts\n+ */\n+\n+import { v } from \"convex/values\";\n+import { internalMutation } from \"./_generated/server\";\n+import type { GenericDatabaseWriter } from \"convex/server\";\n+import type { DataModel } from \"./_generated/dataModel\";\n+\n+// Table names that support syncing\n+type SyncableTable =\n+  | \"repos\"\n+  | \"teams\"\n+  | \"users\"\n+  | \"teamPermissions\"\n+  | \"teamMemberships\"\n+  | \"environments\"\n+  | \"environmentSnapshotVersions\"\n+  | \"pullRequests\"\n+  | \"providerConnections\"\n+  | \"previewConfigs\";\n+\n+// Index names for each table's unique key lookup\n+const TABLE_INDEXES: Record<SyncableTable, string> = {\n+  repos: \"by_team_fullName\",\n+  teams: \"by_teamId\",\n+  users: \"by_userId\",\n+  teamPermissions: \"by_team_user_perm\",\n+  teamMemberships: \"by_team_user\",\n+  environments: \"by_team\",\n+  environmentSnapshotVersions: \"by_team_snapshot\",\n+  pullRequests: \"by_team_repo_number\",\n+  providerConnections: \"by_installationId\",\n+  previewConfigs: \"by_team_repo\",\n+};\n+\n+async function findExisting(\n+  db: GenericDatabaseWriter<DataModel>,\n+  tableName: SyncableTable,\n+  record: Record<string, unknown>\n+) {\n+  // Build the query based on the unique key fields\n+  switch (tableName) {\n+    case \"repos\": {\n+      return await db\n+        .query(\"repos\")\n+        .withIndex(\"by_team_fullName\", (q) =>\n+          q\n+            .eq(\"teamId\", record.teamId as string)\n+            .eq(\"fullName\", record.fullName as string)\n+        )\n+        .first();\n+    }\n+    case \"teams\": {\n+      return await db\n+        .query(\"teams\")\n+        .withIndex(\"by_teamId\", (q) => q.eq(\"teamId\", record.teamId as string))\n+        .first();\n+    }\n+    case \"users\": {\n+      return await db\n+        .query(\"users\")\n+        .withIndex(\"by_userId\", (q) => q.eq(\"userId\", record.userId as string))\n+        .first();\n+    }\n+    case \"teamPermissions\": {\n+      return await db\n+        .query(\"teamPermissions\")\n+        .withIndex(\"by_team_user_perm\", (q) =>\n+          q\n+            .eq(\"teamId\", record.teamId as string)\n+            .eq(\"userId\", record.userId as string)\n+            .eq(\"permissionId\", record.permissionId as string)\n+        )\n+        .first();\n+    }\n+    case \"teamMemberships\": {\n+      return await db\n+        .query(\"teamMemberships\")\n+        .withIndex(\"by_team_user\", (q) =>\n+          q\n+            .eq(\"teamId\", record.teamId as string)\n+            .eq(\"userId\", record.userId as string)\n+        )\n+        .first();\n+    }\n+    case \"environments\": {\n+      // environments doesn't have a unique index by teamId+name, so we query and filter\n+      const envs = await db\n+        .query(\"environments\")\n+        .withIndex(\"by_team\", (q) => q.eq(\"teamId\", record.teamId as string))\n+        .collect();\n+      return envs.find((e) => e.name === record.name) ?? null;\n+    }\n+    case \"environmentSnapshotVersions\": {\n+      return await db\n+        .query(\"environmentSnapshotVersions\")\n+        .withIndex(\"by_team_snapshot\", (q) =>\n+          q\n+            .eq(\"teamId\", record.teamId as string)\n+            .eq(\"morphSnapshotId\", record.morphSnapshotId as string)\n+        )\n+        .first();\n+    }\n+    case \"pullRequests\": {\n+      return await db\n+        .query(\"pullRequests\")\n+        .withIndex(\"by_team_repo_number\", (q) =>\n+          q\n+            .eq(\"teamId\", record.teamId as string)\n+            .eq(\"repoFullName\", record.repoFullName as string)\n+            .eq(\"number\", record.number as number)\n+        )\n+        .first();\n+    }\n+    case \"providerConnections\": {\n+      return await db\n+        .query(\"providerConnections\")\n+        .withIndex(\"by_installationId\", (q) =>\n+          q.eq(\"installationId\", record.installationId as number)\n+        )\n+        .first();\n+    }\n+    case \"previewConfigs\": {\n+      return await db\n+        .query(\"previewConfigs\")\n+        .withIndex(\"by_team_repo\", (q) =>\n+          q\n+            .eq(\"teamId\", record.teamId as string)\n+            .eq(\"repoFullName\", record.repoFullName as string)\n+        )\n+        .first();\n+    }\n+    default:\n+      return null;\n+  }\n+}\n+\n+export const upsertBatch = internalMutation({\n+  args: {\n+    tableName: v.string(),\n+    records: v.array(v.any()),\n+    uniqueKey: v.array(v.string()),\n+  },\n+  returns: v.object({\n+    inserted: v.number(),\n+    updated: v.number(),\n+  }),\n+  handler: async (ctx, args) => {\n+    const { tableName, records } = args;\n+\n+    // Validate table name\n+    if (!(tableName in TABLE_INDEXES)) {\n+      throw new Error(`Unsupported table for sync: ${tableName}`);\n+    }\n+\n+    const table = tableName as SyncableTable;\n+    let inserted = 0;\n+    let updated = 0;\n+\n+    for (const record of records) {\n+      const existing = await findExisting(ctx.db, table, record);\n+\n+      // Remove any fields that shouldn't be synced\n+      const cleanRecord = { ...record };\n+\n+      // Special handling for environmentSnapshotVersions:\n+      // Look up the environment by teamId + environmentName and use that ID\n+      if (table === \"environmentSnapshotVersions\") {\n+        if (\"environmentName\" in cleanRecord) {\n+          const envName = cleanRecord.environmentName as string;\n+          const teamId = cleanRecord.teamId as string;\n+          delete cleanRecord.environmentName; // Remove the lookup field\n+          delete cleanRecord.environmentId; // Remove the source ID\n+\n+          // Find the environment in destination by teamId + name\n+          const envs = await ctx.db\n+            .query(\"environments\")\n+            .withIndex(\"by_team\", (q) => q.eq(\"teamId\", teamId))\n+            .collect();\n+          const destEnv = envs.find((e) => e.name === envName);\n+\n+          if (destEnv) {\n+            cleanRecord.environmentId = destEnv._id;\n+          } else {\n+            // Skip this record if we can't find the matching environment\n+            continue;\n+          }\n+        } else {\n+          // No environmentName provided, skip this record\n+          continue;\n+        }\n+      } else {\n+        // Remove ID references that might not exist in destination\n+        // These are Convex IDs that are deployment-specific\n+        if (\"environmentId\" in cleanRecord) {\n+          delete cleanRecord.environmentId;\n+        }\n+      }\n+\n+      if (\"connectionId\" in cleanRecord) {\n+        delete cleanRecord.connectionId;\n+      }\n+\n+      if (existing) {\n+        // Update existing record\n+        await ctx.db.patch(existing._id, cleanRecord);\n+        updated++;\n+      } else {\n+        // Insert new record\n+        await ctx.db.insert(table, cleanRecord);\n+        inserted++;\n+      }\n+    }\n+\n+    return { inserted, updated };\n+  },\n+});\ndiff --git a/packages/convex/convex/tasks.ts b/packages/convex/convex/tasks.ts\nindex 825498aa6..7861207ff 100644\n--- a/packages/convex/convex/tasks.ts\n+++ b/packages/convex/convex/tasks.ts\n@@ -597,6 +597,7 @@ export const recordScreenshotResult = internalMutation({\n       v.literal(\"failed\"),\n       v.literal(\"skipped\"),\n     ),\n+    hasUiChanges: v.optional(v.boolean()),\n     screenshots: v.optional(\n       v.array(\n         v.object({\n@@ -604,6 +605,7 @@ export const recordScreenshotResult = internalMutation({\n           mimeType: v.string(),\n           fileName: v.optional(v.string()),\n           commitSha: v.string(),\n+          description: v.optional(v.string()),\n         }),\n       ),\n     ),\n@@ -627,6 +629,7 @@ export const recordScreenshotResult = internalMutation({\n       taskId: args.taskId,\n       runId: args.runId,\n       status: args.status,\n+      hasUiChanges: args.hasUiChanges ?? undefined,\n       commitSha: screenshots[0]?.commitSha,\n       capturedAt: now,\n       error: args.error ?? undefined,\n@@ -635,6 +638,7 @@ export const recordScreenshotResult = internalMutation({\n         mimeType: screenshot.mimeType,\n         fileName: screenshot.fileName,\n         commitSha: screenshot.commitSha,\n+        description: screenshot.description,\n       })),\n       createdAt: now,\n       updatedAt: now,\ndiff --git a/packages/convex/convex/teams.ts b/packages/convex/convex/teams.ts\nindex 60488add9..c6edfb3c9 100644\n--- a/packages/convex/convex/teams.ts\n+++ b/packages/convex/convex/teams.ts\n@@ -108,6 +108,20 @@ export const setName = authMutation({\n   },\n });\n \n+// Internal helper to verify team membership (used by actions that need access control)\n+export const checkTeamMembership = internalQuery({\n+  args: { teamId: v.string(), userId: v.string() },\n+  handler: async (ctx, { teamId, userId }) => {\n+    const membership = await ctx.db\n+      .query(\"teamMemberships\")\n+      .withIndex(\"by_team_user\", (q) =>\n+        q.eq(\"teamId\", teamId).eq(\"userId\", userId)\n+      )\n+      .first();\n+    return { isMember: !!membership };\n+  },\n+});\n+\n // Internal helper to fetch a team by ID (used by HTTP handlers for redirects)\n export const getByTeamIdInternal = internalQuery({\n   args: { teamId: v.string() },\ndiff --git a/packages/shared/src/morph-snapshots.json b/packages/shared/src/morph-snapshots.json\nindex 036712c98..07294d503 100644\n--- a/packages/shared/src/morph-snapshots.json\n+++ b/packages/shared/src/morph-snapshots.json\n@@ -1,6 +1,6 @@\n {\n   \"schemaVersion\": 1,\n-  \"updatedAt\": \"2025-11-29T22:01:05Z\",\n+  \"updatedAt\": \"2025-12-01T06:19:18Z\",\n   \"presets\": [\n     {\n       \"presetId\": \"4vcpu_16gb_48gb\",\n@@ -48,6 +48,11 @@\n           \"version\": 8,\n           \"snapshotId\": \"snapshot_u00k1p82\",\n           \"capturedAt\": \"2025-11-29T22:00:34Z\"\n+        },\n+        {\n+          \"version\": 9,\n+          \"snapshotId\": \"snapshot_bxgzvjun\",\n+          \"capturedAt\": \"2025-12-01T06:19:30Z\"\n         }\n       ],\n       \"description\": \"Great default for day-to-day work. Balanced CPU, memory, and storage.\"\n@@ -98,6 +103,11 @@\n           \"version\": 8,\n           \"snapshotId\": \"snapshot_8b1361wp\",\n           \"capturedAt\": \"2025-11-29T22:01:05Z\"\n+        },\n+        {\n+          \"version\": 9,\n+          \"snapshotId\": \"snapshot_vyzv7lc5\",\n+          \"capturedAt\": \"2025-12-01T06:19:18Z\"\n         }\n       ],\n       \"description\": \"Extra headroom for larger codebases or heavier workloads.\"\ndiff --git a/packages/shared/src/screenshots/types.ts b/packages/shared/src/screenshots/types.ts\nindex c44c57fed..b4299183a 100644\n--- a/packages/shared/src/screenshots/types.ts\n+++ b/packages/shared/src/screenshots/types.ts\n@@ -17,6 +17,7 @@ export const ScreenshotStoredImageSchema = z.object({\n   mimeType: z.string(),\n   fileName: z.string().optional(),\n   commitSha: z.string(),\n+  description: z.string().optional(),\n });\n export type ScreenshotStoredImage = z.infer<\n   typeof ScreenshotStoredImageSchema\n@@ -28,6 +29,7 @@ export const ScreenshotUploadPayloadSchema = z.object({\n   status: z.enum([\"completed\", \"failed\", \"skipped\"]),\n   images: z.array(ScreenshotStoredImageSchema).optional(),\n   error: z.string().optional(),\n+  hasUiChanges: z.boolean().optional(),\n });\n export type ScreenshotUploadPayload = z.infer<\n   typeof ScreenshotUploadPayloadSchema\ndiff --git a/packages/www-openapi-client/src/client/types.gen.ts b/packages/www-openapi-client/src/client/types.gen.ts\nindex 57e6e9e4c..8bd40677b 100644\n--- a/packages/www-openapi-client/src/client/types.gen.ts\n+++ b/packages/www-openapi-client/src/client/types.gen.ts\n@@ -384,7 +384,7 @@ export type SetupInstanceBody = {\n     instanceId?: string;\n     selectedRepos?: Array<string>;\n     ttlSeconds?: number;\n-    snapshotId?: string | ('snapshot_u00k1p82' | 'snapshot_8b1361wp' | 'snapshot_pcmfvjra');\n+    snapshotId?: string | ('snapshot_bxgzvjun' | 'snapshot_vyzv7lc5' | 'snapshot_pcmfvjra');\n };\n \n export type CreateEnvironmentResponse = {\ndiff --git a/scripts/docker-trigger-screenshot.sh b/scripts/docker-trigger-screenshot.sh\nindex e9dcdcf87..e1ff52f72 100755\n--- a/scripts/docker-trigger-screenshot.sh\n+++ b/scripts/docker-trigger-screenshot.sh\n@@ -9,6 +9,12 @@ POLLING_BASE=\"http://localhost:${WORKER_PORT}/socket.io/?EIO=4&transport=polling\n PR_URL=\"\"\n EXEC_COMMAND=\"\"\n NON_INTERACTIVE=false\n+HOST_OUTPUT_ROOT=\"$(pwd)/tmp\"\n+HOST_OUTPUT_TGZ=\"$HOST_OUTPUT_ROOT/cmux-screenshots-latest.tgz\"\n+HOST_OUTPUT_DIR=\"$HOST_OUTPUT_ROOT/cmux-screenshots-latest\"\n+INITIAL_SCREENSHOT_DIR=\"\"\n+INITIAL_SCREENSHOT_MTIME=\"\"\n+RUN_START_TS=\"\"\n \n while [[ $# -gt 0 ]]; do\n   case \"$1\" in\n@@ -246,6 +252,14 @@ if (Object.keys(config).length > 0) {\n process.stdout.write(JSON.stringify(payload));\n ' \"$ANTHROPIC_API_KEY\")\n \n+RUN_START_TS=$(date +%s)\n+INITIAL_SCREENSHOT_DIR=$(docker exec \"$CONTAINER_NAME\" bash -lc 'ls -1t /root/screenshots 2>/dev/null | head -1 || true')\n+if [ -n \"$INITIAL_SCREENSHOT_DIR\" ]; then\n+  INITIAL_SCREENSHOT_MTIME=$(docker exec \"$CONTAINER_NAME\" bash -lc 'stat -c %Y \"/root/screenshots/'\"$INITIAL_SCREENSHOT_DIR\"'\" 2>/dev/null || true')\n+else\n+  INITIAL_SCREENSHOT_MTIME=\"\"\n+fi\n+\n echo \"Triggering worker:start-screenshot-collection...\"\n curl -s \\\n   -X POST \\\n@@ -279,6 +293,129 @@ elif [ \"$NON_INTERACTIVE\" = false ]; then\n   sleep 300\n fi\n \n+fetch_screenshots() {\n+  if ! docker ps --format '{{.Names}}' | grep -Fxq \"$CONTAINER_NAME\"; then\n+    echo \"Container is not running; skipping automatic screenshot download.\"\n+    return\n+  fi\n+\n+  echo \"Waiting for screenshots to appear in the container...\"\n+  local latest=\"\"\n+  local latest_mtime=\"\"\n+  local has_files=\"\"\n+  local target_dir=\"\"\n+  local starting_latest=\"$INITIAL_SCREENSHOT_DIR\"\n+  local starting_mtime=\"$INITIAL_SCREENSHOT_MTIME\"\n+  local run_started_at=\"$RUN_START_TS\"\n+\n+  if [ -z \"$run_started_at\" ]; then\n+    run_started_at=$(date +%s)\n+  fi\n+\n+  for _ in {1..36}; do\n+    latest=$(docker exec \"$CONTAINER_NAME\" bash -lc 'ls -1t /root/screenshots 2>/dev/null | head -1 || true')\n+    if [ -n \"$latest\" ]; then\n+      latest_mtime=$(docker exec \"$CONTAINER_NAME\" bash -lc 'stat -c %Y \"/root/screenshots/'\"$latest\"'\" 2>/dev/null || true')\n+      has_files=$(docker exec \"$CONTAINER_NAME\" bash -lc 'ls -A \"/root/screenshots/'\"$latest\"'\" 2>/dev/null | head -1 || true')\n+      is_new_dir=false\n+      if [ \"$latest\" != \"$starting_latest\" ]; then\n+        is_new_dir=true\n+      elif [ -n \"$latest_mtime\" ] && [ \"$latest_mtime\" -ge \"$run_started_at\" ]; then\n+        is_new_dir=true\n+      elif [ -n \"$starting_mtime\" ] && [ -n \"$latest_mtime\" ] && [ \"$latest_mtime\" -gt \"$starting_mtime\" ]; then\n+        is_new_dir=true\n+      fi\n+\n+      if [ \"$is_new_dir\" = true ] && [ -n \"$has_files\" ]; then\n+        target_dir=\"$latest\"\n+        break\n+      fi\n+    fi\n+    sleep 10\n+  done\n+\n+  if [ -z \"$target_dir\" ]; then\n+    echo \"No new screenshots were found in the container after waiting.\"\n+    return\n+  fi\n+\n+  echo \"Found screenshots in /root/screenshots/$target_dir. Copying to host...\"\n+  docker exec \"$CONTAINER_NAME\" bash -lc 'tar -czf /tmp/cmux-screenshots.tgz -C /root/screenshots '\"$target_dir\"'' || {\n+    echo \"Failed to create screenshots archive inside container.\"\n+    return\n+  }\n+\n+  mkdir -p \"$HOST_OUTPUT_ROOT\"\n+  rm -rf \"$HOST_OUTPUT_DIR\" \"$HOST_OUTPUT_TGZ\"\n+  docker cp \"$CONTAINER_NAME:/tmp/cmux-screenshots.tgz\" \"$HOST_OUTPUT_TGZ\" || {\n+    echo \"Failed to copy screenshots archive from container.\"\n+    return\n+  }\n+\n+  mkdir -p \"$HOST_OUTPUT_DIR\"\n+  tar -xzf \"$HOST_OUTPUT_TGZ\" -C \"$HOST_OUTPUT_DIR\"\n+  local extracted_dir=\"$HOST_OUTPUT_DIR/$target_dir\"\n+\n+  # Write a simple structured output JSON alongside the images using host paths\n+  # If the container wrote a manifest.json, use its hasUiChanges value and image descriptions\n+  if command -v python3 >/dev/null 2>&1; then\n+    python3 - <<PY\n+import json, os, glob\n+latest = \"${target_dir}\"\n+base_dir = os.path.join(\"${HOST_OUTPUT_DIR}\", latest)\n+images = sorted(glob.glob(os.path.join(base_dir, \"*.*\")))\n+# Filter out manifest.json from images list\n+images = [img for img in images if not img.endswith(\"manifest.json\")]\n+\n+# Try to read the container's manifest.json for hasUiChanges and descriptions\n+container_manifest_path = os.path.join(base_dir, \"manifest.json\")\n+has_ui_changes = bool(images)  # default: true if there are images\n+description_map = {}\n+\n+if os.path.exists(container_manifest_path):\n+    try:\n+        with open(container_manifest_path, \"r\") as f:\n+            container_manifest = json.load(f)\n+        if \"hasUiChanges\" in container_manifest:\n+            has_ui_changes = container_manifest[\"hasUiChanges\"]\n+            print(f\"Read hasUiChanges={has_ui_changes} from container manifest\")\n+        # Build a map of filename -> description for matching\n+        for img_info in container_manifest.get(\"images\", []):\n+            img_path = img_info.get(\"path\", \"\")\n+            img_desc = img_info.get(\"description\")\n+            if img_path and img_desc:\n+                filename = os.path.basename(img_path)\n+                description_map[filename] = img_desc\n+    except Exception as e:\n+        print(f\"Warning: Could not read container manifest: {e}\")\n+\n+# Build payload with descriptions from container manifest\n+image_entries = []\n+for path in images:\n+    entry = {\"path\": os.path.abspath(path)}\n+    filename = os.path.basename(path)\n+    if filename in description_map:\n+        entry[\"description\"] = description_map[filename]\n+    image_entries.append(entry)\n+\n+payload = {\n+    \"hasUiChanges\": has_ui_changes,\n+    \"images\": image_entries,\n+}\n+out_path = os.path.join(\"${HOST_OUTPUT_ROOT}\", \"cmux-screenshots-latest.json\")\n+with open(out_path, \"w\") as f:\n+    json.dump(payload, f, indent=2)\n+print(f\"Wrote JSON manifest: {out_path}\")\n+PY\n+  else\n+    echo \"python3 not available; skipping JSON manifest generation.\"\n+  fi\n+\n+  echo \"Screenshots extracted to: $extracted_dir\"\n+}\n+\n+fetch_screenshots\n+\n # Drain any pending poll so server can close cleanly once we're done\n curl -s \"${POLLING_BASE}&sid=${SID}&t=$(date +%s%3N)\" >/dev/null || true\n \ndiff --git a/scripts/local-preview-to-pr.ts b/scripts/local-preview-to-pr.ts\nnew file mode 100644\nindex 000000000..dabb29b42\n--- /dev/null\n+++ b/scripts/local-preview-to-pr.ts\n@@ -0,0 +1,525 @@\n+#!/usr/bin/env bun\n+/**\n+ * Local Preview to PR Script\n+ *\n+ * Runs screenshots locally using Docker and posts the results to a GitHub PR\n+ * via the existing Convex preview screenshot flow.\n+ *\n+ * Usage:\n+ *   bun run scripts/local-preview-to-pr.ts --pr https://github.com/owner/repo/pull/123 --team <team-slug>\n+ *\n+ * Options:\n+ *   --pr <url>       Required. The GitHub PR URL to post screenshots to.\n+ *   --team <slug>    Required. The team slug or ID.\n+ *   --skip-capture   Skip screenshot capture and use existing screenshots in tmp/\n+ *   --dry-run        Don't upload to Convex or post to GitHub, just show what would happen\n+ *\n+ * Requirements:\n+ *   - CONVEX_URL environment variable (or uses default production URL)\n+ *   - STACK_* environment variables for authentication\n+ *   - Docker installed and running (unless --skip-capture)\n+ *   - ANTHROPIC_API_KEY in environment (for screenshot capture)\n+ */\n+\n+import { spawn, spawnSync } from \"node:child_process\";\n+import * as fs from \"node:fs\";\n+import * as path from \"node:path\";\n+import process from \"node:process\";\n+import { api } from \"@cmux/convex/api\";\n+import { StackAdminApp } from \"@stackframe/js\";\n+import { ConvexHttpClient } from \"convex/browser\";\n+import \"dotenv/config\";\n+\n+const SCREENSHOT_JSON = \"tmp/cmux-screenshots-latest.json\";\n+\n+interface ScreenshotManifest {\n+  hasUiChanges: boolean;\n+  images: Array<{\n+    path: string;\n+    description?: string;\n+  }>;\n+}\n+\n+interface ParsedPrUrl {\n+  owner: string;\n+  repo: string;\n+  number: number;\n+  repoFullName: string;\n+  prUrl: string;\n+}\n+\n+interface Options {\n+  prUrl: string;\n+  teamSlugOrId: string;\n+  skipCapture: boolean;\n+  dryRun: boolean;\n+  createConfig: boolean;\n+}\n+\n+// Default values for cmux team (has active manaflow-ai GitHub App connection)\n+const DEFAULT_TEAM_ID = \"33e9f970-20c0-44ce-be20-6ef75c6b9b2b\";\n+const DEFAULT_USER_ID = \"c0aed31a-e354-4b01-92c4-853aa76ea80a\";\n+\n+function parseArgs(args: string[]): Options {\n+  let prUrl = \"\";\n+  let teamSlugOrId = DEFAULT_TEAM_ID;\n+  let skipCapture = false;\n+  let dryRun = false;\n+  let createConfig = false;\n+\n+  for (let i = 0; i < args.length; i++) {\n+    const arg = args[i];\n+    if (arg === \"--pr\") {\n+      prUrl = args[++i] ?? \"\";\n+    } else if (arg?.startsWith(\"--pr=\")) {\n+      prUrl = arg.slice(5);\n+    } else if (arg === \"--team\") {\n+      teamSlugOrId = args[++i] ?? DEFAULT_TEAM_ID;\n+    } else if (arg?.startsWith(\"--team=\")) {\n+      teamSlugOrId = arg.slice(7);\n+    } else if (arg === \"--skip-capture\") {\n+      skipCapture = true;\n+    } else if (arg === \"--dry-run\") {\n+      dryRun = true;\n+    } else if (arg === \"--create-config\") {\n+      createConfig = true;\n+    } else if (arg === \"--help\" || arg === \"-h\") {\n+      printUsage();\n+      process.exit(0);\n+    } else {\n+      console.error(`Unknown argument: ${arg}`);\n+      printUsage();\n+      process.exit(1);\n+    }\n+  }\n+\n+  if (!prUrl) {\n+    console.error(\"Error: --pr is required\");\n+    printUsage();\n+    process.exit(1);\n+  }\n+\n+  return { prUrl, teamSlugOrId, skipCapture, dryRun, createConfig };\n+}\n+\n+function printUsage(): void {\n+  console.log(`\n+Usage: bun run scripts/local-preview-to-pr.ts --pr <PR_URL> [options]\n+\n+Options:\n+  --pr <url>       Required. The GitHub PR URL to post screenshots to.\n+  --team <slug>    Optional. The team slug or ID (defaults to cmux team).\n+  --skip-capture   Skip screenshot capture and use existing screenshots in tmp/\n+  --dry-run        Don't upload to Convex or post to GitHub, just show what would happen\n+  --create-config  Create a preview config for the repo if it doesn't exist\n+  --help, -h       Show this help message\n+\n+Environment Variables:\n+  CONVEX_URL                          Convex deployment URL (defaults to production)\n+  NEXT_PUBLIC_STACK_PROJECT_ID        Stack project ID\n+  NEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY  Stack publishable key\n+  STACK_SECRET_SERVER_KEY             Stack secret server key\n+  STACK_SUPER_SECRET_ADMIN_KEY        Stack admin key\n+  CMUX_SCRIPT_USER_ID                 Stack user ID (defaults to cmux default user)\n+  ANTHROPIC_API_KEY                   Required for screenshot capture\n+\n+Examples:\n+  bun run scripts/local-preview-to-pr.ts --pr https://github.com/manaflow-ai/cmux/pull/123\n+  bun run scripts/local-preview-to-pr.ts --pr https://github.com/manaflow-ai/cmux/pull/123 --skip-capture\n+  bun run scripts/local-preview-to-pr.ts --pr https://github.com/manaflow-ai/cmux/pull/123 --dry-run\n+`);\n+}\n+\n+function parsePrUrl(url: string): ParsedPrUrl | null {\n+  const match = url.match(\n+    /^https:\\/\\/github\\.com\\/([^/]+)\\/([^/]+)\\/pull\\/(\\d+)/\n+  );\n+  if (!match) {\n+    return null;\n+  }\n+  return {\n+    owner: match[1],\n+    repo: match[2],\n+    number: parseInt(match[3], 10),\n+    repoFullName: `${match[1]}/${match[2]}`,\n+    prUrl: url,\n+  };\n+}\n+\n+async function getConvexClient(): Promise<ConvexHttpClient> {\n+  const convexUrl =\n+    process.env.CONVEX_URL ??\n+    process.env.NEXT_PUBLIC_CONVEX_URL ??\n+    \"https://polite-canary-804.convex.cloud\";\n+\n+  // Initialize Stack admin app to get auth token\n+  const stackAdminApp = new StackAdminApp({\n+    tokenStore: \"memory\",\n+    projectId: process.env.NEXT_PUBLIC_STACK_PROJECT_ID,\n+    publishableClientKey: process.env.NEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY,\n+    secretServerKey: process.env.STACK_SECRET_SERVER_KEY,\n+    superSecretAdminKey: process.env.STACK_SUPER_SECRET_ADMIN_KEY,\n+  });\n+\n+  // Get current user from Stack - we need to get a user to create a session\n+  // For scripts, we typically use a service account or the admin's user ID\n+  const userId = process.env.CMUX_SCRIPT_USER_ID ?? DEFAULT_USER_ID;\n+\n+  const user = await stackAdminApp.getUser(userId);\n+  if (!user) {\n+    throw new Error(`User not found: ${userId}`);\n+  }\n+\n+  const session = await user.createSession({ expiresInMillis: 10 * 60 * 1000 }); // 10 minutes\n+  const tokens = await session.getTokens();\n+  const token = tokens.accessToken;\n+\n+  if (!token) {\n+    throw new Error(\"Failed to get access token from Stack\");\n+  }\n+\n+  const client = new ConvexHttpClient(convexUrl);\n+  client.setAuth(token);\n+\n+  return client;\n+}\n+\n+async function runDockerScreenshot(prUrl: string): Promise<boolean> {\n+  console.log(\"\\n📸 Running screenshot capture...\\n\");\n+\n+  return new Promise((resolve) => {\n+    const scriptPath = path.join(\n+      process.cwd(),\n+      \"scripts/docker-trigger-screenshot.sh\"\n+    );\n+\n+    const child = spawn(\n+      \"bash\",\n+      [scriptPath, \"--pr\", prUrl, \"--exec\", \"sleep 1\"],\n+      {\n+        stdio: \"inherit\",\n+        cwd: process.cwd(),\n+      }\n+    );\n+\n+    child.on(\"close\", (code) => {\n+      if (code === 0) {\n+        console.log(\"\\n✅ Screenshot capture completed\\n\");\n+        resolve(true);\n+      } else {\n+        console.error(`\\n❌ Screenshot capture failed with code ${code}\\n`);\n+        resolve(false);\n+      }\n+    });\n+\n+    child.on(\"error\", (err) => {\n+      console.error(\"Failed to run screenshot script:\", err);\n+      resolve(false);\n+    });\n+  });\n+}\n+\n+function loadScreenshotManifest(): ScreenshotManifest | null {\n+  const jsonPath = path.join(process.cwd(), SCREENSHOT_JSON);\n+  if (!fs.existsSync(jsonPath)) {\n+    console.error(`Screenshot manifest not found at ${jsonPath}`);\n+    return null;\n+  }\n+\n+  try {\n+    const content = fs.readFileSync(jsonPath, \"utf-8\");\n+    return JSON.parse(content) as ScreenshotManifest;\n+  } catch (err) {\n+    console.error(\"Failed to parse screenshot manifest:\", err);\n+    return null;\n+  }\n+}\n+\n+function getCommitSha(): string {\n+  const result = spawnSync(\"git\", [\"rev-parse\", \"HEAD\"], {\n+    encoding: \"utf-8\",\n+    cwd: process.cwd(),\n+  });\n+  if (result.status === 0) {\n+    return result.stdout.trim();\n+  }\n+  return `local-${Date.now()}`;\n+}\n+\n+function getHeadRef(): string | undefined {\n+  const result = spawnSync(\"git\", [\"rev-parse\", \"--abbrev-ref\", \"HEAD\"], {\n+    encoding: \"utf-8\",\n+    cwd: process.cwd(),\n+  });\n+  if (result.status === 0) {\n+    const ref = result.stdout.trim();\n+    return ref !== \"HEAD\" ? ref : undefined;\n+  }\n+  return undefined;\n+}\n+\n+async function uploadImageToConvex(\n+  client: ConvexHttpClient,\n+  imagePath: string,\n+  teamSlugOrId: string\n+): Promise<{ storageId: string; mimeType: string; fileName: string }> {\n+  // Get upload URL\n+  const uploadUrl = await client.mutation(api.storage.generateUploadUrl, {\n+    teamSlugOrId,\n+  });\n+\n+  // Read the file\n+  const fileContent = fs.readFileSync(imagePath);\n+  const fileName = path.basename(imagePath);\n+  const ext = path.extname(imagePath).toLowerCase();\n+\n+  const mimeTypes: Record<string, string> = {\n+    \".png\": \"image/png\",\n+    \".jpg\": \"image/jpeg\",\n+    \".jpeg\": \"image/jpeg\",\n+    \".gif\": \"image/gif\",\n+    \".webp\": \"image/webp\",\n+  };\n+  const mimeType = mimeTypes[ext] ?? \"image/png\";\n+\n+  // Upload the file\n+  const uploadResponse = await fetch(uploadUrl, {\n+    method: \"POST\",\n+    headers: {\n+      \"Content-Type\": mimeType,\n+    },\n+    body: fileContent,\n+  });\n+\n+  if (!uploadResponse.ok) {\n+    throw new Error(\n+      `Failed to upload image: ${uploadResponse.status} ${uploadResponse.statusText}`\n+    );\n+  }\n+\n+  const result = (await uploadResponse.json()) as { storageId: string };\n+\n+  return {\n+    storageId: result.storageId,\n+    mimeType,\n+    fileName,\n+  };\n+}\n+\n+async function main(): Promise<void> {\n+  const options = parseArgs(process.argv.slice(2));\n+\n+  const parsedPr = parsePrUrl(options.prUrl);\n+  if (!parsedPr) {\n+    console.error(\n+      \"Invalid PR URL format. Expected: https://github.com/owner/repo/pull/123\"\n+    );\n+    process.exit(1);\n+  }\n+\n+  console.log(`\\n🎯 Target PR: ${parsedPr.repoFullName}#${parsedPr.number}\\n`);\n+  console.log(`📦 Team: ${options.teamSlugOrId}\\n`);\n+\n+  // Step 1: Run screenshot capture (unless skipped)\n+  if (!options.skipCapture) {\n+    const success = await runDockerScreenshot(options.prUrl);\n+    if (!success) {\n+      console.error(\n+        \"Screenshot capture failed. Use --skip-capture to use existing screenshots.\"\n+      );\n+      process.exit(1);\n+    }\n+  } else {\n+    console.log(\n+      \"⏭️  Skipping screenshot capture (using existing screenshots)\\n\"\n+    );\n+  }\n+\n+  // Step 2: Load screenshot manifest (may be null if no screenshots were captured)\n+  const manifest = loadScreenshotManifest();\n+  const noScreenshotsCaptured = !manifest || manifest.images.length === 0;\n+\n+  if (noScreenshotsCaptured) {\n+    console.log(\"📋 No screenshots captured - model likely detected no UI changes\\n\");\n+  } else {\n+    console.log(`📋 Found ${manifest.images.length} screenshot(s)\\n`);\n+  }\n+\n+  if (options.dryRun) {\n+    if (noScreenshotsCaptured) {\n+      console.log(\"🔍 [DRY RUN] No screenshots to upload\");\n+      console.log(\n+        \"\\n🔍 [DRY RUN] Would create preview run and post 'no UI changes' comment\"\n+      );\n+    } else {\n+      console.log(\"🔍 [DRY RUN] Would upload the following screenshots:\");\n+      for (const img of manifest.images) {\n+        console.log(`   - ${img.path}`);\n+      }\n+      console.log(\n+        \"\\n🔍 [DRY RUN] Would create preview run and post GitHub comment\"\n+      );\n+    }\n+    console.log(\"\\n✅ Dry run complete\\n\");\n+    return;\n+  }\n+\n+  // Step 3: Get Convex client with auth\n+  console.log(\"🔐 Authenticating with Convex...\\n\");\n+  const client = await getConvexClient();\n+\n+  // Step 4: Get commit info\n+  const commitSha = getCommitSha();\n+  const headRef = getHeadRef();\n+  console.log(`📝 Commit: ${commitSha.slice(0, 7)}\\n`);\n+\n+  // Step 5: Ensure preview config exists (if --create-config flag is set)\n+  if (options.createConfig) {\n+    console.log(\"📋 Ensuring preview config exists...\\n\");\n+    try {\n+      // First check if a config already exists to get the repoInstallationId\n+      const existingConfig = await client.query(api.previewConfigs.getByRepo, {\n+        teamSlugOrId: options.teamSlugOrId,\n+        repoFullName: parsedPr.repoFullName,\n+      });\n+\n+      if (!existingConfig) {\n+        console.error(\n+          `   ❌ No preview config found for ${parsedPr.repoFullName}.\\n` +\n+            `      Please create one via the web UI or ensure the GitHub App is installed for this repo.`\n+        );\n+        process.exit(1);\n+      }\n+\n+      await client.mutation(api.previewConfigs.upsert, {\n+        teamSlugOrId: options.teamSlugOrId,\n+        repoFullName: parsedPr.repoFullName,\n+        repoInstallationId: existingConfig.repoInstallationId,\n+        status: \"active\",\n+      });\n+      console.log(`   ✅ Preview config ready for ${parsedPr.repoFullName}\\n`);\n+    } catch (err) {\n+      console.error(`   ❌ Failed to create preview config:`, err);\n+      process.exit(1);\n+    }\n+  }\n+\n+  // Step 6: Create manual preview run\n+  console.log(\"📤 Creating preview run...\\n\");\n+  const { previewRunId, reused } = await client.mutation(\n+    api.previewRuns.createManual,\n+    {\n+      teamSlugOrId: options.teamSlugOrId,\n+      repoFullName: parsedPr.repoFullName,\n+      prNumber: parsedPr.number,\n+      prUrl: parsedPr.prUrl,\n+      headSha: commitSha,\n+      headRef,\n+    }\n+  );\n+\n+  if (reused) {\n+    console.log(`   ♻️  Reusing existing preview run: ${previewRunId}\\n`);\n+  } else {\n+    console.log(`   ✅ Created preview run: ${previewRunId}\\n`);\n+  }\n+\n+  // Handle the case where no screenshots were captured (no UI changes detected)\n+  if (noScreenshotsCaptured) {\n+    console.log(\"📤 Posting 'no UI changes' comment to GitHub...\\n\");\n+\n+    const result = await client.action(api.previewScreenshots.uploadAndComment, {\n+      previewRunId,\n+      status: \"skipped\",\n+      commitSha,\n+      hasUiChanges: false,\n+      error: \"No UI-impacting changes were detected in this PR\",\n+      images: [],\n+    });\n+\n+    if (result.ok) {\n+      console.log(`   ✅ Screenshot set created: ${result.screenshotSetId}`);\n+      if (result.githubCommentUrl) {\n+        console.log(`   🔗 GitHub comment: ${result.githubCommentUrl}`);\n+      } else {\n+        console.log(\n+          `   ⚠️  GitHub comment was not posted (check if repo has GitHub App installed)`\n+        );\n+      }\n+    } else {\n+      console.error(\"   ❌ Failed to create screenshot set\");\n+    }\n+\n+    console.log(\"\\n🎉 Done!\\n\");\n+    return;\n+  }\n+\n+  // Step 6: Upload screenshots to Convex storage\n+  console.log(\"📤 Uploading screenshots to Convex...\\n\");\n+  const uploadedImages: Array<{\n+    storageId: string;\n+    mimeType: string;\n+    fileName: string;\n+    commitSha: string;\n+    description?: string;\n+  }> = [];\n+\n+  for (const image of manifest.images) {\n+    console.log(`   Uploading ${path.basename(image.path)}...`);\n+    try {\n+      const uploaded = await uploadImageToConvex(\n+        client,\n+        image.path,\n+        options.teamSlugOrId\n+      );\n+      uploadedImages.push({\n+        ...uploaded,\n+        commitSha,\n+        description: image.description,\n+      });\n+      console.log(`   ✅ Uploaded: ${uploaded.storageId}`);\n+    } catch (err) {\n+      console.error(`   ❌ Failed to upload ${image.path}:`, err);\n+    }\n+  }\n+\n+  if (uploadedImages.length === 0) {\n+    console.error(\"\\n❌ No images were uploaded successfully\\n\");\n+    process.exit(1);\n+  }\n+\n+  // Step 7: Create screenshot set and trigger GitHub comment\n+  console.log(\"\\n📤 Creating screenshot set and posting GitHub comment...\\n\");\n+\n+  if (manifest.hasUiChanges === false) {\n+    console.log(\"   ℹ️  Model detected no UI changes in this PR\\n\");\n+  }\n+\n+  const result = await client.action(api.previewScreenshots.uploadAndComment, {\n+    previewRunId,\n+    status: \"completed\",\n+    commitSha,\n+    hasUiChanges: manifest.hasUiChanges,\n+    images: uploadedImages,\n+  });\n+\n+  if (result.ok) {\n+    console.log(`   ✅ Screenshot set created: ${result.screenshotSetId}`);\n+    if (result.githubCommentUrl) {\n+      console.log(`   🔗 GitHub comment: ${result.githubCommentUrl}`);\n+    } else {\n+      console.log(\n+        `   ⚠️  GitHub comment was not posted (check if repo has GitHub App installed)`\n+      );\n+    }\n+  } else {\n+    console.error(\"   ❌ Failed to create screenshot set\");\n+  }\n+\n+  console.log(\"\\n🎉 Done!\\n\");\n+}\n+\n+main().catch((err) => {\n+  console.error(\"Unexpected error:\", err);\n+  process.exit(1);\n+});\ndiff --git a/scripts/snapshot.py b/scripts/snapshot.py\nindex 392cfead3..058471792 100644\n--- a/scripts/snapshot.py\n+++ b/scripts/snapshot.py\n@@ -1741,7 +1741,7 @@ async def task_install_cursor(ctx: TaskContext) -> None:\n async def task_install_global_cli(ctx: TaskContext) -> None:\n     cmd = textwrap.dedent(\n         \"\"\"\n-        bun add -g @openai/codex@0.50.0 @anthropic-ai/claude-code@2.0.27 \\\n+        bun add -g @openai/codex@0.50.0 @anthropic-ai/claude-code@2.0.54 \\\n           @google/gemini-cli@0.1.21 opencode-ai@0.6.4 codebuff \\\n           @devcontainers/cli @sourcegraph/amp\n         \"\"\"\ndiff --git a/scripts/sync-convex-dev.ts b/scripts/sync-convex-dev.ts\nnew file mode 100644\nindex 000000000..c6e045c82\n--- /dev/null\n+++ b/scripts/sync-convex-dev.ts\n@@ -0,0 +1,505 @@\n+#!/usr/bin/env bun\n+/**\n+ * Sync Convex Dev Script\n+ *\n+ * Syncs specific tables from one Convex deployment to another.\n+ * Uses the internal sync mutation to do proper upserts based on unique keys.\n+ *\n+ * Usage:\n+ *   bun run scripts/sync-convex-dev.ts\n+ *   bun run scripts/sync-convex-dev.ts --source famous-camel-162 --dest polite-canary-804\n+ *   bun run scripts/sync-convex-dev.ts --tables repos,teams,users\n+ *\n+ * Options:\n+ *   --source <name>    Source deployment name (default: famous-camel-162, production)\n+ *   --dest <name>      Destination deployment name (default: polite-canary-804, dev)\n+ *   --tables <list>    Comma-separated list of tables to sync (default: all supported tables)\n+ *   --dry-run          Show what would be synced without actually syncing\n+ *   --help, -h         Show this help message\n+ */\n+\n+import { spawnSync } from \"node:child_process\";\n+import * as path from \"node:path\";\n+import process from \"node:process\";\n+import \"dotenv/config\";\n+\n+// Default deployments\n+const DEFAULT_SOURCE = \"famous-camel-162\"; // Production\n+const DEFAULT_DEST = \"polite-canary-804\"; // Dev\n+\n+// Tables to sync by default with their unique key fields\n+const TABLE_CONFIG: Record<string, { uniqueKey: string[] }> = {\n+  repos: { uniqueKey: [\"teamId\", \"fullName\"] },\n+  teams: { uniqueKey: [\"teamId\"] },\n+  users: { uniqueKey: [\"userId\"] },\n+  teamPermissions: { uniqueKey: [\"teamId\", \"userId\", \"permissionId\"] },\n+  teamMemberships: { uniqueKey: [\"teamId\", \"userId\"] },\n+  environments: { uniqueKey: [\"teamId\", \"name\"] },\n+  environmentSnapshotVersions: { uniqueKey: [\"teamId\", \"morphSnapshotId\"] },\n+  pullRequests: { uniqueKey: [\"teamId\", \"repoFullName\", \"number\"] },\n+  providerConnections: { uniqueKey: [\"installationId\"] },\n+  previewConfigs: { uniqueKey: [\"teamId\", \"repoFullName\"] },\n+};\n+\n+const DEFAULT_TABLES = Object.keys(TABLE_CONFIG);\n+\n+interface Options {\n+  source: string;\n+  dest: string;\n+  tables: string[];\n+  dryRun: boolean;\n+  batchSize: number;\n+}\n+\n+function parseArgs(args: string[]): Options {\n+  let source = DEFAULT_SOURCE;\n+  let dest = DEFAULT_DEST;\n+  let tables = DEFAULT_TABLES;\n+  let dryRun = false;\n+  let batchSize = 100;\n+\n+  for (let i = 0; i < args.length; i++) {\n+    const arg = args[i];\n+    if (arg === \"--source\") {\n+      source = args[++i] ?? DEFAULT_SOURCE;\n+    } else if (arg?.startsWith(\"--source=\")) {\n+      source = arg.slice(9);\n+    } else if (arg === \"--dest\") {\n+      dest = args[++i] ?? DEFAULT_DEST;\n+    } else if (arg?.startsWith(\"--dest=\")) {\n+      dest = arg.slice(7);\n+    } else if (arg === \"--tables\") {\n+      tables = (args[++i] ?? \"\").split(\",\").filter(Boolean);\n+    } else if (arg?.startsWith(\"--tables=\")) {\n+      tables = arg.slice(9).split(\",\").filter(Boolean);\n+    } else if (arg === \"--batch-size\") {\n+      batchSize = parseInt(args[++i] ?? \"100\", 10);\n+    } else if (arg?.startsWith(\"--batch-size=\")) {\n+      batchSize = parseInt(arg.slice(13), 10);\n+    } else if (arg === \"--dry-run\") {\n+      dryRun = true;\n+    } else if (arg === \"--help\" || arg === \"-h\") {\n+      printUsage();\n+      process.exit(0);\n+    } else {\n+      console.error(`Unknown argument: ${arg}`);\n+      printUsage();\n+      process.exit(1);\n+    }\n+  }\n+\n+  return { source, dest, tables, dryRun, batchSize };\n+}\n+\n+function printUsage(): void {\n+  console.log(`\n+Usage: bun run scripts/sync-convex-dev.ts [options]\n+\n+Syncs specific tables from one Convex deployment to another using upserts.\n+No data is deleted - only inserted or updated based on unique keys.\n+\n+Options:\n+  --source <name>    Source deployment name (default: ${DEFAULT_SOURCE})\n+  --dest <name>      Destination deployment name (default: ${DEFAULT_DEST})\n+  --tables <list>    Comma-separated list of tables to sync\n+                     Default: ${DEFAULT_TABLES.join(\",\")}\n+  --batch-size <n>   Number of records to upsert per batch (default: 100)\n+  --dry-run          Show what would be synced without actually syncing\n+  --help, -h         Show this help message\n+\n+Examples:\n+  # Sync all default tables from production to dev\n+  bun run scripts/sync-convex-dev.ts\n+\n+  # Sync only specific tables\n+  bun run scripts/sync-convex-dev.ts --tables repos,teams,users\n+\n+  # Sync to a different destination\n+  bun run scripts/sync-convex-dev.ts --dest my-dev-deployment\n+\n+  # Preview what would be synced\n+  bun run scripts/sync-convex-dev.ts --dry-run\n+`);\n+}\n+\n+function runConvexCommand(\n+  args: string[],\n+  options?: { cwd?: string; deployKey?: string },\n+): { success: boolean; stdout: string; stderr: string } {\n+  const env = { ...process.env };\n+  if (options?.deployKey) {\n+    env.CONVEX_DEPLOY_KEY = options.deployKey;\n+  }\n+\n+  const result = spawnSync(\"bunx\", [\"convex\", ...args], {\n+    encoding: \"utf-8\",\n+    cwd: options?.cwd ?? path.join(process.cwd(), \"packages/convex\"),\n+    stdio: [\"pipe\", \"pipe\", \"pipe\"],\n+    maxBuffer: 100 * 1024 * 1024, // 100MB buffer for large tables\n+    env,\n+  });\n+\n+  return {\n+    success: result.status === 0,\n+    stdout: result.stdout ?? \"\",\n+    stderr: result.stderr ?? \"\",\n+  };\n+}\n+\n+// Get deploy key for a deployment\n+function getDeployKey(deploymentName: string): string | undefined {\n+  // Map deployment names to environment variable names\n+  const keyMap: Record<string, string> = {\n+    \"famous-camel-162\": \"CONVEX_DEPLOY_KEY_FAMOUS_CAMEL\",\n+    \"polite-canary-804\": \"CONVEX_DEPLOY_KEY\", // Default dev key\n+  };\n+\n+  const envVarName = keyMap[deploymentName];\n+  if (envVarName) {\n+    return process.env[envVarName];\n+  }\n+  return undefined;\n+}\n+\n+interface TableRecord {\n+  _id: string;\n+  _creationTime: number;\n+  [key: string]: unknown;\n+}\n+\n+async function exportTable(\n+  deploymentName: string,\n+  tableName: string,\n+): Promise<{ success: boolean; records: TableRecord[]; error?: string }> {\n+  const deployKey = getDeployKey(deploymentName);\n+\n+  // Use convex data command to export table data as JSONL\n+  const result = runConvexCommand(\n+    [\n+      \"data\",\n+      tableName,\n+      \"--deployment-name\",\n+      deploymentName,\n+      \"--format\",\n+      \"jsonl\",\n+      \"--limit\",\n+      \"8000\", // Convex has a limit on query results\n+      \"--order\",\n+      \"asc\", // Get oldest first for consistent ordering\n+    ],\n+    { deployKey },\n+  );\n+\n+  if (!result.success) {\n+    return {\n+      success: false,\n+      records: [],\n+      error: result.stderr || \"Failed to export table\",\n+    };\n+  }\n+\n+  // Parse the JSONL output\n+  const lines = result.stdout.trim().split(\"\\n\").filter(Boolean);\n+  const records: TableRecord[] = [];\n+\n+  for (const line of lines) {\n+    try {\n+      const record = JSON.parse(line) as TableRecord;\n+      records.push(record);\n+    } catch {\n+      // Skip invalid lines\n+    }\n+  }\n+\n+  return {\n+    success: true,\n+    records,\n+  };\n+}\n+\n+async function upsertBatch(\n+  deploymentName: string,\n+  tableName: string,\n+  records: TableRecord[],\n+  uniqueKey: string[],\n+): Promise<{ success: boolean; inserted: number; updated: number; error?: string }> {\n+  const deployKey = getDeployKey(deploymentName);\n+\n+  // Prepare records for upsert (remove _id and _creationTime)\n+  const cleanedRecords = records.map((record) => {\n+    const { _id, _creationTime, ...rest } = record;\n+    return rest;\n+  });\n+\n+  // Call the sync mutation\n+  const args = JSON.stringify({\n+    tableName,\n+    records: cleanedRecords,\n+    uniqueKey,\n+  });\n+\n+  const result = runConvexCommand(\n+    [\n+      \"run\",\n+      \"sync:upsertBatch\",\n+      args,\n+      \"--deployment-name\",\n+      deploymentName,\n+    ],\n+    { deployKey },\n+  );\n+\n+  if (!result.success) {\n+    return {\n+      success: false,\n+      inserted: 0,\n+      updated: 0,\n+      error: result.stderr || \"Failed to upsert batch\",\n+    };\n+  }\n+\n+  // Parse the result\n+  try {\n+    const output = JSON.parse(result.stdout.trim());\n+    return {\n+      success: true,\n+      inserted: output.inserted ?? 0,\n+      updated: output.updated ?? 0,\n+    };\n+  } catch {\n+    return {\n+      success: true,\n+      inserted: 0,\n+      updated: records.length, // Assume all updated if can't parse\n+    };\n+  }\n+}\n+\n+// Cache for environment lookups (environmentId -> {teamId, name})\n+let environmentCache: Map<string, { teamId: string; name: string }> | null = null;\n+\n+async function buildEnvironmentCache(source: string): Promise<Map<string, { teamId: string; name: string }>> {\n+  if (environmentCache) {\n+    return environmentCache;\n+  }\n+\n+  const exportResult = await exportTable(source, \"environments\");\n+  if (!exportResult.success) {\n+    throw new Error(`Failed to export environments: ${exportResult.error}`);\n+  }\n+\n+  environmentCache = new Map();\n+  for (const env of exportResult.records) {\n+    environmentCache.set(env._id, {\n+      teamId: env.teamId as string,\n+      name: env.name as string,\n+    });\n+  }\n+\n+  return environmentCache;\n+}\n+\n+async function syncTable(\n+  source: string,\n+  dest: string,\n+  tableName: string,\n+  batchSize: number,\n+  dryRun: boolean,\n+): Promise<{ success: boolean; exported: number; inserted: number; updated: number; error?: string }> {\n+  const config = TABLE_CONFIG[tableName];\n+  if (!config) {\n+    return {\n+      success: false,\n+      exported: 0,\n+      inserted: 0,\n+      updated: 0,\n+      error: `Unknown table: ${tableName}. Add it to TABLE_CONFIG.`,\n+    };\n+  }\n+\n+  // Export from source\n+  const exportResult = await exportTable(source, tableName);\n+  if (!exportResult.success) {\n+    return {\n+      success: false,\n+      exported: 0,\n+      inserted: 0,\n+      updated: 0,\n+      error: exportResult.error,\n+    };\n+  }\n+\n+  let { records } = exportResult;\n+\n+  // Special handling for environmentSnapshotVersions:\n+  // Replace environmentId with environmentName so the destination can look it up\n+  if (tableName === \"environmentSnapshotVersions\") {\n+    try {\n+      const envCache = await buildEnvironmentCache(source);\n+      records = records.map((record) => {\n+        const envId = record.environmentId as string;\n+        const env = envCache.get(envId);\n+        if (env) {\n+          return {\n+            ...record,\n+            environmentName: env.name, // Add environment name for lookup\n+          };\n+        }\n+        return record;\n+      });\n+    } catch (err) {\n+      return {\n+        success: false,\n+        exported: 0,\n+        inserted: 0,\n+        updated: 0,\n+        error: `Failed to build environment cache: ${err}`,\n+      };\n+    }\n+  }\n+\n+  if (dryRun) {\n+    return {\n+      success: true,\n+      exported: records.length,\n+      inserted: 0,\n+      updated: 0,\n+    };\n+  }\n+\n+  // Upsert in batches\n+  let totalInserted = 0;\n+  let totalUpdated = 0;\n+\n+  for (let i = 0; i < records.length; i += batchSize) {\n+    const batch = records.slice(i, i + batchSize);\n+    const result = await upsertBatch(dest, tableName, batch, config.uniqueKey);\n+\n+    if (!result.success) {\n+      return {\n+        success: false,\n+        exported: records.length,\n+        inserted: totalInserted,\n+        updated: totalUpdated,\n+        error: result.error,\n+      };\n+    }\n+\n+    totalInserted += result.inserted;\n+    totalUpdated += result.updated;\n+  }\n+\n+  return {\n+    success: true,\n+    exported: records.length,\n+    inserted: totalInserted,\n+    updated: totalUpdated,\n+  };\n+}\n+\n+async function main(): Promise<void> {\n+  const options = parseArgs(process.argv.slice(2));\n+\n+  // Validate deploy keys are available\n+  const sourceKey = getDeployKey(options.source);\n+  const destKey = getDeployKey(options.dest);\n+\n+  if (!sourceKey) {\n+    console.error(`❌ Missing deploy key for source deployment: ${options.source}`);\n+    console.error(`   Set the appropriate environment variable (e.g., CONVEX_DEPLOY_KEY_FAMOUS_CAMEL)`);\n+    process.exit(1);\n+  }\n+\n+  if (!destKey) {\n+    console.error(`❌ Missing deploy key for destination deployment: ${options.dest}`);\n+    console.error(`   Set the appropriate environment variable (e.g., CONVEX_DEPLOY_KEY)`);\n+    process.exit(1);\n+  }\n+\n+  console.log(`\n+╔════════════════════════════════════════════════════════════╗\n+║                    Convex Dev Sync                          ║\n+╠════════════════════════════════════════════════════════════╣\n+║  Source: ${options.source.padEnd(47)}║\n+║  Dest:   ${options.dest.padEnd(47)}║\n+║  Tables: ${options.tables.length.toString().padEnd(47)}║\n+╚════════════════════════════════════════════════════════════╝\n+`);\n+\n+  if (options.dryRun) {\n+    console.log(\"🔍 DRY RUN - No changes will be made\\n\");\n+  }\n+\n+  console.log(`📊 Syncing tables: ${options.tables.join(\", \")}\\n`);\n+\n+  // Sync tables (could parallelize but keeping sequential for clearer output)\n+  const results: Array<{\n+    table: string;\n+    success: boolean;\n+    exported: number;\n+    inserted: number;\n+    updated: number;\n+    error?: string;\n+  }> = [];\n+\n+  for (const table of options.tables) {\n+    process.stdout.write(`   ${table}... `);\n+\n+    const result = await syncTable(\n+      options.source,\n+      options.dest,\n+      table,\n+      options.batchSize,\n+      options.dryRun,\n+    );\n+\n+    results.push({ table, ...result });\n+\n+    if (result.success) {\n+      if (options.dryRun) {\n+        console.log(`✅ ${result.exported} records to sync`);\n+      } else {\n+        console.log(`✅ ${result.exported} exported, ${result.inserted} inserted, ${result.updated} updated`);\n+      }\n+    } else {\n+      console.log(`❌ ${result.error}`);\n+    }\n+  }\n+\n+  // Summary\n+  const successful = results.filter((r) => r.success);\n+  const failed = results.filter((r) => !r.success);\n+  const totalExported = successful.reduce((sum, r) => sum + r.exported, 0);\n+  const totalInserted = successful.reduce((sum, r) => sum + r.inserted, 0);\n+  const totalUpdated = successful.reduce((sum, r) => sum + r.updated, 0);\n+\n+  console.log(\"\\n\" + \"═\".repeat(60));\n+  console.log(\"📊 Summary:\");\n+  console.log(`   Tables processed: ${options.tables.length}`);\n+  console.log(`   Successful: ${successful.length}`);\n+  console.log(`   Failed: ${failed.length}`);\n+  console.log(`   Total records exported: ${totalExported}`);\n+  if (!options.dryRun) {\n+    console.log(`   Total inserted: ${totalInserted}`);\n+    console.log(`   Total updated: ${totalUpdated}`);\n+  }\n+  console.log(\"═\".repeat(60));\n+\n+  if (failed.length > 0) {\n+    console.log(\"\\n❌ Failed tables:\");\n+    for (const f of failed) {\n+      console.log(`   - ${f.table}: ${f.error}`);\n+    }\n+  }\n+\n+  if (options.dryRun) {\n+    console.log(\"\\n✨ Dry run complete. No changes were made.\\n\");\n+  } else {\n+    console.log(\"\\n✅ Sync complete!\\n\");\n+  }\n+}\n+\n+main().catch((err) => {\n+  console.error(\"Unexpected error:\", err);\n+  process.exit(1);\n+});\ndiff --git a/scripts/test-screenshot-collector-docker.sh b/scripts/test-screenshot-collector-docker.sh\nindex 03694b077..30886fb97 100644\n--- a/scripts/test-screenshot-collector-docker.sh\n+++ b/scripts/test-screenshot-collector-docker.sh\n@@ -26,7 +26,7 @@ RUN curl -fsSL https://bun.sh/install | bash && \\\n   ln -s /usr/local/bin/bun /usr/local/bin/bunx\n \n # Install Claude Code globally\n-RUN bun add -g @anthropic-ai/claude-code@2.0.27\n+RUN bun add -g @anthropic-ai/claude-code@2.0.54\n \n WORKDIR /root/workspace\n \n","comments":[{"type":"issue_comment","id":3591994932,"prNumber":1058,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n[Open Workspace](https://cmux.dev/austin-dev/task/kn72sxgcqr3bsfhzw5ef91mrs17wbgdc) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1058)\n\n## Preview Screenshots\n\nSuccessfully captured 6 screenshot(s) for commit `73aedab`:\n\n### client-dashboard-screenshot-improve-1.png\n![client-dashboard-screenshot-improve-1.png](https://famous-camel-162.convex.cloud/api/storage/dc14d7ae-d046-4161-9905-4d32542e195e)\n\n### preview-configure-loading-screenshot-improve-1.png\n![preview-configure-loading-screenshot-improve-1.png](https://famous-camel-162.convex.cloud/api/storage/e79d4d37-36a4-41b5-8ba4-38389b0e3bfb)\n\n### preview-page-configured-repos-screenshot-improve-1.png\n![preview-page-configured-repos-screenshot-improve-1.png](https://famous-camel-162.convex.cloud/api/storage/c2b0a679-62eb-4a14-9f4e-7b385ddeb429)\n\n### preview-page-header-screenshot-improve-1.png\n![preview-page-header-screenshot-improve-1.png](https://famous-camel-162.convex.cloud/api/storage/0a213bdb-eec8-4915-a14f-e46877f6b812)\n\n### preview-page-screenshot-improve-1.png\n![preview-page-screenshot-improve-1.png](https://famous-camel-162.convex.cloud/api/storage/442eeef0-df56-4d96-8629-6119845c44c5)\n\n### preview-page-what-is-section-screenshot-improve-1.png\n![preview-page-what-is-section-screenshot-improve-1.png](https://famous-camel-162.convex.cloud/api/storage/0e628839-9c79-43bb-8247-d81344b9ec68)\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_\n\n</details>","commitSha":"9bffaadf24b0cb5c625e485f6287898b577dbadd","createdAt":"2025-11-29T22:37:42Z","updatedAt":"2025-12-01T04:46:16Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1058#issuecomment-3591994932"},{"type":"issue_comment","id":3592196546,"prNumber":1058,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n[Open Workspace](https://cmux.sh/manaflow/task/kn75dtzdv8gspmasv5qhwpa2yd7wcrkc) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1058)\n\n## Preview Screenshots\n\nSuccessfully captured 3 screenshot(s) for commit `f5488e2`:\n\n### dashboard-full-page-screenshot-improve-1.png\n![dashboard-full-page-screenshot-improve-1.png](https://adorable-wombat-701.convex.cloud/api/storage/3c058087-d28b-41bf-a9fb-551e2ef8bd91)\n\n### dashboard-with-sidebar-screenshot-improve-1.png\n![dashboard-with-sidebar-screenshot-improve-1.png](https://adorable-wombat-701.convex.cloud/api/storage/81bb9d7a-7892-4aec-9ec7-10df88d70f1e)\n\n### start-task-button-disabled-screenshot-improve-1.png\n![start-task-button-disabled-screenshot-improve-1.png](https://adorable-wombat-701.convex.cloud/api/storage/6f5afe3a-c81d-4056-a6c6-07baeb20cc9e)\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"9bffaadf24b0cb5c625e485f6287898b577dbadd","createdAt":"2025-11-30T05:00:10Z","updatedAt":"2025-12-01T04:46:17Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1058#issuecomment-3592196546"},{"type":"issue_comment","id":3593352994,"prNumber":1058,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n[Open Workspace](https://cmux.sh/manaflow/task/kn7dswx71nwq99hmgkr49crcfx7wcg6g) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1058)\n\n## Preview Screenshots\n\nSuccessfully captured 3 screenshot(s) for commit `a430992`:\n\n### dashboard-full-page-screenshot-improve-1.png\n![dashboard-full-page-screenshot-improve-1.png](https://adorable-wombat-701.convex.cloud/api/storage/f44b28ba-cee6-4701-ab82-1185884bd111)\n\n### dashboard-full-screenshot-improve-1.png\n![dashboard-full-screenshot-improve-1.png](https://adorable-wombat-701.convex.cloud/api/storage/8b8cbca0-0f58-421e-a05d-3ef05081e0bb)\n\n### settings-full-screenshot-improve-1.png\n![settings-full-screenshot-improve-1.png](https://adorable-wombat-701.convex.cloud/api/storage/d54c4de0-3d8b-4c6d-803b-d38a5e9f94be)\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"9bffaadf24b0cb5c625e485f6287898b577dbadd","createdAt":"2025-11-30T20:50:01Z","updatedAt":"2025-12-01T04:46:18Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1058#issuecomment-3593352994"},{"type":"issue_comment","id":3594256328,"prNumber":1058,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n[Open Workspace](https://cmux.sh/manaflow/task/kn72rp8sp4pqvkxgac8a2xgrr17wfjvc) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1058)\n\n## Preview Screenshots\n\nSuccessfully captured 2 screenshot(s) for commit `86a9bc2`:\n\n### dashboard-initial-view-screenshot-improve-1.png\n![dashboard-initial-view-screenshot-improve-1.png](https://adorable-wombat-701.convex.cloud/api/storage/c254ffc2-9149-4cf0-819b-6f8f31173487)\n\n### www-app-initial-screenshot-improve-1.png\n![www-app-initial-screenshot-improve-1.png](https://adorable-wombat-701.convex.cloud/api/storage/7874f4d9-5364-4a64-9e9a-5d5d876054e9)\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"9bffaadf24b0cb5c625e485f6287898b577dbadd","createdAt":"2025-12-01T02:23:31Z","updatedAt":"2025-12-01T04:46:19Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1058#issuecomment-3594256328"},{"type":"issue_comment","id":3594516291,"prNumber":1058,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n[Open Workspace](https://cmux.sh/austin-dev/task/kn7fhax1vh6fn9cp6k8tp0q87n7weyew) (expires in 30m) • [Open in GitHub](https://github.com/manaflow-ai/cmux/pull/1058)\n\n## Preview Screenshots\n\nSuccessfully captured 4 screenshot(s) for commit `9c2799d`:\n\n### preview-dashboard-before-delete-screenshot-improve-1.png\n![preview-dashboard-before-delete-screenshot-improve-1.png](https://famous-camel-162.convex.cloud/api/storage/33addbf0-ffd8-490a-a1b2-02697a5417c7)\n\n### preview-dashboard-delete-modal-fullpage-screenshot-improve-1.png\n![preview-dashboard-delete-modal-fullpage-screenshot-improve-1.png](https://famous-camel-162.convex.cloud/api/storage/0e653ba4-4896-4744-860e-deb51387b4cb)\n\n### preview-dashboard-delete-modal-second-repo-screenshot-improve-1.png\n![preview-dashboard-delete-modal-second-repo-screenshot-improve-1.png](https://famous-camel-162.convex.cloud/api/storage/a42a3c36-0842-4f41-8a52-68b63148af64)\n\n### preview-dashboard-delete-modal-viewport-screenshot-improve-1.png\n![preview-dashboard-delete-modal-viewport-screenshot-improve-1.png](https://famous-camel-162.convex.cloud/api/storage/b741a9aa-5185-4cc1-8b58-733cdcb3fb72)\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"9bffaadf24b0cb5c625e485f6287898b577dbadd","createdAt":"2025-12-01T04:46:15Z","updatedAt":"2025-12-01T06:53:19Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1058#issuecomment-3594516291"},{"type":"issue_comment","id":3594851602,"prNumber":1058,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n[Open Workspace](https://cmux.sh/austin-dev/task/kn7bvcqqtd5vj0qha0wf2120yn7wfrxs) (expires in 30m) • [Open in GitHub](https://0github.com/manaflow-ai/cmux/pull/1058)\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\nCaptured 2 screenshots for commit `b13c99f` (2025-12-01 06:53:15.564 UTC).\n\n![pr-page-empty-state-screenshot-improve-1.png](https://famous-camel-162.convex.cloud/api/storage/9677de16-5c6b-4e65-8c79-ce656d3e6313)\n\n![pr-page-no-pull-request-full-screenshot-improve-1.png](https://famous-camel-162.convex.cloud/api/storage/b5b0e93c-c6e1-4a88-905d-632f89f49595)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"9bffaadf24b0cb5c625e485f6287898b577dbadd","createdAt":"2025-12-01T06:53:18Z","updatedAt":"2025-12-01T07:42:53Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1058#issuecomment-3594851602"},{"type":"issue_comment","id":3595062610,"prNumber":1058,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n\n\nCaptured 3 screenshots for commit `0093231` (2025-12-01 07:42:50.540 UTC).\n\n**Close-up of the button after the change showing 'Open Heatmap Diff Viewer' text**\n\n![after-open-heatmap-diff-viewer-button-screenshot-improve-1.png](https://famous-camel-162.convex.cloud/api/storage/041c11c5-986d-4641-9864-c7d18aa77d55)\n\n**Close-up of the button before the change showing 'Open in GitHub' text**\n\n![before-open-in-github-button-screenshot-improve-1.png](https://famous-camel-162.convex.cloud/api/storage/de6b7704-ddb4-4478-b4b2-938a18cfced1)\n\n**Full comparison view showing the button text change from 'Open in GitHub' (before) to 'Open Heatmap Diff Viewer' (after) in the Pull Request page header**\n\n![pr-button-text-change-comparison-screenshot-improve-1.png](https://famous-camel-162.convex.cloud/api/storage/1b72e8bc-7857-456a-9aa0-67c366c7f388)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"9bffaadf24b0cb5c625e485f6287898b577dbadd","createdAt":"2025-12-01T07:42:52Z","updatedAt":"2025-12-01T07:42:52Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1058#issuecomment-3595062610"}]}
{"number":1055,"title":"Fix slow codex startup by injecting DSR responses","state":"open","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1055","headRef":"fix-codex-dsr-response","headSha":"6c6e282cb94085b6b71b90d3a20e572b1edc423d","baseRef":"cmux-sandbox-1","baseSha":"6cdefb99743876ba906575214cbb908006e3449b","createdAt":"2025-11-27T03:13:57Z","updatedAt":"2025-12-01T02:46:38Z","diff":"diff --git a/packages/sandbox/src/bubblewrap.rs b/packages/sandbox/src/bubblewrap.rs\nindex 01071a15d..74270daa6 100644\n--- a/packages/sandbox/src/bubblewrap.rs\n+++ b/packages/sandbox/src/bubblewrap.rs\n@@ -1285,8 +1285,16 @@ impl SandboxService for BubblewrapService {\n             let (tx_out, mut rx_out) = tokio::sync::mpsc::channel::<Vec<u8>>(32);\n             let tx_err = tx_out.clone();\n \n+            // Clone tx_in for DSR response injection\n+            let tx_in_for_dsr = tx_in.clone();\n+\n             tokio::spawn(async move {\n                 let mut buf = [0u8; 1024];\n+                // DSR cursor position query: ESC [ 6 n\n+                const DSR_QUERY: &[u8] = b\"\\x1b[6n\";\n+                // DSR status query: ESC [ 5 n\n+                const DSR_STATUS_QUERY: &[u8] = b\"\\x1b[5n\";\n+\n                 loop {\n                     match stdout.read(&mut buf).await {\n                         Ok(0) => {\n@@ -1294,8 +1302,26 @@ impl SandboxService for BubblewrapService {\n                             break;\n                         }\n                         Ok(n) => {\n-                            info!(\"Read from stdout: {:?}\", String::from_utf8_lossy(&buf[..n]));\n-                            if tx_out.send(buf[..n].to_vec()).await.is_err() {\n+                            let data = &buf[..n];\n+                            info!(\"Read from stdout: {:?}\", String::from_utf8_lossy(data));\n+\n+                            // Check for DSR cursor position query and respond immediately\n+                            if data.windows(DSR_QUERY.len()).any(|w| w == DSR_QUERY) {\n+                                // Respond with cursor at position 1,1 (standard response)\n+                                let response = b\"\\x1b[1;1R\".to_vec();\n+                                info!(\"Detected DSR query, injecting cursor position response\");\n+                                let _ = tx_in_for_dsr.send(response).await;\n+                            }\n+\n+                            // Check for DSR status query and respond\n+                            if data.windows(DSR_STATUS_QUERY.len()).any(|w| w == DSR_STATUS_QUERY) {\n+                                // Respond with \"OK\" status\n+                                let response = b\"\\x1b[0n\".to_vec();\n+                                info!(\"Detected DSR status query, injecting OK response\");\n+                                let _ = tx_in_for_dsr.send(response).await;\n+                            }\n+\n+                            if tx_out.send(data.to_vec()).await.is_err() {\n                                 break;\n                             }\n                         }\n","comments":[{"type":"issue_comment","id":3594300274,"prNumber":1055,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nCaptured 2 screenshots for commit `8e1da08` (2025-12-01 02:46:36.505 UTC).\n\n**Full page view of the homepage showing the updated hero section with 67x engineers messaging**\n\n![homepage-full-page.png](https://polite-canary-804.convex.cloud/api/storage/5d44f885-2fc7-4a64-81ed-0d9fec71ceee)\n\n**Above-the-fold viewport showing the new hero text**\n\n![homepage-viewport.png](https://polite-canary-804.convex.cloud/api/storage/10cf0e86-f0d4-4357-89be-1e9554a48cbb)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"6c6e282cb94085b6b71b90d3a20e572b1edc423d","createdAt":"2025-12-01T02:46:38Z","updatedAt":"2025-12-01T02:46:38Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1055#issuecomment-3594300274"}]}
{"number":1042,"title":"Pad left offset for non-archived tasks","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1042","headRef":"cmux/pad-left-offset-for-non-archived-tasks-b2ae3","headSha":"0708fccc9688282a7b4964c3db384ea93d070999","baseRef":"main","baseSha":"61bc75a8bc572cf3ab090de784f3d600edfad24f","createdAt":"2025-11-24T23:54:52Z","updatedAt":"2025-11-25T00:03:53Z","diff":"diff --git a/apps/client/src/components/dashboard/TaskList.tsx b/apps/client/src/components/dashboard/TaskList.tsx\nindex fb66e9bad..dea857570 100644\n--- a/apps/client/src/components/dashboard/TaskList.tsx\n+++ b/apps/client/src/components/dashboard/TaskList.tsx\n@@ -200,7 +200,7 @@ export const TaskList = memo(function TaskList({\n               Loading...\n             </div>\n           ) : archivedTasks.length === 0 ? (\n-            <div className=\"text-sm text-neutral-500 dark:text-neutral-400 py-2 select-none\">\n+            <div className=\"text-sm text-neutral-500 dark:text-neutral-400 py-2 pl-4 select-none\">\n               No archived tasks\n             </div>\n           ) : (\n","comments":[{"type":"issue_comment","id":3573204937,"prNumber":1042,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 1 screenshot(s) for commit `0708fcc`:\n\n### error-state-HEAD.png\n![error-state-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/4783df71-2736-451e-8c25-2f6a2f5d1485)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"0708fccc9688282a7b4964c3db384ea93d070999","createdAt":"2025-11-24T23:58:12Z","updatedAt":"2025-11-24T23:58:12Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1042#issuecomment-3573204937"}]}
{"number":1040,"title":"cmux sandbox 1","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1040","headRef":"cmux-sandbox-1","headSha":"8ee6dc89151e7e70b2682477646b6a51463bdb70","baseRef":"main","baseSha":"80637a496ef7dece44eb3df16723ad9ab124d43d","createdAt":"2025-11-24T22:28:01Z","updatedAt":"2025-12-02T03:19:02Z","diff":"","comments":[{"type":"issue_comment","id":3579086774,"prNumber":1040,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\nSuccessfully captured 7 screenshot(s) for commit `498cbe4`:\n\n### acp-chat-demo-bottom-view-HEAD.png\n![acp-chat-demo-bottom-view-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/4aaf6ed6-5cef-4ef8-bdb0-217261ff4b0a)\n\n### acp-chat-demo-command-palette-HEAD.png\n![acp-chat-demo-command-palette-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/3af6b0a7-1d49-4076-99fb-83f7641d0071)\n\n### acp-chat-demo-full-view-HEAD.png\n![acp-chat-demo-full-view-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/5f0c7887-7699-40c2-b260-fcf62e312f58)\n\n### acp-chat-demo-initial-HEAD.png\n![acp-chat-demo-initial-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/3ea9f20f-0876-4e4b-88da-d1d7e5f88237)\n\n### acp-chat-demo-plan-view-HEAD.png\n![acp-chat-demo-plan-view-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/ddbda1c3-356c-4fb4-b6b0-2920af392a5e)\n\n### acp-chat-demo-scrolled-up-HEAD.png\n![acp-chat-demo-scrolled-up-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/d1ace0f1-288c-4c3b-9c9d-259a97a6cc55)\n\n### acp-chat-demo-top-view-HEAD.png\n![acp-chat-demo-top-view-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/1dda3bae-d8da-48fc-a83a-665f9d7c74dc)\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_\n\n</details>","commitSha":"8ee6dc89151e7e70b2682477646b6a51463bdb70","createdAt":"2025-11-26T04:48:16Z","updatedAt":"2025-12-01T22:51:11Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1040#issuecomment-3579086774"},{"type":"issue_comment","id":3599296472,"prNumber":1040,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\nCaptured 16 screenshots for commit `e1d3001` (2025-12-01 22:51:07.855 UTC).\n\n**Screenshot of the 3 agents selector button**\n\n![dashboard-controls-agents-cmux-sandbox-1.png](https://famous-camel-162.convex.cloud/api/storage/68624823-2141-40d7-bcfb-e339fab2343f)\n\n**Screenshot of the Cloud mode toggle switch**\n\n![dashboard-controls-cloud-mode-cmux-sandbox-1.png](https://famous-camel-162.convex.cloud/api/storage/902147cb-85a7-469b-a3d7-c68b0d10c64b)\n\n**Screenshot of the Select project button control**\n\n![dashboard-controls-select-project-cmux-sandbox-1.png](https://famous-camel-162.convex.cloud/api/storage/08ba34d5-5de8-4234-ac3f-b5bb0990e043)\n\n**Full page screenshot of the cmux dashboard showing task management interface with sidebar navigation, task list sections (Ready to review, In progress, Merged), and task input controls**\n\n![dashboard-full-page-cmux-sandbox-1.png](https://famous-camel-162.convex.cloud/api/storage/0d5279c9-fac6-4e3b-a0a9-e3b8c82bc2d2)\n\n**Viewport screenshot of the cmux dashboard main view**\n\n![dashboard-viewport-cmux-sandbox-1.png](https://famous-camel-162.convex.cloud/api/storage/f22cc75a-418c-490b-be99-10c4296f7fd9)\n\n**Full page screenshot of the preview.new landing page (cached from earlier - these pages were deleted in this PR)**\n\n![preview-landing-full-page-cmux-sandbox-1.png](https://famous-camel-162.convex.cloud/api/storage/7b1f9b70-75a8-4767-9f57-a5851ea7970d)\n\n**Viewport screenshot of the preview.new landing page (cached from earlier - these pages were deleted in this PR)**\n\n![preview-landing-viewport-cmux-sandbox-1.png](https://famous-camel-162.convex.cloud/api/storage/ed613bad-b0c2-4d3e-b9fb-dbe837a3c3b7)\n\n**Full page screenshot of the settings page showing team configuration, appearance settings, crown evaluator options, worktree location, AI provider authentication with API keys for Anthropic/OpenAI/AMP/OpenRouter/Gemini/Alibaba/Cursor, provider status, and container management settings**\n\n![settings-full-page-cmux-sandbox-1.png](https://famous-camel-162.convex.cloud/api/storage/6983286b-a9c5-44ba-83cc-b68f5f3c6dff)\n\n**Viewport screenshot of the settings page**\n\n![settings-viewport-cmux-sandbox-1.png](https://famous-camel-162.convex.cloud/api/storage/a50fca34-35d9-4752-bd38-b7c61cd23f1e)\n\n**Screenshot of the left sidebar navigation showing active tasks, pull requests, and workspaces**\n\n![sidebar-navigation-cmux-sandbox-1.png](https://famous-camel-162.convex.cloud/api/storage/352f5645-66c3-4439-b594-b96f586afeb8)\n\n**Screenshot of the Start task button (refactored to remove loading state)**\n\n![start-task-button-cmux-sandbox-1.png](https://famous-camel-162.convex.cloud/api/storage/a4b7f780-12b3-4f74-b09e-7da8e36f437b)\n\n**Screenshot of the task description input textarea control**\n\n![task-input-area-cmux-sandbox-1.png](https://famous-camel-162.convex.cloud/api/storage/6a3f58f0-816c-4cd0-9e67-dac4b8ae0444)\n\n**Screenshot of the In progress task list section (empty state)**\n\n![task-list-in-progress-cmux-sandbox-1.png](https://famous-camel-162.convex.cloud/api/storage/1ca980c7-80cc-4e8a-a0df-a0001d09feac)\n\n**Screenshot of the Ready to review task list section (empty state)**\n\n![task-list-ready-to-review-cmux-sandbox-1.png](https://famous-camel-162.convex.cloud/api/storage/000e4abd-d512-42a2-bd5c-2b8faa53c059)\n\n**Full page screenshot of the cmux marketing homepage at cmux.dev showing product description, features, workflow sections, and verification views**\n\n![www-homepage-full-page-cmux-sandbox-1.png](https://famous-camel-162.convex.cloud/api/storage/edbd05e2-95f6-4110-b104-d5af260a3f25)\n\n**Viewport screenshot of the cmux homepage hero section**\n\n![www-homepage-viewport-cmux-sandbox-1.png](https://famous-camel-162.convex.cloud/api/storage/fa0f664b-543b-4021-885b-98224339fd98)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"8ee6dc89151e7e70b2682477646b6a51463bdb70","createdAt":"2025-12-01T22:51:10Z","updatedAt":"2025-12-01T23:04:47Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1040#issuecomment-3599296472"},{"type":"issue_comment","id":3599341882,"prNumber":1040,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\nCaptured 10 screenshots for commit `9585f82` (2025-12-01 23:04:43.699 UTC).\n\n**Cloud mode toggle switch - web mode conditional logic removed**\n\n![cloud-mode-toggle.png](https://famous-camel-162.convex.cloud/api/storage/99966b4a-4d7b-48e8-854b-013b2ba1ffdb)\n\n**Full page screenshot of the main dashboard showing task input, project selector, agent selector, and cloud mode toggle**\n\n![dashboard-full-page.png](https://famous-camel-162.convex.cloud/api/storage/c3f830f5-294e-413d-9a5d-63bd7c7e3ecc)\n\n**In progress section showing no tasks currently in progress**\n\n![dashboard-in-progress-section.png](https://famous-camel-162.convex.cloud/api/storage/68332066-eb1a-48eb-bf86-0d9a0c36a863)\n\n**Ready to review section in collapsed state showing empty state**\n\n![dashboard-ready-to-review-section.png](https://famous-camel-162.convex.cloud/api/storage/66f6b8ec-0a8b-434e-9f67-d42d85aa7585)\n\n**Workspaces section showing local workspace entry**\n\n![dashboard-workspaces-section.png](https://famous-camel-162.convex.cloud/api/storage/6229428e-51f6-4555-9244-abf93d60dbe4)\n\n**Full settings page showing team settings, API key configuration, provider status, and container management settings**\n\n![settings-full-page.png](https://famous-camel-162.convex.cloud/api/storage/e9a59d8b-b281-413c-a18b-891a0270dd94)\n\n**Start task button in disabled state - button text simplified to remove loading state**\n\n![start-task-button.png](https://famous-camel-162.convex.cloud/api/storage/55b774a6-2636-4c67-9582-8cebe585aa1c)\n\n**Task description input textarea with placeholder text**\n\n![task-description-input.png](https://famous-camel-162.convex.cloud/api/storage/3a78261f-967a-46d7-b721-20a8a15bae2f)\n\n**WWW app homepage showing cmux marketing content and feature descriptions**\n\n![www-homepage-full-page.png](https://famous-camel-162.convex.cloud/api/storage/d9ad8e26-a656-4a95-867f-6d0cf0221143)\n\n**WWW app preview.new page for screenshot previews setup**\n\n![www-preview-page-full.png](https://famous-camel-162.convex.cloud/api/storage/26189ccf-df49-4938-a792-3790ade27735)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"8ee6dc89151e7e70b2682477646b6a51463bdb70","createdAt":"2025-12-01T23:04:46Z","updatedAt":"2025-12-01T23:21:41Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1040#issuecomment-3599341882"},{"type":"issue_comment","id":3599402019,"prNumber":1040,"botLogin":"cmux-agent[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n> **No UI changes detected** - The model analyzed this PR and determined there are no visual changes to the UI.\n\nCaptured 2 screenshots for commit `9e5677d` (2025-12-01 23:21:38.026 UTC).\n\n![dashboard-page-cmux-sandbox-1.png](https://adorable-wombat-701.convex.cloud/api/storage/9d508e10-0423-4c93-b04f-897163ca2bcf)\n\n![task-detail-page-cmux-sandbox-1.png](https://adorable-wombat-701.convex.cloud/api/storage/9d03b662-0bce-4171-8498-5a2160911774)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"8ee6dc89151e7e70b2682477646b6a51463bdb70","createdAt":"2025-12-01T23:21:40Z","updatedAt":"2025-12-01T23:23:11Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1040#issuecomment-3599402019"},{"type":"issue_comment","id":3599405985,"prNumber":1040,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\n\n\nCaptured 8 screenshots for commit `9e5677d` (2025-12-01 23:23:08.115 UTC).\n\n**Cloud mode toggle switch - now always visible (previously hidden in web mode)**\n\n![dashboard-cloud-mode-switch-cmux-sandbox-1.png](https://famous-camel-162.convex.cloud/api/storage/4639ceaa-16d7-4514-aac7-fc7dda0af292)\n\n**Main dashboard view showing task input area, project selector, agent selector, cloud mode toggle, and task lists (Workspaces, Ready to review, In progress, Merged sections)**\n\n![dashboard-main-view-cmux-sandbox-1.png](https://famous-camel-162.convex.cloud/api/storage/f3351950-19cc-4928-9928-3a4452930601)\n\n**Task description input controls with text editor**\n\n![dashboard-task-input-controls-cmux-sandbox-1.png](https://famous-camel-162.convex.cloud/api/storage/81b5601b-6f69-46c3-b4f6-3853ec364fa7)\n\n**Pull request view page showing PR header with title, status, merge buttons, and GitHub link**\n\n![pr-view-page-cmux-sandbox-1.png](https://famous-camel-162.convex.cloud/api/storage/a519d4bb-321e-48ee-86cf-8cf51fc32a55)\n\n**Container Management section - now visible (previously hidden in web mode), includes settings for automatic cleanup, max running containers, stop on completion, keep recent containers, and review period**\n\n![settings-container-management-section-cmux-sandbox-1.png](https://famous-camel-162.convex.cloud/api/storage/5ca380e2-6295-4f16-b66a-a84fd4c7a7d7)\n\n**Full settings page showing Team Name, Team URL, Appearance, Crown Evaluator, Worktree Location, AI Provider Authentication (with API keys for Anthropic, OpenAI, AMP, OpenRouter, Gemini, Alibaba Cloud, Cursor), Provider Status, and Container Management sections**\n\n![settings-page-cmux-sandbox-1.png](https://famous-camel-162.convex.cloud/api/storage/74ac5bdb-d535-492e-87e2-38bb58911a0f)\n\n**Provider Status section - now visible (previously hidden in web mode), shows loading status of various providers**\n\n![settings-provider-status-section-cmux-sandbox-1.png](https://famous-camel-162.convex.cloud/api/storage/f3f755c5-53ff-4e28-8505-800ff8973eb7)\n\n**Worktree Location section - now visible (previously hidden in web mode), allows users to specify custom git worktree path**\n\n![settings-worktree-location-section-cmux-sandbox-1.png](https://famous-camel-162.convex.cloud/api/storage/e1b1f43f-4e13-4383-8093-8319856cea53)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"8ee6dc89151e7e70b2682477646b6a51463bdb70","createdAt":"2025-12-01T23:23:11Z","updatedAt":"2025-12-01T23:23:11Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1040#issuecomment-3599405985"}]}
{"number":1034,"title":"chore: bump convex to 1.29.3","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1034","headRef":"codex/upgrade-convex-to-version-1.29.3","headSha":"132dce61b74a97cd412ca0a510eb2cfe75f253db","baseRef":"main","baseSha":"bee6cb86428706de97fd7b74670efe843234dfe6","createdAt":"2025-11-22T05:42:14Z","updatedAt":"2025-11-22T06:04:31Z","diff":"diff --git a/apps/client/package.json b/apps/client/package.json\nindex 9ffaff11d..079351ed4 100644\n--- a/apps/client/package.json\n+++ b/apps/client/package.json\n@@ -106,7 +106,7 @@\n     \"class-variance-authority\": \"^0.7.1\",\n     \"clsx\": \"^2.1.1\",\n     \"cmdk\": \"^1.1.1\",\n-    \"convex\": \"1.27.1\",\n+    \"convex\": \"1.29.3\",\n     \"date-fns\": \"^4.1.0\",\n     \"debug\": \"^4.4.1\",\n     \"diff\": \"^8.0.2\",\ndiff --git a/apps/preview-proxy/package.json b/apps/preview-proxy/package.json\nindex 5b2a878d1..7586e580b 100644\n--- a/apps/preview-proxy/package.json\n+++ b/apps/preview-proxy/package.json\n@@ -11,7 +11,7 @@\n   },\n   \"dependencies\": {\n     \"bun-plugin-tailwind\": \"^0.0.15\",\n-    \"convex\": \"1.27.1\",\n+    \"convex\": \"1.29.3\",\n     \"lucide-react\": \"^0.540.0\",\n     \"react\": \"^19.1.0\",\n     \"react-dom\": \"^19.1.0\",\ndiff --git a/apps/server/package.json b/apps/server/package.json\nindex 347a6a93c..3d9e92c2f 100644\n--- a/apps/server/package.json\n+++ b/apps/server/package.json\n@@ -67,7 +67,7 @@\n     \"ansi-escape-sequences\": \"^6.2.4\",\n     \"archiver\": \"^7.0.1\",\n     \"chokidar\": \"^4.0.3\",\n-    \"convex\": \"1.27.1\",\n+    \"convex\": \"1.29.3\",\n     \"dockerode\": \"^4.0.2\",\n     \"dotenv\": \"^16.6.1\",\n     \"electron\": \"^38.2.2\",\ndiff --git a/apps/www/package.json b/apps/www/package.json\nindex 2d8cc03ca..961351fd5 100644\n--- a/apps/www/package.json\n+++ b/apps/www/package.json\n@@ -42,7 +42,7 @@\n     \"ai\": \"^5.0.82\",\n     \"class-variance-authority\": \"^0.7.1\",\n     \"clsx\": \"^2.1.1\",\n-    \"convex\": \"^1.27.1\",\n+    \"convex\": \"^1.29.3\",\n     \"hono\": \"^4.9.1\",\n     \"jose\": \"^6.1.0\",\n     \"lucide-react\": \"^0.460.0\",\ndiff --git a/bun.lock b/bun.lock\nindex e65a9d414..c1a53b677 100644\n--- a/bun.lock\n+++ b/bun.lock\n@@ -28,7 +28,7 @@\n     },\n     \"apps/client\": {\n       \"name\": \"@cmux/client\",\n-      \"version\": \"1.0.178\",\n+      \"version\": \"1.0.179\",\n       \"dependencies\": {\n         \"@base-ui-components/react\": \"1.0.0-beta.2\",\n         \"@cmux/convex\": \"workspace:*\",\n@@ -105,7 +105,7 @@\n         \"class-variance-authority\": \"^0.7.1\",\n         \"clsx\": \"^2.1.1\",\n         \"cmdk\": \"^1.1.1\",\n-        \"convex\": \"1.27.1\",\n+        \"convex\": \"1.29.3\",\n         \"date-fns\": \"^4.1.0\",\n         \"debug\": \"^4.4.1\",\n         \"diff\": \"^8.0.2\",\n@@ -202,7 +202,7 @@\n       \"version\": \"0.1.0\",\n       \"dependencies\": {\n         \"bun-plugin-tailwind\": \"^0.0.15\",\n-        \"convex\": \"1.27.1\",\n+        \"convex\": \"1.29.3\",\n         \"lucide-react\": \"^0.540.0\",\n         \"react\": \"^19.1.0\",\n         \"react-dom\": \"^19.1.0\",\n@@ -234,7 +234,7 @@\n         \"ansi-escape-sequences\": \"^6.2.4\",\n         \"archiver\": \"^7.0.1\",\n         \"chokidar\": \"^4.0.3\",\n-        \"convex\": \"1.27.1\",\n+        \"convex\": \"1.29.3\",\n         \"dockerode\": \"^4.0.2\",\n         \"dotenv\": \"^16.6.1\",\n         \"electron\": \"^38.2.2\",\n@@ -327,7 +327,7 @@\n         \"ai\": \"^5.0.82\",\n         \"class-variance-authority\": \"^0.7.1\",\n         \"clsx\": \"^2.1.1\",\n-        \"convex\": \"^1.27.1\",\n+        \"convex\": \"^1.29.3\",\n         \"hono\": \"^4.9.1\",\n         \"jose\": \"^6.1.0\",\n         \"lucide-react\": \"^0.460.0\",\n@@ -375,7 +375,7 @@\n         \"@cmux/server\": \"workspace:*\",\n         \"@cmux/shared\": \"workspace:*\",\n         \"commander\": \"^11.1.0\",\n-        \"convex\": \"1.27.1\",\n+        \"convex\": \"1.29.3\",\n         \"cors\": \"^2.8.5\",\n         \"express\": \"^4.18.2\",\n         \"socket.io\": \"^4.7.2\",\n@@ -405,7 +405,7 @@\n         \"@stackframe/stack\": \"^2.8.48\",\n         \"@t3-oss/env-core\": \"^0.13.8\",\n         \"ai\": \"^5.0.51\",\n-        \"convex\": \"1.27.1\",\n+        \"convex\": \"1.29.3\",\n         \"convex-helpers\": \"^0.1.104\",\n         \"jose\": \"^6.0.7\",\n         \"octokit\": \"^5.0.5\",\n@@ -437,7 +437,7 @@\n       \"version\": \"1.0.0\",\n       \"dependencies\": {\n         \"@cmux/convex\": \"workspace:*\",\n-        \"convex\": \"1.27.1\",\n+        \"convex\": \"1.29.3\",\n         \"jose\": \"^6.1.0\",\n         \"socket.io-client\": \"^4.8.1\",\n         \"zod\": \"^4.1.5\",\n@@ -496,7 +496,7 @@\n         \"@openai/codex-sdk\": \"^0.46.0\",\n         \"@stackframe/js\": \"^2.8.48\",\n         \"commander\": \"^12.1.0\",\n-        \"convex\": \"^1.27.1\",\n+        \"convex\": \"^1.29.3\",\n         \"dotenv\": \"^16.6.1\",\n         \"ignore\": \"^6.0.2\",\n         \"morphcloud\": \"^0.0.18\",\n@@ -514,7 +514,7 @@\n     },\n   },\n   \"overrides\": {\n-    \"convex\": \"1.27.1\",\n+    \"convex\": \"1.29.3\",\n     \"monaco-editor\": \"^0.53.0\",\n     \"node-abi\": \"^4.14.0\",\n     \"react\": \"^19.1.0\",\n@@ -2973,7 +2973,7 @@\n \n     \"convert-source-map\": [\"convert-source-map@2.0.0\", \"\", {}, \"sha512-Kvp459HrV2FEJ1CAsi1Ku+MY3kasH19TFykTz2xWmMeq6bk2NU3XXvfJ+Q61m0xktWwt+1HSYf3JZsTms3aRJg==\"],\n \n-    \"convex\": [\"convex@1.27.1\", \"\", { \"dependencies\": { \"esbuild\": \"0.25.4\", \"jwt-decode\": \"^4.0.0\", \"prettier\": \"^3.0.0\" }, \"peerDependencies\": { \"@auth0/auth0-react\": \"^2.0.1\", \"@clerk/clerk-react\": \"^4.12.8 || ^5.0.0\", \"react\": \"^18.0.0 || ^19.0.0-0 || ^19.0.0\" }, \"optionalPeers\": [\"@auth0/auth0-react\", \"@clerk/clerk-react\", \"react\"], \"bin\": { \"convex\": \"bin/main.js\" } }, \"sha512-kep7JFn5Bil9/OUZUsL1bgoo0G9DmEf7stkBW67+NqP2FrzBt2TX8yz4V6oKLygzepGy90Ura2FtqXawYKXYIg==\"],\n+    \"convex\": [\"convex@1.29.3\", \"\", { \"dependencies\": { \"esbuild\": \"0.25.4\", \"prettier\": \"^3.0.0\" }, \"peerDependencies\": { \"@auth0/auth0-react\": \"^2.0.1\", \"@clerk/clerk-react\": \"^4.12.8 || ^5.0.0\", \"react\": \"^18.0.0 || ^19.0.0-0 || ^19.0.0\" }, \"optionalPeers\": [\"@auth0/auth0-react\", \"@clerk/clerk-react\", \"react\"], \"bin\": { \"convex\": \"bin/main.js\" } }, \"sha512-tg5TXzMjpNk9m50YRtdp6US+t7ckxE4E+7DNKUCjJ2MupQs2RBSPF/z5SNN4GUmQLSfg0eMILDySzdAvjTrhnw==\"],\n \n     \"convex-helpers\": [\"convex-helpers@0.1.104\", \"\", { \"peerDependencies\": { \"@standard-schema/spec\": \"^1.0.0\", \"convex\": \"^1.24.0\", \"hono\": \"^4.0.5\", \"react\": \"^17.0.2 || ^18.0.0 || ^19.0.0\", \"typescript\": \"^5.5\", \"zod\": \"^3.22.4 || ^4.0.15\" }, \"optionalPeers\": [\"@standard-schema/spec\", \"hono\", \"react\", \"typescript\", \"zod\"], \"bin\": { \"convex-helpers\": \"bin.cjs\" } }, \"sha512-7CYvx7T3K6n+McDTK4ZQaQNNGBzq5aWezpjzsKbOxPXx7oNcTP9wrpef3JxeXWFzkByJv5hRCjseh9B7eNJ7Ig==\"],\n \n@@ -5527,6 +5527,8 @@\n \n     \"builder-util/fs-extra\": [\"fs-extra@10.1.0\", \"\", { \"dependencies\": { \"graceful-fs\": \"^4.2.0\", \"jsonfile\": \"^6.0.1\", \"universalify\": \"^2.0.0\" } }, \"sha512-oRXApq54ETRj4eMiFzGnHWGy+zo5raudjuxN0b8H7s/RU2oW0Wvsx9O0ACRN/kRq9E8Vu/ReskGB5o3ji+FzHQ==\"],\n \n+    \"bun-react-template/@types/bun\": [\"@types/bun@1.3.3\", \"\", { \"dependencies\": { \"bun-types\": \"1.3.3\" } }, \"sha512-ogrKbJ2X5N0kWLLFKeytG0eHDleBYtngtlbu9cyBKFtNL3cnpDZkNdQj8flVf6WTZUX5ulI9AY1oa7ljhSrp+g==\"],\n+\n     \"bun-react-template/lucide-react\": [\"lucide-react@0.540.0\", \"\", { \"peerDependencies\": { \"react\": \"^16.5.1 || ^17.0.0 || ^18.0.0 || ^19.0.0\" } }, \"sha512-armkCAqQvO62EIX4Hq7hqX/q11WSZu0Jd23cnnqx0/49yIxGXyL/zyZfBxNN9YDx0ensPTb4L+DjTh3yQXUxtQ==\"],\n \n     \"bun-types/@types/node\": [\"@types/node@24.7.2\", \"\", { \"dependencies\": { \"undici-types\": \"~7.14.0\" } }, \"sha512-/NbVmcGTP+lj5oa4yiYxxeBjRivKQ5Ns1eSZeB99ExsEQ6rX5XYU1Zy/gGxY/ilqtD4Etx9mKyrPxZRetiahhA==\"],\n@@ -5571,6 +5573,8 @@\n \n     \"clone-response/mimic-response\": [\"mimic-response@1.0.1\", \"\", {}, \"sha512-j5EctnkH7amfV/q5Hgmoal1g2QHFJRraOtmx0JpIqkxhBhI/lJSl1nMpQ45hVarwNETOoWEimndZ4QK0RHxuxQ==\"],\n \n+    \"cmux/@types/bun\": [\"@types/bun@1.3.3\", \"\", { \"dependencies\": { \"bun-types\": \"1.3.3\" } }, \"sha512-ogrKbJ2X5N0kWLLFKeytG0eHDleBYtngtlbu9cyBKFtNL3cnpDZkNdQj8flVf6WTZUX5ulI9AY1oa7ljhSrp+g==\"],\n+\n     \"cmux/commander\": [\"commander@11.1.0\", \"\", {}, \"sha512-yPVavfyCcRhmorC7rWlkHn15b4wDVgVmBA7kV4QVBsF7kv/9TKJAbAXVTxvTnwP8HHKjRCJDClKbciiYS7p0DQ==\"],\n \n     \"cmux-vscode-extension/ajv\": [\"ajv@8.17.1\", \"\", { \"dependencies\": { \"fast-deep-equal\": \"^3.1.3\", \"fast-uri\": \"^3.0.1\", \"json-schema-traverse\": \"^1.0.0\", \"require-from-string\": \"^2.0.2\" } }, \"sha512-B/gBuNg5SiMTrPkC+A2+cW0RszwxYmn6VYxB/inlBStS5nx6xHIt/ehKRhIMhqusl7a8LjQoZnjCs5vhwxOQ1g==\"],\n@@ -6281,6 +6285,8 @@\n \n     \"body-parser/debug/ms\": [\"ms@2.0.0\", \"\", {}, \"sha512-Tpp60P6IUJDTuOq/5Z8cdskzJujfwqfOTkrwIwj7IRISpnkJnT6SyJ4PCPnGMoFjC9ddhal5KVIYtAt97ix05A==\"],\n \n+    \"bun-react-template/@types/bun/bun-types\": [\"bun-types@1.3.3\", \"\", { \"dependencies\": { \"@types/node\": \"*\" } }, \"sha512-z3Xwlg7j2l9JY27x5Qn3Wlyos8YAp0kKRlrePAOjgjMGS5IG6E7Jnlx736vH9UVI4wUICwwhC9anYL++XeOgTQ==\"],\n+\n     \"bun-types/@types/node/undici-types\": [\"undici-types@7.14.0\", \"\", {}, \"sha512-QQiYxHuyZ9gQUIrmPo3IA+hUl4KYk8uSA7cHrcKd/l3p1OTpZcM0Tbp9x7FAtXdAYhlasd60ncPpgu6ihG6TOA==\"],\n \n     \"cacache/glob/minimatch\": [\"minimatch@5.1.6\", \"\", { \"dependencies\": { \"brace-expansion\": \"^2.0.1\" } }, \"sha512-lKwV/1brpG6mBUFHtb7NUmtABCb2WZZmm2wNiOA5hAb8VdCS4B3dtMWyvcoViccwAW/COERjXLt0zP1zXUN26g==\"],\n@@ -6305,6 +6311,8 @@\n \n     \"cmux-vscode-extension/ajv/json-schema-traverse\": [\"json-schema-traverse@1.0.0\", \"\", {}, \"sha512-NM8/P9n3XjXhIZn1lLhkFaACTOURQXjWhV4BA/RnOv8xvgqtqpAX9IO4mRQxSx1Rlo4tqzeqb0sOlruaOy3dug==\"],\n \n+    \"cmux/@types/bun/bun-types\": [\"bun-types@1.3.3\", \"\", { \"dependencies\": { \"@types/node\": \"*\" } }, \"sha512-z3Xwlg7j2l9JY27x5Qn3Wlyos8YAp0kKRlrePAOjgjMGS5IG6E7Jnlx736vH9UVI4wUICwwhC9anYL++XeOgTQ==\"],\n+\n     \"color/color-convert/color-name\": [\"color-name@1.1.4\", \"\", {}, \"sha512-dOy+3AuW3a2wNbZHIuMZpTcgjGuLU/uBL/ubcZF9OXbDo8ff4O8yVp5Bf0efS8uEoYo5q4Fx7dY9OgQGXgAsQA==\"],\n \n     \"concat-stream/readable-stream/safe-buffer\": [\"safe-buffer@5.1.2\", \"\", {}, \"sha512-Gd2UZBJDkXlY7GbJxfsE8/nvKkUEU1G38c1siN6QP6a9PT9MmHB8GnpscSmMJSoF8LOIrt8ud/wPtojys4G6+g==\"],\ndiff --git a/package.json b/package.json\nindex 8b5bc041d..e3ccac4b3 100644\n--- a/package.json\n+++ b/package.json\n@@ -24,7 +24,7 @@\n     \"react\": \"^19.1.0\",\n     \"react-dom\": \"^19.1.0\",\n     \"monaco-editor\": \"^0.53.0\",\n-    \"convex\": \"1.27.1\"\n+    \"convex\": \"1.29.3\"\n   },\n   \"private\": true,\n   \"scripts\": {\ndiff --git a/packages/cmux/package.json b/packages/cmux/package.json\nindex f3038ab15..8a8eb57cc 100644\n--- a/packages/cmux/package.json\n+++ b/packages/cmux/package.json\n@@ -49,7 +49,7 @@\n     \"@cmux/server\": \"workspace:*\",\n     \"@cmux/shared\": \"workspace:*\",\n     \"commander\": \"^11.1.0\",\n-    \"convex\": \"1.27.1\",\n+    \"convex\": \"1.29.3\",\n     \"cors\": \"^2.8.5\",\n     \"express\": \"^4.18.2\",\n     \"socket.io\": \"^4.7.2\"\ndiff --git a/packages/convex/package.json b/packages/convex/package.json\nindex 0bf7d7f77..f290b8e56 100644\n--- a/packages/convex/package.json\n+++ b/packages/convex/package.json\n@@ -35,7 +35,7 @@\n     \"@stackframe/stack\": \"^2.8.48\",\n     \"@t3-oss/env-core\": \"^0.13.8\",\n     \"ai\": \"^5.0.51\",\n-    \"convex\": \"1.27.1\",\n+    \"convex\": \"1.29.3\",\n     \"convex-helpers\": \"^0.1.104\",\n     \"jose\": \"^6.0.7\",\n     \"octokit\": \"^5.0.5\",\ndiff --git a/packages/shared/package.json b/packages/shared/package.json\nindex a0e13717d..808b261b5 100644\n--- a/packages/shared/package.json\n+++ b/packages/shared/package.json\n@@ -101,7 +101,7 @@\n   },\n   \"dependencies\": {\n     \"@cmux/convex\": \"workspace:*\",\n-    \"convex\": \"1.27.1\",\n+    \"convex\": \"1.29.3\",\n     \"jose\": \"^6.1.0\",\n     \"zod\": \"^4.1.5\",\n     \"socket.io-client\": \"^4.8.1\"\ndiff --git a/scripts/package.json b/scripts/package.json\nindex d24b6a516..e122a079c 100644\n--- a/scripts/package.json\n+++ b/scripts/package.json\n@@ -15,7 +15,7 @@\n     \"@openai/codex-sdk\": \"^0.46.0\",\n     \"@stackframe/js\": \"^2.8.48\",\n     \"commander\": \"^12.1.0\",\n-    \"convex\": \"^1.27.1\",\n+    \"convex\": \"^1.29.3\",\n     \"dotenv\": \"^16.6.1\",\n     \"ignore\": \"^6.0.2\",\n     \"morphcloud\": \"^0.0.18\",\n","comments":[{"type":"issue_comment","id":3565739993,"prNumber":1034,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 1 screenshot(s) for commit `132dce6`:\n\n### error-page-HEAD.png\n![error-page-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/180bb26d-b3c9-4630-a63e-25a753f22f08)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"132dce61b74a97cd412ca0a510eb2cfe75f253db","createdAt":"2025-11-22T05:51:20Z","updatedAt":"2025-11-22T05:51:20Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1034#issuecomment-3565739993"}]}
{"number":1033,"title":"Remove redundant router tsx file","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1033","headRef":"codex/add-tanstack-router-to-sentry-integration-8oyftf","headSha":"d8277065ebd0c3b38f7f62e7581ed528b11adfae","baseRef":"main","baseSha":"b34cec59dfaef7d75a9a4332c500f7dee6d3e4cd","createdAt":"2025-11-21T23:04:30Z","updatedAt":"2025-11-21T23:10:56Z","diff":"diff --git a/apps/client/src/app.tsx b/apps/client/src/app.tsx\nindex b282a3e46..87eae71c8 100644\n--- a/apps/client/src/app.tsx\n+++ b/apps/client/src/app.tsx\n@@ -1,5 +1,5 @@\n import { Providers } from \"./providers\";\n-import { RouterProviderWithAuth } from \"./router\";\n+import { RouterProviderWithAuth } from \"./router-provider\";\n \n import \"./antd-overrides.css\";\n import \"./zindex.css\";\ndiff --git a/apps/client/src/main-electron.tsx b/apps/client/src/main-electron.tsx\nindex 0edbd0a22..2bdb2bf47 100644\n--- a/apps/client/src/main-electron.tsx\n+++ b/apps/client/src/main-electron.tsx\n@@ -1,13 +1,18 @@\n import { init } from \"@sentry/electron/renderer\";\n-import { init as reactInit } from \"@sentry/react\";\n+import {\n+  init as reactInit,\n+  tanstackRouterBrowserTracingIntegration,\n+} from \"@sentry/react\";\n import { SENTRY_ELECTRON_DSN } from \"./sentry-config.ts\";\n+import { router } from \"./router\";\n \n init(\n   {\n     dsn: SENTRY_ELECTRON_DSN,\n-    integrations: [\n-      /* integrations */\n-    ],\n+    integrations: [tanstackRouterBrowserTracingIntegration(router)],\n+    // Setting a sample rate is required for sending performance data.\n+    // Adjust this value in production or use tracesSampler for finer control.\n+    tracesSampleRate: 1.0,\n   },\n   reactInit\n );\ndiff --git a/apps/client/src/main.tsx b/apps/client/src/main.tsx\nindex 22d70f7e3..433d8eaf0 100644\n--- a/apps/client/src/main.tsx\n+++ b/apps/client/src/main.tsx\n@@ -1,11 +1,13 @@\n-import { init } from \"@sentry/react\";\n+import { init, tanstackRouterBrowserTracingIntegration } from \"@sentry/react\";\n+import { router } from \"./router\";\n import { SENTRY_WEB_DSN } from \"./sentry-config\";\n+\n init({\n   dsn: SENTRY_WEB_DSN,\n-  integrations: [\n-    /* integrations */\n-  ],\n-  /* Other Electron and React SDK config */\n+  integrations: [tanstackRouterBrowserTracingIntegration(router)],\n+  // Setting a sample rate is required for sending performance data.\n+  // Adjust this value in production or use tracesSampler for finer control.\n+  tracesSampleRate: 1.0,\n });\n \n import { StrictMode } from \"react\";\ndiff --git a/apps/client/src/router-provider.tsx b/apps/client/src/router-provider.tsx\nnew file mode 100644\nindex 000000000..ad76ea7a5\n--- /dev/null\n+++ b/apps/client/src/router-provider.tsx\n@@ -0,0 +1,9 @@\n+import { useStackApp } from \"@stackframe/react\";\n+import { RouterProvider } from \"@tanstack/react-router\";\n+import { queryClient } from \"./query-client\";\n+import { router } from \"./router\";\n+\n+export function RouterProviderWithAuth() {\n+  const auth = useStackApp();\n+  return <RouterProvider router={router} context={{ queryClient, auth }} />;\n+}\ndiff --git a/apps/client/src/router.tsx b/apps/client/src/router.ts\nsimilarity index 69%\nrename from apps/client/src/router.tsx\nrename to apps/client/src/router.ts\nindex 290880d78..9b1ca3f0a 100644\n--- a/apps/client/src/router.tsx\n+++ b/apps/client/src/router.ts\n@@ -1,10 +1,5 @@\n import { isElectron } from \"@/lib/electron\";\n-import { useStackApp } from \"@stackframe/react\";\n-import {\n-  createHashHistory,\n-  createRouter as createTanStackRouter,\n-  RouterProvider,\n-} from \"@tanstack/react-router\";\n+import { createHashHistory, createRouter as createTanStackRouter } from \"@tanstack/react-router\";\n import { routerWithQueryClient } from \"@tanstack/react-router-with-query\";\n import { queryClient } from \"./query-client\";\n import { routeTree } from \"./routeTree.gen\";\n@@ -29,12 +24,7 @@ function createRouter() {\n   return router;\n }\n \n-const router = createRouter();\n-\n-export function RouterProviderWithAuth() {\n-  const auth = useStackApp();\n-  return <RouterProvider router={router} context={{ queryClient, auth }} />;\n-}\n+export const router = createRouter();\n \n declare module \"@tanstack/react-router\" {\n   interface Register {\n","comments":[{"type":"issue_comment","id":3564933279,"prNumber":1033,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 1 screenshot(s) for commit `aa1efe7`:\n\n### sign-in-page-HEAD.png\n![sign-in-page-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/abc20765-ece6-449c-83bd-806ebe24db3f)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"d8277065ebd0c3b38f7f62e7581ed528b11adfae","createdAt":"2025-11-21T23:06:56Z","updatedAt":"2025-11-21T23:06:56Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1033#issuecomment-3564933279"},{"type":"issue_comment","id":3564942186,"prNumber":1033,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 5 screenshot(s) for commit `d827706`:\n\n### dashboard-full-page-HEAD.png\n![dashboard-full-page-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/326dc064-d930-46ac-9663-28fdd420e0ff)\n\n### debug-icon-page-HEAD.png\n![debug-icon-page-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/fd4602b7-2f8f-4de5-ab6e-e73dc52ebdca)\n\n### debug-monaco-page-HEAD.png\n![debug-monaco-page-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/8dca3a1a-617c-470d-b1f4-30c876f37615)\n\n### monaco-single-buffer-page-HEAD.png\n![monaco-single-buffer-page-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/ae47d282-e937-4c9d-b944-42e44e57fc05)\n\n### sign-in-page-HEAD.png\n![sign-in-page-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/c3a40157-64ee-4b34-81ef-5ec01713eb1c)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"d8277065ebd0c3b38f7f62e7581ed528b11adfae","createdAt":"2025-11-21T23:10:24Z","updatedAt":"2025-11-21T23:10:24Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1033#issuecomment-3564942186"}]}
{"number":1030,"title":"Add PostHog analytics to client app","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1030","headRef":"codex/add-posthog-to-apps/client","headSha":"b378c469e4e1608edfb8fe4a6003bd829c25d578","baseRef":"main","baseSha":"2a2340c7b11eccbe13d3c9c155d71b35d5154815","createdAt":"2025-11-21T22:13:38Z","updatedAt":"2025-11-22T03:14:26Z","diff":"diff --git a/apps/client/package.json b/apps/client/package.json\nindex e31dfbfbe..e6a0cce9a 100644\n--- a/apps/client/package.json\n+++ b/apps/client/package.json\n@@ -71,6 +71,7 @@\n     \"@lezer/highlight\": \"^1.2.1\",\n     \"@mantine/hooks\": \"^8.1.3\",\n     \"@monaco-editor/react\": \"^4.7.0\",\n+    \"@posthog/react\": \"^1.4.0\",\n     \"@radix-ui/react-dialog\": \"^1.1.6\",\n     \"@radix-ui/react-dropdown-menu\": \"^2.1.15\",\n     \"@radix-ui/react-popover\": \"^1.1.15\",\n@@ -130,6 +131,7 @@\n     \"monaco-editor\": \"^0.53.0\",\n     \"ms\": \"^2.1.3\",\n     \"node-forge\": \"^1.3.1\",\n+    \"posthog-js\": \"^1.297.2\",\n     \"prismjs\": \"^1.30.0\",\n     \"react\": \"^19.1.0\",\n     \"react-aria-components\": \"^1.12.1\",\ndiff --git a/apps/client/src/client-env.ts b/apps/client/src/client-env.ts\nindex cfe26fdfc..6f0e2c7b6 100644\n--- a/apps/client/src/client-env.ts\n+++ b/apps/client/src/client-env.ts\n@@ -15,6 +15,8 @@ export const env = createEnv({\n     NEXT_PUBLIC_GITHUB_APP_SLUG: z.string().optional(),\n     NEXT_PUBLIC_WWW_ORIGIN: z.string().min(1),\n     NEXT_PUBLIC_SERVER_ORIGIN: z.string().optional(),\n+    NEXT_PUBLIC_POSTHOG_KEY: z.string().optional(),\n+    NEXT_PUBLIC_POSTHOG_HOST: z.string().optional(),\n   },\n \n   /**\ndiff --git a/apps/client/src/lib/analytics/posthog.ts b/apps/client/src/lib/analytics/posthog.ts\nnew file mode 100644\nindex 000000000..910f1a4e1\n--- /dev/null\n+++ b/apps/client/src/lib/analytics/posthog.ts\n@@ -0,0 +1,78 @@\n+import posthog from \"posthog-js\";\n+import { env } from \"@/client-env\";\n+import { isElectron } from \"../electron\";\n+\n+const DEFAULT_API_HOST = \"https://us.i.posthog.com\";\n+const DEFAULT_UI_HOST = \"https://us.posthog.com\";\n+\n+let initialized = false;\n+\n+function registerPlatform() {\n+  posthog.register({\n+    platform: isElectron ? \"cmux-client-electron\" : \"cmux-client-web\",\n+  });\n+}\n+\n+interface PosthogUserProperties {\n+  email?: string;\n+  name?: string;\n+  team_id?: string;\n+}\n+\n+export function initPosthog() {\n+  if (initialized) {\n+    return posthog;\n+  }\n+\n+  if (!env.NEXT_PUBLIC_POSTHOG_KEY) {\n+    return null;\n+  }\n+\n+  const apiHost = env.NEXT_PUBLIC_POSTHOG_HOST ?? DEFAULT_API_HOST;\n+\n+  posthog.init(env.NEXT_PUBLIC_POSTHOG_KEY, {\n+    api_host: apiHost,\n+    ui_host: env.NEXT_PUBLIC_POSTHOG_HOST ? undefined : DEFAULT_UI_HOST,\n+    capture_pageview: \"history_change\",\n+    capture_pageleave: true,\n+    autocapture: true,\n+    debug: import.meta.env.DEV,\n+    defaults: \"2025-05-24\",\n+    disable_surveys: true,\n+  });\n+\n+  registerPlatform();\n+\n+  initialized = true;\n+  return posthog;\n+}\n+\n+export function getPosthogClient() {\n+  if (initialized) {\n+    return posthog;\n+  }\n+\n+  return initPosthog();\n+}\n+\n+export function identifyPosthogUser(\n+  id: string,\n+  properties: PosthogUserProperties\n+) {\n+  const client = getPosthogClient();\n+  if (!client) {\n+    return;\n+  }\n+\n+  client.identify(id, properties);\n+}\n+\n+export function resetPosthog() {\n+  if (!initialized) {\n+    return;\n+  }\n+\n+  posthog.reset();\n+\n+  registerPlatform();\n+}\ndiff --git a/apps/client/src/routes/__root.tsx b/apps/client/src/routes/__root.tsx\nindex 38825bd26..5ed078099 100644\n--- a/apps/client/src/routes/__root.tsx\n+++ b/apps/client/src/routes/__root.tsx\n@@ -122,19 +122,18 @@ function RootComponent() {\n   const location = useRouterState({\n     select: (state) => state.location,\n   });\n+  const locationKey = `${location.pathname}${location.search}${location.hash}`;\n \n   useAutoUpdateNotifications();\n \n   useEffect(() => {\n     if (import.meta.env.DEV) {\n       console.log(\"[navigation] location-changed\", {\n-        pathname: location.pathname,\n-        search: location.search,\n-        hash: location.hash,\n+        location: locationKey,\n         timestamp: new Date().toISOString(),\n       });\n     }\n-  }, [location]);\n+  }, [locationKey]);\n \n   return (\n     <>\ndiff --git a/apps/client/src/routes/_layout.tsx b/apps/client/src/routes/_layout.tsx\nindex 23c3a71ec..975a054fd 100644\n--- a/apps/client/src/routes/_layout.tsx\n+++ b/apps/client/src/routes/_layout.tsx\n@@ -1,13 +1,24 @@\n import { convexAuthReadyPromise } from \"@/contexts/convex/convex-auth-ready\";\n import { ConvexClientProvider } from \"@/contexts/convex/convex-client-provider\";\n import { RealSocketProvider } from \"@/contexts/socket/real-socket-provider\";\n+import {\n+  identifyPosthogUser,\n+  initPosthog,\n+  resetPosthog,\n+} from \"@/lib/analytics/posthog\";\n import { cachedGetUser } from \"@/lib/cachedGetUser\";\n import { stackClientApp } from \"@/lib/stack\";\n-import { createFileRoute, Outlet, redirect } from \"@tanstack/react-router\";\n import {\n   localVSCodeServeWebQueryOptions,\n   useLocalVSCodeServeWebQuery,\n } from \"@/queries/local-vscode-serve-web\";\n+import { api } from \"@cmux/convex/api\";\n+import { PostHogProvider } from \"@posthog/react\";\n+import { useUser } from \"@stackframe/react\";\n+import { useMatch } from \"@tanstack/react-router\";\n+import { createFileRoute, Outlet, redirect } from \"@tanstack/react-router\";\n+import { useQuery } from \"convex/react\";\n+import { useEffect, useMemo, useRef } from \"react\";\n \n export const Route = createFileRoute(\"/_layout\")({\n   component: Layout,\n@@ -31,12 +42,58 @@ export const Route = createFileRoute(\"/_layout\")({\n   },\n });\n \n+function PosthogTracking() {\n+  const user = useUser({ or: \"return-null\" });\n+  const previousUserId = useRef<string | null>(null);\n+  const match = useMatch({\n+    from: \"/_layout/$teamSlugOrId\",\n+    shouldThrow: false,\n+  });\n+  const teamSlugOrId = match?.params.teamSlugOrId;\n+  const team = useQuery(\n+    api.teams.get,\n+    teamSlugOrId ? { teamSlugOrId } : \"skip\"\n+  );\n+  const teamId = team?.uuid;\n+\n+  useEffect(() => {\n+    if (!user) {\n+      if (previousUserId.current) {\n+        resetPosthog();\n+        previousUserId.current = null;\n+      }\n+      return;\n+    }\n+\n+    identifyPosthogUser(user.id, {\n+      email: user.primaryEmail ?? undefined,\n+      name: user.displayName ?? undefined,\n+      team_id: teamId ?? undefined,\n+    });\n+    previousUserId.current = user.id;\n+  }, [teamId, user]);\n+\n+  return null;\n+}\n+\n+function MaybePosthogProvider({ children }: { children: React.ReactNode }) {\n+  const posthogClient = useMemo(() => initPosthog(), []);\n+  if (!posthogClient) {\n+    return children;\n+  }\n+  return <PostHogProvider client={posthogClient}>{children}</PostHogProvider>;\n+}\n+\n function Layout() {\n   useLocalVSCodeServeWebQuery();\n+\n   return (\n     <ConvexClientProvider>\n       <RealSocketProvider>\n-        <Outlet />\n+        <MaybePosthogProvider>\n+          <PosthogTracking />\n+          <Outlet />\n+        </MaybePosthogProvider>\n       </RealSocketProvider>\n     </ConvexClientProvider>\n   );\ndiff --git a/apps/www/instrumentation-client.ts b/apps/www/instrumentation-client.ts\nindex fc9a44954..175431a4b 100644\n--- a/apps/www/instrumentation-client.ts\n+++ b/apps/www/instrumentation-client.ts\n@@ -42,10 +42,13 @@ if (posthogKey) {\n   posthog.init(posthogKey, {\n     api_host: \"/iiiii\",\n     ui_host: \"https://us.posthog.com\",\n-    defaults: '2025-05-24',\n+    defaults: \"2025-05-24\",\n     capture_exceptions: true, // This enables capturing exceptions using Error Tracking, set to false if you don't want this\n     debug: process.env.NODE_ENV === \"development\",\n   });\n+  posthog.register({\n+    platform: \"cmux-www\",\n+  });\n }\n \n export const onRouterTransitionStart = Sentry.captureRouterTransitionStart;\ndiff --git a/apps/www/package.json b/apps/www/package.json\nindex 944fd8692..2d8cc03ca 100644\n--- a/apps/www/package.json\n+++ b/apps/www/package.json\n@@ -49,7 +49,7 @@\n     \"morphcloud\": \"^0.0.18\",\n     \"next\": \"15.5.2\",\n     \"octokit\": \"^3.2.2\",\n-    \"posthog-js\": \"^1.285.1\",\n+    \"posthog-js\": \"^1.297.2\",\n     \"posthog-node\": \"^5.11.0\",\n     \"react\": \"^19.1.0\",\n     \"react-diff-view\": \"^3.3.2\",\ndiff --git a/bun.lock b/bun.lock\nindex 93c0a95c2..e65a9d414 100644\n--- a/bun.lock\n+++ b/bun.lock\n@@ -28,7 +28,7 @@\n     },\n     \"apps/client\": {\n       \"name\": \"@cmux/client\",\n-      \"version\": \"1.0.174\",\n+      \"version\": \"1.0.178\",\n       \"dependencies\": {\n         \"@base-ui-components/react\": \"1.0.0-beta.2\",\n         \"@cmux/convex\": \"workspace:*\",\n@@ -70,6 +70,7 @@\n         \"@lezer/highlight\": \"^1.2.1\",\n         \"@mantine/hooks\": \"^8.1.3\",\n         \"@monaco-editor/react\": \"^4.7.0\",\n+        \"@posthog/react\": \"^1.4.0\",\n         \"@radix-ui/react-dialog\": \"^1.1.6\",\n         \"@radix-ui/react-dropdown-menu\": \"^2.1.15\",\n         \"@radix-ui/react-popover\": \"^1.1.15\",\n@@ -129,6 +130,7 @@\n         \"monaco-editor\": \"^0.53.0\",\n         \"ms\": \"^2.1.3\",\n         \"node-forge\": \"^1.3.1\",\n+        \"posthog-js\": \"^1.297.2\",\n         \"prismjs\": \"^1.30.0\",\n         \"react\": \"^19.1.0\",\n         \"react-aria-components\": \"^1.12.1\",\n@@ -332,7 +334,7 @@\n         \"morphcloud\": \"^0.0.18\",\n         \"next\": \"15.5.2\",\n         \"octokit\": \"^3.2.2\",\n-        \"posthog-js\": \"^1.285.1\",\n+        \"posthog-js\": \"^1.297.2\",\n         \"posthog-node\": \"^5.11.0\",\n         \"react\": \"^19.1.0\",\n         \"react-diff-view\": \"^3.3.2\",\n@@ -1571,7 +1573,9 @@\n \n     \"@playwright/mcp\": [\"@playwright/mcp@0.0.44\", \"\", { \"dependencies\": { \"playwright\": \"1.57.0-alpha-2025-10-24\", \"playwright-core\": \"1.57.0-alpha-2025-10-24\" }, \"bin\": { \"mcp-server-playwright\": \"cli.js\" } }, \"sha512-QkJd/qUxbw9MY5Vy5TMC6EmK2VSTBJ0+NOx/wTat5W7ycj8s19tweYRJI+33Ix8SMdf6aaG9pIaY0AZGfnK0oA==\"],\n \n-    \"@posthog/core\": [\"@posthog/core@1.5.0\", \"\", {}, \"sha512-oxfV20QMNwH30jKybUyqi3yGuMghULQz1zkJgQG3rjpHDxhD2vDN6E7UpmaqgphMIvGG3Q+DgfU10zfSPA7w7w==\"],\n+    \"@posthog/core\": [\"@posthog/core@1.5.5\", \"\", { \"dependencies\": { \"cross-spawn\": \"^7.0.6\" } }, \"sha512-m7G1EQTgo9xrr3lZxCp9C2egP99MSRpIDD95wYzwUPxMesKxI0xEQ+TC5LS/XOXIdmsNvsx4UcxwmzhSwD2GWA==\"],\n+\n+    \"@posthog/react\": [\"@posthog/react@1.4.0\", \"\", { \"peerDependencies\": { \"@types/react\": \">=16.8.0\", \"posthog-js\": \">=1.257.2\", \"react\": \">=16.8.0\" }, \"optionalPeers\": [\"@types/react\"] }, \"sha512-xzPeZ753fQ0deZzdgY/0YavZvNpmdaxUzLYJYu5XjONNcZ8PwJnNLEK+7D/Cj8UM4Q8nWI7QC5mjum0uLWa4FA==\"],\n \n     \"@prisma/instrumentation\": [\"@prisma/instrumentation@6.15.0\", \"\", { \"dependencies\": { \"@opentelemetry/instrumentation\": \"^0.52.0 || ^0.53.0 || ^0.54.0 || ^0.55.0 || ^0.56.0 || ^0.57.0\" }, \"peerDependencies\": { \"@opentelemetry/api\": \"^1.8\" } }, \"sha512-6TXaH6OmDkMOQvOxwLZ8XS51hU2v4A3vmE2pSijCIiGRJYyNeMcL6nMHQMyYdZRD8wl7LF3Wzc+AMPMV/9Oo7A==\"],\n \n@@ -4205,7 +4209,7 @@\n \n     \"postgres-interval\": [\"postgres-interval@1.2.0\", \"\", { \"dependencies\": { \"xtend\": \"^4.0.0\" } }, \"sha512-9ZhXKM/rw350N1ovuWHbGxnGh/SNJ4cnxHiM0rxE4VN41wsg8P8zWn9hv/buK00RP4WvlOyr/RBDiptyxVbkZQ==\"],\n \n-    \"posthog-js\": [\"posthog-js@1.285.1\", \"\", { \"dependencies\": { \"@posthog/core\": \"1.5.0\", \"core-js\": \"^3.38.1\", \"fflate\": \"^0.4.8\", \"preact\": \"^10.19.3\", \"web-vitals\": \"^4.2.4\" } }, \"sha512-+Cn3igI6LoOJuGtsiVsD15a0jGIaR1zE5tEG3Ovd4MLgti3RFHdS1eOisZTJUuQa2bR8X/Bx7HdoXsGNmW9h4Q==\"],\n+    \"posthog-js\": [\"posthog-js@1.297.2\", \"\", { \"dependencies\": { \"@posthog/core\": \"1.5.5\", \"core-js\": \"^3.38.1\", \"fflate\": \"^0.4.8\", \"preact\": \"^10.19.3\", \"web-vitals\": \"^4.2.4\" } }, \"sha512-pDtCKHpKegV1D5Yk9PBmkFwI9FMnLJm0TsBO5c5/PhPq5Om4y/t+1qqbNcLCdLajkuYl2px9UlRTzycQ6W7Vmw==\"],\n \n     \"posthog-node\": [\"posthog-node@5.11.0\", \"\", { \"dependencies\": { \"@posthog/core\": \"1.5.0\" } }, \"sha512-9+gmWp/7AEryJMi0+/ywJjKQhpkmcjxf+eT030fTIIPvFTF84zeeagdZBGNC/Nh2Jc0grIAW6O1n5lxXiX3daA==\"],\n \n@@ -5819,6 +5823,8 @@\n \n     \"plist/xmlbuilder\": [\"xmlbuilder@15.1.1\", \"\", {}, \"sha512-yMqGBqtXyeN1e3TGYvgNgDVZ3j84W4cwkOXQswghol6APgZWaff9lnbvN7MHYJOiXsvGPXtjTYJEiC9J2wv9Eg==\"],\n \n+    \"posthog-node/@posthog/core\": [\"@posthog/core@1.5.0\", \"\", {}, \"sha512-oxfV20QMNwH30jKybUyqi3yGuMghULQz1zkJgQG3rjpHDxhD2vDN6E7UpmaqgphMIvGG3Q+DgfU10zfSPA7w7w==\"],\n+\n     \"postject/commander\": [\"commander@9.5.0\", \"\", {}, \"sha512-KRs7WVDKg86PWiuAqhDrAQnTXZKraVcCc6vFdL14qrZ/DcWwuRo7VoiYXalXO7S5GKpqYiVEwCbgFDfxNHKJBQ==\"],\n \n     \"protobufjs/@types/node\": [\"@types/node@24.5.2\", \"\", { \"dependencies\": { \"undici-types\": \"~7.12.0\" } }, \"sha512-FYxk1I7wPv3K2XBaoyH2cTnocQEu8AOZ60hPbsyukMPLv5/5qr7V1i8PLHdl6Zf87I+xZXFvPCXYjiTFq+YSDQ==\"],\n","comments":[{"type":"issue_comment","id":3564810239,"prNumber":1030,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 1 screenshot(s) for commit `8269732`:\n\n### homepage-loading-HEAD.png\n![homepage-loading-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/fb323f04-f80b-441f-9bab-5e666abf509f)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"b378c469e4e1608edfb8fe4a6003bd829c25d578","createdAt":"2025-11-21T22:18:13Z","updatedAt":"2025-11-21T22:18:13Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1030#issuecomment-3564810239"},{"type":"issue_comment","id":3564985060,"prNumber":1030,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 1 screenshot(s) for commit `04cd458`:\n\n### sign-in-page-HEAD.png\n![sign-in-page-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/30dddce6-af92-4c78-b235-265794ba974a)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"b378c469e4e1608edfb8fe4a6003bd829c25d578","createdAt":"2025-11-21T23:31:57Z","updatedAt":"2025-11-21T23:31:57Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1030#issuecomment-3564985060"},{"type":"issue_comment","id":3565170634,"prNumber":1030,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 2 screenshot(s) for commit `5e62e68`:\n\n### error-hidden-HEAD.png\n![error-hidden-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/c2efd910-0c08-4d96-8b59-9b0b7f05b2c6)\n\n### error-state-HEAD.png\n![error-state-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/a0c65cb7-88ba-4608-ac9c-131a646a3e1a)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"b378c469e4e1608edfb8fe4a6003bd829c25d578","createdAt":"2025-11-22T00:52:46Z","updatedAt":"2025-11-22T00:52:46Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1030#issuecomment-3565170634"},{"type":"issue_comment","id":3565285929,"prNumber":1030,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 1 screenshot(s) for commit `8f53409`:\n\n### error-state-HEAD.png\n![error-state-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/4b1cfc91-a95e-483d-8380-860aeed31659)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"b378c469e4e1608edfb8fe4a6003bd829c25d578","createdAt":"2025-11-22T01:54:25Z","updatedAt":"2025-11-22T01:54:25Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1030#issuecomment-3565285929"}]}
{"number":1028,"title":"Revert \"Remove import repos button in repo picker\"","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1028","headRef":"revert-1027-cmux/remove-import-repos-button-in-repo-picker-o65u9","headSha":"e08852c28052d15b9f5fd7b5c717ecacf84fc861","baseRef":"main","baseSha":"f11db39998792aaefa7efa7c532f9c0440827af3","createdAt":"2025-11-21T14:45:34Z","updatedAt":"2025-11-21T21:10:50Z","diff":"diff --git a/apps/client/src/components/dashboard/DashboardInputControls.tsx b/apps/client/src/components/dashboard/DashboardInputControls.tsx\nindex ea82a540a..0f8285a44 100644\n--- a/apps/client/src/components/dashboard/DashboardInputControls.tsx\n+++ b/apps/client/src/components/dashboard/DashboardInputControls.tsx\n@@ -16,11 +16,13 @@ import { isElectron } from \"@/lib/electron\";\n import { api } from \"@cmux/convex/api\";\n import type { ProviderStatus, ProviderStatusResponse } from \"@cmux/shared\";\n import { AGENT_CONFIGS } from \"@cmux/shared/agentConfig\";\n+import { parseGithubRepoUrl } from \"@cmux/shared\";\n import { Link, useRouter } from \"@tanstack/react-router\";\n import clsx from \"clsx\";\n-import { useMutation } from \"convex/react\";\n-import { GitBranch, Image, Mic, Server, X } from \"lucide-react\";\n+import { useAction, useMutation } from \"convex/react\";\n+import { Check, GitBranch, Image, Link2, Mic, Server, X } from \"lucide-react\";\n import { memo, useCallback, useEffect, useMemo, useRef, useState } from \"react\";\n+import { toast } from \"sonner\";\n import { AgentCommandItem, MAX_AGENT_COMMAND_COUNT } from \"./AgentCommandItem\";\n \n interface DashboardInputControlsProps {\n@@ -72,6 +74,7 @@ export const DashboardInputControls = memo(function DashboardInputControls({\n   const router = useRouter();\n   const agentSelectRef = useRef<SearchableSelectHandle | null>(null);\n   const mintState = useMutation(api.github_app.mintInstallState);\n+  const addManualRepo = useAction(api.github_http.addManualRepo);\n   const providerStatusMap = useMemo(() => {\n     const map = new Map<string, ProviderStatus>();\n     providerStatus?.providers?.forEach((provider) => {\n@@ -223,6 +226,12 @@ export const DashboardInputControls = memo(function DashboardInputControls({\n   const pillboxScrollRef = useRef<HTMLDivElement | null>(null);\n   const [showPillboxFade, setShowPillboxFade] = useState(false);\n \n+  // Custom repo URL state\n+  const [showCustomRepoInput, setShowCustomRepoInput] = useState(false);\n+  const [customRepoUrl, setCustomRepoUrl] = useState(\"\");\n+  const [customRepoError, setCustomRepoError] = useState<string | null>(null);\n+  const [isAddingRepo, setIsAddingRepo] = useState(false);\n+\n   useEffect(() => {\n     const node = pillboxScrollRef.current;\n     if (!node) {\n@@ -289,6 +298,56 @@ export const DashboardInputControls = memo(function DashboardInputControls({\n     agentSelectRef.current?.open({ focusValue: agent });\n   }, []);\n \n+  const handleCustomRepoSubmit = useCallback(async () => {\n+    const trimmedUrl = customRepoUrl.trim();\n+\n+    // Validate URL format before sending to backend\n+    if (!trimmedUrl) {\n+      setCustomRepoError(\"Please enter a GitHub repository URL\");\n+      return;\n+    }\n+\n+    const parsed = parseGithubRepoUrl(trimmedUrl);\n+    if (!parsed) {\n+      setCustomRepoError(\"Invalid GitHub repository URL. Use format: owner/repo or https://github.com/owner/repo\");\n+      return;\n+    }\n+\n+    setIsAddingRepo(true);\n+    setCustomRepoError(null);\n+\n+    try {\n+      const result = await addManualRepo({\n+        teamSlugOrId,\n+        repoUrl: trimmedUrl,\n+      });\n+\n+      if (result.success) {\n+        // Set the repo as selected\n+        onProjectChange([result.fullName]);\n+\n+        // Clear the custom input\n+        setCustomRepoUrl(\"\");\n+        setCustomRepoError(null);\n+        setShowCustomRepoInput(false);\n+\n+        toast.success(`Added ${result.fullName} to repositories`);\n+      }\n+    } catch (error) {\n+      const errorMessage =\n+        error instanceof Error ? error.message : \"Failed to add repository\";\n+      setCustomRepoError(errorMessage);\n+      toast.error(errorMessage);\n+    } finally {\n+      setIsAddingRepo(false);\n+    }\n+  }, [customRepoUrl, addManualRepo, teamSlugOrId, onProjectChange]);\n+\n+  const handleCustomRepoInputChange = useCallback((value: string) => {\n+    setCustomRepoUrl(value);\n+    setCustomRepoError(null);\n+  }, []);\n+\n   const agentSelectionFooter = selectedAgents.length ? (\n     <div className=\"bg-neutral-50 dark:bg-neutral-900/70\">\n       <div className=\"relative\">\n@@ -491,6 +550,80 @@ export const DashboardInputControls = memo(function DashboardInputControls({\n                   <span className=\"select-none\">Add repos from GitHub</span>\n                 </button>\n               ) : null}\n+              <button\n+                type=\"button\"\n+                onClick={(e) => {\n+                  e.preventDefault();\n+                  setShowCustomRepoInput((prev) => !prev);\n+                  setCustomRepoError(null);\n+                }}\n+                className=\"w-full px-2 h-8 flex items-center gap-2 text-[13.5px] text-neutral-800 dark:text-neutral-200 rounded-md hover:bg-neutral-50 dark:hover:bg-neutral-900\"\n+              >\n+                <Link2 className=\"w-4 h-4 text-neutral-600 dark:text-neutral-300\" />\n+                <span className=\"select-none\">\n+                  {showCustomRepoInput ? \"Hide repo link menu\" : \"Import repos from link\"}\n+                </span>\n+              </button>\n+              {showCustomRepoInput ? (\n+                <div className=\"px-2 pb-2 pt-1\">\n+                  <div className=\"flex gap-1\">\n+                    <input\n+                      type=\"text\"\n+                      value={customRepoUrl}\n+                      onChange={(e) => handleCustomRepoInputChange(e.target.value)}\n+                      onKeyDown={(e) => {\n+                        if (e.key === \"Enter\") {\n+                          e.preventDefault();\n+                          void handleCustomRepoSubmit();\n+                        } else if (e.key === \"Escape\") {\n+                          setShowCustomRepoInput(false);\n+                          setCustomRepoUrl(\"\");\n+                          setCustomRepoError(null);\n+                        }\n+                      }}\n+                      placeholder=\"github.com/owner/repo\"\n+                      className={clsx(\n+                        \"flex-1 px-2 h-7 text-[13px] rounded border\",\n+                        \"bg-white dark:bg-neutral-800\",\n+                        \"border-neutral-300 dark:border-neutral-600\",\n+                        \"text-neutral-900 dark:text-neutral-100\",\n+                        \"placeholder:text-neutral-400 dark:placeholder:text-neutral-500\",\n+                        \"focus:outline-none focus:ring-1 focus:ring-blue-500\",\n+                        customRepoError ? \"border-red-500 dark:border-red-500\" : \"\"\n+                      )}\n+                      autoFocus\n+                    />\n+                    <button\n+                      type=\"button\"\n+                      onClick={handleCustomRepoSubmit}\n+                      disabled={isAddingRepo}\n+                      className={clsx(\n+                        \"px-2 h-7 flex items-center justify-center rounded\",\n+                        \"bg-blue-500 hover:bg-blue-600\",\n+                        \"text-white text-[12px] font-medium\",\n+                        \"transition-colors\",\n+                        \"disabled:opacity-50 disabled:cursor-not-allowed\"\n+                      )}\n+                      title=\"Add repository\"\n+                    >\n+                      {isAddingRepo ? (\n+                        <span className=\"w-3.5 h-3.5 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n+                      ) : (\n+                        <Check className=\"w-3.5 h-3.5\" />\n+                      )}\n+                    </button>\n+                  </div>\n+                  {customRepoError ? (\n+                    <p className=\"text-[11px] text-red-500 dark:text-red-400 mt-1 px-1\">\n+                      {customRepoError}\n+                    </p>\n+                  ) : (\n+                    <p className=\"text-[10px] text-neutral-500 dark:text-neutral-400 mt-1 px-1\">\n+                      Enter any GitHub repository link\n+                    </p>\n+                  )}\n+                </div>\n+              ) : null}\n             </div>\n           }\n         />\n","comments":[{"type":"issue_comment","id":3563337430,"prNumber":1028,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 4 screenshot(s) for commit `e08852c`:\n\n### dashboard-initial-state-HEAD.png\n![dashboard-initial-state-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/a512bb40-f1d0-4496-ae37-84d93b3caeff)\n\n### import-repos-error-state-HEAD.png\n![import-repos-error-state-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/28af1cd9-390f-4560-aa8b-f3b622903ab0)\n\n### import-repos-input-field-expanded-HEAD.png\n![import-repos-input-field-expanded-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/a6d37c85-c60e-47bc-848e-59e18c2063f1)\n\n### project-dropdown-with-import-button-HEAD.png\n![project-dropdown-with-import-button-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/58032971-49d5-40d5-b707-c9fae9dc3716)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"e08852c28052d15b9f5fd7b5c717ecacf84fc861","createdAt":"2025-11-21T14:50:45Z","updatedAt":"2025-11-21T14:50:45Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1028#issuecomment-3563337430"}]}
{"number":1027,"title":"Remove import repos button in repo picker","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1027","headRef":"cmux/remove-import-repos-button-in-repo-picker-o65u9","headSha":"07bf31893c96dc92df5b7cb9340331420431d168","baseRef":"main","baseSha":"c631ef72908988d88697f373986756f125b49112","createdAt":"2025-11-21T14:40:51Z","updatedAt":"2025-11-21T14:46:03Z","diff":"diff --git a/apps/client/src/components/dashboard/DashboardInputControls.tsx b/apps/client/src/components/dashboard/DashboardInputControls.tsx\nindex 0f8285a44..ea82a540a 100644\n--- a/apps/client/src/components/dashboard/DashboardInputControls.tsx\n+++ b/apps/client/src/components/dashboard/DashboardInputControls.tsx\n@@ -16,13 +16,11 @@ import { isElectron } from \"@/lib/electron\";\n import { api } from \"@cmux/convex/api\";\n import type { ProviderStatus, ProviderStatusResponse } from \"@cmux/shared\";\n import { AGENT_CONFIGS } from \"@cmux/shared/agentConfig\";\n-import { parseGithubRepoUrl } from \"@cmux/shared\";\n import { Link, useRouter } from \"@tanstack/react-router\";\n import clsx from \"clsx\";\n-import { useAction, useMutation } from \"convex/react\";\n-import { Check, GitBranch, Image, Link2, Mic, Server, X } from \"lucide-react\";\n+import { useMutation } from \"convex/react\";\n+import { GitBranch, Image, Mic, Server, X } from \"lucide-react\";\n import { memo, useCallback, useEffect, useMemo, useRef, useState } from \"react\";\n-import { toast } from \"sonner\";\n import { AgentCommandItem, MAX_AGENT_COMMAND_COUNT } from \"./AgentCommandItem\";\n \n interface DashboardInputControlsProps {\n@@ -74,7 +72,6 @@ export const DashboardInputControls = memo(function DashboardInputControls({\n   const router = useRouter();\n   const agentSelectRef = useRef<SearchableSelectHandle | null>(null);\n   const mintState = useMutation(api.github_app.mintInstallState);\n-  const addManualRepo = useAction(api.github_http.addManualRepo);\n   const providerStatusMap = useMemo(() => {\n     const map = new Map<string, ProviderStatus>();\n     providerStatus?.providers?.forEach((provider) => {\n@@ -226,12 +223,6 @@ export const DashboardInputControls = memo(function DashboardInputControls({\n   const pillboxScrollRef = useRef<HTMLDivElement | null>(null);\n   const [showPillboxFade, setShowPillboxFade] = useState(false);\n \n-  // Custom repo URL state\n-  const [showCustomRepoInput, setShowCustomRepoInput] = useState(false);\n-  const [customRepoUrl, setCustomRepoUrl] = useState(\"\");\n-  const [customRepoError, setCustomRepoError] = useState<string | null>(null);\n-  const [isAddingRepo, setIsAddingRepo] = useState(false);\n-\n   useEffect(() => {\n     const node = pillboxScrollRef.current;\n     if (!node) {\n@@ -298,56 +289,6 @@ export const DashboardInputControls = memo(function DashboardInputControls({\n     agentSelectRef.current?.open({ focusValue: agent });\n   }, []);\n \n-  const handleCustomRepoSubmit = useCallback(async () => {\n-    const trimmedUrl = customRepoUrl.trim();\n-\n-    // Validate URL format before sending to backend\n-    if (!trimmedUrl) {\n-      setCustomRepoError(\"Please enter a GitHub repository URL\");\n-      return;\n-    }\n-\n-    const parsed = parseGithubRepoUrl(trimmedUrl);\n-    if (!parsed) {\n-      setCustomRepoError(\"Invalid GitHub repository URL. Use format: owner/repo or https://github.com/owner/repo\");\n-      return;\n-    }\n-\n-    setIsAddingRepo(true);\n-    setCustomRepoError(null);\n-\n-    try {\n-      const result = await addManualRepo({\n-        teamSlugOrId,\n-        repoUrl: trimmedUrl,\n-      });\n-\n-      if (result.success) {\n-        // Set the repo as selected\n-        onProjectChange([result.fullName]);\n-\n-        // Clear the custom input\n-        setCustomRepoUrl(\"\");\n-        setCustomRepoError(null);\n-        setShowCustomRepoInput(false);\n-\n-        toast.success(`Added ${result.fullName} to repositories`);\n-      }\n-    } catch (error) {\n-      const errorMessage =\n-        error instanceof Error ? error.message : \"Failed to add repository\";\n-      setCustomRepoError(errorMessage);\n-      toast.error(errorMessage);\n-    } finally {\n-      setIsAddingRepo(false);\n-    }\n-  }, [customRepoUrl, addManualRepo, teamSlugOrId, onProjectChange]);\n-\n-  const handleCustomRepoInputChange = useCallback((value: string) => {\n-    setCustomRepoUrl(value);\n-    setCustomRepoError(null);\n-  }, []);\n-\n   const agentSelectionFooter = selectedAgents.length ? (\n     <div className=\"bg-neutral-50 dark:bg-neutral-900/70\">\n       <div className=\"relative\">\n@@ -550,80 +491,6 @@ export const DashboardInputControls = memo(function DashboardInputControls({\n                   <span className=\"select-none\">Add repos from GitHub</span>\n                 </button>\n               ) : null}\n-              <button\n-                type=\"button\"\n-                onClick={(e) => {\n-                  e.preventDefault();\n-                  setShowCustomRepoInput((prev) => !prev);\n-                  setCustomRepoError(null);\n-                }}\n-                className=\"w-full px-2 h-8 flex items-center gap-2 text-[13.5px] text-neutral-800 dark:text-neutral-200 rounded-md hover:bg-neutral-50 dark:hover:bg-neutral-900\"\n-              >\n-                <Link2 className=\"w-4 h-4 text-neutral-600 dark:text-neutral-300\" />\n-                <span className=\"select-none\">\n-                  {showCustomRepoInput ? \"Hide repo link menu\" : \"Import repos from link\"}\n-                </span>\n-              </button>\n-              {showCustomRepoInput ? (\n-                <div className=\"px-2 pb-2 pt-1\">\n-                  <div className=\"flex gap-1\">\n-                    <input\n-                      type=\"text\"\n-                      value={customRepoUrl}\n-                      onChange={(e) => handleCustomRepoInputChange(e.target.value)}\n-                      onKeyDown={(e) => {\n-                        if (e.key === \"Enter\") {\n-                          e.preventDefault();\n-                          void handleCustomRepoSubmit();\n-                        } else if (e.key === \"Escape\") {\n-                          setShowCustomRepoInput(false);\n-                          setCustomRepoUrl(\"\");\n-                          setCustomRepoError(null);\n-                        }\n-                      }}\n-                      placeholder=\"github.com/owner/repo\"\n-                      className={clsx(\n-                        \"flex-1 px-2 h-7 text-[13px] rounded border\",\n-                        \"bg-white dark:bg-neutral-800\",\n-                        \"border-neutral-300 dark:border-neutral-600\",\n-                        \"text-neutral-900 dark:text-neutral-100\",\n-                        \"placeholder:text-neutral-400 dark:placeholder:text-neutral-500\",\n-                        \"focus:outline-none focus:ring-1 focus:ring-blue-500\",\n-                        customRepoError ? \"border-red-500 dark:border-red-500\" : \"\"\n-                      )}\n-                      autoFocus\n-                    />\n-                    <button\n-                      type=\"button\"\n-                      onClick={handleCustomRepoSubmit}\n-                      disabled={isAddingRepo}\n-                      className={clsx(\n-                        \"px-2 h-7 flex items-center justify-center rounded\",\n-                        \"bg-blue-500 hover:bg-blue-600\",\n-                        \"text-white text-[12px] font-medium\",\n-                        \"transition-colors\",\n-                        \"disabled:opacity-50 disabled:cursor-not-allowed\"\n-                      )}\n-                      title=\"Add repository\"\n-                    >\n-                      {isAddingRepo ? (\n-                        <span className=\"w-3.5 h-3.5 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n-                      ) : (\n-                        <Check className=\"w-3.5 h-3.5\" />\n-                      )}\n-                    </button>\n-                  </div>\n-                  {customRepoError ? (\n-                    <p className=\"text-[11px] text-red-500 dark:text-red-400 mt-1 px-1\">\n-                      {customRepoError}\n-                    </p>\n-                  ) : (\n-                    <p className=\"text-[10px] text-neutral-500 dark:text-neutral-400 mt-1 px-1\">\n-                      Enter any GitHub repository link\n-                    </p>\n-                  )}\n-                </div>\n-              ) : null}\n             </div>\n           }\n         />\n","comments":[{"type":"issue_comment","id":3563321647,"prNumber":1027,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 4 screenshot(s) for commit `07bf318`:\n\n### agent-selection-dialog-open-HEAD.png\n![agent-selection-dialog-open-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/35ee0563-751f-4e48-8962-c79ce450f869)\n\n### dashboard-full-page-HEAD.png\n![dashboard-full-page-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/eda8b9d6-08b7-4561-9ef8-18223d0c6a16)\n\n### dashboard-input-controls-area-HEAD.png\n![dashboard-input-controls-area-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/cc6fa95d-d946-42fd-af58-cf0e4e1a34c2)\n\n### dashboard-viewport-HEAD.png\n![dashboard-viewport-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/f9e1e184-7bfa-437b-89fc-6e6d3b389804)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"07bf31893c96dc92df5b7cb9340331420431d168","createdAt":"2025-11-21T14:46:02Z","updatedAt":"2025-11-21T14:46:02Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1027#issuecomment-3563321647"}]}
{"number":1026,"title":"Change homepage hero to 67x engineers","state":"open","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1026","headRef":"cmux/change-homepage-hero-to-67x-engineers-u7u4e","headSha":"efcac9e5b4c8be89cd7879af3b323761cb3faf95","baseRef":"main","baseSha":"88bd62daa4925667b83bbb431ef369059aadd23b","createdAt":"2025-11-21T11:32:20Z","updatedAt":"2025-12-01T00:22:43Z","diff":"diff --git a/apps/www/app/layout.tsx b/apps/www/app/layout.tsx\nindex bf32f1412..77da09546 100644\n--- a/apps/www/app/layout.tsx\n+++ b/apps/www/app/layout.tsx\n@@ -10,12 +10,12 @@ import clsx from \"clsx\";\n import \"./globals.css\";\n \n export const metadata: Metadata = {\n-  title: \"cmux - Manage AI coding agents in parallel — 10x your 10x engineers\",\n+  title: \"cmux - Manage AI coding agents in parallel — 67x your engineers\",\n   description:\n     \"cmux spawns Claude Code, Codex, Gemini CLI, Amp, Opencode, and other coding agent CLIs in parallel across multiple tasks. For each run, cmux spawns an isolated VS Code instance via Docker with the git diff UI and terminal.\",\n   openGraph: {\n     title:\n-      \"cmux - Manage AI coding agents in parallel — 10x your 10x engineers\",\n+      \"cmux - Manage AI coding agents in parallel — 67x your engineers\",\n     description:\n       \"Run multiple AI coding agents simultaneously with isolated VS Code instances\",\n     type: \"website\",\n@@ -23,7 +23,7 @@ export const metadata: Metadata = {\n   twitter: {\n     card: \"summary_large_image\",\n     title:\n-      \"cmux - Manage AI coding agents in parallel — 10x your 10x engineers\",\n+      \"cmux - Manage AI coding agents in parallel — 67x your engineers\",\n     description:\n       \"Run multiple AI coding agents simultaneously with isolated VS Code instances\",\n   },\ndiff --git a/apps/www/app/page.tsx b/apps/www/app/page.tsx\nindex 29c883dbb..5186b41ec 100644\n--- a/apps/www/app/page.tsx\n+++ b/apps/www/app/page.tsx\n@@ -177,7 +177,7 @@ export default async function LandingPage() {\n \n               <div className=\"space-y-6\">\n                 <h1 className=\"text-4xl font-semibold tracking-tight text-white sm:text-5xl\">\n-                  Universal AI coding agent manager for 10x engineers\n+                  Universal AI coding agent manager for 67x engineers\n                 </h1>\n                 <div className=\"space-y-4 text-base text-neutral-300 sm:text-lg\">\n                   <p>\n","comments":[{"type":"issue_comment","id":3562639905,"prNumber":1026,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\nSuccessfully captured 8 screenshot(s) for commit `65df80e`:\n\n### about-section-heading-HEAD.png\n![about-section-heading-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/cdda552d-75b6-43a2-8eda-f219ea2644c2)\n\n### download-button-HEAD.png\n![download-button-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/143e8be6-387a-48c9-9762-d205b40174e4)\n\n### features-heading-HEAD.png\n![features-heading-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/75f1eb9d-fe84-4fa8-b701-f0bafdaa01d5)\n\n### footer-HEAD.png\n![footer-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/14bfa920-2607-4944-9822-3bb60e832a4d)\n\n### header-navigation-HEAD.png\n![header-navigation-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/74b6c308-97eb-44d9-9e26-34512b8008ac)\n\n### hero-heading-HEAD.png\n![hero-heading-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/03dbb6ee-1515-47ef-ad5a-01ab54ae4116)\n\n### hero-section-HEAD.png\n![hero-section-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/da2452ad-a37c-4e7f-9340-597eed2ef179)\n\n### homepage-full-HEAD.png\n![homepage-full-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/105322b6-5f1a-42f6-9a5d-22ec3f70805b)\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_\n\n</details>","commitSha":"efcac9e5b4c8be89cd7879af3b323761cb3faf95","createdAt":"2025-11-21T11:36:08Z","updatedAt":"2025-11-30T02:17:16Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1026#issuecomment-3562639905"},{"type":"issue_comment","id":3564683137,"prNumber":1026,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\nSuccessfully captured 5 screenshot(s) for commit `efcac9e`:\n\n### header-banner-HEAD.png\n![header-banner-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/a3f275db-8ae6-4a5b-8669-723ffb6978a8)\n\n### hero-heading-HEAD.png\n![hero-heading-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/6d2dd8b6-2679-4721-9e98-e06040e4f9d0)\n\n### homepage-fullpage-HEAD.png\n![homepage-fullpage-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/20d852f0-8664-4559-8f90-0a5deb517a3b)\n\n### homepage-viewport-HEAD.png\n![homepage-viewport-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/dd4aaf8f-d9f5-4ba2-8021-1f7654ad4fef)\n\n### main-content-HEAD.png\n![main-content-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/a5a1b63b-784b-4da5-ae03-40cfa6006f10)\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_\n\n</details>","commitSha":"efcac9e5b4c8be89cd7879af3b323761cb3faf95","createdAt":"2025-11-21T21:43:27Z","updatedAt":"2025-11-30T02:17:17Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1026#issuecomment-3564683137"},{"type":"issue_comment","id":3592115621,"prNumber":1026,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n### Latest commit `73aedab`\n\nCaptured 5 screenshots for commit `73aedab` (2025-11-30 02:17:12.167 UTC).\n\n![header-with-title.png](https://polite-canary-804.convex.cloud/api/storage/2192aae8-b46c-42bf-bec7-5e749e270927)\n\n![hero-heading-67x-engineers.png](https://polite-canary-804.convex.cloud/api/storage/5c671adf-0ca1-4b9e-8a97-5af53559bc88)\n\n![hero-section-main-content.png](https://polite-canary-804.convex.cloud/api/storage/1cecb629-7665-40aa-80d1-d9f005a7915b)\n\n![homepage-full-page.png](https://polite-canary-804.convex.cloud/api/storage/7a8137b9-2473-45ca-b629-c264a6a998ef)\n\n![homepage-viewport-hero.png](https://polite-canary-804.convex.cloud/api/storage/a2d72900-e86f-4cbc-9a43-3142343f8ef2)\n\n---\n\n_Generated by [cmux](https://cmux.dev)\n\n</details>","commitSha":"efcac9e5b4c8be89cd7879af3b323761cb3faf95","createdAt":"2025-11-30T02:17:15Z","updatedAt":"2025-11-30T03:02:41Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1026#issuecomment-3592115621"},{"type":"issue_comment","id":3592141558,"prNumber":1026,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n### Latest commit `73aedab`\n\nCaptured 5 screenshots for commit `73aedab` (2025-11-30 03:02:37.507 UTC).\n\n![header-with-title.png](https://polite-canary-804.convex.cloud/api/storage/271b76b9-b748-4c8b-8254-7a49211dc8fa)\n\n![hero-heading-67x-engineers.png](https://polite-canary-804.convex.cloud/api/storage/86fb8de5-13f3-473a-9899-3ff72faed6be)\n\n![hero-section-main-content.png](https://polite-canary-804.convex.cloud/api/storage/e3f78af4-52eb-4ddc-8947-24c0512b1e73)\n\n![homepage-full-page.png](https://polite-canary-804.convex.cloud/api/storage/854cc87d-91be-434d-9361-71673a4b1d6c)\n\n![homepage-viewport-hero.png](https://polite-canary-804.convex.cloud/api/storage/79d48741-e4e5-42be-9b11-8b89cbc70420)\n\n<details>\n<summary>Previous preview runs (1)</summary>\n\n#### ✅ Screenshots – commit 73aedab (2025-11-30 02:17:12.167 UTC)\n\nCaptured 5 screenshots for commit `73aedab` (2025-11-30 02:17:12.167 UTC).\n\n![header-with-title.png](https://polite-canary-804.convex.cloud/api/storage/2192aae8-b46c-42bf-bec7-5e749e270927)\n\n![hero-heading-67x-engineers.png](https://polite-canary-804.convex.cloud/api/storage/5c671adf-0ca1-4b9e-8a97-5af53559bc88)\n\n![hero-section-main-content.png](https://polite-canary-804.convex.cloud/api/storage/1cecb629-7665-40aa-80d1-d9f005a7915b)\n\n![homepage-full-page.png](https://polite-canary-804.convex.cloud/api/storage/7a8137b9-2473-45ca-b629-c264a6a998ef)\n\n![homepage-viewport-hero.png](https://polite-canary-804.convex.cloud/api/storage/a2d72900-e86f-4cbc-9a43-3142343f8ef2)\n\n</details>\n\n---\n\n_Generated by [cmux](https://cmux.dev)\n\n</details>","commitSha":"efcac9e5b4c8be89cd7879af3b323761cb3faf95","createdAt":"2025-11-30T03:02:40Z","updatedAt":"2025-11-30T03:10:12Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1026#issuecomment-3592141558"},{"type":"issue_comment","id":3592145721,"prNumber":1026,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\n### Latest commit `2808eca`\n\nCaptured 5 screenshots for commit `2808eca` (2025-11-30 03:10:08.392 UTC).\n\n![header-with-title.png](https://polite-canary-804.convex.cloud/api/storage/8898e591-f586-4be6-84d8-0c6381a2d89f)\n\n![hero-heading-67x-engineers.png](https://polite-canary-804.convex.cloud/api/storage/dfa9bfc6-e331-4358-afb4-1eae6c9a4ac8)\n\n![hero-section-main-content.png](https://polite-canary-804.convex.cloud/api/storage/bc98da16-9ed8-4cb4-81a7-787dd7d60989)\n\n![homepage-full-page.png](https://polite-canary-804.convex.cloud/api/storage/48736b2d-423a-4799-b6b1-752ffa95651c)\n\n![homepage-viewport-hero.png](https://polite-canary-804.convex.cloud/api/storage/1b94a736-f888-44e0-b0a7-f39e85059852)\n\n<details>\n<summary>Previous preview runs (2)</summary>\n\n#### ✅ Screenshots – commit 73aedab (2025-11-30 03:02:37.507 UTC)\n\nCaptured 5 screenshots for commit `73aedab` (2025-11-30 03:02:37.507 UTC).\n\n![header-with-title.png](https://polite-canary-804.convex.cloud/api/storage/271b76b9-b748-4c8b-8254-7a49211dc8fa)\n\n![hero-heading-67x-engineers.png](https://polite-canary-804.convex.cloud/api/storage/86fb8de5-13f3-473a-9899-3ff72faed6be)\n\n![hero-section-main-content.png](https://polite-canary-804.convex.cloud/api/storage/e3f78af4-52eb-4ddc-8947-24c0512b1e73)\n\n![homepage-full-page.png](https://polite-canary-804.convex.cloud/api/storage/854cc87d-91be-434d-9361-71673a4b1d6c)\n\n![homepage-viewport-hero.png](https://polite-canary-804.convex.cloud/api/storage/79d48741-e4e5-42be-9b11-8b89cbc70420)\n\n---\n\n#### ✅ Screenshots – commit 73aedab (2025-11-30 02:17:12.167 UTC)\n\nCaptured 5 screenshots for commit `73aedab` (2025-11-30 02:17:12.167 UTC).\n\n![header-with-title.png](https://polite-canary-804.convex.cloud/api/storage/2192aae8-b46c-42bf-bec7-5e749e270927)\n\n![hero-heading-67x-engineers.png](https://polite-canary-804.convex.cloud/api/storage/5c671adf-0ca1-4b9e-8a97-5af53559bc88)\n\n![hero-section-main-content.png](https://polite-canary-804.convex.cloud/api/storage/1cecb629-7665-40aa-80d1-d9f005a7915b)\n\n![homepage-full-page.png](https://polite-canary-804.convex.cloud/api/storage/7a8137b9-2473-45ca-b629-c264a6a998ef)\n\n![homepage-viewport-hero.png](https://polite-canary-804.convex.cloud/api/storage/a2d72900-e86f-4cbc-9a43-3142343f8ef2)\n\n</details>\n\n---\n\n_Generated by [cmux](https://cmux.dev)\n\n</details>","commitSha":"efcac9e5b4c8be89cd7879af3b323761cb3faf95","createdAt":"2025-11-30T03:10:11Z","updatedAt":"2025-11-30T04:31:19Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1026#issuecomment-3592145721"},{"type":"issue_comment","id":3592184743,"prNumber":1026,"botLogin":"cmux-agent-internal-dev[bot]","body":"<!-- cmux-preview-collapsed -->\n<details>\n<summary>Older cmux preview screenshots (latest comment is above)</summary>\n\n## Preview Screenshots\n\nSuccessfully captured 3 screenshot(s) for commit `2808eca`:\n\n### hero-heading-67x-engineers.png\n![hero-heading-67x-engineers.png](https://polite-canary-804.convex.cloud/api/storage/741903bb-89c4-47ae-85ba-7c0da484a24c)\n\n### hero-section-viewport.png\n![hero-section-viewport.png](https://polite-canary-804.convex.cloud/api/storage/72bf33cd-edcb-4da6-a09a-da9045026d56)\n\n### homepage-full-page.png\n![homepage-full-page.png](https://polite-canary-804.convex.cloud/api/storage/81625c24-f7b1-4c5b-a888-c6efcdc4a93b)\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_\n\n</details>","commitSha":"efcac9e5b4c8be89cd7879af3b323761cb3faf95","createdAt":"2025-11-30T04:31:18Z","updatedAt":"2025-12-01T00:22:44Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1026#issuecomment-3592184743"},{"type":"issue_comment","id":3594009251,"prNumber":1026,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nCaptured 2 screenshots for commit `6137114` (2025-12-01 00:22:40.770 UTC).\n\n![homepage-full-page.png](https://polite-canary-804.convex.cloud/api/storage/12f811d5-340b-4446-b218-4ef89a31712c)\n\n![homepage-viewport.png](https://polite-canary-804.convex.cloud/api/storage/5f7f286a-1c61-48bc-a5b2-16acc8a751de)\n\n---\n\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"efcac9e5b4c8be89cd7879af3b323761cb3faf95","createdAt":"2025-12-01T00:22:43Z","updatedAt":"2025-12-01T00:22:43Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1026#issuecomment-3594009251"}]}
{"number":1025,"title":"Export router from router.tsx","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1025","headRef":"codex/add-tanstack-router-to-sentry-integration","headSha":"8cb796c2ead95f2b86cbec066fdf4db6c74818e5","baseRef":"main","baseSha":"88bd62daa4925667b83bbb431ef369059aadd23b","createdAt":"2025-11-21T10:25:42Z","updatedAt":"2025-11-21T23:14:32Z","diff":"diff --git a/apps/client/src/main-electron.tsx b/apps/client/src/main-electron.tsx\nindex 0edbd0a22..2bdb2bf47 100644\n--- a/apps/client/src/main-electron.tsx\n+++ b/apps/client/src/main-electron.tsx\n@@ -1,13 +1,18 @@\n import { init } from \"@sentry/electron/renderer\";\n-import { init as reactInit } from \"@sentry/react\";\n+import {\n+  init as reactInit,\n+  tanstackRouterBrowserTracingIntegration,\n+} from \"@sentry/react\";\n import { SENTRY_ELECTRON_DSN } from \"./sentry-config.ts\";\n+import { router } from \"./router\";\n \n init(\n   {\n     dsn: SENTRY_ELECTRON_DSN,\n-    integrations: [\n-      /* integrations */\n-    ],\n+    integrations: [tanstackRouterBrowserTracingIntegration(router)],\n+    // Setting a sample rate is required for sending performance data.\n+    // Adjust this value in production or use tracesSampler for finer control.\n+    tracesSampleRate: 1.0,\n   },\n   reactInit\n );\ndiff --git a/apps/client/src/main.tsx b/apps/client/src/main.tsx\nindex 22d70f7e3..433d8eaf0 100644\n--- a/apps/client/src/main.tsx\n+++ b/apps/client/src/main.tsx\n@@ -1,11 +1,13 @@\n-import { init } from \"@sentry/react\";\n+import { init, tanstackRouterBrowserTracingIntegration } from \"@sentry/react\";\n+import { router } from \"./router\";\n import { SENTRY_WEB_DSN } from \"./sentry-config\";\n+\n init({\n   dsn: SENTRY_WEB_DSN,\n-  integrations: [\n-    /* integrations */\n-  ],\n-  /* Other Electron and React SDK config */\n+  integrations: [tanstackRouterBrowserTracingIntegration(router)],\n+  // Setting a sample rate is required for sending performance data.\n+  // Adjust this value in production or use tracesSampler for finer control.\n+  tracesSampleRate: 1.0,\n });\n \n import { StrictMode } from \"react\";\ndiff --git a/apps/client/src/router.tsx b/apps/client/src/router.tsx\nindex 290880d78..4b5a49575 100644\n--- a/apps/client/src/router.tsx\n+++ b/apps/client/src/router.tsx\n@@ -1,9 +1,9 @@\n import { isElectron } from \"@/lib/electron\";\n import { useStackApp } from \"@stackframe/react\";\n import {\n+  RouterProvider,\n   createHashHistory,\n   createRouter as createTanStackRouter,\n-  RouterProvider,\n } from \"@tanstack/react-router\";\n import { routerWithQueryClient } from \"@tanstack/react-router-with-query\";\n import { queryClient } from \"./query-client\";\n@@ -29,7 +29,7 @@ function createRouter() {\n   return router;\n }\n \n-const router = createRouter();\n+export const router = createRouter();\n \n export function RouterProviderWithAuth() {\n   const auth = useStackApp();\n","comments":[{"type":"issue_comment","id":3562401405,"prNumber":1025,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 4 screenshot(s) for commit `6fe7f74`:\n\n### dashboard-fullpage-HEAD.png\n![dashboard-fullpage-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/e2695005-8e48-4f1b-9b7f-1f46e67ba670)\n\n### dashboard-viewport-HEAD.png\n![dashboard-viewport-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/a0f0a4d4-5f6a-4d00-bcc3-84df8fb7ee9f)\n\n### homepage-fullpage-HEAD.png\n![homepage-fullpage-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/6242f4ba-4392-44f6-ba5b-27ee1894b4d1)\n\n### homepage-viewport-HEAD.png\n![homepage-viewport-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/7874c1d3-0591-46a4-ac70-5a217ef8edac)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"8cb796c2ead95f2b86cbec066fdf4db6c74818e5","createdAt":"2025-11-21T10:31:46Z","updatedAt":"2025-11-21T10:31:46Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1025#issuecomment-3562401405"}]}
{"number":1023,"title":"Fix concurrent mutation conflict in workflow runs table","state":"open","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1023","headRef":"claude/fix-workflow-runs-mutation-01EYXMUmxZdb7X9GtdtvNrtF","headSha":"1ae653d3add7b3152fd4444b79f6708441fbdc48","baseRef":"main","baseSha":"88bd62daa4925667b83bbb431ef369059aadd23b","createdAt":"2025-11-21T09:40:58Z","updatedAt":"2025-11-21T21:45:21Z","diff":"diff --git a/packages/convex/convex/github_workflows.ts b/packages/convex/convex/github_workflows.ts\nindex 29946b8b4..28c185343 100644\n--- a/packages/convex/convex/github_workflows.ts\n+++ b/packages/convex/convex/github_workflows.ts\n@@ -132,27 +132,42 @@ export const upsertWorkflowRunFromWebhook = internalMutation({\n     };\n \n \n-    // Upsert the workflow run - fetch all matching records to handle duplicates\n-    const existingRecords = await ctx.db\n-      .query(\"githubWorkflowRuns\")\n-      .withIndex(\"by_runId\", (q) => q.eq(\"runId\", runId))\n-      .collect();\n-\n-    if (existingRecords.length > 0) {\n-      // Update the first record\n-      await ctx.db.patch(existingRecords[0]._id, workflowRunDoc);\n-\n-      // Delete any duplicates\n-      if (existingRecords.length > 1) {\n-        console.warn(\"[upsertWorkflowRun] Found duplicates, cleaning up\", {\n-          runId,\n-          count: existingRecords.length,\n-          duplicateIds: existingRecords.slice(1).map(r => r._id),\n-        });\n+    // Upsert the workflow run using .unique() to reduce OCC contention\n+    // .unique() is more atomic and creates less contention than .collect()\n+    let existingRecord;\n+    try {\n+      existingRecord = await ctx.db\n+        .query(\"githubWorkflowRuns\")\n+        .withIndex(\"by_runId\", (q) => q.eq(\"runId\", runId))\n+        .unique();\n+    } catch (error) {\n+      // .unique() throws if multiple documents match - handle duplicates\n+      console.warn(\"[upsertWorkflowRun] Multiple records found for runId, cleaning up\", {\n+        runId,\n+        error: error instanceof Error ? error.message : String(error),\n+      });\n+\n+      // Fall back to collect to handle duplicates\n+      const existingRecords = await ctx.db\n+        .query(\"githubWorkflowRuns\")\n+        .withIndex(\"by_runId\", (q) => q.eq(\"runId\", runId))\n+        .collect();\n+\n+      if (existingRecords.length > 0) {\n+        // Update the first record\n+        await ctx.db.patch(existingRecords[0]._id, workflowRunDoc);\n+\n+        // Delete duplicates\n         for (const duplicate of existingRecords.slice(1)) {\n           await ctx.db.delete(duplicate._id);\n         }\n       }\n+      return;\n+    }\n+\n+    if (existingRecord) {\n+      // Update existing record\n+      await ctx.db.patch(existingRecord._id, workflowRunDoc);\n     } else {\n       // Insert new run\n       await ctx.db.insert(\"githubWorkflowRuns\", workflowRunDoc);\n","comments":[{"type":"issue_comment","id":3564686019,"prNumber":1023,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 1 screenshot(s) for commit `1ae653d`:\n\n### error-state-HEAD.png\n![error-state-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/98c47c02-0bd5-46db-8714-380919bb711d)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"1ae653d3add7b3152fd4444b79f6708441fbdc48","createdAt":"2025-11-21T21:44:54Z","updatedAt":"2025-11-21T21:44:54Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1023#issuecomment-3564686019"}]}
{"number":1021,"title":"Fix xterm dimensions undefined error on navigation","state":"open","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1021","headRef":"claude/fix-xterm-dimensions-error-01ETeBbcvb4kxBHU9MkYbhpz","headSha":"dffa1c871b5f55719ffb87a72ccc520d5d83dc29","baseRef":"main","baseSha":"88bd62daa4925667b83bbb431ef369059aadd23b","createdAt":"2025-11-21T08:23:15Z","updatedAt":"2025-11-21T21:47:23Z","diff":"diff --git a/apps/client/src/components/RestoredTerminalView.tsx b/apps/client/src/components/RestoredTerminalView.tsx\nindex 4d0614abb..a4264d5ab 100644\n--- a/apps/client/src/components/RestoredTerminalView.tsx\n+++ b/apps/client/src/components/RestoredTerminalView.tsx\n@@ -46,14 +46,28 @@ export function RestoredTerminalView({\n     xterm.loadAddon(webLinksAddon);\n \n     xterm.open(terminalRef.current);\n-    fitAddon.fit();\n+\n+    // Guard against calling fit() when terminal is not fully initialized\n+    if (xterm.element?.isConnected) {\n+      try {\n+        fitAddon.fit();\n+      } catch (error) {\n+        console.debug(\"[RestoredTerminalView] fitAddon.fit() failed during mount\", error);\n+      }\n+    }\n \n     xtermRef.current = xterm;\n     fitAddonRef.current = fitAddon;\n \n     // Handle resize\n     const handleResize = () => {\n-      fitAddon.fit();\n+      if (xterm.element?.isConnected) {\n+        try {\n+          fitAddon.fit();\n+        } catch (error) {\n+          console.debug(\"[RestoredTerminalView] fitAddon.fit() failed during resize\", error);\n+        }\n+      }\n     };\n \n     const resizeObserver = new ResizeObserver(handleResize);\ndiff --git a/apps/client/src/components/Terminal.tsx b/apps/client/src/components/Terminal.tsx\nindex 2e43079e8..894589800 100644\n--- a/apps/client/src/components/Terminal.tsx\n+++ b/apps/client/src/components/Terminal.tsx\n@@ -26,11 +26,23 @@ export function Terminal({ isActive, initialScrollback }: TerminalProps) {\n     if (!terminal) return;\n \n     const handleResize = () => {\n-      if (fitAddon) {\n-        fitAddon.fit();\n+      if (fitAddon && terminal.element?.isConnected) {\n+        try {\n+          fitAddon.fit();\n+        } catch (error) {\n+          console.debug(\"[Terminal] fitAddon.fit() failed during resize\", error);\n+        }\n       }\n     };\n-    fitAddon.fit();\n+\n+    // Guard against calling fit() when terminal is not fully initialized\n+    if (terminal.element?.isConnected) {\n+      try {\n+        fitAddon.fit();\n+      } catch (error) {\n+        console.debug(\"[Terminal] fitAddon.fit() failed during mount\", error);\n+      }\n+    }\n \n     window.addEventListener(\"resize\", handleResize);\n \n@@ -54,8 +66,12 @@ export function Terminal({ isActive, initialScrollback }: TerminalProps) {\n   }, [initialScrollback, terminal, hasWrittenInitialScrollback]);\n \n   useEffect(() => {\n-    if (isActive && terminal) {\n-      fitAddon.fit();\n+    if (isActive && terminal && terminal.element?.isConnected) {\n+      try {\n+        fitAddon.fit();\n+      } catch (error) {\n+        console.debug(\"[Terminal] fitAddon.fit() failed when becoming active\", error);\n+      }\n       terminal.focus();\n     }\n   }, [isActive, fitAddon, terminal]);\ndiff --git a/apps/client/src/components/task-run-terminal-session.tsx b/apps/client/src/components/task-run-terminal-session.tsx\nindex a287f6a23..3a3a13d8b 100644\n--- a/apps/client/src/components/task-run-terminal-session.tsx\n+++ b/apps/client/src/components/task-run-terminal-session.tsx\n@@ -147,8 +147,22 @@ export function TaskRunTerminalSession({\n     if (!terminal || !fitAddon) {\n       return;\n     }\n-    fitAddon.fit();\n-    queueResize();\n+\n+    // Guard against calling fit() when terminal is not fully initialized or is being disposed\n+    // This prevents \"Cannot read properties of undefined (reading 'dimensions')\" errors\n+    const element = terminal.element;\n+    if (!element || !element.isConnected) {\n+      return;\n+    }\n+\n+    try {\n+      fitAddon.fit();\n+      queueResize();\n+    } catch (error) {\n+      // Silently ignore fit errors during mount/unmount transitions\n+      // This can happen when the viewport is not yet initialized or already disposed\n+      console.debug(\"[TaskRunTerminalSession] fitAddon.fit() failed, likely during mount/unmount\", error);\n+    }\n   }, [queueResize, terminal]);\n \n   const flushPendingResize = useCallback(() => {\n","comments":[{"type":"issue_comment","id":3561949240,"prNumber":1021,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 3 screenshot(s) for commit `7756693`:\n\n### dashboard-full-page-HEAD.png\n![dashboard-full-page-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/c0e96326-ce02-4eba-b4ca-dd575f200067)\n\n### task-page-overview-HEAD.png\n![task-page-overview-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/09a60aa1-50b5-4b41-88e1-60863c045a8e)\n\n### task-page-terminals-tab-HEAD.png\n![task-page-terminals-tab-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/880c88ba-181a-41e0-97a0-6a6fce02e851)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"dffa1c871b5f55719ffb87a72ccc520d5d83dc29","createdAt":"2025-11-21T08:26:26Z","updatedAt":"2025-11-21T08:26:26Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1021#issuecomment-3561949240"}]}
{"number":1019,"title":"Fix aria-hidden blocking focused element accessibility","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1019","headRef":"claude/fix-aria-hidden-focus-016ksGGTHq19TuVoMwFxqPBV","headSha":"a50040e1e37a9237da3e1fa7b781baf1572641e8","baseRef":"main","baseSha":"904dba6c3f4c29ccee669e836a005ec83b3460a4","createdAt":"2025-11-21T08:22:48Z","updatedAt":"2025-11-21T11:38:20Z","diff":"diff --git a/apps/client/src/components/CommandBar.tsx b/apps/client/src/components/CommandBar.tsx\nindex b3b013939..16383530b 100644\n--- a/apps/client/src/components/CommandBar.tsx\n+++ b/apps/client/src/components/CommandBar.tsx\n@@ -2473,7 +2473,6 @@ export function CommandBar({\n             ? \"opacity-100 pointer-events-auto\"\n             : \"opacity-0 pointer-events-none\"\n         )}\n-        aria-hidden={!open}\n         onClick={closeCommand}\n       />\n       <div\n@@ -2481,7 +2480,6 @@ export function CommandBar({\n           \"fixed inset-x-0 top-[230px] z-[var(--z-commandbar)] flex items-start justify-center pointer-events-none\",\n           open ? \"opacity-100\" : \"opacity-0\"\n         )}\n-        aria-hidden={!open}\n       >\n         <div\n           className={`w-full max-w-2xl h-auto max-h-[475px] bg-white dark:bg-neutral-900 rounded-xl shadow-2xl border border-neutral-200 dark:border-neutral-700 overflow-hidden flex flex-col ${\n@@ -2489,7 +2487,6 @@ export function CommandBar({\n               ? \"opacity-100 pointer-events-auto\"\n               : \"opacity-0 pointer-events-none\"\n           }`}\n-          aria-hidden={!open}\n         >\n           <Command\n             value={commandValue}\n","comments":[{"type":"issue_comment","id":3561965752,"prNumber":1019,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 12 screenshot(s) for commit `a50040e`:\n\n### commandbar-cloud-workspaces-page-HEAD.png\n![commandbar-cloud-workspaces-page-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/4dfd067f-6792-4722-904a-a0c8117fc097)\n\n### commandbar-empty-default-state-HEAD.png\n![commandbar-empty-default-state-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/20d908f5-748c-48fa-8548-630caebbb339)\n\n### commandbar-item-highlighted-HEAD.png\n![commandbar-item-highlighted-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/bf09a80a-e282-49c8-855d-e52b285975f7)\n\n### commandbar-keyboard-navigation-HEAD.png\n![commandbar-keyboard-navigation-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/239e8e96-874f-42df-81c6-b69dac1da5d8)\n\n### commandbar-local-workspaces-page-HEAD.png\n![commandbar-local-workspaces-page-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/e3e687bd-db64-419a-9b4a-1d72faf303c2)\n\n### commandbar-open-full-page-HEAD.png\n![commandbar-open-full-page-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/e7b8f557-768c-4d62-aabd-9c883aae461a)\n\n### commandbar-search-task-filtered-HEAD.png\n![commandbar-search-task-filtered-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/b2808cbf-080a-4ba9-8626-b75b4d895e51)\n\n### commandbar-search-theme-HEAD.png\n![commandbar-search-theme-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/a028dbe2-6c0d-4c0d-956f-e65a660ab14d)\n\n### commandbar-search-workspace-HEAD.png\n![commandbar-search-workspace-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/41ea6260-43d8-4feb-aa7e-bdb351455362)\n\n### commandbar-teams-page-HEAD.png\n![commandbar-teams-page-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/f140fe52-28f3-4ee0-8d0c-3d73a38f90d1)\n\n### commandbar-with-search-task-HEAD.png\n![commandbar-with-search-task-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/5764ad24-1c75-4738-872b-ee3873571314)\n\n### dashboard-before-commandbar-HEAD.png\n![dashboard-before-commandbar-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/b439b1be-28a4-45b3-9d8e-ccc2b263d91b)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"a50040e1e37a9237da3e1fa7b781baf1572641e8","createdAt":"2025-11-21T08:31:42Z","updatedAt":"2025-11-21T08:31:42Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1019#issuecomment-3561965752"}]}
{"number":1015,"title":"Add stack auth context to Sentry reporting","state":"open","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1015","headRef":"codex/locate-sentry-usage-and-add-user-tags","headSha":"556851f197e35e89b68b4a83df42933048c495e1","baseRef":"main","baseSha":"88bd62daa4925667b83bbb431ef369059aadd23b","createdAt":"2025-11-21T08:06:06Z","updatedAt":"2025-11-21T21:57:27Z","diff":"diff --git a/apps/client/src/components/sentry-scope.tsx b/apps/client/src/components/sentry-scope.tsx\nnew file mode 100644\nindex 000000000..2bda9bc9b\n--- /dev/null\n+++ b/apps/client/src/components/sentry-scope.tsx\n@@ -0,0 +1,72 @@\n+import * as Sentry from \"@sentry/react\";\n+import { useEffect, useMemo } from \"react\";\n+import { useUser, type Team } from \"@stackframe/react\";\n+import { useLocation } from \"@tanstack/react-router\";\n+\n+type TeamWithMetadata = Team & { clientMetadata?: unknown };\n+\n+function getTeamSlug(team: Team): string | null {\n+  const maybeSlug = (team as { slug?: unknown }).slug;\n+  if (typeof maybeSlug === \"string\" && maybeSlug.trim().length > 0) {\n+    return maybeSlug.trim();\n+  }\n+\n+  const metadata = (team as TeamWithMetadata).clientMetadata;\n+  if (metadata && typeof metadata === \"object\") {\n+    const slugValue = (metadata as { slug?: unknown }).slug;\n+    if (typeof slugValue === \"string\" && slugValue.trim().length > 0) {\n+      return slugValue.trim();\n+    }\n+  }\n+\n+  return null;\n+}\n+\n+function resolveTeamId(teamSlugOrId: string | null, teams: Team[], selectedTeamId: string | undefined): string | null {\n+  if (!teamSlugOrId) return selectedTeamId ?? null;\n+\n+  const trimmed = teamSlugOrId.trim();\n+  if (trimmed.length === 0) return selectedTeamId ?? null;\n+\n+  const directMatch = teams.find((team) => team.id === trimmed || getTeamSlug(team) === trimmed);\n+  if (directMatch) return directMatch.id;\n+\n+  return selectedTeamId ?? null;\n+}\n+\n+function extractTeamSlugOrId(pathname: string): string | null {\n+  const segments = pathname.split(\"/\").filter((segment) => segment.length > 0);\n+  if (segments.length < 2) return null;\n+  if (segments[0] !== \"_layout\") return null;\n+  return segments[1] ?? null;\n+}\n+\n+export function SentryScope() {\n+  const user = useUser({ or: \"return-null\" });\n+  const location = useLocation();\n+\n+  const teams = user?.useTeams() ?? [];\n+  const selectedTeamId = user?.selectedTeam?.id;\n+\n+  const teamSlugOrId = useMemo(\n+    () => extractTeamSlugOrId(location.pathname),\n+    [location.pathname]\n+  );\n+\n+  const teamId = resolveTeamId(teamSlugOrId, teams, selectedTeamId);\n+\n+  const userId = user?.id;\n+  const userEmail = user?.primaryEmail ?? undefined;\n+\n+  useEffect(() => {\n+    if (userId) {\n+      Sentry.setUser({ id: userId, email: userEmail });\n+    } else {\n+      Sentry.setUser(null);\n+    }\n+\n+    Sentry.setTag(\"team_id\", teamId ?? \"unknown\");\n+  }, [teamId, userEmail, userId]);\n+\n+  return null;\n+}\ndiff --git a/apps/client/src/providers.tsx b/apps/client/src/providers.tsx\nindex a3fd2f268..e7b0c0f54 100644\n--- a/apps/client/src/providers.tsx\n+++ b/apps/client/src/providers.tsx\n@@ -8,6 +8,7 @@ import { AntdProvider } from \"./components/antd-provider\";\n import { isElectron } from \"./lib/electron\";\n import { stackClientApp } from \"./lib/stack\";\n import { queryClient } from \"./query-client\";\n+import { SentryScope } from \"./components/sentry-scope\";\n \n interface ProvidersProps {\n   children: ReactNode;\n@@ -29,6 +30,7 @@ export function Providers({ children }: ProvidersProps) {\n               <TooltipProvider delayDuration={700} skipDelayDuration={300}>\n                 <HeroUIProvider>\n                   <RootErrorBoundary>\n+                    <SentryScope />\n                     <AntdProvider>{children}</AntdProvider>\n                   </RootErrorBoundary>\n                 </HeroUIProvider>\ndiff --git a/apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/_components/anonymous-to-signin-prompt.tsx b/apps/www/app/(main)/(home)/(pr-review)/[teamSlugOrId]/[repo]/_components/anonymous-to-signin-prompt.tsx\nsimilarity index 100%\nrename from apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/_components/anonymous-to-signin-prompt.tsx\nrename to apps/www/app/(main)/(home)/(pr-review)/[teamSlugOrId]/[repo]/_components/anonymous-to-signin-prompt.tsx\ndiff --git a/apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/_components/private-repo-prompt.tsx b/apps/www/app/(main)/(home)/(pr-review)/[teamSlugOrId]/[repo]/_components/private-repo-prompt.tsx\nsimilarity index 100%\nrename from apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/_components/private-repo-prompt.tsx\nrename to apps/www/app/(main)/(home)/(pr-review)/[teamSlugOrId]/[repo]/_components/private-repo-prompt.tsx\ndiff --git a/apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/_components/public-repo-anonymous-prompt.tsx b/apps/www/app/(main)/(home)/(pr-review)/[teamSlugOrId]/[repo]/_components/public-repo-anonymous-prompt.tsx\nsimilarity index 100%\nrename from apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/_components/public-repo-anonymous-prompt.tsx\nrename to apps/www/app/(main)/(home)/(pr-review)/[teamSlugOrId]/[repo]/_components/public-repo-anonymous-prompt.tsx\ndiff --git a/apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/_components/review-diff-content.tsx b/apps/www/app/(main)/(home)/(pr-review)/[teamSlugOrId]/[repo]/_components/review-diff-content.tsx\nsimilarity index 100%\nrename from apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/_components/review-diff-content.tsx\nrename to apps/www/app/(main)/(home)/(pr-review)/[teamSlugOrId]/[repo]/_components/review-diff-content.tsx\ndiff --git a/apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/_components/team-onboarding-prompt.tsx b/apps/www/app/(main)/(home)/(pr-review)/[teamSlugOrId]/[repo]/_components/team-onboarding-prompt.tsx\nsimilarity index 100%\nrename from apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/_components/team-onboarding-prompt.tsx\nrename to apps/www/app/(main)/(home)/(pr-review)/[teamSlugOrId]/[repo]/_components/team-onboarding-prompt.tsx\ndiff --git a/apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/compare/[comparison]/[...segments]/page.tsx b/apps/www/app/(main)/(home)/(pr-review)/[teamSlugOrId]/[repo]/compare/[comparison]/[...segments]/page.tsx\nsimilarity index 100%\nrename from apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/compare/[comparison]/[...segments]/page.tsx\nrename to apps/www/app/(main)/(home)/(pr-review)/[teamSlugOrId]/[repo]/compare/[comparison]/[...segments]/page.tsx\ndiff --git a/apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/compare/[comparison]/not-found.tsx b/apps/www/app/(main)/(home)/(pr-review)/[teamSlugOrId]/[repo]/compare/[comparison]/not-found.tsx\nsimilarity index 100%\nrename from apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/compare/[comparison]/not-found.tsx\nrename to apps/www/app/(main)/(home)/(pr-review)/[teamSlugOrId]/[repo]/compare/[comparison]/not-found.tsx\ndiff --git a/apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/compare/[comparison]/page.tsx b/apps/www/app/(main)/(home)/(pr-review)/[teamSlugOrId]/[repo]/compare/[comparison]/page.tsx\nsimilarity index 100%\nrename from apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/compare/[comparison]/page.tsx\nrename to apps/www/app/(main)/(home)/(pr-review)/[teamSlugOrId]/[repo]/compare/[comparison]/page.tsx\ndiff --git a/apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/pull/[pullNumber]/[...segments]/page.tsx b/apps/www/app/(main)/(home)/(pr-review)/[teamSlugOrId]/[repo]/pull/[pullNumber]/[...segments]/page.tsx\nsimilarity index 100%\nrename from apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/pull/[pullNumber]/[...segments]/page.tsx\nrename to apps/www/app/(main)/(home)/(pr-review)/[teamSlugOrId]/[repo]/pull/[pullNumber]/[...segments]/page.tsx\ndiff --git a/apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/pull/[pullNumber]/auth/page.tsx b/apps/www/app/(main)/(home)/(pr-review)/[teamSlugOrId]/[repo]/pull/[pullNumber]/auth/page.tsx\nsimilarity index 100%\nrename from apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/pull/[pullNumber]/auth/page.tsx\nrename to apps/www/app/(main)/(home)/(pr-review)/[teamSlugOrId]/[repo]/pull/[pullNumber]/auth/page.tsx\ndiff --git a/apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/pull/[pullNumber]/not-found.tsx b/apps/www/app/(main)/(home)/(pr-review)/[teamSlugOrId]/[repo]/pull/[pullNumber]/not-found.tsx\nsimilarity index 100%\nrename from apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/pull/[pullNumber]/not-found.tsx\nrename to apps/www/app/(main)/(home)/(pr-review)/[teamSlugOrId]/[repo]/pull/[pullNumber]/not-found.tsx\ndiff --git a/apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/pull/[pullNumber]/page.tsx b/apps/www/app/(main)/(home)/(pr-review)/[teamSlugOrId]/[repo]/pull/[pullNumber]/page.tsx\nsimilarity index 100%\nrename from apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/pull/[pullNumber]/page.tsx\nrename to apps/www/app/(main)/(home)/(pr-review)/[teamSlugOrId]/[repo]/pull/[pullNumber]/page.tsx\ndiff --git a/apps/www/app/(home)/(pr-review)/layout.tsx b/apps/www/app/(main)/(home)/(pr-review)/layout.tsx\nsimilarity index 100%\nrename from apps/www/app/(home)/(pr-review)/layout.tsx\nrename to apps/www/app/(main)/(home)/(pr-review)/layout.tsx\ndiff --git a/apps/www/app/(home)/connect-complete/page.tsx b/apps/www/app/(main)/(home)/connect-complete/page.tsx\nsimilarity index 100%\nrename from apps/www/app/(home)/connect-complete/page.tsx\nrename to apps/www/app/(main)/(home)/connect-complete/page.tsx\ndiff --git a/apps/www/app/(home)/handler/[...stack]/page.tsx b/apps/www/app/(main)/(home)/handler/[...stack]/page.tsx\nsimilarity index 100%\nrename from apps/www/app/(home)/handler/[...stack]/page.tsx\nrename to apps/www/app/(main)/(home)/handler/[...stack]/page.tsx\ndiff --git a/apps/www/app/(home)/handler/after-sign-in/OpenCmuxClient.tsx b/apps/www/app/(main)/(home)/handler/after-sign-in/OpenCmuxClient.tsx\nsimilarity index 100%\nrename from apps/www/app/(home)/handler/after-sign-in/OpenCmuxClient.tsx\nrename to apps/www/app/(main)/(home)/handler/after-sign-in/OpenCmuxClient.tsx\ndiff --git a/apps/www/app/(home)/handler/after-sign-in/page.tsx b/apps/www/app/(main)/(home)/handler/after-sign-in/page.tsx\nsimilarity index 100%\nrename from apps/www/app/(home)/handler/after-sign-in/page.tsx\nrename to apps/www/app/(main)/(home)/handler/after-sign-in/page.tsx\ndiff --git a/apps/www/app/(home)/loading.tsx b/apps/www/app/(main)/(home)/loading.tsx\nsimilarity index 100%\nrename from apps/www/app/(home)/loading.tsx\nrename to apps/www/app/(main)/(home)/loading.tsx\ndiff --git a/apps/www/app/(home)/tutorial/page.tsx b/apps/www/app/(main)/(home)/tutorial/page.tsx\nsimilarity index 100%\nrename from apps/www/app/(home)/tutorial/page.tsx\nrename to apps/www/app/(main)/(home)/tutorial/page.tsx\ndiff --git a/apps/www/app/(pr-review)/github-install-complete/page.tsx b/apps/www/app/(main)/(pr-review)/github-install-complete/page.tsx\nsimilarity index 100%\nrename from apps/www/app/(pr-review)/github-install-complete/page.tsx\nrename to apps/www/app/(main)/(pr-review)/github-install-complete/page.tsx\ndiff --git a/apps/www/app/direct-download-macos/page.tsx b/apps/www/app/(main)/direct-download-macos/page.tsx\nsimilarity index 97%\nrename from apps/www/app/direct-download-macos/page.tsx\nrename to apps/www/app/(main)/direct-download-macos/page.tsx\nindex 8582c8c81..971c4c15c 100644\n--- a/apps/www/app/direct-download-macos/page.tsx\n+++ b/apps/www/app/(main)/direct-download-macos/page.tsx\n@@ -1,7 +1,7 @@\n import { waitUntil } from \"@vercel/functions\";\n import { unstable_cache as cache } from \"next/cache\";\n \n-import { DirectDownloadRedirector } from \"@/app/direct-download-macos/redirector\";\n+import { DirectDownloadRedirector } from \"@/app/(main)/direct-download-macos/redirector\";\n import {\n   fetchLatestRelease,\n   type ReleaseInfo,\ndiff --git a/apps/www/app/direct-download-macos/redirector.tsx b/apps/www/app/(main)/direct-download-macos/redirector.tsx\nsimilarity index 100%\nrename from apps/www/app/direct-download-macos/redirector.tsx\nrename to apps/www/app/(main)/direct-download-macos/redirector.tsx\ndiff --git a/apps/www/app/heatmap/page.tsx b/apps/www/app/(main)/heatmap/page.tsx\nsimilarity index 100%\nrename from apps/www/app/heatmap/page.tsx\nrename to apps/www/app/(main)/heatmap/page.tsx\ndiff --git a/apps/www/app/(main)/layout.tsx b/apps/www/app/(main)/layout.tsx\nnew file mode 100644\nindex 000000000..c276aa54b\n--- /dev/null\n+++ b/apps/www/app/(main)/layout.tsx\n@@ -0,0 +1,20 @@\n+import type { ReactNode } from \"react\";\n+\n+import { SentryScopeProvider } from \"@/components/providers/sentry-scope-provider\";\n+import { stackServerApp } from \"@/lib/utils/stack\";\n+import { StackProvider, StackTheme } from \"@stackframe/stack\";\n+\n+export default function MainLayout({\n+  children,\n+}: Readonly<{\n+  children: ReactNode;\n+}>) {\n+  return (\n+    <StackTheme>\n+      <StackProvider app={stackServerApp}>\n+        <SentryScopeProvider />\n+        {children}\n+      </StackProvider>\n+    </StackTheme>\n+  );\n+}\ndiff --git a/apps/www/app/page.tsx b/apps/www/app/(main)/page.tsx\nsimilarity index 100%\nrename from apps/www/app/page.tsx\nrename to apps/www/app/(main)/page.tsx\ndiff --git a/apps/www/app/sentry-example-page/page.tsx b/apps/www/app/(main)/sentry-example-page/page.tsx\nsimilarity index 100%\nrename from apps/www/app/sentry-example-page/page.tsx\nrename to apps/www/app/(main)/sentry-example-page/page.tsx\ndiff --git a/apps/www/app/layout.tsx b/apps/www/app/layout.tsx\nindex bf32f1412..c699d44a7 100644\n--- a/apps/www/app/layout.tsx\n+++ b/apps/www/app/layout.tsx\n@@ -1,11 +1,8 @@\n-import type { ReactNode } from \"react\";\n import type { Metadata } from \"next\";\n+import type { ReactNode } from \"react\";\n import { JetBrains_Mono } from \"next/font/google\";\n import { Geist } from \"next/font/google\";\n \n-import { stackServerApp } from \"@/lib/utils/stack\";\n-import { StackProvider, StackTheme } from \"@stackframe/stack\";\n-\n import clsx from \"clsx\";\n import \"./globals.css\";\n \n@@ -66,9 +63,7 @@ export default function RootLayout({\n             '\"JetBrains Mono\",\"SFMono-Regular\",\"Menlo\",\"Consolas\",\"ui-monospace\",\"Monaco\",\"Courier New\",monospace',\n         }}\n       >\n-        <StackTheme>\n-          <StackProvider app={stackServerApp}>{children}</StackProvider>\n-        </StackTheme>\n+        {children}\n       </body>\n     </html>\n   );\ndiff --git a/apps/www/components/providers/sentry-scope-provider.tsx b/apps/www/components/providers/sentry-scope-provider.tsx\nnew file mode 100644\nindex 000000000..ae15d240f\n--- /dev/null\n+++ b/apps/www/components/providers/sentry-scope-provider.tsx\n@@ -0,0 +1,23 @@\n+\"use client\";\n+\n+import * as Sentry from \"@sentry/nextjs\";\n+import { useEffect } from \"react\";\n+import { useStackApp } from \"@stackframe/stack\";\n+\n+export function SentryScopeProvider() {\n+  const stackApp = useStackApp();\n+  const user = stackApp.useUser({ or: \"return-null\" });\n+\n+  useEffect(() => {\n+    if (user) {\n+      Sentry.setUser({ id: user.id, email: user.primaryEmail ?? undefined });\n+      Sentry.setTag(\"team_id\", user.selectedTeam?.id ?? \"unknown\");\n+      return;\n+    }\n+\n+    Sentry.setUser(null);\n+    Sentry.setTag(\"team_id\", \"unknown\");\n+  }, [user?.id, user?.primaryEmail, user?.selectedTeam?.id]);\n+\n+  return null;\n+}\ndiff --git a/apps/www/instrumentation-client.ts b/apps/www/instrumentation-client.ts\nindex b8b79a68b..11434d37f 100644\n--- a/apps/www/instrumentation-client.ts\n+++ b/apps/www/instrumentation-client.ts\n@@ -44,4 +44,4 @@ posthog.init(process.env.NEXT_PUBLIC_POSTHOG_KEY!, {\n   debug: process.env.NODE_ENV === \"development\",\n });\n \n-export const onRouterTransitionStart = Sentry.captureRouterTransitionStart;\n\\ No newline at end of file\n+export const onRouterTransitionStart = Sentry.captureRouterTransitionStart;\ndiff --git a/apps/www/lib/utils/sentry.ts b/apps/www/lib/utils/sentry.ts\nnew file mode 100644\nindex 000000000..a1774d261\n--- /dev/null\n+++ b/apps/www/lib/utils/sentry.ts\n@@ -0,0 +1,50 @@\n+import type { ErrorEvent } from \"@sentry/nextjs\";\n+import { stackServerApp } from \"@/lib/utils/stack\";\n+\n+function buildRequestFromEvent(event: ErrorEvent): Request | null {\n+  if (!event.request?.headers) return null;\n+\n+  const headers = new Headers();\n+  const headerEntries = Object.entries(event.request.headers as Record<string, unknown>);\n+  for (const [key, value] of headerEntries) {\n+    if (typeof value === \"string\") {\n+      headers.set(key, value);\n+      continue;\n+    }\n+\n+    if (Array.isArray(value)) {\n+      headers.set(key, value.join(\", \"));\n+    }\n+  }\n+\n+  const url = typeof event.request.url === \"string\" ? event.request.url : \"https://cmux.local\";\n+  return new Request(url, { headers });\n+}\n+\n+export async function attachStackAuthToEvent(event: ErrorEvent): Promise<ErrorEvent> {\n+  const request = buildRequestFromEvent(event);\n+  if (!request) return event;\n+\n+  try {\n+    const user = await stackServerApp.getUser({ tokenStore: request, or: \"return-null\" });\n+    if (!user) {\n+      return event;\n+    }\n+\n+    const existingUser = event.user ?? {};\n+    event.user = {\n+      ...existingUser,\n+      id: user.id,\n+      email: user.primaryEmail ?? existingUser.email,\n+    };\n+\n+    event.tags = {\n+      ...event.tags,\n+      team_id: user.selectedTeam?.id ?? \"unknown\",\n+    };\n+  } catch (error) {\n+    console.error(\"[sentry] Failed to attach Stack Auth user\", error);\n+  }\n+\n+  return event;\n+}\ndiff --git a/apps/www/sentry.edge.config.ts b/apps/www/sentry.edge.config.ts\nindex 18a0f5087..b243c9d1e 100644\n--- a/apps/www/sentry.edge.config.ts\n+++ b/apps/www/sentry.edge.config.ts\n@@ -5,6 +5,7 @@\n \n import * as Sentry from \"@sentry/nextjs\";\n import { SENTRY_RELEASE } from \"@/lib/sentry-release\";\n+import { attachStackAuthToEvent } from \"@/lib/utils/sentry\";\n \n Sentry.init({\n   dsn: \"https://96214f39aa409867381a22a79ff3e6a4@o4507547940749312.ingest.us.sentry.io/4510308518854656\",\n@@ -19,4 +20,5 @@ Sentry.init({\n   // Enable sending user PII (Personally Identifiable Information)\n   // https://docs.sentry.io/platforms/javascript/guides/nextjs/configuration/options/#sendDefaultPii\n   sendDefaultPii: true,\n+  beforeSend: (event, _hint) => attachStackAuthToEvent(event),\n });\ndiff --git a/apps/www/sentry.server.config.ts b/apps/www/sentry.server.config.ts\nindex dcffc9648..fa57b22f8 100644\n--- a/apps/www/sentry.server.config.ts\n+++ b/apps/www/sentry.server.config.ts\n@@ -4,6 +4,7 @@\n \n import * as Sentry from \"@sentry/nextjs\";\n import { SENTRY_RELEASE } from \"@/lib/sentry-release\";\n+import { attachStackAuthToEvent } from \"@/lib/utils/sentry\";\n \n Sentry.init({\n   dsn: \"https://96214f39aa409867381a22a79ff3e6a4@o4507547940749312.ingest.us.sentry.io/4510308518854656\",\n@@ -18,4 +19,5 @@ Sentry.init({\n   // Enable sending user PII (Personally Identifiable Information)\n   // https://docs.sentry.io/platforms/javascript/guides/nextjs/configuration/options/#sendDefaultPii\n   sendDefaultPii: true,\n+  beforeSend: (event, _hint) => attachStackAuthToEvent(event),\n });\n","comments":[{"type":"issue_comment","id":3561894138,"prNumber":1015,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 1 screenshot(s) for commit `6ce34ab`:\n\n### dashboard-HEAD.png\n![dashboard-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/5cde108f-e110-4063-b32e-d9a278f15226)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"556851f197e35e89b68b4a83df42933048c495e1","createdAt":"2025-11-21T08:09:15Z","updatedAt":"2025-11-21T08:09:15Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1015#issuecomment-3561894138"},{"type":"issue_comment","id":3562028365,"prNumber":1015,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 10 screenshot(s) for commit `d8d0cb4`:\n\n### anonymous-to-signin-prompt-HEAD.png\n![anonymous-to-signin-prompt-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/f7db2d0c-35ab-43b5-bd28-072bdbc0ba69)\n\n### anonymous-to-signin-prompt-dark-HEAD.png\n![anonymous-to-signin-prompt-dark-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/12b5b0aa-e6af-4832-9cbb-9ca2ba360fef)\n\n### homepage-HEAD.png\n![homepage-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/551e16f3-a4cd-4203-9f51-8a1f116a0dd9)\n\n### not-found-HEAD.png\n![not-found-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/5e3a1e95-9b0b-4e22-9ffc-1ddae6fda81a)\n\n### not-found-dark-HEAD.png\n![not-found-dark-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/5aa65633-13ba-451b-b0bd-a55b48236059)\n\n### private-repo-prompt-HEAD.png\n![private-repo-prompt-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/1e34694f-cd03-4483-914a-22ea4d0935be)\n\n### public-repo-anonymous-prompt-HEAD.png\n![public-repo-anonymous-prompt-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/908a82c9-3847-4c6b-bc45-e1d563f896b0)\n\n### public-repo-anonymous-prompt-dark-HEAD.png\n![public-repo-anonymous-prompt-dark-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/92acbf43-9711-40a1-94b1-f8b174719964)\n\n### team-onboarding-prompt-HEAD.png\n![team-onboarding-prompt-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/b346de93-716a-417d-8325-6626b66494a7)\n\n### team-onboarding-prompt-dark-HEAD.png\n![team-onboarding-prompt-dark-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/cca168ae-d5e1-4f44-a57c-7360b48cf58b)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"556851f197e35e89b68b4a83df42933048c495e1","createdAt":"2025-11-21T08:53:23Z","updatedAt":"2025-11-21T08:53:23Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1015#issuecomment-3562028365"}]}
{"number":1014,"title":"webview actions vscode focus 0","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1014","headRef":"webview-actions-vscode-focus-0","headSha":"a84e0aba91f9eddde8d7a936048e805a91253752","baseRef":"main","baseSha":"904dba6c3f4c29ccee669e836a005ec83b3460a4","createdAt":"2025-11-21T07:06:45Z","updatedAt":"2025-11-21T08:55:44Z","diff":"diff --git a/apps/client/electron/main/index.ts b/apps/client/electron/main/index.ts\nindex 645248b0b..aef0ea8e1 100644\n--- a/apps/client/electron/main/index.ts\n+++ b/apps/client/electron/main/index.ts\n@@ -14,7 +14,6 @@ import {\n   net,\n   session,\n   shell,\n-  webFrameMain,\n   type BrowserWindowConstructorOptions,\n   type MenuItemConstructorOptions,\n } from \"electron\";\n@@ -48,6 +47,10 @@ import {\n   startPreviewProxy,\n } from \"./task-run-preview-proxy\";\n import { normalizeBrowserUrl } from \"@cmux/shared\";\n+import {\n+  ELECTRON_WINDOW_FOCUS_EVENT,\n+  type ElectronRendererEventMap,\n+} from \"../../src/types/electron-events\";\n \n // Use a cookieable HTTPS origin intercepted locally instead of a custom scheme.\n const PARTITION = \"persist:cmux\";\n@@ -681,25 +684,6 @@ function createWindow(): void {\n     }\n   );\n \n-  mainWindow.webContents.on(\n-    \"did-frame-finish-load\",\n-    (_event, isMainFrame, frameProcessId, frameRoutingId) => {\n-      let frameUrl: string | null = null;\n-      try {\n-        frameUrl =\n-          webFrameMain.fromId(frameProcessId, frameRoutingId)?.url ?? null;\n-      } catch (error) {\n-        frameUrl = `lookup-failed:${String(error)}`;\n-      }\n-      mainLog(\"did-frame-finish-load\", {\n-        isMainFrame,\n-        frameProcessId,\n-        frameRoutingId,\n-        frameUrl,\n-      });\n-    }\n-  );\n-\n   mainWindow.webContents.on(\"did-navigate\", (_e, url) => {\n     mainLog(\"did-navigate\", { url });\n   });\n@@ -733,6 +717,16 @@ app.on(\"browser-window-created\", (_event, window) => {\n \n app.on(\"browser-window-focus\", (_event, window) => {\n   updateHistoryMenuState(window);\n+  try {\n+    const payload: ElectronRendererEventMap[typeof ELECTRON_WINDOW_FOCUS_EVENT] =\n+      { windowId: window.id };\n+    window.webContents.send(\n+      `cmux:event:${ELECTRON_WINDOW_FOCUS_EVENT}`,\n+      payload\n+    );\n+  } catch (error) {\n+    mainWarn(\"Failed to emit window focus event to renderer\", error);\n+  }\n });\n \n app.on(\"login\", (event, webContents, _request, authInfo, callback) => {\ndiff --git a/apps/client/electron/main/web-contents-view.ts b/apps/client/electron/main/web-contents-view.ts\nindex ad98fe877..ae54cea8b 100644\n--- a/apps/client/electron/main/web-contents-view.ts\n+++ b/apps/client/electron/main/web-contents-view.ts\n@@ -1354,6 +1354,28 @@ export function registerWebContentsViewHandlers({\n     }\n   );\n \n+  ipcMain.handle(\"cmux:webcontents:is-focused\", (event, id: number) => {\n+    if (typeof id !== \"number\") return { ok: false, focused: false };\n+    const entry = viewEntries.get(id);\n+    if (!entry) return { ok: false, focused: false };\n+    if (event.sender.id !== entry.ownerWebContentsId) {\n+      return { ok: false, focused: false };\n+    }\n+    entry.ownerSender = event.sender;\n+    try {\n+      const ownerWindow = BrowserWindow.fromId(entry.ownerWindowId);\n+      const focused =\n+        Boolean(ownerWindow?.isFocused()) && entry.view.webContents.isFocused();\n+      return { ok: true, focused };\n+    } catch (error) {\n+      logger.warn(\"Failed to check WebContentsView focus\", {\n+        id,\n+        error,\n+      });\n+      return { ok: false, focused: false };\n+    }\n+  });\n+\n   ipcMain.handle(\"cmux:webcontents:get-state\", (event, id: number) => {\n     if (typeof id !== \"number\") return { ok: false };\n     const entry = viewEntries.get(id);\ndiff --git a/apps/client/electron/preload/index.ts b/apps/client/electron/preload/index.ts\nindex c8da91dc4..c59f27e68 100644\n--- a/apps/client/electron/preload/index.ts\n+++ b/apps/client/electron/preload/index.ts\n@@ -239,6 +239,11 @@ const cmuxAPI = {\n       ipcRenderer.invoke(\"cmux:webcontents:update-style\", options) as Promise<{\n         ok: boolean;\n       }>,\n+    isFocused: (id: number) =>\n+      ipcRenderer.invoke(\"cmux:webcontents:is-focused\", id) as Promise<{\n+        ok: boolean;\n+        focused: boolean;\n+      }>,\n     goBack: (id: number) =>\n       ipcRenderer.invoke(\"cmux:webcontents:go-back\", id) as Promise<{\n         ok: boolean;\ndiff --git a/apps/client/src/components/TaskTree.tsx b/apps/client/src/components/TaskTree.tsx\nindex 874359b6b..d7832b260 100644\n--- a/apps/client/src/components/TaskTree.tsx\n+++ b/apps/client/src/components/TaskTree.tsx\n@@ -1912,12 +1912,11 @@ function TaskRunDetails({\n     <Fragment>\n       {hasActiveVSCode ? (\n         <TaskRunDetailLink\n-          to=\"/$teamSlugOrId/task/$taskId/run/$runId\"\n+          to=\"/$teamSlugOrId/task/$taskId/run/$runId/vscode\"\n           params={{\n             teamSlugOrId,\n             taskId,\n             runId: run._id,\n-            taskRunId: run._id,\n           }}\n           icon={\n             <VSCodeIcon className=\"w-3 h-3 mr-2 text-neutral-400 grayscale opacity-60\" />\ndiff --git a/apps/client/src/components/electron-web-contents-view.tsx b/apps/client/src/components/electron-web-contents-view.tsx\nindex 381a707f1..569067139 100644\n--- a/apps/client/src/components/electron-web-contents-view.tsx\n+++ b/apps/client/src/components/electron-web-contents-view.tsx\n@@ -7,6 +7,11 @@ import {\n } from \"react\";\n import type { CSSProperties, ReactNode } from \"react\";\n \n+import {\n+  registerWebviewActions,\n+  unregisterWebviewActions,\n+  type WebviewActions,\n+} from \"@/lib/webview-actions\";\n import { isElectron } from \"@/lib/electron\";\n import { cn } from \"@/lib/utils\";\n \n@@ -158,6 +163,7 @@ export function ElectronWebContentsView({\n }: ElectronWebContentsViewProps) {\n   const containerRef = useRef<HTMLDivElement | null>(null);\n   const viewIdRef = useRef<number | null>(null);\n+  const webContentsIdRef = useRef<number | null>(null);\n   const rafRef = useRef<number | null>(null);\n   const continuousSyncRef = useRef<number | null>(null);\n   const continuousActiveRef = useRef(false);\n@@ -175,6 +181,7 @@ export function ElectronWebContentsView({\n     borderRadius,\n   });\n   const hasStableAttachmentRef = useRef(false);\n+  const registeredActionsRef = useRef<WebviewActions | null>(null);\n   const isIntersectingRef = useRef(true);\n   const scrollCleanupsRef = useRef<Array<() => void>>([]);\n   const lastTransformStateRef = useRef(false);\n@@ -310,6 +317,77 @@ export function ElectronWebContentsView({\n \n   persistKeyRef.current = persistKey;\n \n+  const unregisterActions = useCallback(() => {\n+    if (!persistKeyRef.current || !registeredActionsRef.current) {\n+      return;\n+    }\n+    unregisterWebviewActions(persistKeyRef.current, registeredActionsRef.current);\n+    registeredActionsRef.current = null;\n+  }, []);\n+\n+  const registerActions = useCallback(\n+    (webContentsId: number) => {\n+      const key = persistKeyRef.current;\n+      if (!key) return;\n+      webContentsIdRef.current = webContentsId;\n+      const actions: WebviewActions = {\n+        focus: async () => {\n+          if (typeof window === \"undefined\") return false;\n+\n+          const targetId = webContentsIdRef.current;\n+          if (targetId === null) return false;\n+\n+          try {\n+            const restore = window.cmux?.ui?.restoreLastFocusInWebContents;\n+            if (restore) {\n+              const result = await restore(targetId);\n+              if (result?.ok) {\n+                return true;\n+              }\n+            }\n+\n+            const focus = window.cmux?.ui?.focusWebContents;\n+            if (focus) {\n+              const result = await focus(targetId);\n+              return result?.ok ?? false;\n+            }\n+          } catch (error) {\n+            console.error(\"Failed to focus WebContentsView\", error);\n+            return false;\n+          }\n+\n+          return false;\n+        },\n+        isFocused: async () => {\n+          if (typeof window === \"undefined\") return false;\n+\n+          const viewId = viewIdRef.current;\n+          if (viewId === null) return false;\n+\n+          try {\n+            const checkFocus = window.cmux?.webContentsView?.isFocused;\n+            if (!checkFocus) return false;\n+            const result = await checkFocus(viewId);\n+            return result?.ok === true && result.focused === true;\n+          } catch (error) {\n+            console.error(\"Failed to check WebContentsView focus\", error);\n+            return false;\n+          }\n+        },\n+      };\n+      registeredActionsRef.current = actions;\n+      registerWebviewActions(key, actions);\n+    },\n+    [],\n+  );\n+\n+  useEffect(() => {\n+    return () => {\n+      unregisterActions();\n+      webContentsIdRef.current = null;\n+    };\n+  }, [unregisterActions]);\n+\n   const releaseNativeView = useCallback(\n     (id: number, key: string | undefined) => {\n       const bridge = getWebContentsBridge();\n@@ -369,6 +447,8 @@ export function ElectronWebContentsView({\n   const releaseView = useCallback(() => {\n     cancelScheduledSync();\n     stopContinuousSync();\n+    unregisterActions();\n+    webContentsIdRef.current = null;\n     const id = viewIdRef.current;\n     if (id === null) return;\n     viewIdRef.current = null;\n@@ -380,6 +460,7 @@ export function ElectronWebContentsView({\n     onNativeViewDestroyed?.();\n   }, [\n     cancelScheduledSync,\n+    unregisterActions,\n     onNativeViewDestroyed,\n     releaseNativeView,\n     stopContinuousSync,\n@@ -456,6 +537,7 @@ export function ElectronWebContentsView({\n             restored: result.restored,\n           });\n           viewIdRef.current = result.id;\n+          registerActions(result.webContentsId);\n           hasStableAttachmentRef.current = true;\n           onNativeViewReady?.(result);\n           const targetUrl = latestSrcRef.current;\n@@ -512,6 +594,7 @@ export function ElectronWebContentsView({\n     releaseNativeView,\n     releaseView,\n     scheduleBoundsSync,\n+    registerActions,\n     onNativeViewDestroyed,\n     onNativeViewReady,\n   ]);\ndiff --git a/apps/client/src/components/persistent-iframe.tsx b/apps/client/src/components/persistent-iframe.tsx\nindex ec6f6c014..bafcdfa27 100644\n--- a/apps/client/src/components/persistent-iframe.tsx\n+++ b/apps/client/src/components/persistent-iframe.tsx\n@@ -11,6 +11,11 @@ import { createPortal } from \"react-dom\";\n \n import { useIframePreflight } from \"../hooks/useIframePreflight\";\n import { usePersistentIframe } from \"../hooks/usePersistentIframe\";\n+import {\n+  registerWebviewActions,\n+  unregisterWebviewActions,\n+} from \"@/lib/webview-actions\";\n+import { persistentIframeManager } from \"@/lib/persistentIframeManager\";\n import { cn } from \"@/lib/utils\";\n \n export type PersistentIframeStatus = \"loading\" | \"loaded\" | \"error\";\n@@ -273,6 +278,22 @@ export function PersistentIframe({\n \n   const effectiveStatus = forcedStatus ?? status;\n \n+  const focusIframe = useCallback(() => {\n+    return persistentIframeManager.focusIframe(persistKey);\n+  }, [persistKey]);\n+\n+  const isIframeFocused = useCallback(() => {\n+    return persistentIframeManager.isIframeFocused(persistKey);\n+  }, [persistKey]);\n+\n+  useEffect(() => {\n+    const actions = { focus: focusIframe, isFocused: isIframeFocused };\n+    registerWebviewActions(persistKey, actions);\n+    return () => {\n+      unregisterWebviewActions(persistKey, actions);\n+    };\n+  }, [focusIframe, isIframeFocused, persistKey]);\n+\n   useEffect(() => {\n     onStatusChange?.(effectiveStatus);\n   }, [effectiveStatus, onStatusChange]);\ndiff --git a/apps/client/src/hooks/useElectronWindowFocus.ts b/apps/client/src/hooks/useElectronWindowFocus.ts\nnew file mode 100644\nindex 000000000..24bddeb9f\n--- /dev/null\n+++ b/apps/client/src/hooks/useElectronWindowFocus.ts\n@@ -0,0 +1,45 @@\n+import { useEffect } from \"react\";\n+\n+import { isElectron } from \"@/lib/electron\";\n+import {\n+  ELECTRON_WINDOW_FOCUS_EVENT,\n+  type ElectronRendererEventMap,\n+} from \"@/types/electron-events\";\n+\n+type WindowFocusPayload =\n+  ElectronRendererEventMap[typeof ELECTRON_WINDOW_FOCUS_EVENT];\n+\n+function isWindowFocusPayload(payload: unknown): payload is WindowFocusPayload {\n+  return (\n+    typeof payload === \"object\" &&\n+    payload !== null &&\n+    \"windowId\" in payload &&\n+    typeof (payload as { windowId?: unknown }).windowId === \"number\"\n+  );\n+}\n+\n+export function useElectronWindowFocus(\n+  onFocus: (payload: WindowFocusPayload) => void\n+): void {\n+  useEffect(() => {\n+    if (!isElectron) return;\n+    if (typeof window === \"undefined\") return;\n+    const cmux = window.cmux;\n+    if (!cmux?.on) return;\n+\n+    const handler = (payload: unknown) => {\n+      if (!isWindowFocusPayload(payload)) return;\n+      onFocus(payload);\n+    };\n+\n+    const unsubscribe = cmux.on(ELECTRON_WINDOW_FOCUS_EVENT, handler);\n+\n+    return () => {\n+      try {\n+        unsubscribe?.();\n+      } catch (error) {\n+        console.error(\"Failed to unsubscribe from Electron window focus\", error);\n+      }\n+    };\n+  }, [onFocus]);\n+}\ndiff --git a/apps/client/src/hooks/useWebviewActions.ts b/apps/client/src/hooks/useWebviewActions.ts\nnew file mode 100644\nindex 000000000..686004c43\n--- /dev/null\n+++ b/apps/client/src/hooks/useWebviewActions.ts\n@@ -0,0 +1,28 @@\n+import { useCallback, useMemo } from \"react\";\n+\n+import { focusWebview, isWebviewFocused } from \"@/lib/webview-actions\";\n+\n+interface UseWebviewActionsOptions {\n+  persistKey: string;\n+}\n+\n+interface UseWebviewActionsResult {\n+  focus: () => Promise<boolean>;\n+  isFocused: () => Promise<boolean>;\n+}\n+\n+export function useWebviewActions({\n+  persistKey,\n+}: UseWebviewActionsOptions): UseWebviewActionsResult {\n+  const focus = useCallback(() => {\n+    return focusWebview(persistKey);\n+  }, [persistKey]);\n+\n+  const isFocused = useCallback(() => {\n+    return isWebviewFocused(persistKey);\n+  }, [persistKey]);\n+\n+  return useMemo(() => {\n+    return { focus, isFocused };\n+  }, [focus, isFocused]);\n+}\ndiff --git a/apps/client/src/lib/iframeFocusGuard.ts b/apps/client/src/lib/iframeFocusGuard.ts\nnew file mode 100644\nindex 000000000..d9c5e44d2\n--- /dev/null\n+++ b/apps/client/src/lib/iframeFocusGuard.ts\n@@ -0,0 +1,123 @@\n+let focusGuardInitialized = false;\n+let lastActiveElement: Element | null = null;\n+\n+const isFocusableElement = (\n+  element: Element | null\n+): element is HTMLElement | SVGElement => {\n+  return Boolean(\n+    element &&\n+      \"focus\" in element &&\n+      typeof (element as HTMLElement | SVGElement).focus === \"function\"\n+  );\n+};\n+\n+const hasVisibleAncestors = (element: Element): boolean => {\n+  let current: Element | null = element;\n+\n+  while (current && current !== document.documentElement) {\n+    if (current instanceof HTMLElement) {\n+      const style = window.getComputedStyle(current);\n+      if (\n+        style.display === \"none\" ||\n+        style.visibility === \"hidden\" ||\n+        style.pointerEvents === \"none\"\n+      ) {\n+        return false;\n+      }\n+    }\n+\n+    current = current.parentElement;\n+  }\n+\n+  return true;\n+};\n+\n+const isIframeVisibleOnScreen = (iframe: HTMLIFrameElement): boolean => {\n+  if (typeof window === \"undefined\" || typeof document === \"undefined\") {\n+    return true;\n+  }\n+\n+  if (!iframe.isConnected) {\n+    return false;\n+  }\n+\n+  const style = window.getComputedStyle(iframe);\n+  if (\n+    style.visibility === \"hidden\" ||\n+    style.display === \"none\" ||\n+    style.pointerEvents === \"none\"\n+  ) {\n+    return false;\n+  }\n+\n+  if (!hasVisibleAncestors(iframe)) {\n+    return false;\n+  }\n+\n+  if (iframe.getClientRects().length === 0) {\n+    return false;\n+  }\n+\n+  const rect = iframe.getBoundingClientRect();\n+  if (rect.width <= 0 || rect.height <= 0) {\n+    return false;\n+  }\n+\n+  const viewportWidth =\n+    window.innerWidth || document.documentElement.clientWidth || 0;\n+  const viewportHeight =\n+    window.innerHeight || document.documentElement.clientHeight || 0;\n+\n+  const horizontallyVisible = rect.right > 0 && rect.left < viewportWidth;\n+  const verticallyVisible = rect.bottom > 0 && rect.top < viewportHeight;\n+\n+  return horizontallyVisible && verticallyVisible;\n+};\n+\n+export const ensureIframeFocusGuard = (): void => {\n+  if (focusGuardInitialized || typeof document === \"undefined\") {\n+    return;\n+  }\n+\n+  focusGuardInitialized = true;\n+  lastActiveElement = document.activeElement;\n+\n+  const handleFocusIn = (event: FocusEvent) => {\n+    const target = event.target;\n+\n+    if (!(target instanceof Element)) {\n+      return;\n+    }\n+\n+    if (target instanceof HTMLIFrameElement) {\n+      if (!isIframeVisibleOnScreen(target)) {\n+        const previousElement = lastActiveElement;\n+\n+        if (isFocusableElement(previousElement)) {\n+          try {\n+            previousElement.focus({ preventScroll: true });\n+          } catch (error) {\n+            console.error(\n+              \"Failed to restore focus after blocked iframe focus attempt\",\n+              error\n+            );\n+          }\n+        }\n+\n+        const activeElement = document.activeElement;\n+        lastActiveElement =\n+          activeElement instanceof Element\n+            ? activeElement\n+            : previousElement ?? null;\n+        return;\n+      }\n+\n+      lastActiveElement = target;\n+      return;\n+    }\n+\n+    lastActiveElement = target;\n+  };\n+\n+  document.addEventListener(\"focusin\", handleFocusIn, true);\n+};\ndiff --git a/apps/client/src/lib/persistentIframeManager.ts b/apps/client/src/lib/persistentIframeManager.ts\nindex 05a4d4bd1..2d9d7276d 100644\n--- a/apps/client/src/lib/persistentIframeManager.ts\n+++ b/apps/client/src/lib/persistentIframeManager.ts\n@@ -1,3 +1,5 @@\n+import { ensureIframeFocusGuard } from \"./iframeFocusGuard\";\n+\n // Extend the Element interface to include moveBefore\n declare global {\n   interface Element {\n@@ -101,6 +103,8 @@ class PersistentIframeManager {\n   private initializeContainer() {\n     if (typeof document === \"undefined\") return;\n \n+    ensureIframeFocusGuard();\n+\n     const init = () => {\n       this.container = document.createElement(\"div\");\n       this.container.id = \"persistent-iframe-container\";\n@@ -562,6 +566,39 @@ class PersistentIframeManager {\n     entry.wrapper.style.height = `${viewportHeight}px`;\n     entry.wrapper.style.transform = `translate(-${viewportWidth}px, -${viewportHeight}px)`;\n   }\n+\n+  isIframeFocused(key: string): boolean {\n+    if (typeof document === \"undefined\") {\n+      return false;\n+    }\n+\n+    const entry = this.iframes.get(key);\n+    if (!entry || !entry.isVisible) return false;\n+\n+    return document.activeElement === entry.iframe;\n+  }\n+\n+  focusIframe(key: string): boolean {\n+    const entry = this.iframes.get(key);\n+    if (!entry) return false;\n+\n+    const isHidden =\n+      entry.wrapper.style.visibility === \"hidden\" ||\n+      entry.wrapper.style.pointerEvents === \"none\";\n+\n+    if (isHidden) {\n+      return false;\n+    }\n+\n+    try {\n+      entry.iframe.focus();\n+      entry.iframe.contentWindow?.focus();\n+      return true;\n+    } catch (error) {\n+      console.error(`Failed to focus iframe \"${key}\"`, error);\n+      return false;\n+    }\n+  }\n }\n \n // Export singleton instance\ndiff --git a/apps/client/src/lib/webview-actions.ts b/apps/client/src/lib/webview-actions.ts\nnew file mode 100644\nindex 000000000..bbbbc7702\n--- /dev/null\n+++ b/apps/client/src/lib/webview-actions.ts\n@@ -0,0 +1,64 @@\n+import { persistentIframeManager } from \"./persistentIframeManager\";\n+\n+export interface WebviewActions {\n+  focus?: () => Promise<boolean> | boolean;\n+  isFocused?: () => Promise<boolean> | boolean;\n+}\n+\n+const registry = new Map<string, WebviewActions>();\n+\n+export function registerWebviewActions(\n+  persistKey: string,\n+  actions: WebviewActions,\n+): void {\n+  registry.set(persistKey, actions);\n+}\n+\n+export function unregisterWebviewActions(\n+  persistKey: string,\n+  actions?: WebviewActions,\n+): void {\n+  const existing = registry.get(persistKey);\n+  if (!existing) return;\n+  if (!actions || existing === actions) {\n+    registry.delete(persistKey);\n+  }\n+}\n+\n+export function getWebviewActions(persistKey: string): WebviewActions | null {\n+  return registry.get(persistKey) ?? null;\n+}\n+\n+export async function focusWebview(persistKey: string): Promise<boolean> {\n+  const actions = registry.get(persistKey);\n+\n+  if (actions?.focus) {\n+    try {\n+      const result = await actions.focus();\n+      return Boolean(result);\n+    } catch (error) {\n+      console.error(`Failed to focus webview \"${persistKey}\"`, error);\n+      return false;\n+    }\n+  }\n+\n+  return persistentIframeManager.focusIframe(persistKey);\n+}\n+\n+export async function isWebviewFocused(persistKey: string): Promise<boolean> {\n+  const actions = registry.get(persistKey);\n+\n+  if (actions?.isFocused) {\n+    try {\n+      const result = await actions.isFocused();\n+      return Boolean(result);\n+    } catch (error) {\n+      console.error(\n+        `Failed to check focus for webview \"${persistKey}\"`,\n+        error,\n+      );\n+    }\n+  }\n+\n+  return persistentIframeManager.isIframeFocused(persistKey);\n+}\ndiff --git a/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.index.tsx b/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.index.tsx\nindex 3410e7477..99cda3994 100644\n--- a/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.index.tsx\n+++ b/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.index.tsx\n@@ -1,176 +1,21 @@\n-import { api } from \"@cmux/convex/api\";\n import { typedZid } from \"@cmux/shared/utils/typed-zid\";\n-import { convexQuery } from \"@convex-dev/react-query\";\n-import { createFileRoute } from \"@tanstack/react-router\";\n-import { useQuery } from \"convex/react\";\n-import clsx from \"clsx\";\n-import { useCallback, useEffect, useMemo, useState } from \"react\";\n-import { PersistentWebView } from \"@/components/persistent-webview\";\n-import type { PersistentIframeStatus } from \"@/components/persistent-iframe\";\n-import { WorkspaceLoadingIndicator } from \"@/components/workspace-loading-indicator\";\n-import { getTaskRunPersistKey } from \"@/lib/persistent-webview-keys\";\n-import { toProxyWorkspaceUrl } from \"@/lib/toProxyWorkspaceUrl\";\n-import {\n-  TASK_RUN_IFRAME_ALLOW,\n-  TASK_RUN_IFRAME_SANDBOX,\n-  preloadTaskRunIframes,\n-} from \"../lib/preloadTaskRunIframes\";\n-import { shouldUseServerIframePreflight } from \"@/hooks/useIframePreflight\";\n-import {\n-  localVSCodeServeWebQueryOptions,\n-  useLocalVSCodeServeWebQuery,\n-} from \"@/queries/local-vscode-serve-web\";\n-import { convexQueryClient } from \"@/contexts/convex/convex-query-client\";\n-import { ResumeWorkspaceOverlay } from \"@/components/resume-workspace-overlay\";\n+import { createFileRoute, redirect } from \"@tanstack/react-router\";\n \n export const Route = createFileRoute(\n   \"/_layout/$teamSlugOrId/task/$taskId/run/$runId/\"\n )({\n-  component: TaskRunComponent,\n   parseParams: (params) => ({\n     ...params,\n     taskRunId: typedZid(\"taskRuns\").parse(params.runId),\n   }),\n-  loader: async (opts) => {\n-    convexQueryClient.convexClient.prewarmQuery({\n-      query: api.taskRuns.get,\n-      args: {\n-        teamSlugOrId: opts.params.teamSlugOrId,\n-        id: opts.params.taskRunId,\n+  beforeLoad: ({ params }) => {\n+    throw redirect({\n+      to: \"/$teamSlugOrId/task/$taskId/run/$runId/vscode\",\n+      params: {\n+        teamSlugOrId: params.teamSlugOrId,\n+        taskId: params.taskId,\n+        runId: params.taskRunId,\n       },\n     });\n-\n-    void (async () => {\n-      const [result, localServeWeb] = await Promise.all([\n-        opts.context.queryClient.ensureQueryData(\n-          convexQuery(api.taskRuns.get, {\n-            teamSlugOrId: opts.params.teamSlugOrId,\n-            id: opts.params.taskRunId,\n-          })\n-        ),\n-        opts.context.queryClient.ensureQueryData(\n-          localVSCodeServeWebQueryOptions()\n-        ),\n-      ]);\n-      if (result) {\n-        const workspaceUrl = result.vscode?.workspaceUrl;\n-        void preloadTaskRunIframes([\n-          {\n-            url: workspaceUrl\n-              ? toProxyWorkspaceUrl(workspaceUrl, localServeWeb.baseUrl)\n-              : \"\",\n-            taskRunId: opts.params.taskRunId,\n-          },\n-        ]);\n-      }\n-    })();\n   },\n });\n-\n-function TaskRunComponent() {\n-  const { taskRunId, teamSlugOrId } = Route.useParams();\n-  const localServeWeb = useLocalVSCodeServeWebQuery();\n-  const taskRun = useQuery(api.taskRuns.get, {\n-    teamSlugOrId,\n-    id: taskRunId,\n-  });\n-\n-  const rawWorkspaceUrl = taskRun?.vscode?.workspaceUrl ?? null;\n-  const workspaceUrl = rawWorkspaceUrl\n-    ? toProxyWorkspaceUrl(rawWorkspaceUrl, localServeWeb.data?.baseUrl)\n-    : null;\n-  const disablePreflight = rawWorkspaceUrl\n-    ? shouldUseServerIframePreflight(rawWorkspaceUrl)\n-    : false;\n-  const persistKey = getTaskRunPersistKey(taskRunId);\n-  const hasWorkspace = workspaceUrl !== null;\n-  const isLocalWorkspace = taskRun?.vscode?.provider === \"other\";\n-  const [iframeStatus, setIframeStatus] =\n-    useState<PersistentIframeStatus>(\"loading\");\n-\n-  useEffect(() => {\n-    setIframeStatus(\"loading\");\n-  }, [workspaceUrl]);\n-\n-  const onLoad = useCallback(() => {\n-    console.log(`Workspace view loaded for task run ${taskRunId}`);\n-  }, [taskRunId]);\n-\n-  const onError = useCallback(\n-    (error: Error) => {\n-      console.error(\n-        `Failed to load workspace view for task run ${taskRunId}:`,\n-        error\n-      );\n-    },\n-    [taskRunId]\n-  );\n-\n-  const loadingFallback = useMemo(\n-    () =>\n-      isLocalWorkspace ? null : (\n-        <WorkspaceLoadingIndicator variant=\"vscode\" status=\"loading\" />\n-      ),\n-    [isLocalWorkspace]\n-  );\n-  const errorFallback = useMemo(\n-    () => <WorkspaceLoadingIndicator variant=\"vscode\" status=\"error\" />,\n-    []\n-  );\n-\n-  const isEditorBusy = !hasWorkspace || iframeStatus !== \"loaded\";\n-\n-  return (\n-    <div className=\"flex flex-col grow bg-neutral-50 dark:bg-black\">\n-      <div className=\"flex flex-col grow min-h-0 border-l border-neutral-200 dark:border-neutral-800\">\n-        <div\n-          className=\"flex flex-row grow min-h-0 relative\"\n-          aria-busy={isEditorBusy}\n-        >\n-          {workspaceUrl ? (\n-            <PersistentWebView\n-              persistKey={persistKey}\n-              src={workspaceUrl}\n-              className=\"grow flex relative\"\n-              iframeClassName=\"select-none\"\n-              allow={TASK_RUN_IFRAME_ALLOW}\n-              sandbox={TASK_RUN_IFRAME_SANDBOX}\n-              preflight={!disablePreflight}\n-              retainOnUnmount\n-              suspended={!hasWorkspace}\n-              onLoad={onLoad}\n-              onError={onError}\n-              fallback={loadingFallback}\n-              fallbackClassName=\"bg-neutral-50 dark:bg-black\"\n-              errorFallback={errorFallback}\n-              errorFallbackClassName=\"bg-neutral-50/95 dark:bg-black/95\"\n-              onStatusChange={setIframeStatus}\n-              loadTimeoutMs={60_000}\n-            />\n-          ) : (\n-            <div className=\"grow\" />\n-          )}\n-          {!isLocalWorkspace ? (\n-            <div\n-              className={clsx(\n-                \"absolute inset-0 flex items-center justify-center transition pointer-events-none\",\n-                {\n-                  \"opacity-100\": !hasWorkspace,\n-                  \"opacity-0\": hasWorkspace,\n-                }\n-              )}\n-            >\n-              <WorkspaceLoadingIndicator variant=\"vscode\" status=\"loading\" />\n-            </div>\n-          ) : null}\n-          {taskRun ? (\n-            <ResumeWorkspaceOverlay\n-              taskRun={taskRun}\n-              teamSlugOrId={teamSlugOrId}\n-            />\n-          ) : null}\n-        </div>\n-      </div>\n-    </div>\n-  );\n-}\ndiff --git a/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.vscode.tsx b/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.vscode.tsx\nindex 4ae615706..22fbd68f9 100644\n--- a/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.vscode.tsx\n+++ b/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.vscode.tsx\n@@ -22,6 +22,8 @@ import {\n } from \"@/queries/local-vscode-serve-web\";\n import { convexQueryClient } from \"@/contexts/convex/convex-query-client\";\n import { ResumeWorkspaceOverlay } from \"@/components/resume-workspace-overlay\";\n+import { useElectronWindowFocus } from \"@/hooks/useElectronWindowFocus\";\n+import { useWebviewActions } from \"@/hooks/useWebviewActions\";\n \n const paramsSchema = z.object({\n   taskId: typedZid(\"tasks\"),\n@@ -94,6 +96,7 @@ function VSCodeComponent() {\n   const persistKey = getTaskRunPersistKey(taskRunId);\n   const hasWorkspace = workspaceUrl !== null;\n   const isLocalWorkspace = taskRun?.vscode?.provider === \"other\";\n+  const webviewActions = useWebviewActions({ persistKey });\n \n   const [iframeStatus, setIframeStatus] =\n     useState<PersistentIframeStatus>(\"loading\");\n@@ -103,7 +106,8 @@ function VSCodeComponent() {\n \n   const onLoad = useCallback(() => {\n     console.log(`Workspace view loaded for task run ${taskRunId}`);\n-  }, [taskRunId]);\n+    void webviewActions.focus();\n+  }, [taskRunId, webviewActions]);\n \n   const onError = useCallback(\n     (error: Error) => {\n@@ -129,6 +133,28 @@ function VSCodeComponent() {\n \n   const isEditorBusy = !hasWorkspace || iframeStatus !== \"loaded\";\n \n+  const focusWebviewIfReady = useCallback(() => {\n+    if (!workspaceUrl) return;\n+    if (iframeStatus !== \"loaded\") return;\n+    void webviewActions.focus();\n+  }, [iframeStatus, webviewActions, workspaceUrl]);\n+\n+  useEffect(() => {\n+    focusWebviewIfReady();\n+  }, [focusWebviewIfReady]);\n+\n+  const handleElectronWindowFocus = useCallback(() => {\n+    void (async () => {\n+      const alreadyFocused = await webviewActions.isFocused();\n+      if (alreadyFocused) {\n+        return;\n+      }\n+      focusWebviewIfReady();\n+    })();\n+  }, [focusWebviewIfReady, webviewActions]);\n+\n+  useElectronWindowFocus(handleElectronWindowFocus);\n+\n   return (\n     <div className=\"flex flex-col grow bg-neutral-50 dark:bg-black\">\n       <div className=\"flex flex-col grow min-h-0 border-l border-neutral-200 dark:border-neutral-800\">\ndiff --git a/apps/client/src/types/electron-events.ts b/apps/client/src/types/electron-events.ts\nnew file mode 100644\nindex 000000000..3877c0112\n--- /dev/null\n+++ b/apps/client/src/types/electron-events.ts\n@@ -0,0 +1,9 @@\n+export const ELECTRON_WINDOW_FOCUS_EVENT = \"window-focus\" as const;\n+\n+export interface ElectronWindowFocusEventPayload {\n+  windowId: number;\n+}\n+\n+export interface ElectronRendererEventMap {\n+  [ELECTRON_WINDOW_FOCUS_EVENT]: ElectronWindowFocusEventPayload;\n+}\ndiff --git a/apps/client/src/types/electron.d.ts b/apps/client/src/types/electron.d.ts\nindex f3fdcc88c..4cbde4186 100644\n--- a/apps/client/src/types/electron.d.ts\n+++ b/apps/client/src/types/electron.d.ts\n@@ -81,6 +81,9 @@ interface CmuxWebContentsViewAPI {\n     options?: { mode?: ElectronDevToolsMode }\n   ) => Promise<{ ok: boolean }>;\n   closeDevTools: (id: number) => Promise<{ ok: boolean }>;\n+  isFocused: (\n+    id: number\n+  ) => Promise<{ ok: boolean; focused: boolean }>;\n }\n \n interface CmuxAPI {\n","comments":[{"type":"issue_comment","id":3561796388,"prNumber":1014,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 1 screenshot(s) for commit `6228559`:\n\n### dashboard-main-view-HEAD.png\n![dashboard-main-view-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/07558abf-c4be-42f6-a71f-7aa00b25ad3b)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"a84e0aba91f9eddde8d7a936048e805a91253752","createdAt":"2025-11-21T07:31:05Z","updatedAt":"2025-11-21T07:31:05Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1014#issuecomment-3561796388"},{"type":"issue_comment","id":3562008245,"prNumber":1014,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 3 screenshot(s) for commit `a84e0ab`:\n\n### dashboard-full-page-HEAD.png\n![dashboard-full-page-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/0350d9a6-5ea2-4fc7-996a-51ca104e22ce)\n\n### pr-1014-diff-view-HEAD.png\n![pr-1014-diff-view-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/d273f8ea-f2e2-4273-9323-c12484829c54)\n\n### task-detail-sidebar-HEAD.png\n![task-detail-sidebar-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/0696d681-7fb6-4051-9c76-c54123e73a3a)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"a84e0aba91f9eddde8d7a936048e805a91253752","createdAt":"2025-11-21T08:46:31Z","updatedAt":"2025-11-21T08:46:31Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1014#issuecomment-3562008245"}]}
{"number":1010,"title":"Use OpenAPI client for Morph resume actions","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1010","headRef":"codex/add-endpoint-to-resume-morph-vm-instance","headSha":"3ede127524bbca04aa5274c5a107c6db71a0e348","baseRef":"main","baseSha":"a4309a950e574b73513467d4b1b24d74116295a2","createdAt":"2025-11-20T01:43:18Z","updatedAt":"2025-11-21T08:01:52Z","diff":"diff --git a/apps/client/src/components/TaskTree.tsx b/apps/client/src/components/TaskTree.tsx\nindex 203d514f2..874359b6b 100644\n--- a/apps/client/src/components/TaskTree.tsx\n+++ b/apps/client/src/components/TaskTree.tsx\n@@ -6,6 +6,7 @@ import {\n } from \"@/components/ui/tooltip\";\n import { convexQueryClient } from \"@/contexts/convex/convex-query-client\";\n import { useArchiveTask } from \"@/hooks/useArchiveTask\";\n+import { useResumeMorphWorkspace } from \"@/hooks/useMorphWorkspace\";\n import { useOpenWithActions } from \"@/hooks/useOpenWithActions\";\n import { useTaskRename } from \"@/hooks/useTaskRename\";\n import { isElectron } from \"@/lib/electron\";\n@@ -19,7 +20,12 @@ import {\n   aggregatePullRequestState,\n   type RunPullRequestState,\n } from \"@cmux/shared/pull-request-state\";\n-import { Link, useLocation, useNavigate, type LinkProps } from \"@tanstack/react-router\";\n+import {\n+  Link,\n+  useLocation,\n+  useNavigate,\n+  type LinkProps,\n+} from \"@tanstack/react-router\";\n import clsx from \"clsx\";\n import { useMutation, useQuery } from \"convex/react\";\n import { toast } from \"sonner\";\n@@ -47,6 +53,7 @@ import {\n   Pencil,\n   Pin,\n   PinOff,\n+  Play,\n   Plus,\n   TerminalSquare,\n   Loader2,\n@@ -527,20 +534,31 @@ function TaskTreeInner({\n       const now = Date.now();\n \n       // Update the task in the main task list\n-      const tasks = localStore.getQuery(api.tasks.get, { teamSlugOrId: args.teamSlugOrId });\n+      const tasks = localStore.getQuery(api.tasks.get, {\n+        teamSlugOrId: args.teamSlugOrId,\n+      });\n       if (tasks) {\n-        const updatedTasks = tasks.map(t =>\n+        const updatedTasks = tasks.map((t) =>\n           t._id === args.id ? { ...t, pinned: true, updatedAt: now } : t\n         );\n-        localStore.setQuery(api.tasks.get, { teamSlugOrId: args.teamSlugOrId }, updatedTasks);\n+        localStore.setQuery(\n+          api.tasks.get,\n+          { teamSlugOrId: args.teamSlugOrId },\n+          updatedTasks\n+        );\n       }\n \n       // Update the pinned items query\n-      const pinned = localStore.getQuery(api.tasks.getPinned, { teamSlugOrId: args.teamSlugOrId }) || [];\n-      const taskToPin = tasks?.find(t => t._id === args.id);\n+      const pinned =\n+        localStore.getQuery(api.tasks.getPinned, {\n+          teamSlugOrId: args.teamSlugOrId,\n+        }) || [];\n+      const taskToPin = tasks?.find((t) => t._id === args.id);\n       if (taskToPin) {\n         // Insert at the beginning since it's the most recently updated\n-        localStore.setQuery(api.tasks.getPinned, { teamSlugOrId: args.teamSlugOrId },\n+        localStore.setQuery(\n+          api.tasks.getPinned,\n+          { teamSlugOrId: args.teamSlugOrId },\n           [{ ...taskToPin, pinned: true, updatedAt: now }, ...pinned]\n         );\n       }\n@@ -552,18 +570,29 @@ function TaskTreeInner({\n       const now = Date.now();\n \n       // Update the task in the main task list\n-      const tasks = localStore.getQuery(api.tasks.get, { teamSlugOrId: args.teamSlugOrId });\n+      const tasks = localStore.getQuery(api.tasks.get, {\n+        teamSlugOrId: args.teamSlugOrId,\n+      });\n       if (tasks) {\n-        const updatedTasks = tasks.map(t =>\n+        const updatedTasks = tasks.map((t) =>\n           t._id === args.id ? { ...t, pinned: false, updatedAt: now } : t\n         );\n-        localStore.setQuery(api.tasks.get, { teamSlugOrId: args.teamSlugOrId }, updatedTasks);\n+        localStore.setQuery(\n+          api.tasks.get,\n+          { teamSlugOrId: args.teamSlugOrId },\n+          updatedTasks\n+        );\n       }\n \n       // Update the pinned items query\n-      const pinned = localStore.getQuery(api.tasks.getPinned, { teamSlugOrId: args.teamSlugOrId }) || [];\n-      localStore.setQuery(api.tasks.getPinned, { teamSlugOrId: args.teamSlugOrId },\n-        pinned.filter(t => t._id !== args.id)\n+      const pinned =\n+        localStore.getQuery(api.tasks.getPinned, {\n+          teamSlugOrId: args.teamSlugOrId,\n+        }) || [];\n+      localStore.setQuery(\n+        api.tasks.getPinned,\n+        { teamSlugOrId: args.teamSlugOrId },\n+        pinned.filter((t) => t._id !== args.id)\n       );\n     }\n   );\n@@ -1187,7 +1216,6 @@ function TaskRunTreeInner({\n     onArchiveToggle(run._id, true);\n   }, [onArchiveToggle, run._id]);\n \n-\n   const isLocalWorkspaceRunEntry = run.isLocalWorkspace;\n   const isCloudWorkspaceRunEntry = run.isCloudWorkspace;\n \n@@ -1363,6 +1391,22 @@ function TaskRunTreeInner({\n     networking: run.networking,\n   });\n \n+  const resumeWorkspace = useResumeMorphWorkspace({\n+    taskRunId: run._id,\n+    teamSlugOrId,\n+  });\n+\n+  const handleResumeWorkspace = useCallback(() => {\n+    if (resumeWorkspace.isPending) {\n+      return;\n+    }\n+\n+    void resumeWorkspace.mutateAsync({\n+      path: { taskRunId: run._id },\n+      body: { teamSlugOrId },\n+    });\n+  }, [resumeWorkspace, run._id, teamSlugOrId]);\n+\n   const shouldRenderDiffLink = true;\n   const shouldRenderBrowserLink = run.vscode?.provider === \"morph\";\n   const shouldRenderTerminalLink = shouldRenderBrowserLink;\n@@ -1454,6 +1498,16 @@ function TaskRunTreeInner({\n                   Copy branch name\n                 </ContextMenu.Item>\n               ) : null}\n+              {run.vscode?.provider === \"morph\" ? (\n+                <ContextMenu.Item\n+                  className=\"flex items-center gap-2 cursor-default py-1.5 pr-8 pl-3 text-[13px] leading-5 outline-none select-none data-[highlighted]:relative data-[highlighted]:z-0 data-[highlighted]:text-white data-[highlighted]:before:absolute data-[highlighted]:before:inset-x-1 data-[highlighted]:before:inset-y-0 data-[highlighted]:before:z-[-1] data-[highlighted]:before:rounded-sm data-[highlighted]:before:bg-neutral-900 dark:data-[highlighted]:before:bg-neutral-700\"\n+                  onClick={handleResumeWorkspace}\n+                  disabled={resumeWorkspace.isPending}\n+                >\n+                  <Play className=\"w-3.5 h-3.5\" />\n+                  {resumeWorkspace.isPending ? \"Resuming…\" : \"Resume VM\"}\n+                </ContextMenu.Item>\n+              ) : null}\n               {hasOpenWithActions ? (\n                 <ContextMenu.SubmenuRoot>\n                   <ContextMenu.SubmenuTrigger className=\"flex items-center gap-2 cursor-default py-1.5 pr-4 pl-3 text-[13px] leading-5 outline-none select-none data-[highlighted]:relative data-[highlighted]:z-0 data-[highlighted]:text-white data-[highlighted]:before:absolute data-[highlighted]:before:inset-x-1 data-[highlighted]:before:inset-y-0 data-[highlighted]:before:z-[-1] data-[highlighted]:before:rounded-sm data-[highlighted]:before:bg-neutral-900 dark:data-[highlighted]:before:bg-neutral-700\">\n@@ -1595,19 +1649,26 @@ interface AddPreviewInputProps {\n   teamSlugOrId: string;\n }\n \n-function AddPreviewInput({ indentLevel, onAdd, currentCount, taskId, runId, teamSlugOrId }: AddPreviewInputProps) {\n+function AddPreviewInput({\n+  indentLevel,\n+  onAdd,\n+  currentCount,\n+  taskId,\n+  runId,\n+  teamSlugOrId,\n+}: AddPreviewInputProps) {\n   const navigate = useNavigate();\n \n   const handleClick = () => {\n     // Use next index as optimistic previewId\n     const previewId = String(currentCount);\n-    \n+\n     // Navigate immediately (optimistic)\n     void navigate({\n       to: \"/$teamSlugOrId/task/$taskId/run/$runId/preview/$previewId\",\n       params: { teamSlugOrId, taskId, runId, previewId },\n     });\n-    \n+\n     // Persist in background\n     void onAdd(\"about:blank\").catch((error) => {\n       console.error(\"Failed to create preview\", error);\n@@ -1669,60 +1730,68 @@ function TaskRunDetails({\n }: TaskRunDetailsProps) {\n   const location = useLocation();\n   const navigate = useNavigate();\n-  \n+\n   // Extract current previewId from URL if on preview route\n-  const currentPreviewId = location.pathname.includes('/preview/') \n-    ? location.pathname.split('/preview/')[1]?.split('/')[0]\n+  const currentPreviewId = location.pathname.includes(\"/preview/\")\n+    ? location.pathname.split(\"/preview/\")[1]?.split(\"/\")[0]\n     : undefined;\n-  \n-  const addCustomPreview = useMutation(api.taskRuns.addCustomPreview).withOptimisticUpdate(\n-    (localStore, args) => {\n-      const newPreview = {\n-        url: args.url,\n-        createdAt: Date.now(),\n-      };\n-      \n-      // Update all queries that might have this task run\n-      const taskRunsQuery = localStore.getQuery(api.taskRuns.getByTask, {\n-        teamSlugOrId: args.teamSlugOrId,\n-        taskId,\n-      });\n-      \n-      if (taskRunsQuery) {\n-        localStore.setQuery(\n-          api.taskRuns.getByTask,\n-          { teamSlugOrId: args.teamSlugOrId, taskId },\n-          taskRunsQuery.map((r) =>\n-            r._id === args.runId\n-              ? { ...r, customPreviews: [...(r.customPreviews || []), newPreview] }\n-              : r\n-          )\n-        );\n-      }\n+\n+  const addCustomPreview = useMutation(\n+    api.taskRuns.addCustomPreview\n+  ).withOptimisticUpdate((localStore, args) => {\n+    const newPreview = {\n+      url: args.url,\n+      createdAt: Date.now(),\n+    };\n+\n+    // Update all queries that might have this task run\n+    const taskRunsQuery = localStore.getQuery(api.taskRuns.getByTask, {\n+      teamSlugOrId: args.teamSlugOrId,\n+      taskId,\n+    });\n+\n+    if (taskRunsQuery) {\n+      localStore.setQuery(\n+        api.taskRuns.getByTask,\n+        { teamSlugOrId: args.teamSlugOrId, taskId },\n+        taskRunsQuery.map((r) =>\n+          r._id === args.runId\n+            ? {\n+                ...r,\n+                customPreviews: [...(r.customPreviews || []), newPreview],\n+              }\n+            : r\n+        )\n+      );\n     }\n-  );\n-  \n-  const removeCustomPreview = useMutation(api.taskRuns.removeCustomPreview).withOptimisticUpdate(\n-    (localStore, args) => {\n-      // Update all queries that might have this task run\n-      const taskRunsQuery = localStore.getQuery(api.taskRuns.getByTask, {\n-        teamSlugOrId: args.teamSlugOrId,\n-        taskId,\n-      });\n-      \n-      if (taskRunsQuery) {\n-        localStore.setQuery(\n-          api.taskRuns.getByTask,\n-          { teamSlugOrId: args.teamSlugOrId, taskId },\n-          taskRunsQuery.map((r) =>\n-            r._id === args.runId\n-              ? { ...r, customPreviews: (r.customPreviews || []).filter((_, i) => i !== args.index) }\n-              : r\n-          )\n-        );\n-      }\n+  });\n+\n+  const removeCustomPreview = useMutation(\n+    api.taskRuns.removeCustomPreview\n+  ).withOptimisticUpdate((localStore, args) => {\n+    // Update all queries that might have this task run\n+    const taskRunsQuery = localStore.getQuery(api.taskRuns.getByTask, {\n+      teamSlugOrId: args.teamSlugOrId,\n+      taskId,\n+    });\n+\n+    if (taskRunsQuery) {\n+      localStore.setQuery(\n+        api.taskRuns.getByTask,\n+        { teamSlugOrId: args.teamSlugOrId, taskId },\n+        taskRunsQuery.map((r) =>\n+          r._id === args.runId\n+            ? {\n+                ...r,\n+                customPreviews: (r.customPreviews || []).filter(\n+                  (_, i) => i !== args.index\n+                ),\n+              }\n+            : r\n+        )\n+      );\n     }\n-  );\n+  });\n \n   const handleAddPreview = useCallback(\n     async (url: string): Promise<number> => {\n@@ -1754,30 +1823,53 @@ function TaskRunDetails({\n       // If we're currently viewing the tab being closed, navigate to another tab\n       if (currentPreviewId === String(index)) {\n         const remainingPreviews = customPreviews.filter((_, i) => i !== index);\n-        \n+\n         if (remainingPreviews.length > 0) {\n           // Navigate to previous tab (or next if it was the first)\n           const nextIndex = index > 0 ? index - 1 : 0;\n           void navigate({\n             to: \"/$teamSlugOrId/task/$taskId/run/$runId/preview/$previewId\",\n-            params: { teamSlugOrId, taskId, runId: run._id, previewId: String(nextIndex) },\n+            params: {\n+              teamSlugOrId,\n+              taskId,\n+              runId: run._id,\n+              previewId: String(nextIndex),\n+            },\n           });\n         } else if (previewServices.length > 0) {\n           // Navigate to first port preview if available\n           void navigate({\n             to: \"/$teamSlugOrId/task/$taskId/run/$runId/preview/$previewId\",\n-            params: { teamSlugOrId, taskId, runId: run._id, previewId: String(previewServices[0].port) },\n+            params: {\n+              teamSlugOrId,\n+              taskId,\n+              runId: run._id,\n+              previewId: String(previewServices[0].port),\n+            },\n           });\n         } else {\n           // No tabs left, navigate to main taskrun page\n           void navigate({\n             to: \"/$teamSlugOrId/task/$taskId/run/$runId\",\n-            params: { teamSlugOrId, taskId, runId: run._id, taskRunId: run._id },\n+            params: {\n+              teamSlugOrId,\n+              taskId,\n+              runId: run._id,\n+              taskRunId: run._id,\n+            },\n           });\n         }\n       }\n     },\n-    [removeCustomPreview, run._id, teamSlugOrId, customPreviews, previewServices, navigate, taskId]\n+    [\n+      removeCustomPreview,\n+      run._id,\n+      teamSlugOrId,\n+      customPreviews,\n+      previewServices,\n+      navigate,\n+      taskId,\n+    ]\n   );\n \n   if (!isExpanded) {\n@@ -1997,8 +2089,8 @@ function TaskRunDetails({\n         </div>\n       ))}\n \n-      <AddPreviewInput \n-        indentLevel={indentLevel} \n+      <AddPreviewInput\n+        indentLevel={indentLevel}\n         onAdd={handleAddPreview}\n         currentCount={customPreviews.length}\n         taskId={taskId}\ndiff --git a/apps/client/src/components/resume-workspace-overlay.tsx b/apps/client/src/components/resume-workspace-overlay.tsx\nnew file mode 100644\nindex 000000000..ee5318a8e\n--- /dev/null\n+++ b/apps/client/src/components/resume-workspace-overlay.tsx\n@@ -0,0 +1,78 @@\n+import { useCallback } from \"react\";\n+import clsx from \"clsx\";\n+import { Button } from \"@/components/ui/button\";\n+import type { Doc } from \"@cmux/convex/dataModel\";\n+import {\n+  useMorphInstancePauseQuery,\n+  useResumeMorphWorkspace,\n+} from \"@/hooks/useMorphWorkspace\";\n+\n+interface ResumeWorkspaceOverlayProps {\n+  taskRun: Doc<\"taskRuns\">;\n+  teamSlugOrId: string;\n+  className?: string;\n+  onResumed?: () => void;\n+}\n+\n+export function ResumeWorkspaceOverlay({\n+  taskRun,\n+  teamSlugOrId,\n+  className,\n+  onResumed,\n+}: ResumeWorkspaceOverlayProps) {\n+  const taskRunId = taskRun._id;\n+\n+  const pauseStatusQuery = useMorphInstancePauseQuery({\n+    taskRunId,\n+    teamSlugOrId,\n+  });\n+\n+  const isPaused = pauseStatusQuery.data?.paused === true;\n+\n+  const resumeWorkspace = useResumeMorphWorkspace({\n+    taskRunId,\n+    teamSlugOrId,\n+    onSuccess: onResumed,\n+  });\n+\n+  const handleResume = useCallback(async () => {\n+    if (!taskRun || !isPaused) {\n+      return;\n+    }\n+\n+    await resumeWorkspace.mutateAsync({\n+      path: { taskRunId },\n+      body: { teamSlugOrId },\n+    });\n+  }, [resumeWorkspace, isPaused, taskRun, taskRunId, teamSlugOrId]);\n+\n+  if (!isPaused) {\n+    return null;\n+  }\n+\n+  return (\n+    <div\n+      className={clsx(\n+        \"absolute inset-0 flex items-center justify-center bg-neutral-50/90 backdrop-blur-sm dark:bg-black/80\",\n+        className\n+      )}\n+    >\n+      <div className=\"rounded-lg border border-neutral-200/80 bg-white/90 p-4 text-center shadow-sm dark:border-neutral-800 dark:bg-neutral-900/80\">\n+        <p className=\"text-sm font-medium text-neutral-900 dark:text-neutral-50\">\n+          Workspace paused\n+        </p>\n+        <p className=\"mt-1 text-xs text-neutral-600 dark:text-neutral-400\">\n+          Resume your VM to reconnect VS Code.\n+        </p>\n+        <Button\n+          className=\"mt-3\"\n+          onClick={handleResume}\n+          disabled={resumeWorkspace.isPending}\n+          variant=\"default\"\n+        >\n+          {resumeWorkspace.isPending ? \"Resuming…\" : \"Resume VM\"}\n+        </Button>\n+      </div>\n+    </div>\n+  );\n+}\ndiff --git a/apps/client/src/hooks/useMorphWorkspace.ts b/apps/client/src/hooks/useMorphWorkspace.ts\nnew file mode 100644\nindex 000000000..0e05330c7\n--- /dev/null\n+++ b/apps/client/src/hooks/useMorphWorkspace.ts\n@@ -0,0 +1,98 @@\n+import { useMutation, useQuery } from \"@tanstack/react-query\";\n+import { useQuery as useConvexQuery } from \"convex/react\";\n+import {\n+  postApiMorphTaskRunsByTaskRunIdIsPaused,\n+  type Options,\n+  type PostApiMorphTaskRunsByTaskRunIdResumeData,\n+  type PostApiMorphTaskRunsByTaskRunIdResumeResponse,\n+} from \"@cmux/www-openapi-client\";\n+import { postApiMorphTaskRunsByTaskRunIdResumeMutation } from \"@cmux/www-openapi-client/react-query\";\n+import { toast } from \"sonner\";\n+import { queryClient } from \"@/query-client\";\n+import { api } from \"@cmux/convex/api\";\n+import { type Id } from \"@cmux/convex/dataModel\";\n+\n+interface MorphWorkspaceQueryArgs {\n+  taskRunId: Id<\"taskRuns\">;\n+  teamSlugOrId: string;\n+  enabled?: boolean;\n+}\n+\n+interface UseResumeMorphWorkspaceArgs {\n+  taskRunId: Id<\"taskRuns\">;\n+  teamSlugOrId: string;\n+  onSuccess?: () => void;\n+  onError?: (error: unknown) => void;\n+}\n+\n+export function morphPauseQueryKey(taskRunId: string, teamSlugOrId: string) {\n+  return [\"morph\", \"task-run\", taskRunId, \"paused\", teamSlugOrId] as const;\n+}\n+\n+export function useMorphInstancePauseQuery({\n+  taskRunId,\n+  teamSlugOrId,\n+  enabled,\n+}: MorphWorkspaceQueryArgs) {\n+  const taskRun = useConvexQuery(api.taskRuns.get, {\n+    teamSlugOrId,\n+    id: taskRunId,\n+  });\n+  const canResume = taskRun?.vscode?.provider === \"morph\";\n+  return useQuery({\n+    enabled: canResume && enabled,\n+    queryKey: morphPauseQueryKey(taskRunId, teamSlugOrId),\n+    queryFn: async ({ signal }) => {\n+      const { data } = await postApiMorphTaskRunsByTaskRunIdIsPaused({\n+        path: {\n+          taskRunId,\n+        },\n+        body: {\n+          teamSlugOrId,\n+        },\n+        signal,\n+        throwOnError: true,\n+      });\n+      return data;\n+    },\n+  });\n+}\n+\n+export function useResumeMorphWorkspace({\n+  taskRunId,\n+  teamSlugOrId,\n+  onSuccess,\n+  onError,\n+}: UseResumeMorphWorkspaceArgs) {\n+  return useMutation<\n+    PostApiMorphTaskRunsByTaskRunIdResumeResponse,\n+    Error,\n+    Options<PostApiMorphTaskRunsByTaskRunIdResumeData>,\n+    { toastId: string | number }\n+  >({\n+    ...postApiMorphTaskRunsByTaskRunIdResumeMutation(),\n+    mutationKey: [\"resume\", \"task-run\", taskRunId],\n+    onMutate: async () => {\n+      const toastId = toast.loading(\"Resuming workspace…\");\n+      return { toastId };\n+    },\n+    onSuccess: (_data, __, context) => {\n+      toast.success(\"Workspace resumed\", { id: context?.toastId });\n+      queryClient.setQueryData(morphPauseQueryKey(taskRunId, teamSlugOrId), {\n+        paused: false,\n+      });\n+      onSuccess?.();\n+    },\n+    onError: (error, _variables, context) => {\n+      const message =\n+        error instanceof Error ? error.message : \"Failed to resume VM.\";\n+      toast.error(message, { id: context?.toastId });\n+      onError?.(error);\n+    },\n+    onSettled: () => {\n+      void queryClient.invalidateQueries({\n+        queryKey: morphPauseQueryKey(taskRunId, teamSlugOrId),\n+      });\n+    },\n+  });\n+}\ndiff --git a/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.index.tsx b/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.index.tsx\nindex 593c24d0a..3410e7477 100644\n--- a/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.index.tsx\n+++ b/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.index.tsx\n@@ -21,6 +21,7 @@ import {\n   useLocalVSCodeServeWebQuery,\n } from \"@/queries/local-vscode-serve-web\";\n import { convexQueryClient } from \"@/contexts/convex/convex-query-client\";\n+import { ResumeWorkspaceOverlay } from \"@/components/resume-workspace-overlay\";\n \n export const Route = createFileRoute(\n   \"/_layout/$teamSlugOrId/task/$taskId/run/$runId/\"\n@@ -162,6 +163,12 @@ function TaskRunComponent() {\n               <WorkspaceLoadingIndicator variant=\"vscode\" status=\"loading\" />\n             </div>\n           ) : null}\n+          {taskRun ? (\n+            <ResumeWorkspaceOverlay\n+              taskRun={taskRun}\n+              teamSlugOrId={teamSlugOrId}\n+            />\n+          ) : null}\n         </div>\n       </div>\n     </div>\ndiff --git a/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.vscode.tsx b/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.vscode.tsx\nindex f8b93a463..4ae615706 100644\n--- a/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.vscode.tsx\n+++ b/apps/client/src/routes/_layout.$teamSlugOrId.task.$taskId.run.$runId.vscode.tsx\n@@ -21,6 +21,7 @@ import {\n   useLocalVSCodeServeWebQuery,\n } from \"@/queries/local-vscode-serve-web\";\n import { convexQueryClient } from \"@/contexts/convex/convex-query-client\";\n+import { ResumeWorkspaceOverlay } from \"@/components/resume-workspace-overlay\";\n \n const paramsSchema = z.object({\n   taskId: typedZid(\"tasks\"),\n@@ -163,6 +164,12 @@ function VSCodeComponent() {\n               <WorkspaceLoadingIndicator variant=\"vscode\" status=\"loading\" />\n             </div>\n           ) : null}\n+          {taskRun ? (\n+            <ResumeWorkspaceOverlay\n+              taskRun={taskRun}\n+              teamSlugOrId={teamSlugOrId}\n+            />\n+          ) : null}\n         </div>\n       </div>\n     </div>\ndiff --git a/apps/www/lib/routes/morph.route.ts b/apps/www/lib/routes/morph.route.ts\nindex ffa303157..853676ce2 100644\n--- a/apps/www/lib/routes/morph.route.ts\n+++ b/apps/www/lib/routes/morph.route.ts\n@@ -3,6 +3,7 @@ import {\n   MORPH_SNAPSHOT_PRESETS,\n   type MorphSnapshotId,\n } from \"@/lib/utils/morph-defaults\";\n+import { getAccessTokenFromRequest } from \"@/lib/utils/auth\";\n import { verifyTeamAccess } from \"@/lib/utils/team-verification\";\n import { env } from \"@/lib/utils/www-env\";\n import { createRoute, OpenAPIHono, z } from \"@hono/zod-openapi\";\n@@ -10,11 +11,14 @@ import { MorphCloudClient } from \"morphcloud\";\n import { getConvex } from \"../utils/get-convex\";\n import { selectGitIdentity } from \"../utils/gitIdentity\";\n import { stackServerAppJs } from \"../utils/stack\";\n+import { api } from \"@cmux/convex/api\";\n+import type { Id } from \"@cmux/convex/dataModel\";\n import {\n   configureGithubAccess,\n   configureGitIdentity,\n   fetchGitIdentityInputs,\n } from \"./sandboxes/git\";\n+import { typedZid } from \"@cmux/shared/utils/typed-zid\";\n \n export const morphRouter = new OpenAPIHono();\n \n@@ -46,6 +50,218 @@ const SetupInstanceResponse = z\n   })\n   .openapi(\"SetupInstanceResponse\");\n \n+const ResumeTaskRunBody = z\n+  .object({\n+    teamSlugOrId: z.string(),\n+  })\n+  .openapi(\"ResumeTaskRunBody\");\n+\n+const CheckTaskRunPausedBody = z\n+  .object({\n+    teamSlugOrId: z.string(),\n+  })\n+  .openapi(\"CheckTaskRunPausedBody\");\n+\n+const ResumeTaskRunResponse = z\n+  .object({\n+    resumed: z.literal(true),\n+  })\n+  .openapi(\"ResumeTaskRunResponse\");\n+\n+const CheckTaskRunPausedResponse = z\n+  .object({\n+    paused: z.boolean(),\n+  })\n+  .openapi(\"CheckTaskRunPausedResponse\");\n+\n+morphRouter.openapi(\n+  createRoute({\n+    method: \"post\" as const,\n+    path: \"/morph/task-runs/{taskRunId}/resume\",\n+    tags: [\"Morph\"],\n+    summary: \"Resume the Morph instance backing a task run\",\n+    request: {\n+      params: z.object({\n+        taskRunId: typedZid(\"taskRuns\"),\n+      }),\n+      body: {\n+        content: {\n+          \"application/json\": {\n+            schema: ResumeTaskRunBody,\n+          },\n+        },\n+        required: true,\n+      },\n+    },\n+    responses: {\n+      200: {\n+        content: {\n+          \"application/json\": {\n+            schema: ResumeTaskRunResponse,\n+          },\n+        },\n+        description: \"Morph instance resumed\",\n+      },\n+      400: { description: \"Task run is not backed by a Morph instance\" },\n+      401: { description: \"Unauthorized\" },\n+      403: { description: \"Forbidden\" },\n+      404: { description: \"Task run or instance not found\" },\n+      500: { description: \"Failed to resume instance\" },\n+    },\n+  }),\n+  async (c) => {\n+    const accessToken = await getAccessTokenFromRequest(c.req.raw);\n+    if (!accessToken) {\n+      return c.text(\"Unauthorized\", 401);\n+    }\n+\n+    const { taskRunId } = c.req.valid(\"param\");\n+    const { teamSlugOrId } = c.req.valid(\"json\");\n+\n+    const convex = getConvex({ accessToken });\n+    const team = await verifyTeamAccess({ req: c.req.raw, teamSlugOrId });\n+\n+    const taskRun = await convex.query(api.taskRuns.get, {\n+      teamSlugOrId,\n+      id: taskRunId,\n+    });\n+\n+    if (!taskRun) {\n+      return c.text(\"Task run not found\", 404);\n+    }\n+\n+    const instanceId = taskRun.vscode?.containerName;\n+    const isMorphProvider = taskRun.vscode?.provider === \"morph\";\n+\n+    if (!isMorphProvider || !instanceId) {\n+      return c.text(\"Task run is not backed by a Morph instance\", 400);\n+    }\n+\n+    try {\n+      const client = new MorphCloudClient({ apiKey: env.MORPH_API_KEY });\n+      const instance = await client.instances.get({ instanceId });\n+      void (async () => {\n+        try {\n+          await instance.setWakeOn(true, true);\n+        } catch (error) {\n+          console.error(\"[morph.resume-task-run] Failed to set wake on\", error);\n+        }\n+      })();\n+\n+      const metadataTeamId = (\n+        instance as unknown as {\n+          metadata?: { teamId?: string };\n+        }\n+      ).metadata?.teamId;\n+\n+      if (metadataTeamId && metadataTeamId !== team.uuid) {\n+        return c.text(\"Forbidden\", 403);\n+      }\n+\n+      await instance.resume();\n+\n+      await convex.mutation(api.taskRuns.updateVSCodeStatus, {\n+        teamSlugOrId,\n+        id: taskRunId as Id<\"taskRuns\">,\n+        status: \"running\",\n+      });\n+\n+      return c.json({ resumed: true });\n+    } catch (error) {\n+      console.error(\"[morph.resume-task-run] Failed to resume instance\", error);\n+      return c.text(\"Failed to resume instance\", 500);\n+    }\n+  }\n+);\n+\n+morphRouter.openapi(\n+  createRoute({\n+    method: \"post\" as const,\n+    path: \"/morph/task-runs/{taskRunId}/is-paused\",\n+    tags: [\"Morph\"],\n+    summary: \"Check if the Morph instance backing a task run is paused\",\n+    request: {\n+      params: z.object({\n+        taskRunId: typedZid(\"taskRuns\"),\n+      }),\n+      body: {\n+        content: {\n+          \"application/json\": {\n+            schema: CheckTaskRunPausedBody,\n+          },\n+        },\n+        required: true,\n+      },\n+    },\n+    responses: {\n+      200: {\n+        content: {\n+          \"application/json\": {\n+            schema: CheckTaskRunPausedResponse,\n+          },\n+        },\n+        description: \"Morph instance status returned\",\n+      },\n+      400: { description: \"Task run is not backed by a Morph instance\" },\n+      401: { description: \"Unauthorized\" },\n+      403: { description: \"Forbidden\" },\n+      404: { description: \"Task run or instance not found\" },\n+      500: { description: \"Failed to check instance status\" },\n+    },\n+  }),\n+  async (c) => {\n+    const accessToken = await getAccessTokenFromRequest(c.req.raw);\n+    if (!accessToken) {\n+      return c.text(\"Unauthorized\", 401);\n+    }\n+\n+    const { taskRunId } = c.req.valid(\"param\");\n+    const { teamSlugOrId } = c.req.valid(\"json\");\n+\n+    const convex = getConvex({ accessToken });\n+    const team = await verifyTeamAccess({ req: c.req.raw, teamSlugOrId });\n+\n+    const taskRun = await convex.query(api.taskRuns.get, {\n+      teamSlugOrId,\n+      id: taskRunId,\n+    });\n+\n+    if (!taskRun) {\n+      return c.text(\"Task run not found\", 404);\n+    }\n+\n+    const instanceId = taskRun.vscode?.containerName;\n+    const isMorphProvider = taskRun.vscode?.provider === \"morph\";\n+\n+    if (!isMorphProvider || !instanceId) {\n+      return c.text(\"Task run is not backed by a Morph instance\", 400);\n+    }\n+\n+    try {\n+      const client = new MorphCloudClient({ apiKey: env.MORPH_API_KEY });\n+      const instance = await client.instances.get({ instanceId });\n+\n+      const metadataTeamId = (\n+        instance as unknown as {\n+          metadata?: { teamId?: string };\n+        }\n+      ).metadata?.teamId;\n+\n+      if (metadataTeamId && metadataTeamId !== team.uuid) {\n+        return c.text(\"Forbidden\", 403);\n+      }\n+\n+      return c.json({ paused: instance.status === \"paused\" });\n+    } catch (error) {\n+      console.error(\n+        \"[morph.check-task-run-paused] Failed to check instance status\",\n+        error\n+      );\n+      return c.text(\"Failed to check instance status\", 500);\n+    }\n+  }\n+);\n+\n morphRouter.openapi(\n   createRoute({\n     method: \"post\" as const,\ndiff --git a/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts b/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts\nindex 6bc7cbed2..2b05c7502 100644\n--- a/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts\n+++ b/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts\n@@ -1,8 +1,8 @@\n // This file is auto-generated by @hey-api/openapi-ts\n \n-import { type Options, getApiHealth, postApiAuthAnonymousSignUp, getApiUsers, postApiUsers, deleteApiUsersById, getApiUsersById, patchApiUsersById, getApiBooks, postApiBooks, getApiBooksById, postApiBooksByIdBorrow, postApiBooksByIdReturn, postApiDevServerStart, getApiIntegrationsGithubRepos, getApiIntegrationsGithubPrs, postApiIntegrationsGithubPrsBackfill, postApiIntegrationsGithubPrsBackfillRepo, getApiIntegrationsGithubPrsCode, postApiIntegrationsGithubPrsOpen, postApiIntegrationsGithubPrsMerge, postApiIntegrationsGithubPrsClose, postApiIntegrationsGithubPrsMergeSimple, getApiIntegrationsGithubPrsRaw, getApiIntegrationsGithubPrsFiles, getApiIntegrationsGithubPrsFileContents, postApiIntegrationsGithubPrsFileContentsBatch, postApiIntegrationsGithubInstallState, postApiMorphSetupInstance, getApiEnvironments, postApiEnvironments, deleteApiEnvironmentsById, getApiEnvironmentsById, patchApiEnvironmentsById, getApiEnvironmentsByIdVars, patchApiEnvironmentsByIdPorts, getApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivate, postApiSandboxesStart, postApiSandboxesByIdEnv, postApiSandboxesByIdStop, getApiSandboxesByIdStatus, postApiSandboxesByIdPublishDevcontainer, postApiTeams, postApiBranchesGenerate, postApiCodeReviewStart, getApiWorkspaceConfigs, postApiWorkspaceConfigs } from '../sdk.gen.js';\n+import { type Options, getApiHealth, postApiAuthAnonymousSignUp, getApiUsers, postApiUsers, deleteApiUsersById, getApiUsersById, patchApiUsersById, getApiBooks, postApiBooks, getApiBooksById, postApiBooksByIdBorrow, postApiBooksByIdReturn, postApiDevServerStart, getApiIntegrationsGithubRepos, getApiIntegrationsGithubPrs, postApiIntegrationsGithubPrsBackfill, postApiIntegrationsGithubPrsBackfillRepo, getApiIntegrationsGithubPrsCode, postApiIntegrationsGithubPrsOpen, postApiIntegrationsGithubPrsMerge, postApiIntegrationsGithubPrsClose, postApiIntegrationsGithubPrsMergeSimple, getApiIntegrationsGithubPrsRaw, getApiIntegrationsGithubPrsFiles, getApiIntegrationsGithubPrsFileContents, postApiIntegrationsGithubPrsFileContentsBatch, postApiIntegrationsGithubInstallState, postApiMorphTaskRunsByTaskRunIdResume, postApiMorphTaskRunsByTaskRunIdIsPaused, postApiMorphSetupInstance, getApiEnvironments, postApiEnvironments, deleteApiEnvironmentsById, getApiEnvironmentsById, patchApiEnvironmentsById, getApiEnvironmentsByIdVars, patchApiEnvironmentsByIdPorts, getApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivate, postApiSandboxesStart, postApiSandboxesByIdEnv, postApiSandboxesByIdStop, getApiSandboxesByIdStatus, postApiSandboxesByIdPublishDevcontainer, postApiTeams, postApiBranchesGenerate, postApiCodeReviewStart, getApiWorkspaceConfigs, postApiWorkspaceConfigs } from '../sdk.gen.js';\n import { queryOptions, type UseMutationOptions, type DefaultError, infiniteQueryOptions, type InfiniteData } from '@tanstack/react-query';\n-import type { GetApiHealthData, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponse, GetApiUsersData, GetApiUsersResponse, PostApiUsersData, PostApiUsersError, PostApiUsersResponse, DeleteApiUsersByIdData, DeleteApiUsersByIdError, DeleteApiUsersByIdResponse, GetApiUsersByIdData, PatchApiUsersByIdData, PatchApiUsersByIdError, PatchApiUsersByIdResponse, GetApiBooksData, PostApiBooksData, PostApiBooksError, PostApiBooksResponse, GetApiBooksByIdData, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowError, PostApiBooksByIdBorrowResponse, PostApiBooksByIdReturnData, PostApiBooksByIdReturnError, PostApiBooksByIdReturnResponse, PostApiDevServerStartData, PostApiDevServerStartError, PostApiDevServerStartResponse, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponse, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponse, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillRepoData, GetApiIntegrationsGithubPrsCodeData, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponse, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponse, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponse, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponse, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFileContentsData, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponse, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponse, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponse, GetApiEnvironmentsData, PostApiEnvironmentsData, PostApiEnvironmentsResponse, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdData, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdVarsData, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponse, GetApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponse, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponse, PostApiSandboxesStartData, PostApiSandboxesStartResponse, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponse, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponse, GetApiSandboxesByIdStatusData, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponse, PostApiTeamsData, PostApiTeamsError, PostApiTeamsResponse, PostApiBranchesGenerateData, PostApiBranchesGenerateResponse, PostApiCodeReviewStartData, PostApiCodeReviewStartResponse, GetApiWorkspaceConfigsData, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponse } from '../types.gen.js';\n+import type { GetApiHealthData, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponse, GetApiUsersData, GetApiUsersResponse, PostApiUsersData, PostApiUsersError, PostApiUsersResponse, DeleteApiUsersByIdData, DeleteApiUsersByIdError, DeleteApiUsersByIdResponse, GetApiUsersByIdData, PatchApiUsersByIdData, PatchApiUsersByIdError, PatchApiUsersByIdResponse, GetApiBooksData, PostApiBooksData, PostApiBooksError, PostApiBooksResponse, GetApiBooksByIdData, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowError, PostApiBooksByIdBorrowResponse, PostApiBooksByIdReturnData, PostApiBooksByIdReturnError, PostApiBooksByIdReturnResponse, PostApiDevServerStartData, PostApiDevServerStartError, PostApiDevServerStartResponse, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponse, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponse, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillRepoData, GetApiIntegrationsGithubPrsCodeData, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponse, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponse, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponse, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponse, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFileContentsData, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponse, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponse, PostApiMorphTaskRunsByTaskRunIdResumeData, PostApiMorphTaskRunsByTaskRunIdResumeResponse, PostApiMorphTaskRunsByTaskRunIdIsPausedData, PostApiMorphTaskRunsByTaskRunIdIsPausedResponse, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponse, GetApiEnvironmentsData, PostApiEnvironmentsData, PostApiEnvironmentsResponse, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdData, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdVarsData, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponse, GetApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponse, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponse, PostApiSandboxesStartData, PostApiSandboxesStartResponse, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponse, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponse, GetApiSandboxesByIdStatusData, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponse, PostApiTeamsData, PostApiTeamsError, PostApiTeamsResponse, PostApiBranchesGenerateData, PostApiBranchesGenerateResponse, PostApiCodeReviewStartData, PostApiCodeReviewStartResponse, GetApiWorkspaceConfigsData, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponse } from '../types.gen.js';\n import { client as _heyApiClient } from '../client.gen.js';\n \n export type QueryKey<TOptions extends Options> = [\n@@ -651,6 +651,40 @@ export const postApiIntegrationsGithubInstallStateMutation = (options?: Partial<\n     return mutationOptions;\n };\n \n+/**\n+ * Resume the Morph instance backing a task run\n+ */\n+export const postApiMorphTaskRunsByTaskRunIdResumeMutation = (options?: Partial<Options<PostApiMorphTaskRunsByTaskRunIdResumeData>>): UseMutationOptions<PostApiMorphTaskRunsByTaskRunIdResumeResponse, DefaultError, Options<PostApiMorphTaskRunsByTaskRunIdResumeData>> => {\n+    const mutationOptions: UseMutationOptions<PostApiMorphTaskRunsByTaskRunIdResumeResponse, DefaultError, Options<PostApiMorphTaskRunsByTaskRunIdResumeData>> = {\n+        mutationFn: async (fnOptions) => {\n+            const { data } = await postApiMorphTaskRunsByTaskRunIdResume({\n+                ...options,\n+                ...fnOptions,\n+                throwOnError: true\n+            });\n+            return data;\n+        }\n+    };\n+    return mutationOptions;\n+};\n+\n+/**\n+ * Check if the Morph instance backing a task run is paused\n+ */\n+export const postApiMorphTaskRunsByTaskRunIdIsPausedMutation = (options?: Partial<Options<PostApiMorphTaskRunsByTaskRunIdIsPausedData>>): UseMutationOptions<PostApiMorphTaskRunsByTaskRunIdIsPausedResponse, DefaultError, Options<PostApiMorphTaskRunsByTaskRunIdIsPausedData>> => {\n+    const mutationOptions: UseMutationOptions<PostApiMorphTaskRunsByTaskRunIdIsPausedResponse, DefaultError, Options<PostApiMorphTaskRunsByTaskRunIdIsPausedData>> = {\n+        mutationFn: async (fnOptions) => {\n+            const { data } = await postApiMorphTaskRunsByTaskRunIdIsPaused({\n+                ...options,\n+                ...fnOptions,\n+                throwOnError: true\n+            });\n+            return data;\n+        }\n+    };\n+    return mutationOptions;\n+};\n+\n /**\n  * Setup a Morph instance with optional repository cloning\n  */\ndiff --git a/packages/www-openapi-client/src/client/sdk.gen.ts b/packages/www-openapi-client/src/client/sdk.gen.ts\nindex a4215f99c..63478a358 100644\n--- a/packages/www-openapi-client/src/client/sdk.gen.ts\n+++ b/packages/www-openapi-client/src/client/sdk.gen.ts\n@@ -1,7 +1,7 @@\n // This file is auto-generated by @hey-api/openapi-ts\n \n import type { Options as ClientOptions, TDataShape, Client } from './client/index.js';\n-import type { GetApiHealthData, GetApiHealthResponses, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponses, PostApiAuthAnonymousSignUpErrors, GetApiUsersData, GetApiUsersResponses, PostApiUsersData, PostApiUsersResponses, PostApiUsersErrors, DeleteApiUsersByIdData, DeleteApiUsersByIdResponses, DeleteApiUsersByIdErrors, GetApiUsersByIdData, GetApiUsersByIdResponses, GetApiUsersByIdErrors, PatchApiUsersByIdData, PatchApiUsersByIdResponses, PatchApiUsersByIdErrors, GetApiBooksData, GetApiBooksResponses, PostApiBooksData, PostApiBooksResponses, PostApiBooksErrors, GetApiBooksByIdData, GetApiBooksByIdResponses, GetApiBooksByIdErrors, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowResponses, PostApiBooksByIdBorrowErrors, PostApiBooksByIdReturnData, PostApiBooksByIdReturnResponses, PostApiBooksByIdReturnErrors, PostApiDevServerStartData, PostApiDevServerStartResponses, PostApiDevServerStartErrors, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponses, GetApiIntegrationsGithubReposErrors, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponses, GetApiIntegrationsGithubPrsErrors, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillResponses, PostApiIntegrationsGithubPrsBackfillErrors, PostApiIntegrationsGithubPrsBackfillRepoData, PostApiIntegrationsGithubPrsBackfillRepoResponses, PostApiIntegrationsGithubPrsBackfillRepoErrors, GetApiIntegrationsGithubPrsCodeData, GetApiIntegrationsGithubPrsCodeResponses, GetApiIntegrationsGithubPrsCodeErrors, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponses, PostApiIntegrationsGithubPrsOpenErrors, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponses, PostApiIntegrationsGithubPrsMergeErrors, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponses, PostApiIntegrationsGithubPrsCloseErrors, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponses, PostApiIntegrationsGithubPrsMergeSimpleErrors, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsRawResponses, GetApiIntegrationsGithubPrsRawErrors, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFilesResponses, GetApiIntegrationsGithubPrsFilesErrors, GetApiIntegrationsGithubPrsFileContentsData, GetApiIntegrationsGithubPrsFileContentsResponses, GetApiIntegrationsGithubPrsFileContentsErrors, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponses, PostApiIntegrationsGithubPrsFileContentsBatchErrors, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponses, PostApiIntegrationsGithubInstallStateErrors, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponses, PostApiMorphSetupInstanceErrors, GetApiIframePreflightData, GetApiIframePreflightResponses, GetApiIframePreflightErrors, GetApiEnvironmentsData, GetApiEnvironmentsResponses, GetApiEnvironmentsErrors, PostApiEnvironmentsData, PostApiEnvironmentsResponses, PostApiEnvironmentsErrors, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponses, DeleteApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdData, GetApiEnvironmentsByIdResponses, GetApiEnvironmentsByIdErrors, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponses, PatchApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdVarsData, GetApiEnvironmentsByIdVarsResponses, GetApiEnvironmentsByIdVarsErrors, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponses, PatchApiEnvironmentsByIdPortsErrors, GetApiEnvironmentsByIdSnapshotsData, GetApiEnvironmentsByIdSnapshotsResponses, GetApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponses, PostApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponses, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateErrors, PostApiSandboxesStartData, PostApiSandboxesStartResponses, PostApiSandboxesStartErrors, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponses, PostApiSandboxesByIdEnvErrors, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponses, PostApiSandboxesByIdStopErrors, GetApiSandboxesByIdStatusData, GetApiSandboxesByIdStatusResponses, GetApiSandboxesByIdStatusErrors, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponses, PostApiSandboxesByIdPublishDevcontainerErrors, PostApiTeamsData, PostApiTeamsResponses, PostApiTeamsErrors, PostApiBranchesGenerateData, PostApiBranchesGenerateResponses, PostApiBranchesGenerateErrors, PostApiCodeReviewStartData, PostApiCodeReviewStartResponses, PostApiCodeReviewStartErrors, GetApiWorkspaceConfigsData, GetApiWorkspaceConfigsResponses, GetApiWorkspaceConfigsErrors, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponses, PostApiWorkspaceConfigsErrors } from './types.gen.js';\n+import type { GetApiHealthData, GetApiHealthResponses, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponses, PostApiAuthAnonymousSignUpErrors, GetApiUsersData, GetApiUsersResponses, PostApiUsersData, PostApiUsersResponses, PostApiUsersErrors, DeleteApiUsersByIdData, DeleteApiUsersByIdResponses, DeleteApiUsersByIdErrors, GetApiUsersByIdData, GetApiUsersByIdResponses, GetApiUsersByIdErrors, PatchApiUsersByIdData, PatchApiUsersByIdResponses, PatchApiUsersByIdErrors, GetApiBooksData, GetApiBooksResponses, PostApiBooksData, PostApiBooksResponses, PostApiBooksErrors, GetApiBooksByIdData, GetApiBooksByIdResponses, GetApiBooksByIdErrors, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowResponses, PostApiBooksByIdBorrowErrors, PostApiBooksByIdReturnData, PostApiBooksByIdReturnResponses, PostApiBooksByIdReturnErrors, PostApiDevServerStartData, PostApiDevServerStartResponses, PostApiDevServerStartErrors, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponses, GetApiIntegrationsGithubReposErrors, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponses, GetApiIntegrationsGithubPrsErrors, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillResponses, PostApiIntegrationsGithubPrsBackfillErrors, PostApiIntegrationsGithubPrsBackfillRepoData, PostApiIntegrationsGithubPrsBackfillRepoResponses, PostApiIntegrationsGithubPrsBackfillRepoErrors, GetApiIntegrationsGithubPrsCodeData, GetApiIntegrationsGithubPrsCodeResponses, GetApiIntegrationsGithubPrsCodeErrors, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponses, PostApiIntegrationsGithubPrsOpenErrors, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponses, PostApiIntegrationsGithubPrsMergeErrors, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponses, PostApiIntegrationsGithubPrsCloseErrors, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponses, PostApiIntegrationsGithubPrsMergeSimpleErrors, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsRawResponses, GetApiIntegrationsGithubPrsRawErrors, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFilesResponses, GetApiIntegrationsGithubPrsFilesErrors, GetApiIntegrationsGithubPrsFileContentsData, GetApiIntegrationsGithubPrsFileContentsResponses, GetApiIntegrationsGithubPrsFileContentsErrors, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponses, PostApiIntegrationsGithubPrsFileContentsBatchErrors, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponses, PostApiIntegrationsGithubInstallStateErrors, PostApiMorphTaskRunsByTaskRunIdResumeData, PostApiMorphTaskRunsByTaskRunIdResumeResponses, PostApiMorphTaskRunsByTaskRunIdResumeErrors, PostApiMorphTaskRunsByTaskRunIdIsPausedData, PostApiMorphTaskRunsByTaskRunIdIsPausedResponses, PostApiMorphTaskRunsByTaskRunIdIsPausedErrors, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponses, PostApiMorphSetupInstanceErrors, GetApiIframePreflightData, GetApiIframePreflightResponses, GetApiIframePreflightErrors, GetApiEnvironmentsData, GetApiEnvironmentsResponses, GetApiEnvironmentsErrors, PostApiEnvironmentsData, PostApiEnvironmentsResponses, PostApiEnvironmentsErrors, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponses, DeleteApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdData, GetApiEnvironmentsByIdResponses, GetApiEnvironmentsByIdErrors, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponses, PatchApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdVarsData, GetApiEnvironmentsByIdVarsResponses, GetApiEnvironmentsByIdVarsErrors, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponses, PatchApiEnvironmentsByIdPortsErrors, GetApiEnvironmentsByIdSnapshotsData, GetApiEnvironmentsByIdSnapshotsResponses, GetApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponses, PostApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponses, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateErrors, PostApiSandboxesStartData, PostApiSandboxesStartResponses, PostApiSandboxesStartErrors, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponses, PostApiSandboxesByIdEnvErrors, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponses, PostApiSandboxesByIdStopErrors, GetApiSandboxesByIdStatusData, GetApiSandboxesByIdStatusResponses, GetApiSandboxesByIdStatusErrors, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponses, PostApiSandboxesByIdPublishDevcontainerErrors, PostApiTeamsData, PostApiTeamsResponses, PostApiTeamsErrors, PostApiBranchesGenerateData, PostApiBranchesGenerateResponses, PostApiBranchesGenerateErrors, PostApiCodeReviewStartData, PostApiCodeReviewStartResponses, PostApiCodeReviewStartErrors, GetApiWorkspaceConfigsData, GetApiWorkspaceConfigsResponses, GetApiWorkspaceConfigsErrors, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponses, PostApiWorkspaceConfigsErrors } from './types.gen.js';\n import { client as _heyApiClient } from './client.gen.js';\n \n export type Options<TData extends TDataShape = TDataShape, ThrowOnError extends boolean = boolean> = ClientOptions<TData, ThrowOnError> & {\n@@ -337,6 +337,34 @@ export const postApiIntegrationsGithubInstallState = <ThrowOnError extends boole\n     });\n };\n \n+/**\n+ * Resume the Morph instance backing a task run\n+ */\n+export const postApiMorphTaskRunsByTaskRunIdResume = <ThrowOnError extends boolean = false>(options: Options<PostApiMorphTaskRunsByTaskRunIdResumeData, ThrowOnError>) => {\n+    return (options.client ?? _heyApiClient).post<PostApiMorphTaskRunsByTaskRunIdResumeResponses, PostApiMorphTaskRunsByTaskRunIdResumeErrors, ThrowOnError>({\n+        url: '/api/morph/task-runs/{taskRunId}/resume',\n+        ...options,\n+        headers: {\n+            'Content-Type': 'application/json',\n+            ...options.headers\n+        }\n+    });\n+};\n+\n+/**\n+ * Check if the Morph instance backing a task run is paused\n+ */\n+export const postApiMorphTaskRunsByTaskRunIdIsPaused = <ThrowOnError extends boolean = false>(options: Options<PostApiMorphTaskRunsByTaskRunIdIsPausedData, ThrowOnError>) => {\n+    return (options.client ?? _heyApiClient).post<PostApiMorphTaskRunsByTaskRunIdIsPausedResponses, PostApiMorphTaskRunsByTaskRunIdIsPausedErrors, ThrowOnError>({\n+        url: '/api/morph/task-runs/{taskRunId}/is-paused',\n+        ...options,\n+        headers: {\n+            'Content-Type': 'application/json',\n+            ...options.headers\n+        }\n+    });\n+};\n+\n /**\n  * Setup a Morph instance with optional repository cloning\n  */\ndiff --git a/packages/www-openapi-client/src/client/types.gen.ts b/packages/www-openapi-client/src/client/types.gen.ts\nindex ee011d655..5db07eec8 100644\n--- a/packages/www-openapi-client/src/client/types.gen.ts\n+++ b/packages/www-openapi-client/src/client/types.gen.ts\n@@ -350,6 +350,22 @@ export type GithubInstallStateRequest = {\n     returnUrl?: string;\n };\n \n+export type ResumeTaskRunResponse = {\n+    resumed: true;\n+};\n+\n+export type ResumeTaskRunBody = {\n+    teamSlugOrId: string;\n+};\n+\n+export type CheckTaskRunPausedResponse = {\n+    paused: boolean;\n+};\n+\n+export type CheckTaskRunPausedBody = {\n+    teamSlugOrId: string;\n+};\n+\n export type SetupInstanceResponse = {\n     instanceId: string;\n     vscodeUrl: string;\n@@ -1562,6 +1578,88 @@ export type PostApiIntegrationsGithubInstallStateResponses = {\n \n export type PostApiIntegrationsGithubInstallStateResponse = PostApiIntegrationsGithubInstallStateResponses[keyof PostApiIntegrationsGithubInstallStateResponses];\n \n+export type PostApiMorphTaskRunsByTaskRunIdResumeData = {\n+    body: ResumeTaskRunBody;\n+    path: {\n+        taskRunId: string;\n+    };\n+    query?: never;\n+    url: '/api/morph/task-runs/{taskRunId}/resume';\n+};\n+\n+export type PostApiMorphTaskRunsByTaskRunIdResumeErrors = {\n+    /**\n+     * Task run is not backed by a Morph instance\n+     */\n+    400: unknown;\n+    /**\n+     * Unauthorized\n+     */\n+    401: unknown;\n+    /**\n+     * Forbidden\n+     */\n+    403: unknown;\n+    /**\n+     * Task run or instance not found\n+     */\n+    404: unknown;\n+    /**\n+     * Failed to resume instance\n+     */\n+    500: unknown;\n+};\n+\n+export type PostApiMorphTaskRunsByTaskRunIdResumeResponses = {\n+    /**\n+     * Morph instance resumed\n+     */\n+    200: ResumeTaskRunResponse;\n+};\n+\n+export type PostApiMorphTaskRunsByTaskRunIdResumeResponse = PostApiMorphTaskRunsByTaskRunIdResumeResponses[keyof PostApiMorphTaskRunsByTaskRunIdResumeResponses];\n+\n+export type PostApiMorphTaskRunsByTaskRunIdIsPausedData = {\n+    body: CheckTaskRunPausedBody;\n+    path: {\n+        taskRunId: string;\n+    };\n+    query?: never;\n+    url: '/api/morph/task-runs/{taskRunId}/is-paused';\n+};\n+\n+export type PostApiMorphTaskRunsByTaskRunIdIsPausedErrors = {\n+    /**\n+     * Task run is not backed by a Morph instance\n+     */\n+    400: unknown;\n+    /**\n+     * Unauthorized\n+     */\n+    401: unknown;\n+    /**\n+     * Forbidden\n+     */\n+    403: unknown;\n+    /**\n+     * Task run or instance not found\n+     */\n+    404: unknown;\n+    /**\n+     * Failed to check instance status\n+     */\n+    500: unknown;\n+};\n+\n+export type PostApiMorphTaskRunsByTaskRunIdIsPausedResponses = {\n+    /**\n+     * Morph instance status returned\n+     */\n+    200: CheckTaskRunPausedResponse;\n+};\n+\n+export type PostApiMorphTaskRunsByTaskRunIdIsPausedResponse = PostApiMorphTaskRunsByTaskRunIdIsPausedResponses[keyof PostApiMorphTaskRunsByTaskRunIdIsPausedResponses];\n+\n export type PostApiMorphSetupInstanceData = {\n     body: SetupInstanceBody;\n     path?: never;\n","comments":[{"type":"issue_comment","id":3555406954,"prNumber":1010,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 3 screenshot(s) for commit `d6de0f6`:\n\n### dashboard-full-view-HEAD.png\n![dashboard-full-view-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/be577216-1f76-4529-9c36-0282712d131b)\n\n### dashboard-tasks-list-HEAD.png\n![dashboard-tasks-list-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/9babb46f-dc6d-4749-9738-5163534a8480)\n\n### sidebar-hover-archive-button-HEAD.png\n![sidebar-hover-archive-button-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/a18ab1ff-1ad1-4499-b25b-156034c9382b)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"3ede127524bbca04aa5274c5a107c6db71a0e348","createdAt":"2025-11-20T01:51:02Z","updatedAt":"2025-11-20T01:51:02Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1010#issuecomment-3555406954"},{"type":"issue_comment","id":3556803441,"prNumber":1010,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 1 screenshot(s) for commit `ea4b140`:\n\n### dashboard-view-HEAD.png\n![dashboard-view-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/402df5aa-0f94-4b42-8b86-1db1c9e4e295)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"3ede127524bbca04aa5274c5a107c6db71a0e348","createdAt":"2025-11-20T09:17:30Z","updatedAt":"2025-11-20T09:17:30Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1010#issuecomment-3556803441"},{"type":"issue_comment","id":3561408621,"prNumber":1010,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 2 screenshot(s) for commit `ee42d18`:\n\n### dashboard-with-task-list-HEAD.png\n![dashboard-with-task-list-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/03d98b12-60b2-4c27-a199-179d36ac5d8b)\n\n### marketing-landing-page-HEAD.png\n![marketing-landing-page-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/a4a8741b-f5e4-4f62-839e-41cf421f2463)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"3ede127524bbca04aa5274c5a107c6db71a0e348","createdAt":"2025-11-21T05:06:33Z","updatedAt":"2025-11-21T05:06:33Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1010#issuecomment-3561408621"},{"type":"issue_comment","id":3561442794,"prNumber":1010,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 1 screenshot(s) for commit `2aef9c6`:\n\n### dashboard-task-list-HEAD.png\n![dashboard-task-list-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/89b661da-8058-4b39-a842-692db0c49494)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"3ede127524bbca04aa5274c5a107c6db71a0e348","createdAt":"2025-11-21T05:21:08Z","updatedAt":"2025-11-21T05:21:08Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1010#issuecomment-3561442794"}]}
{"number":1008,"title":"Add gpt-5.1-codex-max agent variants","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1008","headRef":"codex/add-new-codex-models-with-reasoning-effort","headSha":"da91d263db8324ddd927221f20aac27c20d6de8d","baseRef":"main","baseSha":"a28b5a14d3d82e8fdc2b5b562a2704461d7dd489","createdAt":"2025-11-20T00:56:05Z","updatedAt":"2025-11-20T01:42:18Z","diff":"diff --git a/packages/shared/src/agentConfig.ts b/packages/shared/src/agentConfig.ts\nindex b33331d2a..401de2da4 100644\n--- a/packages/shared/src/agentConfig.ts\n+++ b/packages/shared/src/agentConfig.ts\n@@ -25,6 +25,10 @@ import {\n   CODEX_GPT_4_1_CONFIG,\n   CODEX_GPT_5_1_CODEX_CONFIG,\n   CODEX_GPT_5_1_CODEX_HIGH_REASONING_CONFIG,\n+  CODEX_GPT_5_1_CODEX_MAX_HIGH_REASONING_CONFIG,\n+  CODEX_GPT_5_1_CODEX_MAX_LOW_REASONING_CONFIG,\n+  CODEX_GPT_5_1_CODEX_MAX_MEDIUM_REASONING_CONFIG,\n+  CODEX_GPT_5_1_CODEX_MAX_XHIGH_REASONING_CONFIG,\n   CODEX_GPT_5_1_CODEX_MINI_CONFIG,\n   CODEX_GPT_5_1_CONFIG,\n   CODEX_GPT_5_CODEX_HIGH_REASONING_CONFIG,\n@@ -100,6 +104,10 @@ export const AGENT_CONFIGS: AgentConfig[] = [\n   CLAUDE_OPUS_4_1_CONFIG,\n   CLAUDE_SONNET_4_CONFIG,\n   CLAUDE_OPUS_4_CONFIG,\n+  CODEX_GPT_5_1_CODEX_MAX_XHIGH_REASONING_CONFIG,\n+  CODEX_GPT_5_1_CODEX_MAX_HIGH_REASONING_CONFIG,\n+  CODEX_GPT_5_1_CODEX_MAX_MEDIUM_REASONING_CONFIG,\n+  CODEX_GPT_5_1_CODEX_MAX_LOW_REASONING_CONFIG,\n   CODEX_GPT_5_1_CODEX_HIGH_REASONING_CONFIG,\n   CODEX_GPT_5_1_CODEX_CONFIG,\n   CODEX_GPT_5_1_CODEX_MINI_CONFIG,\ndiff --git a/packages/shared/src/providers/openai/configs.ts b/packages/shared/src/providers/openai/configs.ts\nindex d0a80288d..91834a70e 100644\n--- a/packages/shared/src/providers/openai/configs.ts\n+++ b/packages/shared/src/providers/openai/configs.ts\n@@ -5,6 +5,90 @@ import { checkOpenAIRequirements } from \"./check-requirements\";\n import { startCodexCompletionDetector } from \"./completion-detector\";\n import { getOpenAIEnvironment } from \"./environment\";\n \n+export const CODEX_GPT_5_1_CODEX_MAX_XHIGH_REASONING_CONFIG: AgentConfig = {\n+  name: \"codex/gpt-5.1-codex-max-xhigh\",\n+  command: \"bunx\",\n+  args: [\n+    \"@openai/codex@latest\",\n+    \"--model\",\n+    \"gpt-5.1-codex-max\",\n+    \"--sandbox\",\n+    \"danger-full-access\",\n+    \"--ask-for-approval\",\n+    \"never\",\n+    \"-c\",\n+    'model_reasoning_effort=\"xhigh\"',\n+    \"$PROMPT\",\n+  ],\n+  environment: getOpenAIEnvironment,\n+  checkRequirements: checkOpenAIRequirements,\n+  apiKeys: [OPENAI_API_KEY],\n+  completionDetector: startCodexCompletionDetector,\n+};\n+\n+export const CODEX_GPT_5_1_CODEX_MAX_HIGH_REASONING_CONFIG: AgentConfig = {\n+  name: \"codex/gpt-5.1-codex-max-high\",\n+  command: \"bunx\",\n+  args: [\n+    \"@openai/codex@latest\",\n+    \"--model\",\n+    \"gpt-5.1-codex-max\",\n+    \"--sandbox\",\n+    \"danger-full-access\",\n+    \"--ask-for-approval\",\n+    \"never\",\n+    \"-c\",\n+    'model_reasoning_effort=\"high\"',\n+    \"$PROMPT\",\n+  ],\n+  environment: getOpenAIEnvironment,\n+  checkRequirements: checkOpenAIRequirements,\n+  apiKeys: [OPENAI_API_KEY],\n+  completionDetector: startCodexCompletionDetector,\n+};\n+\n+export const CODEX_GPT_5_1_CODEX_MAX_MEDIUM_REASONING_CONFIG: AgentConfig = {\n+  name: \"codex/gpt-5.1-codex-max-medium\",\n+  command: \"bunx\",\n+  args: [\n+    \"@openai/codex@latest\",\n+    \"--model\",\n+    \"gpt-5.1-codex-max\",\n+    \"--sandbox\",\n+    \"danger-full-access\",\n+    \"--ask-for-approval\",\n+    \"never\",\n+    \"-c\",\n+    'model_reasoning_effort=\"medium\"',\n+    \"$PROMPT\",\n+  ],\n+  environment: getOpenAIEnvironment,\n+  checkRequirements: checkOpenAIRequirements,\n+  apiKeys: [OPENAI_API_KEY],\n+  completionDetector: startCodexCompletionDetector,\n+};\n+\n+export const CODEX_GPT_5_1_CODEX_MAX_LOW_REASONING_CONFIG: AgentConfig = {\n+  name: \"codex/gpt-5.1-codex-max-low\",\n+  command: \"bunx\",\n+  args: [\n+    \"@openai/codex@latest\",\n+    \"--model\",\n+    \"gpt-5.1-codex-max\",\n+    \"--sandbox\",\n+    \"danger-full-access\",\n+    \"--ask-for-approval\",\n+    \"never\",\n+    \"-c\",\n+    'model_reasoning_effort=\"low\"',\n+    \"$PROMPT\",\n+  ],\n+  environment: getOpenAIEnvironment,\n+  checkRequirements: checkOpenAIRequirements,\n+  apiKeys: [OPENAI_API_KEY],\n+  completionDetector: startCodexCompletionDetector,\n+};\n+\n export const CODEX_GPT_5_1_CONFIG: AgentConfig = {\n   name: \"codex/gpt-5.1\",\n   command: \"bunx\",\n","comments":[{"type":"issue_comment","id":3555277621,"prNumber":1008,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 1 screenshot(s) for commit `da91d26`:\n\n### agent-selection-dialog-HEAD.png\n![agent-selection-dialog-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/efc73256-89bd-43f5-90eb-74f5253ed6b9)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"da91d263db8324ddd927221f20aac27c20d6de8d","createdAt":"2025-11-20T01:01:17Z","updatedAt":"2025-11-20T01:01:17Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1008#issuecomment-3555277621"}]}
{"number":1007,"title":"Add codex-max model variants with reasoning","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1007","headRef":"cmux/add-codex-max-model-variants-with-reasoning-o3yd5","headSha":"0e49bf48115dedb77e4452b57f31efef8ee7f3b6","baseRef":"main","baseSha":"a28b5a14d3d82e8fdc2b5b562a2704461d7dd489","createdAt":"2025-11-19T23:25:08Z","updatedAt":"2025-11-20T09:03:28Z","diff":"diff --git a/packages/shared/src/providers/openai/configs.ts b/packages/shared/src/providers/openai/configs.ts\nindex d0a80288d..91834a70e 100644\n--- a/packages/shared/src/providers/openai/configs.ts\n+++ b/packages/shared/src/providers/openai/configs.ts\n@@ -5,6 +5,90 @@ import { checkOpenAIRequirements } from \"./check-requirements\";\n import { startCodexCompletionDetector } from \"./completion-detector\";\n import { getOpenAIEnvironment } from \"./environment\";\n \n+export const CODEX_GPT_5_1_CODEX_MAX_XHIGH_REASONING_CONFIG: AgentConfig = {\n+  name: \"codex/gpt-5.1-codex-max-xhigh\",\n+  command: \"bunx\",\n+  args: [\n+    \"@openai/codex@latest\",\n+    \"--model\",\n+    \"gpt-5.1-codex-max\",\n+    \"--sandbox\",\n+    \"danger-full-access\",\n+    \"--ask-for-approval\",\n+    \"never\",\n+    \"-c\",\n+    'model_reasoning_effort=\"xhigh\"',\n+    \"$PROMPT\",\n+  ],\n+  environment: getOpenAIEnvironment,\n+  checkRequirements: checkOpenAIRequirements,\n+  apiKeys: [OPENAI_API_KEY],\n+  completionDetector: startCodexCompletionDetector,\n+};\n+\n+export const CODEX_GPT_5_1_CODEX_MAX_HIGH_REASONING_CONFIG: AgentConfig = {\n+  name: \"codex/gpt-5.1-codex-max-high\",\n+  command: \"bunx\",\n+  args: [\n+    \"@openai/codex@latest\",\n+    \"--model\",\n+    \"gpt-5.1-codex-max\",\n+    \"--sandbox\",\n+    \"danger-full-access\",\n+    \"--ask-for-approval\",\n+    \"never\",\n+    \"-c\",\n+    'model_reasoning_effort=\"high\"',\n+    \"$PROMPT\",\n+  ],\n+  environment: getOpenAIEnvironment,\n+  checkRequirements: checkOpenAIRequirements,\n+  apiKeys: [OPENAI_API_KEY],\n+  completionDetector: startCodexCompletionDetector,\n+};\n+\n+export const CODEX_GPT_5_1_CODEX_MAX_MEDIUM_REASONING_CONFIG: AgentConfig = {\n+  name: \"codex/gpt-5.1-codex-max-medium\",\n+  command: \"bunx\",\n+  args: [\n+    \"@openai/codex@latest\",\n+    \"--model\",\n+    \"gpt-5.1-codex-max\",\n+    \"--sandbox\",\n+    \"danger-full-access\",\n+    \"--ask-for-approval\",\n+    \"never\",\n+    \"-c\",\n+    'model_reasoning_effort=\"medium\"',\n+    \"$PROMPT\",\n+  ],\n+  environment: getOpenAIEnvironment,\n+  checkRequirements: checkOpenAIRequirements,\n+  apiKeys: [OPENAI_API_KEY],\n+  completionDetector: startCodexCompletionDetector,\n+};\n+\n+export const CODEX_GPT_5_1_CODEX_MAX_LOW_REASONING_CONFIG: AgentConfig = {\n+  name: \"codex/gpt-5.1-codex-max-low\",\n+  command: \"bunx\",\n+  args: [\n+    \"@openai/codex@latest\",\n+    \"--model\",\n+    \"gpt-5.1-codex-max\",\n+    \"--sandbox\",\n+    \"danger-full-access\",\n+    \"--ask-for-approval\",\n+    \"never\",\n+    \"-c\",\n+    'model_reasoning_effort=\"low\"',\n+    \"$PROMPT\",\n+  ],\n+  environment: getOpenAIEnvironment,\n+  checkRequirements: checkOpenAIRequirements,\n+  apiKeys: [OPENAI_API_KEY],\n+  completionDetector: startCodexCompletionDetector,\n+};\n+\n export const CODEX_GPT_5_1_CONFIG: AgentConfig = {\n   name: \"codex/gpt-5.1\",\n   command: \"bunx\",\n","comments":[{"type":"issue_comment","id":3555066752,"prNumber":1007,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 1 screenshot(s) for commit `a3104c8`:\n\n### dashboard-agent-selector-HEAD.png\n![dashboard-agent-selector-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/e3d4bbd1-dcd8-4158-a253-43d99c2d18be)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"0e49bf48115dedb77e4452b57f31efef8ee7f3b6","createdAt":"2025-11-19T23:28:43Z","updatedAt":"2025-11-19T23:28:43Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1007#issuecomment-3555066752"}]}
{"number":1005,"title":"chore(claude-sonnet-4-5): make the landing page rainbow gradient color","state":"open","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1005","headRef":"cmux/apply-rainbow-gradient-to-landing-page-2cyts","headSha":"478417806786d18677864b3d0c5068004c8801b0","baseRef":"main","baseSha":"44a9a49038de9df07498372971379053e8df0db2","createdAt":"2025-11-19T07:35:35Z","updatedAt":"2025-11-19T08:21:55Z","diff":"diff --git a/apps/www/app/page.tsx b/apps/www/app/page.tsx\nindex 29c883dbb..816536aa4 100644\n--- a/apps/www/app/page.tsx\n+++ b/apps/www/app/page.tsx\n@@ -157,9 +157,10 @@ export default async function LandingPage() {\n         aria-hidden\n         className=\"pointer-events-none absolute inset-0 -z-10 overflow-hidden\"\n       >\n-        <div className=\"absolute inset-x-[-20%] top-[-30%] h-[40rem] rounded-full bg-gradient-to-br from-blue-600/30 via-sky-500/20 to-purple-600/10 blur-3xl\" />\n-        <div className=\"absolute inset-x-[30%] top-[20%] h-[30rem] rounded-full bg-gradient-to-br from-cyan-400/20 via-sky-500/20 to-transparent blur-[160px]\" />\n-        <div className=\"absolute inset-x-[10%] bottom-[-20%] h-[32rem] rounded-full bg-gradient-to-tr from-indigo-500/20 via-blue-700/10 to-transparent blur-[200px]\" />\n+        <div className=\"absolute inset-x-[-20%] top-[-30%] h-[40rem] rounded-full bg-gradient-to-br from-red-500/30 via-orange-500/25 to-yellow-500/20 blur-3xl\" />\n+        <div className=\"absolute inset-x-[20%] top-[-10%] h-[35rem] rounded-full bg-gradient-to-br from-yellow-400/25 via-green-400/20 to-emerald-500/15 blur-[160px]\" />\n+        <div className=\"absolute inset-x-[30%] top-[20%] h-[30rem] rounded-full bg-gradient-to-br from-cyan-400/20 via-blue-500/20 to-indigo-500/15 blur-[160px]\" />\n+        <div className=\"absolute inset-x-[10%] bottom-[-20%] h-[32rem] rounded-full bg-gradient-to-tr from-indigo-600/25 via-purple-600/20 to-pink-500/15 blur-[200px]\" />\n       </div>\n \n       <SiteHeader\n","comments":[{"type":"issue_comment","id":3551291482,"prNumber":1005,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 11 screenshot(s) for commit `4784178`:\n\n### dashboard-image-HEAD.png\n![dashboard-image-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/58a529e3-115d-4434-8b22-c26f8c7314e7)\n\n### header-navigation-HEAD.png\n![header-navigation-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/532e731d-3308-4d7e-a61a-7206fd59cb43)\n\n### hero-title-HEAD.png\n![hero-title-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/d1e62f4f-35b5-4980-b2d0-600584f23fc1)\n\n### homepage-about-section-HEAD.png\n![homepage-about-section-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/c52d6c43-63f9-4848-886c-87dd250d2c2e)\n\n### homepage-contact-footer-section-HEAD.png\n![homepage-contact-footer-section-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/b8bdf1a1-c3d7-4f4f-91da-174415a25cbb)\n\n### homepage-features-section-HEAD.png\n![homepage-features-section-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/3b2a8f3c-f865-4f1d-a16e-edc5c3f5569a)\n\n### homepage-full-HEAD.png\n![homepage-full-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/64a1732a-9324-45e6-86bb-6ff31dacf39e)\n\n### homepage-hero-section-HEAD.png\n![homepage-hero-section-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/3d3fd28f-206e-425f-b572-33dc0e7af6e2)\n\n### homepage-requirements-section-HEAD.png\n![homepage-requirements-section-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/ce194b5c-9386-4011-9bd4-e8f3a2469ed5)\n\n### homepage-verification-section-HEAD.png\n![homepage-verification-section-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/531f4199-c6ee-401f-9c1f-7e972d8bd730)\n\n### homepage-workflow-section-HEAD.png\n![homepage-workflow-section-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/bae526a8-c50e-4949-8305-7250a1338590)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"478417806786d18677864b3d0c5068004c8801b0","createdAt":"2025-11-19T07:55:43Z","updatedAt":"2025-11-19T07:55:43Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1005#issuecomment-3551291482"},{"type":"issue_comment","id":3551330310,"prNumber":1005,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 17 screenshot(s) for commit `4784178`:\n\n### about-section-heading-HEAD.png\n![about-section-heading-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/90a3657e-0c20-42a7-b246-e9b91a43b0d2)\n\n### contact-section-HEAD.png\n![contact-section-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/7ab664c7-e5a6-4198-8442-5a76b560d0fa)\n\n### dashboard-image-HEAD.png\n![dashboard-image-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/f753661e-17a6-4fb2-8e87-f4a7a637da5b)\n\n### diff-viewer-image-HEAD.png\n![diff-viewer-image-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/ea0220a3-ca38-4a82-a56f-f87ffd5255ea)\n\n### features-section-heading-HEAD.png\n![features-section-heading-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/bd050635-f237-448b-9845-bbbdbfa183c5)\n\n### footer-HEAD.png\n![footer-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/202c02a3-34fa-46c0-84c1-768243bac7cb)\n\n### header-navigation-HEAD.png\n![header-navigation-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/02c95b03-aaaf-4fd0-a0a8-0e323f966e93)\n\n### hero-heading-HEAD.png\n![hero-heading-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/b846e30f-4a26-4881-acf2-ada331fce5fb)\n\n### homepage-fullpage-HEAD.png\n![homepage-fullpage-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/dbf24779-6e39-4c70-b18b-d951d5daec5d)\n\n### preview-environments-image-HEAD.png\n![preview-environments-image-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/54122f80-13c1-4127-b15d-a26995c1a7a0)\n\n### requirements-section-HEAD.png\n![requirements-section-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/46f66b8a-7b49-4be4-a9e5-4c6cc029b1d6)\n\n### task-management-image-HEAD.png\n![task-management-image-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/71884ca4-9440-4690-96e6-d356e965c80d)\n\n### verification-section-heading-HEAD.png\n![verification-section-heading-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/e424819d-aaad-46b9-9527-0277d618a9eb)\n\n### video-embed-HEAD.png\n![video-embed-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/89819a5f-4105-420e-ad4f-a8d88f492ef7)\n\n### vscode-diffs-image-HEAD.png\n![vscode-diffs-image-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/f891a6cc-adda-40e9-b6cb-c6f01d145cbe)\n\n### vscode-workspaces-image-HEAD.png\n![vscode-workspaces-image-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/36176175-114f-48f8-8847-db9f0c63e3da)\n\n### workflow-section-heading-HEAD.png\n![workflow-section-heading-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/374ac1fb-74a2-4dd8-84a6-0da06cabf115)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"478417806786d18677864b3d0c5068004c8801b0","createdAt":"2025-11-19T08:07:59Z","updatedAt":"2025-11-19T08:07:59Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1005#issuecomment-3551330310"},{"type":"issue_comment","id":3551380619,"prNumber":1005,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 32 screenshot(s) for commit `4784178`:\n\n### about-section-heading-HEAD.png\n![about-section-heading-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/0aea7918-020a-4c0f-a056-7fc025034038)\n\n### about-section-image-HEAD.png\n![about-section-image-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/00bb3ed5-93d2-4a87-933b-e92a41763aac)\n\n### about-section-viewport-HEAD.png\n![about-section-viewport-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/62896ec9-2908-44e0-a281-b251295343ce)\n\n### contact-section-HEAD.png\n![contact-section-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/9ade3f55-f00d-41f0-aaec-7a97ad823e40)\n\n### dashboard-screenshot-HEAD.png\n![dashboard-screenshot-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/8935660b-03a3-463e-9ae9-6f0dbcecc7f1)\n\n### download-button-HEAD.png\n![download-button-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/ead798f9-c6cf-4d16-8e54-b0c1a86e76a0)\n\n### feature-card-multiple-agents-HEAD.png\n![feature-card-multiple-agents-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/79ad943a-3fd5-438e-bd5e-23c336f47e8d)\n\n### feature-card-vscode-HEAD.png\n![feature-card-vscode-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/9d35eeec-ce95-464c-8d38-fe3f859d619f)\n\n### features-section-heading-HEAD.png\n![features-section-heading-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/b58dea28-a7f0-4073-8f6e-ce405fc79ab4)\n\n### features-section-image-HEAD.png\n![features-section-image-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/7a504caa-f302-4622-a27a-e754e7a486a9)\n\n### features-section-viewport-HEAD.png\n![features-section-viewport-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/221134c3-7be8-48d9-bdd2-85cae624c9e1)\n\n### footer-HEAD.png\n![footer-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/f85dd183-c720-4c81-af82-71f9ebd1c401)\n\n### header-navigation-HEAD.png\n![header-navigation-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/fb7b367a-36a2-452f-a8ff-502a5ac3590e)\n\n### hero-heading-HEAD.png\n![hero-heading-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/89710956-d601-4d3b-9e9d-ad5f50571fbc)\n\n### hero-highlight-1-HEAD.png\n![hero-highlight-1-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/c52af858-72ac-4816-9b04-4ca502ceb316)\n\n### hero-highlight-2-HEAD.png\n![hero-highlight-2-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/2598a600-a7e8-47fc-9979-3fb18a913058)\n\n### hero-highlight-3-HEAD.png\n![hero-highlight-3-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/a62b9ccf-7d98-4bdb-83b9-db2f062c99f3)\n\n### hero-section-viewport-HEAD.png\n![hero-section-viewport-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/5149dcfc-c496-4390-86e8-7e85abb431b4)\n\n### homepage-full-HEAD.png\n![homepage-full-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/cf9317fb-e57d-40f4-ba43-bc160973bb44)\n\n### requirements-section-HEAD.png\n![requirements-section-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/b49a4a72-4b1a-4ab4-b8b2-908cd444452b)\n\n### verification-diff-viewer-image-HEAD.png\n![verification-diff-viewer-image-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/553c7576-f0cb-432f-a8ed-07551a178a1f)\n\n### verification-preview-image-HEAD.png\n![verification-preview-image-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/8049695b-6ca2-4f77-a5b9-83fe2e953e09)\n\n### verification-section-heading-HEAD.png\n![verification-section-heading-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/17e3ebfc-c246-46d3-bc20-3c10d4382485)\n\n### verification-section-viewport-HEAD.png\n![verification-section-viewport-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/418e2909-36c1-4181-a30d-cde54f7855c0)\n\n### verification-vscode-image-HEAD.png\n![verification-vscode-image-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/364bfecc-03bb-4462-8fdb-52d4985b505b)\n\n### workflow-section-heading-HEAD.png\n![workflow-section-heading-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/c7b7a287-aeef-494c-9fff-7c66a7b32fc6)\n\n### workflow-section-viewport-HEAD.png\n![workflow-section-viewport-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/3c1736e6-8bad-4d12-b886-22d239ebb94d)\n\n### workflow-step-1-HEAD.png\n![workflow-step-1-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/bb855007-4d35-4ce0-8ec6-217ec4b7f7c0)\n\n### workflow-step-2-HEAD.png\n![workflow-step-2-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/03d33750-e2d7-431c-9e94-ea3e255c418b)\n\n### workflow-step-3-HEAD.png\n![workflow-step-3-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/79852cec-fc27-441a-95e6-662495e8dfa0)\n\n### workflow-step-4-HEAD.png\n![workflow-step-4-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/fabf8e7c-cd12-4d32-b2f5-e515686306c2)\n\n### youtube-video-embed-HEAD.png\n![youtube-video-embed-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/319aa30a-c45f-41c4-a77f-e4640ffdeb3b)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"478417806786d18677864b3d0c5068004c8801b0","createdAt":"2025-11-19T08:21:55Z","updatedAt":"2025-11-19T08:21:55Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1005#issuecomment-3551380619"}]}
{"number":1004,"title":"chore(codex-gpt-5-codex-high): make the landing page rainbow gradient…","state":"open","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1004","headRef":"cmux/apply-rainbow-gradient-to-landing-page-v34qp","headSha":"60b2c5b19d02d12a9f626a6655a1876610ef0849","baseRef":"main","baseSha":"44a9a49038de9df07498372971379053e8df0db2","createdAt":"2025-11-19T07:03:22Z","updatedAt":"2025-11-19T07:11:14Z","diff":"diff --git a/apps/www/app/page.tsx b/apps/www/app/page.tsx\nindex 29c883dbb..acb4c39a2 100644\n--- a/apps/www/app/page.tsx\n+++ b/apps/www/app/page.tsx\n@@ -152,14 +152,16 @@ export default async function LandingPage() {\n     await Promise.all([fetchLatestRelease(), fetchGithubRepoStats()]);\n \n   return (\n-    <div className=\"relative flex min-h-dvh flex-col bg-[#030712] text-foreground\">\n+    <div className=\"relative flex min-h-dvh flex-col text-foreground\">\n       <div\n         aria-hidden\n         className=\"pointer-events-none absolute inset-0 -z-10 overflow-hidden\"\n       >\n-        <div className=\"absolute inset-x-[-20%] top-[-30%] h-[40rem] rounded-full bg-gradient-to-br from-blue-600/30 via-sky-500/20 to-purple-600/10 blur-3xl\" />\n-        <div className=\"absolute inset-x-[30%] top-[20%] h-[30rem] rounded-full bg-gradient-to-br from-cyan-400/20 via-sky-500/20 to-transparent blur-[160px]\" />\n-        <div className=\"absolute inset-x-[10%] bottom-[-20%] h-[32rem] rounded-full bg-gradient-to-tr from-indigo-500/20 via-blue-700/10 to-transparent blur-[200px]\" />\n+        <div className=\"absolute inset-0 bg-[conic-gradient(from_160deg_at_50%_50%,#f97316,#eab308,#22c55e,#22d3ee,#8b5cf6,#ec4899,#f97316)] opacity-90\" />\n+        <div className=\"absolute inset-0 bg-gradient-to-b from-neutral-950/40 via-neutral-950/60 to-neutral-950/75\" />\n+        <div className=\"absolute inset-x-[-15%] top-[-25%] h-[40rem] rounded-full bg-[radial-gradient(circle_at_30%_30%,rgba(236,72,153,0.36),rgba(59,130,246,0))] blur-[160px]\" />\n+        <div className=\"absolute inset-x-[25%] top-[15%] h-[30rem] rounded-full bg-[radial-gradient(circle_at_70%_20%,rgba(244,114,182,0.28),rgba(16,185,129,0))] blur-[180px]\" />\n+        <div className=\"absolute inset-x-[5%] bottom-[-25%] h-[32rem] rounded-full bg-[radial-gradient(circle_at_50%_50%,rgba(94,234,212,0.3),rgba(79,70,229,0))] blur-[220px]\" />\n       </div>\n \n       <SiteHeader\n","comments":[{"type":"issue_comment","id":3551133896,"prNumber":1004,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 12 screenshot(s) for commit `60b2c5b`:\n\n### about-section-HEAD.png\n![about-section-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/2d200966-4d04-4312-91a9-04bf41337f9a)\n\n### background-styling-HEAD.png\n![background-styling-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/ee8bdb14-c431-42bd-b7e5-2b278f1c7d3c)\n\n### contact-section-HEAD.png\n![contact-section-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/1e1a6dbd-0f7f-4ae3-81be-19074a8c8a37)\n\n### dashboard-image-HEAD.png\n![dashboard-image-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/98519637-5eb6-4e42-8baf-9d7a36b5c31f)\n\n### features-section-HEAD.png\n![features-section-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/7b3591a2-9db0-4cb9-8cd7-d63b7c959f8b)\n\n### footer-HEAD.png\n![footer-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/e823ea20-1fd8-45f0-a48f-34ee333b9207)\n\n### header-navigation-HEAD.png\n![header-navigation-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/30eeebb2-7de9-40ea-9afa-26c60cf17af5)\n\n### hero-section-HEAD.png\n![hero-section-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/fc56776d-b4b1-4b0b-9acb-bc729fab427b)\n\n### homepage-full-HEAD.png\n![homepage-full-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/d2389cff-5dcd-48de-9791-df6f04fc5db1)\n\n### requirements-section-HEAD.png\n![requirements-section-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/4053abe7-2a6a-4e65-9d76-5a5cc237406a)\n\n### verification-section-HEAD.png\n![verification-section-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/8ba2b3aa-a56d-439a-8cbb-35d6156d4f99)\n\n### workflow-section-HEAD.png\n![workflow-section-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/d1630158-eae7-4406-80d9-54063dd4930a)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"60b2c5b19d02d12a9f626a6655a1876610ef0849","createdAt":"2025-11-19T07:11:14Z","updatedAt":"2025-11-19T07:11:14Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/1004#issuecomment-3551133896"}]}
{"number":949,"title":"make preview.new work","state":"closed","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/949","headRef":"cmux/add-preview-onboarding-flow-and-agent-integration-3hppz","headSha":"a5f3a9ca1ddb54c9a5a38b8c076ba32f5729bed1","baseRef":"main","baseSha":"bd36edcc6d5db8806318011e65657876c04a90b5","createdAt":"2025-11-11T22:03:24Z","updatedAt":"2025-11-29T22:33:36Z","diff":"diff --git a/apps/client/src/components/TaskTree.tsx b/apps/client/src/components/TaskTree.tsx\nindex d7832b260..ddc4d6dab 100644\n--- a/apps/client/src/components/TaskTree.tsx\n+++ b/apps/client/src/components/TaskTree.tsx\n@@ -80,6 +80,22 @@ import { SidebarListItem } from \"./sidebar/SidebarListItem\";\n import { annotateAgentOrdinals } from \"./task-tree/annotateAgentOrdinals\";\n \n type PreviewService = NonNullable<TaskRunWithChildren[\"networking\"]>[number];\n+type TaskRunStatus = \"pending\" | \"running\" | \"completed\" | \"failed\" | \"skipped\";\n+\n+function getStatusIcon(status: TaskRunStatus): ReactElement {\n+  switch (status) {\n+    case \"pending\":\n+      return <Circle className=\"w-3 h-3 text-neutral-400\" />;\n+    case \"running\":\n+      return <Loader2 className=\"w-3 h-3 text-blue-500 animate-spin\" />;\n+    case \"completed\":\n+      return <CheckCircle className=\"w-3 h-3 text-green-500\" />;\n+    case \"failed\":\n+      return <XCircle className=\"w-3 h-3 text-red-500\" />;\n+    case \"skipped\":\n+      return <AlertTriangle className=\"w-3 h-3 text-amber-500\" />;\n+  }\n+}\n \n type TaskWithGeneratedBranch = Doc<\"tasks\"> & {\n   generatedBranchName?: string | null;\n@@ -1219,12 +1235,7 @@ function TaskRunTreeInner({\n   const isLocalWorkspaceRunEntry = run.isLocalWorkspace;\n   const isCloudWorkspaceRunEntry = run.isCloudWorkspace;\n \n-  const statusIcon = {\n-    pending: <Circle className=\"w-3 h-3 text-neutral-400\" />,\n-    running: <Loader2 className=\"w-3 h-3 text-blue-500 animate-spin\" />,\n-    completed: <CheckCircle className=\"w-3 h-3 text-green-500\" />,\n-    failed: <XCircle className=\"w-3 h-3 text-red-500\" />,\n-  }[run.status];\n+  const statusIcon = getStatusIcon(run.status);\n \n   const shouldHideStatusIcon =\n     (isLocalWorkspaceRunEntry || isCloudWorkspaceRunEntry) &&\ndiff --git a/apps/client/src/components/task-timeline.tsx b/apps/client/src/components/task-timeline.tsx\nindex f46fb6294..0c2716e53 100644\n--- a/apps/client/src/components/task-timeline.tsx\n+++ b/apps/client/src/components/task-timeline.tsx\n@@ -18,6 +18,8 @@ import { useMemo } from \"react\";\n import CmuxLogoMark from \"./logo/cmux-logo-mark\";\n import { TaskMessage } from \"./task-message\";\n \n+type TaskRunStatus = \"pending\" | \"running\" | \"completed\" | \"failed\" | \"skipped\";\n+\n interface TimelineEvent {\n   id: string;\n   type:\n@@ -25,11 +27,12 @@ interface TimelineEvent {\n     | \"run_started\"\n     | \"run_completed\"\n     | \"run_failed\"\n+    | \"run_skipped\"\n     | \"crown_evaluation\";\n   timestamp: number;\n   runId?: Id<\"taskRuns\">;\n   agentName?: string;\n-  status?: \"pending\" | \"running\" | \"completed\" | \"failed\";\n+  status?: TaskRunStatus;\n   exitCode?: number;\n   isCrowned?: boolean;\n   crownReason?: string;\n@@ -107,9 +110,16 @@ export function TaskTimeline({\n \n       // Run completed/failed event\n       if (run.completedAt) {\n+        const endEventType: TimelineEvent[\"type\"] =\n+          run.status === \"failed\"\n+            ? \"run_failed\"\n+            : run.status === \"skipped\"\n+              ? \"run_skipped\"\n+              : \"run_completed\";\n+\n         timelineEvents.push({\n           id: `${run._id}-end`,\n-          type: run.status === \"failed\" ? \"run_failed\" : \"run_completed\",\n+          type: endEventType,\n           timestamp: run.completedAt,\n           runId: run._id,\n           agentName: run.agentName,\n@@ -335,6 +345,53 @@ export function TaskTimeline({\n           </>\n         );\n         break;\n+      case \"run_skipped\":\n+        icon = (\n+          <div className=\"size-4 rounded-full bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center\">\n+            <AlertCircle className=\"size-2.5 text-amber-600 dark:text-amber-400\" />\n+          </div>\n+        );\n+        content = (\n+          <>\n+            {event.runId ? (\n+              <Link\n+                to=\"/$teamSlugOrId/task/$taskId/run/$runId\"\n+                params={{\n+                  teamSlugOrId: params.teamSlugOrId,\n+                  taskId: params.taskId,\n+                  runId: event.runId,\n+                  taskRunId: event.runId,\n+                }}\n+                className=\"hover:underline inline\"\n+              >\n+                <span className=\"font-medium text-neutral-900 dark:text-neutral-100\">\n+                  {agentName}\n+                </span>\n+                <span className=\"text-neutral-600 dark:text-neutral-400\">\n+                  {\" \"}\n+                  skipped execution\n+                </span>\n+                <span className=\"text-neutral-500 dark:text-neutral-500 ml-1\">\n+                  {formatDistanceToNow(event.timestamp, { addSuffix: true })}\n+                </span>\n+              </Link>\n+            ) : (\n+              <>\n+                <span className=\"font-medium text-neutral-900 dark:text-neutral-100\">\n+                  {agentName}\n+                </span>\n+                <span className=\"text-neutral-600 dark:text-neutral-400\">\n+                  {\" \"}\n+                  skipped execution\n+                </span>\n+                <span className=\"text-neutral-500 dark:text-neutral-500 ml-1\">\n+                  {formatDistanceToNow(event.timestamp, { addSuffix: true })}\n+                </span>\n+              </>\n+            )}\n+          </>\n+        );\n+        break;\n       case \"crown_evaluation\":\n         icon = (\n           <div className=\"size-4 rounded-full bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center\">\ndiff --git a/apps/server/src/agentSpawner.ts b/apps/server/src/agentSpawner.ts\nindex 9493471c6..47ce30d92 100644\n--- a/apps/server/src/agentSpawner.ts\n+++ b/apps/server/src/agentSpawner.ts\n@@ -852,6 +852,9 @@ exit $EXIT_CODE\n \n           const response = await fetch(uploadUrl, {\n             method: \"POST\",\n+            headers: {\n+              \"x-cmux-token\": taskRunJwt,\n+            },\n             body: formData,\n           });\n \ndiff --git a/apps/worker/src/index.ts b/apps/worker/src/index.ts\nindex bd5058389..e07656c31 100644\n--- a/apps/worker/src/index.ts\n+++ b/apps/worker/src/index.ts\n@@ -43,9 +43,138 @@ import { runWorkerExec } from \"./execRunner\";\n import { FileWatcher, computeGitDiff, getFileWithDiff } from \"./fileWatcher\";\n import { log } from \"./logger\";\n import { startScreenshotCollection } from \"./screenshotCollector/startScreenshotCollection\";\n+import { runTaskScreenshots } from \"./screenshotCollector/runTaskScreenshots\";\n+import { convexRequest } from \"./crown/convex\";\n+import type { WorkerTaskRunResponse } from \"@cmux/shared/convex-safe\";\n+import { verifyTaskRunToken } from \"@cmux/shared/convex-safe\";\n \n const execAsync = promisify(exec);\n \n+type PreviewJobContext = {\n+  taskId: Id<\"tasks\">;\n+  taskRunId: Id<\"taskRuns\">;\n+  convexUrl: string;\n+};\n+\n+const resolveConvexUrl = (provided?: string): string | undefined => {\n+  if (provided) return provided.replace(/\\/$/, \"\");\n+  const fromEnv =\tprocess.env.CONVEX_SITE_URL || process.env.CONVEX_URL || process.env.CONVEX_CLOUD_URL;\n+  if (fromEnv) return fromEnv.replace(/\\/$/, \"\");\n+  return undefined;\n+};\n+\n+async function resolvePreviewJobContext({\n+  token,\n+  convexUrlOverride,\n+  logPrefix,\n+}: {\n+  token: string;\n+  convexUrlOverride?: string;\n+  logPrefix: string;\n+}): Promise<PreviewJobContext> {\n+  const convexUrl =\n+    resolveConvexUrl(convexUrlOverride) ?? process.env.NEXT_PUBLIC_CONVEX_URL;\n+\n+  log(\"INFO\", `${logPrefix} Resolving task metadata`, {\n+    workerId: WORKER_ID,\n+    convexUrl,\n+    hasConvexUrl: Boolean(convexUrl),\n+  });\n+\n+  if (!convexUrl) {\n+    throw new Error(\"Convex URL is not configured for screenshot workflow\");\n+  }\n+\n+  const info = await convexRequest<WorkerTaskRunResponse>(\n+    \"/api/crown/check\",\n+    token,\n+    {\n+      checkType: \"info\",\n+    },\n+    convexUrl,\n+  );\n+\n+  log(\"INFO\", `${logPrefix} Crown check response received`, {\n+    workerId: WORKER_ID,\n+    hasInfo: Boolean(info),\n+    ok: info?.ok ?? null,\n+    hasTaskRun: Boolean(info?.taskRun),\n+    taskRunId: info?.taskRun?.id,\n+    taskId: info?.taskRun?.taskId,\n+    isPreviewJob: info?.taskRun?.isPreviewJob,\n+  });\n+\n+  if (!info?.ok || !info.taskRun) {\n+    throw new Error(\"Unable to load task run metadata for screenshot workflow\");\n+  }\n+\n+  if (!info.taskRun.isPreviewJob) {\n+    throw new Error(\"Task run is not marked as a preview job\");\n+  }\n+\n+  return {\n+    taskId: info.taskRun.taskId as Id<\"tasks\">,\n+    taskRunId: info.taskRun.id as Id<\"taskRuns\">,\n+    convexUrl,\n+  };\n+}\n+\n+async function runPreviewJobScreenshots({\n+  token,\n+  anthropicApiKey,\n+  context,\n+  logPrefix,\n+}: {\n+  token: string;\n+  anthropicApiKey?: string;\n+  context: PreviewJobContext;\n+  logPrefix: string;\n+}) {\n+  const { taskId, taskRunId, convexUrl } = context;\n+\n+  log(\"INFO\", `${logPrefix} Verified preview job metadata`, {\n+    taskRunId,\n+    taskId,\n+  });\n+\n+  await runTaskScreenshots({\n+    taskId,\n+    taskRunId,\n+    token,\n+    convexUrl,\n+    anthropicApiKey,\n+    taskRunJwt: token,\n+  });\n+\n+  log(\"INFO\", `${logPrefix} Screenshots completed, calling /api/preview/complete`, {\n+    taskRunId,\n+  });\n+\n+  const completeUrl = `${convexUrl}/api/preview/complete`;\n+  const response = await fetch(completeUrl, {\n+    method: \"POST\",\n+    headers: {\n+      \"Content-Type\": \"application/json\",\n+      \"x-cmux-token\": token,\n+    },\n+    body: JSON.stringify({\n+      taskRunId,\n+    }),\n+  });\n+\n+  if (!response.ok) {\n+    const errorText = await response.text();\n+    throw new Error(\n+      `Failed to complete preview job (status ${response.status}): ${errorText}`\n+    );\n+  }\n+\n+  const result = await response.json();\n+  log(\"INFO\", `${logPrefix} Preview job completed successfully`, {\n+    result,\n+  });\n+}\n+\n const Terminal = xtermHeadless.Terminal;\n \n // Configuration\n@@ -84,9 +213,24 @@ const upload = multer({\n   storage: multer.memoryStorage(),\n });\n \n+const ALLOWED_UPLOAD_ROOT = \"/root/prompt\";\n+\n // File upload endpoint\n app.post(\"/upload-image\", upload.single(\"image\"), async (req, res) => {\n   try {\n+    const token = req.header(\"x-cmux-token\");\n+    const secret = process.env.CMUX_TASK_RUN_JWT_SECRET;\n+    if (!token || !secret) {\n+      return res.status(401).json({ error: \"Unauthorized\" });\n+    }\n+\n+    try {\n+      await verifyTaskRunToken(token, secret);\n+    } catch (error) {\n+      log(\"ERROR\", \"Invalid task run token for upload-image\", error);\n+      return res.status(401).json({ error: \"Unauthorized\" });\n+    }\n+\n     if (!req.file) {\n       return res.status(400).json({ error: \"No file uploaded\" });\n     }\n@@ -96,27 +240,33 @@ app.post(\"/upload-image\", upload.single(\"image\"), async (req, res) => {\n       return res.status(400).json({ error: \"No path specified\" });\n     }\n \n-    log(\"INFO\", `Received image upload request for path: ${imagePath}`, {\n+    const resolvedPath = path.resolve(String(imagePath));\n+    const normalizedRoot = path.resolve(ALLOWED_UPLOAD_ROOT);\n+    if (!resolvedPath.startsWith(`${normalizedRoot}/`) && resolvedPath !== normalizedRoot) {\n+      return res.status(400).json({ error: \"Invalid path\" });\n+    }\n+\n+    log(\"INFO\", `Received image upload request for path: ${resolvedPath}`, {\n       size: req.file.size,\n       mimetype: req.file.mimetype,\n       originalname: req.file.originalname,\n     });\n \n     // Ensure directory exists\n-    const dir = path.dirname(imagePath);\n+    const dir = path.dirname(resolvedPath);\n     await fs.mkdir(dir, { recursive: true });\n \n     // Write the file\n-    await fs.writeFile(imagePath, req.file.buffer);\n+    await fs.writeFile(resolvedPath, req.file.buffer);\n \n-    log(\"INFO\", `Successfully wrote image file: ${imagePath}`);\n+    log(\"INFO\", `Successfully wrote image file: ${resolvedPath}`);\n \n     // Verify file was created\n-    const stats = await fs.stat(imagePath);\n+    const stats = await fs.stat(resolvedPath);\n \n     res.json({\n       success: true,\n-      path: imagePath,\n+      path: resolvedPath,\n       size: stats.size,\n     });\n   } catch (error) {\n@@ -127,6 +277,60 @@ app.post(\"/upload-image\", upload.single(\"image\"), async (req, res) => {\n   }\n });\n \n+// HTTP endpoint for running task screenshots (replaces Socket.IO)\n+app.use(express.json());\n+app.post(\"/api/run-task-screenshots\", async (req, res) => {\n+  try {\n+    const data = req.body;\n+\n+    const logPrefix = \"[/api/run-task-screenshots]\";\n+\n+    log(\"INFO\", `${logPrefix} Received request`, {\n+      workerId: WORKER_ID,\n+      hasToken: Boolean(data?.token),\n+      hasAnthropicKey: Boolean(data?.anthropicApiKey),\n+    });\n+\n+    if (!data?.token) {\n+      return res.status(400).json({\n+        error: \"Missing required field: token\",\n+      });\n+    }\n+\n+    const context = await resolvePreviewJobContext({\n+      token: data.token,\n+      convexUrlOverride: data.convexUrl,\n+      logPrefix,\n+    });\n+\n+    // Respond immediately to acknowledge receipt\n+    res.json({\n+      success: true,\n+    });\n+\n+    // Run screenshot collection in background\n+    (async () => {\n+      try {\n+        await runPreviewJobScreenshots({\n+          token: data.token,\n+          anthropicApiKey: data.anthropicApiKey,\n+          context,\n+          logPrefix,\n+        });\n+      } catch (error) {\n+        log(\"ERROR\", `${logPrefix} Failed`, error);\n+      }\n+    })().catch((error) => {\n+      log(\"ERROR\", `${logPrefix} Background task failed`, error);\n+    });\n+  } catch (error) {\n+    log(\"ERROR\", \"[/api/run-task-screenshots] Request handling failed\", error);\n+    res.status(400).json({\n+      error: error instanceof Error ? error.message : \"Internal server error\",\n+    });\n+  }\n+});\n+\n // Create HTTP server with Express app\n const httpServer = createServer(app);\n \n@@ -409,6 +613,7 @@ managementIO.on(\"connection\", (socket) => {\n         env: validated.env,\n         command: validated.command,\n         args: validated.args,\n+        taskId: validated.taskId,\n         taskRunId: validated.taskRunId,\n         agentModel: validated.agentModel,\n         startupCommands: validated.startupCommands,\n@@ -517,6 +722,50 @@ managementIO.on(\"connection\", (socket) => {\n     }\n   );\n \n+  socket.on(\"worker:run-task-screenshots\", async (data, callback) => {\n+    const logPrefix = \"[worker:run-task-screenshots]\";\n+\n+    log(\"INFO\", `${logPrefix} Received request`, {\n+      workerId: WORKER_ID,\n+      hasToken: Boolean(data?.token),\n+      hasAnthropicKey: Boolean(data?.anthropicApiKey),\n+    });\n+\n+    try {\n+      if (!data?.token) {\n+        throw new Error(\"Missing required field: token\");\n+      }\n+\n+      const context = await resolvePreviewJobContext({\n+        token: data.token,\n+        convexUrlOverride: data.convexUrl,\n+        logPrefix,\n+      });\n+\n+      callback({\n+        error: null,\n+        data: { success: true },\n+      });\n+\n+      try {\n+        await runPreviewJobScreenshots({\n+          token: data.token,\n+          anthropicApiKey: data.anthropicApiKey,\n+          context,\n+          logPrefix,\n+        });\n+      } catch (error) {\n+        log(\"ERROR\", `${logPrefix} Failed`, error);\n+      }\n+    } catch (error) {\n+      log(\"ERROR\", `${logPrefix} Validation failed`, error);\n+      callback({\n+        error: error instanceof Error ? error : new Error(String(error)),\n+        data: null,\n+      });\n+    }\n+  });\n+\n   socket.on(\"worker:configure-git\", async (data) => {\n     try {\n       const validated = WorkerConfigureGitSchema.parse(data);\n@@ -938,6 +1187,7 @@ async function createTerminal(\n     env?: Record<string, string>;\n     command?: string;\n     args?: string[];\n+    taskId?: Id<\"tasks\">;\n     taskRunId?: Id<\"taskRuns\">;\n     agentModel?: string;\n     startupCommands?: string[];\ndiff --git a/apps/worker/src/runBrowserAgentFromPrompt.ts b/apps/worker/src/runBrowserAgentFromPrompt.ts\nindex fdc51d801..ef711322d 100644\n--- a/apps/worker/src/runBrowserAgentFromPrompt.ts\n+++ b/apps/worker/src/runBrowserAgentFromPrompt.ts\n@@ -108,6 +108,28 @@ async function resolveCdpWebSocketUrl(\n   );\n }\n \n+async function refreshPageBeforeScreenshot(\n+  agent: BrowserAgent\n+): Promise<void> {\n+  console.log(\n+    \"[runBrowserAgentFromPrompt] Refreshing page before screenshot capture\"\n+  );\n+  try {\n+    await agent.page.reload({ waitUntil: \"networkidle\" });\n+    console.log(\n+      \"[runBrowserAgentFromPrompt] Page refresh completed. Proceeding to capture screenshot.\"\n+    );\n+  } catch (refreshError) {\n+    const reason =\n+      refreshError instanceof Error\n+        ? refreshError.message\n+        : String(refreshError ?? \"unknown refresh error\");\n+    console.error(\n+      `[runBrowserAgentFromPrompt] Failed to refresh page before screenshot: ${reason}`\n+    );\n+  }\n+}\n+\n async function captureScreenshotIfRequested(\n   agent: BrowserAgent\n ): Promise<void> {\n@@ -115,6 +137,8 @@ async function captureScreenshotIfRequested(\n     return;\n   }\n \n+  await refreshPageBeforeScreenshot(agent);\n+\n   try {\n     await agent.page.screenshot({\n       path: REQUESTED_SCREENSHOT_PATH,\ndiff --git a/apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/_components/private-repo-prompt.tsx b/apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/_components/private-repo-prompt.tsx\nindex 71acde887..ac3fc5403 100644\n--- a/apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/_components/private-repo-prompt.tsx\n+++ b/apps/www/app/(home)/(pr-review)/[teamSlugOrId]/[repo]/_components/private-repo-prompt.tsx\n@@ -34,14 +34,6 @@ export function PrivateRepoPrompt({\n         );\n       }\n \n-      const githubAppSlug =\n-        githubAppSlugProp || process.env.NEXT_PUBLIC_GITHUB_APP_SLUG;\n-      if (!githubAppSlug) {\n-        setError(\"GitHub App is not configured. Please contact support.\");\n-        setIsRedirecting(false);\n-        return;\n-      }\n-\n       const response = await fetch(\"/api/integrations/github/install-state\", {\n         method: \"POST\",\n         headers: { \"Content-Type\": \"application/json\" },\n@@ -70,11 +62,7 @@ export function PrivateRepoPrompt({\n         return;\n       }\n \n-      const { state } = (await response.json()) as { state: string };\n-      const installUrl = new URL(\n-        `https://github.com/apps/${githubAppSlug}/installations/new`,\n-      );\n-      installUrl.searchParams.set(\"state\", state);\n+      const { installUrl } = await response.json();\n \n       window.location.href = installUrl.toString();\n     } catch (err) {\ndiff --git a/apps/www/app/(preview)/preview/configure/page.tsx b/apps/www/app/(preview)/preview/configure/page.tsx\nnew file mode 100644\nindex 000000000..eff1f2148\n--- /dev/null\n+++ b/apps/www/app/(preview)/preview/configure/page.tsx\n@@ -0,0 +1,192 @@\n+import { headers } from \"next/headers\";\n+import { notFound, redirect } from \"next/navigation\";\n+import { PreviewConfigureClient } from \"@/components/preview/preview-configure-client\";\n+import { getConvex } from \"@/lib/utils/get-convex\";\n+import { stackServerApp } from \"@/lib/utils/stack\";\n+import { api } from \"@cmux/convex/api\";\n+import {\n+  getTeamDisplayName,\n+  getTeamId,\n+  getTeamSlug,\n+  getTeamSlugOrId,\n+  type StackTeam,\n+} from \"@/lib/team-utils\";\n+import { detectFrameworkPreset } from \"@/lib/github/framework-detection\";\n+import { env } from \"@/lib/utils/www-env\";\n+import { typedZid } from \"@cmux/shared/utils/typed-zid\";\n+\n+type PageProps = {\n+  searchParams?: Promise<SearchParams>;\n+};\n+\n+type SearchParams = Record<string, string | string[] | undefined>;\n+\n+function buildConfigurePath(search: SearchParams | undefined): string {\n+  const params = new URLSearchParams();\n+  if (search) {\n+    Object.entries(search).forEach(([key, value]) => {\n+      if (Array.isArray(value)) {\n+        value.forEach((entry) => {\n+          if (entry) params.append(key, entry);\n+        });\n+      } else if (value) {\n+        params.set(key, value);\n+      }\n+    });\n+  }\n+  const query = params.toString();\n+  return query ? `/preview/configure?${query}` : \"/preview/configure\";\n+}\n+\n+function getSearchValue(\n+  search: SearchParams | undefined,\n+  key: string\n+): string | null {\n+  if (!search) {\n+    return null;\n+  }\n+  const value = search[key];\n+  return Array.isArray(value) ? value[0] ?? null : value ?? null;\n+}\n+\n+export default async function PreviewConfigurePage({ searchParams }: PageProps) {\n+  const resolvedSearch = await searchParams;\n+  const configurePath = buildConfigurePath(resolvedSearch);\n+\n+  const user = await stackServerApp.getUser();\n+\n+  // If user is not authenticated, redirect to sign-in\n+  if (!user) {\n+    const signInUrl = `/handler/sign-in?after_auth_return_to=${encodeURIComponent(configurePath)}`;\n+    return redirect(signInUrl);\n+  }\n+\n+  const [auth, teamsResult] = await Promise.all([\n+    user.getAuthJson(),\n+    user.listTeams(),\n+  ]);\n+  const teams: StackTeam[] = teamsResult;\n+  const { accessToken } = auth;\n+\n+  if (teams.length === 0) {\n+    notFound();\n+  }\n+\n+  if (!accessToken) {\n+    throw new Error(\"Missing Stack access token\");\n+  }\n+\n+  const repo = getSearchValue(resolvedSearch, \"repo\");\n+  const installationId = getSearchValue(resolvedSearch, \"installationId\");\n+  const environmentId = getSearchValue(resolvedSearch, \"environmentId\");\n+\n+  if (!repo) {\n+    notFound();\n+  }\n+\n+  const searchTeam = getSearchValue(resolvedSearch, \"team\");\n+\n+  const selectedTeam =\n+    teams.find(\n+      (team) =>\n+        Boolean(searchTeam) &&\n+        getTeamDisplayName(team).toLowerCase() === searchTeam?.toLowerCase()\n+    ) ||\n+    teams.find((team) => getTeamSlugOrId(team) === searchTeam) ||\n+    teams[0];\n+  const selectedTeamSlugOrId = getTeamSlugOrId(selectedTeam);\n+\n+  const convex = getConvex({ accessToken });\n+  const providerConnections = await convex.query(api.github.listProviderConnections, {\n+    teamSlugOrId: selectedTeamSlugOrId,\n+  });\n+\n+  const hasGithubAppInstallation = providerConnections.some(\n+    (connection) => connection.isActive,\n+  );\n+\n+  if (!hasGithubAppInstallation) {\n+    const githubAppSlug = process.env.NEXT_PUBLIC_GITHUB_APP_SLUG;\n+    if (!githubAppSlug) {\n+      throw new Error(\"GitHub App slug is not configured\");\n+    }\n+\n+    const headerList = await headers();\n+    const host = headerList.get(\"x-forwarded-host\") ?? headerList.get(\"host\");\n+    const protocol = headerList.get(\"x-forwarded-proto\") ?? \"https\";\n+    const returnUrl =\n+      host && configurePath.startsWith(\"/\")\n+        ? `${protocol}://${host}${configurePath}`\n+        : configurePath;\n+\n+    const { state } = await convex.mutation(api.github_app.mintInstallState, {\n+      teamSlugOrId: selectedTeamSlugOrId,\n+      returnUrl,\n+    });\n+\n+    const url = new URL(`https://github.com/apps/${githubAppSlug}/installations/new`);\n+    url.searchParams.set(\"state\", state);\n+    return redirect(url.toString());\n+  }\n+\n+  const clientTeams = teams.map((team) => ({\n+    id: getTeamId(team),\n+    slug: getTeamSlug(team),\n+    slugOrId: getTeamSlugOrId(team),\n+    displayName: getTeamDisplayName(team),\n+    name: team.name ?? getTeamDisplayName(team),\n+  }));\n+\n+  const detectedFrameworkPreset = await detectFrameworkPreset(repo);\n+\n+  let initialEnvVarsContent: string | null = null;\n+  let initialMaintenanceScript: string | null = null;\n+  let initialDevScript: string | null = null;\n+\n+  if (environmentId) {\n+    try {\n+      // Validate and parse environment ID\n+      const parsedEnvId = typedZid(\"environments\").parse(environmentId);\n+\n+      // Fetch environment details directly from Convex\n+      const environment = await convex.query(api.environments.get, {\n+        teamSlugOrId: selectedTeamSlugOrId,\n+        id: parsedEnvId,\n+      });\n+\n+      if (environment) {\n+        initialMaintenanceScript = environment.maintenanceScript ?? null;\n+        initialDevScript = environment.devScript ?? null;\n+\n+        // Fetch environment variables directly from Stack Data Vault\n+        try {\n+          const store = await stackServerApp.getDataVaultStore(\"cmux-snapshot-envs\");\n+          const varsContent = await store.getValue(environment.dataVaultKey, {\n+            secret: env.STACK_DATA_VAULT_SECRET,\n+          });\n+          if (typeof varsContent === \"string\") {\n+            initialEnvVarsContent = varsContent;\n+          }\n+        } catch (error) {\n+          console.error(\"Failed to fetch environment vars from data vault\", error);\n+        }\n+      }\n+    } catch (error) {\n+      console.error(\"Failed to fetch environment details\", error);\n+    }\n+  }\n+\n+  return (\n+    <PreviewConfigureClient\n+      initialTeamSlugOrId={selectedTeamSlugOrId}\n+      teams={clientTeams}\n+      repo={repo}\n+      installationId={installationId}\n+      initialFrameworkPreset={detectedFrameworkPreset}\n+      initialEnvVarsContent={initialEnvVarsContent}\n+      initialMaintenanceScript={initialMaintenanceScript}\n+      initialDevScript={initialDevScript}\n+      startAtConfigureEnvironment={Boolean(environmentId)}\n+    />\n+  );\n+}\ndiff --git a/apps/www/app/(preview)/preview/page.tsx b/apps/www/app/(preview)/preview/page.tsx\nnew file mode 100644\nindex 000000000..205fa669e\n--- /dev/null\n+++ b/apps/www/app/(preview)/preview/page.tsx\n@@ -0,0 +1,159 @@\n+import { stackServerApp } from \"@/lib/utils/stack\";\n+import { getConvex } from \"@/lib/utils/get-convex\";\n+import { api } from \"@cmux/convex/api\";\n+import { PreviewDashboard } from \"@/components/preview/preview-dashboard\";\n+import {\n+  getTeamDisplayName,\n+  getTeamSlugOrId,\n+  type StackTeam,\n+} from \"@/lib/team-utils\";\n+\n+export const dynamic = \"force-dynamic\";\n+\n+type PageProps = {\n+  searchParams?: Promise<Record<string, string | string[] | undefined>>;\n+};\n+\n+type PreviewConfigListItem = {\n+  id: string;\n+  repoFullName: string;\n+  environmentId: string | null;\n+  repoInstallationId: number | null;\n+  repoDefaultBranch: string | null;\n+  status: \"active\" | \"paused\" | \"disabled\";\n+  lastRunAt: number | null;\n+  teamSlugOrId: string;\n+  teamName: string;\n+};\n+\n+type TeamOption = {\n+  slugOrId: string;\n+  displayName: string;\n+};\n+\n+function serializeProviderConnections(\n+  connections: Array<{\n+    installationId: number;\n+    accountLogin: string | null | undefined;\n+    accountType: string | null | undefined;\n+    isActive: boolean;\n+  }>\n+) {\n+  return connections.map((conn) => ({\n+    installationId: conn.installationId,\n+    accountLogin: conn.accountLogin ?? null,\n+    accountType: conn.accountType ?? null,\n+    isActive: conn.isActive,\n+  }));\n+}\n+\n+export default async function PreviewLandingPage({ searchParams }: PageProps) {\n+  const user = await stackServerApp.getUser();\n+  const resolvedSearch = await searchParams;\n+\n+  if (!user) {\n+    return (\n+      <div className=\"relative isolate min-h-dvh bg-[#05050a] text-white\">\n+        <div className=\"absolute inset-0 -z-10 bg-[radial-gradient(circle_at_top,_rgba(4,120,255,0.3),_transparent_45%)]\" />\n+\n+        <PreviewDashboard\n+          selectedTeamSlugOrId=\"\"\n+          teamOptions={[]}\n+          providerConnectionsByTeam={{}}\n+          isAuthenticated={false}\n+          previewConfigs={[]}\n+        />\n+      </div>\n+    );\n+  }\n+\n+  const [auth, teamsResult] = await Promise.all([\n+    user.getAuthJson(),\n+    user.listTeams(),\n+  ]);\n+  const teams: StackTeam[] = teamsResult;\n+  const { accessToken } = auth;\n+\n+  if (!accessToken) {\n+    throw new Error(\"Missing Stack access token\");\n+  }\n+\n+  const searchTeam = (() => {\n+    if (!resolvedSearch) {\n+      return null;\n+    }\n+    const value = resolvedSearch.team;\n+    if (Array.isArray(value)) {\n+      return value[0] ?? null;\n+    }\n+    return value ?? null;\n+  })();\n+\n+  const selectedTeam =\n+    teams.find((team) => getTeamSlugOrId(team) === searchTeam) ?? teams[0];\n+  const selectedTeamSlugOrId = selectedTeam ? getTeamSlugOrId(selectedTeam) : \"\";\n+  const teamOptions: TeamOption[] = teams.map((team) => ({\n+    slugOrId: getTeamSlugOrId(team),\n+    displayName: getTeamDisplayName(team),\n+  }));\n+\n+  const convex = getConvex({ accessToken });\n+  const [providerConnectionsByTeamEntries, previewConfigs] = await Promise.all([\n+    Promise.all(\n+      teams.map(async (team) => {\n+        const teamSlugOrId = getTeamSlugOrId(team);\n+        const connections = await convex.query(api.github.listProviderConnections, {\n+          teamSlugOrId,\n+        });\n+        const serialized = serializeProviderConnections(connections);\n+        return [teamSlugOrId, serialized];\n+      }),\n+    ),\n+    Promise.all(\n+      teams.map(async (team) => {\n+        const teamSlugOrId = getTeamSlugOrId(team);\n+        try {\n+          const configs = await convex.query(api.previewConfigs.listByTeam, {\n+            teamSlugOrId,\n+          });\n+          return configs.map(\n+            (config): PreviewConfigListItem => ({\n+              id: config._id,\n+              repoFullName: config.repoFullName,\n+              environmentId: config.environmentId ?? null,\n+              repoInstallationId: config.repoInstallationId ?? null,\n+              repoDefaultBranch: config.repoDefaultBranch ?? null,\n+              status: config.status ?? \"active\",\n+              lastRunAt: config.lastRunAt ?? null,\n+              teamSlugOrId,\n+              teamName: getTeamDisplayName(team),\n+            })\n+          );\n+        } catch (error) {\n+          console.error(\"[PreviewLandingPage] Failed to load preview configs\", {\n+            teamSlugOrId,\n+            error,\n+          });\n+          return [];\n+        }\n+      })\n+    ).then((results) => results.flat()),\n+  ]);\n+  const providerConnectionsByTeam = Object.fromEntries(\n+    providerConnectionsByTeamEntries,\n+  );\n+\n+  return (\n+    <div className=\"relative isolate min-h-dvh bg-[#05050a] text-white\">\n+      <div className=\"absolute inset-0 -z-10 bg-[radial-gradient(circle_at_top,_rgba(4,120,255,0.3),_transparent_45%)]\" />\n+\n+      <PreviewDashboard\n+        selectedTeamSlugOrId={selectedTeamSlugOrId}\n+        teamOptions={teamOptions}\n+        providerConnectionsByTeam={providerConnectionsByTeam}\n+        isAuthenticated={true}\n+        previewConfigs={previewConfigs}\n+      />\n+    </div>\n+  );\n+}\ndiff --git a/apps/www/app/globals.css b/apps/www/app/globals.css\nindex 2d3d2a39b..c803fc83b 100644\n--- a/apps/www/app/globals.css\n+++ b/apps/www/app/globals.css\n@@ -240,3 +240,26 @@ body {\n   display: inline-flex;\n   cursor: help;\n }\n+\n+.repo-scroll-area {\n+  scrollbar-width: thin;\n+  scrollbar-color: rgba(255, 255, 255, 0.6) transparent;\n+}\n+\n+.repo-scroll-area::-webkit-scrollbar {\n+  width: 12px;\n+}\n+\n+.repo-scroll-area::-webkit-scrollbar-thumb {\n+  background: rgba(255, 255, 255, 0.6);\n+  border-radius: 9999px;\n+  border: 3px solid rgba(10, 10, 10, 0.45);\n+}\n+\n+.repo-scroll-area::-webkit-scrollbar-thumb:hover {\n+  background: rgba(255, 255, 255, 0.75);\n+}\n+\n+.repo-scroll-area::-webkit-scrollbar-track {\n+  background: transparent;\n+}\ndiff --git a/apps/www/components/preview/preview-configure-client.tsx b/apps/www/components/preview/preview-configure-client.tsx\nnew file mode 100644\nindex 000000000..619603fc0\n--- /dev/null\n+++ b/apps/www/components/preview/preview-configure-client.tsx\n@@ -0,0 +1,1847 @@\n+\"use client\";\n+\n+import {\n+  useCallback,\n+  useEffect,\n+  useLayoutEffect,\n+  useMemo,\n+  useRef,\n+  useState,\n+  type ReactNode,\n+} from \"react\";\n+import {\n+  Loader2,\n+  ArrowLeft,\n+  ArrowRight,\n+  Eye,\n+  EyeOff,\n+  Minus,\n+  Plus,\n+  Copy,\n+  Github,\n+  ChevronDown,\n+  Sparkles,\n+  Check,\n+} from \"lucide-react\";\n+import Link from \"next/link\";\n+import { formatEnvVarsContent } from \"@cmux/shared/utils/format-env-vars-content\";\n+import clsx from \"clsx\";\n+\n+const MASKED_ENV_VALUE = \"••••••••••••••••\";\n+\n+export type FrameworkPreset =\n+  | \"other\"\n+  | \"next\"\n+  | \"vite\"\n+  | \"remix\"\n+  | \"nuxt\"\n+  | \"astro\"\n+  | \"sveltekit\"\n+  | \"angular\"\n+  | \"cra\"\n+  | \"vue\";\n+\n+type FrameworkIconKey =\n+  | \"other\"\n+  | \"next\"\n+  | \"vite\"\n+  | \"remix\"\n+  | \"nuxt\"\n+  | \"astro\"\n+  | \"svelte\"\n+  | \"angular\"\n+  | \"react\"\n+  | \"vue\";\n+\n+type FrameworkPresetConfig = {\n+  name: string;\n+  maintenanceScript: string;\n+  devScript: string;\n+  icon: FrameworkIconKey;\n+};\n+\n+const FRAMEWORK_PRESETS: Record<FrameworkPreset, FrameworkPresetConfig> = {\n+  other: { name: \"Other\", maintenanceScript: \"\", devScript: \"\", icon: \"other\" },\n+  next: { name: \"Next.js\", maintenanceScript: \"npm install\", devScript: \"npm run dev\", icon: \"next\" },\n+  vite: { name: \"Vite\", maintenanceScript: \"npm install\", devScript: \"npm run dev\", icon: \"vite\" },\n+  remix: { name: \"Remix\", maintenanceScript: \"npm install\", devScript: \"npm run dev\", icon: \"remix\" },\n+  nuxt: { name: \"Nuxt\", maintenanceScript: \"npm install\", devScript: \"npm run dev\", icon: \"nuxt\" },\n+  astro: { name: \"Astro\", maintenanceScript: \"npm install\", devScript: \"npm run dev\", icon: \"astro\" },\n+  sveltekit: {\n+    name: \"SvelteKit\",\n+    maintenanceScript: \"npm install\",\n+    devScript: \"npm run dev\",\n+    icon: \"svelte\",\n+  },\n+  angular: {\n+    name: \"Angular\",\n+    maintenanceScript: \"npm install\",\n+    devScript: \"npm start\",\n+    icon: \"angular\",\n+  },\n+  cra: {\n+    name: \"Create React App\",\n+    maintenanceScript: \"npm install\",\n+    devScript: \"npm start\",\n+    icon: \"react\",\n+  },\n+  vue: {\n+    name: \"Vue\",\n+    maintenanceScript: \"npm install\",\n+    devScript: \"npm run dev\",\n+    icon: \"vue\",\n+  },\n+};\n+\n+type SandboxInstance = {\n+  instanceId: string;\n+  vscodeUrl: string;\n+  workerUrl: string;\n+  vncUrl?: string;\n+  provider: string;\n+};\n+\n+type EnvVar = { name: string; value: string; isSecret: boolean };\n+\n+type WizardStep = 1 | 2;\n+\n+type PreviewTeamOption = {\n+  id: string;\n+  slug: string | null;\n+  slugOrId: string;\n+  displayName: string;\n+  name: string | null;\n+};\n+\n+type PreviewConfigureClientProps = {\n+  initialTeamSlugOrId: string;\n+  teams: PreviewTeamOption[];\n+  repo: string;\n+  installationId: string | null;\n+  initialFrameworkPreset?: FrameworkPreset;\n+  initialEnvVarsContent?: string | null;\n+  initialMaintenanceScript?: string | null;\n+  initialDevScript?: string | null;\n+  startAtConfigureEnvironment?: boolean;\n+};\n+\n+function normalizeVncUrl(url: string): string | null {\n+  try {\n+    const target = new URL(url);\n+    target.searchParams.set(\"autoconnect\", \"1\");\n+    target.searchParams.set(\"resize\", \"scale\");\n+    return target.toString();\n+  } catch {\n+    const separator = url.includes(\"?\") ? \"&\" : \"?\";\n+    return `${url}${separator}autoconnect=1&resize=scale`;\n+  }\n+}\n+\n+function resolveMorphHostId(\n+  instanceId?: string,\n+  workspaceUrl?: string\n+): string | null {\n+  if (instanceId && instanceId.trim().length > 0) {\n+    return instanceId.trim().toLowerCase().replace(/_/g, \"-\");\n+  }\n+\n+  if (!workspaceUrl) {\n+    return null;\n+  }\n+\n+  try {\n+    const url = new URL(workspaceUrl);\n+    const directMatch = url.hostname.match(\n+      /^port-\\d+-(morphvm-[^.]+)\\.http\\.cloud\\.morph\\.so$/i\n+    );\n+    if (directMatch && directMatch[1]) {\n+      return directMatch[1].toLowerCase();\n+    }\n+\n+    const proxyMatch = url.hostname.match(\n+      /^cmux-([^-]+)-[a-z0-9-]+-\\d+\\.cmux\\.(?:app|dev|sh|local|localhost)$/i\n+    );\n+    if (proxyMatch && proxyMatch[1]) {\n+      return `morphvm-${proxyMatch[1].toLowerCase()}`;\n+    }\n+  } catch {\n+    return null;\n+  }\n+\n+  return null;\n+}\n+\n+function deriveVncUrl(\n+  instanceId?: string,\n+  workspaceUrl?: string\n+): string | null {\n+  const morphHostId = resolveMorphHostId(instanceId, workspaceUrl);\n+  if (!morphHostId) {\n+    return null;\n+  }\n+\n+  const hostname = `port-39380-${morphHostId}.http.cloud.morph.so`;\n+  const baseUrl = `https://${hostname}/vnc.html`;\n+  return normalizeVncUrl(baseUrl);\n+}\n+\n+const FRAMEWORK_ICON_META: Record<\n+  FrameworkIconKey,\n+  { icon: ReactNode; bgClass: string; textClass: string }\n+> = {\n+  other: {\n+    icon: <Sparkles className=\"h-4 w-4\" />,\n+    bgClass: \"bg-neutral-200 dark:bg-neutral-800\",\n+    textClass: \"text-neutral-700 dark:text-neutral-100\",\n+  },\n+  next: {\n+    icon: (\n+      <svg viewBox=\"0 0 24 24\" aria-hidden=\"true\" className=\"h-4 w-4\">\n+        <path\n+          d=\"M18.665 21.978C16.758 23.255 14.465 24 12 24 5.377 24 0 18.623 0 12S5.377 0 12 0s12 5.377 12 12c0 3.583-1.574 6.801-4.067 9.001L9.219 7.2H7.2v9.596h1.615V9.251l9.85 12.727Zm-3.332-8.533 1.6 2.061V7.2h-1.6v6.245Z\"\n+          fill=\"currentColor\"\n+        />\n+      </svg>\n+    ),\n+    bgClass: \"bg-neutral-900\",\n+    textClass: \"text-white\",\n+  },\n+  vite: {\n+    icon: (\n+      <svg viewBox=\"0 0 24 24\" aria-hidden=\"true\" className=\"h-4 w-4\">\n+        <path\n+          d=\"m8.286 10.578.512-8.657a.306.306 0 0 1 .247-.282L17.377.006a.306.306 0 0 1 .353.385l-1.558 5.403a.306.306 0 0 0 .352.385l2.388-.46a.306.306 0 0 1 .332.438l-6.79 13.55-.123.19a.294.294 0 0 1-.252.14c-.177 0-.35-.152-.305-.369l1.095-5.301a.306.306 0 0 0-.388-.355l-1.433.435a.306.306 0 0 1-.389-.354l.69-3.375a.306.306 0 0 0-.37-.36l-2.32.536a.306.306 0 0 1-.374-.316zm14.976-7.926L17.284 3.74l-.544 1.887 2.077-.4a.8.8 0 0 1 .84.369.8.8 0 0 1 .034.783L12.9 19.93l-.013.025-.015.023-.122.19a.801.801 0 0 1-.672.37.826.826 0 0 1-.634-.302.8.8 0 0 1-.16-.67l1.029-4.981-1.12.34a.81.81 0 0 1-.86-.262.802.802 0 0 1-.165-.67l.63-3.08-2.027.468a.808.808 0 0 1-.768-.233.81.81 0 0 1-.217-.6l.389-6.57-7.44-1.33a.612.612 0 0 0-.64.906L11.58 23.691a.612.612 0 0 0 1.066-.004l11.26-20.135a.612.612 0 0 0-.644-.9z\"\n+          fill=\"currentColor\"\n+        />\n+      </svg>\n+    ),\n+    bgClass: \"bg-gradient-to-br from-indigo-500 via-purple-500 to-amber-400\",\n+    textClass: \"text-white\",\n+  },\n+  remix: {\n+    icon: (\n+      <svg viewBox=\"0 0 24 24\" aria-hidden=\"true\" className=\"h-4 w-4\">\n+        <path\n+          d=\"M21.511 18.508c.216 2.773.216 4.073.216 5.492H15.31c0-.309.006-.592.011-.878.018-.892.036-1.821-.109-3.698-.19-2.747-1.374-3.358-3.55-3.358H1.574v-5h10.396c2.748 0 4.122-.835 4.122-3.049 0-1.946-1.374-3.125-4.122-3.125H1.573V0h11.541c6.221 0 9.313 2.938 9.313 7.632 0 3.511-2.176 5.8-5.114 6.182 2.48.497 3.93 1.909 4.198 4.694ZM1.573 24v-3.727h6.784c1.133 0 1.379.84 1.379 1.342V24Z\"\n+          fill=\"currentColor\"\n+        />\n+      </svg>\n+    ),\n+    bgClass: \"bg-neutral-800\",\n+    textClass: \"text-white\",\n+  },\n+  nuxt: {\n+    icon: (\n+      <svg viewBox=\"0 0 24 24\" aria-hidden=\"true\" className=\"h-4 w-4\">\n+        <path\n+          d=\"m2.5 17.75 5.25-9.5 4.3 7.5 2.95-5.5 6.5 11.5h-3.2l-3.3-5.8-2.8 5.8-4.3-7.5-3.35 6H2.5Z\"\n+          fill=\"currentColor\"\n+        />\n+      </svg>\n+    ),\n+    bgClass: \"bg-emerald-600\",\n+    textClass: \"text-white\",\n+  },\n+  astro: {\n+    icon: (\n+      <svg viewBox=\"0 0 24 24\" aria-hidden=\"true\" className=\"h-4 w-4\">\n+        <path\n+          d=\"M8.358 20.162c-1.186-1.07-1.532-3.316-1.038-4.944.856 1.026 2.043 1.352 3.272 1.535 1.897.283 3.76.177 5.522-.678.202-.098.388-.229.608-.36.166.473.209.95.151 1.437-.14 1.185-.738 2.1-1.688 2.794-.38.277-.782.525-1.175.787-1.205.804-1.531 1.747-1.078 3.119l.044.148a3.158 3.158 0 0 1-1.407-1.188 3.31 3.31 0 0 1-.544-1.815c-.004-.32-.004-.642-.048-.958-.106-.769-.472-1.113-1.161-1.133-.707-.02-1.267.411-1.415 1.09-.012.053-.028.104-.045.165h.002zm-5.961-4.445s3.24-1.575 6.49-1.575l2.451-7.565c.092-.366.36-.614.662-.614.302 0 .57.248.662.614l2.45 7.565c3.85 0 6.491 1.575 6.491 1.575L16.088.727C15.93.285 15.663 0 15.303 0H8.697c-.36 0-.615.285-.784.727l-5.516 14.99z\"\n+          fill=\"currentColor\"\n+        />\n+      </svg>\n+    ),\n+    bgClass: \"bg-neutral-900\",\n+    textClass: \"text-white\",\n+  },\n+  svelte: {\n+    icon: (\n+      <svg viewBox=\"0 0 24 24\" aria-hidden=\"true\" className=\"h-4 w-4\">\n+        <path\n+          d=\"M10.354 21.125a4.44 4.44 0 0 1-4.765-1.767 4.109 4.109 0 0 1-.703-3.107 3.898 3.898 0 0 1 .134-.522l.105-.321.287.21a7.21 7.21 0 0 0 2.186 1.092l.208.063-.02.208a1.253 1.253 0 0 0 .226.83 1.337 1.337 0 0 0 1.435.533 1.231 1.231 0 0 0 .343-.15l5.59-3.562a1.164 1.164 0 0 0 .524-.778 1.242 1.242 0 0 0-.211-.937 1.338 1.338 0 0 0-1.435-.533 1.23 1.23 0 0 0-.343.15l-2.133 1.36a4.078 4.078 0 0 1-1.135.499 4.44 4.44 0 0 1-4.765-1.766 4.108 4.108 0 0 1-.702-3.108 3.855 3.855 0 0 1 1.742-2.582l5.589-3.563a4.072 4.072 0 0 1 1.135-.499 4.44 4.44 0 0 1 4.765 1.767 4.109 4.109 0 0 1 .703 3.107 3.943 3.943 0 0 1-.134.522l-.105.321-.286-.21a7.204 7.204 0 0 0-2.187-1.093l-.208-.063.02-.207a1.255 1.255 0 0 0-.226-.831 1.337 1.337 0 0 0-1.435-.532 1.231 1.231 0 0 0-.343.15L8.62 9.368a1.162 1.162 0 0 0-.524.778 1.24 1.24 0 0 0 .211.937 1.338 1.338 0 0 0 1.435.533 1.235 1.235 0 0 0 .344-.151l2.132-1.36a4.067 4.067 0 0 1 1.135-.498 4.44 4.44 0 0 1 4.765 1.766 4.108 4.108 0 0 1 .702 3.108 3.857 3.857 0 0 1-1.742 2.583l-5.589 3.562a4.072 4.072 0 0 1-1.135.499m10.358-17.95C18.484-.015 14.082-.96 10.9 1.068L5.31 4.63a6.412 6.412 0 0 0-2.896 4.295 6.753 6.753 0 0 0 .666 4.336 6.43 6.43 0 0 0-.96 2.396 6.833 6.833 0 0 0 1.168 5.167c2.229 3.19 6.63 4.135 9.812 2.108l5.59-3.562a6.41 6.41 0 0 0 2.896-4.295 6.756 6.756 0 0 0-.665-4.336 6.429 6.429 0 0 0 .958-2.396 6.831 6.831 0 0 0-1.167-5.168Z\"\n+          fill=\"currentColor\"\n+        />\n+      </svg>\n+    ),\n+    bgClass: \"bg-orange-500\",\n+    textClass: \"text-white\",\n+  },\n+  angular: {\n+    icon: (\n+      <svg viewBox=\"0 0 24 24\" aria-hidden=\"true\" className=\"h-4 w-4\">\n+        <path\n+          d=\"M11.985 0 2.1 3.65l1.5 13.05 8.385 4.8 8.4-4.8 1.5-13.05L11.985 0Zm0 3.45 5.1 1.8-.6 6.6h-2.1l.3-3.15-2.7 1.05-2.7-1.05.3 3.15h-2.1l-.6-6.6 5.1-1.8Zm0 8.55 2.85 1.05-.9 4.35-1.95 1.05-1.95-1.05-.9-4.35Z\"\n+          fill=\"currentColor\"\n+        />\n+      </svg>\n+    ),\n+    bgClass: \"bg-red-600\",\n+    textClass: \"text-white\",\n+  },\n+  react: {\n+    icon: (\n+      <svg viewBox=\"0 0 24 24\" aria-hidden=\"true\" className=\"h-4 w-4\">\n+        <path\n+          d=\"M12 9.2a2.8 2.8 0 1 0 0 5.6 2.8 2.8 0 0 0 0-5.6Zm0-6.2c1.35 0 2.53.27 3.16.7.6.4.77.86.47 1.5-.24.53-.73 1.16-1.37 1.82.32.34.62.7.9 1.07 1.13-.35 2.21-.54 3.07-.54 1.35 0 2.53.27 3.16.7.6.4.77.86.47 1.5-.52 1.15-1.95 2.63-3.81 3.92.13.53.23 1.06.3 1.6 1.21.26 2.33.68 3.04 1.18.6.4.77.86.47 1.5-.24.53-.73 1.16-1.37 1.82-.64.66-1.35 1.25-2.08 1.77-.73.52-1.48.96-2.2 1.3-.73.35-1.42.6-2.02.73-.6.14-1.12.15-1.5 0-.38.15-.9.14-1.5 0-.6-.14-1.29-.38-2.02-.73-.72-.34-1.47-.78-2.2-1.3a16.3 16.3 0 0 1-2.08-1.77c-.64-.66-1.13-1.29-1.37-1.82-.3-.64-.13-1.1.47-1.5.71-.5 1.83-.92 3.04-1.18.07-.54.17-1.07.3-1.6-1.86-1.29-3.29-2.77-3.81-3.92-.3-.64-.13-1.1.47-1.5.63-.43 1.8-.7 3.16-.7.86 0 1.94.2 3.07.54.28-.37.58-.73.9-1.07-.64-.66-1.13-1.29-1.37-1.82-.3-.64-.13-1.1.47-1.5C9.47 3.27 10.65 3 12 3Zm0 1c-1.15 0-2.18.2-2.75.58-.26.17-.28.28-.16.55.17.37.57.88 1.13 1.46.2.2.42.43.64.67-.46.52-.87 1.06-1.24 1.62-1.3-.4-2.5-.63-3.38-.63-1.15 0-2.18.2-2.75.58-.26.17-.28.28-.16.55.37.82 1.57 2.08 3.47 3.36l.35.24c-.16.66-.27 1.33-.33 2.01-1.17.26-2.26.66-2.97 1.15-.26.18-.28.3-.16.56.17.38.57.88 1.13 1.46.56.58 1.19 1.12 1.87 1.6.68.48 1.37.9 2.04 1.22.68.32 1.31.54 1.82.66.5.12.85.12 1 .06l.18-.06c.15.06.5.06 1-.06.51-.12 1.14-.34 1.82-.66.67-.32 1.36-.74 2.04-1.22.68-.48 1.31-1.02 1.87-1.6.56-.58.96-1.08 1.13-1.46.12-.26.1-.38-.16-.56-.71-.49-1.8-.89-2.97-1.15a12.5 12.5 0 0 0-.33-2.01l.35-.24c1.9-1.28 3.1-2.54 3.47-3.36.12-.27.1-.38-.16-.56-.57-.38-1.6-.58-2.75-.58-.88 0-2.08.23-3.38.63a13 13 0 0 0-1.24-1.62 17 17 0 0 0 .64-.67c.56-.58.96-1.09 1.13-1.46.12-.27.1-.38-.16-.56-.57-.38-1.6-.58-2.75-.58Z\"\n+          fill=\"currentColor\"\n+        />\n+      </svg>\n+    ),\n+    bgClass: \"bg-sky-100\",\n+    textClass: \"text-sky-700\",\n+  },\n+  vue: {\n+    icon: (\n+      <svg viewBox=\"0 0 24 24\" aria-hidden=\"true\" className=\"h-4 w-4\">\n+        <path\n+          d=\"M12 3.1 9.07 8.2 6.14 3.1H0l12 20.9L24 3.1h-6.14L14.93 8.2 12 3.1Z\"\n+          fill=\"currentColor\"\n+        />\n+      </svg>\n+    ),\n+    bgClass: \"bg-emerald-600\",\n+    textClass: \"text-white\",\n+  },\n+};\n+\n+function FrameworkIconBubble({ preset }: { preset: FrameworkPreset }) {\n+  const meta = FRAMEWORK_ICON_META[FRAMEWORK_PRESETS[preset].icon] ?? FRAMEWORK_ICON_META.other;\n+  return (\n+    <span\n+      className={clsx(\n+        \"flex h-8 w-8 items-center justify-center rounded-md border border-neutral-200 dark:border-neutral-800\",\n+        meta.bgClass,\n+        meta.textClass\n+      )}\n+      aria-hidden=\"true\"\n+    >\n+      {meta.icon}\n+    </span>\n+  );\n+}\n+\n+const ensureInitialEnvVars = (initial?: EnvVar[]): EnvVar[] => {\n+  const base = (initial ?? []).map((item) => ({\n+    name: item.name,\n+    value: item.value,\n+    isSecret: item.isSecret ?? true,\n+  }));\n+  if (base.length === 0) {\n+    return [{ name: \"\", value: \"\", isSecret: true }];\n+  }\n+  const last = base[base.length - 1];\n+  if (!last || last.name.trim().length > 0 || last.value.trim().length > 0) {\n+    base.push({ name: \"\", value: \"\", isSecret: true });\n+  }\n+  return base;\n+};\n+\n+function parseEnvBlock(text: string): Array<{ name: string; value: string }> {\n+  const normalized = text.replace(/\\r\\n?/g, \"\\n\");\n+  const lines = normalized.split(\"\\n\");\n+  const results: Array<{ name: string; value: string }> = [];\n+\n+  for (const line of lines) {\n+    const trimmed = line.trim();\n+    if (trimmed.length === 0 || trimmed.startsWith(\"#\") || trimmed.startsWith(\"//\")) continue;\n+\n+    const cleanLine = trimmed.replace(/^export\\s+/, \"\").replace(/^set\\s+/, \"\");\n+    const eqIdx = cleanLine.indexOf(\"=\");\n+\n+    if (eqIdx === -1) continue;\n+\n+    const key = cleanLine.slice(0, eqIdx).trim();\n+    let value = cleanLine.slice(eqIdx + 1).trim();\n+\n+    if ((value.startsWith('\"') && value.endsWith('\"')) ||\n+        (value.startsWith(\"'\") && value.endsWith(\"'\"))) {\n+      value = value.slice(1, -1);\n+    }\n+\n+    if (key && !/\\s/.test(key)) {\n+      results.push({ name: key, value });\n+    }\n+  }\n+\n+  return results;\n+}\n+\n+\n+// Persistent iframe manager for Next.js\n+type PersistentIframeOptions = {\n+  allow?: string;\n+  sandbox?: string;\n+};\n+\n+type MountOptions = {\n+  backgroundColor?: string;\n+};\n+\n+class SimplePersistentIframeManager {\n+  private iframes = new Map<\n+    string,\n+    { iframe: HTMLIFrameElement; wrapper: HTMLDivElement; allow?: string; sandbox?: string }\n+  >();\n+  private container: HTMLDivElement | null = null;\n+\n+  constructor() {\n+    if (typeof document !== \"undefined\") {\n+      this.initContainer();\n+    }\n+  }\n+\n+  private initContainer() {\n+    this.container = document.createElement(\"div\");\n+    this.container.id = \"persistent-iframe-container\";\n+    this.container.style.cssText = `\n+      position: fixed;\n+      top: 0;\n+      left: 0;\n+      width: 0;\n+      height: 0;\n+      pointer-events: none;\n+      z-index: 9999;\n+    `;\n+    document.body.appendChild(this.container);\n+  }\n+\n+  setVisibility(key: string, visible: boolean) {\n+    const entry = this.iframes.get(key);\n+    if (!entry) {\n+      return;\n+    }\n+    entry.wrapper.style.visibility = visible ? \"visible\" : \"hidden\";\n+    entry.wrapper.style.pointerEvents = visible ? \"auto\" : \"none\";\n+  }\n+\n+  getOrCreateIframe(\n+    key: string,\n+    url: string,\n+    options?: PersistentIframeOptions\n+  ): HTMLIFrameElement {\n+    const existing = this.iframes.get(key);\n+    if (existing) {\n+      if (options?.allow && existing.allow !== options.allow) {\n+        existing.iframe.allow = options.allow;\n+        existing.allow = options.allow;\n+      }\n+      if (options?.sandbox && existing.sandbox !== options.sandbox) {\n+        existing.iframe.setAttribute(\"sandbox\", options.sandbox);\n+        existing.sandbox = options.sandbox;\n+      }\n+      if (existing.iframe.src !== url) {\n+        existing.iframe.src = url;\n+      }\n+      return existing.iframe;\n+    }\n+\n+    const wrapper = document.createElement(\"div\");\n+    wrapper.style.cssText = `\n+      position: fixed;\n+      visibility: hidden;\n+      pointer-events: none;\n+      transform: translate(-100vw, -100vh);\n+      width: 0;\n+      height: 0;\n+      display: flex;\n+      align-items: center;\n+      justify-content: center;\n+      background: transparent;\n+    `;\n+    wrapper.setAttribute(\"data-iframe-key\", key);\n+\n+    const iframe = document.createElement(\"iframe\");\n+    iframe.style.cssText = `\n+      width: 100%;\n+      height: 100%;\n+      border: 0;\n+      display: block;\n+      background: transparent;\n+    `;\n+    iframe.style.transform = \"none\";\n+    iframe.src = url;\n+    if (options?.allow) {\n+      iframe.allow = options.allow;\n+    } else {\n+      iframe.allow = \"clipboard-read; clipboard-write; cross-origin-isolated; fullscreen\";\n+    }\n+    if (options?.sandbox) {\n+      iframe.setAttribute(\"sandbox\", options.sandbox);\n+    } else {\n+      iframe.setAttribute(\n+        \"sandbox\",\n+        \"allow-same-origin allow-scripts allow-forms allow-downloads allow-modals allow-popups\"\n+      );\n+    }\n+\n+    wrapper.appendChild(iframe);\n+    this.container?.appendChild(wrapper);\n+    this.iframes.set(key, {\n+      iframe,\n+      wrapper,\n+      allow: options?.allow,\n+      sandbox: options?.sandbox,\n+    });\n+\n+    return iframe;\n+  }\n+\n+  mountIframe(\n+    key: string,\n+    targetElement: HTMLElement,\n+    options?: MountOptions\n+  ): () => void {\n+    const entry = this.iframes.get(key);\n+    if (!entry) return () => {};\n+\n+    entry.wrapper.style.background = options?.backgroundColor ?? \"transparent\";\n+\n+    const syncPosition = () => {\n+      const rect = targetElement.getBoundingClientRect();\n+      entry.wrapper.style.transform = `translate(${rect.left}px, ${rect.top}px)`;\n+      entry.wrapper.style.width = `${rect.width}px`;\n+      entry.wrapper.style.height = `${rect.height}px`;\n+    };\n+\n+    entry.wrapper.style.visibility = \"visible\";\n+    entry.wrapper.style.pointerEvents = \"auto\";\n+    entry.iframe.style.transform = \"none\";\n+    syncPosition();\n+\n+    const observer = new ResizeObserver(syncPosition);\n+    observer.observe(targetElement);\n+    window.addEventListener(\"resize\", syncPosition);\n+    window.addEventListener(\"scroll\", syncPosition, true);\n+\n+    return () => {\n+      entry.wrapper.style.visibility = \"hidden\";\n+      entry.wrapper.style.pointerEvents = \"none\";\n+      observer.disconnect();\n+      window.removeEventListener(\"resize\", syncPosition);\n+      window.removeEventListener(\"scroll\", syncPosition, true);\n+    };\n+  }\n+}\n+\n+const iframeManager = typeof window !== \"undefined\" ? new SimplePersistentIframeManager() : null;\n+\n+function StepBadge({ step, done }: { step: number; done: boolean }) {\n+  return (\n+    <span\n+      className={clsx(\n+        \"flex h-5 w-5 items-center justify-center rounded-full border text-[11px]\",\n+        done\n+          ? \"border-emerald-500 bg-emerald-50 text-emerald-700 dark:border-emerald-400/70 dark:bg-emerald-900/40 dark:text-emerald-100\"\n+          : \"border-neutral-300 text-neutral-600 dark:border-neutral-700 dark:text-neutral-400\"\n+      )}\n+    >\n+      {done ? <Check className=\"h-3 w-3\" /> : step}\n+    </span>\n+  );\n+}\n+\n+export function PreviewConfigureClient({\n+  initialTeamSlugOrId,\n+  teams,\n+  repo,\n+  installationId: _installationId,\n+  initialFrameworkPreset = \"other\",\n+  initialEnvVarsContent,\n+  initialMaintenanceScript,\n+  initialDevScript,\n+  startAtConfigureEnvironment = false,\n+}: PreviewConfigureClientProps) {\n+  const initialEnvVars = useMemo(() => {\n+    const parsed = initialEnvVarsContent\n+      ? parseEnvBlock(initialEnvVarsContent).map((entry) => ({\n+          name: entry.name,\n+          value: entry.value,\n+          isSecret: true,\n+        }))\n+      : undefined;\n+    return ensureInitialEnvVars(parsed);\n+  }, [initialEnvVarsContent]);\n+  const initialHasEnvValues = useMemo(\n+    () => initialEnvVars.some((r) => r.name.trim().length > 0 || r.value.trim().length > 0),\n+    [initialEnvVars]\n+  );\n+  const initialFrameworkConfig =\n+    FRAMEWORK_PRESETS[initialFrameworkPreset] ?? FRAMEWORK_PRESETS.other;\n+  const initialMaintenanceScriptValue =\n+    initialMaintenanceScript ?? initialFrameworkConfig.maintenanceScript;\n+  const initialDevScriptValue = initialDevScript ?? initialFrameworkConfig.devScript;\n+  const initialMaintenanceNone = initialMaintenanceScriptValue.trim().length === 0;\n+  const initialDevNone = initialDevScriptValue.trim().length === 0;\n+  const initialEnvComplete = initialHasEnvValues;\n+  const initialMaintenanceComplete = initialMaintenanceNone || initialMaintenanceScriptValue.trim().length > 0;\n+  const initialDevComplete = initialDevNone || initialDevScriptValue.trim().length > 0;\n+\n+  const [instance, setInstance] = useState<SandboxInstance | null>(null);\n+  const [isProvisioning, setIsProvisioning] = useState(false);\n+  const [errorMessage, setErrorMessage] = useState<string | null>(null);\n+\n+  const selectedTeamSlugOrId = useMemo(\n+    () => initialTeamSlugOrId || teams[0]?.slugOrId || \"\",\n+    [initialTeamSlugOrId, teams]\n+  );\n+\n+  const [currentStep, setCurrentStep] = useState<WizardStep>(1);\n+\n+  const [envVars, setEnvVars] = useState<EnvVar[]>(initialEnvVars);\n+  const [frameworkPreset, setFrameworkPreset] = useState<FrameworkPreset>(initialFrameworkPreset);\n+  const [maintenanceScript, setMaintenanceScript] = useState(initialMaintenanceScriptValue);\n+  const [devScript, setDevScript] = useState(initialDevScriptValue);\n+  const [hasUserEditedScripts, setHasUserEditedScripts] = useState(false);\n+  const [isFrameworkMenuOpen, setIsFrameworkMenuOpen] = useState(false);\n+  const [hasCompletedSetup, setHasCompletedSetup] = useState(false);\n+  const [isEnvOpen, setIsEnvOpen] = useState(false);\n+  const [isBuildOpen, setIsBuildOpen] = useState(false);\n+  const [envNone, setEnvNone] = useState(false);\n+  const [maintenanceNone, setMaintenanceNone] = useState(() => initialMaintenanceNone);\n+  const [devNone, setDevNone] = useState(() => initialDevNone);\n+  const [runConfirmed, setRunConfirmed] = useState(false);\n+  const [browserConfirmed, setBrowserConfirmed] = useState(false);\n+  const [commandsCopied, setCommandsCopied] = useState(false);\n+  const [isEnvSectionOpen, setIsEnvSectionOpen] = useState(() => !initialEnvComplete);\n+  const [isMaintenanceSectionOpen, setIsMaintenanceSectionOpen] = useState(\n+    () => !initialMaintenanceComplete\n+  );\n+  const [isDevSectionOpen, setIsDevSectionOpen] = useState(() => !initialDevComplete);\n+  const [isRunSectionOpen, setIsRunSectionOpen] = useState(true);\n+  const [isBrowserSetupSectionOpen, setIsBrowserSetupSectionOpen] = useState(true);\n+\n+  const [areEnvValuesHidden, setAreEnvValuesHidden] = useState(true);\n+  const [activeEnvValueIndex, setActiveEnvValueIndex] = useState<number | null>(null);\n+  const [pendingFocusIndex, setPendingFocusIndex] = useState<number | null>(null);\n+\n+  const [isSaving, setIsSaving] = useState(false);\n+\n+  useEffect(() => {\n+    if (initialHasEnvValues) {\n+      setIsEnvSectionOpen(false);\n+    }\n+  }, [initialHasEnvValues]);\n+\n+  useEffect(() => {\n+    const handleClickOutside = (event: MouseEvent) => {\n+      if (\n+        frameworkSelectRef.current &&\n+        !frameworkSelectRef.current.contains(event.target as Node)\n+      ) {\n+        setIsFrameworkMenuOpen(false);\n+      }\n+    };\n+    const handleEscape = (event: KeyboardEvent) => {\n+      if (event.key === \"Escape\") {\n+        setIsFrameworkMenuOpen(false);\n+      }\n+    };\n+\n+    document.addEventListener(\"mousedown\", handleClickOutside);\n+    document.addEventListener(\"keydown\", handleEscape);\n+    return () => {\n+      document.removeEventListener(\"mousedown\", handleClickOutside);\n+      document.removeEventListener(\"keydown\", handleEscape);\n+    };\n+  }, []);\n+\n+  const persistentIframeManager = iframeManager;\n+\n+  const keyInputRefs = useRef<Array<HTMLInputElement | null>>([]);\n+  const lastSubmittedEnvContent = useRef<string | null>(null);\n+  const frameworkSelectRef = useRef<HTMLDivElement | null>(null);\n+  const copyResetTimeoutRef = useRef<number | null>(null);\n+\n+  useEffect(() => {\n+    return () => {\n+      if (copyResetTimeoutRef.current !== null) {\n+        window.clearTimeout(copyResetTimeoutRef.current);\n+      }\n+    };\n+  }, []);\n+\n+  const vscodePersistKey = instance?.instanceId ? `preview-${instance.instanceId}:vscode` : \"vscode\";\n+  const browserPersistKey = instance?.instanceId ? `preview-${instance.instanceId}:browser` : \"browser\";\n+\n+  const selectedTeam = useMemo(\n+    () => teams.find((team) => team.slugOrId === selectedTeamSlugOrId) ?? teams[0] ?? null,\n+    [selectedTeamSlugOrId, teams]\n+  );\n+\n+  const resolvedTeamSlugOrId =\n+    selectedTeam?.slugOrId ?? initialTeamSlugOrId ?? teams[0]?.slugOrId ?? \"\";\n+  const selectedTeamSlugOrIdRef = useRef(resolvedTeamSlugOrId);\n+  const frameworkOptions = useMemo(\n+    () => Object.entries(FRAMEWORK_PRESETS) as Array<[FrameworkPreset, FrameworkPresetConfig]>,\n+    []\n+  );\n+  const selectedFrameworkConfig = FRAMEWORK_PRESETS[frameworkPreset];\n+\n+  useEffect(() => {\n+    selectedTeamSlugOrIdRef.current = resolvedTeamSlugOrId;\n+  }, [resolvedTeamSlugOrId]);\n+\n+  const resolvedVncUrl = useMemo(() => {\n+    if (instance?.vncUrl) {\n+      return normalizeVncUrl(instance.vncUrl) ?? instance.vncUrl;\n+    }\n+    return deriveVncUrl(instance?.instanceId, instance?.vscodeUrl);\n+  }, [instance?.instanceId, instance?.vncUrl, instance?.vscodeUrl]);\n+\n+  const workspacePlaceholder = useMemo(\n+    () =>\n+      instance?.vscodeUrl\n+        ? null\n+        : {\n+            title: instance?.instanceId\n+              ? \"Waiting for VS Code\"\n+              : \"VS Code workspace not ready\",\n+            description: instance?.instanceId\n+              ? \"The editor opens automatically once the environment finishes booting.\"\n+              : \"Provisioning the workspace. We'll open VS Code as soon as it's ready.\",\n+          },\n+    [instance?.instanceId, instance?.vscodeUrl]\n+  );\n+\n+  const hasEnvValues = useMemo(\n+    () => envVars.some((r) => r.name.trim().length > 0 || r.value.trim().length > 0),\n+    [envVars]\n+  );\n+  const maintenanceScriptValue = maintenanceScript.trim();\n+  const devScriptValue = devScript.trim();\n+  const envDone = envNone || hasEnvValues;\n+  const maintenanceDone = maintenanceNone || maintenanceScriptValue.length > 0;\n+  const devDone = devNone || devScriptValue.length > 0;\n+\n+  // Auto-enter configuration once VS Code is available when resuming an existing environment\n+  useEffect(() => {\n+    if (startAtConfigureEnvironment && instance?.vscodeUrl && !hasCompletedSetup) {\n+      setHasCompletedSetup(true);\n+    }\n+  }, [hasCompletedSetup, instance?.vscodeUrl, startAtConfigureEnvironment]);\n+\n+  const handleEnterConfigureEnvironment = useCallback(() => {\n+    setHasCompletedSetup(true);\n+  }, []);\n+\n+  const browserPlaceholder = useMemo(\n+    () =>\n+      resolvedVncUrl\n+        ? null\n+        : {\n+            title: instance?.instanceId\n+              ? \"Waiting for browser\"\n+              : \"Browser preview unavailable\",\n+            description: instance?.instanceId\n+              ? \"We'll embed the browser session as soon as the environment exposes it.\"\n+              : \"Launch the workspace so the browser agent can stream the preview here.\",\n+          },\n+    [instance?.instanceId, resolvedVncUrl]\n+  );\n+\n+  const provisionVM = useCallback(async () => {\n+    if (!resolvedTeamSlugOrId) {\n+      setErrorMessage(\"Select a team to start provisioning.\");\n+      return;\n+    }\n+\n+    setIsProvisioning(true);\n+    setErrorMessage(null);\n+\n+    try {\n+      const response = await fetch(\"/api/sandboxes/start\", {\n+        method: \"POST\",\n+        headers: { \"Content-Type\": \"application/json\" },\n+        body: JSON.stringify({\n+          teamSlugOrId: resolvedTeamSlugOrId,\n+          repoUrl: `https://github.com/${repo}`,\n+          branch: \"main\",\n+          ttlSeconds: 3600,\n+        }),\n+      });\n+\n+      if (!response.ok) {\n+        throw new Error(await response.text());\n+      }\n+\n+      const data = (await response.json()) as SandboxInstance;\n+      const normalizedFromResponse =\n+        data.vncUrl && data.vncUrl.trim().length > 0\n+          ? normalizeVncUrl(data.vncUrl) ?? data.vncUrl\n+          : null;\n+      const derived = normalizedFromResponse ?? deriveVncUrl(data.instanceId, data.vscodeUrl);\n+\n+      if (selectedTeamSlugOrIdRef.current !== resolvedTeamSlugOrId) {\n+        return;\n+      }\n+\n+      setInstance({\n+        ...data,\n+        vncUrl: derived ?? undefined,\n+      });\n+    } catch (error) {\n+      const message = error instanceof Error ? error.message : \"Failed to provision workspace\";\n+      if (selectedTeamSlugOrIdRef.current === resolvedTeamSlugOrId) {\n+        setErrorMessage(message);\n+      }\n+      console.error(\"Failed to provision workspace:\", error);\n+    } finally {\n+      setIsProvisioning(false);\n+    }\n+  }, [repo, resolvedTeamSlugOrId]);\n+\n+  useEffect(() => {\n+    if (!resolvedTeamSlugOrId) {\n+      return;\n+    }\n+    if (!instance && !isProvisioning && !errorMessage) {\n+      void provisionVM();\n+    }\n+  }, [instance, isProvisioning, errorMessage, provisionVM, resolvedTeamSlugOrId]);\n+\n+  useEffect(() => {\n+    if (pendingFocusIndex !== null) {\n+      const el = keyInputRefs.current[pendingFocusIndex];\n+      if (el) {\n+        setTimeout(() => {\n+          el.focus();\n+          try {\n+            el.scrollIntoView({ block: \"nearest\" });\n+          } catch (_e) {\n+            void 0;\n+          }\n+        }, 0);\n+        setPendingFocusIndex(null);\n+      }\n+    }\n+  }, [pendingFocusIndex, envVars]);\n+\n+  // Auto-apply env vars to sandbox\n+  useEffect(() => {\n+    if (!instance?.instanceId || !resolvedTeamSlugOrId) {\n+      return;\n+    }\n+\n+    const envVarsContent = formatEnvVarsContent(\n+      envVars\n+        .filter((r) => r.name.trim().length > 0)\n+        .map((r) => ({ name: r.name, value: r.value }))\n+    );\n+\n+    if (envVarsContent.length === 0 && lastSubmittedEnvContent.current === null) {\n+      return;\n+    }\n+\n+    if (envVarsContent === lastSubmittedEnvContent.current) {\n+      return;\n+    }\n+\n+    const timeoutId = window.setTimeout(async () => {\n+      try {\n+        await fetch(`/api/sandboxes/${instance.instanceId}/env`, {\n+          method: \"POST\",\n+          headers: { \"Content-Type\": \"application/json\" },\n+          body: JSON.stringify({ teamSlugOrId: resolvedTeamSlugOrId, envVarsContent }),\n+        });\n+        lastSubmittedEnvContent.current = envVarsContent;\n+      } catch (error) {\n+        console.error(\"Failed to apply sandbox environment vars\", error);\n+      }\n+    }, 400);\n+\n+    return () => {\n+      window.clearTimeout(timeoutId);\n+    };\n+  }, [envVars, instance?.instanceId, resolvedTeamSlugOrId]);\n+\n+  const updateEnvVars = useCallback((updater: (prev: EnvVar[]) => EnvVar[]) => {\n+    setEnvVars((prev) => updater(prev));\n+  }, []);\n+\n+  const handleFrameworkPresetChange = useCallback((preset: FrameworkPreset) => {\n+    setFrameworkPreset(preset);\n+    setIsFrameworkMenuOpen(false);\n+    // Only auto-fill if user hasn't manually edited the scripts\n+    if (!hasUserEditedScripts) {\n+      const presetConfig = FRAMEWORK_PRESETS[preset];\n+      setMaintenanceScript(presetConfig.maintenanceScript);\n+      setDevScript(presetConfig.devScript);\n+      // Update none states based on whether the preset has scripts\n+      setMaintenanceNone(presetConfig.maintenanceScript.trim().length === 0);\n+      setDevNone(presetConfig.devScript.trim().length === 0);\n+    }\n+  }, [hasUserEditedScripts]);\n+\n+  const handleMaintenanceScriptChange = useCallback((value: string) => {\n+    setMaintenanceNone(false);\n+    setMaintenanceScript(value);\n+    setHasUserEditedScripts(true);\n+  }, []);\n+\n+  const handleDevScriptChange = useCallback((value: string) => {\n+    setDevNone(false);\n+    setDevScript(value);\n+    setHasUserEditedScripts(true);\n+  }, []);\n+\n+  const handleToggleEnvNone = useCallback(\n+    (value: boolean) => {\n+      setEnvNone(value);\n+      setActiveEnvValueIndex(null);\n+      if (value) {\n+        setAreEnvValuesHidden(true);\n+        setEnvVars([{ name: \"\", value: \"\", isSecret: true }]);\n+        setIsEnvOpen(false);\n+      } else {\n+        setIsEnvOpen(true);\n+      }\n+    },\n+    []\n+  );\n+\n+  const handleToggleMaintenanceNone = useCallback((value: boolean) => {\n+    setMaintenanceNone(value);\n+    setHasUserEditedScripts(true);\n+    if (value) {\n+      setMaintenanceScript(\"\");\n+    }\n+  }, []);\n+\n+  const handleToggleDevNone = useCallback((value: boolean) => {\n+    setDevNone(value);\n+    setHasUserEditedScripts(true);\n+    if (value) {\n+      setDevScript(\"\");\n+    }\n+  }, []);\n+\n+  const handleCopyCommands = useCallback(async () => {\n+    const combined = [maintenanceScript.trim(), devScript.trim()].filter(Boolean).join(\" && \");\n+    if (!combined) {\n+      return;\n+    }\n+\n+    try {\n+      await navigator.clipboard.writeText(combined);\n+      setCommandsCopied(true);\n+      if (copyResetTimeoutRef.current !== null) {\n+        window.clearTimeout(copyResetTimeoutRef.current);\n+      }\n+      copyResetTimeoutRef.current = window.setTimeout(() => {\n+        setCommandsCopied(false);\n+      }, 2000);\n+    } catch (error) {\n+      console.error(\"Failed to copy commands:\", error);\n+    }\n+  }, [devScript, maintenanceScript]);\n+\n+  useEffect(() => {\n+    setRunConfirmed(false);\n+  }, [maintenanceScriptValue, devScriptValue, maintenanceNone, devNone]);\n+\n+  const handleSaveConfiguration = async () => {\n+    if (!resolvedTeamSlugOrId) {\n+      setErrorMessage(\"Select a team before saving.\");\n+      return;\n+    }\n+\n+    if (!instance?.instanceId) {\n+      console.error(\"Missing instanceId for configuration save\");\n+      return;\n+    }\n+\n+    const now = new Date();\n+    const dateTime = now.toISOString().replace(/[:.]/g, \"-\").slice(0, -5);\n+    const repoName = repo.split(\"/\").pop() || \"preview\";\n+    const envName = `${repoName}-${dateTime}`;\n+\n+    const envVarsContent = formatEnvVarsContent(\n+      envVars\n+        .filter((r) => r.name.trim().length > 0)\n+        .map((r) => ({ name: r.name, value: r.value }))\n+    );\n+\n+    const normalizedMaintenanceScript = maintenanceScript.trim();\n+    const normalizedDevScript = devScript.trim();\n+    const requestMaintenanceScript =\n+      normalizedMaintenanceScript.length > 0 ? normalizedMaintenanceScript : undefined;\n+    const requestDevScript =\n+      normalizedDevScript.length > 0 ? normalizedDevScript : undefined;\n+\n+    setIsSaving(true);\n+    setErrorMessage(null);\n+\n+    try {\n+      const envResponse = await fetch(\"/api/environments\", {\n+        method: \"POST\",\n+        headers: { \"Content-Type\": \"application/json\" },\n+        body: JSON.stringify({\n+          teamSlugOrId: resolvedTeamSlugOrId,\n+          name: envName,\n+          morphInstanceId: instance.instanceId,\n+          envVarsContent,\n+          selectedRepos: [repo],\n+          maintenanceScript: requestMaintenanceScript,\n+          devScript: requestDevScript,\n+          exposedPorts: undefined,\n+          description: undefined,\n+        }),\n+      });\n+\n+      if (!envResponse.ok) {\n+        throw new Error(await envResponse.text());\n+      }\n+\n+      const envData = await envResponse.json();\n+      const environmentId = envData.id;\n+\n+      const previewResponse = await fetch(\"/api/preview/configs\", {\n+        method: \"POST\",\n+        headers: { \"Content-Type\": \"application/json\" },\n+        body: JSON.stringify({\n+          teamSlugOrId: resolvedTeamSlugOrId,\n+          repoFullName: repo,\n+          environmentId,\n+          repoInstallationId: _installationId ? Number(_installationId) : undefined,\n+          repoDefaultBranch: \"main\",\n+          status: \"active\",\n+        }),\n+      });\n+\n+      if (!previewResponse.ok) {\n+        throw new Error(await previewResponse.text());\n+      }\n+\n+      window.location.href = \"/preview\";\n+    } catch (error) {\n+      const message = error instanceof Error ? error.message : \"Failed to save configuration\";\n+      setErrorMessage(message);\n+      console.error(\"Failed to save preview configuration:\", error);\n+    } finally {\n+      setIsSaving(false);\n+    }\n+  };\n+\n+  const handleNextStep = () => {\n+    if (currentStep === 1) {\n+      setIsEnvOpen(false);\n+      setIsBuildOpen(false);\n+    }\n+    if (currentStep < 2) {\n+      setCurrentStep((currentStep + 1) as WizardStep);\n+    }\n+  };\n+\n+  const handlePrevStep = () => {\n+    if (currentStep > 1) {\n+      setCurrentStep((currentStep - 1) as WizardStep);\n+    }\n+  };\n+\n+  // Pre-create iframes during setup so they're ready when user clicks Next\n+  useEffect(() => {\n+    if (!instance || !persistentIframeManager) return;\n+\n+    // Pre-create VS Code iframe during setup\n+    if (instance.vscodeUrl) {\n+      const vscodeUrl = new URL(instance.vscodeUrl);\n+      vscodeUrl.searchParams.set(\"folder\", \"/root/workspace\");\n+      persistentIframeManager.getOrCreateIframe(vscodePersistKey, vscodeUrl.toString());\n+    }\n+\n+    // Pre-create browser iframe if available\n+    if (resolvedVncUrl) {\n+      persistentIframeManager.getOrCreateIframe(browserPersistKey, resolvedVncUrl);\n+    }\n+  }, [instance, persistentIframeManager, resolvedVncUrl, vscodePersistKey, browserPersistKey]);\n+\n+  // Mount iframes to their targets when visible\n+  useLayoutEffect(() => {\n+    if (!instance || !persistentIframeManager || !hasCompletedSetup) return;\n+\n+    const cleanupFunctions: Array<() => void> = [];\n+\n+    if (instance.vscodeUrl && currentStep === 1) {\n+      const target = document.querySelector(\n+        `[data-iframe-target=\"${vscodePersistKey}\"]`,\n+      ) as HTMLElement | null;\n+      if (target) {\n+        cleanupFunctions.push(persistentIframeManager.mountIframe(vscodePersistKey, target));\n+      }\n+    }\n+\n+    if (resolvedVncUrl && currentStep === 2) {\n+      const target = document.querySelector(\n+        `[data-iframe-target=\"${browserPersistKey}\"]`,\n+      ) as HTMLElement | null;\n+      if (target) {\n+        cleanupFunctions.push(\n+          persistentIframeManager.mountIframe(browserPersistKey, target, {\n+            backgroundColor: \"#000000\",\n+          }),\n+        );\n+      }\n+    }\n+\n+    return () => {\n+      cleanupFunctions.forEach((fn) => fn());\n+    };\n+  }, [\n+    browserPersistKey,\n+    instance,\n+    persistentIframeManager,\n+    currentStep,\n+    hasCompletedSetup,\n+    resolvedVncUrl,\n+    vscodePersistKey,\n+  ]);\n+\n+  // Control iframe visibility based on current step and setup state\n+  useEffect(() => {\n+    if (!persistentIframeManager) {\n+      return;\n+    }\n+\n+    // Hide iframes during setup screen, show based on step after setup\n+    const workspaceVisible = hasCompletedSetup && currentStep === 1 && Boolean(instance?.vscodeUrl);\n+    const browserVisible = hasCompletedSetup && currentStep === 2 && Boolean(resolvedVncUrl);\n+\n+    persistentIframeManager.setVisibility(vscodePersistKey, workspaceVisible);\n+    persistentIframeManager.setVisibility(browserPersistKey, browserVisible);\n+  }, [\n+    browserPersistKey,\n+    currentStep,\n+    hasCompletedSetup,\n+    persistentIframeManager,\n+    resolvedVncUrl,\n+    instance?.vscodeUrl,\n+    vscodePersistKey,\n+  ]);\n+\n+  if (errorMessage && !instance) {\n+    return (\n+      <div className=\"flex min-h-dvh items-center justify-center bg-[#05050a] text-white\">\n+        <div className=\"text-center max-w-md px-6\">\n+          <h1 className=\"text-2xl font-bold text-red-400\">Error</h1>\n+          <p className=\"mt-2 text-neutral-400\">{errorMessage}</p>\n+          <button\n+            type=\"button\"\n+            onClick={() => {\n+              setErrorMessage(null);\n+              void provisionVM();\n+            }}\n+            className=\"mt-4 rounded-lg bg-white px-4 py-2 text-sm font-semibold text-black transition hover:bg-neutral-200\"\n+          >\n+            Retry\n+          </button>\n+        </div>\n+      </div>\n+    );\n+  }\n+\n+  // Show setup screen while provisioning OR until user clicks Next\n+  if (!hasCompletedSetup) {\n+    const isWorkspaceReady = Boolean(instance?.vscodeUrl);\n+\n+    // When editing an existing environment, show loader until VS Code is ready\n+    if (startAtConfigureEnvironment && !isWorkspaceReady) {\n+      return (\n+        <div className=\"flex min-h-dvh items-center justify-center bg-white dark:bg-black font-mono\">\n+          <div className=\"text-center px-6\">\n+            <Loader2 className=\"mx-auto h-8 w-8 animate-spin text-neutral-400\" />\n+            <h1 className=\"mt-4 text-lg font-medium text-neutral-900 dark:text-neutral-100\">\n+              Resuming your VS Code workspace...\n+            </h1>\n+            <p className=\"mt-2 text-sm text-neutral-500 dark:text-neutral-400\">\n+              We&apos;ll show the configuration form once your environment is ready.\n+            </p>\n+          </div>\n+        </div>\n+      );\n+    }\n+\n+    return (\n+      <div className=\"min-h-dvh bg-white dark:bg-black font-mono\">\n+        {/* Main Content */}\n+        <div className=\"max-w-2xl mx-auto px-6 py-10\">\n+          <div className=\"mb-3\">\n+            <Link\n+              href=\"/preview\"\n+              className=\"inline-flex items-center gap-1.5 text-xs text-neutral-500 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-neutral-100\"\n+            >\n+              <ArrowLeft className=\"h-3 w-3\" />\n+              Go to preview.new\n+            </Link>\n+          </div>\n+\n+          {/* Importing Header */}\n+          <div className=\"mb-8\">\n+            <h1 className=\"text-2xl font-semibold text-neutral-900 dark:text-neutral-100 mb-1\">\n+              Configure Project\n+            </h1>\n+            <div className=\"flex items-center gap-2 text-sm text-neutral-600 dark:text-neutral-400\">\n+              <Github className=\"h-4 w-4\" />\n+              <span className=\"font-mono\">{repo}</span>\n+            </div>\n+          </div>\n+\n+          <div className=\"space-y-6\">\n+            {/* Framework Preset */}\n+            <div>\n+              <label className=\"block text-sm font-medium text-neutral-900 dark:text-neutral-100 mb-2\">\n+                Framework Preset\n+              </label>\n+              <div className=\"relative\" ref={frameworkSelectRef}>\n+                <button\n+                  type=\"button\"\n+                  aria-haspopup=\"listbox\"\n+                  aria-expanded={isFrameworkMenuOpen}\n+                  onClick={() => setIsFrameworkMenuOpen((prev) => !prev)}\n+                  className=\"flex w-full items-center justify-between rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-3 py-2.5 text-sm text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700\"\n+                >\n+                  <span className=\"flex items-center gap-3\">\n+                    <FrameworkIconBubble preset={frameworkPreset} />\n+                    <span className=\"text-left\">\n+                      <span className=\"block font-medium\">{selectedFrameworkConfig.name}</span>\n+                      <span className=\"block text-xs text-neutral-500 dark:text-neutral-400\">\n+                        Autofills install and dev scripts\n+                      </span>\n+                    </span>\n+                  </span>\n+                  <ChevronDown\n+                    className={clsx(\n+                      \"h-4 w-4 text-neutral-400 transition-transform\",\n+                      isFrameworkMenuOpen && \"rotate-180\"\n+                    )}\n+                  />\n+                </button>\n+                {isFrameworkMenuOpen ? (\n+                  <div className=\"absolute z-20 mt-2 w-full rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 shadow-lg\">\n+                    <ul className=\"max-h-64 overflow-y-auto py-1\" role=\"listbox\">\n+                      {frameworkOptions.map(([key, config]) => (\n+                        <li key={key}>\n+                          <button\n+                            type=\"button\"\n+                            role=\"option\"\n+                            aria-selected={frameworkPreset === key}\n+                            onClick={() => handleFrameworkPresetChange(key as FrameworkPreset)}\n+                            className={clsx(\n+                              \"flex w-full items-center gap-3 px-3 py-2 text-left text-sm transition\",\n+                              frameworkPreset === key\n+                                ? \"bg-neutral-100 dark:bg-neutral-900\"\n+                                : \"hover:bg-neutral-50 dark:hover:bg-neutral-900/80\"\n+                            )}\n+                          >\n+                            <FrameworkIconBubble preset={key as FrameworkPreset} />\n+                            <div className=\"flex-1\">\n+                              <div className=\"font-medium text-neutral-900 dark:text-neutral-100\">\n+                                {config.name}\n+                              </div>\n+                              <div className=\"text-xs text-neutral-500 dark:text-neutral-400\">\n+                                Default: {config.devScript || \"Custom\"}\n+                              </div>\n+                            </div>\n+                          </button>\n+                        </li>\n+                      ))}\n+                    </ul>\n+                  </div>\n+                ) : null}\n+              </div>\n+              <p className=\"mt-2 text-xs text-neutral-500 dark:text-neutral-400\">\n+                Workspace root <code className=\"rounded bg-neutral-100 px-1 py-0.5 text-neutral-700 dark:bg-neutral-900 dark:text-neutral-200\">/root/workspace</code> maps directly to your repository root.\n+              </p>\n+            </div>\n+\n+            {/* Maintenance and Dev Scripts - Collapsible */}\n+            <details className=\"group\" open={isBuildOpen} onToggle={(e) => setIsBuildOpen(e.currentTarget.open)}>\n+              <summary className=\"flex items-center gap-2 cursor-pointer text-base font-semibold text-neutral-900 dark:text-neutral-100 list-none\">\n+                <ChevronDown className=\"h-4 w-4 text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\" />\n+                Maintenance and Dev Scripts\n+              </summary>\n+              <div className=\"mt-4 pl-6 space-y-4\">\n+                <div>\n+                  <label className=\"block text-xs text-neutral-500 dark:text-neutral-400 mb-1.5\">\n+                    Maintenance Script\n+                  </label>\n+                  <textarea\n+                    value={maintenanceScript ?? \"\"}\n+                    onChange={(e) => handleMaintenanceScriptChange(e.target.value)}\n+                    placeholder={\"npm install, bun install, pip install -r requirements.txt\"}\n+                    rows={2}\n+                    className=\"w-full rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-3 py-2 text-sm font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 resize-none\"\n+                  />\n+                  <p className=\"text-xs text-neutral-400 mt-1\">Runs after git pull to install dependencies (e.g. npm install, bun install, pip install -r requirements.txt)</p>\n+                </div>\n+                <div>\n+                  <label className=\"block text-xs text-neutral-500 dark:text-neutral-400 mb-1.5\">\n+                    Dev Script\n+                  </label>\n+                  <textarea\n+                    value={devScript ?? \"\"}\n+                    onChange={(e) => handleDevScriptChange(e.target.value)}\n+                    placeholder={\"npm run dev, bun dev, python manage.py runserver\"}\n+                    rows={2}\n+                    className=\"w-full rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-3 py-2 text-sm font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 resize-none\"\n+                  />\n+                  <p className=\"text-xs text-neutral-400 mt-1\">Starts the development server (e.g. npm run dev, bun dev, python manage.py runserver)</p>\n+                </div>\n+            </div>\n+          </details>\n+\n+            {/* Environment Variables - Collapsible */}\n+            <details className=\"group\" open={isEnvOpen} onToggle={(e) => setIsEnvOpen(e.currentTarget.open)}>\n+              <summary className=\"flex items-center gap-2 cursor-pointer text-base font-semibold text-neutral-900 dark:text-neutral-100 list-none\">\n+                <ChevronDown className=\"h-4 w-4 text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\" />\n+                <span>Environment Variables</span>\n+                <div className=\"ml-auto flex items-center gap-2\">\n+                  <button\n+                    type=\"button\"\n+                    onClick={(e) => {\n+                      e.preventDefault();\n+                      setActiveEnvValueIndex(null);\n+                      setAreEnvValuesHidden((previous) => !previous);\n+                    }}\n+                    className=\"text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-300 transition p-0.5\"\n+                    aria-label={areEnvValuesHidden ? \"Reveal values\" : \"Hide values\"}\n+                  >\n+                    {areEnvValuesHidden ? (\n+                      <EyeOff className=\"h-4 w-4\" />\n+                    ) : (\n+                      <Eye className=\"h-4 w-4\" />\n+                    )}\n+                  </button>\n+                </div>\n+              </summary>\n+\n+              <div\n+                className=\"mt-4 space-y-2 pl-6\"\n+                onPasteCapture={(e) => {\n+                  const text = e.clipboardData?.getData(\"text\") ?? \"\";\n+                  if (text && (/\\n/.test(text) || /(=|:)\\s*\\S/.test(text))) {\n+                    e.preventDefault();\n+                    const items = parseEnvBlock(text);\n+                    if (items.length > 0) {\n+                      setEnvNone(false);\n+                      updateEnvVars((prev) => {\n+                        const map = new Map(\n+                          prev\n+                            .filter((r) => r.name.trim().length > 0 || r.value.trim().length > 0)\n+                            .map((r) => [r.name, r] as const)\n+                        );\n+                        for (const it of items) {\n+                          if (!it.name) continue;\n+                          const existing = map.get(it.name);\n+                          if (existing) {\n+                            map.set(it.name, { ...existing, value: it.value });\n+                          } else {\n+                            map.set(it.name, { name: it.name, value: it.value, isSecret: true });\n+                          }\n+                        }\n+                        const next = Array.from(map.values());\n+                        next.push({ name: \"\", value: \"\", isSecret: true });\n+                        setPendingFocusIndex(next.length - 1);\n+                        return next;\n+                      });\n+                    }\n+                  }\n+                }}\n+              >\n+                <div\n+                  className=\"grid gap-2 text-xs text-neutral-500 dark:text-neutral-500 items-center pr-10\"\n+                  style={{ gridTemplateColumns: \"minmax(0, 1fr) minmax(0, 1.5fr) 40px\" }}\n+                >\n+                  <span>Name</span>\n+                  <span>Value</span>\n+                  <span />\n+                </div>\n+\n+                {envVars.map((row, idx) => {\n+                  const rowKey = idx;\n+                  const isEditingValue = activeEnvValueIndex === idx;\n+                  const shouldMaskValue = areEnvValuesHidden && row.value.trim().length > 0 && !isEditingValue;\n+                  return (\n+                    <div\n+                      key={rowKey}\n+                      className=\"grid gap-2 items-center pr-10\"\n+                    style={{ gridTemplateColumns: \"minmax(0, 1fr) minmax(0, 1.5fr) 40px\" }}\n+                  >\n+                    <input\n+                      type=\"text\"\n+                      value={row.name}\n+                      disabled={envNone}\n+                      ref={(el) => {\n+                        keyInputRefs.current[idx] = el;\n+                      }}\n+                      onChange={(e) => {\n+                        const v = e.target.value;\n+                          setEnvNone(false);\n+                          updateEnvVars((prev) => {\n+                            const next = [...prev];\n+                            const current = next[idx];\n+                            if (current) {\n+                              next[idx] = { ...current, name: v };\n+                            }\n+                          return next;\n+                        });\n+                      }}\n+                      placeholder=\"EXAMPLE_NAME\"\n+                      className=\"w-full min-w-0 rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-3 py-2 text-sm font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 disabled:opacity-60 disabled:cursor-not-allowed\"\n+                    />\n+                    <input\n+                      type={shouldMaskValue ? \"password\" : \"text\"}\n+                      value={shouldMaskValue ? MASKED_ENV_VALUE : row.value}\n+                      disabled={envNone}\n+                      onChange={\n+                        shouldMaskValue\n+                          ? undefined\n+                          : (e) => {\n+                              const v = e.target.value;\n+                                setEnvNone(false);\n+                                updateEnvVars((prev) => {\n+                                  const next = [...prev];\n+                                  const current = next[idx];\n+                                  if (current) {\n+                                    next[idx] = { ...current, value: v };\n+                                  }\n+                                  return next;\n+                                });\n+                              }\n+                      }\n+                      onFocus={() => setActiveEnvValueIndex(idx)}\n+                      onBlur={() => setActiveEnvValueIndex((current) => (current === idx ? null : current))}\n+                      readOnly={shouldMaskValue}\n+                      placeholder=\"I9JU23NF394R6HH\"\n+                      className=\"w-full min-w-0 rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-3 py-2 text-sm font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 disabled:opacity-60 disabled:cursor-not-allowed\"\n+                    />\n+                    <button\n+                      type=\"button\"\n+                      disabled={envNone}\n+                      onClick={() => {\n+                        updateEnvVars((prev) => {\n+                          const next = prev.filter((_, i) => i !== idx);\n+                          return next.length > 0 ? next : [{ name: \"\", value: \"\", isSecret: true }];\n+                        });\n+                      }}\n+                      className=\"h-9 w-9 rounded-md border border-neutral-200 dark:border-neutral-800 text-neutral-500 dark:text-neutral-400 grid place-items-center hover:bg-neutral-50 dark:hover:bg-neutral-900 disabled:opacity-60 disabled:cursor-not-allowed\"\n+                      aria-label=\"Remove variable\"\n+                    >\n+                      <Minus className=\"w-4 h-4\" />\n+                    </button>\n+                  </div>\n+                );\n+              })}\n+\n+                <div className=\"pt-2\">\n+                  <button\n+                    type=\"button\"\n+                    onClick={() =>\n+                      updateEnvVars((prev) => [...prev, { name: \"\", value: \"\", isSecret: true }])\n+                    }\n+                    disabled={envNone}\n+                    className=\"inline-flex items-center gap-2 rounded-md border border-neutral-200 dark:border-neutral-800 px-3 py-2 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-neutral-50 dark:hover:bg-neutral-900 transition disabled:opacity-60 disabled:cursor-not-allowed\"\n+                  >\n+                    <Plus className=\"w-4 h-4\" /> Add Variable\n+                  </button>\n+                </div>\n+              </div>\n+\n+              <p className=\"text-xs text-neutral-400 dark:text-neutral-400 pl-6 mt-2\">\n+                Tip: Paste a .env file to auto-fill\n+              </p>\n+            </details>\n+          </div>\n+\n+          {/* Next Button */}\n+          <div className=\"mt-10 pt-6 border-t border-neutral-200 dark:border-neutral-800\">\n+            <div className=\"flex items-center justify-between gap-4\">\n+              <div className=\"flex items-center gap-2 text-xs text-neutral-600 dark:text-neutral-400\">\n+                {isProvisioning ? (\n+                  <>\n+                    <Loader2 className=\"h-3 w-3 animate-spin\" />\n+                    <span>Provisioning workspace...</span>\n+                  </>\n+                ) : isWorkspaceReady ? (\n+                  <>\n+                    <span className=\"inline-block h-2 w-2 rounded-full bg-green-500\" />\n+                    <span>Workspace ready</span>\n+                  </>\n+                ) : (\n+                  <>\n+                    <span className=\"inline-block h-2 w-2 rounded-full bg-neutral-400 dark:bg-neutral-600\" />\n+                    <span>Waiting for workspace...</span>\n+                  </>\n+                )}\n+              </div>\n+              <button\n+                type=\"button\"\n+                disabled={!isWorkspaceReady}\n+                onClick={handleEnterConfigureEnvironment}\n+                className={clsx(\n+                  \"inline-flex items-center gap-2 rounded-md px-5 py-2.5 text-sm font-semibold transition\",\n+                  isWorkspaceReady\n+                    ? \"bg-neutral-900 dark:bg-neutral-100 text-white dark:text-neutral-900 hover:bg-neutral-800 dark:hover:bg-neutral-200\"\n+                    : \"bg-neutral-900 dark:bg-neutral-100 text-white dark:text-neutral-900 opacity-50 cursor-not-allowed\"\n+                )}\n+              >\n+                Next\n+                <ArrowRight className=\"w-4 h-4\" />\n+              </button>\n+            </div>\n+          </div>\n+        </div>\n+      </div>\n+    );\n+  }\n+\n+  const renderStep1Content = () => (\n+    <div className=\"space-y-5\">\n+      {/* Workspace Info */}\n+      <p className=\"text-[11px] text-neutral-500 dark:text-neutral-400 leading-relaxed\">\n+        Your workspace root at <code className=\"px-1 py-0.5 rounded bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-700 dark:text-neutral-300\">/root/workspace</code> maps directly to your repo root.\n+      </p>\n+\n+      {/* Maintenance Script */}\n+      <details className=\"group\" open={isMaintenanceSectionOpen} onToggle={(e) => setIsMaintenanceSectionOpen(e.currentTarget.open)}>\n+        <summary className=\"flex items-center gap-2 cursor-pointer list-none\">\n+          <ChevronDown className=\"h-3.5 w-3.5 text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\" />\n+          <StepBadge step={1} done={maintenanceDone} />\n+          <span className=\"text-[13px] font-medium text-neutral-900 dark:text-neutral-100\">Maintenance script</span>\n+        </summary>\n+        <div className=\"mt-3 ml-6 space-y-2\">\n+          <p className=\"text-[11px] text-neutral-500 dark:text-neutral-400\">\n+            Runs after git pull to install dependencies.\n+          </p>\n+          <textarea\n+            value={maintenanceScript ?? \"\"}\n+            onChange={(e) => handleMaintenanceScriptChange(e.target.value)}\n+            placeholder={\"npm install, bun install, pip install -r requirements.txt\"}\n+            disabled={maintenanceNone}\n+            rows={2}\n+            className=\"w-full min-w-0 rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-2.5 py-1.5 text-[12px] font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 disabled:opacity-60 disabled:cursor-not-allowed resize-none\"\n+          />\n+          <div className=\"flex items-center justify-end\">\n+            <label className=\"flex items-center gap-1.5 text-[10px] text-neutral-400 cursor-pointer hover:text-neutral-600 dark:hover:text-neutral-300\">\n+              <input type=\"checkbox\" checked={maintenanceNone} onChange={(e) => handleToggleMaintenanceNone(e.target.checked)} className=\"h-3.5 w-3.5 rounded border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-950 text-emerald-500 focus:ring-2 focus:ring-emerald-500/40\" />\n+              None\n+            </label>\n+          </div>\n+        </div>\n+      </details>\n+\n+      {/* Dev Script */}\n+      <details className=\"group\" open={isDevSectionOpen} onToggle={(e) => setIsDevSectionOpen(e.currentTarget.open)}>\n+        <summary className=\"flex items-center gap-2 cursor-pointer list-none\">\n+          <ChevronDown className=\"h-3.5 w-3.5 text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\" />\n+          <StepBadge step={2} done={devDone} />\n+          <span className=\"text-[13px] font-medium text-neutral-900 dark:text-neutral-100\">Dev script</span>\n+        </summary>\n+        <div className=\"mt-3 ml-6 space-y-2\">\n+          <p className=\"text-[11px] text-neutral-500 dark:text-neutral-400\">\n+            Starts the development server.\n+          </p>\n+          <textarea\n+            value={devScript ?? \"\"}\n+            onChange={(e) => handleDevScriptChange(e.target.value)}\n+            placeholder={\"npm run dev, bun dev, python manage.py runserver\"}\n+            disabled={devNone}\n+            rows={2}\n+            className=\"w-full min-w-0 rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-2.5 py-1.5 text-[12px] font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 disabled:opacity-60 disabled:cursor-not-allowed resize-none\"\n+          />\n+          <div className=\"flex items-center justify-end\">\n+            <label className=\"flex items-center gap-1.5 text-[10px] text-neutral-400 cursor-pointer hover:text-neutral-600 dark:hover:text-neutral-300\">\n+              <input type=\"checkbox\" checked={devNone} onChange={(e) => handleToggleDevNone(e.target.checked)} className=\"h-3.5 w-3.5 rounded border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-950 text-emerald-500 focus:ring-2 focus:ring-emerald-500/40\" />\n+              None\n+            </label>\n+          </div>\n+        </div>\n+      </details>\n+\n+      {/* Environment Variables */}\n+      <details className=\"group\" open={isEnvSectionOpen} onToggle={(e) => setIsEnvSectionOpen(e.currentTarget.open)}>\n+        <summary className=\"flex items-center gap-2 cursor-pointer list-none\">\n+          <ChevronDown className=\"h-3.5 w-3.5 text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\" />\n+          <StepBadge step={3} done={envDone} />\n+          <span className=\"text-[13px] font-medium text-neutral-900 dark:text-neutral-100\">Environment variables</span>\n+          <button\n+            type=\"button\"\n+            onClick={(e) => { e.preventDefault(); setActiveEnvValueIndex(null); setAreEnvValuesHidden((prev) => !prev); }}\n+            className=\"ml-auto text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-300 p-0.5\"\n+            aria-label={areEnvValuesHidden ? \"Reveal values\" : \"Hide values\"}\n+          >\n+            {areEnvValuesHidden ? <EyeOff className=\"h-3.5 w-3.5\" /> : <Eye className=\"h-3.5 w-3.5\" />}\n+          </button>\n+        </summary>\n+        <div\n+          className=\"mt-3 ml-6 space-y-2\"\n+          onPasteCapture={(e) => {\n+            const text = e.clipboardData?.getData(\"text\") ?? \"\";\n+            if (text && (/\\n/.test(text) || /(=|:)\\s*\\S/.test(text))) {\n+              e.preventDefault();\n+              const items = parseEnvBlock(text);\n+              if (items.length > 0) {\n+                setEnvNone(false);\n+                updateEnvVars((prev) => {\n+                  const map = new Map(prev.filter((r) => r.name.trim().length > 0 || r.value.trim().length > 0).map((r) => [r.name, r] as const));\n+                  for (const it of items) {\n+                    if (!it.name) continue;\n+                    const existing = map.get(it.name);\n+                    if (existing) map.set(it.name, { ...existing, value: it.value });\n+                    else map.set(it.name, { name: it.name, value: it.value, isSecret: true });\n+                  }\n+                  const next = Array.from(map.values());\n+                  next.push({ name: \"\", value: \"\", isSecret: true });\n+                  setPendingFocusIndex(next.length - 1);\n+                  return next;\n+                });\n+              }\n+            }\n+          }}\n+        >\n+          <div className=\"grid gap-2 text-[10px] text-neutral-500 items-center\" style={{ gridTemplateColumns: \"minmax(0, 1fr) minmax(0, 1.5fr) 28px\" }}>\n+            <span>Key</span>\n+            <span>Value</span>\n+            <span />\n+          </div>\n+          {envVars.map((row, idx) => {\n+            const isEditingValue = activeEnvValueIndex === idx;\n+            const shouldMaskValue = areEnvValuesHidden && row.value.trim().length > 0 && !isEditingValue;\n+            return (\n+              <div key={idx} className=\"grid gap-2 items-center\" style={{ gridTemplateColumns: \"minmax(0, 1fr) minmax(0, 1.5fr) 28px\" }}>\n+                <input\n+                  type=\"text\"\n+                  value={row.name}\n+                  disabled={envNone}\n+                  ref={(el) => { keyInputRefs.current[idx] = el; }}\n+                  onChange={(e) => { setEnvNone(false); updateEnvVars((prev) => { const next = [...prev]; if (next[idx]) next[idx] = { ...next[idx], name: e.target.value }; return next; }); }}\n+                  placeholder=\"EXAMPLE_NAME\"\n+                  className=\"w-full min-w-0 rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-2.5 py-1.5 text-[12px] font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 disabled:opacity-60 disabled:cursor-not-allowed\"\n+                />\n+                <input\n+                  type=\"text\"\n+                  value={shouldMaskValue ? MASKED_ENV_VALUE : row.value}\n+                  disabled={envNone}\n+                  onChange={shouldMaskValue ? undefined : (e) => { setEnvNone(false); updateEnvVars((prev) => { const next = [...prev]; if (next[idx]) next[idx] = { ...next[idx], value: e.target.value }; return next; }); }}\n+                  onFocus={() => setActiveEnvValueIndex(idx)}\n+                  onBlur={() => setActiveEnvValueIndex((current) => (current === idx ? null : current))}\n+                  readOnly={shouldMaskValue}\n+                  placeholder=\"I9JU23NF394R6HH\"\n+                  className=\"w-full min-w-0 rounded-md border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 px-2.5 py-1.5 text-[12px] font-mono text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700 disabled:opacity-60 disabled:cursor-not-allowed\"\n+                />\n+                <button\n+                  type=\"button\"\n+                  disabled={envNone}\n+                  onClick={() => updateEnvVars((prev) => { const next = prev.filter((_, i) => i !== idx); return next.length > 0 ? next : [{ name: \"\", value: \"\", isSecret: true }]; })}\n+                  className=\"h-7 w-7 rounded border border-neutral-200 dark:border-neutral-800 text-neutral-400 grid place-items-center hover:border-neutral-300 dark:hover:border-neutral-700 hover:text-neutral-600 dark:hover:text-neutral-200 disabled:opacity-50\"\n+                  aria-label=\"Remove\"\n+                >\n+                  <Minus className=\"w-3 h-3\" />\n+                </button>\n+              </div>\n+            );\n+          })}\n+          <div className=\"flex items-center justify-between pt-1\">\n+            <button\n+              type=\"button\"\n+              disabled={envNone}\n+              onClick={() => updateEnvVars((prev) => [...prev, { name: \"\", value: \"\", isSecret: true }])}\n+              className=\"inline-flex items-center gap-1 text-[11px] text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-300 disabled:opacity-50\"\n+            >\n+              <Plus className=\"w-3 h-3\" /> Add\n+            </button>\n+            <label className=\"flex items-center gap-1.5 text-[10px] text-neutral-400 cursor-pointer hover:text-neutral-600 dark:hover:text-neutral-300\">\n+              <input type=\"checkbox\" checked={envNone} onChange={(e) => handleToggleEnvNone(e.target.checked)} className=\"h-3.5 w-3.5 rounded border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-950 text-emerald-500 focus:ring-2 focus:ring-emerald-500/40\" />\n+              None\n+            </label>\n+          </div>\n+          <p className=\"text-[10px] text-neutral-400\">Tip: Paste .env to auto-fill</p>\n+        </div>\n+      </details>\n+\n+      {/* Run Scripts */}\n+      <details className=\"group\" open={isRunSectionOpen} onToggle={(e) => setIsRunSectionOpen(e.currentTarget.open)}>\n+        <summary className=\"flex items-center gap-2 cursor-pointer list-none\">\n+          <ChevronDown className=\"h-3.5 w-3.5 text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\" />\n+          <StepBadge step={4} done={runConfirmed} />\n+          <span className=\"text-[13px] font-medium text-neutral-900 dark:text-neutral-100\">Run scripts in VS Code terminal</span>\n+        </summary>\n+        <div className=\"mt-3 ml-6 space-y-3\">\n+          <p className=\"text-[11px] text-neutral-500 dark:text-neutral-400\">\n+            Open terminal (<kbd className=\"px-1 py-0.5 rounded bg-neutral-100 dark:bg-neutral-800 text-[10px] font-sans\">Ctrl+Shift+`</kbd> or <kbd className=\"px-1 py-0.5 rounded bg-neutral-100 dark:bg-neutral-800 text-[10px] font-sans\">Cmd+J</kbd>) and paste:\n+          </p>\n+          <div className=\"rounded-md border border-neutral-200 dark:border-neutral-800 bg-neutral-50 dark:bg-neutral-900 overflow-hidden\">\n+              <div className=\"flex items-center justify-between px-3 py-1.5 border-b border-neutral-200 dark:border-neutral-800 bg-neutral-100 dark:bg-neutral-800/50\">\n+                <span className=\"text-[10px] uppercase tracking-wide text-neutral-500\">Commands</span>\n+                {(maintenanceScriptValue || devScriptValue) && (\n+                  <button type=\"button\" onClick={handleCopyCommands} className={clsx(\"p-0.5\", commandsCopied ? \"text-emerald-500\" : \"text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-300\")}>\n+                    {commandsCopied ? <Check className=\"h-3 w-3\" /> : <Copy className=\"h-3 w-3\" />}\n+                  </button>\n+                )}\n+              </div>\n+              <pre className=\"px-3 py-2 text-[11px] font-mono text-neutral-900 dark:text-neutral-100 overflow-x-auto whitespace-pre-wrap break-all select-all\">\n+                {(maintenanceScriptValue || devScriptValue)\n+                  ? [maintenanceScript.trim(), devScript.trim()].filter(Boolean).join(\" && \")\n+                  : <span className=\"text-neutral-400 italic\">Enter scripts above to see commands</span>}\n+              </pre>\n+            </div>\n+          <label className=\"flex items-center gap-1.5 text-[11px] text-neutral-500 dark:text-neutral-400 cursor-pointer hover:text-neutral-700 dark:hover:text-neutral-300\">\n+            <input type=\"checkbox\" checked={runConfirmed} onChange={(e) => setRunConfirmed(e.target.checked)} className=\"h-3.5 w-3.5 rounded border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-950 text-emerald-500 focus:ring-2 focus:ring-emerald-500/40\" />\n+            Proceed once dev script is running\n+          </label>\n+        </div>\n+      </details>\n+    </div>\n+  );\n+\n+  const renderStep2Content = () => (\n+    <div className=\"space-y-5\">\n+      {/* Browser Setup Info */}\n+      <details className=\"group\" open={isBrowserSetupSectionOpen} onToggle={(e) => setIsBrowserSetupSectionOpen(e.currentTarget.open)}>\n+        <summary className=\"flex items-center gap-2 cursor-pointer list-none\">\n+          <ChevronDown className=\"h-3.5 w-3.5 text-neutral-400 transition-transform -rotate-90 group-open:rotate-0\" />\n+          <StepBadge step={5} done={browserConfirmed} />\n+          <span className=\"text-[13px] font-medium text-neutral-900 dark:text-neutral-100\">Configure browser</span>\n+        </summary>\n+        <div className=\"mt-3 ml-6 space-y-3\">\n+          <p className=\"text-[11px] text-neutral-500 dark:text-neutral-400\">\n+            Use the browser on the right to set up authentication:\n+          </p>\n+          <ul className=\"space-y-2 text-[11px] text-neutral-600 dark:text-neutral-400\">\n+            <li className=\"flex items-start gap-2\">\n+              <span className=\"flex h-4 w-4 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-500 dark:text-neutral-400 flex-shrink-0 mt-0.5\">1</span>\n+              <span>Sign in to any dashboards or SaaS tools</span>\n+            </li>\n+            <li className=\"flex items-start gap-2\">\n+              <span className=\"flex h-4 w-4 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-500 dark:text-neutral-400 flex-shrink-0 mt-0.5\">2</span>\n+              <span>Dismiss cookie banners, popups, or MFA prompts</span>\n+            </li>\n+            <li className=\"flex items-start gap-2\">\n+              <span className=\"flex h-4 w-4 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-500 dark:text-neutral-400 flex-shrink-0 mt-0.5\">3</span>\n+              <span>Navigate to your dev server URL (e.g., localhost:3000)</span>\n+            </li>\n+          </ul>\n+          <label className=\"flex items-center gap-1.5 text-[11px] text-neutral-500 dark:text-neutral-400 cursor-pointer hover:text-neutral-700 dark:hover:text-neutral-300 pt-1\">\n+            <input type=\"checkbox\" checked={browserConfirmed} onChange={(e) => setBrowserConfirmed(e.target.checked)} className=\"h-3.5 w-3.5 rounded border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-950 text-emerald-500 focus:ring-2 focus:ring-emerald-500/40\" />\n+            Browser is set up properly\n+          </label>\n+        </div>\n+      </details>\n+\n+      {/* Note about terminal */}\n+      <div className=\"rounded-md border border-amber-200 dark:border-amber-900/50 bg-amber-50 dark:bg-amber-950/20 px-3 py-2.5\">\n+        <p className=\"text-[11px] text-amber-800 dark:text-amber-200\">\n+          <strong>Note:</strong> Running terminals will be stopped on save. The maintenance and dev scripts run automatically on each preview.\n+        </p>\n+      </div>\n+    </div>\n+  );\n+\n+  const renderPreviewPanel = () => {\n+    const isVscodeStep = currentStep === 1;\n+    const placeholder = isVscodeStep ? workspacePlaceholder : browserPlaceholder;\n+    const iframeKey = isVscodeStep ? vscodePersistKey : browserPersistKey;\n+\n+    return (\n+      <div className=\"h-full flex flex-col overflow-hidden relative\">\n+        {placeholder ? (\n+          <div className=\"absolute inset-0 flex flex-col items-center justify-center gap-2 px-4 text-center text-neutral-500 dark:text-neutral-400\">\n+            <div className=\"text-sm font-medium text-neutral-600 dark:text-neutral-200\">\n+              {placeholder.title}\n+            </div>\n+            {placeholder.description ? (\n+              <p className=\"text-xs text-neutral-500 dark:text-neutral-400\">\n+                {placeholder.description}\n+              </p>\n+            ) : null}\n+          </div>\n+        ) : null}\n+        <div\n+          className={clsx(\n+            \"absolute inset-0\",\n+            placeholder ? \"opacity-0\" : \"opacity-100\"\n+          )}\n+          data-iframe-target={iframeKey}\n+        />\n+      </div>\n+    );\n+  };\n+\n+  return (\n+    <div className=\"flex h-screen overflow-hidden bg-neutral-50 dark:bg-neutral-950 font-mono text-[15px] leading-6\">\n+      {/* Left: Configuration Form */}\n+      <div className=\"w-[420px] flex flex-col overflow-hidden border-r border-neutral-200 dark:border-neutral-800 bg-white dark:bg-black\">\n+        <div className=\"flex-shrink-0 px-5 pt-4 pb-2\">\n+          <Link\n+            href=\"/preview\"\n+            className=\"inline-flex items-center gap-1 text-[11px] text-neutral-500 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-neutral-100 mb-3\"\n+          >\n+            <ArrowLeft className=\"h-3 w-3\" />\n+            Go to preview.new\n+          </Link>\n+          <h1 className=\"text-base font-semibold text-neutral-900 dark:text-neutral-100 tracking-tight\">\n+            Configure environment\n+          </h1>\n+        </div>\n+\n+        <div className=\"flex-1 overflow-y-auto px-5 pb-5\">\n+          {currentStep === 1 ? renderStep1Content() : renderStep2Content()}\n+        </div>\n+\n+        <div className=\"flex-shrink-0 border-t border-neutral-200 dark:border-neutral-800 p-6 bg-white dark:bg-black\">\n+          {errorMessage && (\n+            <div className=\"rounded-md bg-red-50 dark:bg-red-950/20 border border-red-200 dark:border-red-900/50 p-3 mb-4\">\n+              <p className=\"text-sm text-red-600 dark:text-red-400\">{errorMessage}</p>\n+            </div>\n+          )}\n+\n+          <div className=\"flex items-center justify-between gap-3\">\n+            {currentStep > 1 ? (\n+              <button\n+                type=\"button\"\n+                onClick={handlePrevStep}\n+                className=\"inline-flex items-center gap-2 rounded-md border border-neutral-200 dark:border-neutral-800 px-4 py-2 text-sm font-medium text-neutral-700 dark:text-neutral-300 hover:bg-neutral-50 dark:hover:bg-neutral-900 transition\"\n+              >\n+                <ArrowLeft className=\"w-4 h-4\" />\n+                Back\n+              </button>\n+            ) : (\n+              <div />\n+            )}\n+\n+            {currentStep < 2 ? (\n+              <button\n+                type=\"button\"\n+                onClick={handleNextStep}\n+                className=\"inline-flex items-center gap-2 rounded-md bg-neutral-900 dark:bg-neutral-100 text-white dark:text-neutral-900 px-4 py-2 text-sm font-semibold hover:bg-neutral-800 dark:hover:bg-neutral-200 transition\"\n+              >\n+                Next\n+                <ArrowRight className=\"w-4 h-4\" />\n+              </button>\n+            ) : (\n+              <button\n+                type=\"button\"\n+                onClick={handleSaveConfiguration}\n+                disabled={isSaving}\n+                className=\"inline-flex items-center justify-center rounded-md bg-neutral-900 dark:bg-neutral-100 text-white dark:text-neutral-900 px-4 py-2 text-sm font-semibold hover:bg-neutral-800 dark:hover:bg-neutral-200 transition disabled:opacity-50 disabled:cursor-not-allowed\"\n+              >\n+                {isSaving ? (\n+                  <>\n+                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n+                    Saving...\n+                  </>\n+                ) : (\n+                  \"Save configuration\"\n+                )}\n+              </button>\n+            )}\n+          </div>\n+        </div>\n+      </div>\n+\n+      {/* Right: Preview Panel */}\n+      <div className=\"flex-1 flex flex-col bg-neutral-950 overflow-hidden\">\n+        {renderPreviewPanel()}\n+      </div>\n+    </div>\n+  );\n+}\ndiff --git a/apps/www/components/preview/preview-dashboard.tsx b/apps/www/components/preview/preview-dashboard.tsx\nnew file mode 100644\nindex 000000000..de7caccc5\n--- /dev/null\n+++ b/apps/www/components/preview/preview-dashboard.tsx\n@@ -0,0 +1,784 @@\n+\"use client\";\n+\n+import { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\n+import {\n+  ArrowLeft,\n+  Camera,\n+  ExternalLink,\n+  Github,\n+  Link2,\n+  Loader2,\n+  Pencil,\n+  Search,\n+  Server,\n+  Shield,\n+  Star,\n+  Trash2,\n+  User,\n+} from \"lucide-react\";\n+import Link from \"next/link\";\n+import clsx from \"clsx\";\n+import { Button } from \"@/components/ui/button\";\n+import {\n+  Tooltip,\n+  TooltipContent,\n+  TooltipProvider,\n+  TooltipTrigger,\n+} from \"@/components/ui/tooltip\";\n+\n+type ProviderConnection = {\n+  installationId: number;\n+  accountLogin: string | null;\n+  accountType: string | null;\n+  isActive: boolean;\n+};\n+\n+type RepoSearchResult = {\n+  name: string;\n+  full_name: string;\n+  private: boolean;\n+  updated_at?: string | null;\n+  pushed_at?: string | null;\n+};\n+\n+type PreviewConfigStatus = \"active\" | \"paused\" | \"disabled\";\n+\n+type PreviewConfigListItem = {\n+  id: string;\n+  repoFullName: string;\n+  environmentId: string | null;\n+  repoInstallationId: number | null;\n+  repoDefaultBranch: string | null;\n+  status: PreviewConfigStatus;\n+  lastRunAt: number | null;\n+  teamSlugOrId: string;\n+  teamName: string;\n+};\n+\n+type TeamOption = {\n+  slugOrId: string;\n+  displayName: string;\n+};\n+\n+type PreviewDashboardProps = {\n+  selectedTeamSlugOrId: string;\n+  teamOptions: TeamOption[];\n+  providerConnectionsByTeam: Record<string, ProviderConnection[]>;\n+  isAuthenticated: boolean;\n+  previewConfigs: PreviewConfigListItem[];\n+};\n+\n+const ADD_INSTALLATION_VALUE = \"__add_github_account__\";\n+\n+export function PreviewDashboard({\n+  selectedTeamSlugOrId,\n+  teamOptions,\n+  providerConnectionsByTeam,\n+  isAuthenticated,\n+  previewConfigs,\n+}: PreviewDashboardProps) {\n+  const [selectedTeamSlugOrIdState, setSelectedTeamSlugOrIdState] = useState(\n+    () => selectedTeamSlugOrId || teamOptions[0]?.slugOrId || \"\",\n+  );\n+  const [isInstallingApp, setIsInstallingApp] = useState(false);\n+  const [errorMessage, setErrorMessage] = useState<string | null>(null);\n+  const [configError, setConfigError] = useState<string | null>(null);\n+\n+  // Repository selection state\n+  const [selectedInstallationId, setSelectedInstallationId] = useState<number | null>(null);\n+  const [repoSearch, setRepoSearch] = useState(\"\");\n+  const [repos, setRepos] = useState<RepoSearchResult[]>([]);\n+  const [isLoadingRepos, setIsLoadingRepos] = useState(false);\n+  const [navigatingRepo, setNavigatingRepo] = useState<string | null>(null);\n+  const [configs, setConfigs] = useState<PreviewConfigListItem[]>(previewConfigs);\n+  const [updatingConfigId, setUpdatingConfigId] = useState<string | null>(null);\n+  const [openingConfigId, setOpeningConfigId] = useState<string | null>(null);\n+\n+  // Public URL input state\n+  const [repoUrlInput, setRepoUrlInput] = useState(\"\");\n+\n+  const currentProviderConnections = useMemo(\n+    () => providerConnectionsByTeam[selectedTeamSlugOrIdState] ?? [],\n+    [providerConnectionsByTeam, selectedTeamSlugOrIdState]\n+  );\n+  const activeConnections = useMemo(\n+    () => currentProviderConnections.filter((connection) => connection.isActive),\n+    [currentProviderConnections]\n+  );\n+  const previousTeamRef = useRef(selectedTeamSlugOrIdState);\n+  const hasGithubAppInstallation = activeConnections.length > 0;\n+  const canSearchRepos =\n+    isAuthenticated &&\n+    Boolean(selectedTeamSlugOrIdState) &&\n+    hasGithubAppInstallation;\n+\n+  useEffect(() => {\n+    setConfigs(previewConfigs);\n+  }, [previewConfigs]);\n+\n+  // Parse GitHub URL to extract owner/repo\n+  const parseGithubUrl = useCallback((input: string): string | null => {\n+    const trimmed = input.trim();\n+    // Try to parse as URL\n+    try {\n+      const url = new URL(trimmed);\n+      if (url.hostname === \"github.com\" || url.hostname === \"www.github.com\") {\n+        const parts = url.pathname.split(\"/\").filter(Boolean);\n+        if (parts.length >= 2) {\n+          return `${parts[0]}/${parts[1]}`;\n+        }\n+      }\n+    } catch {\n+      // Not a valid URL, check if it's owner/repo format\n+      const ownerRepoMatch = trimmed.match(/^([a-zA-Z0-9_.-]+)\\/([a-zA-Z0-9_.-]+)$/);\n+      if (ownerRepoMatch) {\n+        return trimmed;\n+      }\n+    }\n+    return null;\n+  }, []);\n+\n+  const handleOpenConfig = useCallback((config: PreviewConfigListItem) => {\n+    setOpeningConfigId(config.id);\n+    const params = new URLSearchParams({\n+      repo: config.repoFullName,\n+      team: config.teamSlugOrId,\n+    });\n+    if (config.repoInstallationId !== null) {\n+      params.set(\"installationId\", String(config.repoInstallationId));\n+    }\n+    if (config.environmentId) {\n+      params.set(\"environmentId\", config.environmentId);\n+    }\n+    window.location.href = `/preview/configure?${params.toString()}`;\n+  }, []);\n+\n+  const handleDeleteConfig = useCallback(\n+    async (config: PreviewConfigListItem) => {\n+      setUpdatingConfigId(config.id);\n+      setConfigError(null);\n+      try {\n+        const params = new URLSearchParams({ teamSlugOrId: config.teamSlugOrId });\n+        const response = await fetch(`/api/preview/configs/${config.id}?${params.toString()}`, {\n+          method: \"DELETE\",\n+          headers: { \"Content-Type\": \"application/json\" },\n+        });\n+        if (!response.ok) {\n+          throw new Error(await response.text());\n+        }\n+        setConfigs((previous) => previous.filter((item) => item.id !== config.id));\n+      } catch (error) {\n+        const message =\n+          error instanceof Error ? error.message : \"Failed to delete preview configuration\";\n+        console.error(\"[PreviewDashboard] Failed to delete preview configuration\", error);\n+        setConfigError(message);\n+      } finally {\n+        setUpdatingConfigId(null);\n+      }\n+    },\n+    []\n+  );\n+\n+  const handleTeamChange = useCallback(\n+    (nextTeam: string) => {\n+      setSelectedTeamSlugOrIdState(nextTeam);\n+      setSelectedInstallationId(null);\n+      setRepoSearch(\"\");\n+      setErrorMessage(null);\n+    },\n+    []\n+  );\n+\n+  const handleStartPreview = useCallback(async () => {\n+    if (!selectedTeamSlugOrIdState) {\n+      setErrorMessage(\"Select a team before continuing.\");\n+      return;\n+    }\n+\n+    const repoName = parseGithubUrl(repoUrlInput);\n+    if (!repoName) {\n+      setErrorMessage(\"Please enter a valid GitHub URL or owner/repo\");\n+      return;\n+    }\n+    const params = new URLSearchParams({ repo: repoName });\n+    params.set(\"team\", selectedTeamSlugOrIdState);\n+    const configurePath = `/preview/configure?${params.toString()}`;\n+\n+    if (!isAuthenticated) {\n+      setErrorMessage(null);\n+      setNavigatingRepo(\"__url_input__\");\n+      window.location.href = `/handler/sign-in?after_auth_return_to=${encodeURIComponent(configurePath)}`;\n+      return;\n+    }\n+\n+    if (!hasGithubAppInstallation) {\n+      setErrorMessage(null);\n+      setIsInstallingApp(true);\n+      setNavigatingRepo(\"__url_input__\");\n+\n+      try {\n+        try {\n+          sessionStorage.setItem(\"pr_review_return_url\", configurePath);\n+        } catch (storageError) {\n+          console.warn(\"[PreviewDashboard] Failed to persist return URL\", storageError);\n+        }\n+\n+        const response = await fetch(\"/api/integrations/github/install-state\", {\n+          method: \"POST\",\n+          headers: { \"Content-Type\": \"application/json\" },\n+          body: JSON.stringify({\n+            teamSlugOrId: selectedTeamSlugOrIdState,\n+            returnUrl: new URL(configurePath, window.location.origin).toString(),\n+          }),\n+        });\n+\n+        if (!response.ok) {\n+          throw new Error(await response.text());\n+        }\n+\n+        const payload = (await response.json()) as { state: string };\n+        const githubAppSlug = process.env.NEXT_PUBLIC_GITHUB_APP_SLUG;\n+        if (!githubAppSlug) {\n+          throw new Error(\"GitHub App slug is not configured\");\n+        }\n+\n+        const url = new URL(`https://github.com/apps/${githubAppSlug}/installations/new`);\n+        url.searchParams.set(\"state\", payload.state);\n+        window.location.href = url.toString();\n+        return;\n+      } catch (error) {\n+        const message =\n+          error instanceof Error ? error.message : \"Failed to start GitHub App install\";\n+        console.error(\"[PreviewDashboard] Failed to start GitHub App install\", error);\n+        setErrorMessage(message);\n+        setIsInstallingApp(false);\n+        setNavigatingRepo(null);\n+        return;\n+      }\n+    }\n+\n+    setErrorMessage(null);\n+    setNavigatingRepo(\"__url_input__\");\n+    window.location.href = configurePath;\n+  }, [\n+    repoUrlInput,\n+    parseGithubUrl,\n+    selectedTeamSlugOrIdState,\n+    hasGithubAppInstallation,\n+    isAuthenticated,\n+  ]);\n+\n+  // Auto-select first connection for the team, but keep user choice if still valid\n+  useEffect(() => {\n+    const fallbackInstallationId = activeConnections[0]?.installationId ?? null;\n+    const teamChanged = previousTeamRef.current !== selectedTeamSlugOrIdState;\n+    const hasSelectedConnection = activeConnections.some(\n+      (connection) => connection.installationId === selectedInstallationId\n+    );\n+\n+    if (activeConnections.length === 0) {\n+      if (selectedInstallationId !== null) {\n+        setSelectedInstallationId(null);\n+      }\n+    } else if (teamChanged || !hasSelectedConnection) {\n+      if (selectedInstallationId !== fallbackInstallationId) {\n+        setSelectedInstallationId(fallbackInstallationId);\n+      }\n+    }\n+\n+    previousTeamRef.current = selectedTeamSlugOrIdState;\n+  }, [activeConnections, selectedInstallationId, selectedTeamSlugOrIdState]);\n+\n+  const handleInstallGithubApp = async () => {\n+    if (!selectedTeamSlugOrIdState) {\n+      setErrorMessage(\"Select a team first\");\n+      return;\n+    }\n+    setIsInstallingApp(true);\n+    setErrorMessage(null);\n+    try {\n+      const currentUrl = window.location.href;\n+      try {\n+        sessionStorage.setItem(\"pr_review_return_url\", currentUrl);\n+      } catch (storageError) {\n+        console.warn(\"[PreviewDashboard] Failed to persist return URL\", storageError);\n+      }\n+\n+      const response = await fetch(\"/api/integrations/github/install-state\", {\n+        method: \"POST\",\n+        headers: { \"Content-Type\": \"application/json\" },\n+        body: JSON.stringify({\n+          teamSlugOrId: selectedTeamSlugOrIdState,\n+          returnUrl: currentUrl,\n+        }),\n+      });\n+      if (!response.ok) {\n+        throw new Error(await response.text());\n+      }\n+      const payload = (await response.json()) as { installUrl: string };\n+      window.location.href = payload.installUrl;\n+    } catch (error) {\n+      const message =\n+        error instanceof Error ? error.message : \"Failed to start GitHub App install\";\n+      console.error(\"[PreviewDashboard] Failed to start GitHub App install\", error);\n+      setErrorMessage(message);\n+      setIsInstallingApp(false);\n+    }\n+  };\n+\n+  const fetchRepos = useCallback(\n+    async (searchTerm: string) => {\n+      if (!canSearchRepos || selectedInstallationId === null) {\n+        setRepos([]);\n+        return;\n+      }\n+      setIsLoadingRepos(true);\n+      setErrorMessage(null);\n+      try {\n+        const params = new URLSearchParams({\n+          team: selectedTeamSlugOrIdState,\n+          installationId: String(selectedInstallationId),\n+        });\n+        const trimmed = searchTerm.trim();\n+        if (trimmed) {\n+          params.set(\"search\", trimmed);\n+        }\n+        const response = await fetch(`/api/integrations/github/repos?${params.toString()}`);\n+        if (!response.ok) {\n+          throw new Error(await response.text());\n+        }\n+        const payload = (await response.json()) as { repos: RepoSearchResult[] };\n+        setRepos(trimmed ? payload.repos : payload.repos.slice(0, 5));\n+      } catch (err) {\n+        const message = err instanceof Error ? err.message : \"Failed to load repositories\";\n+        console.error(\"[PreviewDashboard] Failed to load repositories\", err);\n+        setErrorMessage(message);\n+      } finally {\n+        setIsLoadingRepos(false);\n+      }\n+    },\n+    [canSearchRepos, selectedInstallationId, selectedTeamSlugOrIdState]\n+  );\n+\n+\n+  // Debounced search effect\n+  useEffect(() => {\n+    if (!canSearchRepos || selectedInstallationId === null) return;\n+\n+    const timeoutId = setTimeout(() => {\n+      void fetchRepos(repoSearch);\n+    }, 300);\n+\n+    return () => clearTimeout(timeoutId);\n+  }, [repoSearch, canSearchRepos, selectedInstallationId, fetchRepos]);\n+\n+  const handleContinue = useCallback((repoName: string) => {\n+    if (!repoName.trim()) return;\n+    setNavigatingRepo(repoName);\n+    const params = new URLSearchParams({\n+      repo: repoName,\n+      installationId: String(selectedInstallationId ?? \"\"),\n+      team: selectedTeamSlugOrIdState,\n+    });\n+    window.location.href = `/preview/configure?${params.toString()}`;\n+  }, [selectedInstallationId, selectedTeamSlugOrIdState]);\n+\n+  useEffect(() => {\n+    if (selectedInstallationId !== null) {\n+      void fetchRepos(\"\");\n+    } else {\n+      setRepos([]);\n+    }\n+  }, [selectedInstallationId, fetchRepos]);\n+\n+  useEffect(() => {\n+    if (!selectedTeamSlugOrIdState && teamOptions[0]) {\n+      setSelectedTeamSlugOrIdState(teamOptions[0].slugOrId);\n+    }\n+  }, [selectedTeamSlugOrIdState, teamOptions]);\n+\n+  // Repo selection box - only this part, not configured repos\n+  const repoSelectionBox = !isAuthenticated ? (\n+    <div className=\"flex flex-1 flex-col items-center justify-center rounded-lg border border-white/5 bg-white/[0.02]\">\n+      <User className=\"h-6 w-6 text-neutral-500 mb-3\" />\n+      <h3 className=\"text-base font-medium text-white mb-1.5\">Sign in to continue</h3>\n+      <p className=\"text-sm text-neutral-500 mb-5 max-w-xs text-center\">\n+        Sign in to import your repositories and capture pull requests.\n+      </p>\n+      <Button asChild className=\"bg-white text-black hover:bg-neutral-200\">\n+        <Link href=\"/handler/sign-in?after_auth_return_to=/preview\">\n+          Sign In\n+        </Link>\n+      </Button>\n+    </div>\n+  ) : !hasGithubAppInstallation ? (\n+    <div className=\"flex flex-1 flex-col items-center justify-center rounded-lg border border-white/5 bg-white/[0.02]\">\n+      <Github className=\"h-6 w-6 text-neutral-500 mb-3\" />\n+      <h3 className=\"text-base font-medium text-white mb-1.5\">Connect to GitHub</h3>\n+      <p className=\"text-sm text-neutral-500 mb-5 max-w-xs text-center\">\n+        Install the preview.new GitHub App to connect your repositories.\n+      </p>\n+      <Button\n+        onClick={handleInstallGithubApp}\n+        disabled={isInstallingApp}\n+        className=\"inline-flex items-center gap-2 bg-white text-black hover:bg-neutral-200\"\n+      >\n+        {isInstallingApp ? (\n+          <Loader2 className=\"h-4 w-4 animate-spin\" />\n+        ) : (\n+          <Shield className=\"h-4 w-4\" />\n+        )}\n+        Install GitHub App\n+      </Button>\n+      {errorMessage && (\n+        <p className=\"mt-4 text-sm text-red-400\">{errorMessage}</p>\n+      )}\n+    </div>\n+  ) : (\n+    <div className=\"flex flex-1 flex-col overflow-hidden rounded-lg border border-white/10\">\n+      <div className=\"flex border-b border-white/10 shrink-0\">\n+        <div className=\"relative border-r border-white/10\">\n+          <Github className=\"pointer-events-none absolute left-4 top-1/2 -translate-y-1/2 h-4 w-4 text-neutral-400\" />\n+          <select\n+            value={selectedInstallationId ?? \"\"}\n+            onChange={(e) => {\n+              const value = e.target.value;\n+              if (value === ADD_INSTALLATION_VALUE) {\n+                void handleInstallGithubApp();\n+                return;\n+              }\n+              setSelectedInstallationId(Number(value));\n+            }}\n+            className=\"h-10 appearance-none bg-transparent py-2 pl-11 pr-8 text-sm text-white focus:outline-none\"\n+          >\n+            {activeConnections.map((conn) => (\n+              <option key={conn.installationId} value={conn.installationId}>\n+                {conn.accountLogin || `ID: ${conn.installationId}`}\n+              </option>\n+            ))}\n+            <option value={ADD_INSTALLATION_VALUE}>Add account</option>\n+          </select>\n+          <div className=\"pointer-events-none absolute right-2.5 top-1/2 -translate-y-1/2\">\n+            <svg className=\"h-4 w-4 text-neutral-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n+              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n+            </svg>\n+          </div>\n+        </div>\n+\n+        <div className=\"relative flex-1\">\n+          <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 h-4 w-4 text-neutral-500\" />\n+          <input\n+            type=\"text\"\n+            value={repoSearch}\n+            onChange={(e) => setRepoSearch(e.target.value)}\n+            placeholder=\"Search...\"\n+            disabled={!canSearchRepos}\n+            className=\"h-10 w-full bg-transparent py-2 pl-11 pr-4 text-sm text-white placeholder:text-neutral-500 focus:outline-none disabled:cursor-not-allowed disabled:opacity-50\"\n+          />\n+        </div>\n+      </div>\n+\n+      <div\n+        className=\"flex-1 divide-y divide-white/5\"\n+        style={{\n+          scrollbarWidth: \"thin\",\n+          scrollbarColor: \"rgba(255,255,255,0.2) transparent\",\n+        }}\n+      >\n+        {!canSearchRepos ? (\n+          <div className=\"flex items-center justify-center h-full text-sm text-neutral-500\">\n+            Select a team and install the GitHub App to search.\n+          </div>\n+        ) : isLoadingRepos ? (\n+          <div className=\"flex items-center justify-center h-full\">\n+            <Loader2 className=\"h-5 w-5 animate-spin text-neutral-500\" />\n+          </div>\n+        ) : repos.length > 0 ? (\n+          repos.slice(0, 5).map((repo) => (\n+            <div\n+              key={repo.full_name}\n+              className=\"flex items-center justify-between px-4 py-2.5\"\n+            >\n+              <div className=\"flex items-center gap-2.5 min-w-0\">\n+                <Github className=\"h-4 w-4 text-neutral-400 shrink-0\" />\n+                <span className=\"text-sm text-white\">{repo.full_name}</span>\n+              </div>\n+              <Button\n+                onClick={() => handleContinue(repo.full_name)}\n+                disabled={navigatingRepo !== null || !selectedInstallationId}\n+                size=\"sm\"\n+                className=\"h-6 px-3 text-xs bg-white text-black hover:bg-neutral-200 min-w-[55px]\"\n+              >\n+                {navigatingRepo === repo.full_name ? (\n+                  <Loader2 className=\"h-3.5 w-3.5 animate-spin\" />\n+                ) : (\n+                  \"Import\"\n+                )}\n+              </Button>\n+            </div>\n+          ))\n+        ) : (\n+          <div className=\"flex flex-col items-center justify-center h-full text-sm text-neutral-500\">\n+            <p>No repositories found</p>\n+          </div>\n+        )}\n+      </div>\n+    </div>\n+  );\n+\n+  return (\n+    <div className=\"mx-auto w-full max-w-5xl px-6 py-10\">\n+      {/* Header */}\n+      <div className=\"mb-10\">\n+        <Link\n+          href=\"https://cmux.dev\"\n+          className=\"inline-flex items-center gap-2 text-sm text-neutral-400 transition hover:text-white mb-5\"\n+        >\n+          <ArrowLeft className=\"h-4 w-4\" />\n+          <span>Back to cmux</span>\n+        </Link>\n+\n+        <h1 className=\"text-3xl font-semibold tracking-tight text-white mb-2\">\n+          Screenshot previews for your PRs\n+        </h1>\n+        <p className=\"text-base text-neutral-400 max-w-2xl\">\n+          preview.new sets up a GitHub agent that takes screenshot previews of your dev server so you\n+          can visually verify your pull requests.\n+        </p>\n+      </div>\n+\n+      {/* Quick Setup Input */}\n+      <div id=\"setup-preview\" className=\"mb-10\">\n+        <div className=\"flex rounded-lg border border-white/10 overflow-hidden\">\n+          <div className=\"relative flex-1 flex items-center\">\n+            <Link2 className=\"absolute left-4 h-5 w-5 text-neutral-500\" />\n+            <input\n+              type=\"text\"\n+              value={repoUrlInput}\n+              onChange={(e) => setRepoUrlInput(e.target.value)}\n+              onKeyDown={(e) => e.key === \"Enter\" && void handleStartPreview()}\n+              placeholder=\"Enter a Git repository URL to setup screenshot previews...\"\n+              className=\"w-full h-10 bg-transparent pl-11 pr-4 text-sm text-white placeholder:text-neutral-500 focus:outline-none\"\n+            />\n+          </div>\n+          <Button\n+            onClick={() => void handleStartPreview()}\n+            disabled={!repoUrlInput.trim() || navigatingRepo !== null || !selectedTeamSlugOrIdState}\n+            className=\"h-10 px-4 rounded-none bg-white text-black hover:bg-neutral-200 text-sm font-medium\"\n+          >\n+            {navigatingRepo === \"__url_input__\" ? (\n+              <Loader2 className=\"h-4 w-4 animate-spin\" />\n+            ) : (\n+              \"Continue\"\n+            )}\n+          </Button>\n+        </div>\n+        {!isAuthenticated && (\n+          <p className=\"text-xs text-neutral-500 mt-2\">\n+            Sign in to connect private repos.\n+          </p>\n+        )}\n+        {errorMessage && (\n+          <p className=\"text-xs text-red-400 mt-2\">{errorMessage}</p>\n+        )}\n+      </div>\n+\n+      {/* Main content grid */}\n+      <div className=\"grid gap-6 lg:grid-cols-[minmax(0,1.35fr)_minmax(0,1fr)]\">\n+        {/* Left Column Header */}\n+        <div className=\"flex items-center justify-between min-h-[34px]\">\n+          <h2 className=\"text-base font-medium text-white\">Choose a repository</h2>\n+          {isAuthenticated && teamOptions.length > 0 && (\n+            <div className=\"flex items-center gap-2.5\">\n+              <label className=\"text-sm text-neutral-500\">Team</label>\n+              <div className=\"relative\">\n+                <select\n+                  value={selectedTeamSlugOrIdState}\n+                  onChange={(e) => handleTeamChange(e.target.value)}\n+                  className=\"appearance-none rounded-md border border-white/10 bg-white/5 pl-3 pr-8 py-1.5 text-sm text-white focus:border-white/20 focus:outline-none\"\n+                >\n+                  {teamOptions.map((team) => (\n+                    <option key={team.slugOrId} value={team.slugOrId}>\n+                      {team.displayName}\n+                    </option>\n+                  ))}\n+                </select>\n+                <div className=\"pointer-events-none absolute right-2.5 top-2\">\n+                  <svg className=\"h-4 w-4 text-neutral-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n+                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n+                  </svg>\n+                </div>\n+              </div>\n+            </div>\n+          )}\n+        </div>\n+\n+        {/* Right Column Header */}\n+        <div className=\"flex items-center justify-between min-h-[34px]\">\n+          <h2 className=\"text-base font-medium text-white\">What is preview.new?</h2>\n+        </div>\n+\n+        {/* Left: Repo selection box */}\n+        <div className=\"flex flex-col\">\n+          {repoSelectionBox}\n+        </div>\n+\n+        {/* Right: Feature cards */}\n+        <div className=\"space-y-3\">\n+          <div className=\"flex items-start gap-4 rounded-lg border border-white/5 bg-white/5 p-4\">\n+            <div className=\"shrink-0 rounded p-2 bg-sky-500/10 text-sky-400\">\n+              <Camera className=\"h-5 w-5\" />\n+            </div>\n+            <div>\n+              <h4 className=\"text-sm font-medium text-white mb-1\">Screenshot agent</h4>\n+              <p className=\"text-xs text-neutral-400 leading-relaxed\">\n+                An agent boots your dev server and captures screenshots of your UI on every PR.\n+              </p>\n+            </div>\n+          </div>\n+\n+          <div className=\"flex items-start gap-4 rounded-lg border border-white/5 bg-white/5 p-4\">\n+            <div className=\"shrink-0 rounded p-2 bg-emerald-500/10 text-emerald-400\">\n+              <Github className=\"h-5 w-5\" />\n+            </div>\n+            <div>\n+              <h4 className=\"text-sm font-medium text-white mb-1\">GitHub comments</h4>\n+              <p className=\"text-xs text-neutral-400 leading-relaxed\">\n+                Screenshots are posted directly to your PR as comments for easy review.\n+              </p>\n+            </div>\n+          </div>\n+\n+          <div className=\"flex items-start gap-4 rounded-lg border border-white/5 bg-white/5 p-4\">\n+            <div className=\"shrink-0 rounded p-2 bg-purple-500/10 text-purple-400\">\n+              <Server className=\"h-5 w-5\" />\n+            </div>\n+            <div>\n+              <h4 className=\"text-sm font-medium text-white mb-1\">Isolated VMs</h4>\n+              <p className=\"text-xs text-neutral-400 leading-relaxed\">\n+                Each PR runs in a dedicated VM with your exact dev environment.\n+              </p>\n+            </div>\n+          </div>\n+        </div>\n+\n+        {/* Left: Configured repositories */}\n+        <div>\n+          <div className=\"flex items-center justify-between mb-6\">\n+            <h2 className=\"text-base font-medium text-white\">Configured repositories</h2>\n+            {configError && <span className=\"text-sm text-red-400\">{configError}</span>}\n+          </div>\n+          {configs.length === 0 ? (\n+            <p className=\"text-sm text-neutral-500\">\n+              No preview configs yet.{\" \"}\n+              {isAuthenticated && hasGithubAppInstallation\n+                ? \"Choose a repository above to create one.\"\n+                : \"Connect GitHub and import a repository to get started.\"}\n+            </p>\n+          ) : (\n+            <TooltipProvider delayDuration={100}>\n+              <div className=\"space-y-1.5\">\n+                {configs.map((config) => (\n+                  <div\n+                    key={config.id}\n+                    className=\"flex items-center justify-between px-3 py-2.5\"\n+                  >\n+                    <div className=\"flex items-center gap-2.5 min-w-0\">\n+                      <Github className=\"h-4 w-4 text-neutral-500 shrink-0\" />\n+                      <span className=\"text-sm text-white truncate\">{config.repoFullName}</span>\n+                      <span className=\"text-xs text-neutral-600\">{config.teamName}</span>\n+                      <span\n+                        className={clsx(\n+                          \"text-xs px-2 py-0.5 rounded\",\n+                          config.status === \"active\"\n+                            ? \"bg-emerald-500/10 text-emerald-400\"\n+                            : config.status === \"paused\"\n+                              ? \"bg-amber-500/10 text-amber-400\"\n+                              : \"bg-neutral-500/10 text-neutral-400\"\n+                        )}\n+                      >\n+                        {config.status}\n+                      </span>\n+                    </div>\n+                    <div className=\"flex items-center gap-1.5\">\n+                      <Tooltip>\n+                        <TooltipTrigger asChild>\n+                          <button\n+                            type=\"button\"\n+                            onClick={() => handleOpenConfig(config)}\n+                            disabled={openingConfigId === config.id}\n+                            className=\"p-1.5 text-neutral-500 disabled:opacity-50\"\n+                          >\n+                            {openingConfigId === config.id ? (\n+                              <Loader2 className=\"h-4 w-4 animate-spin\" />\n+                            ) : (\n+                              <Pencil className=\"h-4 w-4\" />\n+                            )}\n+                          </button>\n+                        </TooltipTrigger>\n+                        <TooltipContent side=\"top\" className=\"text-xs\">\n+                          Edit configuration\n+                        </TooltipContent>\n+                      </Tooltip>\n+                      <Tooltip>\n+                        <TooltipTrigger asChild>\n+                          <button\n+                            type=\"button\"\n+                            onClick={() => void handleDeleteConfig(config)}\n+                            disabled={updatingConfigId === config.id}\n+                            className=\"p-1.5 text-red-400 disabled:opacity-50\"\n+                          >\n+                            {updatingConfigId === config.id ? (\n+                              <Loader2 className=\"h-4 w-4 animate-spin\" />\n+                            ) : (\n+                              <Trash2 className=\"h-4 w-4\" />\n+                            )}\n+                          </button>\n+                        </TooltipTrigger>\n+                        <TooltipContent side=\"top\" className=\"text-xs\">\n+                          Delete configuration\n+                        </TooltipContent>\n+                      </Tooltip>\n+                    </div>\n+                  </div>\n+                ))}\n+              </div>\n+            </TooltipProvider>\n+          )}\n+        </div>\n+\n+        {/* Right: From creators section */}\n+        <div>\n+          <div className=\"flex items-center gap-2 mb-6\">\n+            <h2 className=\"text-base font-medium text-white\">From the creators of</h2>\n+            <div className=\"inline-flex items-center gap-1.5 text-white\">\n+              <span className=\"text-blue-400\">&gt;</span>\n+              <Link href=\"https://cmux.dev\" className=\"text-md font-medium text-white hover:underline\">\n+                cmux.dev\n+              </Link>\n+            </div>\n+          </div>\n+          <p className=\"text-sm text-neutral-500 mb-2\">\n+            Want UI screenshots for your code reviews? Check out cmux - an open-source Claude Code/Codex manager with visual diffs!\n+          </p>\n+          <div className=\"flex items-center gap-3\">\n+            <Link\n+              href=\"https://github.com/manaflow-ai/cmux\"\n+              className=\"inline-flex items-center gap-1.5 rounded-md border border-white/10 bg-white/5 px-3 py-1.5 text-xs text-white\"\n+            >\n+              <Star className=\"h-3.5 w-3.5\" />\n+              Star on GitHub\n+            </Link>\n+            <Link\n+              href=\"https://cmux.dev\"\n+              className=\"inline-flex items-center gap-1.5 rounded-md border border-white/10 bg-white/5 px-3 py-1.5 text-xs text-white\"\n+            >\n+              <ExternalLink className=\"h-3.5 w-3.5\" />\n+              Explore cmux\n+            </Link>\n+          </div>\n+        </div>\n+      </div>\n+    </div>\n+  );\n+}\ndiff --git a/apps/www/components/ui/tooltip.tsx b/apps/www/components/ui/tooltip.tsx\nindex 33030e69b..1bf472438 100644\n--- a/apps/www/components/ui/tooltip.tsx\n+++ b/apps/www/components/ui/tooltip.tsx\n@@ -1,6 +1,6 @@\n import * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n import { memo } from \"react\"\n-import type { ComponentProps, CSSProperties } from \"react\"\n+import type { ComponentProps } from \"react\"\n \n import { cn } from \"@/lib/utils\"\n \n@@ -29,9 +29,8 @@ function TooltipContent({\n       <TooltipPrimitive.Content\n         data-slot=\"tooltip-content\"\n         sideOffset={sideOffset}\n-        style={{ \"--primary\": \"black\" } as CSSProperties}\n         className={cn(\n-          \"z-[var(--z-tooltip,10020)] w-fit pointer-events-none select-none rounded-md bg-primary px-3 py-2 text-xs text-primary-foreground shadow-sm\",\n+          \"z-[var(--z-tooltip,10020)] w-fit pointer-events-none select-none rounded-md bg-neutral-800 px-3 py-2 text-xs text-white shadow-sm\",\n           \"data-[state=delayed-open]:animate-in data-[state=delayed-open]:fade-in-0 data-[state=delayed-open]:zoom-in-95\",\n           \"data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95\",\n           \"data-[state=delayed-open]:data-[side=bottom]:slide-in-from-top-2 data-[state=delayed-open]:data-[side=top]:slide-in-from-bottom-2 data-[state=delayed-open]:data-[side=left]:slide-in-from-right-2 data-[state=delayed-open]:data-[side=right]:slide-in-from-left-2\",\ndiff --git a/apps/www/lib/github/framework-detection.ts b/apps/www/lib/github/framework-detection.ts\nnew file mode 100644\nindex 000000000..f12901bd2\n--- /dev/null\n+++ b/apps/www/lib/github/framework-detection.ts\n@@ -0,0 +1,106 @@\n+import { createGitHubClient } from \"@/lib/github/octokit\";\n+import { type FrameworkPreset } from \"@/components/preview/preview-configure-client\";\n+\n+type PackageJson = {\n+  dependencies?: Record<string, string>;\n+  devDependencies?: Record<string, string>;\n+  scripts?: Record<string, string>;\n+};\n+\n+function chooseFrameworkFromPackageJson(pkg: PackageJson): FrameworkPreset | null {\n+  const deps = { ...(pkg.dependencies ?? {}), ...(pkg.devDependencies ?? {}) };\n+  const hasAny = (...keys: string[]) => keys.some((key) => deps[key]);\n+\n+  if (hasAny(\"next\")) return \"next\";\n+  if (hasAny(\"nuxt\")) return \"nuxt\";\n+  if (hasAny(\"@remix-run/node\", \"@remix-run/serve\", \"remix\")) return \"remix\";\n+  if (hasAny(\"astro\")) return \"astro\";\n+  if (hasAny(\"@sveltejs/kit\")) return \"sveltekit\";\n+  if (hasAny(\"@angular/core\")) return \"angular\";\n+  if (hasAny(\"react-scripts\")) return \"cra\";\n+  if (hasAny(\"vue\", \"@vue/cli-service\")) return \"vue\";\n+  if (hasAny(\"vite\")) return \"vite\";\n+\n+  const scripts = pkg.scripts ?? {};\n+  const scriptValues = Object.values(scripts);\n+  if (scriptValues.some((val) => val.includes(\"next\"))) return \"next\";\n+  if (scriptValues.some((val) => val.includes(\"nuxt\"))) return \"nuxt\";\n+  if (scriptValues.some((val) => val.includes(\"remix\"))) return \"remix\";\n+  if (scriptValues.some((val) => val.includes(\"astro\"))) return \"astro\";\n+  if (scriptValues.some((val) => val.includes(\"svelte\"))) return \"sveltekit\";\n+  if (scriptValues.some((val) => val.includes(\"ng \"))) return \"angular\";\n+  if (scriptValues.some((val) => val.includes(\"vue\"))) return \"vue\";\n+  if (scriptValues.some((val) => val.includes(\"vite\"))) return \"vite\";\n+  return null;\n+}\n+\n+async function fetchRepoJson(owner: string, name: string, path: string): Promise<PackageJson | null> {\n+  const octokit = createGitHubClient(undefined, { useTokenRotation: true });\n+  try {\n+    const res = await octokit.request(\"GET /repos/{owner}/{repo}/contents/{path}\", {\n+      owner,\n+      repo: name,\n+      path,\n+    });\n+    const data = res.data as { content?: string };\n+    if (!(\"content\" in data) || !data.content) {\n+      return null;\n+    }\n+    const raw = Buffer.from(data.content, \"base64\").toString(\"utf-8\");\n+    return JSON.parse(raw) as PackageJson;\n+  } catch (error) {\n+    console.error(\"Failed to read repo json\", { owner, name, path, error });\n+    return null;\n+  }\n+}\n+\n+async function repoHasFile(owner: string, name: string, path: string): Promise<boolean> {\n+  const octokit = createGitHubClient(undefined, { useTokenRotation: true });\n+  try {\n+    await octokit.request(\"GET /repos/{owner}/{repo}/contents/{path}\", {\n+      owner,\n+      repo: name,\n+      path,\n+    });\n+    return true;\n+  } catch {\n+    return false;\n+  }\n+}\n+\n+export async function detectFrameworkPreset(repoFullName: string): Promise<FrameworkPreset> {\n+  const [owner, name] = repoFullName.split(\"/\");\n+  if (!owner || !name) {\n+    return \"other\";\n+  }\n+\n+  const pkg = await fetchRepoJson(owner, name, \"package.json\");\n+  const pkgGuess = pkg ? chooseFrameworkFromPackageJson(pkg) : null;\n+  if (pkgGuess) {\n+    return pkgGuess;\n+  }\n+\n+  const fileGuesses: Array<[FrameworkPreset, string[]]> = [\n+    [\"next\", [\"next.config.js\", \"next.config.ts\", \"next.config.mjs\"]],\n+    [\"nuxt\", [\"nuxt.config.ts\", \"nuxt.config.js\", \"nuxt.config.mjs\"]],\n+    [\"remix\", [\"remix.config.js\", \"remix.config.ts\"]],\n+    [\"astro\", [\"astro.config.mjs\", \"astro.config.ts\", \"astro.config.js\"]],\n+    [\"sveltekit\", [\"svelte.config.js\", \"svelte.config.ts\"]],\n+    [\"angular\", [\"angular.json\"]],\n+    [\"vite\", [\"vite.config.ts\", \"vite.config.js\", \"vite.config.mjs\"]],\n+    [\"vue\", [\"vue.config.js\", \"vue.config.ts\"]],\n+  ];\n+\n+  for (const [preset, paths] of fileGuesses) {\n+    const found = await paths.reduce<Promise<boolean>>(async (accPromise, candidate) => {\n+      const acc = await accPromise;\n+      if (acc) return true;\n+      return repoHasFile(owner, name, candidate);\n+    }, Promise.resolve(false));\n+    if (found) {\n+      return preset;\n+    }\n+  }\n+\n+  return \"other\";\n+}\ndiff --git a/apps/www/lib/hono-app.ts b/apps/www/lib/hono-app.ts\nindex 3730d8e79..6f0e38564 100644\n--- a/apps/www/lib/hono-app.ts\n+++ b/apps/www/lib/hono-app.ts\n@@ -22,6 +22,7 @@ import {\n   usersRouter,\n   iframePreflightRouter,\n   workspaceConfigsRouter,\n+  previewRouter,\n } from \"@/lib/routes/index\";\n import { authAnonymousRouter } from \"@/lib/routes/auth.anonymous.route\";\n import { stackServerApp } from \"@/lib/utils/stack\";\n@@ -122,6 +123,7 @@ app.route(\"/\", teamsRouter);\n app.route(\"/\", branchRouter);\n app.route(\"/\", codeReviewRouter);\n app.route(\"/\", workspaceConfigsRouter);\n+app.route(\"/\", previewRouter);\n \n // OpenAPI documentation\n app.doc(\"/doc\", {\ndiff --git a/apps/www/lib/routes/environments.route.ts b/apps/www/lib/routes/environments.route.ts\nindex 6b853f593..0363ea655 100644\n--- a/apps/www/lib/routes/environments.route.ts\n+++ b/apps/www/lib/routes/environments.route.ts\n@@ -12,6 +12,16 @@ import { MorphCloudClient } from \"morphcloud\";\n import { randomBytes } from \"node:crypto\";\n import { determineHttpServiceUpdates } from \"./determine-http-service-updates\";\n \n+const CLEANUP_COMMANDS = [\n+  \"tmux kill-session -t cmux 2>/dev/null || true\",\n+  \"tmux kill-server 2>/dev/null || true\",\n+  \"git config --global --unset user.name 2>/dev/null || true\",\n+  \"git config --global --unset user.email 2>/dev/null || true\",\n+  \"git config --global --unset credential.helper 2>/dev/null || true\",\n+  \"git credential-cache exit 2>/dev/null || true\",\n+  \"gh auth logout 2>/dev/null || true\",\n+].join(\" && \");\n+\n export const environmentsRouter = new OpenAPIHono();\n \n const sanitizePortsOrThrow = (ports: readonly number[]): number[] => {\n@@ -239,15 +249,7 @@ environmentsRouter.openapi(\n         return { dataVaultKey };\n       })();\n \n-      await instance.exec(\n-        [\n-          \"git config --global --unset user.name 2>/dev/null || true\",\n-          \"git config --global --unset user.email 2>/dev/null || true\",\n-          \"git config --global --unset credential.helper 2>/dev/null || true\",\n-          \"git credential-cache exit 2>/dev/null || true\",\n-          \"gh auth logout 2>/dev/null || true\",\n-        ].join(\" && \")\n-      );\n+      await instance.exec(CLEANUP_COMMANDS);\n \n       const snapshot = await instance.snapshot();\n \n@@ -871,6 +873,8 @@ environmentsRouter.openapi(\n         );\n       }\n \n+      await instance.exec(CLEANUP_COMMANDS);\n+\n       const snapshot = await instance.snapshot();\n \n       const creation = await convexClient.mutation(\ndiff --git a/apps/www/lib/routes/github.install-state.route.ts b/apps/www/lib/routes/github.install-state.route.ts\nindex 5b5642e6f..52881eae6 100644\n--- a/apps/www/lib/routes/github.install-state.route.ts\n+++ b/apps/www/lib/routes/github.install-state.route.ts\n@@ -1,6 +1,10 @@\n import { getAccessTokenFromRequest } from \"@/lib/utils/auth\";\n import { api } from \"@cmux/convex/api\";\n import { createRoute, OpenAPIHono, z } from \"@hono/zod-openapi\";\n+import { createAppAuth } from \"@octokit/auth-app\";\n+import { Octokit } from \"octokit\";\n+import { env } from \"@/lib/utils/www-env\";\n+import { githubPrivateKey } from \"../utils/githubPrivateKey\";\n import { getConvex } from \"../utils/get-convex\";\n \n export const githubInstallStateRouter = new OpenAPIHono();\n@@ -25,6 +29,7 @@ const RequestBody = z\n const ResponseBody = z\n   .object({\n     state: z.string(),\n+    installUrl: z.string().url(),\n   })\n   .openapi(\"GithubInstallStateResponse\");\n \n@@ -73,7 +78,27 @@ githubInstallStateRouter.openapi(\n         ...(body.returnUrl ? { returnUrl: body.returnUrl } : {}),\n       });\n \n-      return c.json({ state: result.state });\n+      const octokit = new Octokit({\n+        authStrategy: createAppAuth,\n+        auth: {\n+          appId: env.CMUX_GITHUB_APP_ID,\n+          privateKey: githubPrivateKey,\n+        },\n+      });\n+\n+      const appMeta = await octokit.request(\"GET /app\");\n+      const appSlug =\n+        appMeta.data?.slug || process.env.NEXT_PUBLIC_GITHUB_APP_SLUG || null;\n+      if (!appSlug) {\n+        return c.text(\"GitHub App slug is not configured\", 500);\n+      }\n+\n+      const installUrl = new URL(\n+        `https://github.com/apps/${appSlug}/installations/new`,\n+      );\n+      installUrl.searchParams.set(\"state\", result.state);\n+\n+      return c.json({ state: result.state, installUrl: installUrl.toString() });\n     } catch (error) {\n       console.error(\"[githubInstallState] Failed to mint install state\", error);\n       const message = error instanceof Error ? error.message : \"Unknown error\";\ndiff --git a/apps/www/lib/routes/index.ts b/apps/www/lib/routes/index.ts\nindex cc7bdd3bd..b6bdee25a 100644\n--- a/apps/www/lib/routes/index.ts\n+++ b/apps/www/lib/routes/index.ts\n@@ -20,3 +20,4 @@ export { usersRouter } from \"./users.route\";\n export { branchRouter } from \"./branch.route\";\n export { codeReviewRouter } from \"./code-review.route\";\n export { workspaceConfigsRouter } from \"./workspace-configs.route\";\n+export { previewRouter } from \"./preview.route\";\ndiff --git a/apps/www/lib/routes/preview.route.ts b/apps/www/lib/routes/preview.route.ts\nnew file mode 100644\nindex 000000000..3635784d7\n--- /dev/null\n+++ b/apps/www/lib/routes/preview.route.ts\n@@ -0,0 +1,291 @@\n+import { getAccessTokenFromRequest } from \"@/lib/utils/auth\";\n+import { getConvex } from \"@/lib/utils/get-convex\";\n+import { verifyTeamAccess } from \"@/lib/utils/team-verification\";\n+import { api } from \"@cmux/convex/api\";\n+import type { Doc } from \"@cmux/convex/dataModel\";\n+import { typedZid } from \"@cmux/shared/utils/typed-zid\";\n+import { OpenAPIHono, createRoute, z } from \"@hono/zod-openapi\";\n+import { HTTPException } from \"hono/http-exception\";\n+\n+export const previewRouter = new OpenAPIHono();\n+\n+const PreviewConfigSchema = z\n+  .object({\n+    id: z.string(),\n+    repoFullName: z.string(),\n+    environmentId: z.string().optional().nullable(),\n+    repoInstallationId: z.number().optional().nullable(),\n+    repoDefaultBranch: z.string().optional().nullable(),\n+    status: z.enum([\"active\", \"paused\", \"disabled\"]),\n+    lastRunAt: z.number().optional().nullable(),\n+    createdAt: z.number(),\n+    updatedAt: z.number(),\n+  })\n+  .openapi(\"PreviewConfig\");\n+\n+const PreviewConfigListResponse = z\n+  .object({\n+    configs: z.array(PreviewConfigSchema),\n+  })\n+  .openapi(\"PreviewConfigListResponse\");\n+\n+const PreviewConfigMutationBody = z\n+  .object({\n+    previewConfigId: z.string().optional(),\n+    teamSlugOrId: z.string(),\n+    repoFullName: z.string(),\n+    environmentId: z.string().optional(),\n+    repoInstallationId: z.number().optional(),\n+    repoDefaultBranch: z.string().optional(),\n+    status: z.enum([\"active\", \"paused\", \"disabled\"]).optional(),\n+  })\n+  .openapi(\"PreviewConfigMutationBody\");\n+\n+const PreviewRunSchema = z\n+  .object({\n+    id: z.string(),\n+    prNumber: z.number(),\n+    prUrl: z.string(),\n+    headSha: z.string(),\n+    baseSha: z.string().optional().nullable(),\n+    status: z.enum([\"pending\", \"running\", \"completed\", \"failed\", \"skipped\"]),\n+    stateReason: z.string().optional().nullable(),\n+    createdAt: z.number(),\n+    updatedAt: z.number(),\n+    dispatchedAt: z.number().optional().nullable(),\n+    startedAt: z.number().optional().nullable(),\n+    completedAt: z.number().optional().nullable(),\n+  })\n+  .openapi(\"PreviewRun\");\n+\n+const PreviewRunsResponse = z\n+  .object({\n+    runs: z.array(PreviewRunSchema),\n+  })\n+  .openapi(\"PreviewRunsResponse\");\n+\n+type PreviewConfigDoc = Doc<\"previewConfigs\">;\n+type PreviewRunDoc = Doc<\"previewRuns\">;\n+\n+function formatPreviewConfig(config: PreviewConfigDoc) {\n+  return {\n+    id: config._id,\n+    repoFullName: config.repoFullName,\n+    environmentId: config.environmentId ?? null,\n+    repoInstallationId: config.repoInstallationId ?? null,\n+    repoDefaultBranch: config.repoDefaultBranch ?? null,\n+    status: config.status ?? \"active\",\n+    lastRunAt: config.lastRunAt ?? null,\n+    createdAt: config.createdAt,\n+    updatedAt: config.updatedAt,\n+  } satisfies z.infer<typeof PreviewConfigSchema>;\n+}\n+\n+function formatPreviewRun(run: PreviewRunDoc) {\n+  return {\n+    id: run._id,\n+    prNumber: run.prNumber,\n+    prUrl: run.prUrl,\n+    headSha: run.headSha,\n+    baseSha: run.baseSha ?? null,\n+    status: run.status,\n+    stateReason: run.stateReason ?? null,\n+    createdAt: run.createdAt,\n+    updatedAt: run.updatedAt,\n+    dispatchedAt: run.dispatchedAt ?? null,\n+    startedAt: run.startedAt ?? null,\n+    completedAt: run.completedAt ?? null,\n+  } satisfies z.infer<typeof PreviewRunSchema>;\n+}\n+\n+const ListQuery = z\n+  .object({\n+    teamSlugOrId: z.string(),\n+  })\n+  .openapi(\"PreviewConfigsQuery\");\n+\n+previewRouter.openapi(\n+  createRoute({\n+    method: \"get\",\n+    path: \"/preview/configs\",\n+    tags: [\"Preview\"],\n+    summary: \"List preview configurations for a team\",\n+    request: {\n+      query: ListQuery,\n+    },\n+    responses: {\n+      200: {\n+        description: \"Configurations fetched\",\n+        content: {\n+          \"application/json\": {\n+            schema: PreviewConfigListResponse,\n+          },\n+        },\n+      },\n+      401: { description: \"Unauthorized\" },\n+    },\n+  }),\n+  async (c) => {\n+    const accessToken = await getAccessTokenFromRequest(c.req.raw);\n+    if (!accessToken) {\n+      return c.text(\"Unauthorized\", 401);\n+    }\n+    const query = c.req.valid(\"query\");\n+    await verifyTeamAccess({ req: c.req.raw, teamSlugOrId: query.teamSlugOrId });\n+    const convex = getConvex({ accessToken });\n+    const configs = await convex.query(api.previewConfigs.listByTeam, {\n+      teamSlugOrId: query.teamSlugOrId,\n+    });\n+    return c.json({ configs: configs.map(formatPreviewConfig) });\n+  },\n+);\n+\n+previewRouter.openapi(\n+  createRoute({\n+    method: \"post\",\n+    path: \"/preview/configs\",\n+    tags: [\"Preview\"],\n+    summary: \"Create or update a preview configuration\",\n+    request: {\n+      body: {\n+        content: {\n+          \"application/json\": {\n+            schema: PreviewConfigMutationBody,\n+          },\n+        },\n+        required: true,\n+      },\n+    },\n+    responses: {\n+      200: {\n+        description: \"Configuration saved\",\n+        content: {\n+          \"application/json\": {\n+            schema: PreviewConfigSchema,\n+          },\n+        },\n+      },\n+      401: { description: \"Unauthorized\" },\n+    },\n+  }),\n+  async (c) => {\n+    const accessToken = await getAccessTokenFromRequest(c.req.raw);\n+    if (!accessToken) {\n+      return c.text(\"Unauthorized\", 401);\n+    }\n+\n+    const body = c.req.valid(\"json\");\n+    await verifyTeamAccess({ req: c.req.raw, teamSlugOrId: body.teamSlugOrId });\n+    const convex = getConvex({ accessToken });\n+\n+    const previewConfigId = await convex.mutation(api.previewConfigs.upsert, {\n+      teamSlugOrId: body.teamSlugOrId,\n+      repoFullName: body.repoFullName,\n+      environmentId: body.environmentId\n+        ? typedZid(\"environments\").parse(body.environmentId)\n+        : undefined,\n+      repoInstallationId: body.repoInstallationId,\n+      repoDefaultBranch: body.repoDefaultBranch,\n+      status: body.status,\n+    });\n+\n+    const saved = await convex.query(api.previewConfigs.get, {\n+      teamSlugOrId: body.teamSlugOrId,\n+      previewConfigId,\n+    });\n+    if (!saved) {\n+      throw new HTTPException(500, { message: \"Failed to load saved configuration\" });\n+    }\n+    return c.json(formatPreviewConfig(saved));\n+  },\n+);\n+\n+previewRouter.openapi(\n+  createRoute({\n+    method: \"delete\",\n+    path: \"/preview/configs/{previewConfigId}\",\n+    tags: [\"Preview\"],\n+    summary: \"Delete a preview configuration\",\n+    request: {\n+      params: z.object({ previewConfigId: z.string() }),\n+      query: z.object({\n+        teamSlugOrId: z.string(),\n+      }),\n+    },\n+    responses: {\n+      200: {\n+        description: \"Deleted\",\n+        content: {\n+          \"application/json\": {\n+            schema: z.object({ id: z.string() }),\n+          },\n+        },\n+      },\n+      401: { description: \"Unauthorized\" },\n+      404: { description: \"Not found\" },\n+    },\n+  }),\n+  async (c) => {\n+    const accessToken = await getAccessTokenFromRequest(c.req.raw);\n+    if (!accessToken) {\n+      return c.text(\"Unauthorized\", 401);\n+    }\n+    const params = c.req.valid(\"param\");\n+    const query = c.req.valid(\"query\");\n+    await verifyTeamAccess({ req: c.req.raw, teamSlugOrId: query.teamSlugOrId });\n+    const convex = getConvex({ accessToken });\n+    try {\n+      const result = await convex.mutation(api.previewConfigs.remove, {\n+        teamSlugOrId: query.teamSlugOrId,\n+        previewConfigId: typedZid(\"previewConfigs\").parse(params.previewConfigId),\n+      });\n+      return c.json(result);\n+    } catch (error) {\n+      console.error(\"Failed to delete preview config\", error);\n+      return c.text(\"Not found\", 404);\n+    }\n+  },\n+);\n+\n+previewRouter.openapi(\n+  createRoute({\n+    method: \"get\",\n+    path: \"/preview/configs/{previewConfigId}/runs\",\n+    tags: [\"Preview\"],\n+    summary: \"List recent preview runs for a configuration\",\n+    request: {\n+      params: z.object({ previewConfigId: z.string() }),\n+      query: z.object({\n+        teamSlugOrId: z.string(),\n+        limit: z.coerce.number().min(1).max(100).optional(),\n+      }),\n+    },\n+    responses: {\n+      200: {\n+        description: \"Runs fetched\",\n+        content: {\n+          \"application/json\": {\n+            schema: PreviewRunsResponse,\n+          },\n+        },\n+      },\n+      401: { description: \"Unauthorized\" },\n+    },\n+  }),\n+  async (c) => {\n+    const accessToken = await getAccessTokenFromRequest(c.req.raw);\n+    if (!accessToken) {\n+      return c.text(\"Unauthorized\", 401);\n+    }\n+    const params = c.req.valid(\"param\");\n+    const query = c.req.valid(\"query\");\n+    await verifyTeamAccess({ req: c.req.raw, teamSlugOrId: query.teamSlugOrId });\n+    const convex = getConvex({ accessToken });\n+    const runs = await convex.query(api.previewRuns.listByConfig, {\n+      teamSlugOrId: query.teamSlugOrId,\n+      previewConfigId: typedZid(\"previewConfigs\").parse(params.previewConfigId),\n+      limit: query.limit,\n+    });\n+    return c.json({ runs: runs.map(formatPreviewRun) });\n+  },\n+);\ndiff --git a/apps/www/lib/team-utils.ts b/apps/www/lib/team-utils.ts\nnew file mode 100644\nindex 000000000..4d5e562b5\n--- /dev/null\n+++ b/apps/www/lib/team-utils.ts\n@@ -0,0 +1,25 @@\n+import { stackServerApp } from \"@/lib/utils/stack\";\n+\n+export type StackTeam = Awaited<ReturnType<typeof stackServerApp.listTeams>>[number] & {\n+  slug?: string | null;\n+  teamId?: string;\n+  id?: string;\n+  displayName?: string | null;\n+  name?: string | null;\n+};\n+\n+export function getTeamSlugOrId(team: StackTeam): string {\n+  return team.slug ?? team.teamId ?? team.id ?? \"\";\n+}\n+\n+export function getTeamId(team: StackTeam): string {\n+  return team.teamId ?? team.id ?? getTeamSlugOrId(team);\n+}\n+\n+export function getTeamSlug(team: StackTeam): string | null {\n+  return team.slug ?? null;\n+}\n+\n+export function getTeamDisplayName(team: StackTeam): string {\n+  return team.displayName ?? team.name ?? getTeamSlugOrId(team);\n+}\ndiff --git a/bun.lock b/bun.lock\nindex d8da2708f..444eeb758 100644\n--- a/bun.lock\n+++ b/bun.lock\n@@ -406,6 +406,7 @@\n         \"@ai-sdk/gateway\": \"^1.0.28\",\n         \"@ai-sdk/openai\": \"^2.0.19\",\n         \"@ai-sdk/provider-utils\": \"^3.0.9\",\n+        \"@cmux/morphcloud-openapi-client\": \"workspace:*\",\n         \"@cmux/shared\": \"workspace:*\",\n         \"@convex-dev/migrations\": \"^0.2.9\",\n         \"@stackframe/js\": \"^2.8.48\",\ndiff --git a/packages/convex/_shared/encoding.ts b/packages/convex/_shared/encoding.ts\nindex 6224ccd53..8ecb7256f 100644\n--- a/packages/convex/_shared/encoding.ts\n+++ b/packages/convex/_shared/encoding.ts\n@@ -48,3 +48,40 @@ export function bytesToHex(buf: ArrayBuffer | Uint8Array): string {\n     .join(\"\");\n }\n \n+const BASE64_ALPHABET =\n+  \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n+\n+export function base64FromBytes(buf: ArrayBuffer | Uint8Array): string {\n+  const bytes = buf instanceof Uint8Array ? buf : new Uint8Array(buf);\n+  let out = \"\";\n+  let i = 0;\n+\n+  for (; i + 2 < bytes.length; i += 3) {\n+    const x = (bytes[i]! << 16) | (bytes[i + 1]! << 8) | bytes[i + 2]!;\n+    out += BASE64_ALPHABET[(x >> 18) & 63]!;\n+    out += BASE64_ALPHABET[(x >> 12) & 63]!;\n+    out += BASE64_ALPHABET[(x >> 6) & 63]!;\n+    out += BASE64_ALPHABET[x & 63]!;\n+  }\n+\n+  const remaining = bytes.length - i;\n+  if (remaining === 1) {\n+    const x = bytes[i]! << 16;\n+    out += BASE64_ALPHABET[(x >> 18) & 63]!;\n+    out += BASE64_ALPHABET[(x >> 12) & 63]!;\n+    out += \"==\";\n+  } else if (remaining === 2) {\n+    const x = (bytes[i]! << 16) | (bytes[i + 1]! << 8);\n+    out += BASE64_ALPHABET[(x >> 18) & 63]!;\n+    out += BASE64_ALPHABET[(x >> 12) & 63]!;\n+    out += BASE64_ALPHABET[(x >> 6) & 63]!;\n+    out += \"=\";\n+  }\n+\n+  return out;\n+}\n+\n+export function stringToBase64(value: string): string {\n+  const bytes = new TextEncoder().encode(value);\n+  return base64FromBytes(bytes);\n+}\ndiff --git a/packages/convex/convex/_generated/api.d.ts b/packages/convex/convex/_generated/api.d.ts\nindex e69efe8a6..58d89883b 100644\n--- a/packages/convex/convex/_generated/api.d.ts\n+++ b/packages/convex/convex/_generated/api.d.ts\n@@ -28,6 +28,7 @@ import type * as github_deployments from \"../github_deployments.js\";\n import type * as github_http from \"../github_http.js\";\n import type * as github_pr_comments from \"../github_pr_comments.js\";\n import type * as github_pr_merge_handler from \"../github_pr_merge_handler.js\";\n+import type * as github_pr_queries from \"../github_pr_queries.js\";\n import type * as github_prs from \"../github_prs.js\";\n import type * as github_setup from \"../github_setup.js\";\n import type * as github_webhook from \"../github_webhook.js\";\n@@ -35,6 +36,13 @@ import type * as github_workflows from \"../github_workflows.js\";\n import type * as http from \"../http.js\";\n import type * as localWorkspaces from \"../localWorkspaces.js\";\n import type * as migrations from \"../migrations.js\";\n+import type * as previewConfigs from \"../previewConfigs.js\";\n+import type * as previewRuns from \"../previewRuns.js\";\n+import type * as previewScreenshots from \"../previewScreenshots.js\";\n+import type * as preview_jobs from \"../preview_jobs.js\";\n+import type * as preview_jobs_http from \"../preview_jobs_http.js\";\n+import type * as preview_jobs_worker from \"../preview_jobs_worker.js\";\n+import type * as preview_screenshots_http from \"../preview_screenshots_http.js\";\n import type * as screenshots_http from \"../screenshots_http.js\";\n import type * as seed from \"../seed.js\";\n import type * as stack from \"../stack.js\";\n@@ -80,6 +88,7 @@ declare const fullApi: ApiFromModules<{\n   github_http: typeof github_http;\n   github_pr_comments: typeof github_pr_comments;\n   github_pr_merge_handler: typeof github_pr_merge_handler;\n+  github_pr_queries: typeof github_pr_queries;\n   github_prs: typeof github_prs;\n   github_setup: typeof github_setup;\n   github_webhook: typeof github_webhook;\n@@ -87,6 +96,13 @@ declare const fullApi: ApiFromModules<{\n   http: typeof http;\n   localWorkspaces: typeof localWorkspaces;\n   migrations: typeof migrations;\n+  previewConfigs: typeof previewConfigs;\n+  previewRuns: typeof previewRuns;\n+  previewScreenshots: typeof previewScreenshots;\n+  preview_jobs: typeof preview_jobs;\n+  preview_jobs_http: typeof preview_jobs_http;\n+  preview_jobs_worker: typeof preview_jobs_worker;\n+  preview_screenshots_http: typeof preview_screenshots_http;\n   screenshots_http: typeof screenshots_http;\n   seed: typeof seed;\n   stack: typeof stack;\ndiff --git a/packages/convex/convex/crown_http.ts b/packages/convex/convex/crown_http.ts\nindex f1fe3a81b..eb319dd9c 100644\n--- a/packages/convex/convex/crown_http.ts\n+++ b/packages/convex/convex/crown_http.ts\n@@ -394,10 +394,28 @@ export const crownWorkerCheck = httpAction(async (ctx, req) => {\n   }\n \n   const requestType = validation.data.checkType ?? \"crown\";\n-  const { taskRunId, taskId } = validation.data;\n+  let { taskRunId, taskId } = validation.data;\n+\n+  if (requestType === \"info\") {\n+    const resolvedTaskRunId =\n+      taskRunId ?? (workerAuth.payload.taskRunId as Id<\"taskRuns\"> | undefined);\n+\n+    if (resolvedTaskRunId) {\n+      console.log(\"[convex.crown] Worker info request\", {\n+        taskRunId: resolvedTaskRunId,\n+        providedTaskRunId: Boolean(taskRunId),\n+        resolvedFromToken: !taskRunId,\n+        workerTeamId: workerAuth.payload.teamId,\n+        workerUserId: workerAuth.payload.userId,\n+      });\n+      return handleInfoRequest(ctx, workerAuth, resolvedTaskRunId);\n+    }\n \n-  if (requestType === \"info\" && taskRunId) {\n-    return handleInfoRequest(ctx, workerAuth, taskRunId);\n+    console.warn(\"[convex.crown] Missing taskRunId for worker info request\", {\n+      requestHasTaskRunId: Boolean(taskRunId),\n+      tokenHasTaskRunId: Boolean(workerAuth.payload.taskRunId),\n+    });\n+    return jsonResponse({ code: 400, message: \"Task run not specified\" }, 400);\n   }\n \n   if (requestType === \"all-complete\" && taskId) {\n@@ -412,16 +430,34 @@ async function handleInfoRequest(\n   workerAuth: WorkerAuthContext,\n   taskRunId: Id<\"taskRuns\">\n ): Promise<Response> {\n+  console.log(\"[convex.crown] Handling worker taskRun info request\", {\n+    taskRunId,\n+    workerTeamId: workerAuth.payload.teamId,\n+    workerUserId: workerAuth.payload.userId,\n+  });\n   const taskRun = await ctx.runQuery(internal.taskRuns.getById, {\n     id: taskRunId,\n   });\n   if (!taskRun) {\n+    console.warn(\"[convex.crown] Task run not found for worker info request\", {\n+      taskRunId,\n+    });\n     return jsonResponse({ code: 404, message: \"Task run not found\" }, 404);\n   }\n   if (\n     taskRun.teamId !== workerAuth.payload.teamId ||\n     taskRun.userId !== workerAuth.payload.userId\n   ) {\n+    console.warn(\n+      \"[convex.crown] Worker attempted to access unauthorized task run\",\n+      {\n+        taskRunId,\n+        workerTeamId: workerAuth.payload.teamId,\n+        taskRunTeamId: taskRun.teamId,\n+        workerUserId: workerAuth.payload.userId,\n+        taskRunUserId: taskRun.userId,\n+      }\n+    );\n     return jsonResponse({ code: 401, message: \"Unauthorized\" }, 401);\n   }\n \n@@ -437,6 +473,7 @@ async function handleInfoRequest(\n       teamId: taskRun.teamId,\n       newBranch: taskRun.newBranch ?? null,\n       agentName: taskRun.agentName ?? null,\n+      isPreviewJob: Boolean(taskRun.isPreviewJob),\n     },\n     task: task\n       ? {\ndiff --git a/packages/convex/convex/environments.ts b/packages/convex/convex/environments.ts\nindex 3365a4997..8e8bd79c0 100644\n--- a/packages/convex/convex/environments.ts\n+++ b/packages/convex/convex/environments.ts\n@@ -2,6 +2,7 @@ import { validateExposedPorts } from \"@cmux/shared/convex-safe\";\n import { v } from \"convex/values\";\n import { resolveTeamIdLoose } from \"../_shared/team\";\n import { authMutation, authQuery } from \"./users/utils\";\n+import { internalQuery } from \"./_generated/server\";\n \n const normalizeExposedPorts = (\n   ports: readonly number[] | undefined\n@@ -217,6 +218,15 @@ export const remove = authMutation({\n   },\n });\n \n+export const getByIdInternal = internalQuery({\n+  args: {\n+    id: v.id(\"environments\"),\n+  },\n+  handler: async (ctx, args) => {\n+    return await ctx.db.get(args.id);\n+  },\n+});\n+\n export const getByDataVaultKey = authQuery({\n   args: {\n     dataVaultKey: v.string(),\ndiff --git a/packages/convex/convex/github_pr_comments.ts b/packages/convex/convex/github_pr_comments.ts\nindex 0778c1e8e..500d79d63 100644\n--- a/packages/convex/convex/github_pr_comments.ts\n+++ b/packages/convex/convex/github_pr_comments.ts\n@@ -1,7 +1,207 @@\n \"use node\";\n import { v } from \"convex/values\";\n import { fetchInstallationAccessToken } from \"../_shared/githubApp\";\n-import { internalAction } from \"./_generated/server\";\n+import { internal } from \"./_generated/api\";\n+import type { Doc, Id } from \"./_generated/dataModel\";\n+import {\n+  internalAction,\n+  type ActionCtx,\n+} from \"./_generated/server\";\n+import { Octokit } from \"octokit\";\n+\n+const createOctokit = (token: string): Octokit => {\n+  return new Octokit({\n+    auth: token,\n+    userAgent: \"cmux-github-bot\",\n+    request: {\n+      timeout: 10_000,\n+    },\n+  });\n+};\n+\n+const parseRepoFullName = (\n+  repoFullName: string,\n+): { owner: string; repo: string } | null => {\n+  const [owner, repo] = repoFullName.split(\"/\");\n+  if (!owner || !repo) {\n+    return null;\n+  }\n+  return { owner, repo };\n+};\n+\n+type PreviewRunDoc = Doc<\"previewRuns\">;\n+type ScreenshotSetDoc = Doc<\"previewScreenshotSets\">;\n+\n+const COMMENT_SIGNATURE = \"_Generated by [cmux](https://cmux.dev)\";\n+const COLLAPSE_MARKER = \"<!-- cmux-preview-collapsed -->\";\n+const COLLAPSE_SUMMARY = \"Older cmux preview screenshots (latest comment is above)\";\n+const MAX_COMMENTS_TO_COLLAPSE = 20;\n+const MAX_PREVIOUS_SCREENSHOT_SETS = 5;\n+const NON_UI_CHANGE_PATTERNS = [\n+  /no changes detected/i,\n+  /all changed files are binary/i,\n+];\n+const STATUS_SUMMARY_LABEL: Record<ScreenshotSetDoc[\"status\"], string> = {\n+  completed: \"✅ Screenshots\",\n+  failed: \"❌ Failed\",\n+  skipped: \"⚠️ Skipped\",\n+};\n+\n+const formatTimestamp = (value?: number | null): string => {\n+  if (!value) {\n+    return \"unknown time\";\n+  }\n+  return new Date(value).toISOString().replace(\"T\", \" \").replace(\"Z\", \" UTC\");\n+};\n+\n+const formatCommitLabel = (set: ScreenshotSetDoc): string =>\n+  set.commitSha ? `\\`${set.commitSha.slice(0, 7)}\\`` : \"latest commit\";\n+\n+const isNonUiChangeReason = (reason?: string | null): boolean => {\n+  if (!reason) {\n+    return false;\n+  }\n+  return NON_UI_CHANGE_PATTERNS.some((pattern) => pattern.test(reason));\n+};\n+\n+const formatSkippedMessage = (reason?: string | null): string => {\n+  if (isNonUiChangeReason(reason)) {\n+    return [\n+      \"No UI-impacting changes were detected, so screenshots were skipped.\",\n+      reason ? `> ${reason}` : null,\n+    ]\n+      .filter(Boolean)\n+      .join(\"\\n\\n\");\n+  }\n+  if (reason) {\n+    return `Screenshot capture was skipped.\\n\\n> ${reason}`;\n+  }\n+  return \"Screenshot capture was skipped.\";\n+};\n+\n+const summarizeSet = (\n+  set: ScreenshotSetDoc,\n+  run?: PreviewRunDoc,\n+): string => {\n+  const prefix = STATUS_SUMMARY_LABEL[set.status] ?? \"ℹ️ Preview\";\n+  const commit = set.commitSha ? set.commitSha.slice(0, 7) : \"unknown\";\n+  const timestamp = formatTimestamp(set.capturedAt ?? run?.createdAt);\n+  return `${prefix} – commit ${commit} (${timestamp})`;\n+};\n+\n+async function renderScreenshotSetMarkdown(\n+  ctx: ActionCtx,\n+  set: ScreenshotSetDoc,\n+  heading: string,\n+): Promise<string> {\n+  const commitLabel = formatCommitLabel(set);\n+  const timestamp = formatTimestamp(set.capturedAt);\n+  const lines: string[] = [heading, \"\"];\n+\n+  if (set.status === \"completed\" && set.images.length > 0) {\n+    const count = set.images.length;\n+    const intro = `Captured ${count} screenshot${count === 1 ? \"\" : \"s\"} for commit ${commitLabel} (${timestamp}).`;\n+    lines.push(intro, \"\");\n+    for (const image of set.images) {\n+      const storageUrl = await ctx.storage.getUrl(image.storageId);\n+      if (!storageUrl) continue;\n+      const fileName = image.fileName || \"screenshot\";\n+      lines.push(`![${fileName}](${storageUrl})`, \"\");\n+    }\n+  } else if (set.status === \"failed\") {\n+    lines.push(\n+      `Failed to capture screenshots for commit ${commitLabel}.`,\n+      \"\",\n+      set.error ? `> ${set.error}` : \"> Unknown error\",\n+      \"\",\n+    );\n+  } else if (set.status === \"skipped\") {\n+    lines.push(formatSkippedMessage(set.error), \"\");\n+  } else {\n+    lines.push(\"Screenshot status is unknown for this run.\", \"\");\n+  }\n+\n+  return lines.join(\"\\n\").replace(/\\n{3,}/g, \"\\n\\n\").trimEnd();\n+}\n+\n+const collapseCommentBody = (body: string): string => {\n+  const trimmed = body.trim();\n+  if (trimmed.includes(COLLAPSE_MARKER)) {\n+    return trimmed;\n+  }\n+  return [\n+    COLLAPSE_MARKER,\n+    \"<details>\",\n+    `<summary>${COLLAPSE_SUMMARY}</summary>`,\n+    \"\",\n+    trimmed,\n+    \"\",\n+    \"</details>\",\n+  ]\n+    .join(\"\\n\")\n+    .replace(/\\n{3,}/g, \"\\n\\n\")\n+    .trimEnd();\n+};\n+\n+async function collapseOlderPreviewComments({\n+  octokit,\n+  owner,\n+  repo,\n+  prNumber,\n+  latestCommentId,\n+}: {\n+  octokit: Octokit;\n+  owner: string;\n+  repo: string;\n+  prNumber: number;\n+  latestCommentId: number;\n+}): Promise<void> {\n+  let collapsedCount = 0;\n+  const iterator = octokit.paginate.iterator(\n+    octokit.rest.issues.listComments,\n+    {\n+      owner,\n+      repo,\n+      issue_number: prNumber,\n+      per_page: 50,\n+    },\n+  );\n+\n+  for await (const { data } of iterator) {\n+    for (const comment of data) {\n+      if (collapsedCount >= MAX_COMMENTS_TO_COLLAPSE) {\n+        return;\n+      }\n+      if (!comment.body) continue;\n+      if (comment.id === latestCommentId) continue;\n+      if (!comment.body.includes(COMMENT_SIGNATURE)) continue;\n+\n+      const nextBody = collapseCommentBody(comment.body);\n+      if (nextBody === comment.body) continue;\n+\n+      try {\n+        await octokit.rest.issues.updateComment({\n+          owner,\n+          repo,\n+          comment_id: comment.id,\n+          body: nextBody,\n+        });\n+        collapsedCount += 1;\n+        console.log(\"[github_pr_comments] Collapsed previous preview comment\", {\n+          commentId: comment.id,\n+        });\n+      } catch (error) {\n+        console.error(\n+          \"[github_pr_comments] Failed to collapse previous preview comment\",\n+          {\n+            commentId: comment.id,\n+            error,\n+          },\n+        );\n+      }\n+    }\n+  }\n+}\n \n export const addPrReaction = internalAction({\n   args: {\n@@ -24,54 +224,587 @@ export const addPrReaction = internalAction({\n         return { ok: false, error: \"Failed to get access token\" };\n       }\n \n-      const response = await fetch(\n-        `https://api.github.com/repos/${repoFullName}/issues/${prNumber}/reactions`,\n+      const repo = parseRepoFullName(repoFullName);\n+      if (!repo) {\n+        console.error(\"[github_pr_comments] Invalid repo full name\", {\n+          repoFullName,\n+        });\n+        return {\n+          ok: false,\n+          error: \"Invalid repository name\",\n+        };\n+      }\n+\n+      const octokit = createOctokit(accessToken);\n+      const { data } = await octokit.rest.reactions.createForIssue({\n+        owner: repo.owner,\n+        repo: repo.repo,\n+        issue_number: prNumber,\n+        content,\n+      });\n+\n+      console.log(\"[github_pr_comments] Successfully added reaction\", {\n+        installationId,\n+        repoFullName,\n+        prNumber,\n+        reactionId: data.id,\n+      });\n+\n+      return { ok: true, reactionId: data.id };\n+    } catch (error) {\n+      console.error(\n+        \"[github_pr_comments] Unexpected error adding reaction\",\n         {\n-          method: \"POST\",\n-          headers: {\n-            Authorization: `Bearer ${accessToken}`,\n-            Accept: \"application/vnd.github+json\",\n-            \"Content-Type\": \"application/json\",\n-            \"User-Agent\": \"cmux-github-bot\",\n-          },\n-          body: JSON.stringify({ content }),\n+          installationId,\n+          repoFullName,\n+          prNumber,\n+          error,\n+        },\n+      );\n+      return {\n+        ok: false,\n+        error: error instanceof Error ? error.message : String(error),\n+      };\n+    }\n+  },\n+});\n+\n+export const postPreviewComment = internalAction({\n+  args: {\n+    installationId: v.number(),\n+    repoFullName: v.string(),\n+    prNumber: v.number(),\n+    screenshotSetId: v.id(\"previewScreenshotSets\"),\n+    previewRunId: v.id(\"previewRuns\"),\n+  },\n+  handler: async (ctx, args) => {\n+    const { installationId, repoFullName, prNumber, screenshotSetId } = args;\n+\n+    try {\n+      const accessToken = await fetchInstallationAccessToken(installationId);\n+      if (!accessToken) {\n+        console.error(\n+          \"[github_pr_comments] Failed to get access token for preview comment\",\n+          { installationId },\n+        );\n+        return { ok: false, error: \"Failed to get access token\" };\n+      }\n+\n+      const repo = parseRepoFullName(repoFullName);\n+      if (!repo) {\n+        console.error(\"[github_pr_comments] Invalid repo full name\", {\n+          repoFullName,\n+        });\n+        return { ok: false, error: \"Invalid repository name\" };\n+      }\n+\n+      const octokit = createOctokit(accessToken);\n+\n+      const previewRunPayload = await ctx.runQuery(\n+        internal.previewRuns.getRunWithConfig,\n+        { previewRunId: args.previewRunId },\n+      );\n+      const previewRun = previewRunPayload?.run;\n+      if (!previewRun) {\n+        console.error(\"[github_pr_comments] Preview run not found\", {\n+          previewRunId: args.previewRunId,\n+        });\n+        return { ok: false, error: \"Preview run not found\" };\n+      }\n+\n+      // Get screenshot set\n+      const screenshotSet = await ctx.runQuery(\n+        internal.previewScreenshots.getScreenshotSet,\n+        { screenshotSetId },\n+      );\n+\n+      if (!screenshotSet) {\n+        console.error(\"[github_pr_comments] Screenshot set not found\", {\n+          screenshotSetId,\n+        });\n+        return { ok: false, error: \"Screenshot set not found\" };\n+      }\n+\n+      // Collect previous screenshot sets for this PR so we can collapse them\n+      const previousRuns =\n+        (await ctx.runQuery(internal.previewRuns.listByConfigAndPr, {\n+          previewConfigId: previewRun.previewConfigId,\n+          prNumber: previewRun.prNumber,\n+          limit: MAX_PREVIOUS_SCREENSHOT_SETS + 1,\n+        })) ?? [];\n+\n+      const previousSetEntries: Array<{\n+        run: PreviewRunDoc;\n+        set: ScreenshotSetDoc;\n+      }> = [];\n+      for (const run of previousRuns) {\n+        if (run._id === previewRun._id) continue;\n+        if (!run.screenshotSetId) continue;\n+        const priorSet = await ctx.runQuery(\n+          internal.previewScreenshots.getScreenshotSet,\n+          { screenshotSetId: run.screenshotSetId },\n+        );\n+        if (!priorSet) continue;\n+        previousSetEntries.push({ run, set: priorSet });\n+        if (previousSetEntries.length >= MAX_PREVIOUS_SCREENSHOT_SETS) {\n+          break;\n+        }\n+      }\n+\n+      // Build comment body\n+      const latestHeading = `### Latest commit ${formatCommitLabel(screenshotSet)}`;\n+      const latestSection = await renderScreenshotSetMarkdown(\n+        ctx,\n+        screenshotSet,\n+        latestHeading,\n+      );\n+\n+      const commentSections: string[] = [\"## Preview Screenshots\", latestSection];\n+\n+      if (previousSetEntries.length > 0) {\n+        const collapsedSections: string[] = [];\n+        for (const entry of previousSetEntries) {\n+          const sectionHeading = `#### ${summarizeSet(entry.set, entry.run)}`;\n+          collapsedSections.push(\n+            await renderScreenshotSetMarkdown(ctx, entry.set, sectionHeading),\n+          );\n+        }\n+\n+        const previousBlock = [\n+          \"<details>\",\n+          `<summary>Previous preview runs (${previousSetEntries.length})</summary>`,\n+          \"\",\n+          collapsedSections.join(\"\\n\\n---\\n\\n\"),\n+          \"\",\n+          \"</details>\",\n+        ].join(\"\\n\");\n+\n+        commentSections.push(previousBlock);\n+      }\n+\n+      commentSections.push(\"---\", COMMENT_SIGNATURE);\n+      const commentBody = commentSections.join(\"\\n\\n\");\n+\n+      // Post comment to GitHub\n+      const { data } = await octokit.rest.issues.createComment({\n+        owner: repo.owner,\n+        repo: repo.repo,\n+        issue_number: prNumber,\n+        body: commentBody,\n+      });\n+\n+      console.log(\"[github_pr_comments] Successfully posted preview comment\", {\n+        installationId,\n+        repoFullName,\n+        prNumber,\n+        commentId: data.id,\n+        commentUrl: data.html_url,\n+      });\n+\n+      // Update preview run with comment URL\n+      if (data.html_url) {\n+        await ctx.runMutation(internal.previewRuns.updateStatus, {\n+          previewRunId: args.previewRunId,\n+          status: \"completed\",\n+          screenshotSetId,\n+          githubCommentUrl: data.html_url,\n+          githubCommentId: data.id,\n+        });\n+      }\n+\n+      await collapseOlderPreviewComments({\n+        octokit,\n+        owner: repo.owner,\n+        repo: repo.repo,\n+        prNumber,\n+        latestCommentId: data.id,\n+      });\n+\n+      return { ok: true, commentId: data.id, commentUrl: data.html_url };\n+    } catch (error) {\n+      console.error(\n+        \"[github_pr_comments] Unexpected error posting preview comment\",\n+        {\n+          installationId,\n+          repoFullName,\n+          prNumber,\n+          error,\n         },\n       );\n+      return {\n+        ok: false,\n+        error: error instanceof Error ? error.message : String(error),\n+      };\n+    }\n+  },\n+});\n \n-      if (!response.ok) {\n-        const errorText = await response.text();\n+export const addPrComment = internalAction({\n+  args: {\n+    installationId: v.number(),\n+    repoFullName: v.string(),\n+    prNumber: v.number(),\n+    body: v.string(),\n+  },\n+  handler: async (\n+    _ctx,\n+    { installationId, repoFullName, prNumber, body },\n+  ) => {\n+    try {\n+      const accessToken = await fetchInstallationAccessToken(installationId);\n+      if (!accessToken) {\n         console.error(\n-          \"[github_pr_comments] Failed to add reaction\",\n+          \"[github_pr_comments] Failed to get access token for installation\",\n+          { installationId },\n+        );\n+        return { ok: false, error: \"Failed to get access token\" };\n+      }\n+\n+      const repo = parseRepoFullName(repoFullName);\n+      if (!repo) {\n+        console.error(\"[github_pr_comments] Invalid repo full name\", {\n+          repoFullName,\n+        });\n+        return { ok: false, error: \"Invalid repository name\" };\n+      }\n+\n+      const octokit = createOctokit(accessToken);\n+      const { data } = await octokit.rest.issues.createComment({\n+        owner: repo.owner,\n+        repo: repo.repo,\n+        issue_number: prNumber,\n+        body,\n+      });\n+      console.log(\"[github_pr_comments] Successfully added comment\", {\n+        installationId,\n+        repoFullName,\n+        prNumber,\n+        commentId: data.id,\n+      });\n+\n+      return { ok: true, commentId: data.id };\n+    } catch (error) {\n+      console.error(\n+        \"[github_pr_comments] Unexpected error adding comment\",\n+        {\n+          installationId,\n+          repoFullName,\n+          prNumber,\n+          error,\n+        },\n+      );\n+      return {\n+        ok: false,\n+        error: error instanceof Error ? error.message : String(error),\n+      };\n+    }\n+  },\n+});\n+\n+async function getScreenshotsForPr(\n+  ctx: ActionCtx,\n+  {\n+    teamId,\n+    repoFullName,\n+    prNumber,\n+  }: {\n+    teamId: string;\n+    repoFullName: string;\n+    prNumber: number;\n+  },\n+): Promise<Array<{ url: string; fileName?: string }>> {\n+  try {\n+    // Find task runs that have this PR\n+    const taskRuns = await ctx.runQuery(\n+      internal.github_pr_queries.findTaskRunsForPr,\n+      {\n+        teamId,\n+        repoFullName,\n+        prNumber,\n+      },\n+    );\n+\n+    if (taskRuns.length === 0) {\n+      return [];\n+    }\n+\n+    // Get screenshots from the latest task run\n+    const screenshots: Array<{ url: string; fileName?: string }> = [];\n+\n+    for (const run of taskRuns) {\n+      if (run.latestScreenshotSetId) {\n+        const screenshotSet = await ctx.runQuery(\n+          internal.github_pr_queries.getScreenshotSet,\n+          {\n+            screenshotSetId: run.latestScreenshotSetId,\n+          },\n+        );\n+\n+        if (screenshotSet && screenshotSet.status === \"completed\") {\n+          for (const image of screenshotSet.images) {\n+            if (image.url) {\n+              screenshots.push({\n+                url: image.url,\n+                fileName: image.fileName,\n+              });\n+            }\n+          }\n+        }\n+      }\n+    }\n+\n+    return screenshots;\n+  } catch (error) {\n+    console.error(\n+      \"[github_pr_comments] Error fetching screenshots for PR\",\n+      {\n+        teamId,\n+        repoFullName,\n+        prNumber,\n+        error,\n+      },\n+    );\n+    return [];\n+  }\n+}\n+\n+function formatScreenshotComment(\n+  screenshots: Array<{ url: string; fileName?: string }>,\n+): string {\n+  if (screenshots.length === 0) {\n+    return \"\";\n+  }\n+\n+  let markdown = \"## Screenshots\\n\\n\";\n+  markdown +=\n+    \"Here are the screenshots from the latest run:\\n\\n\";\n+\n+  for (const screenshot of screenshots) {\n+    const title = screenshot.fileName || \"Screenshot\";\n+    markdown += `### ${title}\\n\\n`;\n+    markdown += `![${title}](${screenshot.url})\\n\\n`;\n+  }\n+\n+  return markdown;\n+}\n+\n+export const postPreviewCommentWithTaskScreenshots = internalAction({\n+  args: {\n+    installationId: v.number(),\n+    repoFullName: v.string(),\n+    prNumber: v.number(),\n+    taskRunId: v.id(\"taskRuns\"),\n+    previewRunId: v.id(\"previewRuns\"),\n+  },\n+  handler: async (ctx, args): Promise<{ ok: true; commentId?: number; commentUrl?: string } | { ok: false; error: string }> => {\n+    const { installationId, repoFullName, prNumber, taskRunId, previewRunId } = args;\n+\n+    try {\n+      const accessToken = await fetchInstallationAccessToken(installationId);\n+      if (!accessToken) {\n+        console.error(\n+          \"[github_pr_comments] Failed to get access token for preview comment\",\n+          { installationId },\n+        );\n+        return { ok: false, error: \"Failed to get access token\" };\n+      }\n+\n+      const repo = parseRepoFullName(repoFullName);\n+      if (!repo) {\n+        console.error(\"[github_pr_comments] Invalid repo full name\", {\n+          repoFullName,\n+        });\n+        return { ok: false, error: \"Invalid repository name\" };\n+      }\n+\n+      const octokit = createOctokit(accessToken);\n+\n+      // Get task run to find screenshot set\n+      const taskRun = await ctx.runQuery(internal.taskRuns.getById, {\n+        id: taskRunId,\n+      });\n+\n+      if (!taskRun?.latestScreenshotSetId) {\n+        console.error(\"[github_pr_comments] No screenshot set for task run\", {\n+          taskRunId,\n+        });\n+        return { ok: false, error: \"No screenshot set found\" };\n+      }\n+\n+      const previewRun = await ctx.runQuery(internal.previewRuns.getById, {\n+        id: previewRunId,\n+      });\n+\n+      if (!previewRun) {\n+        console.error(\"[github_pr_comments] Preview run not found\", {\n+          previewRunId,\n+        });\n+        return { ok: false, error: \"Preview run not found\" };\n+      }\n+\n+      // Get team info for the URL\n+      const team = await ctx.runQuery(internal.teams.getByTeamIdInternal, {\n+        teamId: taskRun.teamId,\n+      });\n+      const teamSlug: string = team?.slug ?? taskRun.teamId;\n+      const workspaceUrl: string = `https://cmux.dev/${teamSlug}/task/${taskRun.taskId}`;\n+\n+      // Get screenshot set from task run\n+      const screenshotSet = await ctx.runQuery(\n+        internal.github_pr_queries.getScreenshotSet,\n+        { screenshotSetId: taskRun.latestScreenshotSetId },\n+      );\n+\n+      if (!screenshotSet) {\n+        console.error(\"[github_pr_comments] Screenshot set not found\", {\n+          screenshotSetId: taskRun.latestScreenshotSetId,\n+        });\n+        return { ok: false, error: \"Screenshot set not found\" };\n+      }\n+\n+      // Build comment body\n+      let commentBody: string = `[Open Workspace](${workspaceUrl}) (expires in 30m) • [Open in GitHub](https://github.com/${repoFullName}/pull/${prNumber})\\n\\n`;\n+      commentBody += \"## Preview Screenshots\\n\\n\";\n+\n+      if (screenshotSet.status === \"completed\" && screenshotSet.images.length > 0) {\n+        commentBody += `Successfully captured ${screenshotSet.images.length} screenshot(s) for commit \\`${(screenshotSet.commitSha || \"\").slice(0, 7)}\\`:\\n\\n`;\n+\n+        for (const image of screenshotSet.images) {\n+          // Get storage URL for the image\n+          const storageUrl = await ctx.storage.getUrl(image.storageId);\n+          if (storageUrl) {\n+            const fileName = image.fileName || \"screenshot\";\n+            commentBody += `### ${fileName}\\n`;\n+            commentBody += `![${fileName}](${storageUrl})\\n\\n`;\n+          }\n+        }\n+\n+        commentBody += `\\n---\\n_Generated by [cmux](https://cmux.dev) preview system_`;\n+      } else if (screenshotSet.status === \"failed\") {\n+        commentBody += `Failed to capture screenshots: ${screenshotSet.error || \"Unknown error\"}\\n\\n`;\n+        commentBody += `\\n---\\n_Generated by [cmux](https://cmux.dev) preview system_`;\n+      } else if (screenshotSet.status === \"skipped\") {\n+        commentBody += `Screenshot capture was skipped: ${screenshotSet.error || \"No preview configured\"}\\n\\n`;\n+        commentBody += `\\n---\\n_Generated by [cmux](https://cmux.dev) preview system_`;\n+      }\n+\n+      // Post comment to GitHub\n+      const { data } = await octokit.rest.issues.createComment({\n+        owner: repo.owner,\n+        repo: repo.repo,\n+        issue_number: prNumber,\n+        body: commentBody,\n+      });\n+      console.log(\"[github_pr_comments] Successfully posted preview comment\", {\n+        installationId,\n+        repoFullName,\n+        prNumber,\n+        commentId: data.id,\n+        commentUrl: data.html_url,\n+      });\n+\n+      const previewScreenshotSetId = await ctx.runMutation(\n+        internal.previewScreenshots.createScreenshotSet,\n+        {\n+          previewRunId,\n+          status: screenshotSet.status as \"completed\" | \"failed\" | \"skipped\",\n+          commitSha: screenshotSet.commitSha ?? previewRun.headSha,\n+          error: screenshotSet.error,\n+          images: screenshotSet.images.map((image) => ({\n+            storageId: image.storageId as Id<\"_storage\">,\n+            mimeType: image.mimeType,\n+            fileName: image.fileName,\n+            commitSha: image.commitSha,\n+          })),\n+        },\n+      );\n+\n+      // Update preview run with comment URL\n+      if (data.html_url) {\n+        await ctx.runMutation(internal.previewRuns.updateStatus, {\n+          previewRunId,\n+          status: screenshotSet.status as \"completed\" | \"failed\" | \"skipped\",\n+          stateReason: screenshotSet.error,\n+          screenshotSetId: previewScreenshotSetId,\n+          githubCommentUrl: data.html_url,\n+        });\n+      }\n+\n+      return { ok: true, commentId: data.id, commentUrl: data.html_url };\n+    } catch (error) {\n+      console.error(\n+        \"[github_pr_comments] Unexpected error posting preview comment\",\n+        {\n+          installationId,\n+          repoFullName,\n+          prNumber,\n+          taskRunId,\n+          error,\n+        },\n+      );\n+      return {\n+        ok: false,\n+        error: error instanceof Error ? error.message : String(error),\n+      };\n+    }\n+  },\n+});\n+\n+export const addScreenshotCommentToPr = internalAction({\n+  args: {\n+    installationId: v.number(),\n+    repoFullName: v.string(),\n+    prNumber: v.number(),\n+    teamId: v.string(),\n+  },\n+  handler: async (\n+    ctx,\n+    { installationId, repoFullName, prNumber, teamId },\n+  ): Promise<\n+    | { ok: true; commentId?: number; skipped?: boolean; reason?: string }\n+    | { ok: false; error: string }\n+  > => {\n+    try {\n+      const screenshots = await getScreenshotsForPr(ctx, {\n+        teamId,\n+        repoFullName,\n+        prNumber,\n+      });\n+\n+      if (screenshots.length === 0) {\n+        console.log(\n+          \"[github_pr_comments] No screenshots found for PR\",\n           {\n             installationId,\n             repoFullName,\n             prNumber,\n-            status: response.status,\n-            error: errorText,\n           },\n         );\n-        return {\n-          ok: false,\n-          error: `GitHub API error: ${response.status}`,\n-        };\n+        return { ok: true, skipped: true, reason: \"No screenshots found\" };\n       }\n \n-      const data = await response.json();\n-      console.log(\"[github_pr_comments] Successfully added reaction\", {\n+      const body = formatScreenshotComment(screenshots);\n+\n+      const result = await ctx.runAction(internal.github_pr_comments.addPrComment, {\n         installationId,\n         repoFullName,\n         prNumber,\n-        reactionId: data.id,\n+        body,\n       });\n \n-      return { ok: true, reactionId: data.id };\n+      if (result.ok) {\n+        return { ok: true, commentId: result.commentId };\n+      }\n+\n+      return { ok: false, error: result?.error ?? \"Unknown error\" };\n     } catch (error) {\n       console.error(\n-        \"[github_pr_comments] Unexpected error adding reaction\",\n+        \"[github_pr_comments] Unexpected error adding screenshot comment\",\n         {\n           installationId,\n           repoFullName,\n           prNumber,\n+          teamId,\n           error,\n         },\n       );\ndiff --git a/packages/convex/convex/github_pr_queries.ts b/packages/convex/convex/github_pr_queries.ts\nnew file mode 100644\nindex 000000000..7933ad23b\n--- /dev/null\n+++ b/packages/convex/convex/github_pr_queries.ts\n@@ -0,0 +1,60 @@\n+import { v } from \"convex/values\";\n+import { internalQuery } from \"./_generated/server\";\n+\n+export const findTaskRunsForPr = internalQuery({\n+  args: {\n+    teamId: v.string(),\n+    repoFullName: v.string(),\n+    prNumber: v.number(),\n+  },\n+  handler: async (ctx, { teamId, repoFullName, prNumber }) => {\n+    // Limit scan to recent runs to avoid loading entire history for large teams\n+    const recentRuns = await ctx.db\n+      .query(\"taskRuns\")\n+      .withIndex(\"by_team_user\", (q) => q.eq(\"teamId\", teamId))\n+      .order(\"desc\")\n+      .take(300);\n+\n+    const matchingRuns = recentRuns.filter((run) => {\n+      if (!run.pullRequests || run.pullRequests.length === 0) {\n+        return false;\n+      }\n+\n+      return run.pullRequests.some(\n+        (pr) =>\n+          pr.repoFullName === repoFullName &&\n+          pr.number === prNumber,\n+      );\n+    });\n+\n+    return matchingRuns.slice(0, 5); // Return up to 5 most recent runs\n+  },\n+});\n+\n+export const getScreenshotSet = internalQuery({\n+  args: {\n+    screenshotSetId: v.id(\"taskRunScreenshotSets\"),\n+  },\n+  handler: async (ctx, { screenshotSetId }) => {\n+    const screenshotSet = await ctx.db.get(screenshotSetId);\n+    if (!screenshotSet) {\n+      return null;\n+    }\n+\n+    // Get URLs for all screenshots\n+    const imagesWithUrls = await Promise.all(\n+      screenshotSet.images.map(async (image) => {\n+        const url = await ctx.storage.getUrl(image.storageId);\n+        return {\n+          ...image,\n+          url: url ?? undefined,\n+        };\n+      }),\n+    );\n+\n+    return {\n+      ...screenshotSet,\n+      images: imagesWithUrls,\n+    };\n+  },\n+});\ndiff --git a/packages/convex/convex/github_webhook.ts b/packages/convex/convex/github_webhook.ts\nindex 1bb18fa8f..2540a014f 100644\n--- a/packages/convex/convex/github_webhook.ts\n+++ b/packages/convex/convex/github_webhook.ts\n@@ -22,7 +22,7 @@ const DEBUG_FLAGS = {\n };\n \n const FEATURE_FLAGS = {\n-  githubEyesReactionOnPrOpen: false,\n+  githubEyesReactionOnPrOpen: true,\n };\n \n async function verifySignature(\n@@ -525,6 +525,151 @@ export const githubWebhook = httpAction(async (_ctx, req) => {\n               });\n             }\n           }\n+\n+          const action = prPayload.action ?? \"\";\n+          if (\n+            [\"opened\", \"reopened\", \"synchronize\", \"ready_for_review\"].includes(\n+              action,\n+            )\n+          ) {\n+            const previewConfig = await _ctx.runQuery(\n+              internal.previewConfigs.getByTeamAndRepo,\n+              { teamId, repoFullName },\n+            );\n+\n+            if (previewConfig) {\n+              const prNumber = Number(prPayload.pull_request?.number ?? 0);\n+              const prUrl = prPayload.pull_request?.html_url ?? null;\n+              const headSha = prPayload.pull_request?.head?.sha ?? null;\n+              const baseSha = prPayload.pull_request?.base?.sha ?? undefined;\n+              const headRef = prPayload.pull_request?.head?.ref ?? undefined;\n+              const headRepoFullName = prPayload.pull_request?.head?.repo?.full_name ?? undefined;\n+              const headRepoCloneUrl = prPayload.pull_request?.head?.repo?.clone_url ?? undefined;\n+\n+              console.log(\"[preview-jobs] Preview config found for PR\", {\n+                repoFullName,\n+                prNumber,\n+                prUrl,\n+                headSha: headSha?.slice(0, 7),\n+                headRef,\n+                headRepoFullName,\n+                isFromFork: headRepoFullName && headRepoFullName !== repoFullName,\n+                previewConfigId: previewConfig._id,\n+              });\n+\n+              if (prNumber && prUrl && headSha) {\n+                try {\n+                  const runId = await _ctx.runMutation(\n+                    internal.previewRuns.enqueueFromWebhook,\n+                    {\n+                      previewConfigId: previewConfig._id,\n+                      teamId,\n+                      repoFullName,\n+                      repoInstallationId: installation,\n+                      prNumber,\n+                      prUrl,\n+                      headSha,\n+                      baseSha,\n+                      headRef,\n+                      headRepoFullName,\n+                      headRepoCloneUrl,\n+                    },\n+                  );\n+\n+                  const existingRun = await _ctx.runQuery(\n+                    internal.previewRuns.getById,\n+                    { id: runId },\n+                  );\n+\n+                  console.log(\"[preview-jobs] Preview run enqueued\", {\n+                    runId,\n+                    repoFullName,\n+                    prNumber,\n+                    prUrl,\n+                  });\n+\n+                  if (existingRun?.taskRunId) {\n+                    console.log(\"[preview-jobs] Preview run already has taskRun; skipping duplicate creation\", {\n+                      runId,\n+                      taskRunId: existingRun.taskRunId,\n+                      status: existingRun.status,\n+                    });\n+                    if (existingRun.status === \"pending\") {\n+                      await _ctx.scheduler.runAfter(\n+                        0,\n+                        internal.preview_jobs.requestDispatch,\n+                        { previewRunId: runId },\n+                      );\n+                    }\n+                  } else {\n+                    // Create task and taskRun for screenshot collection\n+                    // The existing worker infrastructure will pick this up and process it\n+                    const taskId = await _ctx.runMutation(\n+                      internal.tasks.createForPreview,\n+                      {\n+                        teamId,\n+                        userId: previewConfig.createdByUserId,\n+                        previewRunId: runId,\n+                        repoFullName,\n+                        prNumber,\n+                        prUrl,\n+                        headSha,\n+                        baseBranch: previewConfig.repoDefaultBranch,\n+                      },\n+                    );\n+\n+                    const { taskRunId } = await _ctx.runMutation(\n+                      internal.taskRuns.createForPreview,\n+                      {\n+                        taskId,\n+                        teamId,\n+                        userId: previewConfig.createdByUserId,\n+                        prUrl,\n+                        environmentId: previewConfig.environmentId,\n+                        newBranch: headRef,\n+                      },\n+                    );\n+\n+                    // Link the taskRun to the preview run\n+                    await _ctx.runMutation(internal.previewRuns.linkTaskRun, {\n+                      previewRunId: runId,\n+                      taskRunId,\n+                    });\n+\n+                    console.log(\"[preview-jobs] Task and taskRun created\", {\n+                      runId,\n+                      taskId,\n+                      taskRunId,\n+                      repoFullName,\n+                      prNumber,\n+                    });\n+\n+                    // Trigger the preview job dispatch\n+                    await _ctx.scheduler.runAfter(\n+                      0,\n+                      internal.preview_jobs.requestDispatch,\n+                      { previewRunId: runId },\n+                    );\n+\n+                    console.log(\"[preview-jobs] Preview job dispatch scheduled\", {\n+                      runId,\n+                    });\n+                  }\n+                } catch (error) {\n+                  console.error(\"[preview-jobs] Failed to enqueue preview run\", {\n+                    repoFullName,\n+                    prNumber,\n+                    error,\n+                  });\n+                }\n+              }\n+            } else {\n+              console.log(\"[preview-jobs] No preview config found for repo\", {\n+                repoFullName,\n+                teamId,\n+              });\n+            }\n+          }\n         } catch (err) {\n           console.error(\"github_webhook pull_request handler failed\", {\n             err,\ndiff --git a/packages/convex/convex/http.ts b/packages/convex/convex/http.ts\nindex c22d63fd5..4755b7f3c 100644\n--- a/packages/convex/convex/http.ts\n+++ b/packages/convex/convex/http.ts\n@@ -7,6 +7,10 @@ import {\n   crownWorkerComplete,\n } from \"./crown_http\";\n import { createScreenshotUploadUrl, uploadScreenshot } from \"./screenshots_http\";\n+import {\n+  createPreviewScreenshotUploadUrl,\n+  uploadPreviewScreenshot,\n+} from \"./preview_screenshots_http\";\n import {\n   codeReviewFileCallback,\n   codeReviewJobCallback,\n@@ -15,6 +19,12 @@ import { githubSetup } from \"./github_setup\";\n import { githubWebhook } from \"./github_webhook\";\n import { reportEnvironmentError } from \"./taskRuns_http\";\n import { stackWebhook } from \"./stack_webhook\";\n+import {\n+  updatePreviewStatus,\n+  createScreenshotSet,\n+  dispatchPreviewJob,\n+  completePreviewJob,\n+} from \"./preview_jobs_http\";\n \n const http = httpRouter();\n \n@@ -72,6 +82,18 @@ http.route({\n   handler: createScreenshotUploadUrl,\n });\n \n+http.route({\n+  path: \"/api/screenshots/preview/upload\",\n+  method: \"POST\",\n+  handler: uploadPreviewScreenshot,\n+});\n+\n+http.route({\n+  path: \"/api/screenshots/preview/upload-url\",\n+  method: \"POST\",\n+  handler: createPreviewScreenshotUploadUrl,\n+});\n+\n http.route({\n   path: \"/api/code-review/callback\",\n   method: \"POST\",\n@@ -96,4 +118,28 @@ http.route({\n   handler: reportEnvironmentError,\n });\n \n+http.route({\n+  path: \"/api/preview/jobs/dispatch\",\n+  method: \"POST\",\n+  handler: dispatchPreviewJob,\n+});\n+\n+http.route({\n+  path: \"/api/preview/update-status\",\n+  method: \"POST\",\n+  handler: updatePreviewStatus,\n+});\n+\n+http.route({\n+  path: \"/api/preview/create-screenshot-set\",\n+  method: \"POST\",\n+  handler: createScreenshotSet,\n+});\n+\n+http.route({\n+  path: \"/api/preview/complete\",\n+  method: \"POST\",\n+  handler: completePreviewJob,\n+});\n+\n export default http;\ndiff --git a/packages/convex/convex/previewConfigs.ts b/packages/convex/convex/previewConfigs.ts\nnew file mode 100644\nindex 000000000..6b956de9a\n--- /dev/null\n+++ b/packages/convex/convex/previewConfigs.ts\n@@ -0,0 +1,160 @@\n+import { v } from \"convex/values\";\n+import { resolveTeamIdLoose } from \"../_shared/team\";\n+import { authMutation, authQuery } from \"./users/utils\";\n+import { internalQuery } from \"./_generated/server\";\n+\n+function normalizeRepoFullName(value: string): string {\n+  const trimmed = value.trim();\n+  if (!trimmed.includes(\"/\")) {\n+    throw new Error(\"repoFullName must be in the form owner/name\");\n+  }\n+  return trimmed.replace(/\\.git$/i, \"\").toLowerCase();\n+}\n+\n+export const listByTeam = authQuery({\n+  args: {\n+    teamSlugOrId: v.string(),\n+  },\n+  handler: async (ctx, args) => {\n+    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const configs = await ctx.db\n+      .query(\"previewConfigs\")\n+      .withIndex(\"by_team\", (q) => q.eq(\"teamId\", teamId))\n+      .order(\"desc\")\n+      .collect();\n+    return configs;\n+  },\n+});\n+\n+export const get = authQuery({\n+  args: {\n+    teamSlugOrId: v.string(),\n+    previewConfigId: v.id(\"previewConfigs\"),\n+  },\n+  handler: async (ctx, args) => {\n+    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const config = await ctx.db.get(args.previewConfigId);\n+    if (!config || config.teamId !== teamId) {\n+      return null;\n+    }\n+    return config;\n+  },\n+});\n+\n+export const getByRepo = authQuery({\n+  args: {\n+    teamSlugOrId: v.string(),\n+    repoFullName: v.string(),\n+  },\n+  handler: async (ctx, args) => {\n+    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const repoFullName = normalizeRepoFullName(args.repoFullName);\n+    const config = await ctx.db\n+      .query(\"previewConfigs\")\n+      .withIndex(\"by_team_repo\", (q) =>\n+        q.eq(\"teamId\", teamId).eq(\"repoFullName\", repoFullName),\n+      )\n+      .first();\n+    return config ?? null;\n+  },\n+});\n+\n+export const remove = authMutation({\n+  args: {\n+    teamSlugOrId: v.string(),\n+    previewConfigId: v.id(\"previewConfigs\"),\n+  },\n+  handler: async (ctx, args) => {\n+    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const config = await ctx.db.get(args.previewConfigId);\n+    if (!config || config.teamId !== teamId) {\n+      throw new Error(\"Preview config not found\");\n+    }\n+    await ctx.db.delete(args.previewConfigId);\n+    return { id: args.previewConfigId };\n+  },\n+});\n+\n+export const upsert = authMutation({\n+  args: {\n+    teamSlugOrId: v.string(),\n+    repoFullName: v.string(),\n+    environmentId: v.optional(v.id(\"environments\")),\n+    repoInstallationId: v.optional(v.number()),\n+    repoDefaultBranch: v.optional(v.string()),\n+    status: v.optional(\n+      v.union(\n+        v.literal(\"active\"),\n+        v.literal(\"paused\"),\n+        v.literal(\"disabled\"),\n+      ),\n+    ),\n+  },\n+  handler: async (ctx, args) => {\n+    const userId = ctx.identity.subject;\n+    if (!userId) {\n+      throw new Error(\"Authentication required\");\n+    }\n+    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const repoFullName = normalizeRepoFullName(args.repoFullName);\n+    const now = Date.now();\n+\n+    // Verify environment exists and belongs to team if provided\n+    if (args.environmentId) {\n+      const environment = await ctx.db.get(args.environmentId);\n+      if (!environment || environment.teamId !== teamId) {\n+        throw new Error(\"Environment not found\");\n+      }\n+    }\n+\n+    const existing = await ctx.db\n+      .query(\"previewConfigs\")\n+      .withIndex(\"by_team_repo\", (q) =>\n+        q.eq(\"teamId\", teamId).eq(\"repoFullName\", repoFullName),\n+      )\n+      .first();\n+\n+    if (existing) {\n+      await ctx.db.patch(existing._id, {\n+        environmentId: args.environmentId ?? existing.environmentId,\n+        repoInstallationId: args.repoInstallationId ?? existing.repoInstallationId,\n+        repoDefaultBranch: args.repoDefaultBranch ?? existing.repoDefaultBranch,\n+        status: args.status ?? existing.status ?? \"active\",\n+        updatedAt: now,\n+      });\n+      return existing._id;\n+    }\n+\n+    const id = await ctx.db.insert(\"previewConfigs\", {\n+      teamId,\n+      createdByUserId: userId,\n+      repoFullName,\n+      repoProvider: \"github\",\n+      environmentId: args.environmentId,\n+      repoInstallationId: args.repoInstallationId,\n+      repoDefaultBranch: args.repoDefaultBranch,\n+      status: args.status ?? \"active\",\n+      lastRunAt: undefined,\n+      createdAt: now,\n+      updatedAt: now,\n+    });\n+    return id;\n+  },\n+});\n+\n+export const getByTeamAndRepo = internalQuery({\n+  args: {\n+    teamId: v.string(),\n+    repoFullName: v.string(),\n+  },\n+  handler: async (ctx, args) => {\n+    const repoFullName = normalizeRepoFullName(args.repoFullName);\n+    const config = await ctx.db\n+      .query(\"previewConfigs\")\n+      .withIndex(\"by_team_repo\", (q) =>\n+        q.eq(\"teamId\", args.teamId).eq(\"repoFullName\", repoFullName),\n+      )\n+      .first();\n+    return config ?? null;\n+  },\n+});\ndiff --git a/packages/convex/convex/previewRuns.ts b/packages/convex/convex/previewRuns.ts\nnew file mode 100644\nindex 000000000..f6aed0f45\n--- /dev/null\n+++ b/packages/convex/convex/previewRuns.ts\n@@ -0,0 +1,276 @@\n+import { v } from \"convex/values\";\n+import { resolveTeamIdLoose } from \"../_shared/team\";\n+import { authQuery } from \"./users/utils\";\n+import { internalMutation, internalQuery } from \"./_generated/server\";\n+\n+function normalizeRepoFullName(value: string): string {\n+  return value.trim().replace(/\\.git$/i, \"\").toLowerCase();\n+}\n+\n+export const enqueueFromWebhook = internalMutation({\n+  args: {\n+    previewConfigId: v.id(\"previewConfigs\"),\n+    teamId: v.string(),\n+    repoFullName: v.string(),\n+    repoInstallationId: v.optional(v.number()),\n+    prNumber: v.number(),\n+    prUrl: v.string(),\n+    headSha: v.string(),\n+    baseSha: v.optional(v.string()),\n+    headRef: v.optional(v.string()),\n+    headRepoFullName: v.optional(v.string()),\n+    headRepoCloneUrl: v.optional(v.string()),\n+  },\n+  handler: async (ctx, args) => {\n+    const repoFullName = normalizeRepoFullName(args.repoFullName);\n+    const headRepoFullName = args.headRepoFullName\n+      ? normalizeRepoFullName(args.headRepoFullName)\n+      : undefined;\n+\n+    const existing = await ctx.db\n+      .query(\"previewRuns\")\n+      .withIndex(\"by_config_head\", (q) =>\n+        q.eq(\"previewConfigId\", args.previewConfigId).eq(\"headSha\", args.headSha),\n+      )\n+      .order(\"desc\")\n+      .first();\n+\n+    if (existing && (existing.status === \"pending\" || existing.status === \"running\")) {\n+      return existing._id;\n+    }\n+\n+    const now = Date.now();\n+    const runId = await ctx.db.insert(\"previewRuns\", {\n+      previewConfigId: args.previewConfigId,\n+      teamId: args.teamId,\n+      repoFullName,\n+      repoInstallationId: args.repoInstallationId,\n+      prNumber: args.prNumber,\n+      prUrl: args.prUrl,\n+      headSha: args.headSha,\n+      baseSha: args.baseSha,\n+      headRef: args.headRef,\n+      headRepoFullName,\n+      headRepoCloneUrl: args.headRepoCloneUrl,\n+      status: \"pending\",\n+      stateReason: undefined,\n+      dispatchedAt: undefined,\n+      startedAt: undefined,\n+      completedAt: undefined,\n+      screenshotSetId: undefined,\n+      githubCommentUrl: undefined,\n+      createdAt: now,\n+      updatedAt: now,\n+    });\n+\n+    await ctx.db.patch(args.previewConfigId, {\n+      lastRunAt: now,\n+      updatedAt: now,\n+    });\n+\n+    return runId;\n+  },\n+});\n+\n+export const linkTaskRun = internalMutation({\n+  args: {\n+    previewRunId: v.id(\"previewRuns\"),\n+    taskRunId: v.id(\"taskRuns\"),\n+  },\n+  handler: async (ctx, args) => {\n+    const run = await ctx.db.get(args.previewRunId);\n+    if (!run) {\n+      throw new Error(\"Preview run not found\");\n+    }\n+    await ctx.db.patch(run._id, {\n+      taskRunId: args.taskRunId,\n+      updatedAt: Date.now(),\n+    });\n+  },\n+});\n+\n+export const markDispatched = internalMutation({\n+  args: {\n+    previewRunId: v.id(\"previewRuns\"),\n+  },\n+  handler: async (ctx, args) => {\n+    const run = await ctx.db.get(args.previewRunId);\n+    if (!run) {\n+      throw new Error(\"Preview run not found\");\n+    }\n+    await ctx.db.patch(run._id, {\n+      status: \"running\",\n+      dispatchedAt: Date.now(),\n+      updatedAt: Date.now(),\n+    });\n+  },\n+});\n+\n+export const updateStatus = internalMutation({\n+  args: {\n+    previewRunId: v.id(\"previewRuns\"),\n+    status: v.union(\n+      v.literal(\"running\"),\n+      v.literal(\"completed\"),\n+      v.literal(\"failed\"),\n+      v.literal(\"skipped\"),\n+    ),\n+    stateReason: v.optional(v.string()),\n+    screenshotSetId: v.optional(v.id(\"previewScreenshotSets\")),\n+    githubCommentUrl: v.optional(v.string()),\n+    githubCommentId: v.optional(v.number()),\n+  },\n+  handler: async (ctx, args) => {\n+    const run = await ctx.db.get(args.previewRunId);\n+    if (!run) {\n+      throw new Error(\"Preview run not found\");\n+    }\n+    const now = Date.now();\n+    const patch: Record<string, unknown> = {\n+      status: args.status,\n+      stateReason: args.stateReason,\n+      screenshotSetId: args.screenshotSetId,\n+      githubCommentUrl: args.githubCommentUrl ?? run.githubCommentUrl,\n+      githubCommentId: args.githubCommentId ?? run.githubCommentId,\n+      updatedAt: now,\n+    };\n+    if (args.status === \"completed\" || args.status === \"failed\" || args.status === \"skipped\") {\n+      patch.completedAt = now;\n+    } else if (args.status === \"running\" && !run.startedAt) {\n+      patch.startedAt = now;\n+    }\n+    await ctx.db.patch(run._id, patch);\n+  },\n+});\n+\n+export const updateInstanceMetadata = internalMutation({\n+  args: {\n+    previewRunId: v.id(\"previewRuns\"),\n+    morphInstanceId: v.optional(v.string()),\n+    morphInstanceStoppedAt: v.optional(v.number()),\n+    clearStoppedAt: v.optional(v.boolean()),\n+  },\n+  handler: async (ctx, args) => {\n+    const run = await ctx.db.get(args.previewRunId);\n+    if (!run) {\n+      throw new Error(\"Preview run not found\");\n+    }\n+\n+    const patch: Record<string, unknown> = {\n+      updatedAt: Date.now(),\n+    };\n+\n+    if (\"morphInstanceId\" in args) {\n+      patch.morphInstanceId = args.morphInstanceId;\n+    }\n+\n+    if (args.clearStoppedAt) {\n+      patch.morphInstanceStoppedAt = undefined;\n+    } else if (\"morphInstanceStoppedAt\" in args) {\n+      patch.morphInstanceStoppedAt = args.morphInstanceStoppedAt;\n+    }\n+\n+    await ctx.db.patch(run._id, patch);\n+  },\n+});\n+\n+export const getById = internalQuery({\n+  args: {\n+    id: v.id(\"previewRuns\"),\n+  },\n+  handler: async (ctx, args) => {\n+    return await ctx.db.get(args.id);\n+  },\n+});\n+\n+export const getRunWithConfig = internalQuery({\n+  args: {\n+    previewRunId: v.id(\"previewRuns\"),\n+  },\n+  handler: async (ctx, args) => {\n+    const run = await ctx.db.get(args.previewRunId);\n+    if (!run) {\n+      return null;\n+    }\n+    const config = await ctx.db.get(run.previewConfigId);\n+    if (!config) {\n+      return null;\n+    }\n+    return { run, config } as const;\n+  },\n+});\n+\n+export const getByTaskRunId = internalQuery({\n+  args: {\n+    taskRunId: v.id(\"taskRuns\"),\n+  },\n+  handler: async (ctx, args) => {\n+    const run = await ctx.db\n+      .query(\"previewRuns\")\n+      .filter((q) => q.eq(q.field(\"taskRunId\"), args.taskRunId))\n+      .first();\n+    return run ?? null;\n+  },\n+});\n+\n+export const listRecentByConfig = internalQuery({\n+  args: {\n+    previewConfigId: v.id(\"previewConfigs\"),\n+    limit: v.optional(v.number()),\n+  },\n+  handler: async (ctx, args) => {\n+    const take = Math.max(1, Math.min(args.limit ?? 20, 100));\n+    const runs = await ctx.db\n+      .query(\"previewRuns\")\n+      .withIndex(\"by_config_status\", (q) =>\n+        q.eq(\"previewConfigId\", args.previewConfigId),\n+      )\n+      .order(\"desc\")\n+      .take(take);\n+    return runs;\n+  },\n+});\n+\n+export const listByConfigAndPr = internalQuery({\n+  args: {\n+    previewConfigId: v.id(\"previewConfigs\"),\n+    prNumber: v.number(),\n+    limit: v.optional(v.number()),\n+  },\n+  handler: async (ctx, args) => {\n+    const take = Math.max(1, Math.min(args.limit ?? 20, 100));\n+    const runs = await ctx.db\n+      .query(\"previewRuns\")\n+      .withIndex(\"by_config_pr\", (q) =>\n+        q.eq(\"previewConfigId\", args.previewConfigId).eq(\"prNumber\", args.prNumber),\n+      )\n+      .order(\"desc\")\n+      .take(take);\n+    return runs;\n+  },\n+});\n+\n+export const listByConfig = authQuery({\n+  args: {\n+    teamSlugOrId: v.string(),\n+    previewConfigId: v.id(\"previewConfigs\"),\n+    limit: v.optional(v.number()),\n+  },\n+  handler: async (ctx, args) => {\n+    const teamId = await resolveTeamIdLoose(ctx, args.teamSlugOrId);\n+    const config = await ctx.db.get(args.previewConfigId);\n+    if (!config || config.teamId !== teamId) {\n+      throw new Error(\"Preview configuration not found\");\n+    }\n+    const take = Math.max(1, Math.min(args.limit ?? 25, 100));\n+    const runs = await ctx.db\n+      .query(\"previewRuns\")\n+      .withIndex(\"by_team_created\", (q) =>\n+        q.eq(\"teamId\", teamId),\n+      )\n+      .filter((q) => q.eq(q.field(\"previewConfigId\"), config._id))\n+      .order(\"desc\")\n+      .take(take);\n+    return runs;\n+  },\n+});\ndiff --git a/packages/convex/convex/previewScreenshots.ts b/packages/convex/convex/previewScreenshots.ts\nnew file mode 100644\nindex 000000000..43c1abb18\n--- /dev/null\n+++ b/packages/convex/convex/previewScreenshots.ts\n@@ -0,0 +1,132 @@\n+import { v } from \"convex/values\";\n+import { internal } from \"./_generated/api\";\n+import { internalAction, internalMutation, internalQuery } from \"./_generated/server\";\n+\n+export const createScreenshotSet = internalMutation({\n+  args: {\n+    previewRunId: v.id(\"previewRuns\"),\n+    status: v.union(\n+      v.literal(\"completed\"),\n+      v.literal(\"failed\"),\n+      v.literal(\"skipped\"),\n+    ),\n+    commitSha: v.string(),\n+    error: v.optional(v.string()),\n+    images: v.array(\n+      v.object({\n+        storageId: v.id(\"_storage\"),\n+        mimeType: v.string(),\n+        fileName: v.optional(v.string()),\n+        commitSha: v.optional(v.string()),\n+        width: v.optional(v.number()),\n+        height: v.optional(v.number()),\n+      }),\n+    ),\n+  },\n+  handler: async (ctx, args) => {\n+    const run = await ctx.db.get(args.previewRunId);\n+    if (!run) {\n+      throw new Error(\"Preview run not found\");\n+    }\n+\n+    const now = Date.now();\n+    const screenshotSetId = await ctx.db.insert(\"previewScreenshotSets\", {\n+      previewRunId: args.previewRunId,\n+      status: args.status,\n+      commitSha: args.commitSha,\n+      capturedAt: now,\n+      error: args.error,\n+      images: args.images,\n+      createdAt: now,\n+      updatedAt: now,\n+    });\n+\n+    await ctx.db.patch(args.previewRunId, {\n+      screenshotSetId,\n+      updatedAt: now,\n+    });\n+\n+    return screenshotSetId;\n+  },\n+});\n+\n+export const getScreenshotSet = internalQuery({\n+  args: {\n+    screenshotSetId: v.id(\"previewScreenshotSets\"),\n+  },\n+  handler: async (ctx, args) => {\n+    const set = await ctx.db.get(args.screenshotSetId);\n+    return set ?? null;\n+  },\n+});\n+\n+export const getScreenshotSetByRun = internalQuery({\n+  args: {\n+    previewRunId: v.id(\"previewRuns\"),\n+  },\n+  handler: async (ctx, args) => {\n+    const run = await ctx.db.get(args.previewRunId);\n+    if (!run?.screenshotSetId) {\n+      return null;\n+    }\n+    return await ctx.db.get(run.screenshotSetId);\n+  },\n+});\n+\n+export const triggerGithubComment = internalAction({\n+  args: {\n+    previewRunId: v.id(\"previewRuns\"),\n+  },\n+  handler: async (ctx, args) => {\n+    console.log(\"[previewScreenshots] Triggering GitHub comment\", {\n+      previewRunId: args.previewRunId,\n+    });\n+\n+    const run = await ctx.runQuery(internal.previewRuns.getRunWithConfig, {\n+      previewRunId: args.previewRunId,\n+    });\n+\n+    if (!run?.run || !run.config) {\n+      console.error(\"[previewScreenshots] Run or config not found\", {\n+        previewRunId: args.previewRunId,\n+      });\n+      return;\n+    }\n+\n+    const { run: previewRun } = run;\n+\n+    if (!previewRun.screenshotSetId) {\n+      console.warn(\"[previewScreenshots] No screenshot set for run\", {\n+        previewRunId: args.previewRunId,\n+      });\n+      return;\n+    }\n+\n+    if (!previewRun.repoInstallationId) {\n+      console.error(\"[previewScreenshots] No installation ID for run\", {\n+        previewRunId: args.previewRunId,\n+      });\n+      return;\n+    }\n+\n+    console.log(\"[previewScreenshots] Posting GitHub comment\", {\n+      previewRunId: args.previewRunId,\n+      repoFullName: previewRun.repoFullName,\n+      prNumber: previewRun.prNumber,\n+      screenshotSetId: previewRun.screenshotSetId,\n+    });\n+\n+    // Post GitHub comment with screenshots\n+    await ctx.runAction(internal.github_pr_comments.postPreviewComment, {\n+      installationId: previewRun.repoInstallationId,\n+      repoFullName: previewRun.repoFullName,\n+      prNumber: previewRun.prNumber,\n+      screenshotSetId: previewRun.screenshotSetId,\n+      previewRunId: args.previewRunId,\n+    });\n+\n+    console.log(\"[previewScreenshots] GitHub comment posted successfully\", {\n+      previewRunId: args.previewRunId,\n+    });\n+  },\n+});\ndiff --git a/packages/convex/convex/preview_jobs.ts b/packages/convex/convex/preview_jobs.ts\nnew file mode 100644\nindex 000000000..476334596\n--- /dev/null\n+++ b/packages/convex/convex/preview_jobs.ts\n@@ -0,0 +1,167 @@\n+import {\n+  createMorphCloudClient,\n+  stopInstanceInstanceInstanceIdDelete,\n+} from \"@cmux/morphcloud-openapi-client\";\n+import { v } from \"convex/values\";\n+import { internal } from \"./_generated/api\";\n+import { internalAction } from \"./_generated/server\";\n+import { runPreviewJob } from \"./preview_jobs_worker\";\n+\n+export const stopPreviewInstance = internalAction({\n+  args: {\n+    previewRunId: v.id(\"previewRuns\"),\n+  },\n+  handler: async (ctx, { previewRunId }) => {\n+    const previewRun = await ctx.runQuery(internal.previewRuns.getById, {\n+      id: previewRunId,\n+    });\n+\n+    if (!previewRun?.morphInstanceId) {\n+      return;\n+    }\n+    if (previewRun.morphInstanceStoppedAt) {\n+      console.log(\"[preview-jobs] Morph instance already stopped\", {\n+        previewRunId: previewRun._id,\n+        morphInstanceId: previewRun.morphInstanceId,\n+      });\n+      return;\n+    }\n+    const morphApiKey = process.env.MORPH_API_KEY;\n+    if (!morphApiKey) {\n+      console.warn(\n+        \"[preview-jobs] Cannot stop Morph instance without MORPH_API_KEY\",\n+        {\n+          previewRunId: previewRun._id,\n+          morphInstanceId: previewRun.morphInstanceId,\n+        }\n+      );\n+      return;\n+    }\n+\n+    const morphClient = createMorphCloudClient({ auth: morphApiKey });\n+    const stoppedAt = Date.now();\n+\n+    try {\n+      await stopInstanceInstanceInstanceIdDelete({\n+        client: morphClient,\n+        path: { instance_id: previewRun.morphInstanceId },\n+      });\n+    } catch (error) {\n+      console.error(\"[preview-jobs] Failed to stop Morph instance\", {\n+        previewRunId: previewRun._id,\n+        morphInstanceId: previewRun.morphInstanceId,\n+        error,\n+      });\n+    }\n+\n+    try {\n+      await ctx.runMutation(internal.previewRuns.updateInstanceMetadata, {\n+        previewRunId: previewRun._id,\n+        morphInstanceStoppedAt: stoppedAt,\n+      });\n+    } catch (error) {\n+      console.error(\"[preview-jobs] Failed to record Morph instance stop time\", {\n+        previewRunId: previewRun._id,\n+        error,\n+      });\n+    }\n+\n+    if (previewRun.taskRunId) {\n+      try {\n+        await ctx.runMutation(internal.taskRuns.updateVSCodeMetadataInternal, {\n+          taskRunId: previewRun.taskRunId,\n+          vscode: {\n+            provider: \"morph\",\n+            status: \"stopped\",\n+            containerName: previewRun.morphInstanceId,\n+            stoppedAt,\n+          },\n+          networking: [],\n+        });\n+      } catch (error) {\n+        console.error(\n+          \"[preview-jobs] Failed to update task run VSCode metadata after stop\",\n+          {\n+            previewRunId: previewRun._id,\n+            taskRunId: previewRun.taskRunId,\n+            error,\n+          }\n+        );\n+      }\n+    }\n+  },\n+});\n+\n+export const requestDispatch = internalAction({\n+  args: {\n+    previewRunId: v.id(\"previewRuns\"),\n+  },\n+  handler: async (ctx, args) => {\n+    console.log(\"[preview-jobs] Starting dispatch process\", {\n+      previewRunId: args.previewRunId,\n+    });\n+\n+    const payload = await ctx.runQuery(internal.previewRuns.getRunWithConfig, {\n+      previewRunId: args.previewRunId,\n+    });\n+\n+    if (!payload?.run || !payload.config) {\n+      console.warn(\"[preview-jobs] Missing run/config for dispatch\", args);\n+      return;\n+    }\n+\n+    console.log(\"[preview-jobs] Preview run details\", {\n+      previewRunId: args.previewRunId,\n+      repoFullName: payload.run.repoFullName,\n+      prNumber: payload.run.prNumber,\n+      headSha: payload.run.headSha?.slice(0, 7),\n+      status: payload.run.status,\n+    });\n+\n+    try {\n+      await ctx.runMutation(internal.previewRuns.markDispatched, {\n+        previewRunId: args.previewRunId,\n+      });\n+      console.log(\"[preview-jobs] Marked as dispatched\", {\n+        previewRunId: args.previewRunId,\n+      });\n+    } catch (error) {\n+      console.error(\"[preview-jobs] Failed to mark preview run dispatched\", {\n+        previewRunId: args.previewRunId,\n+        error,\n+      });\n+      return;\n+    }\n+\n+    console.log(\"[preview-jobs] Scheduling preview job execution\", {\n+      previewRunId: args.previewRunId,\n+    });\n+\n+    try {\n+      await ctx.scheduler.runAfter(\n+        0,\n+        internal.preview_jobs.executePreviewJob,\n+        {\n+          previewRunId: args.previewRunId,\n+        },\n+      );\n+      console.log(\"[preview-jobs] Preview job scheduled\", {\n+        previewRunId: args.previewRunId,\n+      });\n+    } catch (error) {\n+      console.error(\"[preview-jobs] Failed to schedule preview job\", {\n+        previewRunId: args.previewRunId,\n+        error,\n+      });\n+    }\n+  },\n+});\n+\n+export const executePreviewJob = internalAction({\n+  args: {\n+    previewRunId: v.id(\"previewRuns\"),\n+  },\n+  handler: async (ctx, args) => {\n+    await runPreviewJob(ctx, args.previewRunId);\n+  },\n+});\ndiff --git a/packages/convex/convex/preview_jobs_http.ts b/packages/convex/convex/preview_jobs_http.ts\nnew file mode 100644\nindex 000000000..0503f3a98\n--- /dev/null\n+++ b/packages/convex/convex/preview_jobs_http.ts\n@@ -0,0 +1,387 @@\n+import { env } from \"../_shared/convex-env\";\n+import { internal } from \"./_generated/api\";\n+import type { Doc, Id } from \"./_generated/dataModel\";\n+import { httpAction } from \"./_generated/server\";\n+import { runPreviewJob } from \"./preview_jobs_worker\";\n+import { getWorkerAuth } from \"./users/utils/getWorkerAuth\";\n+\n+function jsonResponse(body: unknown, status = 200): Response {\n+  return new Response(JSON.stringify(body), {\n+    status,\n+    headers: { \"Content-Type\": \"application/json\" },\n+  });\n+}\n+\n+export const dispatchPreviewJob = httpAction(async (ctx, req) => {\n+  const workerAuth = await getWorkerAuth(req, { loggerPrefix: \"[preview-jobs-http]\" });\n+  if (!workerAuth) {\n+    console.error(\"[preview-jobs-http] Unauthorized dispatch request\");\n+    return jsonResponse({ error: \"Unauthorized\" }, 401);\n+  }\n+\n+  let body: { previewRunId?: string };\n+  try {\n+    body = await req.json();\n+  } catch {\n+    return jsonResponse({ error: \"Invalid JSON\" }, 400);\n+  }\n+\n+  if (!body.previewRunId) {\n+    return jsonResponse({ error: \"previewRunId is required\" }, 400);\n+  }\n+\n+  const previewRunId = body.previewRunId as Id<\"previewRuns\">;\n+  console.log(\"[preview-jobs-http] Dispatching preview job\", {\n+    previewRunId,\n+  });\n+\n+  try {\n+    await ctx.runMutation(internal.previewRuns.markDispatched, {\n+      previewRunId,\n+    });\n+  } catch (error) {\n+    console.error(\"[preview-jobs-http] Failed to mark run dispatched\", {\n+      previewRunId,\n+      error,\n+    });\n+    return jsonResponse({ error: \"Failed to mark run dispatched\" }, 500);\n+  }\n+\n+  try {\n+    await runPreviewJob(ctx, previewRunId);\n+    return jsonResponse({ success: true }, 200);\n+  } catch (error) {\n+    console.error(\"[preview-jobs-http] Preview job execution failed\", {\n+      previewRunId,\n+      error,\n+    });\n+    return jsonResponse(\n+      {\n+        error: \"Failed to execute preview job\",\n+        message:\n+          error instanceof Error ? error.message : String(error ?? \"Unknown error\"),\n+      },\n+      500,\n+    );\n+  }\n+});\n+\n+/**\n+ * HTTP action for www API to update preview run status\n+ */\n+export const updatePreviewStatus = httpAction(async (ctx, req) => {\n+  const auth = await getWorkerAuth(req, { loggerPrefix: \"[preview-jobs-http]\" });\n+  if (!auth) {\n+    console.error(\"[preview-jobs-http] Unauthorized request\");\n+    return jsonResponse({ error: \"Unauthorized\" }, 401);\n+  }\n+\n+  let body: unknown;\n+  try {\n+    body = await req.json();\n+  } catch {\n+    return jsonResponse({ error: \"Invalid JSON\" }, 400);\n+  }\n+\n+  if (\n+    !body ||\n+    typeof body !== \"object\" ||\n+    !(\"previewRunId\" in body) ||\n+    !(\"status\" in body)\n+  ) {\n+    return jsonResponse({ error: \"Missing required fields\" }, 400);\n+  }\n+\n+  const { previewRunId, status, stateReason, screenshotSetId } = body as {\n+    previewRunId: string;\n+    status: string;\n+    stateReason?: string;\n+    screenshotSetId?: string;\n+  };\n+\n+  console.log(\"[preview-jobs-http] Updating preview run status\", {\n+    previewRunId,\n+    status,\n+  });\n+\n+  // Validate status\n+  if (![\"running\", \"completed\", \"failed\", \"skipped\"].includes(status)) {\n+    return jsonResponse({ error: \"Invalid status value\" }, 400);\n+  }\n+\n+  try {\n+    await ctx.runMutation(internal.previewRuns.updateStatus, {\n+      previewRunId: previewRunId as Id<\"previewRuns\">,\n+      status: status as \"running\" | \"completed\" | \"failed\" | \"skipped\",\n+      stateReason,\n+      screenshotSetId: screenshotSetId as Id<\"previewScreenshotSets\"> | undefined,\n+    });\n+\n+    return jsonResponse({ success: true });\n+  } catch (error) {\n+    console.error(\"[preview-jobs-http] Failed to update status\", {\n+      previewRunId,\n+      error,\n+    });\n+    return jsonResponse({ error: \"Failed to update status\" }, 500);\n+  }\n+});\n+\n+/**\n+ * HTTP action for www API to create screenshot set\n+ */\n+export const createScreenshotSet = httpAction(async (ctx, req) => {\n+  const auth = await getWorkerAuth(req, { loggerPrefix: \"[preview-jobs-http]\" });\n+  if (!auth) {\n+    console.error(\"[preview-jobs-http] Unauthorized request\");\n+    return jsonResponse({ error: \"Unauthorized\" }, 401);\n+  }\n+\n+  let body: unknown;\n+  try {\n+    body = await req.json();\n+  } catch {\n+    return jsonResponse({ error: \"Invalid JSON\" }, 400);\n+  }\n+\n+  if (\n+    !body ||\n+    typeof body !== \"object\" ||\n+    !(\"previewRunId\" in body) ||\n+    !(\"status\" in body) ||\n+    !(\"commitSha\" in body)\n+  ) {\n+    return jsonResponse({ error: \"Missing required fields\" }, 400);\n+  }\n+\n+  const { previewRunId, status, commitSha, error, images } = body as {\n+    previewRunId: string;\n+    status: string;\n+    commitSha: string;\n+    error?: string;\n+    images: Array<{\n+      storageId: string;\n+      mimeType: string;\n+      fileName?: string;\n+      commitSha?: string;\n+      width?: number;\n+      height?: number;\n+    }>;\n+  };\n+\n+  console.log(\"[preview-jobs-http] Creating screenshot set\", {\n+    previewRunId,\n+    status,\n+    imageCount: images?.length ?? 0,\n+  });\n+\n+  // Validate status\n+  if (![\"completed\", \"failed\", \"skipped\"].includes(status)) {\n+    return jsonResponse({ error: \"Invalid status value\" }, 400);\n+  }\n+\n+  try {\n+    const screenshotSetId = await ctx.runMutation(\n+      internal.previewScreenshots.createScreenshotSet,\n+      {\n+        previewRunId: previewRunId as Id<\"previewRuns\">,\n+        status: status as \"completed\" | \"failed\" | \"skipped\",\n+        commitSha,\n+        error,\n+        images: (images ?? []).map((img) => ({\n+          storageId: img.storageId as Id<\"_storage\">,\n+          mimeType: img.mimeType,\n+          fileName: img.fileName,\n+          commitSha: img.commitSha,\n+          width: img.width,\n+          height: img.height,\n+        })),\n+      }\n+    );\n+\n+    return jsonResponse({ success: true, screenshotSetId });\n+  } catch (err) {\n+    console.error(\"[preview-jobs-http] Failed to create screenshot set\", {\n+      previewRunId,\n+      error: err,\n+    });\n+    return jsonResponse({ error: \"Failed to create screenshot set\" }, 500);\n+  }\n+});\n+\n+/**\n+ * HTTP action called by worker when preview job screenshots are complete\n+ * Copies screenshots from task run to preview run and posts GitHub comment\n+ */\n+export const completePreviewJob = httpAction(async (ctx, req) => {\n+  const workerAuth = await getWorkerAuth(req, { loggerPrefix: \"[preview-jobs-http]\" });\n+  const authHeader = req.headers.get(\"authorization\") ?? \"\";\n+  const [, bearerToken] = authHeader.split(\" \");\n+  const bearerAuthorized =\n+    bearerToken && bearerToken === env.CMUX_TASK_RUN_JWT_SECRET;\n+\n+  if (!workerAuth && !bearerAuthorized) {\n+    console.error(\"[preview-jobs-http] Unauthorized complete request\");\n+    return jsonResponse({ error: \"Unauthorized\" }, 401);\n+  }\n+\n+  let body: unknown;\n+  try {\n+    body = await req.json();\n+  } catch {\n+    return jsonResponse({ error: \"Invalid JSON\" }, 400);\n+  }\n+\n+  if (\n+    !body ||\n+    typeof body !== \"object\" ||\n+    !(\"taskRunId\" in body)\n+  ) {\n+    return jsonResponse({ error: \"Missing taskRunId\" }, 400);\n+  }\n+\n+  const { taskRunId } = body;\n+\n+  console.log(\"[preview-jobs-http] Completing preview job\", {\n+    taskRunId,\n+  });\n+\n+  let previewRun: Doc<\"previewRuns\"> | null = null;\n+  let shouldStopInstance = false;\n+\n+  try {\n+    // Find preview run by taskRunId\n+    previewRun = await ctx.runQuery(internal.previewRuns.getByTaskRunId, {\n+      taskRunId: taskRunId as Id<\"taskRuns\">,\n+    });\n+\n+    if (!previewRun) {\n+      console.error(\"[preview-jobs-http] Preview run not found for task run\", {\n+        taskRunId,\n+      });\n+      return jsonResponse({ error: \"Preview run not found\" }, 404);\n+    }\n+    shouldStopInstance = true;\n+\n+    // Get task run to check for screenshots\n+    const taskRun = await ctx.runQuery(internal.taskRuns.getById, {\n+      id: taskRunId as Id<\"taskRuns\">,\n+    });\n+\n+    if (!taskRun) {\n+      console.error(\"[preview-jobs-http] Task run not found\", {\n+        taskRunId,\n+      });\n+      return jsonResponse({ error: \"Task run not found\" }, 404);\n+    }\n+\n+    if (!taskRun.latestScreenshotSetId) {\n+      console.log(\"[preview-jobs-http] No screenshots found for task run\", {\n+        taskRunId,\n+      });\n+      await ctx.runMutation(internal.previewRuns.updateStatus, {\n+        previewRunId: previewRun._id,\n+        status: \"skipped\",\n+        stateReason: \"No screenshots available\",\n+      });\n+      return jsonResponse({\n+        success: true,\n+        skipped: true,\n+        reason: \"No screenshots available\"\n+      });\n+    }\n+\n+    // Get the task run screenshot set\n+    const taskScreenshotSet = await ctx.runQuery(\n+      internal.github_pr_queries.getScreenshotSet,\n+      {\n+        screenshotSetId: taskRun.latestScreenshotSetId,\n+      }\n+    );\n+\n+    if (!taskScreenshotSet) {\n+      console.error(\"[preview-jobs-http] Screenshot set not found\", {\n+        taskRunId,\n+        screenshotSetId: taskRun.latestScreenshotSetId,\n+      });\n+      return jsonResponse({ error: \"Screenshot set not found\" }, 404);\n+    }\n+\n+    console.log(\"[preview-jobs-http] Found screenshot set for task run\", {\n+      taskRunId,\n+      previewRunId: previewRun._id,\n+      screenshotSetId: taskRun.latestScreenshotSetId,\n+      imageCount: taskScreenshotSet.images.length,\n+    });\n+\n+    // Post GitHub comment if we have installation ID\n+    if (previewRun.repoInstallationId) {\n+      const commentResult = await ctx.runAction(\n+        internal.github_pr_comments.postPreviewCommentWithTaskScreenshots,\n+        {\n+          installationId: previewRun.repoInstallationId,\n+          repoFullName: previewRun.repoFullName,\n+          prNumber: previewRun.prNumber,\n+          taskRunId: taskRunId as Id<\"taskRuns\">,\n+          previewRunId: previewRun._id,\n+        }\n+      );\n+\n+      if (commentResult.ok) {\n+        console.log(\"[preview-jobs-http] Successfully posted GitHub comment\", {\n+          taskRunId,\n+          previewRunId: previewRun._id,\n+          commentUrl: commentResult.commentUrl,\n+        });\n+        return jsonResponse({\n+          success: true,\n+          commentUrl: commentResult.commentUrl,\n+        });\n+      } else {\n+        console.error(\"[preview-jobs-http] Failed to post GitHub comment\", {\n+          taskRunId,\n+          previewRunId: previewRun._id,\n+          error: commentResult.error,\n+        });\n+        return jsonResponse({\n+          success: false,\n+          error: `Failed to post GitHub comment: ${commentResult.error}`,\n+        }, 500);\n+      }\n+    } else {\n+      console.log(\"[preview-jobs-http] No GitHub installation ID, skipping comment\", {\n+        taskRunId,\n+        previewRunId: previewRun._id,\n+      });\n+\n+      // Update preview run status to completed even without posting comment\n+      await ctx.runMutation(internal.previewRuns.updateStatus, {\n+        previewRunId: previewRun._id,\n+        status: \"completed\",\n+      });\n+\n+      return jsonResponse({\n+        success: true,\n+        skipped: true,\n+        reason: \"No GitHub installation ID\",\n+      });\n+    }\n+  } catch (error) {\n+    console.error(\"[preview-jobs-http] Failed to complete preview job\", {\n+      taskRunId,\n+      error,\n+    });\n+    return jsonResponse({\n+      error: \"Failed to complete preview job\",\n+      message: error instanceof Error ? error.message : String(error),\n+    }, 500);\n+  } finally {\n+    if (shouldStopInstance && previewRun) {\n+      await ctx.scheduler.runAfter(\n+        30 * 60 * 1000,\n+        internal.preview_jobs.stopPreviewInstance,\n+        { previewRunId: previewRun._id },\n+      );\n+    }\n+  }\n+});\ndiff --git a/packages/convex/convex/preview_jobs_worker.ts b/packages/convex/convex/preview_jobs_worker.ts\nnew file mode 100644\nindex 000000000..62d3f775f\n--- /dev/null\n+++ b/packages/convex/convex/preview_jobs_worker.ts\n@@ -0,0 +1,1280 @@\n+import {\n+  createMorphCloudClient,\n+  startInstanceInstancePost,\n+  getInstanceInstanceInstanceIdGet,\n+  execInstanceInstanceIdExecPost,\n+  stopInstanceInstanceInstanceIdDelete,\n+  type InstanceModel,\n+} from \"@cmux/morphcloud-openapi-client\";\n+import type { WorkerRunTaskScreenshots } from \"@cmux/shared\";\n+import { SignJWT } from \"jose\";\n+import { env } from \"../_shared/convex-env\";\n+import { fetchInstallationAccessToken } from \"../_shared/githubApp\";\n+import { stringToBase64 } from \"../_shared/encoding\";\n+import { internal } from \"./_generated/api\";\n+import type { Id } from \"./_generated/dataModel\";\n+import type { ActionCtx } from \"./_generated/server\";\n+\n+const sliceOutput = (value?: string | null, length = 200): string | undefined =>\n+  value?.slice(0, length);\n+\n+const singleQuote = (value: string): string =>\n+  `'${value.replace(/'/g, \"'\\\\''\")}'`;\n+\n+const WORKER_SOCKET_TIMEOUT_MS = 30_000;\n+\n+const resolveConvexUrl = (): string | null => {\n+  const explicitUrl = process.env.CONVEX_SITE_URL || process.env.CONVEX_URL || process.env.CONVEX_CLOUD_URL;\n+  if (explicitUrl) {\n+    return explicitUrl.replace(/\\/$/, \"\");\n+  }\n+  const deployment = process.env.CONVEX_DEPLOYMENT;\n+  if (deployment) {\n+    return `https://${deployment}.convex.site`;\n+  }\n+  return null;\n+};\n+\n+const delay = (ms: number): Promise<void> => new Promise((resolve) => setTimeout(resolve, ms));\n+\n+const formatWorkerSocketError = (error: unknown): string => {\n+  if (!error) {\n+    return \"Unknown worker socket error\";\n+  }\n+  if (error instanceof Error) {\n+    return error.message;\n+  }\n+  if (typeof error === \"string\") {\n+    return error;\n+  }\n+  if (typeof error === \"object\") {\n+    const errorMessage =\n+      \"message\" in error && typeof (error as { message?: unknown }).message === \"string\"\n+        ? (error as { message?: string }).message\n+        : undefined;\n+\n+    if (errorMessage) {\n+      return errorMessage;\n+    }\n+\n+    try {\n+      return JSON.stringify(error);\n+    } catch {\n+      return String(error);\n+    }\n+  }\n+  return String(error);\n+};\n+\n+async function waitForWorkerHealth({\n+  workerUrl,\n+  previewRunId,\n+  timeoutMs = 60_000,\n+}: {\n+  workerUrl: string;\n+  previewRunId: Id<\"previewRuns\">;\n+  timeoutMs?: number;\n+}): Promise<void> {\n+  const start = Date.now();\n+  while (Date.now() - start < timeoutMs) {\n+    try {\n+      const response = await fetch(`${workerUrl}/health`);\n+      if (response.ok) {\n+        const payload = await response.json();\n+        console.log(\"[preview-jobs] Worker health check ok\", {\n+          previewRunId,\n+          mainServerConnected: payload?.mainServerConnected,\n+        });\n+        if (!payload || payload.status === \"healthy\") {\n+          return;\n+        }\n+      } else {\n+        console.warn(\"[preview-jobs] Worker health check failed\", {\n+          previewRunId,\n+          status: response.status,\n+        });\n+      }\n+    } catch (error) {\n+      console.warn(\"[preview-jobs] Worker health fetch error\", {\n+        previewRunId,\n+        error: error instanceof Error ? error.message : String(error),\n+      });\n+    }\n+    await delay(2_000);\n+  }\n+  throw new Error(\"Worker did not become healthy before timeout\");\n+}\n+\n+async function triggerWorkerScreenshotCollection({\n+  workerUrl,\n+  payload,\n+  previewRunId,\n+  maxAttempts = 3,\n+}: {\n+  workerUrl: string;\n+  payload: WorkerRunTaskScreenshots;\n+  previewRunId: Id<\"previewRuns\">;\n+  maxAttempts?: number;\n+}): Promise<void> {\n+  await waitForWorkerHealth({ workerUrl, previewRunId });\n+  let attempt = 0;\n+  let lastError: Error | null = null;\n+  while (attempt < maxAttempts) {\n+    attempt += 1;\n+    try {\n+      console.log(\"[preview-jobs] Triggering screenshot collection via HTTP\", {\n+        previewRunId,\n+        attempt,\n+        url: `${workerUrl}/api/run-task-screenshots`,\n+      });\n+\n+      const response = await fetch(`${workerUrl}/api/run-task-screenshots`, {\n+        method: \"POST\",\n+        headers: {\n+          \"Content-Type\": \"application/json\",\n+        },\n+        body: JSON.stringify(payload),\n+        signal: AbortSignal.timeout(WORKER_SOCKET_TIMEOUT_MS),\n+      });\n+\n+      if (!response.ok) {\n+        const errorText = await response.text().catch(() => \"Unknown error\");\n+        throw new Error(\n+          `Worker returned ${response.status}: ${errorText}`\n+        );\n+      }\n+\n+      const result = await response.json();\n+\n+      if (result.error) {\n+        throw new Error(formatWorkerSocketError(result.error));\n+      }\n+\n+      console.log(\"[preview-jobs] Screenshot collection triggered successfully\", {\n+        previewRunId,\n+        attempt,\n+      });\n+      return;\n+    } catch (error) {\n+      lastError = error instanceof Error ? error : new Error(String(error));\n+      console.warn(\"[preview-jobs] Screenshot trigger attempt failed\", {\n+        previewRunId,\n+        attempt,\n+        maxAttempts,\n+        error: lastError.message,\n+      });\n+      if (attempt < maxAttempts) {\n+        await delay(5_000);\n+      }\n+    }\n+  }\n+  throw lastError ?? new Error(\"Unknown worker HTTP error\");\n+}\n+\n+async function repoHasCommit({\n+  morphClient,\n+  instanceId,\n+  repoDir,\n+  commitSha,\n+  previewRunId,\n+}: {\n+  morphClient: ReturnType<typeof createMorphCloudClient>;\n+  instanceId: string;\n+  repoDir: string;\n+  commitSha: string;\n+  previewRunId: Id<\"previewRuns\">;\n+}): Promise<boolean> {\n+  const response = await execInstanceInstanceIdExecPost({\n+    client: morphClient,\n+    path: { instance_id: instanceId },\n+    body: {\n+      command: [\"git\", \"-C\", repoDir, \"cat-file\", \"-e\", `${commitSha}^{commit}`],\n+    },\n+  });\n+\n+  if (response.error) {\n+    console.warn(\"[preview-jobs] Failed to check commit availability\", {\n+      previewRunId,\n+      commitSha,\n+      error: response.error,\n+    });\n+    return false;\n+  }\n+\n+  return response.data?.exit_code === 0;\n+}\n+\n+async function ensureCommitAvailable({\n+  morphClient,\n+  instanceId,\n+  repoDir,\n+  commitSha,\n+  prNumber,\n+  previewRunId,\n+  headRepoCloneUrl,\n+  headRef,\n+}: {\n+  morphClient: ReturnType<typeof createMorphCloudClient>;\n+  instanceId: string;\n+  repoDir: string;\n+  commitSha: string;\n+  prNumber: number;\n+  previewRunId: Id<\"previewRuns\">;\n+  headRepoCloneUrl?: string;\n+  headRef?: string;\n+}): Promise<void> {\n+  if (await repoHasCommit({ morphClient, instanceId, repoDir, commitSha, previewRunId })) {\n+    return;\n+  }\n+\n+  console.warn(\"[preview-jobs] Commit missing after initial fetch, attempting targeted fetches\", {\n+    previewRunId,\n+    commitSha,\n+    prNumber,\n+    headRepoCloneUrl,\n+    headRef,\n+  });\n+\n+  const fetchAttempts: Array<{\n+    description: string;\n+    command: string[];\n+  }> = [\n+    {\n+      description: \"fetch commit by sha\",\n+      command: [\"git\", \"-C\", repoDir, \"fetch\", \"origin\", commitSha],\n+    },\n+    {\n+      description: \"fetch PR head ref\",\n+      command: [\n+        \"git\",\n+        \"-C\",\n+        repoDir,\n+        \"fetch\",\n+        \"origin\",\n+        `+refs/pull/${prNumber}/head:refs/cmux/preview/pull/${prNumber}`,\n+      ],\n+    },\n+  ];\n+\n+  // If PR is from a fork, add fork fetch as the highest priority\n+  if (headRepoCloneUrl && headRef) {\n+    fetchAttempts.unshift({\n+      description: \"Check the git diff and look for frontend changes where screenshots could add good context.\",\n+      command: [\n+        \"git\",\n+        \"-C\",\n+        repoDir,\n+        \"fetch\",\n+        headRepoCloneUrl,\n+        `${headRef}:refs/cmux/preview/fork/${prNumber}`,\n+      ],\n+    });\n+  }\n+\n+  for (const attempt of fetchAttempts) {\n+    console.log(\"[preview-jobs] Targeted fetch attempt\", {\n+      previewRunId,\n+      commitSha,\n+      prNumber,\n+      description: attempt.description,\n+    });\n+\n+    const fetchResponse = await execInstanceInstanceIdExecPost({\n+      client: morphClient,\n+      path: { instance_id: instanceId },\n+      body: {\n+        command: attempt.command,\n+      },\n+    });\n+\n+    if (fetchResponse.error || fetchResponse.data?.exit_code !== 0) {\n+      console.warn(\"[preview-jobs] Targeted fetch failed\", {\n+        previewRunId,\n+        commitSha,\n+        prNumber,\n+        description: attempt.description,\n+        exitCode: fetchResponse.data?.exit_code,\n+        stderr: sliceOutput(fetchResponse.data?.stderr),\n+        stdout: sliceOutput(fetchResponse.data?.stdout),\n+        error: fetchResponse.error,\n+      });\n+      continue;\n+    }\n+\n+    if (await repoHasCommit({ morphClient, instanceId, repoDir, commitSha, previewRunId })) {\n+      console.log(\"[preview-jobs] Commit available after targeted fetch\", {\n+        previewRunId,\n+        commitSha,\n+        prNumber,\n+        description: attempt.description,\n+      });\n+      return;\n+    }\n+  }\n+\n+  throw new Error(\n+    `Commit ${commitSha} is unavailable after targeted fetch attempts for PR #${prNumber}`,\n+  );\n+}\n+\n+async function stashLocalChanges({\n+  morphClient,\n+  instanceId,\n+  repoDir,\n+  previewRunId,\n+  headSha,\n+}: {\n+  morphClient: ReturnType<typeof createMorphCloudClient>;\n+  instanceId: string;\n+  repoDir: string;\n+  previewRunId: Id<\"previewRuns\">;\n+  headSha: string;\n+}): Promise<void> {\n+  console.log(\"[preview-jobs] Stashing local changes before checkout\", {\n+    previewRunId,\n+    repoDir,\n+    headSha,\n+  });\n+\n+  const stashResponse = await execInstanceInstanceIdExecPost({\n+    client: morphClient,\n+    path: { instance_id: instanceId },\n+    body: {\n+      command: [\n+        \"git\",\n+        \"-C\",\n+        repoDir,\n+        \"stash\",\n+        \"push\",\n+        \"--include-untracked\",\n+        \"--message\",\n+        `cmux-preview auto-stash before checkout ${headSha}`,\n+      ],\n+    },\n+  });\n+\n+  if (stashResponse.error || !stashResponse.data) {\n+    console.error(\"[preview-jobs] Failed to stash changes before checkout\", {\n+      previewRunId,\n+      headSha,\n+      error: stashResponse.error,\n+    });\n+    throw new Error(\"Failed to stash local changes before checkout\");\n+  }\n+\n+  const { exit_code: exitCode, stdout, stderr } = stashResponse.data;\n+  if (exitCode !== 0) {\n+    console.error(\"[preview-jobs] Stash command failed\", {\n+      previewRunId,\n+      headSha,\n+      exitCode,\n+      stdout: sliceOutput(stdout),\n+      stderr: sliceOutput(stderr),\n+    });\n+    throw new Error(\n+      `Failed to stash local changes before checkout (exit ${exitCode}): stderr=\"${sliceOutput(\n+        stderr,\n+      )}\" stdout=\"${sliceOutput(stdout)}\"`,\n+    );\n+  }\n+\n+  console.log(\"[preview-jobs] Stash completed before checkout\", {\n+    previewRunId,\n+    headSha,\n+    stdout: sliceOutput(stdout),\n+    stderr: sliceOutput(stderr),\n+  });\n+}\n+\n+async function waitForInstanceReady(\n+  morphClient: ReturnType<typeof createMorphCloudClient>,\n+  instanceId: string,\n+  readinessTimeoutMs = 5 * 60 * 1000,\n+): Promise<InstanceModel> {\n+  const start = Date.now();\n+  while (true) {\n+    const response = await getInstanceInstanceInstanceIdGet({\n+      client: morphClient,\n+      path: { instance_id: instanceId },\n+    });\n+\n+    if (response.error) {\n+      throw new Error(`Failed to get instance status: ${JSON.stringify(response.error)}`);\n+    }\n+\n+    const instance = response.data;\n+    if (!instance) {\n+      throw new Error(\"Instance data missing from response\");\n+    }\n+\n+    if (instance.status === \"ready\") {\n+      return instance;\n+    }\n+    if (instance.status === \"error\") {\n+      throw new Error(\"Morph instance entered error state\");\n+    }\n+    if (Date.now() - start > readinessTimeoutMs) {\n+      throw new Error(\"Morph instance did not become ready before timeout\");\n+    }\n+    await new Promise((resolve) => setTimeout(resolve, 1_000));\n+  }\n+}\n+\n+async function startMorphInstance(\n+  morphClient: ReturnType<typeof createMorphCloudClient>,\n+  options: {\n+    snapshotId: string;\n+    metadata?: Record<string, string>;\n+    ttlSeconds?: number;\n+    ttlAction?: \"stop\" | \"pause\";\n+    readinessTimeoutMs?: number;\n+  },\n+): Promise<InstanceModel> {\n+  const response = await startInstanceInstancePost({\n+    client: morphClient,\n+    query: {\n+      snapshot_id: options.snapshotId,\n+    },\n+    body: {\n+      metadata: options.metadata,\n+      ttl_seconds: options.ttlSeconds,\n+      ttl_action: options.ttlAction,\n+    },\n+  });\n+\n+  if (response.error) {\n+    throw new Error(`Failed to start instance: ${JSON.stringify(response.error)}`);\n+  }\n+\n+  const instance = response.data;\n+  if (!instance) {\n+    throw new Error(\"Instance data missing from start response\");\n+  }\n+\n+  return await waitForInstanceReady(\n+    morphClient,\n+    instance.id,\n+    options.readinessTimeoutMs,\n+  );\n+}\n+\n+async function stopMorphInstance(\n+  morphClient: ReturnType<typeof createMorphCloudClient>,\n+  instanceId: string,\n+) {\n+  await stopInstanceInstanceInstanceIdDelete({\n+    client: morphClient,\n+    path: { instance_id: instanceId },\n+  });\n+}\n+\n+async function ensureTmuxSession({\n+  morphClient,\n+  instanceId,\n+  repoDir,\n+  previewRunId,\n+}: {\n+  morphClient: ReturnType<typeof createMorphCloudClient>;\n+  instanceId: string;\n+  repoDir: string;\n+  previewRunId: Id<\"previewRuns\">;\n+}): Promise<void> {\n+  const sessionCmd = [\n+    \"bash\",\n+    \"-lc\",\n+    `tmux has-session -t cmux 2>/dev/null || tmux new-session -d -s cmux -c ${singleQuote(repoDir)}`,\n+  ];\n+  const response = await execInstanceInstanceIdExecPost({\n+    client: morphClient,\n+    path: { instance_id: instanceId },\n+    body: { command: sessionCmd },\n+  });\n+  if (response.error || response.data?.exit_code !== 0) {\n+    console.warn(\"[preview-jobs] Failed to ensure tmux session\", {\n+      previewRunId,\n+      exitCode: response.data?.exit_code,\n+      stdout: sliceOutput(response.data?.stdout),\n+      stderr: sliceOutput(response.data?.stderr),\n+      error: response.error,\n+    });\n+  }\n+}\n+\n+async function runScriptInTmuxWindow({\n+  morphClient,\n+  instanceId,\n+  repoDir,\n+  windowName,\n+  scriptContent,\n+  previewRunId,\n+}: {\n+  morphClient: ReturnType<typeof createMorphCloudClient>;\n+  instanceId: string;\n+  repoDir: string;\n+  windowName: string;\n+  scriptContent: string;\n+  previewRunId: Id<\"previewRuns\">;\n+}): Promise<void> {\n+  const trimmed = scriptContent.trim();\n+  if (!trimmed) {\n+    return;\n+  }\n+\n+  const scriptBase64 = stringToBase64(trimmed);\n+  const command = [\n+    \"bash\",\n+    \"-lc\",\n+    [\n+      `SESSION=\\\"cmux\\\"`,\n+      `WINDOW=${singleQuote(windowName)}`,\n+      `tmux has-session -t \\\"$SESSION\\\" 2>/dev/null || tmux new-session -d -s \\\"$SESSION\\\" -c ${singleQuote(repoDir)}`,\n+      `tmux new-window -t \\\"$SESSION\\\" -n \\\"$WINDOW\\\" -c ${singleQuote(repoDir)}`,\n+      `echo '${scriptBase64}' | base64 -d > /tmp/cmux-${windowName}.sh`,\n+      `chmod +x /tmp/cmux-${windowName}.sh`,\n+      `tmux send-keys -t \\\"$SESSION\\\":\\\"$WINDOW\\\" \"bash /tmp/cmux-${windowName}.sh\" C-m`,\n+    ].join(\" && \"),\n+  ];\n+\n+  const response = await execInstanceInstanceIdExecPost({\n+    client: morphClient,\n+    path: { instance_id: instanceId },\n+    body: { command },\n+  });\n+\n+  if (response.error || response.data?.exit_code !== 0) {\n+    console.warn(\"[preview-jobs] Failed to start tmux window\", {\n+      previewRunId,\n+      windowName,\n+      exitCode: response.data?.exit_code,\n+      stdout: sliceOutput(response.data?.stdout),\n+      stderr: sliceOutput(response.data?.stderr),\n+      error: response.error,\n+    });\n+  } else {\n+    console.log(\"[preview-jobs] Started tmux window\", {\n+      previewRunId,\n+      windowName,\n+    });\n+  }\n+}\n+\n+export async function runPreviewJob(\n+  ctx: ActionCtx,\n+  previewRunId: Id<\"previewRuns\">,\n+) {\n+  const morphApiKey = env.MORPH_API_KEY;\n+  if (!morphApiKey) {\n+    console.warn(\"[preview-jobs] MORPH_API_KEY not configured; skipping run\", {\n+      previewRunId,\n+    });\n+    await ctx.runMutation(internal.previewRuns.updateStatus, {\n+      previewRunId,\n+      status: \"failed\",\n+      stateReason: \"Morph API key is not configured\",\n+    });\n+    return;\n+  }\n+\n+  const morphClient = createMorphCloudClient({\n+    auth: morphApiKey,\n+  });\n+\n+  const payload = await ctx.runQuery(internal.previewRuns.getRunWithConfig, {\n+    previewRunId,\n+  });\n+  if (!payload?.run || !payload.config) {\n+    console.warn(\"[preview-jobs] Missing run/config for dispatch\", {\n+      previewRunId,\n+    });\n+    return;\n+  }\n+\n+  const convexUrl = resolveConvexUrl();\n+  if (!convexUrl) {\n+    console.error(\"[preview-jobs] Convex URL not configured; cannot trigger screenshots\", {\n+      previewRunId,\n+    });\n+    await ctx.runMutation(internal.previewRuns.updateStatus, {\n+      previewRunId,\n+      status: \"failed\",\n+      stateReason: \"Convex URL is not configured for preview screenshots\",\n+    });\n+    return;\n+  }\n+\n+  const { run, config } = payload;\n+  let taskRunId: Id<\"taskRuns\"> | null = run.taskRunId ?? null;\n+\n+  if (!config.environmentId) {\n+    console.warn(\"[preview-jobs] Preview config missing environmentId; skipping run\", {\n+      previewRunId,\n+      repoFullName: run.repoFullName,\n+      prNumber: run.prNumber,\n+    });\n+    await ctx.runMutation(internal.previewRuns.updateStatus, {\n+      previewRunId,\n+      status: \"skipped\",\n+      stateReason: \"No environment configured for preview run\",\n+    });\n+    return;\n+  }\n+\n+  const environment = await ctx.runQuery(internal.environments.getByIdInternal, {\n+    id: config.environmentId,\n+  });\n+\n+  if (!environment) {\n+    console.warn(\"[preview-jobs] Environment not found for preview run; skipping\", {\n+      previewRunId,\n+      environmentId: config.environmentId,\n+    });\n+    await ctx.runMutation(internal.previewRuns.updateStatus, {\n+      previewRunId,\n+      status: \"skipped\",\n+      stateReason: \"Environment not found for preview run\",\n+    });\n+    return;\n+  }\n+\n+  if (!environment.morphSnapshotId) {\n+    console.warn(\"[preview-jobs] Environment missing morph snapshot; skipping\", {\n+      previewRunId,\n+      environmentId: environment._id,\n+    });\n+    await ctx.runMutation(internal.previewRuns.updateStatus, {\n+      previewRunId,\n+      status: \"skipped\",\n+      stateReason: \"Environment has no associated Morph snapshot\",\n+    });\n+    return;\n+  }\n+\n+  const snapshotId = environment.morphSnapshotId;\n+  let instance: InstanceModel | null = null;\n+  let taskId: Id<\"tasks\"> | null = null;\n+\n+  if (!taskRunId) {\n+    console.log(\"[preview-jobs] No taskRun linked to preview run, creating one now\", {\n+      previewRunId,\n+      repoFullName: run.repoFullName,\n+      prNumber: run.prNumber,\n+    });\n+\n+    taskId = await ctx.runMutation(internal.tasks.createForPreview, {\n+      teamId: run.teamId,\n+      userId: config.createdByUserId,\n+      previewRunId,\n+      repoFullName: run.repoFullName,\n+      prNumber: run.prNumber,\n+      prUrl: run.prUrl,\n+      headSha: run.headSha,\n+      baseBranch: config.repoDefaultBranch,\n+    });\n+\n+    const { taskRunId: createdTaskRunId } = await ctx.runMutation(\n+      internal.taskRuns.createForPreview,\n+      {\n+        taskId,\n+        teamId: run.teamId,\n+        userId: config.createdByUserId,\n+        prUrl: run.prUrl,\n+        environmentId: config.environmentId,\n+        newBranch: run.headRef,\n+      },\n+    );\n+\n+    await ctx.runMutation(internal.previewRuns.linkTaskRun, {\n+      previewRunId,\n+      taskRunId: createdTaskRunId,\n+    });\n+\n+    taskRunId = createdTaskRunId;\n+\n+    console.log(\"[preview-jobs] Created and linked task/taskRun for preview run\", {\n+      previewRunId,\n+      taskId,\n+      taskRunId,\n+    });\n+  }\n+\n+  if (!taskId && taskRunId) {\n+    const existingTaskRun = await ctx.runQuery(internal.taskRuns.getById, { id: taskRunId });\n+    if (existingTaskRun?.taskId) {\n+      taskId = existingTaskRun.taskId;\n+    } else {\n+      console.error(\"[preview-jobs] Task run missing taskId\", {\n+        previewRunId,\n+        taskRunId,\n+        hasTaskRun: Boolean(existingTaskRun),\n+      });\n+    }\n+  }\n+\n+  const keepInstanceForTaskRun = Boolean(taskRunId);\n+  console.log(\"[preview-jobs] Launching Morph instance\", {\n+    previewRunId,\n+    snapshotId,\n+    repoFullName: run.repoFullName,\n+    prNumber: run.prNumber,\n+    headSha: run.headSha,\n+    baseSha: run.baseSha,\n+  });\n+\n+  await ctx.runMutation(internal.previewRuns.updateStatus, {\n+    previewRunId,\n+    status: \"running\",\n+    stateReason: \"Provisioning Morph workspace\",\n+  });\n+\n+  try {\n+    // Generate JWT for screenshot upload authentication if we have a taskRunId\n+    const previewJwt = taskRunId\n+      ? await new SignJWT({\n+          taskRunId,\n+          teamId: run.teamId,\n+          userId: config.createdByUserId,\n+        })\n+          .setProtectedHeader({ alg: \"HS256\" })\n+          .setIssuedAt()\n+          .setExpirationTime(\"12h\")\n+          .sign(new TextEncoder().encode(env.CMUX_TASK_RUN_JWT_SECRET))\n+      : null;\n+\n+    console.log(\"[preview-jobs] Starting Morph instance\", {\n+      previewRunId,\n+      hasTaskRunId: Boolean(taskRunId),\n+      hasToken: Boolean(previewJwt),\n+      snapshotId,\n+    });\n+\n+    instance = await startMorphInstance(morphClient, {\n+      snapshotId,\n+      metadata: {\n+        app: \"cmux-preview\",\n+        previewRunId: previewRunId,\n+        repo: run.repoFullName,\n+        prNumber: String(run.prNumber),\n+        headSha: run.headSha,\n+      },\n+      ttlSeconds: 3600,\n+      ttlAction: \"stop\",\n+      readinessTimeoutMs: 5 * 60 * 1000,\n+    });\n+\n+    const workerService = instance.networking?.http_services?.find(\n+      (service: { port?: number }) => service.port === 39377,\n+    );\n+    if (!workerService) {\n+      throw new Error(\"Worker service not found on instance\");\n+    }\n+\n+    const getServiceUrl = (port: number) =>\n+      instance?.networking?.http_services?.find(\n+        (service: { port?: number }) => service.port === port,\n+      )?.url;\n+\n+    const vscodeService = instance.networking?.http_services?.find(\n+      (service: { port?: number }) => service.port === 39378,\n+    );\n+    const vscodeUrl = vscodeService?.url\n+      ? `${vscodeService.url}?folder=/root/workspace`\n+      : null;\n+\n+    await ctx.runMutation(internal.previewRuns.updateInstanceMetadata, {\n+      previewRunId,\n+      morphInstanceId: instance.id,\n+      clearStoppedAt: true,\n+    });\n+\n+    console.log(\"[preview-jobs] Worker service ready\", {\n+      previewRunId,\n+      instanceId: instance.id,\n+      vscodeUrl,\n+      workerUrl: workerService.url,\n+      workerHealthUrl: `${workerService.url}/health`,\n+      screenshotLogUrl: `${workerService.url.replace(':39377', ':39376')}/file?path=/root/.cmux/screenshot-collector/screenshot-collector.log`,\n+    });\n+\n+    if (taskRunId) {\n+      const networking = instance.networking?.http_services?.map((s) => ({\n+        status: \"running\" as const,\n+        port: s.port || 0,\n+        url: s.url || \"\",\n+      })) ?? [];\n+\n+      await ctx.runMutation(internal.taskRuns.updateVSCodeMetadataInternal, {\n+        taskRunId,\n+        vscode: {\n+          provider: \"morph\",\n+          status: \"running\",\n+          containerName: instance.id,\n+          url: vscodeUrl ?? undefined,\n+          workspaceUrl: vscodeUrl ?? undefined,\n+          startedAt: Date.now(),\n+          ports: {\n+            vscode: getServiceUrl(39378) ?? \"\",\n+            worker: getServiceUrl(39377) ?? \"\",\n+            extension: getServiceUrl(39376),\n+            vnc: getServiceUrl(39375),\n+          },\n+        },\n+        networking,\n+      });\n+      console.log(\"[preview-jobs] Updated task run metadata with instance info\", {\n+        taskRunId,\n+        instanceId: instance.id,\n+      });\n+    }\n+\n+    // Step 2: Fetch latest changes and checkout PR\n+    // Preview environment snapshots have the repo pre-cloned at /root/workspace\n+    const repoSearchRoot = \"/root/workspace\";\n+\n+    await ctx.runMutation(internal.previewRuns.updateStatus, {\n+      previewRunId,\n+      status: \"running\",\n+      stateReason: \"Fetching latest changes\",\n+    });\n+\n+    // The repository is always at /root/workspace directly\n+    const repoDir = repoSearchRoot;\n+\n+    console.log(\"[preview-jobs] Using pre-cloned repository\", {\n+      previewRunId,\n+      repoFullName: run.repoFullName,\n+      repoDir,\n+    });\n+\n+    console.log(\"[preview-jobs] Starting GitHub authentication setup\", {\n+      previewRunId,\n+      hasInstallationId: Boolean(run.repoInstallationId),\n+      installationId: run.repoInstallationId,\n+    });\n+\n+    // Get GitHub App installation token for fetching from private repos\n+    if (run.repoInstallationId) {\n+      console.log(\"[preview-jobs] Fetching installation access token\", {\n+        previewRunId,\n+        installationId: run.repoInstallationId,\n+      });\n+\n+      let accessToken: string | null = null;\n+      try {\n+        accessToken = await fetchInstallationAccessToken(run.repoInstallationId);\n+      } catch (error) {\n+        console.error(\"[preview-jobs] Failed to fetch installation token\", {\n+          previewRunId,\n+          installationId: run.repoInstallationId,\n+          error: error instanceof Error ? error.message : String(error),\n+        });\n+      }\n+\n+      console.log(\"[preview-jobs] Installation token fetch result\", {\n+        previewRunId,\n+        hasToken: Boolean(accessToken),\n+      });\n+\n+      if (accessToken) {\n+        const escapedToken = singleQuote(accessToken);\n+        \n+        let lastError: Error | undefined;\n+        let authSucceeded = false;\n+        const maxRetries = 5;\n+\n+        for (let attempt = 1; attempt <= maxRetries; attempt++) {\n+          try {\n+            const shellScript = `cd ${repoDir} && printf %s ${escapedToken} | gh auth login --with-token && gh auth setup-git 2>&1`;\n+\n+            const ghAuthResponse = await execInstanceInstanceIdExecPost({\n+              client: morphClient,\n+              path: { instance_id: instance.id },\n+              body: {\n+                command: [\"bash\", \"-lc\", shellScript],\n+              },\n+            });\n+\n+            console.log(\"[preview-jobs] GitHub auth response received\", {\n+              previewRunId,\n+              attempt,\n+              hasError: Boolean(ghAuthResponse.error),\n+              exitCode: ghAuthResponse.data?.exit_code,\n+              stdout: sliceOutput(ghAuthResponse.data?.stdout, 500),\n+              stderr: sliceOutput(ghAuthResponse.data?.stderr, 500),\n+            });\n+\n+            if (ghAuthResponse.error) {\n+              lastError = new Error(`API error: ${JSON.stringify(ghAuthResponse.error)}`);\n+              console.error(\"[preview-jobs] GitHub auth API error\", {\n+                previewRunId,\n+                attempt,\n+                error: ghAuthResponse.error,\n+              });\n+            } else if (ghAuthResponse.data?.exit_code === 0) {\n+              console.log(\"[preview-jobs] GitHub authentication configured successfully\", {\n+                previewRunId,\n+                attempt,\n+                stdout: sliceOutput(ghAuthResponse.data?.stdout, 500),\n+                stderr: sliceOutput(ghAuthResponse.data?.stderr, 500),\n+              });\n+              authSucceeded = true;\n+              break;\n+            } else {\n+              const errorMessage = ghAuthResponse.data?.stderr || ghAuthResponse.data?.stdout || \"Unknown error\";\n+              lastError = new Error(`GitHub auth failed: ${errorMessage.slice(0, 500)}`);\n+              console.warn(\"[preview-jobs] GitHub auth command failed\", {\n+                previewRunId,\n+                attempt,\n+                exitCode: ghAuthResponse.data?.exit_code,\n+                stderr: sliceOutput(ghAuthResponse.data?.stderr, 200),\n+                stdout: sliceOutput(ghAuthResponse.data?.stdout, 200),\n+              });\n+            }\n+\n+            if (attempt < maxRetries) {\n+              const delay = Math.min(1000 * Math.pow(2, attempt - 1), 5000);\n+              console.log(\"[preview-jobs] Retrying GitHub auth\", {\n+                previewRunId,\n+                attempt,\n+                delayMs: delay,\n+              });\n+              await new Promise(resolve => setTimeout(resolve, delay));\n+            }\n+          } catch (error) {\n+            const normalizedError = error instanceof Error ? error : new Error(String(error));\n+            lastError = normalizedError;\n+            console.error(\"[preview-jobs] GitHub auth attempt threw error\", {\n+              previewRunId,\n+              attempt,\n+              error: normalizedError.message,\n+            });\n+\n+            if (attempt < maxRetries) {\n+              const delay = Math.min(1000 * Math.pow(2, attempt - 1), 5000);\n+              await new Promise(resolve => setTimeout(resolve, delay));\n+            }\n+          }\n+        }\n+\n+        if (!authSucceeded) {\n+          console.error(\"[preview-jobs] GitHub authentication failed after all retries\", {\n+            previewRunId,\n+            maxRetries,\n+            lastError: lastError?.message,\n+          });\n+          const finalErrorMessage = lastError?.message || \"Unknown error\";\n+          throw new Error(\n+            `GitHub authentication failed after ${maxRetries} attempts: ${finalErrorMessage}`\n+          );\n+        }\n+      } else {\n+        console.warn(\"[preview-jobs] Failed to fetch installation token, falling back to public fetch\", {\n+          previewRunId,\n+          installationId: run.repoInstallationId,\n+        });\n+      }\n+    } else {\n+      console.log(\"[preview-jobs] No installation ID, skipping GitHub authentication\", {\n+        previewRunId,\n+      });\n+    }\n+\n+    console.log(\"[preview-jobs] Starting git fetch from origin\", {\n+      previewRunId,\n+      repoDir,\n+    });\n+\n+    // Fetch the latest changes from origin (fetch all refs)\n+    const fetchResponse = await execInstanceInstanceIdExecPost({\n+      client: morphClient,\n+      path: { instance_id: instance.id },\n+      body: {\n+        command: [\"git\", \"-C\", repoDir, \"fetch\", \"origin\"],\n+      },\n+    });\n+\n+    if (fetchResponse.error || fetchResponse.data?.exit_code !== 0) {\n+      console.error(\"[preview-jobs] Fetch failed\", {\n+        previewRunId,\n+        exitCode: fetchResponse.data?.exit_code,\n+        stdout: fetchResponse.data?.stdout,\n+        stderr: fetchResponse.data?.stderr,\n+      });\n+      throw new Error(\n+        `Failed to fetch from origin (exit ${fetchResponse.data?.exit_code}): ${fetchResponse.data?.stderr || fetchResponse.data?.stdout}`\n+      );\n+    }\n+\n+    console.log(\"[preview-jobs] Fetched latest changes from origin\", {\n+      previewRunId,\n+      headSha: run.headSha,\n+    });\n+\n+    await ensureCommitAvailable({\n+      morphClient,\n+      instanceId: instance.id,\n+      repoDir,\n+      commitSha: run.headSha,\n+      prNumber: run.prNumber,\n+      previewRunId,\n+      headRepoCloneUrl: run.headRepoCloneUrl,\n+      headRef: run.headRef,\n+    });\n+\n+    await stashLocalChanges({\n+      morphClient,\n+      instanceId: instance.id,\n+      repoDir,\n+      previewRunId,\n+      headSha: run.headSha,\n+    });\n+\n+    console.log(\"[preview-jobs] Starting git checkout\", {\n+      previewRunId,\n+      headSha: run.headSha,\n+      repoDir,\n+    });\n+\n+    // Step 3: Checkout the PR commit\n+    await ctx.runMutation(internal.previewRuns.updateStatus, {\n+      previewRunId,\n+      status: \"running\",\n+      stateReason: \"Checking out PR commit\",\n+    });\n+\n+    const checkoutCmd = run.headRef\n+      ? [\"git\", \"-C\", repoDir, \"checkout\", \"-B\", run.headRef, run.headSha]\n+      : [\"git\", \"-C\", repoDir, \"checkout\", run.headSha];\n+\n+    const checkoutResponse = await execInstanceInstanceIdExecPost({\n+      client: morphClient,\n+      path: { instance_id: instance.id },\n+      body: {\n+        command: checkoutCmd,\n+      },\n+    });\n+\n+    if (checkoutResponse.error) {\n+      throw new Error(\n+        `Failed to checkout PR branch ${run.headSha}: ${JSON.stringify(checkoutResponse.error)}`,\n+      );\n+    }\n+\n+    const checkoutResult = checkoutResponse.data;\n+    if (!checkoutResult) {\n+      throw new Error(\"Checkout command returned no data\");\n+    }\n+\n+    if (checkoutResult.exit_code !== 0) {\n+      console.error(\"[preview-jobs] Checkout failed - full output\", {\n+        previewRunId,\n+        headSha: run.headSha,\n+        exitCode: checkoutResult.exit_code,\n+        stdout: checkoutResult.stdout,\n+        stderr: checkoutResult.stderr,\n+      });\n+      throw new Error(\n+        `Failed to checkout PR branch ${run.headSha} (exit ${checkoutResult.exit_code}): stderr=\"${checkoutResult.stderr}\" stdout=\"${checkoutResult.stdout}\"`,\n+      );\n+    }\n+\n+    console.log(\"[preview-jobs] Checked out PR branch\", {\n+      previewRunId,\n+      headSha: run.headSha,\n+      stdout: checkoutResult.stdout?.slice(0, 200),\n+    });\n+\n+    // Step 4: Apply environment variables and trigger screenshot collection\n+    await ctx.runMutation(internal.previewRuns.updateStatus, {\n+      previewRunId,\n+      status: \"running\",\n+      stateReason: \"Setting up environment and triggering screenshots\",\n+    });\n+\n+    if (taskRunId && previewJwt) {\n+      // Apply environment variables via envctl (same as crown runs)\n+      const envLines = [\n+        `CMUX_TASK_RUN_ID=\"${taskRunId}\"`,\n+        `CMUX_TASK_RUN_JWT=\"${previewJwt}\"`,\n+        `CONVEX_SITE_URL=\"${convexUrl}\"`,\n+        `CONVEX_URL=\"${convexUrl}\"`,\n+      ];\n+      const envVarsContent = envLines.join(\"\\n\");\n+      if (envVarsContent.length === 0) {\n+        console.error(\"[preview-jobs] Empty environment payload before envctl\", {\n+          previewRunId,\n+          taskRunId,\n+        });\n+        throw new Error(\"Cannot apply empty environment payload via envctl\");\n+      }\n+      const envBase64 = stringToBase64(envVarsContent);\n+      console.log(\"[preview-jobs] Applying environment variables via envctl\", {\n+        previewRunId,\n+        taskRunId,\n+        payloadLength: envVarsContent.length,\n+      });\n+      // Call envctl with explicit base64 argument to avoid shell quoting issues\n+      const envctlResponse = await execInstanceInstanceIdExecPost({\n+        client: morphClient,\n+        path: { instance_id: instance.id },\n+        body: {\n+          command: [\"envctl\", \"load\", \"--base64\", envBase64],\n+        },\n+      });\n+\n+      if (envctlResponse.error || envctlResponse.data?.exit_code !== 0) {\n+        console.error(\"[preview-jobs] Failed to apply environment variables\", {\n+          previewRunId,\n+          exitCode: envctlResponse.data?.exit_code,\n+          stderr: sliceOutput(envctlResponse.data?.stderr),\n+          stdout: sliceOutput(envctlResponse.data?.stdout),\n+          error: envctlResponse.error,\n+        });\n+        throw new Error(\"Failed to apply environment variables via envctl\");\n+      }\n+\n+      console.log(\"[preview-jobs] Applied environment variables via envctl\", {\n+        previewRunId,\n+        taskRunId,\n+      });\n+\n+      // Start tmux session and run maintenance/dev scripts if provided\n+      await ensureTmuxSession({\n+        morphClient,\n+        instanceId: instance.id,\n+        repoDir,\n+        previewRunId,\n+      });\n+\n+      if (environment.maintenanceScript) {\n+        await runScriptInTmuxWindow({\n+          morphClient,\n+          instanceId: instance.id,\n+          repoDir,\n+          windowName: \"maintenance\",\n+          scriptContent: environment.maintenanceScript,\n+          previewRunId,\n+        });\n+      }\n+\n+      if (environment.devScript) {\n+        await runScriptInTmuxWindow({\n+          morphClient,\n+          instanceId: instance.id,\n+          repoDir,\n+          windowName: \"devserver\",\n+          scriptContent: environment.devScript,\n+          previewRunId,\n+        });\n+      }\n+\n+      // Verify task run exists before triggering screenshots\n+      console.log(\"[preview-jobs] Verifying task run is queryable\", {\n+        previewRunId,\n+        taskRunId,\n+      });\n+\n+      let taskRunVerified = false;\n+      for (let attempt = 1; attempt <= 5; attempt++) {\n+        const verifyTaskRun = await ctx.runQuery(internal.taskRuns.getById, {\n+          id: taskRunId,\n+        });\n+\n+        if (verifyTaskRun) {\n+          console.log(\"[preview-jobs] Task run verified\", {\n+            previewRunId,\n+            taskRunId,\n+            attempt,\n+          });\n+          taskRunVerified = true;\n+          break;\n+        }\n+\n+        console.warn(\"[preview-jobs] Task run not yet queryable, retrying\", {\n+          previewRunId,\n+          taskRunId,\n+          attempt,\n+        });\n+\n+        if (attempt < 5) {\n+          await delay(1000); // Wait 1 second between attempts\n+        }\n+      }\n+\n+      if (!taskRunVerified) {\n+        throw new Error(`Task run ${taskRunId} not queryable after verification attempts`);\n+      }\n+\n+      // Trigger screenshot collection via worker HTTP endpoint\n+      // The JWT contains taskRunId, and the worker will call /api/crown/check to get taskId\n+      const screenshotPayload: WorkerRunTaskScreenshots = {\n+        token: previewJwt,\n+        convexUrl,\n+      };\n+\n+      try {\n+        await triggerWorkerScreenshotCollection({\n+          workerUrl: workerService.url,\n+          payload: screenshotPayload,\n+          previewRunId,\n+        });\n+      } catch (error) {\n+        console.error(\"[preview-jobs] Failed to trigger screenshots\", {\n+          previewRunId,\n+          error: error instanceof Error ? error.message : String(error),\n+        });\n+        throw new Error(\"Failed to trigger screenshot collection\");\n+      }\n+\n+      console.log(\"[preview-jobs] Triggered screenshot collection via HTTP\", {\n+        previewRunId,\n+        taskRunId,\n+      });\n+    }\n+\n+    console.log(\"[preview-jobs] Preview run initialized successfully\", {\n+      previewRunId,\n+      instanceId: instance.id,\n+      hasTaskRunId: Boolean(taskRunId),\n+    });\n+  } catch (error) {\n+    const message =\n+      error instanceof Error ? error.message : String(error ?? \"Unknown error\");\n+    console.error(\"[preview-jobs] Preview job failed\", {\n+      previewRunId,\n+      error: message,\n+    });\n+\n+    try {\n+      await ctx.runMutation(internal.previewRuns.updateStatus, {\n+        previewRunId,\n+        status: \"failed\",\n+        stateReason: message,\n+      });\n+    } catch (statusError) {\n+      console.error(\"[preview-jobs] Failed to update preview status\", {\n+        previewRunId,\n+        error: statusError,\n+      });\n+    }\n+\n+    throw error;\n+  } finally {\n+    if (instance && !keepInstanceForTaskRun) {\n+      try {\n+        await stopMorphInstance(morphClient, instance.id);\n+      } catch (stopError) {\n+        console.warn(\"[preview-jobs] Failed to stop Morph instance\", {\n+          previewRunId,\n+          instanceId: instance.id,\n+          error: stopError,\n+        });\n+      }\n+    } else if (instance) {\n+      console.log(\"[preview-jobs] Leaving Morph instance running for preview task run\", {\n+        previewRunId,\n+        instanceId: instance.id,\n+        taskRunId,\n+      });\n+    }\n+  }\n+}\ndiff --git a/packages/convex/convex/preview_screenshots_http.ts b/packages/convex/convex/preview_screenshots_http.ts\nnew file mode 100644\nindex 000000000..6c0ca3d34\n--- /dev/null\n+++ b/packages/convex/convex/preview_screenshots_http.ts\n@@ -0,0 +1,148 @@\n+import {\n+  PreviewScreenshotUploadPayloadSchema,\n+  ScreenshotUploadUrlRequestSchema,\n+} from \"@cmux/shared/convex-safe\";\n+import { internal } from \"./_generated/api\";\n+import type { Id } from \"./_generated/dataModel\";\n+import { httpAction } from \"./_generated/server\";\n+import { getWorkerAuth } from \"./users/utils/getWorkerAuth\";\n+\n+const JSON_HEADERS = {\n+  \"Content-Type\": \"application/json\",\n+};\n+\n+function jsonResponse(body: unknown, status = 200): Response {\n+  return new Response(JSON.stringify(body), { status, headers: JSON_HEADERS });\n+}\n+\n+async function ensureJsonRequest(\n+  req: Request,\n+): Promise<{ json: unknown } | Response> {\n+  const contentType = req.headers.get(\"content-type\") ?? \"\";\n+  if (!contentType.toLowerCase().includes(\"application/json\")) {\n+    return jsonResponse(\n+      { code: 415, message: \"Content-Type must be application/json\" },\n+      415,\n+    );\n+  }\n+\n+  try {\n+    const json = await req.json();\n+    return { json };\n+  } catch {\n+    return jsonResponse({ code: 400, message: \"Invalid JSON body\" }, 400);\n+  }\n+}\n+\n+export const uploadPreviewScreenshot = httpAction(async (ctx, req) => {\n+  const auth = await getWorkerAuth(req, {\n+    loggerPrefix: \"[preview-screenshots]\",\n+  });\n+  if (!auth) {\n+    throw jsonResponse({ code: 401, message: \"Unauthorized\" }, 401);\n+  }\n+\n+  const parsed = await ensureJsonRequest(req);\n+  if (parsed instanceof Response) return parsed;\n+\n+  const validation = PreviewScreenshotUploadPayloadSchema.safeParse(\n+    parsed.json,\n+  );\n+  if (!validation.success) {\n+    console.warn(\n+      \"[preview-screenshots] Invalid screenshot upload payload\",\n+      validation.error,\n+    );\n+    return jsonResponse({ code: 400, message: \"Invalid input\" }, 400);\n+  }\n+\n+  const payload = validation.data;\n+\n+  // Verify preview run exists\n+  const data = await ctx.runQuery(internal.previewRuns.getRunWithConfig, {\n+    previewRunId: payload.previewRunId,\n+  });\n+\n+  if (!data?.run) {\n+    return jsonResponse({ code: 404, message: \"Preview run not found\" }, 404);\n+  }\n+\n+  const { run } = data;\n+\n+  // Verify auth matches team\n+  if (run.teamId !== auth.payload.teamId) {\n+    return jsonResponse({ code: 401, message: \"Unauthorized\" }, 401);\n+  }\n+\n+  const storedScreens = (payload.images ?? []).map((image) => ({\n+    storageId: image.storageId as Id<\"_storage\">,\n+    mimeType: image.mimeType,\n+    fileName: image.fileName,\n+    commitSha: image.commitSha,\n+    width: image.width,\n+    height: image.height,\n+  }));\n+\n+  if (payload.status === \"completed\") {\n+    if (!payload.images || payload.images.length === 0) {\n+      return jsonResponse(\n+        { code: 400, message: \"At least one screenshot image is required\" },\n+        400,\n+      );\n+    }\n+  }\n+\n+  const screenshotSetId = await ctx.runMutation(\n+    internal.previewScreenshots.createScreenshotSet,\n+    {\n+      previewRunId: payload.previewRunId,\n+      status: payload.status,\n+      commitSha: payload.commitSha,\n+      error: payload.error,\n+      images: storedScreens,\n+    },\n+  );\n+\n+  // Trigger GitHub comment posting\n+  if (screenshotSetId) {\n+    await ctx.scheduler.runAfter(\n+      0,\n+      internal.previewScreenshots.triggerGithubComment,\n+      {\n+        previewRunId: payload.previewRunId,\n+      },\n+    );\n+  }\n+\n+  return jsonResponse({\n+    ok: true,\n+    storageIds: storedScreens.map((shot) => shot.storageId),\n+    screenshotSetId,\n+  });\n+});\n+\n+export const createPreviewScreenshotUploadUrl = httpAction(\n+  async (ctx, req) => {\n+    const auth = await getWorkerAuth(req, {\n+      loggerPrefix: \"[preview-screenshots]\",\n+    });\n+    if (!auth) {\n+      throw jsonResponse({ code: 401, message: \"Unauthorized\" }, 401);\n+    }\n+\n+    const parsed = await ensureJsonRequest(req);\n+    if (parsed instanceof Response) return parsed;\n+\n+    const validation = ScreenshotUploadUrlRequestSchema.safeParse(parsed.json);\n+    if (!validation.success) {\n+      console.warn(\n+        \"[preview-screenshots] Invalid upload URL request payload\",\n+        validation.error,\n+      );\n+      return jsonResponse({ code: 400, message: \"Invalid input\" }, 400);\n+    }\n+\n+    const uploadUrl = await ctx.storage.generateUploadUrl();\n+    return jsonResponse({ ok: true, uploadUrl });\n+  },\n+);\ndiff --git a/packages/convex/convex/schema.ts b/packages/convex/convex/schema.ts\nindex 0aceea682..6b0d2c431 100644\n--- a/packages/convex/convex/schema.ts\n+++ b/packages/convex/convex/schema.ts\n@@ -174,11 +174,13 @@ const convexSchema = defineSchema({\n       v.literal(\"pending\"),\n       v.literal(\"running\"),\n       v.literal(\"completed\"),\n-      v.literal(\"failed\")\n+      v.literal(\"failed\"),\n+      v.literal(\"skipped\")\n     ),\n     isArchived: v.optional(v.boolean()), // Whether this run is hidden from default views\n     isLocalWorkspace: v.optional(v.boolean()),\n     isCloudWorkspace: v.optional(v.boolean()),\n+    isPreviewJob: v.optional(v.boolean()), // Whether this is a preview job that should auto-run screenshots\n     // Optional log retained for backward compatibility; no longer written to.\n     log: v.optional(v.string()), // CLI output log (deprecated)\n     worktreePath: v.optional(v.string()), // Path to the git worktree for this run\n@@ -543,6 +545,89 @@ const convexSchema = defineSchema({\n     userId: v.string(),\n     teamId: v.string(),\n   }).index(\"by_team_user_repo\", [\"teamId\", \"userId\", \"projectFullName\"]),\n+  previewConfigs: defineTable({\n+    teamId: v.string(),\n+    createdByUserId: v.string(),\n+    repoFullName: v.string(),\n+    repoProvider: v.optional(v.literal(\"github\")),\n+    repoInstallationId: v.optional(v.number()),\n+    repoDefaultBranch: v.optional(v.string()),\n+    environmentId: v.optional(v.id(\"environments\")),\n+    status: v.optional(\n+      v.union(\n+        v.literal(\"active\"),\n+        v.literal(\"paused\"),\n+        v.literal(\"disabled\"),\n+      ),\n+    ),\n+    lastRunAt: v.optional(v.number()),\n+    createdAt: v.number(),\n+    updatedAt: v.number(),\n+  })\n+    .index(\"by_team_repo\", [\"teamId\", \"repoFullName\"])\n+    .index(\"by_team\", [\"teamId\", \"updatedAt\"])\n+    .index(\"by_team_status\", [\"teamId\", \"status\", \"updatedAt\"])\n+    .index(\"by_environment\", [\"environmentId\"]),\n+  previewRuns: defineTable({\n+    previewConfigId: v.id(\"previewConfigs\"),\n+    teamId: v.string(),\n+    repoFullName: v.string(),\n+    repoInstallationId: v.optional(v.number()),\n+    prNumber: v.number(),\n+    prUrl: v.string(),\n+    headSha: v.string(),\n+    baseSha: v.optional(v.string()),\n+    headRef: v.optional(v.string()), // Branch name in head repo\n+    headRepoFullName: v.optional(v.string()), // Fork repo full name (if from fork)\n+    headRepoCloneUrl: v.optional(v.string()), // Fork repo clone URL (if from fork)\n+    taskRunId: v.optional(v.id(\"taskRuns\")),\n+    status: v.union(\n+      v.literal(\"pending\"),\n+      v.literal(\"running\"),\n+      v.literal(\"completed\"),\n+      v.literal(\"failed\"),\n+      v.literal(\"skipped\"),\n+    ),\n+    stateReason: v.optional(v.string()),\n+    dispatchedAt: v.optional(v.number()),\n+    startedAt: v.optional(v.number()),\n+    completedAt: v.optional(v.number()),\n+    screenshotSetId: v.optional(v.id(\"previewScreenshotSets\")),\n+    githubCommentUrl: v.optional(v.string()),\n+    githubCommentId: v.optional(v.number()),\n+    morphInstanceId: v.optional(v.string()),\n+    morphInstanceStoppedAt: v.optional(v.number()),\n+    createdAt: v.number(),\n+    updatedAt: v.number(),\n+  })\n+    .index(\"by_config_status\", [\"previewConfigId\", \"status\", \"createdAt\"])\n+    .index(\"by_config_head\", [\"previewConfigId\", \"headSha\"])\n+    .index(\"by_config_pr\", [\"previewConfigId\", \"prNumber\", \"createdAt\"])\n+    .index(\"by_team_created\", [\"teamId\", \"createdAt\"]),\n+  previewScreenshotSets: defineTable({\n+    previewRunId: v.id(\"previewRuns\"),\n+    status: v.union(\n+      v.literal(\"completed\"),\n+      v.literal(\"failed\"),\n+      v.literal(\"skipped\"),\n+    ),\n+    commitSha: v.string(),\n+    capturedAt: v.number(),\n+    error: v.optional(v.string()),\n+    images: v.array(\n+      v.object({\n+        storageId: v.id(\"_storage\"),\n+        mimeType: v.string(),\n+        fileName: v.optional(v.string()),\n+        commitSha: v.optional(v.string()),\n+        width: v.optional(v.number()),\n+        height: v.optional(v.number()),\n+      }),\n+    ),\n+    createdAt: v.number(),\n+    updatedAt: v.number(),\n+  })\n+    .index(\"by_run\", [\"previewRunId\", \"capturedAt\"]),\n   crownEvaluations: defineTable({\n     taskId: v.id(\"tasks\"),\n     evaluatedAt: v.number(),\ndiff --git a/packages/convex/convex/taskRuns.ts b/packages/convex/convex/taskRuns.ts\nindex dc3e6b6e6..715237abd 100644\n--- a/packages/convex/convex/taskRuns.ts\n+++ b/packages/convex/convex/taskRuns.ts\n@@ -1158,6 +1158,96 @@ export const toggleKeepAlive = authMutation({\n   },\n });\n \n+export const updateVSCodeMetadataInternal = internalMutation({\n+  args: {\n+    taskRunId: v.id(\"taskRuns\"),\n+    vscode: v.optional(\n+      v.object({\n+        provider: v.optional(\n+          v.union(\n+            v.literal(\"docker\"),\n+            v.literal(\"morph\"),\n+            v.literal(\"daytona\"),\n+            v.literal(\"other\"),\n+          ),\n+        ),\n+        containerName: v.optional(v.string()),\n+        status: v.optional(\n+          v.union(v.literal(\"starting\"), v.literal(\"running\"), v.literal(\"stopped\")),\n+        ),\n+        ports: v.optional(\n+          v.object({\n+            vscode: v.string(),\n+            worker: v.string(),\n+            extension: v.optional(v.string()),\n+            proxy: v.optional(v.string()),\n+            vnc: v.optional(v.string()),\n+          }),\n+        ),\n+        url: v.optional(v.string()),\n+        workspaceUrl: v.optional(v.string()),\n+        startedAt: v.optional(v.number()),\n+        stoppedAt: v.optional(v.number()),\n+        lastAccessedAt: v.optional(v.number()),\n+        keepAlive: v.optional(v.boolean()),\n+        scheduledStopAt: v.optional(v.number()),\n+      }),\n+    ),\n+    networking: v.optional(\n+      v.array(\n+        v.object({\n+          status: v.union(\n+            v.literal(\"starting\"),\n+            v.literal(\"running\"),\n+            v.literal(\"stopped\"),\n+          ),\n+          port: v.number(),\n+          url: v.string(),\n+        }),\n+      ),\n+    ),\n+  },\n+  handler: async (ctx, args) => {\n+    const run = await ctx.db.get(args.taskRunId);\n+    if (!run) {\n+      throw new Error(\"Task run not found\");\n+    }\n+\n+    const patch: Partial<Doc<\"taskRuns\">> = {\n+      updatedAt: Date.now(),\n+    };\n+\n+    if (args.vscode) {\n+      const existing = run.vscode;\n+      const ensureField = <T>(value: T | undefined, existingValue: T | undefined, field: string): T => {\n+        if (value !== undefined) {\n+          return value;\n+        }\n+        if (existingValue !== undefined) {\n+          return existingValue;\n+        }\n+        throw new Error(`Missing required VSCode field: ${field}`);\n+      };\n+\n+      const provider = ensureField(args.vscode.provider, existing?.provider, \"provider\");\n+      const status = ensureField(args.vscode.status, existing?.status, \"status\");\n+\n+      patch.vscode = {\n+        ...existing,\n+        ...args.vscode,\n+        provider,\n+        status,\n+      };\n+    }\n+\n+    if (args.networking !== undefined) {\n+      patch.networking = args.networking;\n+    }\n+\n+    await ctx.db.patch(args.taskRunId, patch);\n+  },\n+});\n+\n export const updateScheduledStopInternal = internalMutation({\n   args: {\n     taskRunId: v.id(\"taskRuns\"),\n@@ -1633,3 +1723,50 @@ export const getRunningContainersByCleanupPriority = authQuery({\n     };\n   },\n });\n+\n+export const createForPreview = internalMutation({\n+  args: {\n+    taskId: v.id(\"tasks\"),\n+    teamId: v.string(),\n+    userId: v.string(),\n+    prUrl: v.string(),\n+    environmentId: v.optional(v.id(\"environments\")),\n+    newBranch: v.optional(v.string()),\n+  },\n+  handler: async (ctx, args) => {\n+    const now = Date.now();\n+    const task = await ctx.db.get(args.taskId);\n+    if (!task) {\n+      throw new Error(\"Task not found\");\n+    }\n+\n+    const taskRunId = await ctx.db.insert(\"taskRuns\", {\n+      taskId: args.taskId,\n+      parentRunId: undefined,\n+      prompt: `Capture UI screenshots for ${args.prUrl}`,\n+      agentName: \"screenshot-collector\",\n+      newBranch: args.newBranch,\n+      status: \"pending\",\n+      createdAt: now,\n+      updatedAt: now,\n+      userId: args.userId,\n+      teamId: args.teamId,\n+      environmentId: args.environmentId,\n+      isLocalWorkspace: task.isLocalWorkspace,\n+      isCloudWorkspace: task.isCloudWorkspace,\n+      isPreviewJob: true,\n+    });\n+\n+    const jwt = await new SignJWT({\n+      taskRunId,\n+      teamId: args.teamId,\n+      userId: args.userId,\n+    })\n+      .setProtectedHeader({ alg: \"HS256\" })\n+      .setIssuedAt()\n+      .setExpirationTime(\"12h\")\n+      .sign(new TextEncoder().encode(env.CMUX_TASK_RUN_JWT_SECRET));\n+\n+    return { taskRunId, jwt };\n+  },\n+});\ndiff --git a/packages/convex/convex/tasks.ts b/packages/convex/convex/tasks.ts\nindex 836d58f4b..ca75b7174 100644\n--- a/packages/convex/convex/tasks.ts\n+++ b/packages/convex/convex/tasks.ts\n@@ -824,3 +824,35 @@ export const getByIdInternal = internalQuery({\n     return await ctx.db.get(args.id);\n   },\n });\n+\n+export const createForPreview = internalMutation({\n+  args: {\n+    teamId: v.string(),\n+    userId: v.string(),\n+    previewRunId: v.id(\"previewRuns\"),\n+    repoFullName: v.string(),\n+    prNumber: v.number(),\n+    prUrl: v.string(),\n+    headSha: v.string(),\n+    baseBranch: v.optional(v.string()),\n+  },\n+  handler: async (ctx, args) => {\n+    const now = Date.now();\n+    const taskId = await ctx.db.insert(\"tasks\", {\n+      text: `Preview screenshots for PR #${args.prNumber}`,\n+      description: `Capture UI screenshots for ${args.prUrl}`,\n+      projectFullName: args.repoFullName,\n+      baseBranch: args.baseBranch,\n+      worktreePath: undefined,\n+      isCompleted: false,\n+      createdAt: now,\n+      updatedAt: now,\n+      images: undefined,\n+      userId: args.userId,\n+      teamId: args.teamId,\n+      environmentId: undefined,\n+      isCloudWorkspace: undefined,\n+    });\n+    return taskId;\n+  },\n+});\ndiff --git a/packages/convex/package.json b/packages/convex/package.json\nindex c1331eb28..80054bc5c 100644\n--- a/packages/convex/package.json\n+++ b/packages/convex/package.json\n@@ -31,6 +31,7 @@\n     \"@ai-sdk/gateway\": \"^1.0.28\",\n     \"@ai-sdk/openai\": \"^2.0.19\",\n     \"@ai-sdk/provider-utils\": \"^3.0.9\",\n+    \"@cmux/morphcloud-openapi-client\": \"workspace:*\",\n     \"@cmux/shared\": \"workspace:*\",\n     \"@convex-dev/migrations\": \"^0.2.9\",\n     \"@stackframe/js\": \"^2.8.48\",\ndiff --git a/packages/shared/src/crown/types.ts b/packages/shared/src/crown/types.ts\nindex 3f87ae023..051802e42 100644\n--- a/packages/shared/src/crown/types.ts\n+++ b/packages/shared/src/crown/types.ts\n@@ -72,6 +72,7 @@ export const WorkerTaskRunDescriptorSchema = z.object({\n   teamId: z.string(),\n   newBranch: z.string().nullable(),\n   agentName: z.string().nullable(),\n+  isPreviewJob: z.boolean().optional(),\n });\n export type WorkerTaskRunDescriptor = z.infer<\n   typeof WorkerTaskRunDescriptorSchema\ndiff --git a/packages/shared/src/morph-snapshots.json b/packages/shared/src/morph-snapshots.json\nindex adbc91f76..036712c98 100644\n--- a/packages/shared/src/morph-snapshots.json\n+++ b/packages/shared/src/morph-snapshots.json\n@@ -1,6 +1,6 @@\n {\n   \"schemaVersion\": 1,\n-  \"updatedAt\": \"2025-11-23T09:44:10Z\",\n+  \"updatedAt\": \"2025-11-29T22:01:05Z\",\n   \"presets\": [\n     {\n       \"presetId\": \"4vcpu_16gb_48gb\",\n@@ -28,6 +28,26 @@\n           \"version\": 4,\n           \"snapshotId\": \"snapshot_svdf7qmg\",\n           \"capturedAt\": \"2025-11-23T09:45:47Z\"\n+        },\n+        {\n+          \"version\": 5,\n+          \"snapshotId\": \"snapshot_4l1fzyvr\",\n+          \"capturedAt\": \"2025-11-26T20:11:45Z\"\n+        },\n+        {\n+          \"version\": 6,\n+          \"snapshotId\": \"snapshot_of44b6xs\",\n+          \"capturedAt\": \"2025-11-29T07:57:23Z\"\n+        },\n+        {\n+          \"version\": 7,\n+          \"snapshotId\": \"snapshot_wpcxzz6p\",\n+          \"capturedAt\": \"2025-11-29T21:23:40Z\"\n+        },\n+        {\n+          \"version\": 8,\n+          \"snapshotId\": \"snapshot_u00k1p82\",\n+          \"capturedAt\": \"2025-11-29T22:00:34Z\"\n         }\n       ],\n       \"description\": \"Great default for day-to-day work. Balanced CPU, memory, and storage.\"\n@@ -58,9 +78,43 @@\n           \"version\": 4,\n           \"snapshotId\": \"snapshot_i57mwbv2\",\n           \"capturedAt\": \"2025-11-23T09:44:10Z\"\n+        },\n+        {\n+          \"version\": 5,\n+          \"snapshotId\": \"snapshot_8x6vsofr\",\n+          \"capturedAt\": \"2025-11-26T20:11:28Z\"\n+        },\n+        {\n+          \"version\": 6,\n+          \"snapshotId\": \"snapshot_z9rtr2no\",\n+          \"capturedAt\": \"2025-11-29T07:56:55Z\"\n+        },\n+        {\n+          \"version\": 7,\n+          \"snapshotId\": \"snapshot_vr7uc2h1\",\n+          \"capturedAt\": \"2025-11-29T21:23:30Z\"\n+        },\n+        {\n+          \"version\": 8,\n+          \"snapshotId\": \"snapshot_8b1361wp\",\n+          \"capturedAt\": \"2025-11-29T22:01:05Z\"\n         }\n       ],\n       \"description\": \"Extra headroom for larger codebases or heavier workloads.\"\n+    },\n+    {\n+      \"presetId\": \"6vcpu_24gb_48gb\",\n+      \"label\": \"Standard workspace\",\n+      \"cpu\": \"6 vCPU\",\n+      \"memory\": \"24 GB RAM\",\n+      \"disk\": \"48 GB SSD\",\n+      \"versions\": [\n+        {\n+          \"version\": 1,\n+          \"snapshotId\": \"snapshot_pcmfvjra\",\n+          \"capturedAt\": \"2025-11-18T22:38:55Z\"\n+        }\n+      ]\n     }\n   ]\n }\n\\ No newline at end of file\ndiff --git a/packages/shared/src/screenshots/types.ts b/packages/shared/src/screenshots/types.ts\nindex cc941b6e1..0814e9d47 100644\n--- a/packages/shared/src/screenshots/types.ts\n+++ b/packages/shared/src/screenshots/types.ts\n@@ -56,3 +56,36 @@ export const ScreenshotUploadUrlResponseSchema = z.object({\n export type ScreenshotUploadUrlResponse = z.infer<\n   typeof ScreenshotUploadUrlResponseSchema\n >;\n+\n+// Preview screenshot schemas\n+export const PreviewScreenshotStoredImageSchema = z.object({\n+  storageId: z.string(),\n+  mimeType: z.string(),\n+  fileName: z.string().optional(),\n+  commitSha: z.string(),\n+  width: z.number().optional(),\n+  height: z.number().optional(),\n+});\n+export type PreviewScreenshotStoredImage = z.infer<\n+  typeof PreviewScreenshotStoredImageSchema\n+>;\n+\n+export const PreviewScreenshotUploadPayloadSchema = z.object({\n+  previewRunId: typedZid(\"previewRuns\"),\n+  status: z.enum([\"completed\", \"failed\", \"skipped\"]),\n+  images: z.array(PreviewScreenshotStoredImageSchema).optional(),\n+  error: z.string().optional(),\n+  commitSha: z.string(),\n+});\n+export type PreviewScreenshotUploadPayload = z.infer<\n+  typeof PreviewScreenshotUploadPayloadSchema\n+>;\n+\n+export const PreviewScreenshotUploadResponseSchema = z.object({\n+  ok: z.literal(true),\n+  storageIds: z.array(z.string()).optional(),\n+  screenshotSetId: typedZid(\"previewScreenshotSets\").optional(),\n+});\n+export type PreviewScreenshotUploadResponse = z.infer<\n+  typeof PreviewScreenshotUploadResponseSchema\n+>;\ndiff --git a/packages/shared/src/worker-schemas.ts b/packages/shared/src/worker-schemas.ts\nindex 36585fb07..3b65a4ff7 100644\n--- a/packages/shared/src/worker-schemas.ts\n+++ b/packages/shared/src/worker-schemas.ts\n@@ -55,6 +55,7 @@ export const WorkerTaskRunContextSchema = z.object({\n   taskRunToken: z.string(),\n   prompt: z.string(),\n   convexUrl: z.string(),\n+  isPreviewJob: z.boolean().optional(),\n });\n \n // Terminal operation schemas for server<>worker communication\n@@ -187,6 +188,12 @@ export const WorkerStartScreenshotCollectionSchema = z.object({\n   outputPath: z.string().optional(),\n });\n \n+export const WorkerRunTaskScreenshotsSchema = z.object({\n+  token: z.string(),\n+  anthropicApiKey: z.string().optional(),\n+  convexUrl: z.string().min(1).optional(),\n+});\n+\n // Server to Worker Events\n export const ServerToWorkerCommandSchema = z.object({\n   command: z.enum([\"create-terminal\", \"destroy-terminal\", \"execute-command\"]),\n@@ -219,6 +226,9 @@ export type WorkerExecResult = z.infer<typeof WorkerExecResultSchema>;\n export type WorkerStartScreenshotCollection = z.infer<\n   typeof WorkerStartScreenshotCollectionSchema\n >;\n+export type WorkerRunTaskScreenshots = z.infer<\n+  typeof WorkerRunTaskScreenshotsSchema\n+>;\n \n // Socket.io event maps for Server <-> Worker communication\n // Docker readiness response type\n@@ -260,6 +270,10 @@ export interface ServerToWorkerEvents {\n   \"worker:start-screenshot-collection\": (\n     data: WorkerStartScreenshotCollection | undefined\n   ) => void;\n+  \"worker:run-task-screenshots\": (\n+    data: WorkerRunTaskScreenshots,\n+    callback: (result: ErrorOr<{ success: true }>) => void\n+  ) => void;\n \n   // Management events\n   \"worker:terminal-assignment\": (data: TerminalAssignment) => void;\ndiff --git a/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts b/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts\nindex 2b05c7502..2b62b1d55 100644\n--- a/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts\n+++ b/packages/www-openapi-client/src/client/@tanstack/react-query.gen.ts\n@@ -1,8 +1,8 @@\n // This file is auto-generated by @hey-api/openapi-ts\n \n-import { type Options, getApiHealth, postApiAuthAnonymousSignUp, getApiUsers, postApiUsers, deleteApiUsersById, getApiUsersById, patchApiUsersById, getApiBooks, postApiBooks, getApiBooksById, postApiBooksByIdBorrow, postApiBooksByIdReturn, postApiDevServerStart, getApiIntegrationsGithubRepos, getApiIntegrationsGithubPrs, postApiIntegrationsGithubPrsBackfill, postApiIntegrationsGithubPrsBackfillRepo, getApiIntegrationsGithubPrsCode, postApiIntegrationsGithubPrsOpen, postApiIntegrationsGithubPrsMerge, postApiIntegrationsGithubPrsClose, postApiIntegrationsGithubPrsMergeSimple, getApiIntegrationsGithubPrsRaw, getApiIntegrationsGithubPrsFiles, getApiIntegrationsGithubPrsFileContents, postApiIntegrationsGithubPrsFileContentsBatch, postApiIntegrationsGithubInstallState, postApiMorphTaskRunsByTaskRunIdResume, postApiMorphTaskRunsByTaskRunIdIsPaused, postApiMorphSetupInstance, getApiEnvironments, postApiEnvironments, deleteApiEnvironmentsById, getApiEnvironmentsById, patchApiEnvironmentsById, getApiEnvironmentsByIdVars, patchApiEnvironmentsByIdPorts, getApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivate, postApiSandboxesStart, postApiSandboxesByIdEnv, postApiSandboxesByIdStop, getApiSandboxesByIdStatus, postApiSandboxesByIdPublishDevcontainer, postApiTeams, postApiBranchesGenerate, postApiCodeReviewStart, getApiWorkspaceConfigs, postApiWorkspaceConfigs } from '../sdk.gen.js';\n+import { type Options, getApiHealth, postApiAuthAnonymousSignUp, getApiUsers, postApiUsers, deleteApiUsersById, getApiUsersById, patchApiUsersById, getApiBooks, postApiBooks, getApiBooksById, postApiBooksByIdBorrow, postApiBooksByIdReturn, postApiDevServerStart, getApiIntegrationsGithubRepos, getApiIntegrationsGithubPrs, postApiIntegrationsGithubPrsBackfill, postApiIntegrationsGithubPrsBackfillRepo, getApiIntegrationsGithubPrsCode, postApiIntegrationsGithubPrsOpen, postApiIntegrationsGithubPrsMerge, postApiIntegrationsGithubPrsClose, postApiIntegrationsGithubPrsMergeSimple, getApiIntegrationsGithubPrsRaw, getApiIntegrationsGithubPrsFiles, getApiIntegrationsGithubPrsFileContents, postApiIntegrationsGithubPrsFileContentsBatch, postApiIntegrationsGithubInstallState, postApiMorphTaskRunsByTaskRunIdResume, postApiMorphTaskRunsByTaskRunIdIsPaused, postApiMorphSetupInstance, getApiEnvironments, postApiEnvironments, deleteApiEnvironmentsById, getApiEnvironmentsById, patchApiEnvironmentsById, getApiEnvironmentsByIdVars, patchApiEnvironmentsByIdPorts, getApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshots, postApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivate, postApiSandboxesStart, postApiSandboxesByIdEnv, postApiSandboxesByIdStop, getApiSandboxesByIdStatus, postApiSandboxesByIdPublishDevcontainer, postApiTeams, postApiBranchesGenerate, postApiCodeReviewStart, getApiWorkspaceConfigs, postApiWorkspaceConfigs, getApiPreviewConfigs, postApiPreviewConfigs, deleteApiPreviewConfigsByPreviewConfigId, getApiPreviewConfigsByPreviewConfigIdRuns } from '../sdk.gen.js';\n import { queryOptions, type UseMutationOptions, type DefaultError, infiniteQueryOptions, type InfiniteData } from '@tanstack/react-query';\n-import type { GetApiHealthData, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponse, GetApiUsersData, GetApiUsersResponse, PostApiUsersData, PostApiUsersError, PostApiUsersResponse, DeleteApiUsersByIdData, DeleteApiUsersByIdError, DeleteApiUsersByIdResponse, GetApiUsersByIdData, PatchApiUsersByIdData, PatchApiUsersByIdError, PatchApiUsersByIdResponse, GetApiBooksData, PostApiBooksData, PostApiBooksError, PostApiBooksResponse, GetApiBooksByIdData, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowError, PostApiBooksByIdBorrowResponse, PostApiBooksByIdReturnData, PostApiBooksByIdReturnError, PostApiBooksByIdReturnResponse, PostApiDevServerStartData, PostApiDevServerStartError, PostApiDevServerStartResponse, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponse, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponse, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillRepoData, GetApiIntegrationsGithubPrsCodeData, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponse, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponse, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponse, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponse, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFileContentsData, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponse, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponse, PostApiMorphTaskRunsByTaskRunIdResumeData, PostApiMorphTaskRunsByTaskRunIdResumeResponse, PostApiMorphTaskRunsByTaskRunIdIsPausedData, PostApiMorphTaskRunsByTaskRunIdIsPausedResponse, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponse, GetApiEnvironmentsData, PostApiEnvironmentsData, PostApiEnvironmentsResponse, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdData, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdVarsData, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponse, GetApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponse, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponse, PostApiSandboxesStartData, PostApiSandboxesStartResponse, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponse, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponse, GetApiSandboxesByIdStatusData, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponse, PostApiTeamsData, PostApiTeamsError, PostApiTeamsResponse, PostApiBranchesGenerateData, PostApiBranchesGenerateResponse, PostApiCodeReviewStartData, PostApiCodeReviewStartResponse, GetApiWorkspaceConfigsData, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponse } from '../types.gen.js';\n+import type { GetApiHealthData, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponse, GetApiUsersData, GetApiUsersResponse, PostApiUsersData, PostApiUsersError, PostApiUsersResponse, DeleteApiUsersByIdData, DeleteApiUsersByIdError, DeleteApiUsersByIdResponse, GetApiUsersByIdData, PatchApiUsersByIdData, PatchApiUsersByIdError, PatchApiUsersByIdResponse, GetApiBooksData, PostApiBooksData, PostApiBooksError, PostApiBooksResponse, GetApiBooksByIdData, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowError, PostApiBooksByIdBorrowResponse, PostApiBooksByIdReturnData, PostApiBooksByIdReturnError, PostApiBooksByIdReturnResponse, PostApiDevServerStartData, PostApiDevServerStartError, PostApiDevServerStartResponse, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponse, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponse, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillRepoData, GetApiIntegrationsGithubPrsCodeData, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponse, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponse, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponse, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponse, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFileContentsData, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponse, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponse, PostApiMorphTaskRunsByTaskRunIdResumeData, PostApiMorphTaskRunsByTaskRunIdResumeResponse, PostApiMorphTaskRunsByTaskRunIdIsPausedData, PostApiMorphTaskRunsByTaskRunIdIsPausedResponse, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponse, GetApiEnvironmentsData, PostApiEnvironmentsData, PostApiEnvironmentsResponse, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdData, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponse, GetApiEnvironmentsByIdVarsData, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponse, GetApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponse, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponse, PostApiSandboxesStartData, PostApiSandboxesStartResponse, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponse, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponse, GetApiSandboxesByIdStatusData, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponse, PostApiTeamsData, PostApiTeamsError, PostApiTeamsResponse, PostApiBranchesGenerateData, PostApiBranchesGenerateResponse, PostApiCodeReviewStartData, PostApiCodeReviewStartResponse, GetApiWorkspaceConfigsData, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponse, GetApiPreviewConfigsData, PostApiPreviewConfigsData, PostApiPreviewConfigsResponse, DeleteApiPreviewConfigsByPreviewConfigIdData, DeleteApiPreviewConfigsByPreviewConfigIdResponse, GetApiPreviewConfigsByPreviewConfigIdRunsData } from '../types.gen.js';\n import { client as _heyApiClient } from '../client.gen.js';\n \n export type QueryKey<TOptions extends Options> = [\n@@ -1058,4 +1058,78 @@ export const postApiWorkspaceConfigsMutation = (options?: Partial<Options<PostAp\n         }\n     };\n     return mutationOptions;\n+};\n+\n+export const getApiPreviewConfigsQueryKey = (options: Options<GetApiPreviewConfigsData>) => createQueryKey('getApiPreviewConfigs', options);\n+\n+/**\n+ * List preview configurations for a team\n+ */\n+export const getApiPreviewConfigsOptions = (options: Options<GetApiPreviewConfigsData>) => {\n+    return queryOptions({\n+        queryFn: async ({ queryKey, signal }) => {\n+            const { data } = await getApiPreviewConfigs({\n+                ...options,\n+                ...queryKey[0],\n+                signal,\n+                throwOnError: true\n+            });\n+            return data;\n+        },\n+        queryKey: getApiPreviewConfigsQueryKey(options)\n+    });\n+};\n+\n+/**\n+ * Create or update a preview configuration\n+ */\n+export const postApiPreviewConfigsMutation = (options?: Partial<Options<PostApiPreviewConfigsData>>): UseMutationOptions<PostApiPreviewConfigsResponse, DefaultError, Options<PostApiPreviewConfigsData>> => {\n+    const mutationOptions: UseMutationOptions<PostApiPreviewConfigsResponse, DefaultError, Options<PostApiPreviewConfigsData>> = {\n+        mutationFn: async (fnOptions) => {\n+            const { data } = await postApiPreviewConfigs({\n+                ...options,\n+                ...fnOptions,\n+                throwOnError: true\n+            });\n+            return data;\n+        }\n+    };\n+    return mutationOptions;\n+};\n+\n+/**\n+ * Delete a preview configuration\n+ */\n+export const deleteApiPreviewConfigsByPreviewConfigIdMutation = (options?: Partial<Options<DeleteApiPreviewConfigsByPreviewConfigIdData>>): UseMutationOptions<DeleteApiPreviewConfigsByPreviewConfigIdResponse, DefaultError, Options<DeleteApiPreviewConfigsByPreviewConfigIdData>> => {\n+    const mutationOptions: UseMutationOptions<DeleteApiPreviewConfigsByPreviewConfigIdResponse, DefaultError, Options<DeleteApiPreviewConfigsByPreviewConfigIdData>> = {\n+        mutationFn: async (fnOptions) => {\n+            const { data } = await deleteApiPreviewConfigsByPreviewConfigId({\n+                ...options,\n+                ...fnOptions,\n+                throwOnError: true\n+            });\n+            return data;\n+        }\n+    };\n+    return mutationOptions;\n+};\n+\n+export const getApiPreviewConfigsByPreviewConfigIdRunsQueryKey = (options: Options<GetApiPreviewConfigsByPreviewConfigIdRunsData>) => createQueryKey('getApiPreviewConfigsByPreviewConfigIdRuns', options);\n+\n+/**\n+ * List recent preview runs for a configuration\n+ */\n+export const getApiPreviewConfigsByPreviewConfigIdRunsOptions = (options: Options<GetApiPreviewConfigsByPreviewConfigIdRunsData>) => {\n+    return queryOptions({\n+        queryFn: async ({ queryKey, signal }) => {\n+            const { data } = await getApiPreviewConfigsByPreviewConfigIdRuns({\n+                ...options,\n+                ...queryKey[0],\n+                signal,\n+                throwOnError: true\n+            });\n+            return data;\n+        },\n+        queryKey: getApiPreviewConfigsByPreviewConfigIdRunsQueryKey(options)\n+    });\n };\n\\ No newline at end of file\ndiff --git a/packages/www-openapi-client/src/client/sdk.gen.ts b/packages/www-openapi-client/src/client/sdk.gen.ts\nindex 63478a358..a529cc467 100644\n--- a/packages/www-openapi-client/src/client/sdk.gen.ts\n+++ b/packages/www-openapi-client/src/client/sdk.gen.ts\n@@ -1,7 +1,7 @@\n // This file is auto-generated by @hey-api/openapi-ts\n \n import type { Options as ClientOptions, TDataShape, Client } from './client/index.js';\n-import type { GetApiHealthData, GetApiHealthResponses, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponses, PostApiAuthAnonymousSignUpErrors, GetApiUsersData, GetApiUsersResponses, PostApiUsersData, PostApiUsersResponses, PostApiUsersErrors, DeleteApiUsersByIdData, DeleteApiUsersByIdResponses, DeleteApiUsersByIdErrors, GetApiUsersByIdData, GetApiUsersByIdResponses, GetApiUsersByIdErrors, PatchApiUsersByIdData, PatchApiUsersByIdResponses, PatchApiUsersByIdErrors, GetApiBooksData, GetApiBooksResponses, PostApiBooksData, PostApiBooksResponses, PostApiBooksErrors, GetApiBooksByIdData, GetApiBooksByIdResponses, GetApiBooksByIdErrors, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowResponses, PostApiBooksByIdBorrowErrors, PostApiBooksByIdReturnData, PostApiBooksByIdReturnResponses, PostApiBooksByIdReturnErrors, PostApiDevServerStartData, PostApiDevServerStartResponses, PostApiDevServerStartErrors, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponses, GetApiIntegrationsGithubReposErrors, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponses, GetApiIntegrationsGithubPrsErrors, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillResponses, PostApiIntegrationsGithubPrsBackfillErrors, PostApiIntegrationsGithubPrsBackfillRepoData, PostApiIntegrationsGithubPrsBackfillRepoResponses, PostApiIntegrationsGithubPrsBackfillRepoErrors, GetApiIntegrationsGithubPrsCodeData, GetApiIntegrationsGithubPrsCodeResponses, GetApiIntegrationsGithubPrsCodeErrors, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponses, PostApiIntegrationsGithubPrsOpenErrors, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponses, PostApiIntegrationsGithubPrsMergeErrors, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponses, PostApiIntegrationsGithubPrsCloseErrors, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponses, PostApiIntegrationsGithubPrsMergeSimpleErrors, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsRawResponses, GetApiIntegrationsGithubPrsRawErrors, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFilesResponses, GetApiIntegrationsGithubPrsFilesErrors, GetApiIntegrationsGithubPrsFileContentsData, GetApiIntegrationsGithubPrsFileContentsResponses, GetApiIntegrationsGithubPrsFileContentsErrors, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponses, PostApiIntegrationsGithubPrsFileContentsBatchErrors, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponses, PostApiIntegrationsGithubInstallStateErrors, PostApiMorphTaskRunsByTaskRunIdResumeData, PostApiMorphTaskRunsByTaskRunIdResumeResponses, PostApiMorphTaskRunsByTaskRunIdResumeErrors, PostApiMorphTaskRunsByTaskRunIdIsPausedData, PostApiMorphTaskRunsByTaskRunIdIsPausedResponses, PostApiMorphTaskRunsByTaskRunIdIsPausedErrors, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponses, PostApiMorphSetupInstanceErrors, GetApiIframePreflightData, GetApiIframePreflightResponses, GetApiIframePreflightErrors, GetApiEnvironmentsData, GetApiEnvironmentsResponses, GetApiEnvironmentsErrors, PostApiEnvironmentsData, PostApiEnvironmentsResponses, PostApiEnvironmentsErrors, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponses, DeleteApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdData, GetApiEnvironmentsByIdResponses, GetApiEnvironmentsByIdErrors, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponses, PatchApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdVarsData, GetApiEnvironmentsByIdVarsResponses, GetApiEnvironmentsByIdVarsErrors, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponses, PatchApiEnvironmentsByIdPortsErrors, GetApiEnvironmentsByIdSnapshotsData, GetApiEnvironmentsByIdSnapshotsResponses, GetApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponses, PostApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponses, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateErrors, PostApiSandboxesStartData, PostApiSandboxesStartResponses, PostApiSandboxesStartErrors, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponses, PostApiSandboxesByIdEnvErrors, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponses, PostApiSandboxesByIdStopErrors, GetApiSandboxesByIdStatusData, GetApiSandboxesByIdStatusResponses, GetApiSandboxesByIdStatusErrors, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponses, PostApiSandboxesByIdPublishDevcontainerErrors, PostApiTeamsData, PostApiTeamsResponses, PostApiTeamsErrors, PostApiBranchesGenerateData, PostApiBranchesGenerateResponses, PostApiBranchesGenerateErrors, PostApiCodeReviewStartData, PostApiCodeReviewStartResponses, PostApiCodeReviewStartErrors, GetApiWorkspaceConfigsData, GetApiWorkspaceConfigsResponses, GetApiWorkspaceConfigsErrors, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponses, PostApiWorkspaceConfigsErrors } from './types.gen.js';\n+import type { GetApiHealthData, GetApiHealthResponses, PostApiAuthAnonymousSignUpData, PostApiAuthAnonymousSignUpResponses, PostApiAuthAnonymousSignUpErrors, GetApiUsersData, GetApiUsersResponses, PostApiUsersData, PostApiUsersResponses, PostApiUsersErrors, DeleteApiUsersByIdData, DeleteApiUsersByIdResponses, DeleteApiUsersByIdErrors, GetApiUsersByIdData, GetApiUsersByIdResponses, GetApiUsersByIdErrors, PatchApiUsersByIdData, PatchApiUsersByIdResponses, PatchApiUsersByIdErrors, GetApiBooksData, GetApiBooksResponses, PostApiBooksData, PostApiBooksResponses, PostApiBooksErrors, GetApiBooksByIdData, GetApiBooksByIdResponses, GetApiBooksByIdErrors, PostApiBooksByIdBorrowData, PostApiBooksByIdBorrowResponses, PostApiBooksByIdBorrowErrors, PostApiBooksByIdReturnData, PostApiBooksByIdReturnResponses, PostApiBooksByIdReturnErrors, PostApiDevServerStartData, PostApiDevServerStartResponses, PostApiDevServerStartErrors, GetApiIntegrationsGithubReposData, GetApiIntegrationsGithubReposResponses, GetApiIntegrationsGithubReposErrors, GetApiIntegrationsGithubPrsData, GetApiIntegrationsGithubPrsResponses, GetApiIntegrationsGithubPrsErrors, PostApiIntegrationsGithubPrsBackfillData, PostApiIntegrationsGithubPrsBackfillResponses, PostApiIntegrationsGithubPrsBackfillErrors, PostApiIntegrationsGithubPrsBackfillRepoData, PostApiIntegrationsGithubPrsBackfillRepoResponses, PostApiIntegrationsGithubPrsBackfillRepoErrors, GetApiIntegrationsGithubPrsCodeData, GetApiIntegrationsGithubPrsCodeResponses, GetApiIntegrationsGithubPrsCodeErrors, PostApiIntegrationsGithubPrsOpenData, PostApiIntegrationsGithubPrsOpenResponses, PostApiIntegrationsGithubPrsOpenErrors, PostApiIntegrationsGithubPrsMergeData, PostApiIntegrationsGithubPrsMergeResponses, PostApiIntegrationsGithubPrsMergeErrors, PostApiIntegrationsGithubPrsCloseData, PostApiIntegrationsGithubPrsCloseResponses, PostApiIntegrationsGithubPrsCloseErrors, PostApiIntegrationsGithubPrsMergeSimpleData, PostApiIntegrationsGithubPrsMergeSimpleResponses, PostApiIntegrationsGithubPrsMergeSimpleErrors, GetApiIntegrationsGithubPrsRawData, GetApiIntegrationsGithubPrsRawResponses, GetApiIntegrationsGithubPrsRawErrors, GetApiIntegrationsGithubPrsFilesData, GetApiIntegrationsGithubPrsFilesResponses, GetApiIntegrationsGithubPrsFilesErrors, GetApiIntegrationsGithubPrsFileContentsData, GetApiIntegrationsGithubPrsFileContentsResponses, GetApiIntegrationsGithubPrsFileContentsErrors, PostApiIntegrationsGithubPrsFileContentsBatchData, PostApiIntegrationsGithubPrsFileContentsBatchResponses, PostApiIntegrationsGithubPrsFileContentsBatchErrors, PostApiIntegrationsGithubInstallStateData, PostApiIntegrationsGithubInstallStateResponses, PostApiIntegrationsGithubInstallStateErrors, PostApiMorphTaskRunsByTaskRunIdResumeData, PostApiMorphTaskRunsByTaskRunIdResumeResponses, PostApiMorphTaskRunsByTaskRunIdResumeErrors, PostApiMorphTaskRunsByTaskRunIdIsPausedData, PostApiMorphTaskRunsByTaskRunIdIsPausedResponses, PostApiMorphTaskRunsByTaskRunIdIsPausedErrors, PostApiMorphSetupInstanceData, PostApiMorphSetupInstanceResponses, PostApiMorphSetupInstanceErrors, GetApiIframePreflightData, GetApiIframePreflightResponses, GetApiIframePreflightErrors, GetApiEnvironmentsData, GetApiEnvironmentsResponses, GetApiEnvironmentsErrors, PostApiEnvironmentsData, PostApiEnvironmentsResponses, PostApiEnvironmentsErrors, DeleteApiEnvironmentsByIdData, DeleteApiEnvironmentsByIdResponses, DeleteApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdData, GetApiEnvironmentsByIdResponses, GetApiEnvironmentsByIdErrors, PatchApiEnvironmentsByIdData, PatchApiEnvironmentsByIdResponses, PatchApiEnvironmentsByIdErrors, GetApiEnvironmentsByIdVarsData, GetApiEnvironmentsByIdVarsResponses, GetApiEnvironmentsByIdVarsErrors, PatchApiEnvironmentsByIdPortsData, PatchApiEnvironmentsByIdPortsResponses, PatchApiEnvironmentsByIdPortsErrors, GetApiEnvironmentsByIdSnapshotsData, GetApiEnvironmentsByIdSnapshotsResponses, GetApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsData, PostApiEnvironmentsByIdSnapshotsResponses, PostApiEnvironmentsByIdSnapshotsErrors, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateData, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateResponses, PostApiEnvironmentsByIdSnapshotsBySnapshotVersionIdActivateErrors, PostApiSandboxesStartData, PostApiSandboxesStartResponses, PostApiSandboxesStartErrors, PostApiSandboxesByIdEnvData, PostApiSandboxesByIdEnvResponses, PostApiSandboxesByIdEnvErrors, PostApiSandboxesByIdStopData, PostApiSandboxesByIdStopResponses, PostApiSandboxesByIdStopErrors, GetApiSandboxesByIdStatusData, GetApiSandboxesByIdStatusResponses, GetApiSandboxesByIdStatusErrors, PostApiSandboxesByIdPublishDevcontainerData, PostApiSandboxesByIdPublishDevcontainerResponses, PostApiSandboxesByIdPublishDevcontainerErrors, PostApiTeamsData, PostApiTeamsResponses, PostApiTeamsErrors, PostApiBranchesGenerateData, PostApiBranchesGenerateResponses, PostApiBranchesGenerateErrors, PostApiCodeReviewStartData, PostApiCodeReviewStartResponses, PostApiCodeReviewStartErrors, GetApiWorkspaceConfigsData, GetApiWorkspaceConfigsResponses, GetApiWorkspaceConfigsErrors, PostApiWorkspaceConfigsData, PostApiWorkspaceConfigsResponses, PostApiWorkspaceConfigsErrors, GetApiPreviewConfigsData, GetApiPreviewConfigsResponses, GetApiPreviewConfigsErrors, PostApiPreviewConfigsData, PostApiPreviewConfigsResponses, PostApiPreviewConfigsErrors, DeleteApiPreviewConfigsByPreviewConfigIdData, DeleteApiPreviewConfigsByPreviewConfigIdResponses, DeleteApiPreviewConfigsByPreviewConfigIdErrors, GetApiPreviewConfigsByPreviewConfigIdRunsData, GetApiPreviewConfigsByPreviewConfigIdRunsResponses, GetApiPreviewConfigsByPreviewConfigIdRunsErrors } from './types.gen.js';\n import { client as _heyApiClient } from './client.gen.js';\n \n export type Options<TData extends TDataShape = TDataShape, ThrowOnError extends boolean = boolean> = ClientOptions<TData, ThrowOnError> & {\n@@ -635,4 +635,48 @@ export const postApiWorkspaceConfigs = <ThrowOnError extends boolean = false>(op\n             ...options.headers\n         }\n     });\n+};\n+\n+/**\n+ * List preview configurations for a team\n+ */\n+export const getApiPreviewConfigs = <ThrowOnError extends boolean = false>(options: Options<GetApiPreviewConfigsData, ThrowOnError>) => {\n+    return (options.client ?? _heyApiClient).get<GetApiPreviewConfigsResponses, GetApiPreviewConfigsErrors, ThrowOnError>({\n+        url: '/api/preview/configs',\n+        ...options\n+    });\n+};\n+\n+/**\n+ * Create or update a preview configuration\n+ */\n+export const postApiPreviewConfigs = <ThrowOnError extends boolean = false>(options: Options<PostApiPreviewConfigsData, ThrowOnError>) => {\n+    return (options.client ?? _heyApiClient).post<PostApiPreviewConfigsResponses, PostApiPreviewConfigsErrors, ThrowOnError>({\n+        url: '/api/preview/configs',\n+        ...options,\n+        headers: {\n+            'Content-Type': 'application/json',\n+            ...options.headers\n+        }\n+    });\n+};\n+\n+/**\n+ * Delete a preview configuration\n+ */\n+export const deleteApiPreviewConfigsByPreviewConfigId = <ThrowOnError extends boolean = false>(options: Options<DeleteApiPreviewConfigsByPreviewConfigIdData, ThrowOnError>) => {\n+    return (options.client ?? _heyApiClient).delete<DeleteApiPreviewConfigsByPreviewConfigIdResponses, DeleteApiPreviewConfigsByPreviewConfigIdErrors, ThrowOnError>({\n+        url: '/api/preview/configs/{previewConfigId}',\n+        ...options\n+    });\n+};\n+\n+/**\n+ * List recent preview runs for a configuration\n+ */\n+export const getApiPreviewConfigsByPreviewConfigIdRuns = <ThrowOnError extends boolean = false>(options: Options<GetApiPreviewConfigsByPreviewConfigIdRunsData, ThrowOnError>) => {\n+    return (options.client ?? _heyApiClient).get<GetApiPreviewConfigsByPreviewConfigIdRunsResponses, GetApiPreviewConfigsByPreviewConfigIdRunsErrors, ThrowOnError>({\n+        url: '/api/preview/configs/{previewConfigId}/runs',\n+        ...options\n+    });\n };\n\\ No newline at end of file\ndiff --git a/packages/www-openapi-client/src/client/types.gen.ts b/packages/www-openapi-client/src/client/types.gen.ts\nindex da1c1de56..e454f1a45 100644\n--- a/packages/www-openapi-client/src/client/types.gen.ts\n+++ b/packages/www-openapi-client/src/client/types.gen.ts\n@@ -337,6 +337,7 @@ export type GithubPrsFileContentsBatchBody = {\n \n export type GithubInstallStateResponse = {\n     state: string;\n+    installUrl: string;\n };\n \n export type GithubInstallStateRequest = {\n@@ -378,7 +379,7 @@ export type SetupInstanceBody = {\n     instanceId?: string;\n     selectedRepos?: Array<string>;\n     ttlSeconds?: number;\n-    snapshotId?: string | ('snapshot_svdf7qmg' | 'snapshot_i57mwbv2');\n+    snapshotId?: string | ('snapshot_u00k1p82' | 'snapshot_8b1361wp' | 'snapshot_pcmfvjra');\n };\n \n export type CreateEnvironmentResponse = {\n@@ -639,6 +640,51 @@ export type WorkspaceConfigBody = {\n     envVarsContent?: string;\n };\n \n+export type PreviewConfig = {\n+    id: string;\n+    repoFullName: string;\n+    environmentId?: string | null;\n+    repoInstallationId?: number | null;\n+    repoDefaultBranch?: string | null;\n+    status: 'active' | 'paused' | 'disabled';\n+    lastRunAt?: number | null;\n+    createdAt: number;\n+    updatedAt: number;\n+};\n+\n+export type PreviewConfigListResponse = {\n+    configs: Array<PreviewConfig>;\n+};\n+\n+export type PreviewConfigMutationBody = {\n+    previewConfigId?: string;\n+    teamSlugOrId: string;\n+    repoFullName: string;\n+    environmentId?: string;\n+    repoInstallationId?: number;\n+    repoDefaultBranch?: string;\n+    status?: 'active' | 'paused' | 'disabled';\n+};\n+\n+export type PreviewRun = {\n+    id: string;\n+    prNumber: number;\n+    prUrl: string;\n+    headSha: string;\n+    baseSha?: string | null;\n+    status: 'pending' | 'running' | 'completed' | 'failed' | 'skipped';\n+    stateReason?: string | null;\n+    createdAt: number;\n+    updatedAt: number;\n+    dispatchedAt?: number | null;\n+    startedAt?: number | null;\n+    completedAt?: number | null;\n+};\n+\n+export type PreviewRunsResponse = {\n+    runs: Array<PreviewRun>;\n+};\n+\n export type GetApiHealthData = {\n     body?: never;\n     path?: never;\n@@ -2383,6 +2429,115 @@ export type PostApiWorkspaceConfigsResponses = {\n \n export type PostApiWorkspaceConfigsResponse = PostApiWorkspaceConfigsResponses[keyof PostApiWorkspaceConfigsResponses];\n \n+export type GetApiPreviewConfigsData = {\n+    body?: never;\n+    path?: never;\n+    query: {\n+        teamSlugOrId: string;\n+    };\n+    url: '/api/preview/configs';\n+};\n+\n+export type GetApiPreviewConfigsErrors = {\n+    /**\n+     * Unauthorized\n+     */\n+    401: unknown;\n+};\n+\n+export type GetApiPreviewConfigsResponses = {\n+    /**\n+     * Configurations fetched\n+     */\n+    200: PreviewConfigListResponse;\n+};\n+\n+export type GetApiPreviewConfigsResponse = GetApiPreviewConfigsResponses[keyof GetApiPreviewConfigsResponses];\n+\n+export type PostApiPreviewConfigsData = {\n+    body: PreviewConfigMutationBody;\n+    path?: never;\n+    query?: never;\n+    url: '/api/preview/configs';\n+};\n+\n+export type PostApiPreviewConfigsErrors = {\n+    /**\n+     * Unauthorized\n+     */\n+    401: unknown;\n+};\n+\n+export type PostApiPreviewConfigsResponses = {\n+    /**\n+     * Configuration saved\n+     */\n+    200: PreviewConfig;\n+};\n+\n+export type PostApiPreviewConfigsResponse = PostApiPreviewConfigsResponses[keyof PostApiPreviewConfigsResponses];\n+\n+export type DeleteApiPreviewConfigsByPreviewConfigIdData = {\n+    body?: never;\n+    path: {\n+        previewConfigId: string;\n+    };\n+    query: {\n+        teamSlugOrId: string;\n+    };\n+    url: '/api/preview/configs/{previewConfigId}';\n+};\n+\n+export type DeleteApiPreviewConfigsByPreviewConfigIdErrors = {\n+    /**\n+     * Unauthorized\n+     */\n+    401: unknown;\n+    /**\n+     * Not found\n+     */\n+    404: unknown;\n+};\n+\n+export type DeleteApiPreviewConfigsByPreviewConfigIdResponses = {\n+    /**\n+     * Deleted\n+     */\n+    200: {\n+        id: string;\n+    };\n+};\n+\n+export type DeleteApiPreviewConfigsByPreviewConfigIdResponse = DeleteApiPreviewConfigsByPreviewConfigIdResponses[keyof DeleteApiPreviewConfigsByPreviewConfigIdResponses];\n+\n+export type GetApiPreviewConfigsByPreviewConfigIdRunsData = {\n+    body?: never;\n+    path: {\n+        previewConfigId: string;\n+    };\n+    query: {\n+        teamSlugOrId: string;\n+        limit?: number;\n+    };\n+    url: '/api/preview/configs/{previewConfigId}/runs';\n+};\n+\n+export type GetApiPreviewConfigsByPreviewConfigIdRunsErrors = {\n+    /**\n+     * Unauthorized\n+     */\n+    401: unknown;\n+};\n+\n+export type GetApiPreviewConfigsByPreviewConfigIdRunsResponses = {\n+    /**\n+     * Runs fetched\n+     */\n+    200: PreviewRunsResponse;\n+};\n+\n+export type GetApiPreviewConfigsByPreviewConfigIdRunsResponse = GetApiPreviewConfigsByPreviewConfigIdRunsResponses[keyof GetApiPreviewConfigsByPreviewConfigIdRunsResponses];\n+\n export type ClientOptions = {\n     baseUrl: `${string}://${string}` | (string & {});\n };\n\\ No newline at end of file\n","comments":[{"type":"issue_comment","id":3549605917,"prNumber":949,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 11 screenshot(s) for commit `15ae096`:\n\n### preview-configure-form-sections-HEAD.png\n![preview-configure-form-sections-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/ab12dd24-131b-4b53-99cb-aa4f5b0e71bd)\n\n### preview-configure-full-loaded-HEAD.png\n![preview-configure-full-loaded-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/2499a6e3-6a7a-4b2e-9d7e-f86f4822c965)\n\n### preview-configure-provisioning-full-HEAD.png\n![preview-configure-provisioning-full-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/8b8c516c-ee6e-4f9e-aeff-9642e7d30dac)\n\n### preview-configure-provisioning-viewport-HEAD.png\n![preview-configure-provisioning-viewport-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/4bbae354-a126-44bb-9d3a-70797b7fe244)\n\n### preview-configure-top-view-HEAD.png\n![preview-configure-top-view-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/964acb9c-a8f5-4919-b98a-50bedd84f381)\n\n### preview-configure-viewport-loaded-HEAD.png\n![preview-configure-viewport-loaded-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/a8277224-d0b6-407f-a30a-dc1013afc0b0)\n\n### preview-get-started-full-HEAD.png\n![preview-get-started-full-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/e2c904f9-1818-496c-98e0-87a1b7d76bd6)\n\n### preview-get-started-teams-HEAD.png\n![preview-get-started-teams-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/c14fd765-9cd8-48eb-91a1-330547824b20)\n\n### preview-get-started-viewport-HEAD.png\n![preview-get-started-viewport-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/441d25d1-295d-4f66-ad93-4f7a7f68f607)\n\n### preview-landing-page-HEAD.png\n![preview-landing-page-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/641e434b-7019-457b-a730-2144a4d1b781)\n\n### preview-landing-viewport-HEAD.png\n![preview-landing-viewport-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/e43982f0-1dbd-4c98-84ca-20613834a876)\n\n\n---\n_Generated by [cmux](https://cmux.sh) preview system_","commitSha":"a5f3a9ca1ddb54c9a5a38b8c076ba32f5729bed1","createdAt":"2025-11-18T22:01:03Z","updatedAt":"2025-11-18T22:01:03Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/949#issuecomment-3549605917"},{"type":"issue_comment","id":3549750780,"prNumber":949,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 4 screenshot(s) for commit `904b4b5`:\n\n### preview-configure-page-provisioning-HEAD.png\n![preview-configure-page-provisioning-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/bd8dec08-282e-44ac-a319-ccb9649b32e7)\n\n### preview-get-started-page-HEAD.png\n![preview-get-started-page-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/a40354c8-788b-4659-a98f-57cad03d8952)\n\n### preview-landing-hero-section-HEAD.png\n![preview-landing-hero-section-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/238c3740-b7ae-4455-82ce-288cc8a5ee89)\n\n### preview-landing-page-HEAD.png\n![preview-landing-page-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/4a402269-c385-4dc5-a5c0-89ae8d082a9d)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"a5f3a9ca1ddb54c9a5a38b8c076ba32f5729bed1","createdAt":"2025-11-18T22:48:49Z","updatedAt":"2025-11-18T22:48:49Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/949#issuecomment-3549750780"},{"type":"issue_comment","id":3561232466,"prNumber":949,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 8 screenshot(s) for commit `19bf25d`:\n\n### client-dashboard-full-HEAD.png\n![client-dashboard-full-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/bdeffb1d-5a02-49a5-a7c6-78125e97917c)\n\n### client-dashboard-viewport-HEAD.png\n![client-dashboard-viewport-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/da6ccb0d-5d70-4eb4-9b87-a7f5dbe728b9)\n\n### preview-configure-provisioning-full-HEAD.png\n![preview-configure-provisioning-full-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/e8ff0f03-c51b-4c62-a0bf-6bf64a9d1a3d)\n\n### preview-configure-provisioning-viewport-HEAD.png\n![preview-configure-provisioning-viewport-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/f0c6d573-1a70-4805-b2e1-a45a10b097b4)\n\n### preview-dashboard-full-HEAD.png\n![preview-dashboard-full-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/1d0ea57f-a6ec-4d9e-afac-99279577c329)\n\n### preview-dashboard-header-HEAD.png\n![preview-dashboard-header-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/774e15e2-8c10-4950-8bae-3eeccd775e8e)\n\n### preview-dashboard-scrolled-HEAD.png\n![preview-dashboard-scrolled-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/57ee3a3d-4a21-49ea-8f9a-2cdafb0722e1)\n\n### preview-dashboard-viewport-HEAD.png\n![preview-dashboard-viewport-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/6faf4add-fd11-4520-9c8e-7b0dfb59f388)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"a5f3a9ca1ddb54c9a5a38b8c076ba32f5729bed1","createdAt":"2025-11-21T03:44:46Z","updatedAt":"2025-11-21T03:44:46Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/949#issuecomment-3561232466"},{"type":"issue_comment","id":3564625983,"prNumber":949,"botLogin":"cmux-agent-internal-dev[bot]","body":"## Preview Screenshots\n\nSuccessfully captured 13 screenshot(s) for commit `01e6f70`:\n\n### preview-benefits-section-HEAD.png\n![preview-benefits-section-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/5576e04c-0454-424d-b80c-79ac04fe05ce)\n\n### preview-configure-provisioning-HEAD.png\n![preview-configure-provisioning-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/367e193e-f0dc-4f29-9700-1ddb2e30643c)\n\n### preview-dashboard-HEAD.png\n![preview-dashboard-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/42cf8943-d125-492e-a7a9-f1545912bc6c)\n\n### preview-dashboard-scrolled-HEAD.png\n![preview-dashboard-scrolled-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/b77b26b8-3f6c-4218-b87b-4b44c03cfc73)\n\n### preview-hero-section-HEAD.png\n![preview-hero-section-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/1e7a2a9c-50d4-4566-a8bd-b9bb11f24f05)\n\n### preview-how-it-works-HEAD.png\n![preview-how-it-works-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/57117c84-ce59-41e0-a580-6680060b0d31)\n\n### preview-import-section-HEAD.png\n![preview-import-section-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/5271937b-bdac-446e-897b-16aa6e5fc4a0)\n\n### preview-marketing-cta-HEAD.png\n![preview-marketing-cta-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/42ec6e6b-1634-42fb-ac08-835a560c0f35)\n\n### preview-marketing-features-HEAD.png\n![preview-marketing-features-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/89b7b131-4407-4a59-94a3-e92be7c29833)\n\n### preview-marketing-hero-HEAD.png\n![preview-marketing-hero-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/8c14c1f2-f2d5-48af-9426-fa6336be7b7d)\n\n### preview-marketing-how-it-works-HEAD.png\n![preview-marketing-how-it-works-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/b5044d95-62e9-48f1-a26b-d7e3217d7ce1)\n\n### preview-marketing-page-HEAD.png\n![preview-marketing-page-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/cad1c2ef-21de-48b9-a4ff-97ca51199428)\n\n### preview-search-bar-HEAD.png\n![preview-search-bar-HEAD.png](https://famous-camel-162.convex.cloud/api/storage/5e7c7295-5a6c-4015-a8b7-e21e1330ac66)\n\n\n---\n_Generated by [cmux](https://cmux.dev) preview system_","commitSha":"a5f3a9ca1ddb54c9a5a38b8c076ba32f5729bed1","createdAt":"2025-11-21T21:20:41Z","updatedAt":"2025-11-21T21:20:41Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/949#issuecomment-3564625983"}]}
{"number":937,"title":"Surface relevant TaskRun on PR URL paste","state":"open","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/937","headRef":"cmux/surface-relevant-task-run-on-pr-url-paste-39w5j","headSha":"e686f2e17c858a09beca80e86f20d5b5dc043099","baseRef":"main","baseSha":"6c563c766487c5a26628381017114187de88ca78","createdAt":"2025-11-11T06:38:22Z","updatedAt":"2025-11-11T07:20:34Z","diff":"diff --git a/apps/client/src/components/CommandBar.tsx b/apps/client/src/components/CommandBar.tsx\nindex b3b013939..e4061a004 100644\n--- a/apps/client/src/components/CommandBar.tsx\n+++ b/apps/client/src/components/CommandBar.tsx\n@@ -196,6 +196,198 @@ type FocusSnapshot = {\n   };\n };\n \n+const MAX_TASK_COMMAND_ENTRIES = 9;\n+\n+const GITHUB_PULL_REQUEST_URL_RE =\n+  /(?:https?:\\/\\/)?(?:www\\.)?github\\.com\\/([^/\\s]+)\\/([^/\\s]+)\\/pull\\/(\\d+)/i;\n+\n+type CommandBarTask =\n+  (typeof api.tasks.getTasksWithTaskRuns._returnType)[number];\n+type CommandBarTaskRun = NonNullable<CommandBarTask[\"selectedTaskRun\"]>;\n+\n+type GithubPullRequestIdentifier = {\n+  repoOwner: string;\n+  repoName: string;\n+  repoFullName: string;\n+  normalizedRepoFullName: string;\n+  number: number;\n+  url: string;\n+};\n+\n+type PullRequestMatchResult = {\n+  repoFullName: string;\n+  normalizedRepoFullName: string;\n+  number: number;\n+  url: string;\n+  identifier: string;\n+};\n+\n+type TaskRunPullRequestMatch = {\n+  task: CommandBarTask;\n+  run: CommandBarTaskRun;\n+  match: PullRequestMatchResult;\n+};\n+\n+type PullRequestCandidate = {\n+  repoFullName?: string | null;\n+  number?: number | null;\n+  url?: string | null;\n+};\n+\n+const sanitizeRepoFullNameValue = (value?: string | null) => {\n+  if (!value) {\n+    return null;\n+  }\n+  const trimmed = value.trim();\n+  if (!trimmed) {\n+    return null;\n+  }\n+  return trimmed.replace(/\\.git$/i, \"\");\n+};\n+\n+const normalizeRepoFullName = (value?: string | null) => {\n+  const sanitized = sanitizeRepoFullNameValue(value);\n+  return sanitized ? sanitized.toLowerCase() : null;\n+};\n+\n+const parseGitHubPullRequestFromText = (\n+  text: string\n+): GithubPullRequestIdentifier | null => {\n+  if (!text) {\n+    return null;\n+  }\n+  const match = text.match(GITHUB_PULL_REQUEST_URL_RE);\n+  if (!match) {\n+    return null;\n+  }\n+  const [, ownerRaw, repoRaw, numberRaw] = match;\n+  const owner = ownerRaw.trim();\n+  const repo = repoRaw.trim().replace(/\\.git$/i, \"\");\n+  const number = Number.parseInt(numberRaw, 10);\n+  if (!owner || !repo || Number.isNaN(number)) {\n+    return null;\n+  }\n+  const repoFullName = `${owner}/${repo}`;\n+  const normalizedRepoFullName = normalizeRepoFullName(repoFullName);\n+  if (!normalizedRepoFullName) {\n+    return null;\n+  }\n+  return {\n+    repoOwner: owner,\n+    repoName: repo,\n+    repoFullName,\n+    normalizedRepoFullName,\n+    number,\n+    url: `https://github.com/${repoFullName}/pull/${number}`,\n+  };\n+};\n+\n+const buildPullRequestCandidates = (\n+  task: CommandBarTask,\n+  run: CommandBarTaskRun\n+): PullRequestCandidate[] => {\n+  const candidates: PullRequestCandidate[] = [];\n+  if (Array.isArray(run.pullRequests)) {\n+    for (const pr of run.pullRequests) {\n+      candidates.push({\n+        repoFullName: pr.repoFullName,\n+        number: typeof pr.number === \"number\" ? pr.number : undefined,\n+        url: pr.url,\n+      });\n+    }\n+  }\n+\n+  if (run.pullRequestUrl) {\n+    candidates.push({ url: run.pullRequestUrl });\n+  }\n+\n+  if (\n+    typeof run.pullRequestNumber === \"number\" &&\n+    typeof task.projectFullName === \"string\" &&\n+    task.projectFullName.trim().length > 0\n+  ) {\n+    candidates.push({\n+      repoFullName: task.projectFullName,\n+      number: run.pullRequestNumber,\n+    });\n+  }\n+\n+  return candidates;\n+};\n+\n+const normalizePullRequestCandidate = (\n+  candidate: PullRequestCandidate\n+): PullRequestMatchResult | null => {\n+  const parsedFromUrl = candidate.url\n+    ? parseGitHubPullRequestFromText(candidate.url)\n+    : null;\n+\n+  const repoFromCandidate = sanitizeRepoFullNameValue(\n+    candidate.repoFullName ?? undefined\n+  );\n+  const repoFullName = repoFromCandidate ?? parsedFromUrl?.repoFullName ?? null;\n+  const normalizedRepoFullName = normalizeRepoFullName(\n+    repoFullName ?? undefined\n+  );\n+  const numberFromCandidate =\n+    typeof candidate.number === \"number\" && Number.isFinite(candidate.number)\n+      ? candidate.number\n+      : null;\n+  const number = numberFromCandidate ?? parsedFromUrl?.number ?? null;\n+\n+  if (!repoFullName || !normalizedRepoFullName || typeof number !== \"number\") {\n+    return null;\n+  }\n+\n+  const url =\n+    candidate.url ??\n+    parsedFromUrl?.url ??\n+    `https://github.com/${repoFullName}/pull/${number}`;\n+\n+  return {\n+    repoFullName,\n+    normalizedRepoFullName,\n+    number,\n+    url,\n+    identifier: `${repoFullName}#${number}`,\n+  };\n+};\n+\n+const findMatchingTaskRunForPullRequest = (\n+  tasks: CommandBarTask[] | undefined,\n+  target: GithubPullRequestIdentifier | null\n+): TaskRunPullRequestMatch | null => {\n+  if (!tasks || tasks.length === 0 || !target) {\n+    return null;\n+  }\n+  const normalizedTargetRepo = target.normalizedRepoFullName;\n+  if (!normalizedTargetRepo) {\n+    return null;\n+  }\n+\n+  for (const task of tasks) {\n+    const run = task.selectedTaskRun;\n+    if (!run) continue;\n+    const candidates = buildPullRequestCandidates(task, run);\n+    for (const candidate of candidates) {\n+      const normalized = normalizePullRequestCandidate(candidate);\n+      if (\n+        normalized &&\n+        normalized.normalizedRepoFullName === normalizedTargetRepo &&\n+        normalized.number === target.number\n+      ) {\n+        return {\n+          task,\n+          run,\n+          match: normalized,\n+        };\n+      }\n+    }\n+  }\n+\n+  return null;\n+};\n+\n function VirtualizedCommandItems({\n   entries,\n   virtualizer,\n@@ -662,6 +854,34 @@ export function CommandBar({\n     : \"Sign in to view teams.\";\n \n   const allTasks = useQuery(api.tasks.getTasksWithTaskRuns, { teamSlugOrId });\n+  const githubPullRequestTarget = useMemo(\n+    () => parseGitHubPullRequestFromText(search),\n+    [search]\n+  );\n+  const matchingTaskRun = useMemo(\n+    () => findMatchingTaskRunForPullRequest(allTasks, githubPullRequestTarget),\n+    [allTasks, githubPullRequestTarget]\n+  );\n+  const tasksForCommandEntries = useMemo<CommandBarTask[]>(() => {\n+    if (!allTasks || allTasks.length === 0) {\n+      return [];\n+    }\n+    if (!matchingTaskRun) {\n+      return allTasks.slice(0, MAX_TASK_COMMAND_ENTRIES);\n+    }\n+    const prioritized: CommandBarTask[] = [];\n+    const seen = new Set<Id<\"tasks\">>();\n+    prioritized.push(matchingTaskRun.task);\n+    seen.add(matchingTaskRun.task._id);\n+    for (const task of allTasks) {\n+      if (seen.has(task._id)) continue;\n+      prioritized.push(task);\n+      if (prioritized.length >= MAX_TASK_COMMAND_ENTRIES) {\n+        break;\n+      }\n+    }\n+    return prioritized;\n+  }, [allTasks, matchingTaskRun]);\n   const reserveLocalWorkspace = useMutation(api.localWorkspaces.reserve);\n   const createTask = useMutation(api.tasks.create);\n   const failTaskRun = useMutation(api.taskRuns.fail);\n@@ -1772,18 +1992,38 @@ export function CommandBar({\n     ];\n \n     const taskEntries =\n-      allTasks && allTasks.length > 0\n-        ? allTasks.slice(0, 9).flatMap<CommandListEntry>((task, index) => {\n-            const title =\n+      tasksForCommandEntries.length > 0\n+        ? tasksForCommandEntries.flatMap<CommandListEntry>((task, index) => {\n+            const isMatchedTask = matchingTaskRun?.task._id === task._id;\n+            const matchIdentifier = isMatchedTask\n+              ? matchingTaskRun.match.identifier\n+              : null;\n+            const matchUrl = isMatchedTask ? matchingTaskRun.match.url : null;\n+            const matchKeywords = isMatchedTask\n+              ? compactStrings([\n+                  matchingTaskRun.match.repoFullName,\n+                  matchingTaskRun.match.identifier,\n+                  `${matchingTaskRun.match.number}`,\n+                  `#${matchingTaskRun.match.number}`,\n+                  matchUrl ?? undefined,\n+                ])\n+              : [];\n+            const baseTitle =\n               task.pullRequestTitle || task.text || `Task ${index + 1}`;\n+            const displayTitle =\n+              isMatchedTask && matchIdentifier\n+                ? `${baseTitle} (${matchIdentifier})`\n+                : baseTitle;\n             const keywords = compactStrings([\n-              title,\n+              baseTitle,\n               task.text,\n               task.pullRequestTitle,\n               `task ${index + 1}`,\n+              ...matchKeywords,\n             ]);\n-            const baseSearch = buildSearchText(title, keywords, [\n+            const baseSearch = buildSearchText(displayTitle, keywords, [\n               `${index + 1}`,\n+              matchUrl ?? undefined,\n             ]);\n             const statusLabel = task.isCompleted ? \"completed\" : \"in progress\";\n             const statusClassName = task.isCompleted\n@@ -1794,7 +2034,7 @@ export function CommandBar({\n             const entriesForTask: CommandListEntry[] = [\n               {\n                 value: `${index + 1}:task:${task._id}`,\n-                label: title,\n+                label: displayTitle,\n                 keywords,\n                 searchText: baseSearch,\n                 className: taskCommandItemClassName,\n@@ -1804,7 +2044,9 @@ export function CommandBar({\n                     <span className=\"flex h-5 w-5 items-center justify-center rounded text-xs font-semibold bg-neutral-200 dark:bg-neutral-700 text-neutral-600 dark:text-neutral-300 group-data-[selected=true]:bg-neutral-300 dark:group-data-[selected=true]:bg-neutral-600\">\n                       {index + 1}\n                     </span>\n-                    <span className=\"flex-1 truncate text-sm\">{title}</span>\n+                    <span className=\"flex-1 truncate text-sm\">\n+                      {displayTitle}\n+                    </span>\n                     <span className={statusClassName}>{statusLabel}</span>\n                   </>\n                 ),\n@@ -1815,12 +2057,13 @@ export function CommandBar({\n               const vsKeywords = [...keywords, \"vs\", \"vscode\"];\n               entriesForTask.push({\n                 value: `${index + 1} vs:task:${task._id}`,\n-                label: `${title} (VS)`,\n+                label: `${displayTitle} (VS)`,\n                 keywords: vsKeywords,\n-                searchText: buildSearchText(`${title} VS`, vsKeywords, [\n+                searchText: buildSearchText(`${displayTitle} VS`, vsKeywords, [\n                   `${index + 1} vs`,\n                   `${index + 1}vs`,\n                   `${index + 1}v`,\n+                  matchUrl ?? undefined,\n                 ]),\n                 className: taskCommandItemClassName,\n                 execute: () => handleSelect(`task:${task._id}:vs`),\n@@ -1829,7 +2072,9 @@ export function CommandBar({\n                     <span className=\"flex h-5 w-8 items-center justify-center rounded text-xs font-semibold bg-neutral-200 dark:bg-neutral-700 text-neutral-600 dark:text-neutral-300 group-data-[selected=true]:bg-neutral-300 dark:group-data-[selected=true]:bg-neutral-600\">\n                       {index + 1} VS\n                     </span>\n-                    <span className=\"flex-1 truncate text-sm\">{title}</span>\n+                    <span className=\"flex-1 truncate text-sm\">\n+                      {displayTitle}\n+                    </span>\n                     <span className={statusClassName}>{statusLabel}</span>\n                   </>\n                 ),\n@@ -1838,13 +2083,18 @@ export function CommandBar({\n               const diffKeywords = [...keywords, \"git\", \"diff\"];\n               entriesForTask.push({\n                 value: `${index + 1} git diff:task:${task._id}`,\n-                label: `${title} (git diff)`,\n+                label: `${displayTitle} (git diff)`,\n                 keywords: diffKeywords,\n-                searchText: buildSearchText(`${title} git diff`, diffKeywords, [\n-                  `${index + 1} git diff`,\n-                  `${index + 1}gitdiff`,\n-                  `${index + 1}gd`,\n-                ]),\n+                searchText: buildSearchText(\n+                  `${displayTitle} git diff`,\n+                  diffKeywords,\n+                  [\n+                    `${index + 1} git diff`,\n+                    `${index + 1}gitdiff`,\n+                    `${index + 1}gd`,\n+                    matchUrl ?? undefined,\n+                  ]\n+                ),\n                 className: taskCommandItemClassName,\n                 execute: () => handleSelect(`task:${task._id}:gitdiff`),\n                 renderContent: () => (\n@@ -1852,7 +2102,9 @@ export function CommandBar({\n                     <span className=\"flex h-5 px-2 items-center justify-center rounded text-xs font-semibold bg-neutral-200 dark:bg-neutral-700 text-neutral-600 dark:text-neutral-300 group-data-[selected=true]:bg-neutral-300 dark:group-data-[selected=true]:bg-neutral-600\">\n                       {index + 1} git diff\n                     </span>\n-                    <span className=\"flex-1 truncate text-sm\">{title}</span>\n+                    <span className=\"flex-1 truncate text-sm\">\n+                      {displayTitle}\n+                    </span>\n                     <span className={statusClassName}>{statusLabel}</span>\n                   </>\n                 ),\n@@ -1923,7 +2175,7 @@ export function CommandBar({\n       : [];\n \n     return [...baseEntries, ...taskEntries, ...electronEntries];\n-  }, [allTasks, handleSelect, stackUser]);\n+  }, [handleSelect, stackUser, tasksForCommandEntries, matchingTaskRun]);\n \n   const localWorkspaceEntries = useMemo<CommandListEntry[]>(() => {\n     return localWorkspaceOptions.map((option) => {\n","comments":[{"type":"issue_comment","id":3515208819,"prNumber":937,"botLogin":"cmux-agent-internal-dev[bot]","body":"[View on 0github](https://0github.com/manaflow-ai/cmux/pull/937)\n\n## Screenshots\n\nNo screenshots available for this pull request.\n\n","commitSha":"e686f2e17c858a09beca80e86f20d5b5dc043099","createdAt":"2025-11-11T06:38:26Z","updatedAt":"2025-11-11T06:38:26Z","htmlUrl":"https://github.com/manaflow-ai/cmux/pull/937#issuecomment-3515208819"}]}
